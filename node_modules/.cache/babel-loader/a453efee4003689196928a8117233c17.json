{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Scrollable } from '../../../base/common/scrollable.js';\nimport { LinesLayout } from './linesLayout.js';\nimport { Viewport } from '../viewModel/viewModel.js';\nvar SMOOTH_SCROLLING_TIME = 125;\n\nvar EditorScrollDimensions =\n/** @class */\nfunction () {\n  function EditorScrollDimensions(width, contentWidth, height, contentHeight) {\n    width = width | 0;\n    contentWidth = contentWidth | 0;\n    height = height | 0;\n    contentHeight = contentHeight | 0;\n\n    if (width < 0) {\n      width = 0;\n    }\n\n    if (contentWidth < 0) {\n      contentWidth = 0;\n    }\n\n    if (height < 0) {\n      height = 0;\n    }\n\n    if (contentHeight < 0) {\n      contentHeight = 0;\n    }\n\n    this.width = width;\n    this.contentWidth = contentWidth;\n    this.scrollWidth = Math.max(width, contentWidth);\n    this.height = height;\n    this.contentHeight = contentHeight;\n    this.scrollHeight = Math.max(height, contentHeight);\n  }\n\n  EditorScrollDimensions.prototype.equals = function (other) {\n    return this.width === other.width && this.contentWidth === other.contentWidth && this.height === other.height && this.contentHeight === other.contentHeight;\n  };\n\n  return EditorScrollDimensions;\n}();\n\nvar EditorScrollable =\n/** @class */\nfunction (_super) {\n  __extends(EditorScrollable, _super);\n\n  function EditorScrollable(smoothScrollDuration, scheduleAtNextAnimationFrame) {\n    var _this = _super.call(this) || this;\n\n    _this._onDidContentSizeChange = _this._register(new Emitter());\n    _this.onDidContentSizeChange = _this._onDidContentSizeChange.event;\n    _this._dimensions = new EditorScrollDimensions(0, 0, 0, 0);\n    _this._scrollable = _this._register(new Scrollable(smoothScrollDuration, scheduleAtNextAnimationFrame));\n    _this.onDidScroll = _this._scrollable.onScroll;\n    return _this;\n  }\n\n  EditorScrollable.prototype.getScrollable = function () {\n    return this._scrollable;\n  };\n\n  EditorScrollable.prototype.setSmoothScrollDuration = function (smoothScrollDuration) {\n    this._scrollable.setSmoothScrollDuration(smoothScrollDuration);\n  };\n\n  EditorScrollable.prototype.validateScrollPosition = function (scrollPosition) {\n    return this._scrollable.validateScrollPosition(scrollPosition);\n  };\n\n  EditorScrollable.prototype.getScrollDimensions = function () {\n    return this._dimensions;\n  };\n\n  EditorScrollable.prototype.setScrollDimensions = function (dimensions) {\n    if (this._dimensions.equals(dimensions)) {\n      return;\n    }\n\n    var oldDimensions = this._dimensions;\n    this._dimensions = dimensions;\n\n    this._scrollable.setScrollDimensions({\n      width: dimensions.width,\n      scrollWidth: dimensions.scrollWidth,\n      height: dimensions.height,\n      scrollHeight: dimensions.scrollHeight\n    });\n\n    var contentWidthChanged = oldDimensions.contentWidth !== dimensions.contentWidth;\n    var contentHeightChanged = oldDimensions.contentHeight !== dimensions.contentHeight;\n\n    if (contentWidthChanged || contentHeightChanged) {\n      this._onDidContentSizeChange.fire({\n        contentWidth: dimensions.contentWidth,\n        contentHeight: dimensions.contentHeight,\n        contentWidthChanged: contentWidthChanged,\n        contentHeightChanged: contentHeightChanged\n      });\n    }\n  };\n\n  EditorScrollable.prototype.getFutureScrollPosition = function () {\n    return this._scrollable.getFutureScrollPosition();\n  };\n\n  EditorScrollable.prototype.getCurrentScrollPosition = function () {\n    return this._scrollable.getCurrentScrollPosition();\n  };\n\n  EditorScrollable.prototype.setScrollPositionNow = function (update) {\n    this._scrollable.setScrollPositionNow(update);\n  };\n\n  EditorScrollable.prototype.setScrollPositionSmooth = function (update) {\n    this._scrollable.setScrollPositionSmooth(update);\n  };\n\n  return EditorScrollable;\n}(Disposable);\n\nvar ViewLayout =\n/** @class */\nfunction (_super) {\n  __extends(ViewLayout, _super);\n\n  function ViewLayout(configuration, lineCount, scheduleAtNextAnimationFrame) {\n    var _this = _super.call(this) || this;\n\n    _this._configuration = configuration;\n    var options = _this._configuration.options;\n    var layoutInfo = options.get(107\n    /* layoutInfo */\n    );\n    _this._linesLayout = new LinesLayout(lineCount, options.get(49\n    /* lineHeight */\n    ));\n    _this._scrollable = _this._register(new EditorScrollable(0, scheduleAtNextAnimationFrame));\n\n    _this._configureSmoothScrollDuration();\n\n    _this._scrollable.setScrollDimensions(new EditorScrollDimensions(layoutInfo.contentWidth, 0, layoutInfo.height, 0));\n\n    _this.onDidScroll = _this._scrollable.onDidScroll;\n    _this.onDidContentSizeChange = _this._scrollable.onDidContentSizeChange;\n\n    _this._updateHeight();\n\n    return _this;\n  }\n\n  ViewLayout.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n  };\n\n  ViewLayout.prototype.getScrollable = function () {\n    return this._scrollable.getScrollable();\n  };\n\n  ViewLayout.prototype.onHeightMaybeChanged = function () {\n    this._updateHeight();\n  };\n\n  ViewLayout.prototype._configureSmoothScrollDuration = function () {\n    this._scrollable.setSmoothScrollDuration(this._configuration.options.get(87\n    /* smoothScrolling */\n    ) ? SMOOTH_SCROLLING_TIME : 0);\n  }; // ---- begin view event handlers\n\n\n  ViewLayout.prototype.onConfigurationChanged = function (e) {\n    var options = this._configuration.options;\n\n    if (e.hasChanged(49\n    /* lineHeight */\n    )) {\n      this._linesLayout.setLineHeight(options.get(49\n      /* lineHeight */\n      ));\n    }\n\n    if (e.hasChanged(107\n    /* layoutInfo */\n    )) {\n      var layoutInfo = options.get(107\n      /* layoutInfo */\n      );\n      var width = layoutInfo.contentWidth;\n      var height = layoutInfo.height;\n\n      var scrollDimensions = this._scrollable.getScrollDimensions();\n\n      var scrollWidth = scrollDimensions.scrollWidth;\n\n      this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, scrollWidth)));\n    } else {\n      this._updateHeight();\n    }\n\n    if (e.hasChanged(87\n    /* smoothScrolling */\n    )) {\n      this._configureSmoothScrollDuration();\n    }\n  };\n\n  ViewLayout.prototype.onFlushed = function (lineCount) {\n    this._linesLayout.onFlushed(lineCount);\n  };\n\n  ViewLayout.prototype.onLinesDeleted = function (fromLineNumber, toLineNumber) {\n    this._linesLayout.onLinesDeleted(fromLineNumber, toLineNumber);\n  };\n\n  ViewLayout.prototype.onLinesInserted = function (fromLineNumber, toLineNumber) {\n    this._linesLayout.onLinesInserted(fromLineNumber, toLineNumber);\n  }; // ---- end view event handlers\n\n\n  ViewLayout.prototype._getHorizontalScrollbarHeight = function (width, scrollWidth) {\n    var options = this._configuration.options;\n    var scrollbar = options.get(78\n    /* scrollbar */\n    );\n\n    if (scrollbar.horizontal === 2\n    /* Hidden */\n    ) {\n        // horizontal scrollbar not visible\n        return 0;\n      }\n\n    if (width >= scrollWidth) {\n      // horizontal scrollbar not visible\n      return 0;\n    }\n\n    return scrollbar.horizontalScrollbarSize;\n  };\n\n  ViewLayout.prototype._getContentHeight = function (width, height, scrollWidth) {\n    var options = this._configuration.options;\n\n    var result = this._linesLayout.getLinesTotalHeight();\n\n    if (options.get(80\n    /* scrollBeyondLastLine */\n    )) {\n      result += height - options.get(49\n      /* lineHeight */\n      );\n    } else {\n      result += this._getHorizontalScrollbarHeight(width, scrollWidth);\n    }\n\n    return result;\n  };\n\n  ViewLayout.prototype._updateHeight = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    var width = scrollDimensions.width;\n    var height = scrollDimensions.height;\n    var scrollWidth = scrollDimensions.scrollWidth;\n\n    this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, scrollWidth)));\n  }; // ---- Layouting logic\n\n\n  ViewLayout.prototype.getCurrentViewport = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\n  };\n\n  ViewLayout.prototype.getFutureViewport = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    var currentScrollPosition = this._scrollable.getFutureScrollPosition();\n\n    return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\n  };\n\n  ViewLayout.prototype._computeContentWidth = function (maxLineWidth) {\n    var options = this._configuration.options;\n    var wrappingInfo = options.get(108\n    /* wrappingInfo */\n    );\n    var fontInfo = options.get(34\n    /* fontInfo */\n    );\n\n    if (wrappingInfo.isViewportWrapping) {\n      var layoutInfo = options.get(107\n      /* layoutInfo */\n      );\n      var minimap = options.get(54\n      /* minimap */\n      );\n\n      if (maxLineWidth > layoutInfo.contentWidth + fontInfo.typicalHalfwidthCharacterWidth) {\n        // This is a case where viewport wrapping is on, but the line extends above the viewport\n        if (minimap.enabled && minimap.side === 'right') {\n          // We need to accomodate the scrollbar width\n          return maxLineWidth + layoutInfo.verticalScrollbarWidth;\n        }\n      }\n\n      return maxLineWidth;\n    } else {\n      var extraHorizontalSpace = options.get(79\n      /* scrollBeyondLastColumn */\n      ) * fontInfo.typicalHalfwidthCharacterWidth;\n\n      var whitespaceMinWidth = this._linesLayout.getWhitespaceMinWidth();\n\n      return Math.max(maxLineWidth + extraHorizontalSpace, whitespaceMinWidth);\n    }\n  };\n\n  ViewLayout.prototype.onMaxLineWidthChanged = function (maxLineWidth) {\n    var scrollDimensions = this._scrollable.getScrollDimensions(); // const newScrollWidth = ;\n\n\n    this._scrollable.setScrollDimensions(new EditorScrollDimensions(scrollDimensions.width, this._computeContentWidth(maxLineWidth), scrollDimensions.height, scrollDimensions.contentHeight)); // The height might depend on the fact that there is a horizontal scrollbar or not\n\n\n    this._updateHeight();\n  }; // ---- view state\n\n\n  ViewLayout.prototype.saveState = function () {\n    var currentScrollPosition = this._scrollable.getFutureScrollPosition();\n\n    var scrollTop = currentScrollPosition.scrollTop;\n\n    var firstLineNumberInViewport = this._linesLayout.getLineNumberAtOrAfterVerticalOffset(scrollTop);\n\n    var whitespaceAboveFirstLine = this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(firstLineNumberInViewport);\n\n    return {\n      scrollTop: scrollTop,\n      scrollTopWithoutViewZones: scrollTop - whitespaceAboveFirstLine,\n      scrollLeft: currentScrollPosition.scrollLeft\n    };\n  }; // ---- IVerticalLayoutProvider\n\n\n  ViewLayout.prototype.changeWhitespace = function (callback) {\n    return this._linesLayout.changeWhitespace(callback);\n  };\n\n  ViewLayout.prototype.getVerticalOffsetForLineNumber = function (lineNumber) {\n    return this._linesLayout.getVerticalOffsetForLineNumber(lineNumber);\n  };\n\n  ViewLayout.prototype.isAfterLines = function (verticalOffset) {\n    return this._linesLayout.isAfterLines(verticalOffset);\n  };\n\n  ViewLayout.prototype.getLineNumberAtVerticalOffset = function (verticalOffset) {\n    return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(verticalOffset);\n  };\n\n  ViewLayout.prototype.getWhitespaceAtVerticalOffset = function (verticalOffset) {\n    return this._linesLayout.getWhitespaceAtVerticalOffset(verticalOffset);\n  };\n\n  ViewLayout.prototype.getLinesViewportData = function () {\n    var visibleBox = this.getCurrentViewport();\n    return this._linesLayout.getLinesViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\n  };\n\n  ViewLayout.prototype.getLinesViewportDataAtScrollTop = function (scrollTop) {\n    // do some minimal validations on scrollTop\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    if (scrollTop + scrollDimensions.height > scrollDimensions.scrollHeight) {\n      scrollTop = scrollDimensions.scrollHeight - scrollDimensions.height;\n    }\n\n    if (scrollTop < 0) {\n      scrollTop = 0;\n    }\n\n    return this._linesLayout.getLinesViewportData(scrollTop, scrollTop + scrollDimensions.height);\n  };\n\n  ViewLayout.prototype.getWhitespaceViewportData = function () {\n    var visibleBox = this.getCurrentViewport();\n    return this._linesLayout.getWhitespaceViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\n  };\n\n  ViewLayout.prototype.getWhitespaces = function () {\n    return this._linesLayout.getWhitespaces();\n  }; // ---- IScrollingProvider\n\n\n  ViewLayout.prototype.getContentWidth = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.contentWidth;\n  };\n\n  ViewLayout.prototype.getScrollWidth = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.scrollWidth;\n  };\n\n  ViewLayout.prototype.getContentHeight = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.contentHeight;\n  };\n\n  ViewLayout.prototype.getScrollHeight = function () {\n    var scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.scrollHeight;\n  };\n\n  ViewLayout.prototype.getCurrentScrollLeft = function () {\n    var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    return currentScrollPosition.scrollLeft;\n  };\n\n  ViewLayout.prototype.getCurrentScrollTop = function () {\n    var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    return currentScrollPosition.scrollTop;\n  };\n\n  ViewLayout.prototype.validateScrollPosition = function (scrollPosition) {\n    return this._scrollable.validateScrollPosition(scrollPosition);\n  };\n\n  ViewLayout.prototype.setScrollPositionNow = function (position) {\n    this._scrollable.setScrollPositionNow(position);\n  };\n\n  ViewLayout.prototype.setScrollPositionSmooth = function (position) {\n    this._scrollable.setScrollPositionSmooth(position);\n  };\n\n  ViewLayout.prototype.deltaScrollNow = function (deltaScrollLeft, deltaScrollTop) {\n    var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    this._scrollable.setScrollPositionNow({\n      scrollLeft: currentScrollPosition.scrollLeft + deltaScrollLeft,\n      scrollTop: currentScrollPosition.scrollTop + deltaScrollTop\n    });\n  };\n\n  return ViewLayout;\n}(Disposable);\n\nexport { ViewLayout };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/common/viewLayout/viewLayout.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Emitter","Disposable","Scrollable","LinesLayout","Viewport","SMOOTH_SCROLLING_TIME","EditorScrollDimensions","width","contentWidth","height","contentHeight","scrollWidth","Math","max","scrollHeight","equals","other","EditorScrollable","_super","smoothScrollDuration","scheduleAtNextAnimationFrame","_this","call","_onDidContentSizeChange","_register","onDidContentSizeChange","event","_dimensions","_scrollable","onDidScroll","onScroll","getScrollable","setSmoothScrollDuration","validateScrollPosition","scrollPosition","getScrollDimensions","setScrollDimensions","dimensions","oldDimensions","contentWidthChanged","contentHeightChanged","fire","getFutureScrollPosition","getCurrentScrollPosition","setScrollPositionNow","update","setScrollPositionSmooth","ViewLayout","configuration","lineCount","_configuration","options","layoutInfo","get","_linesLayout","_configureSmoothScrollDuration","_updateHeight","dispose","onHeightMaybeChanged","onConfigurationChanged","e","hasChanged","setLineHeight","scrollDimensions","_getContentHeight","onFlushed","onLinesDeleted","fromLineNumber","toLineNumber","onLinesInserted","_getHorizontalScrollbarHeight","scrollbar","horizontal","horizontalScrollbarSize","result","getLinesTotalHeight","getCurrentViewport","currentScrollPosition","scrollTop","scrollLeft","getFutureViewport","_computeContentWidth","maxLineWidth","wrappingInfo","fontInfo","isViewportWrapping","minimap","typicalHalfwidthCharacterWidth","enabled","side","verticalScrollbarWidth","extraHorizontalSpace","whitespaceMinWidth","getWhitespaceMinWidth","onMaxLineWidthChanged","saveState","firstLineNumberInViewport","getLineNumberAtOrAfterVerticalOffset","whitespaceAboveFirstLine","getWhitespaceAccumulatedHeightBeforeLineNumber","scrollTopWithoutViewZones","changeWhitespace","callback","getVerticalOffsetForLineNumber","lineNumber","isAfterLines","verticalOffset","getLineNumberAtVerticalOffset","getWhitespaceAtVerticalOffset","getLinesViewportData","visibleBox","top","getLinesViewportDataAtScrollTop","getWhitespaceViewportData","getWhitespaces","getContentWidth","getScrollWidth","getContentHeight","getScrollHeight","getCurrentScrollLeft","getCurrentScrollTop","position","deltaScrollNow","deltaScrollLeft","deltaScrollTop"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { Scrollable } from '../../../base/common/scrollable.js';\r\nimport { LinesLayout } from './linesLayout.js';\r\nimport { Viewport } from '../viewModel/viewModel.js';\r\nvar SMOOTH_SCROLLING_TIME = 125;\r\nvar EditorScrollDimensions = /** @class */ (function () {\r\n    function EditorScrollDimensions(width, contentWidth, height, contentHeight) {\r\n        width = width | 0;\r\n        contentWidth = contentWidth | 0;\r\n        height = height | 0;\r\n        contentHeight = contentHeight | 0;\r\n        if (width < 0) {\r\n            width = 0;\r\n        }\r\n        if (contentWidth < 0) {\r\n            contentWidth = 0;\r\n        }\r\n        if (height < 0) {\r\n            height = 0;\r\n        }\r\n        if (contentHeight < 0) {\r\n            contentHeight = 0;\r\n        }\r\n        this.width = width;\r\n        this.contentWidth = contentWidth;\r\n        this.scrollWidth = Math.max(width, contentWidth);\r\n        this.height = height;\r\n        this.contentHeight = contentHeight;\r\n        this.scrollHeight = Math.max(height, contentHeight);\r\n    }\r\n    EditorScrollDimensions.prototype.equals = function (other) {\r\n        return (this.width === other.width\r\n            && this.contentWidth === other.contentWidth\r\n            && this.height === other.height\r\n            && this.contentHeight === other.contentHeight);\r\n    };\r\n    return EditorScrollDimensions;\r\n}());\r\nvar EditorScrollable = /** @class */ (function (_super) {\r\n    __extends(EditorScrollable, _super);\r\n    function EditorScrollable(smoothScrollDuration, scheduleAtNextAnimationFrame) {\r\n        var _this = _super.call(this) || this;\r\n        _this._onDidContentSizeChange = _this._register(new Emitter());\r\n        _this.onDidContentSizeChange = _this._onDidContentSizeChange.event;\r\n        _this._dimensions = new EditorScrollDimensions(0, 0, 0, 0);\r\n        _this._scrollable = _this._register(new Scrollable(smoothScrollDuration, scheduleAtNextAnimationFrame));\r\n        _this.onDidScroll = _this._scrollable.onScroll;\r\n        return _this;\r\n    }\r\n    EditorScrollable.prototype.getScrollable = function () {\r\n        return this._scrollable;\r\n    };\r\n    EditorScrollable.prototype.setSmoothScrollDuration = function (smoothScrollDuration) {\r\n        this._scrollable.setSmoothScrollDuration(smoothScrollDuration);\r\n    };\r\n    EditorScrollable.prototype.validateScrollPosition = function (scrollPosition) {\r\n        return this._scrollable.validateScrollPosition(scrollPosition);\r\n    };\r\n    EditorScrollable.prototype.getScrollDimensions = function () {\r\n        return this._dimensions;\r\n    };\r\n    EditorScrollable.prototype.setScrollDimensions = function (dimensions) {\r\n        if (this._dimensions.equals(dimensions)) {\r\n            return;\r\n        }\r\n        var oldDimensions = this._dimensions;\r\n        this._dimensions = dimensions;\r\n        this._scrollable.setScrollDimensions({\r\n            width: dimensions.width,\r\n            scrollWidth: dimensions.scrollWidth,\r\n            height: dimensions.height,\r\n            scrollHeight: dimensions.scrollHeight\r\n        });\r\n        var contentWidthChanged = (oldDimensions.contentWidth !== dimensions.contentWidth);\r\n        var contentHeightChanged = (oldDimensions.contentHeight !== dimensions.contentHeight);\r\n        if (contentWidthChanged || contentHeightChanged) {\r\n            this._onDidContentSizeChange.fire({\r\n                contentWidth: dimensions.contentWidth,\r\n                contentHeight: dimensions.contentHeight,\r\n                contentWidthChanged: contentWidthChanged,\r\n                contentHeightChanged: contentHeightChanged\r\n            });\r\n        }\r\n    };\r\n    EditorScrollable.prototype.getFutureScrollPosition = function () {\r\n        return this._scrollable.getFutureScrollPosition();\r\n    };\r\n    EditorScrollable.prototype.getCurrentScrollPosition = function () {\r\n        return this._scrollable.getCurrentScrollPosition();\r\n    };\r\n    EditorScrollable.prototype.setScrollPositionNow = function (update) {\r\n        this._scrollable.setScrollPositionNow(update);\r\n    };\r\n    EditorScrollable.prototype.setScrollPositionSmooth = function (update) {\r\n        this._scrollable.setScrollPositionSmooth(update);\r\n    };\r\n    return EditorScrollable;\r\n}(Disposable));\r\nvar ViewLayout = /** @class */ (function (_super) {\r\n    __extends(ViewLayout, _super);\r\n    function ViewLayout(configuration, lineCount, scheduleAtNextAnimationFrame) {\r\n        var _this = _super.call(this) || this;\r\n        _this._configuration = configuration;\r\n        var options = _this._configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        _this._linesLayout = new LinesLayout(lineCount, options.get(49 /* lineHeight */));\r\n        _this._scrollable = _this._register(new EditorScrollable(0, scheduleAtNextAnimationFrame));\r\n        _this._configureSmoothScrollDuration();\r\n        _this._scrollable.setScrollDimensions(new EditorScrollDimensions(layoutInfo.contentWidth, 0, layoutInfo.height, 0));\r\n        _this.onDidScroll = _this._scrollable.onDidScroll;\r\n        _this.onDidContentSizeChange = _this._scrollable.onDidContentSizeChange;\r\n        _this._updateHeight();\r\n        return _this;\r\n    }\r\n    ViewLayout.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ViewLayout.prototype.getScrollable = function () {\r\n        return this._scrollable.getScrollable();\r\n    };\r\n    ViewLayout.prototype.onHeightMaybeChanged = function () {\r\n        this._updateHeight();\r\n    };\r\n    ViewLayout.prototype._configureSmoothScrollDuration = function () {\r\n        this._scrollable.setSmoothScrollDuration(this._configuration.options.get(87 /* smoothScrolling */) ? SMOOTH_SCROLLING_TIME : 0);\r\n    };\r\n    // ---- begin view event handlers\r\n    ViewLayout.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._configuration.options;\r\n        if (e.hasChanged(49 /* lineHeight */)) {\r\n            this._linesLayout.setLineHeight(options.get(49 /* lineHeight */));\r\n        }\r\n        if (e.hasChanged(107 /* layoutInfo */)) {\r\n            var layoutInfo = options.get(107 /* layoutInfo */);\r\n            var width = layoutInfo.contentWidth;\r\n            var height = layoutInfo.height;\r\n            var scrollDimensions = this._scrollable.getScrollDimensions();\r\n            var scrollWidth = scrollDimensions.scrollWidth;\r\n            this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, scrollWidth)));\r\n        }\r\n        else {\r\n            this._updateHeight();\r\n        }\r\n        if (e.hasChanged(87 /* smoothScrolling */)) {\r\n            this._configureSmoothScrollDuration();\r\n        }\r\n    };\r\n    ViewLayout.prototype.onFlushed = function (lineCount) {\r\n        this._linesLayout.onFlushed(lineCount);\r\n    };\r\n    ViewLayout.prototype.onLinesDeleted = function (fromLineNumber, toLineNumber) {\r\n        this._linesLayout.onLinesDeleted(fromLineNumber, toLineNumber);\r\n    };\r\n    ViewLayout.prototype.onLinesInserted = function (fromLineNumber, toLineNumber) {\r\n        this._linesLayout.onLinesInserted(fromLineNumber, toLineNumber);\r\n    };\r\n    // ---- end view event handlers\r\n    ViewLayout.prototype._getHorizontalScrollbarHeight = function (width, scrollWidth) {\r\n        var options = this._configuration.options;\r\n        var scrollbar = options.get(78 /* scrollbar */);\r\n        if (scrollbar.horizontal === 2 /* Hidden */) {\r\n            // horizontal scrollbar not visible\r\n            return 0;\r\n        }\r\n        if (width >= scrollWidth) {\r\n            // horizontal scrollbar not visible\r\n            return 0;\r\n        }\r\n        return scrollbar.horizontalScrollbarSize;\r\n    };\r\n    ViewLayout.prototype._getContentHeight = function (width, height, scrollWidth) {\r\n        var options = this._configuration.options;\r\n        var result = this._linesLayout.getLinesTotalHeight();\r\n        if (options.get(80 /* scrollBeyondLastLine */)) {\r\n            result += height - options.get(49 /* lineHeight */);\r\n        }\r\n        else {\r\n            result += this._getHorizontalScrollbarHeight(width, scrollWidth);\r\n        }\r\n        return result;\r\n    };\r\n    ViewLayout.prototype._updateHeight = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        var width = scrollDimensions.width;\r\n        var height = scrollDimensions.height;\r\n        var scrollWidth = scrollDimensions.scrollWidth;\r\n        this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, scrollWidth)));\r\n    };\r\n    // ---- Layouting logic\r\n    ViewLayout.prototype.getCurrentViewport = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\r\n        return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\r\n    };\r\n    ViewLayout.prototype.getFutureViewport = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        var currentScrollPosition = this._scrollable.getFutureScrollPosition();\r\n        return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\r\n    };\r\n    ViewLayout.prototype._computeContentWidth = function (maxLineWidth) {\r\n        var options = this._configuration.options;\r\n        var wrappingInfo = options.get(108 /* wrappingInfo */);\r\n        var fontInfo = options.get(34 /* fontInfo */);\r\n        if (wrappingInfo.isViewportWrapping) {\r\n            var layoutInfo = options.get(107 /* layoutInfo */);\r\n            var minimap = options.get(54 /* minimap */);\r\n            if (maxLineWidth > layoutInfo.contentWidth + fontInfo.typicalHalfwidthCharacterWidth) {\r\n                // This is a case where viewport wrapping is on, but the line extends above the viewport\r\n                if (minimap.enabled && minimap.side === 'right') {\r\n                    // We need to accomodate the scrollbar width\r\n                    return maxLineWidth + layoutInfo.verticalScrollbarWidth;\r\n                }\r\n            }\r\n            return maxLineWidth;\r\n        }\r\n        else {\r\n            var extraHorizontalSpace = options.get(79 /* scrollBeyondLastColumn */) * fontInfo.typicalHalfwidthCharacterWidth;\r\n            var whitespaceMinWidth = this._linesLayout.getWhitespaceMinWidth();\r\n            return Math.max(maxLineWidth + extraHorizontalSpace, whitespaceMinWidth);\r\n        }\r\n    };\r\n    ViewLayout.prototype.onMaxLineWidthChanged = function (maxLineWidth) {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        // const newScrollWidth = ;\r\n        this._scrollable.setScrollDimensions(new EditorScrollDimensions(scrollDimensions.width, this._computeContentWidth(maxLineWidth), scrollDimensions.height, scrollDimensions.contentHeight));\r\n        // The height might depend on the fact that there is a horizontal scrollbar or not\r\n        this._updateHeight();\r\n    };\r\n    // ---- view state\r\n    ViewLayout.prototype.saveState = function () {\r\n        var currentScrollPosition = this._scrollable.getFutureScrollPosition();\r\n        var scrollTop = currentScrollPosition.scrollTop;\r\n        var firstLineNumberInViewport = this._linesLayout.getLineNumberAtOrAfterVerticalOffset(scrollTop);\r\n        var whitespaceAboveFirstLine = this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(firstLineNumberInViewport);\r\n        return {\r\n            scrollTop: scrollTop,\r\n            scrollTopWithoutViewZones: scrollTop - whitespaceAboveFirstLine,\r\n            scrollLeft: currentScrollPosition.scrollLeft\r\n        };\r\n    };\r\n    // ---- IVerticalLayoutProvider\r\n    ViewLayout.prototype.changeWhitespace = function (callback) {\r\n        return this._linesLayout.changeWhitespace(callback);\r\n    };\r\n    ViewLayout.prototype.getVerticalOffsetForLineNumber = function (lineNumber) {\r\n        return this._linesLayout.getVerticalOffsetForLineNumber(lineNumber);\r\n    };\r\n    ViewLayout.prototype.isAfterLines = function (verticalOffset) {\r\n        return this._linesLayout.isAfterLines(verticalOffset);\r\n    };\r\n    ViewLayout.prototype.getLineNumberAtVerticalOffset = function (verticalOffset) {\r\n        return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(verticalOffset);\r\n    };\r\n    ViewLayout.prototype.getWhitespaceAtVerticalOffset = function (verticalOffset) {\r\n        return this._linesLayout.getWhitespaceAtVerticalOffset(verticalOffset);\r\n    };\r\n    ViewLayout.prototype.getLinesViewportData = function () {\r\n        var visibleBox = this.getCurrentViewport();\r\n        return this._linesLayout.getLinesViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\r\n    };\r\n    ViewLayout.prototype.getLinesViewportDataAtScrollTop = function (scrollTop) {\r\n        // do some minimal validations on scrollTop\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        if (scrollTop + scrollDimensions.height > scrollDimensions.scrollHeight) {\r\n            scrollTop = scrollDimensions.scrollHeight - scrollDimensions.height;\r\n        }\r\n        if (scrollTop < 0) {\r\n            scrollTop = 0;\r\n        }\r\n        return this._linesLayout.getLinesViewportData(scrollTop, scrollTop + scrollDimensions.height);\r\n    };\r\n    ViewLayout.prototype.getWhitespaceViewportData = function () {\r\n        var visibleBox = this.getCurrentViewport();\r\n        return this._linesLayout.getWhitespaceViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\r\n    };\r\n    ViewLayout.prototype.getWhitespaces = function () {\r\n        return this._linesLayout.getWhitespaces();\r\n    };\r\n    // ---- IScrollingProvider\r\n    ViewLayout.prototype.getContentWidth = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        return scrollDimensions.contentWidth;\r\n    };\r\n    ViewLayout.prototype.getScrollWidth = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        return scrollDimensions.scrollWidth;\r\n    };\r\n    ViewLayout.prototype.getContentHeight = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        return scrollDimensions.contentHeight;\r\n    };\r\n    ViewLayout.prototype.getScrollHeight = function () {\r\n        var scrollDimensions = this._scrollable.getScrollDimensions();\r\n        return scrollDimensions.scrollHeight;\r\n    };\r\n    ViewLayout.prototype.getCurrentScrollLeft = function () {\r\n        var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\r\n        return currentScrollPosition.scrollLeft;\r\n    };\r\n    ViewLayout.prototype.getCurrentScrollTop = function () {\r\n        var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\r\n        return currentScrollPosition.scrollTop;\r\n    };\r\n    ViewLayout.prototype.validateScrollPosition = function (scrollPosition) {\r\n        return this._scrollable.validateScrollPosition(scrollPosition);\r\n    };\r\n    ViewLayout.prototype.setScrollPositionNow = function (position) {\r\n        this._scrollable.setScrollPositionNow(position);\r\n    };\r\n    ViewLayout.prototype.setScrollPositionSmooth = function (position) {\r\n        this._scrollable.setScrollPositionSmooth(position);\r\n    };\r\n    ViewLayout.prototype.deltaScrollNow = function (deltaScrollLeft, deltaScrollTop) {\r\n        var currentScrollPosition = this._scrollable.getCurrentScrollPosition();\r\n        this._scrollable.setScrollPositionNow({\r\n            scrollLeft: currentScrollPosition.scrollLeft + deltaScrollLeft,\r\n            scrollTop: currentScrollPosition.scrollTop + deltaScrollTop\r\n        });\r\n    };\r\n    return ViewLayout;\r\n}(Disposable));\r\nexport { ViewLayout };\r\n"]},"metadata":{},"sourceType":"module"}