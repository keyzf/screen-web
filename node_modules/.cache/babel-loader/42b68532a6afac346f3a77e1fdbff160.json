{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport * as dom from '../../../base/browser/dom.js';\nimport { domEvent, stop } from '../../../base/browser/event.js';\nimport * as aria from '../../../base/browser/ui/aria/aria.js';\nimport { DomScrollableElement } from '../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport './parameterHints.css';\nimport { IModeService } from '../../common/services/modeService.js';\nimport { MarkdownRenderer } from '../markdown/markdownRenderer.js';\nimport { Context } from './provideSignatureHelp.js';\nimport * as nls from '../../../nls.js';\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\nimport { editorHoverBackground, editorHoverBorder, textCodeBlockBackground, textLinkForeground, editorHoverForeground } from '../../../platform/theme/common/colorRegistry.js';\nimport { HIGH_CONTRAST, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { ParameterHintsModel } from './parameterHintsModel.js';\nimport { pad } from '../../../base/common/strings.js';\nvar $ = dom.$;\n\nvar ParameterHintsWidget =\n/** @class */\nfunction (_super) {\n  __extends(ParameterHintsWidget, _super);\n\n  function ParameterHintsWidget(editor, contextKeyService, openerService, modeService) {\n    var _this = _super.call(this) || this;\n\n    _this.editor = editor;\n    _this.renderDisposeables = _this._register(new DisposableStore());\n    _this.visible = false;\n    _this.announcedLabel = null; // Editor.IContentWidget.allowEditorOverflow\n\n    _this.allowEditorOverflow = true;\n    _this.markdownRenderer = _this._register(new MarkdownRenderer(editor, modeService, openerService));\n    _this.model = _this._register(new ParameterHintsModel(editor));\n    _this.keyVisible = Context.Visible.bindTo(contextKeyService);\n    _this.keyMultipleSignatures = Context.MultipleSignatures.bindTo(contextKeyService);\n\n    _this._register(_this.model.onChangedHints(function (newParameterHints) {\n      if (newParameterHints) {\n        _this.show();\n\n        _this.render(newParameterHints);\n      } else {\n        _this.hide();\n      }\n    }));\n\n    return _this;\n  }\n\n  ParameterHintsWidget.prototype.createParamaterHintDOMNodes = function () {\n    var _this = this;\n\n    var element = $('.editor-widget.parameter-hints-widget');\n    var wrapper = dom.append(element, $('.wrapper'));\n    wrapper.tabIndex = -1;\n    var controls = dom.append(wrapper, $('.controls'));\n    var previous = dom.append(controls, $('.button.codicon.codicon-chevron-up'));\n    var overloads = dom.append(controls, $('.overloads'));\n    var next = dom.append(controls, $('.button.codicon.codicon-chevron-down'));\n    var onPreviousClick = stop(domEvent(previous, 'click'));\n\n    this._register(onPreviousClick(this.previous, this));\n\n    var onNextClick = stop(domEvent(next, 'click'));\n\n    this._register(onNextClick(this.next, this));\n\n    var body = $('.body');\n    var scrollbar = new DomScrollableElement(body, {});\n\n    this._register(scrollbar);\n\n    wrapper.appendChild(scrollbar.getDomNode());\n    var signature = dom.append(body, $('.signature'));\n    var docs = dom.append(body, $('.docs'));\n    element.style.userSelect = 'text';\n    this.domNodes = {\n      element: element,\n      signature: signature,\n      overloads: overloads,\n      docs: docs,\n      scrollbar: scrollbar\n    };\n    this.editor.addContentWidget(this);\n    this.hide();\n\n    this._register(this.editor.onDidChangeCursorSelection(function (e) {\n      if (_this.visible) {\n        _this.editor.layoutContentWidget(_this);\n      }\n    }));\n\n    var updateFont = function () {\n      if (!_this.domNodes) {\n        return;\n      }\n\n      var fontInfo = _this.editor.getOption(34\n      /* fontInfo */\n      );\n\n      _this.domNodes.element.style.fontSize = fontInfo.fontSize + \"px\";\n    };\n\n    updateFont();\n\n    this._register(Event.chain(this.editor.onDidChangeConfiguration.bind(this.editor)).filter(function (e) {\n      return e.hasChanged(34\n      /* fontInfo */\n      );\n    }).on(updateFont, null));\n\n    this._register(this.editor.onDidLayoutChange(function (e) {\n      return _this.updateMaxHeight();\n    }));\n\n    this.updateMaxHeight();\n  };\n\n  ParameterHintsWidget.prototype.show = function () {\n    var _this = this;\n\n    if (this.visible) {\n      return;\n    }\n\n    if (!this.domNodes) {\n      this.createParamaterHintDOMNodes();\n    }\n\n    this.keyVisible.set(true);\n    this.visible = true;\n    setTimeout(function () {\n      if (_this.domNodes) {\n        dom.addClass(_this.domNodes.element, 'visible');\n      }\n    }, 100);\n    this.editor.layoutContentWidget(this);\n  };\n\n  ParameterHintsWidget.prototype.hide = function () {\n    if (!this.visible) {\n      return;\n    }\n\n    this.keyVisible.reset();\n    this.visible = false;\n    this.announcedLabel = null;\n\n    if (this.domNodes) {\n      dom.removeClass(this.domNodes.element, 'visible');\n    }\n\n    this.editor.layoutContentWidget(this);\n  };\n\n  ParameterHintsWidget.prototype.getPosition = function () {\n    if (this.visible) {\n      return {\n        position: this.editor.getPosition(),\n        preference: [1\n        /* ABOVE */\n        , 2\n        /* BELOW */\n        ]\n      };\n    }\n\n    return null;\n  };\n\n  ParameterHintsWidget.prototype.render = function (hints) {\n    if (!this.domNodes) {\n      return;\n    }\n\n    var multiple = hints.signatures.length > 1;\n    dom.toggleClass(this.domNodes.element, 'multiple', multiple);\n    this.keyMultipleSignatures.set(multiple);\n    this.domNodes.signature.innerHTML = '';\n    this.domNodes.docs.innerHTML = '';\n    var signature = hints.signatures[hints.activeSignature];\n\n    if (!signature) {\n      return;\n    }\n\n    var code = dom.append(this.domNodes.signature, $('.code'));\n    var hasParameters = signature.parameters.length > 0;\n    var fontInfo = this.editor.getOption(34\n    /* fontInfo */\n    );\n    code.style.fontSize = fontInfo.fontSize + \"px\";\n    code.style.fontFamily = fontInfo.fontFamily;\n\n    if (!hasParameters) {\n      var label = dom.append(code, $('span'));\n      label.textContent = signature.label;\n    } else {\n      this.renderParameters(code, signature, hints.activeParameter);\n    }\n\n    this.renderDisposeables.clear();\n    var activeParameter = signature.parameters[hints.activeParameter];\n\n    if (activeParameter && activeParameter.documentation) {\n      var documentation = $('span.documentation');\n\n      if (typeof activeParameter.documentation === 'string') {\n        documentation.textContent = activeParameter.documentation;\n      } else {\n        var renderedContents = this.markdownRenderer.render(activeParameter.documentation);\n        dom.addClass(renderedContents.element, 'markdown-docs');\n        this.renderDisposeables.add(renderedContents);\n        documentation.appendChild(renderedContents.element);\n      }\n\n      dom.append(this.domNodes.docs, $('p', {}, documentation));\n    }\n\n    if (signature.documentation === undefined) {\n      /** no op */\n    } else if (typeof signature.documentation === 'string') {\n      dom.append(this.domNodes.docs, $('p', {}, signature.documentation));\n    } else {\n      var renderedContents = this.markdownRenderer.render(signature.documentation);\n      dom.addClass(renderedContents.element, 'markdown-docs');\n      this.renderDisposeables.add(renderedContents);\n      dom.append(this.domNodes.docs, renderedContents.element);\n    }\n\n    var hasDocs = this.hasDocs(signature, activeParameter);\n    dom.toggleClass(this.domNodes.signature, 'has-docs', hasDocs);\n    dom.toggleClass(this.domNodes.docs, 'empty', !hasDocs);\n    this.domNodes.overloads.textContent = pad(hints.activeSignature + 1, hints.signatures.length.toString().length) + '/' + hints.signatures.length;\n\n    if (activeParameter) {\n      var labelToAnnounce = this.getParameterLabel(signature, hints.activeParameter); // Select method gets called on every user type while parameter hints are visible.\n      // We do not want to spam the user with same announcements, so we only announce if the current parameter changed.\n\n      if (this.announcedLabel !== labelToAnnounce) {\n        aria.alert(nls.localize('hint', \"{0}, hint\", labelToAnnounce));\n        this.announcedLabel = labelToAnnounce;\n      }\n    }\n\n    this.editor.layoutContentWidget(this);\n    this.domNodes.scrollbar.scanDomNode();\n  };\n\n  ParameterHintsWidget.prototype.hasDocs = function (signature, activeParameter) {\n    if (activeParameter && typeof activeParameter.documentation === 'string' && activeParameter.documentation.length > 0) {\n      return true;\n    }\n\n    if (activeParameter && typeof activeParameter.documentation === 'object' && activeParameter.documentation.value.length > 0) {\n      return true;\n    }\n\n    if (typeof signature.documentation === 'string' && signature.documentation.length > 0) {\n      return true;\n    }\n\n    if (typeof signature.documentation === 'object' && signature.documentation.value.length > 0) {\n      return true;\n    }\n\n    return false;\n  };\n\n  ParameterHintsWidget.prototype.renderParameters = function (parent, signature, currentParameter) {\n    var _a = this.getParameterLabelOffsets(signature, currentParameter),\n        start = _a[0],\n        end = _a[1];\n\n    var beforeSpan = document.createElement('span');\n    beforeSpan.textContent = signature.label.substring(0, start);\n    var paramSpan = document.createElement('span');\n    paramSpan.textContent = signature.label.substring(start, end);\n    paramSpan.className = 'parameter active';\n    var afterSpan = document.createElement('span');\n    afterSpan.textContent = signature.label.substring(end);\n    dom.append(parent, beforeSpan, paramSpan, afterSpan);\n  };\n\n  ParameterHintsWidget.prototype.getParameterLabel = function (signature, paramIdx) {\n    var param = signature.parameters[paramIdx];\n\n    if (typeof param.label === 'string') {\n      return param.label;\n    } else {\n      return signature.label.substring(param.label[0], param.label[1]);\n    }\n  };\n\n  ParameterHintsWidget.prototype.getParameterLabelOffsets = function (signature, paramIdx) {\n    var param = signature.parameters[paramIdx];\n\n    if (!param) {\n      return [0, 0];\n    } else if (Array.isArray(param.label)) {\n      return param.label;\n    } else {\n      var idx = signature.label.lastIndexOf(param.label);\n      return idx >= 0 ? [idx, idx + param.label.length] : [0, 0];\n    }\n  };\n\n  ParameterHintsWidget.prototype.next = function () {\n    this.editor.focus();\n    this.model.next();\n  };\n\n  ParameterHintsWidget.prototype.previous = function () {\n    this.editor.focus();\n    this.model.previous();\n  };\n\n  ParameterHintsWidget.prototype.cancel = function () {\n    this.model.cancel();\n  };\n\n  ParameterHintsWidget.prototype.getDomNode = function () {\n    if (!this.domNodes) {\n      this.createParamaterHintDOMNodes();\n    }\n\n    return this.domNodes.element;\n  };\n\n  ParameterHintsWidget.prototype.getId = function () {\n    return ParameterHintsWidget.ID;\n  };\n\n  ParameterHintsWidget.prototype.trigger = function (context) {\n    this.model.trigger(context, 0);\n  };\n\n  ParameterHintsWidget.prototype.updateMaxHeight = function () {\n    if (!this.domNodes) {\n      return;\n    }\n\n    var height = Math.max(this.editor.getLayoutInfo().height / 4, 250);\n    var maxHeight = height + \"px\";\n    this.domNodes.element.style.maxHeight = maxHeight;\n    var wrapper = this.domNodes.element.getElementsByClassName('wrapper');\n\n    if (wrapper.length) {\n      wrapper[0].style.maxHeight = maxHeight;\n    }\n  };\n\n  ParameterHintsWidget.ID = 'editor.widget.parameterHintsWidget';\n  ParameterHintsWidget = __decorate([__param(1, IContextKeyService), __param(2, IOpenerService), __param(3, IModeService)], ParameterHintsWidget);\n  return ParameterHintsWidget;\n}(Disposable);\n\nexport { ParameterHintsWidget };\nregisterThemingParticipant(function (theme, collector) {\n  var border = theme.getColor(editorHoverBorder);\n\n  if (border) {\n    var borderWidth = theme.type === HIGH_CONTRAST ? 2 : 1;\n    collector.addRule(\".monaco-editor .parameter-hints-widget { border: \" + borderWidth + \"px solid \" + border + \"; }\");\n    collector.addRule(\".monaco-editor .parameter-hints-widget.multiple .body { border-left: 1px solid \" + border.transparent(0.5) + \"; }\");\n    collector.addRule(\".monaco-editor .parameter-hints-widget .signature.has-docs { border-bottom: 1px solid \" + border.transparent(0.5) + \"; }\");\n  }\n\n  var background = theme.getColor(editorHoverBackground);\n\n  if (background) {\n    collector.addRule(\".monaco-editor .parameter-hints-widget { background-color: \" + background + \"; }\");\n  }\n\n  var link = theme.getColor(textLinkForeground);\n\n  if (link) {\n    collector.addRule(\".monaco-editor .parameter-hints-widget a { color: \" + link + \"; }\");\n  }\n\n  var foreground = theme.getColor(editorHoverForeground);\n\n  if (foreground) {\n    collector.addRule(\".monaco-editor .parameter-hints-widget { color: \" + foreground + \"; }\");\n  }\n\n  var codeBackground = theme.getColor(textCodeBlockBackground);\n\n  if (codeBackground) {\n    collector.addRule(\".monaco-editor .parameter-hints-widget code { background-color: \" + codeBackground + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/parameterHints/parameterHintsWidget.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","dom","domEvent","stop","aria","DomScrollableElement","Event","Disposable","DisposableStore","IModeService","MarkdownRenderer","Context","nls","IContextKeyService","IOpenerService","editorHoverBackground","editorHoverBorder","textCodeBlockBackground","textLinkForeground","editorHoverForeground","HIGH_CONTRAST","registerThemingParticipant","ParameterHintsModel","pad","$","ParameterHintsWidget","_super","editor","contextKeyService","openerService","modeService","_this","call","renderDisposeables","_register","visible","announcedLabel","allowEditorOverflow","markdownRenderer","model","keyVisible","Visible","bindTo","keyMultipleSignatures","MultipleSignatures","onChangedHints","newParameterHints","show","render","hide","createParamaterHintDOMNodes","element","wrapper","append","tabIndex","controls","previous","overloads","next","onPreviousClick","onNextClick","body","scrollbar","appendChild","getDomNode","signature","docs","style","userSelect","domNodes","addContentWidget","onDidChangeCursorSelection","e","layoutContentWidget","updateFont","fontInfo","getOption","fontSize","chain","onDidChangeConfiguration","bind","filter","hasChanged","on","onDidLayoutChange","updateMaxHeight","set","setTimeout","addClass","reset","removeClass","getPosition","position","preference","hints","multiple","signatures","toggleClass","innerHTML","activeSignature","code","hasParameters","parameters","fontFamily","label","textContent","renderParameters","activeParameter","clear","documentation","renderedContents","add","undefined","hasDocs","toString","labelToAnnounce","getParameterLabel","alert","localize","scanDomNode","value","parent","currentParameter","_a","getParameterLabelOffsets","start","end","beforeSpan","document","createElement","substring","paramSpan","className","afterSpan","paramIdx","param","isArray","idx","lastIndexOf","focus","cancel","getId","ID","trigger","context","height","Math","max","getLayoutInfo","maxHeight","getElementsByClassName","theme","collector","border","getColor","borderWidth","type","addRule","transparent","background","link","foreground","codeBackground"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { domEvent, stop } from '../../../base/browser/event.js';\r\nimport * as aria from '../../../base/browser/ui/aria/aria.js';\r\nimport { DomScrollableElement } from '../../../base/browser/ui/scrollbar/scrollableElement.js';\r\nimport { Event } from '../../../base/common/event.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport './parameterHints.css';\r\nimport { IModeService } from '../../common/services/modeService.js';\r\nimport { MarkdownRenderer } from '../markdown/markdownRenderer.js';\r\nimport { Context } from './provideSignatureHelp.js';\r\nimport * as nls from '../../../nls.js';\r\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\r\nimport { editorHoverBackground, editorHoverBorder, textCodeBlockBackground, textLinkForeground, editorHoverForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { HIGH_CONTRAST, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { ParameterHintsModel } from './parameterHintsModel.js';\r\nimport { pad } from '../../../base/common/strings.js';\r\nvar $ = dom.$;\r\nvar ParameterHintsWidget = /** @class */ (function (_super) {\r\n    __extends(ParameterHintsWidget, _super);\r\n    function ParameterHintsWidget(editor, contextKeyService, openerService, modeService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.editor = editor;\r\n        _this.renderDisposeables = _this._register(new DisposableStore());\r\n        _this.visible = false;\r\n        _this.announcedLabel = null;\r\n        // Editor.IContentWidget.allowEditorOverflow\r\n        _this.allowEditorOverflow = true;\r\n        _this.markdownRenderer = _this._register(new MarkdownRenderer(editor, modeService, openerService));\r\n        _this.model = _this._register(new ParameterHintsModel(editor));\r\n        _this.keyVisible = Context.Visible.bindTo(contextKeyService);\r\n        _this.keyMultipleSignatures = Context.MultipleSignatures.bindTo(contextKeyService);\r\n        _this._register(_this.model.onChangedHints(function (newParameterHints) {\r\n            if (newParameterHints) {\r\n                _this.show();\r\n                _this.render(newParameterHints);\r\n            }\r\n            else {\r\n                _this.hide();\r\n            }\r\n        }));\r\n        return _this;\r\n    }\r\n    ParameterHintsWidget.prototype.createParamaterHintDOMNodes = function () {\r\n        var _this = this;\r\n        var element = $('.editor-widget.parameter-hints-widget');\r\n        var wrapper = dom.append(element, $('.wrapper'));\r\n        wrapper.tabIndex = -1;\r\n        var controls = dom.append(wrapper, $('.controls'));\r\n        var previous = dom.append(controls, $('.button.codicon.codicon-chevron-up'));\r\n        var overloads = dom.append(controls, $('.overloads'));\r\n        var next = dom.append(controls, $('.button.codicon.codicon-chevron-down'));\r\n        var onPreviousClick = stop(domEvent(previous, 'click'));\r\n        this._register(onPreviousClick(this.previous, this));\r\n        var onNextClick = stop(domEvent(next, 'click'));\r\n        this._register(onNextClick(this.next, this));\r\n        var body = $('.body');\r\n        var scrollbar = new DomScrollableElement(body, {});\r\n        this._register(scrollbar);\r\n        wrapper.appendChild(scrollbar.getDomNode());\r\n        var signature = dom.append(body, $('.signature'));\r\n        var docs = dom.append(body, $('.docs'));\r\n        element.style.userSelect = 'text';\r\n        this.domNodes = {\r\n            element: element,\r\n            signature: signature,\r\n            overloads: overloads,\r\n            docs: docs,\r\n            scrollbar: scrollbar,\r\n        };\r\n        this.editor.addContentWidget(this);\r\n        this.hide();\r\n        this._register(this.editor.onDidChangeCursorSelection(function (e) {\r\n            if (_this.visible) {\r\n                _this.editor.layoutContentWidget(_this);\r\n            }\r\n        }));\r\n        var updateFont = function () {\r\n            if (!_this.domNodes) {\r\n                return;\r\n            }\r\n            var fontInfo = _this.editor.getOption(34 /* fontInfo */);\r\n            _this.domNodes.element.style.fontSize = fontInfo.fontSize + \"px\";\r\n        };\r\n        updateFont();\r\n        this._register(Event.chain(this.editor.onDidChangeConfiguration.bind(this.editor))\r\n            .filter(function (e) { return e.hasChanged(34 /* fontInfo */); })\r\n            .on(updateFont, null));\r\n        this._register(this.editor.onDidLayoutChange(function (e) { return _this.updateMaxHeight(); }));\r\n        this.updateMaxHeight();\r\n    };\r\n    ParameterHintsWidget.prototype.show = function () {\r\n        var _this = this;\r\n        if (this.visible) {\r\n            return;\r\n        }\r\n        if (!this.domNodes) {\r\n            this.createParamaterHintDOMNodes();\r\n        }\r\n        this.keyVisible.set(true);\r\n        this.visible = true;\r\n        setTimeout(function () {\r\n            if (_this.domNodes) {\r\n                dom.addClass(_this.domNodes.element, 'visible');\r\n            }\r\n        }, 100);\r\n        this.editor.layoutContentWidget(this);\r\n    };\r\n    ParameterHintsWidget.prototype.hide = function () {\r\n        if (!this.visible) {\r\n            return;\r\n        }\r\n        this.keyVisible.reset();\r\n        this.visible = false;\r\n        this.announcedLabel = null;\r\n        if (this.domNodes) {\r\n            dom.removeClass(this.domNodes.element, 'visible');\r\n        }\r\n        this.editor.layoutContentWidget(this);\r\n    };\r\n    ParameterHintsWidget.prototype.getPosition = function () {\r\n        if (this.visible) {\r\n            return {\r\n                position: this.editor.getPosition(),\r\n                preference: [1 /* ABOVE */, 2 /* BELOW */]\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    ParameterHintsWidget.prototype.render = function (hints) {\r\n        if (!this.domNodes) {\r\n            return;\r\n        }\r\n        var multiple = hints.signatures.length > 1;\r\n        dom.toggleClass(this.domNodes.element, 'multiple', multiple);\r\n        this.keyMultipleSignatures.set(multiple);\r\n        this.domNodes.signature.innerHTML = '';\r\n        this.domNodes.docs.innerHTML = '';\r\n        var signature = hints.signatures[hints.activeSignature];\r\n        if (!signature) {\r\n            return;\r\n        }\r\n        var code = dom.append(this.domNodes.signature, $('.code'));\r\n        var hasParameters = signature.parameters.length > 0;\r\n        var fontInfo = this.editor.getOption(34 /* fontInfo */);\r\n        code.style.fontSize = fontInfo.fontSize + \"px\";\r\n        code.style.fontFamily = fontInfo.fontFamily;\r\n        if (!hasParameters) {\r\n            var label = dom.append(code, $('span'));\r\n            label.textContent = signature.label;\r\n        }\r\n        else {\r\n            this.renderParameters(code, signature, hints.activeParameter);\r\n        }\r\n        this.renderDisposeables.clear();\r\n        var activeParameter = signature.parameters[hints.activeParameter];\r\n        if (activeParameter && activeParameter.documentation) {\r\n            var documentation = $('span.documentation');\r\n            if (typeof activeParameter.documentation === 'string') {\r\n                documentation.textContent = activeParameter.documentation;\r\n            }\r\n            else {\r\n                var renderedContents = this.markdownRenderer.render(activeParameter.documentation);\r\n                dom.addClass(renderedContents.element, 'markdown-docs');\r\n                this.renderDisposeables.add(renderedContents);\r\n                documentation.appendChild(renderedContents.element);\r\n            }\r\n            dom.append(this.domNodes.docs, $('p', {}, documentation));\r\n        }\r\n        if (signature.documentation === undefined) { /** no op */ }\r\n        else if (typeof signature.documentation === 'string') {\r\n            dom.append(this.domNodes.docs, $('p', {}, signature.documentation));\r\n        }\r\n        else {\r\n            var renderedContents = this.markdownRenderer.render(signature.documentation);\r\n            dom.addClass(renderedContents.element, 'markdown-docs');\r\n            this.renderDisposeables.add(renderedContents);\r\n            dom.append(this.domNodes.docs, renderedContents.element);\r\n        }\r\n        var hasDocs = this.hasDocs(signature, activeParameter);\r\n        dom.toggleClass(this.domNodes.signature, 'has-docs', hasDocs);\r\n        dom.toggleClass(this.domNodes.docs, 'empty', !hasDocs);\r\n        this.domNodes.overloads.textContent =\r\n            pad(hints.activeSignature + 1, hints.signatures.length.toString().length) + '/' + hints.signatures.length;\r\n        if (activeParameter) {\r\n            var labelToAnnounce = this.getParameterLabel(signature, hints.activeParameter);\r\n            // Select method gets called on every user type while parameter hints are visible.\r\n            // We do not want to spam the user with same announcements, so we only announce if the current parameter changed.\r\n            if (this.announcedLabel !== labelToAnnounce) {\r\n                aria.alert(nls.localize('hint', \"{0}, hint\", labelToAnnounce));\r\n                this.announcedLabel = labelToAnnounce;\r\n            }\r\n        }\r\n        this.editor.layoutContentWidget(this);\r\n        this.domNodes.scrollbar.scanDomNode();\r\n    };\r\n    ParameterHintsWidget.prototype.hasDocs = function (signature, activeParameter) {\r\n        if (activeParameter && typeof (activeParameter.documentation) === 'string' && activeParameter.documentation.length > 0) {\r\n            return true;\r\n        }\r\n        if (activeParameter && typeof (activeParameter.documentation) === 'object' && activeParameter.documentation.value.length > 0) {\r\n            return true;\r\n        }\r\n        if (typeof (signature.documentation) === 'string' && signature.documentation.length > 0) {\r\n            return true;\r\n        }\r\n        if (typeof (signature.documentation) === 'object' && signature.documentation.value.length > 0) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    ParameterHintsWidget.prototype.renderParameters = function (parent, signature, currentParameter) {\r\n        var _a = this.getParameterLabelOffsets(signature, currentParameter), start = _a[0], end = _a[1];\r\n        var beforeSpan = document.createElement('span');\r\n        beforeSpan.textContent = signature.label.substring(0, start);\r\n        var paramSpan = document.createElement('span');\r\n        paramSpan.textContent = signature.label.substring(start, end);\r\n        paramSpan.className = 'parameter active';\r\n        var afterSpan = document.createElement('span');\r\n        afterSpan.textContent = signature.label.substring(end);\r\n        dom.append(parent, beforeSpan, paramSpan, afterSpan);\r\n    };\r\n    ParameterHintsWidget.prototype.getParameterLabel = function (signature, paramIdx) {\r\n        var param = signature.parameters[paramIdx];\r\n        if (typeof param.label === 'string') {\r\n            return param.label;\r\n        }\r\n        else {\r\n            return signature.label.substring(param.label[0], param.label[1]);\r\n        }\r\n    };\r\n    ParameterHintsWidget.prototype.getParameterLabelOffsets = function (signature, paramIdx) {\r\n        var param = signature.parameters[paramIdx];\r\n        if (!param) {\r\n            return [0, 0];\r\n        }\r\n        else if (Array.isArray(param.label)) {\r\n            return param.label;\r\n        }\r\n        else {\r\n            var idx = signature.label.lastIndexOf(param.label);\r\n            return idx >= 0\r\n                ? [idx, idx + param.label.length]\r\n                : [0, 0];\r\n        }\r\n    };\r\n    ParameterHintsWidget.prototype.next = function () {\r\n        this.editor.focus();\r\n        this.model.next();\r\n    };\r\n    ParameterHintsWidget.prototype.previous = function () {\r\n        this.editor.focus();\r\n        this.model.previous();\r\n    };\r\n    ParameterHintsWidget.prototype.cancel = function () {\r\n        this.model.cancel();\r\n    };\r\n    ParameterHintsWidget.prototype.getDomNode = function () {\r\n        if (!this.domNodes) {\r\n            this.createParamaterHintDOMNodes();\r\n        }\r\n        return this.domNodes.element;\r\n    };\r\n    ParameterHintsWidget.prototype.getId = function () {\r\n        return ParameterHintsWidget.ID;\r\n    };\r\n    ParameterHintsWidget.prototype.trigger = function (context) {\r\n        this.model.trigger(context, 0);\r\n    };\r\n    ParameterHintsWidget.prototype.updateMaxHeight = function () {\r\n        if (!this.domNodes) {\r\n            return;\r\n        }\r\n        var height = Math.max(this.editor.getLayoutInfo().height / 4, 250);\r\n        var maxHeight = height + \"px\";\r\n        this.domNodes.element.style.maxHeight = maxHeight;\r\n        var wrapper = this.domNodes.element.getElementsByClassName('wrapper');\r\n        if (wrapper.length) {\r\n            wrapper[0].style.maxHeight = maxHeight;\r\n        }\r\n    };\r\n    ParameterHintsWidget.ID = 'editor.widget.parameterHintsWidget';\r\n    ParameterHintsWidget = __decorate([\r\n        __param(1, IContextKeyService),\r\n        __param(2, IOpenerService),\r\n        __param(3, IModeService)\r\n    ], ParameterHintsWidget);\r\n    return ParameterHintsWidget;\r\n}(Disposable));\r\nexport { ParameterHintsWidget };\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var border = theme.getColor(editorHoverBorder);\r\n    if (border) {\r\n        var borderWidth = theme.type === HIGH_CONTRAST ? 2 : 1;\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget { border: \" + borderWidth + \"px solid \" + border + \"; }\");\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget.multiple .body { border-left: 1px solid \" + border.transparent(0.5) + \"; }\");\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget .signature.has-docs { border-bottom: 1px solid \" + border.transparent(0.5) + \"; }\");\r\n    }\r\n    var background = theme.getColor(editorHoverBackground);\r\n    if (background) {\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget { background-color: \" + background + \"; }\");\r\n    }\r\n    var link = theme.getColor(textLinkForeground);\r\n    if (link) {\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget a { color: \" + link + \"; }\");\r\n    }\r\n    var foreground = theme.getColor(editorHoverForeground);\r\n    if (foreground) {\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget { color: \" + foreground + \"; }\");\r\n    }\r\n    var codeBackground = theme.getColor(textCodeBlockBackground);\r\n    if (codeBackground) {\r\n        collector.addRule(\".monaco-editor .parameter-hints-widget code { background-color: \" + codeBackground + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}