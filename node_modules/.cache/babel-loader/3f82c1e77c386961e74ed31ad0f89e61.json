{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from '../../../../base/browser/dom.js';\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport { Configuration } from '../../config/configuration.js';\nimport { TextEditorCursorStyle } from '../../../common/config/editorOptions.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\n\nvar ViewCursorRenderData =\n/** @class */\nfunction () {\n  function ViewCursorRenderData(top, left, width, height, textContent, textContentClassName) {\n    this.top = top;\n    this.left = left;\n    this.width = width;\n    this.height = height;\n    this.textContent = textContent;\n    this.textContentClassName = textContentClassName;\n  }\n\n  return ViewCursorRenderData;\n}();\n\nvar ViewCursor =\n/** @class */\nfunction () {\n  function ViewCursor(context) {\n    this._context = context;\n    var options = this._context.configuration.options;\n    var fontInfo = options.get(34\n    /* fontInfo */\n    );\n    this._cursorStyle = options.get(18\n    /* cursorStyle */\n    );\n    this._lineHeight = options.get(49\n    /* lineHeight */\n    );\n    this._typicalHalfwidthCharacterWidth = fontInfo.typicalHalfwidthCharacterWidth;\n    this._lineCursorWidth = Math.min(options.get(21\n    /* cursorWidth */\n    ), this._typicalHalfwidthCharacterWidth);\n    this._isVisible = true; // Create the dom node\n\n    this._domNode = createFastDomNode(document.createElement('div'));\n\n    this._domNode.setClassName('cursor');\n\n    this._domNode.setHeight(this._lineHeight);\n\n    this._domNode.setTop(0);\n\n    this._domNode.setLeft(0);\n\n    Configuration.applyFontInfo(this._domNode, fontInfo);\n\n    this._domNode.setDisplay('none');\n\n    this._position = new Position(1, 1);\n    this._lastRenderedContent = '';\n    this._renderData = null;\n  }\n\n  ViewCursor.prototype.getDomNode = function () {\n    return this._domNode;\n  };\n\n  ViewCursor.prototype.getPosition = function () {\n    return this._position;\n  };\n\n  ViewCursor.prototype.show = function () {\n    if (!this._isVisible) {\n      this._domNode.setVisibility('inherit');\n\n      this._isVisible = true;\n    }\n  };\n\n  ViewCursor.prototype.hide = function () {\n    if (this._isVisible) {\n      this._domNode.setVisibility('hidden');\n\n      this._isVisible = false;\n    }\n  };\n\n  ViewCursor.prototype.onConfigurationChanged = function (e) {\n    var options = this._context.configuration.options;\n    var fontInfo = options.get(34\n    /* fontInfo */\n    );\n    this._cursorStyle = options.get(18\n    /* cursorStyle */\n    );\n    this._lineHeight = options.get(49\n    /* lineHeight */\n    );\n    this._typicalHalfwidthCharacterWidth = fontInfo.typicalHalfwidthCharacterWidth;\n    this._lineCursorWidth = Math.min(options.get(21\n    /* cursorWidth */\n    ), this._typicalHalfwidthCharacterWidth);\n    Configuration.applyFontInfo(this._domNode, fontInfo);\n    return true;\n  };\n\n  ViewCursor.prototype.onCursorPositionChanged = function (position) {\n    this._position = position;\n    return true;\n  };\n\n  ViewCursor.prototype._prepareRender = function (ctx) {\n    var textContent = '';\n\n    if (this._cursorStyle === TextEditorCursorStyle.Line || this._cursorStyle === TextEditorCursorStyle.LineThin) {\n      var visibleRange = ctx.visibleRangeForPosition(this._position);\n\n      if (!visibleRange || visibleRange.outsideRenderedLine) {\n        // Outside viewport\n        return null;\n      }\n\n      var width_1;\n\n      if (this._cursorStyle === TextEditorCursorStyle.Line) {\n        width_1 = dom.computeScreenAwareSize(this._lineCursorWidth > 0 ? this._lineCursorWidth : 2);\n\n        if (width_1 > 2) {\n          var lineContent_1 = this._context.model.getLineContent(this._position.lineNumber);\n\n          var nextCharLength_1 = strings.nextCharLength(lineContent_1, this._position.column - 1);\n          textContent = lineContent_1.substr(this._position.column - 1, nextCharLength_1);\n        }\n      } else {\n        width_1 = dom.computeScreenAwareSize(1);\n      }\n\n      var left = visibleRange.left;\n\n      if (width_1 >= 2 && left >= 1) {\n        // try to center cursor\n        left -= 1;\n      }\n\n      var top_1 = ctx.getVerticalOffsetForLineNumber(this._position.lineNumber) - ctx.bigNumbersDelta;\n      return new ViewCursorRenderData(top_1, left, width_1, this._lineHeight, textContent, '');\n    }\n\n    var lineContent = this._context.model.getLineContent(this._position.lineNumber);\n\n    var nextCharLength = strings.nextCharLength(lineContent, this._position.column - 1);\n    var visibleRangeForCharacter = ctx.linesVisibleRangesForRange(new Range(this._position.lineNumber, this._position.column, this._position.lineNumber, this._position.column + nextCharLength), false);\n\n    if (!visibleRangeForCharacter || visibleRangeForCharacter.length === 0) {\n      // Outside viewport\n      return null;\n    }\n\n    var firstVisibleRangeForCharacter = visibleRangeForCharacter[0];\n\n    if (firstVisibleRangeForCharacter.outsideRenderedLine || firstVisibleRangeForCharacter.ranges.length === 0) {\n      // Outside viewport\n      return null;\n    }\n\n    var range = firstVisibleRangeForCharacter.ranges[0];\n    var width = range.width < 1 ? this._typicalHalfwidthCharacterWidth : range.width;\n    var textContentClassName = '';\n\n    if (this._cursorStyle === TextEditorCursorStyle.Block) {\n      var lineData = this._context.model.getViewLineData(this._position.lineNumber);\n\n      textContent = lineContent.substr(this._position.column - 1, nextCharLength);\n      var tokenIndex = lineData.tokens.findTokenIndexAtOffset(this._position.column - 1);\n      textContentClassName = lineData.tokens.getClassName(tokenIndex);\n    }\n\n    var top = ctx.getVerticalOffsetForLineNumber(this._position.lineNumber) - ctx.bigNumbersDelta;\n    var height = this._lineHeight; // Underline might interfere with clicking\n\n    if (this._cursorStyle === TextEditorCursorStyle.Underline || this._cursorStyle === TextEditorCursorStyle.UnderlineThin) {\n      top += this._lineHeight - 2;\n      height = 2;\n    }\n\n    return new ViewCursorRenderData(top, range.left, width, height, textContent, textContentClassName);\n  };\n\n  ViewCursor.prototype.prepareRender = function (ctx) {\n    this._renderData = this._prepareRender(ctx);\n  };\n\n  ViewCursor.prototype.render = function (ctx) {\n    if (!this._renderData) {\n      this._domNode.setDisplay('none');\n\n      return null;\n    }\n\n    if (this._lastRenderedContent !== this._renderData.textContent) {\n      this._lastRenderedContent = this._renderData.textContent;\n      this._domNode.domNode.textContent = this._lastRenderedContent;\n    }\n\n    this._domNode.setClassName('cursor ' + this._renderData.textContentClassName);\n\n    this._domNode.setDisplay('block');\n\n    this._domNode.setTop(this._renderData.top);\n\n    this._domNode.setLeft(this._renderData.left);\n\n    this._domNode.setWidth(this._renderData.width);\n\n    this._domNode.setLineHeight(this._renderData.height);\n\n    this._domNode.setHeight(this._renderData.height);\n\n    return {\n      domNode: this._domNode.domNode,\n      position: this._position,\n      contentLeft: this._renderData.left,\n      height: this._renderData.height,\n      width: 2\n    };\n  };\n\n  return ViewCursor;\n}();\n\nexport { ViewCursor };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/viewParts/viewCursors/viewCursor.js"],"names":["dom","createFastDomNode","strings","Configuration","TextEditorCursorStyle","Position","Range","ViewCursorRenderData","top","left","width","height","textContent","textContentClassName","ViewCursor","context","_context","options","configuration","fontInfo","get","_cursorStyle","_lineHeight","_typicalHalfwidthCharacterWidth","typicalHalfwidthCharacterWidth","_lineCursorWidth","Math","min","_isVisible","_domNode","document","createElement","setClassName","setHeight","setTop","setLeft","applyFontInfo","setDisplay","_position","_lastRenderedContent","_renderData","prototype","getDomNode","getPosition","show","setVisibility","hide","onConfigurationChanged","e","onCursorPositionChanged","position","_prepareRender","ctx","Line","LineThin","visibleRange","visibleRangeForPosition","outsideRenderedLine","width_1","computeScreenAwareSize","lineContent_1","model","getLineContent","lineNumber","nextCharLength_1","nextCharLength","column","substr","top_1","getVerticalOffsetForLineNumber","bigNumbersDelta","lineContent","visibleRangeForCharacter","linesVisibleRangesForRange","length","firstVisibleRangeForCharacter","ranges","range","Block","lineData","getViewLineData","tokenIndex","tokens","findTokenIndexAtOffset","getClassName","Underline","UnderlineThin","prepareRender","render","domNode","setWidth","setLineHeight","contentLeft"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as dom from '../../../../base/browser/dom.js';\r\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\r\nimport * as strings from '../../../../base/common/strings.js';\r\nimport { Configuration } from '../../config/configuration.js';\r\nimport { TextEditorCursorStyle } from '../../../common/config/editorOptions.js';\r\nimport { Position } from '../../../common/core/position.js';\r\nimport { Range } from '../../../common/core/range.js';\r\nvar ViewCursorRenderData = /** @class */ (function () {\r\n    function ViewCursorRenderData(top, left, width, height, textContent, textContentClassName) {\r\n        this.top = top;\r\n        this.left = left;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.textContent = textContent;\r\n        this.textContentClassName = textContentClassName;\r\n    }\r\n    return ViewCursorRenderData;\r\n}());\r\nvar ViewCursor = /** @class */ (function () {\r\n    function ViewCursor(context) {\r\n        this._context = context;\r\n        var options = this._context.configuration.options;\r\n        var fontInfo = options.get(34 /* fontInfo */);\r\n        this._cursorStyle = options.get(18 /* cursorStyle */);\r\n        this._lineHeight = options.get(49 /* lineHeight */);\r\n        this._typicalHalfwidthCharacterWidth = fontInfo.typicalHalfwidthCharacterWidth;\r\n        this._lineCursorWidth = Math.min(options.get(21 /* cursorWidth */), this._typicalHalfwidthCharacterWidth);\r\n        this._isVisible = true;\r\n        // Create the dom node\r\n        this._domNode = createFastDomNode(document.createElement('div'));\r\n        this._domNode.setClassName('cursor');\r\n        this._domNode.setHeight(this._lineHeight);\r\n        this._domNode.setTop(0);\r\n        this._domNode.setLeft(0);\r\n        Configuration.applyFontInfo(this._domNode, fontInfo);\r\n        this._domNode.setDisplay('none');\r\n        this._position = new Position(1, 1);\r\n        this._lastRenderedContent = '';\r\n        this._renderData = null;\r\n    }\r\n    ViewCursor.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    ViewCursor.prototype.getPosition = function () {\r\n        return this._position;\r\n    };\r\n    ViewCursor.prototype.show = function () {\r\n        if (!this._isVisible) {\r\n            this._domNode.setVisibility('inherit');\r\n            this._isVisible = true;\r\n        }\r\n    };\r\n    ViewCursor.prototype.hide = function () {\r\n        if (this._isVisible) {\r\n            this._domNode.setVisibility('hidden');\r\n            this._isVisible = false;\r\n        }\r\n    };\r\n    ViewCursor.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._context.configuration.options;\r\n        var fontInfo = options.get(34 /* fontInfo */);\r\n        this._cursorStyle = options.get(18 /* cursorStyle */);\r\n        this._lineHeight = options.get(49 /* lineHeight */);\r\n        this._typicalHalfwidthCharacterWidth = fontInfo.typicalHalfwidthCharacterWidth;\r\n        this._lineCursorWidth = Math.min(options.get(21 /* cursorWidth */), this._typicalHalfwidthCharacterWidth);\r\n        Configuration.applyFontInfo(this._domNode, fontInfo);\r\n        return true;\r\n    };\r\n    ViewCursor.prototype.onCursorPositionChanged = function (position) {\r\n        this._position = position;\r\n        return true;\r\n    };\r\n    ViewCursor.prototype._prepareRender = function (ctx) {\r\n        var textContent = '';\r\n        if (this._cursorStyle === TextEditorCursorStyle.Line || this._cursorStyle === TextEditorCursorStyle.LineThin) {\r\n            var visibleRange = ctx.visibleRangeForPosition(this._position);\r\n            if (!visibleRange || visibleRange.outsideRenderedLine) {\r\n                // Outside viewport\r\n                return null;\r\n            }\r\n            var width_1;\r\n            if (this._cursorStyle === TextEditorCursorStyle.Line) {\r\n                width_1 = dom.computeScreenAwareSize(this._lineCursorWidth > 0 ? this._lineCursorWidth : 2);\r\n                if (width_1 > 2) {\r\n                    var lineContent_1 = this._context.model.getLineContent(this._position.lineNumber);\r\n                    var nextCharLength_1 = strings.nextCharLength(lineContent_1, this._position.column - 1);\r\n                    textContent = lineContent_1.substr(this._position.column - 1, nextCharLength_1);\r\n                }\r\n            }\r\n            else {\r\n                width_1 = dom.computeScreenAwareSize(1);\r\n            }\r\n            var left = visibleRange.left;\r\n            if (width_1 >= 2 && left >= 1) {\r\n                // try to center cursor\r\n                left -= 1;\r\n            }\r\n            var top_1 = ctx.getVerticalOffsetForLineNumber(this._position.lineNumber) - ctx.bigNumbersDelta;\r\n            return new ViewCursorRenderData(top_1, left, width_1, this._lineHeight, textContent, '');\r\n        }\r\n        var lineContent = this._context.model.getLineContent(this._position.lineNumber);\r\n        var nextCharLength = strings.nextCharLength(lineContent, this._position.column - 1);\r\n        var visibleRangeForCharacter = ctx.linesVisibleRangesForRange(new Range(this._position.lineNumber, this._position.column, this._position.lineNumber, this._position.column + nextCharLength), false);\r\n        if (!visibleRangeForCharacter || visibleRangeForCharacter.length === 0) {\r\n            // Outside viewport\r\n            return null;\r\n        }\r\n        var firstVisibleRangeForCharacter = visibleRangeForCharacter[0];\r\n        if (firstVisibleRangeForCharacter.outsideRenderedLine || firstVisibleRangeForCharacter.ranges.length === 0) {\r\n            // Outside viewport\r\n            return null;\r\n        }\r\n        var range = firstVisibleRangeForCharacter.ranges[0];\r\n        var width = range.width < 1 ? this._typicalHalfwidthCharacterWidth : range.width;\r\n        var textContentClassName = '';\r\n        if (this._cursorStyle === TextEditorCursorStyle.Block) {\r\n            var lineData = this._context.model.getViewLineData(this._position.lineNumber);\r\n            textContent = lineContent.substr(this._position.column - 1, nextCharLength);\r\n            var tokenIndex = lineData.tokens.findTokenIndexAtOffset(this._position.column - 1);\r\n            textContentClassName = lineData.tokens.getClassName(tokenIndex);\r\n        }\r\n        var top = ctx.getVerticalOffsetForLineNumber(this._position.lineNumber) - ctx.bigNumbersDelta;\r\n        var height = this._lineHeight;\r\n        // Underline might interfere with clicking\r\n        if (this._cursorStyle === TextEditorCursorStyle.Underline || this._cursorStyle === TextEditorCursorStyle.UnderlineThin) {\r\n            top += this._lineHeight - 2;\r\n            height = 2;\r\n        }\r\n        return new ViewCursorRenderData(top, range.left, width, height, textContent, textContentClassName);\r\n    };\r\n    ViewCursor.prototype.prepareRender = function (ctx) {\r\n        this._renderData = this._prepareRender(ctx);\r\n    };\r\n    ViewCursor.prototype.render = function (ctx) {\r\n        if (!this._renderData) {\r\n            this._domNode.setDisplay('none');\r\n            return null;\r\n        }\r\n        if (this._lastRenderedContent !== this._renderData.textContent) {\r\n            this._lastRenderedContent = this._renderData.textContent;\r\n            this._domNode.domNode.textContent = this._lastRenderedContent;\r\n        }\r\n        this._domNode.setClassName('cursor ' + this._renderData.textContentClassName);\r\n        this._domNode.setDisplay('block');\r\n        this._domNode.setTop(this._renderData.top);\r\n        this._domNode.setLeft(this._renderData.left);\r\n        this._domNode.setWidth(this._renderData.width);\r\n        this._domNode.setLineHeight(this._renderData.height);\r\n        this._domNode.setHeight(this._renderData.height);\r\n        return {\r\n            domNode: this._domNode.domNode,\r\n            position: this._position,\r\n            contentLeft: this._renderData.left,\r\n            height: this._renderData.height,\r\n            width: 2\r\n        };\r\n    };\r\n    return ViewCursor;\r\n}());\r\nexport { ViewCursor };\r\n"]},"metadata":{},"sourceType":"module"}