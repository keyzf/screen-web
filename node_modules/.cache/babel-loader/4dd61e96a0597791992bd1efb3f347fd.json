{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { LRUCache, TernarySearchTree } from '../../../base/common/map.js';\nimport { IStorageService, WillSaveStateReason } from '../../../platform/storage/common/storage.js';\nimport { completionKindFromString } from '../../common/modes.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { RunOnceScheduler } from '../../../base/common/async.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\n\nvar Memory =\n/** @class */\nfunction () {\n  function Memory() {}\n\n  Memory.prototype.select = function (model, pos, items) {\n    if (items.length === 0) {\n      return 0;\n    }\n\n    var topScore = items[0].score[0];\n\n    for (var i = 1; i < items.length; i++) {\n      var _a = items[i],\n          score = _a.score,\n          suggestion = _a.completion;\n\n      if (score[0] !== topScore) {\n        // stop when leaving the group of top matches\n        break;\n      }\n\n      if (suggestion.preselect) {\n        // stop when seeing an auto-select-item\n        return i;\n      }\n    }\n\n    return 0;\n  };\n\n  return Memory;\n}();\n\nexport { Memory };\n\nvar NoMemory =\n/** @class */\nfunction (_super) {\n  __extends(NoMemory, _super);\n\n  function NoMemory() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  NoMemory.prototype.memorize = function (model, pos, item) {// no-op\n  };\n\n  NoMemory.prototype.toJSON = function () {\n    return undefined;\n  };\n\n  NoMemory.prototype.fromJSON = function () {//\n  };\n\n  return NoMemory;\n}(Memory);\n\nexport { NoMemory };\n\nvar LRUMemory =\n/** @class */\nfunction (_super) {\n  __extends(LRUMemory, _super);\n\n  function LRUMemory() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this._cache = new LRUCache(300, 0.66);\n    _this._seq = 0;\n    return _this;\n  }\n\n  LRUMemory.prototype.memorize = function (model, pos, item) {\n    var label = item.completion.label;\n    var key = model.getLanguageIdentifier().language + \"/\" + label;\n\n    this._cache.set(key, {\n      touch: this._seq++,\n      type: item.completion.kind,\n      insertText: item.completion.insertText\n    });\n  };\n\n  LRUMemory.prototype.select = function (model, pos, items) {\n    if (items.length === 0) {\n      return 0;\n    }\n\n    var lineSuffix = model.getLineContent(pos.lineNumber).substr(pos.column - 10, pos.column - 1);\n\n    if (/\\s$/.test(lineSuffix)) {\n      return _super.prototype.select.call(this, model, pos, items);\n    }\n\n    var topScore = items[0].score[0];\n    var indexPreselect = -1;\n    var indexRecency = -1;\n    var seq = -1;\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].score[0] !== topScore) {\n        // consider only top items\n        break;\n      }\n\n      var key = model.getLanguageIdentifier().language + \"/\" + items[i].completion.label;\n\n      var item = this._cache.peek(key);\n\n      if (item && item.touch > seq && item.type === items[i].completion.kind && item.insertText === items[i].completion.insertText) {\n        seq = item.touch;\n        indexRecency = i;\n      }\n\n      if (items[i].completion.preselect && indexPreselect === -1) {\n        // stop when seeing an auto-select-item\n        return indexPreselect = i;\n      }\n    }\n\n    if (indexRecency !== -1) {\n      return indexRecency;\n    } else if (indexPreselect !== -1) {\n      return indexPreselect;\n    } else {\n      return 0;\n    }\n  };\n\n  LRUMemory.prototype.toJSON = function () {\n    var data = [];\n\n    this._cache.forEach(function (value, key) {\n      data.push([key, value]);\n    });\n\n    return data;\n  };\n\n  LRUMemory.prototype.fromJSON = function (data) {\n    this._cache.clear();\n\n    var seq = 0;\n\n    for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {\n      var _a = data_1[_i],\n          key = _a[0],\n          value = _a[1];\n      value.touch = seq;\n      value.type = typeof value.type === 'number' ? value.type : completionKindFromString(value.type);\n\n      this._cache.set(key, value);\n    }\n\n    this._seq = this._cache.size;\n  };\n\n  return LRUMemory;\n}(Memory);\n\nexport { LRUMemory };\n\nvar PrefixMemory =\n/** @class */\nfunction (_super) {\n  __extends(PrefixMemory, _super);\n\n  function PrefixMemory() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this._trie = TernarySearchTree.forStrings();\n    _this._seq = 0;\n    return _this;\n  }\n\n  PrefixMemory.prototype.memorize = function (model, pos, item) {\n    var word = model.getWordUntilPosition(pos).word;\n    var key = model.getLanguageIdentifier().language + \"/\" + word;\n\n    this._trie.set(key, {\n      type: item.completion.kind,\n      insertText: item.completion.insertText,\n      touch: this._seq++\n    });\n  };\n\n  PrefixMemory.prototype.select = function (model, pos, items) {\n    var word = model.getWordUntilPosition(pos).word;\n\n    if (!word) {\n      return _super.prototype.select.call(this, model, pos, items);\n    }\n\n    var key = model.getLanguageIdentifier().language + \"/\" + word;\n\n    var item = this._trie.get(key);\n\n    if (!item) {\n      item = this._trie.findSubstr(key);\n    }\n\n    if (item) {\n      for (var i = 0; i < items.length; i++) {\n        var _a = items[i].completion,\n            kind = _a.kind,\n            insertText = _a.insertText;\n\n        if (kind === item.type && insertText === item.insertText) {\n          return i;\n        }\n      }\n    }\n\n    return _super.prototype.select.call(this, model, pos, items);\n  };\n\n  PrefixMemory.prototype.toJSON = function () {\n    var entries = [];\n\n    this._trie.forEach(function (value, key) {\n      return entries.push([key, value]);\n    }); // sort by last recently used (touch), then\n    // take the top 200 item and normalize their\n    // touch\n\n\n    entries.sort(function (a, b) {\n      return -(a[1].touch - b[1].touch);\n    }).forEach(function (value, i) {\n      return value[1].touch = i;\n    });\n    return entries.slice(0, 200);\n  };\n\n  PrefixMemory.prototype.fromJSON = function (data) {\n    this._trie.clear();\n\n    if (data.length > 0) {\n      this._seq = data[0][1].touch + 1;\n\n      for (var _i = 0, data_2 = data; _i < data_2.length; _i++) {\n        var _a = data_2[_i],\n            key = _a[0],\n            value = _a[1];\n        value.type = typeof value.type === 'number' ? value.type : completionKindFromString(value.type);\n\n        this._trie.set(key, value);\n      }\n    }\n  };\n\n  return PrefixMemory;\n}(Memory);\n\nexport { PrefixMemory };\n\nvar SuggestMemoryService =\n/** @class */\nfunction (_super) {\n  __extends(SuggestMemoryService, _super);\n\n  function SuggestMemoryService(_storageService, _configService) {\n    var _this = _super.call(this) || this;\n\n    _this._storageService = _storageService;\n    _this._configService = _configService;\n    _this._storagePrefix = 'suggest/memories';\n\n    var update = function () {\n      var mode = _this._configService.getValue('editor.suggestSelection');\n\n      var share = _this._configService.getValue('editor.suggest.shareSuggestSelections');\n\n      _this._update(mode, share, false);\n    };\n\n    _this._persistSoon = _this._register(new RunOnceScheduler(function () {\n      return _this._saveState();\n    }, 500));\n\n    _this._register(_storageService.onWillSaveState(function (e) {\n      if (e.reason === WillSaveStateReason.SHUTDOWN) {\n        _this._saveState();\n      }\n    }));\n\n    _this._register(_this._configService.onDidChangeConfiguration(function (e) {\n      if (e.affectsConfiguration('editor.suggestSelection') || e.affectsConfiguration('editor.suggest.shareSuggestSelections')) {\n        update();\n      }\n    }));\n\n    _this._register(_this._storageService.onDidChangeStorage(function (e) {\n      if (e.scope === 0\n      /* GLOBAL */\n      && e.key.indexOf(_this._storagePrefix) === 0) {\n        if (!document.hasFocus()) {\n          // windows that aren't focused have to drop their current\n          // storage value and accept what's stored now\n          _this._update(_this._mode, _this._shareMem, true);\n        }\n      }\n    }));\n\n    update();\n    return _this;\n  }\n\n  SuggestMemoryService.prototype._update = function (mode, shareMem, force) {\n    if (!force && this._mode === mode && this._shareMem === shareMem) {\n      return;\n    }\n\n    this._shareMem = shareMem;\n    this._mode = mode;\n    this._strategy = mode === 'recentlyUsedByPrefix' ? new PrefixMemory() : mode === 'recentlyUsed' ? new LRUMemory() : new NoMemory();\n\n    try {\n      var scope = shareMem ? 0\n      /* GLOBAL */\n      : 1\n      /* WORKSPACE */\n      ;\n\n      var raw = this._storageService.get(this._storagePrefix + \"/\" + this._mode, scope);\n\n      if (raw) {\n        this._strategy.fromJSON(JSON.parse(raw));\n      }\n    } catch (e) {// things can go wrong with JSON...\n    }\n  };\n\n  SuggestMemoryService.prototype.memorize = function (model, pos, item) {\n    this._strategy.memorize(model, pos, item);\n\n    this._persistSoon.schedule();\n  };\n\n  SuggestMemoryService.prototype.select = function (model, pos, items) {\n    return this._strategy.select(model, pos, items);\n  };\n\n  SuggestMemoryService.prototype._saveState = function () {\n    var raw = JSON.stringify(this._strategy);\n    var scope = this._shareMem ? 0\n    /* GLOBAL */\n    : 1\n    /* WORKSPACE */\n    ;\n\n    this._storageService.store(this._storagePrefix + \"/\" + this._mode, raw, scope);\n  };\n\n  SuggestMemoryService = __decorate([__param(0, IStorageService), __param(1, IConfigurationService)], SuggestMemoryService);\n  return SuggestMemoryService;\n}(Disposable);\n\nexport { SuggestMemoryService };\nexport var ISuggestMemoryService = createDecorator('ISuggestMemories');\nregisterSingleton(ISuggestMemoryService, SuggestMemoryService, true);","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestMemory.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","LRUCache","TernarySearchTree","IStorageService","WillSaveStateReason","completionKindFromString","Disposable","RunOnceScheduler","createDecorator","IConfigurationService","registerSingleton","Memory","select","model","pos","items","topScore","score","_a","suggestion","completion","preselect","NoMemory","_super","apply","memorize","item","toJSON","undefined","fromJSON","LRUMemory","_this","_cache","_seq","label","getLanguageIdentifier","language","set","touch","type","kind","insertText","lineSuffix","getLineContent","lineNumber","substr","column","test","call","indexPreselect","indexRecency","seq","peek","data","forEach","value","push","clear","_i","data_1","size","PrefixMemory","_trie","forStrings","word","getWordUntilPosition","get","findSubstr","entries","sort","a","slice","data_2","SuggestMemoryService","_storageService","_configService","_storagePrefix","update","mode","getValue","share","_update","_persistSoon","_register","_saveState","onWillSaveState","e","reason","SHUTDOWN","onDidChangeConfiguration","affectsConfiguration","onDidChangeStorage","scope","indexOf","document","hasFocus","_mode","_shareMem","shareMem","force","_strategy","raw","JSON","parse","schedule","stringify","store","ISuggestMemoryService"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { LRUCache, TernarySearchTree } from '../../../base/common/map.js';\r\nimport { IStorageService, WillSaveStateReason } from '../../../platform/storage/common/storage.js';\r\nimport { completionKindFromString } from '../../common/modes.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { RunOnceScheduler } from '../../../base/common/async.js';\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\r\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\r\nvar Memory = /** @class */ (function () {\r\n    function Memory() {\r\n    }\r\n    Memory.prototype.select = function (model, pos, items) {\r\n        if (items.length === 0) {\r\n            return 0;\r\n        }\r\n        var topScore = items[0].score[0];\r\n        for (var i = 1; i < items.length; i++) {\r\n            var _a = items[i], score = _a.score, suggestion = _a.completion;\r\n            if (score[0] !== topScore) {\r\n                // stop when leaving the group of top matches\r\n                break;\r\n            }\r\n            if (suggestion.preselect) {\r\n                // stop when seeing an auto-select-item\r\n                return i;\r\n            }\r\n        }\r\n        return 0;\r\n    };\r\n    return Memory;\r\n}());\r\nexport { Memory };\r\nvar NoMemory = /** @class */ (function (_super) {\r\n    __extends(NoMemory, _super);\r\n    function NoMemory() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    NoMemory.prototype.memorize = function (model, pos, item) {\r\n        // no-op\r\n    };\r\n    NoMemory.prototype.toJSON = function () {\r\n        return undefined;\r\n    };\r\n    NoMemory.prototype.fromJSON = function () {\r\n        //\r\n    };\r\n    return NoMemory;\r\n}(Memory));\r\nexport { NoMemory };\r\nvar LRUMemory = /** @class */ (function (_super) {\r\n    __extends(LRUMemory, _super);\r\n    function LRUMemory() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this._cache = new LRUCache(300, 0.66);\r\n        _this._seq = 0;\r\n        return _this;\r\n    }\r\n    LRUMemory.prototype.memorize = function (model, pos, item) {\r\n        var label = item.completion.label;\r\n        var key = model.getLanguageIdentifier().language + \"/\" + label;\r\n        this._cache.set(key, {\r\n            touch: this._seq++,\r\n            type: item.completion.kind,\r\n            insertText: item.completion.insertText\r\n        });\r\n    };\r\n    LRUMemory.prototype.select = function (model, pos, items) {\r\n        if (items.length === 0) {\r\n            return 0;\r\n        }\r\n        var lineSuffix = model.getLineContent(pos.lineNumber).substr(pos.column - 10, pos.column - 1);\r\n        if (/\\s$/.test(lineSuffix)) {\r\n            return _super.prototype.select.call(this, model, pos, items);\r\n        }\r\n        var topScore = items[0].score[0];\r\n        var indexPreselect = -1;\r\n        var indexRecency = -1;\r\n        var seq = -1;\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (items[i].score[0] !== topScore) {\r\n                // consider only top items\r\n                break;\r\n            }\r\n            var key = model.getLanguageIdentifier().language + \"/\" + items[i].completion.label;\r\n            var item = this._cache.peek(key);\r\n            if (item && item.touch > seq && item.type === items[i].completion.kind && item.insertText === items[i].completion.insertText) {\r\n                seq = item.touch;\r\n                indexRecency = i;\r\n            }\r\n            if (items[i].completion.preselect && indexPreselect === -1) {\r\n                // stop when seeing an auto-select-item\r\n                return indexPreselect = i;\r\n            }\r\n        }\r\n        if (indexRecency !== -1) {\r\n            return indexRecency;\r\n        }\r\n        else if (indexPreselect !== -1) {\r\n            return indexPreselect;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    };\r\n    LRUMemory.prototype.toJSON = function () {\r\n        var data = [];\r\n        this._cache.forEach(function (value, key) {\r\n            data.push([key, value]);\r\n        });\r\n        return data;\r\n    };\r\n    LRUMemory.prototype.fromJSON = function (data) {\r\n        this._cache.clear();\r\n        var seq = 0;\r\n        for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {\r\n            var _a = data_1[_i], key = _a[0], value = _a[1];\r\n            value.touch = seq;\r\n            value.type = typeof value.type === 'number' ? value.type : completionKindFromString(value.type);\r\n            this._cache.set(key, value);\r\n        }\r\n        this._seq = this._cache.size;\r\n    };\r\n    return LRUMemory;\r\n}(Memory));\r\nexport { LRUMemory };\r\nvar PrefixMemory = /** @class */ (function (_super) {\r\n    __extends(PrefixMemory, _super);\r\n    function PrefixMemory() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this._trie = TernarySearchTree.forStrings();\r\n        _this._seq = 0;\r\n        return _this;\r\n    }\r\n    PrefixMemory.prototype.memorize = function (model, pos, item) {\r\n        var word = model.getWordUntilPosition(pos).word;\r\n        var key = model.getLanguageIdentifier().language + \"/\" + word;\r\n        this._trie.set(key, {\r\n            type: item.completion.kind,\r\n            insertText: item.completion.insertText,\r\n            touch: this._seq++\r\n        });\r\n    };\r\n    PrefixMemory.prototype.select = function (model, pos, items) {\r\n        var word = model.getWordUntilPosition(pos).word;\r\n        if (!word) {\r\n            return _super.prototype.select.call(this, model, pos, items);\r\n        }\r\n        var key = model.getLanguageIdentifier().language + \"/\" + word;\r\n        var item = this._trie.get(key);\r\n        if (!item) {\r\n            item = this._trie.findSubstr(key);\r\n        }\r\n        if (item) {\r\n            for (var i = 0; i < items.length; i++) {\r\n                var _a = items[i].completion, kind = _a.kind, insertText = _a.insertText;\r\n                if (kind === item.type && insertText === item.insertText) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return _super.prototype.select.call(this, model, pos, items);\r\n    };\r\n    PrefixMemory.prototype.toJSON = function () {\r\n        var entries = [];\r\n        this._trie.forEach(function (value, key) { return entries.push([key, value]); });\r\n        // sort by last recently used (touch), then\r\n        // take the top 200 item and normalize their\r\n        // touch\r\n        entries\r\n            .sort(function (a, b) { return -(a[1].touch - b[1].touch); })\r\n            .forEach(function (value, i) { return value[1].touch = i; });\r\n        return entries.slice(0, 200);\r\n    };\r\n    PrefixMemory.prototype.fromJSON = function (data) {\r\n        this._trie.clear();\r\n        if (data.length > 0) {\r\n            this._seq = data[0][1].touch + 1;\r\n            for (var _i = 0, data_2 = data; _i < data_2.length; _i++) {\r\n                var _a = data_2[_i], key = _a[0], value = _a[1];\r\n                value.type = typeof value.type === 'number' ? value.type : completionKindFromString(value.type);\r\n                this._trie.set(key, value);\r\n            }\r\n        }\r\n    };\r\n    return PrefixMemory;\r\n}(Memory));\r\nexport { PrefixMemory };\r\nvar SuggestMemoryService = /** @class */ (function (_super) {\r\n    __extends(SuggestMemoryService, _super);\r\n    function SuggestMemoryService(_storageService, _configService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._storageService = _storageService;\r\n        _this._configService = _configService;\r\n        _this._storagePrefix = 'suggest/memories';\r\n        var update = function () {\r\n            var mode = _this._configService.getValue('editor.suggestSelection');\r\n            var share = _this._configService.getValue('editor.suggest.shareSuggestSelections');\r\n            _this._update(mode, share, false);\r\n        };\r\n        _this._persistSoon = _this._register(new RunOnceScheduler(function () { return _this._saveState(); }, 500));\r\n        _this._register(_storageService.onWillSaveState(function (e) {\r\n            if (e.reason === WillSaveStateReason.SHUTDOWN) {\r\n                _this._saveState();\r\n            }\r\n        }));\r\n        _this._register(_this._configService.onDidChangeConfiguration(function (e) {\r\n            if (e.affectsConfiguration('editor.suggestSelection') || e.affectsConfiguration('editor.suggest.shareSuggestSelections')) {\r\n                update();\r\n            }\r\n        }));\r\n        _this._register(_this._storageService.onDidChangeStorage(function (e) {\r\n            if (e.scope === 0 /* GLOBAL */ && e.key.indexOf(_this._storagePrefix) === 0) {\r\n                if (!document.hasFocus()) {\r\n                    // windows that aren't focused have to drop their current\r\n                    // storage value and accept what's stored now\r\n                    _this._update(_this._mode, _this._shareMem, true);\r\n                }\r\n            }\r\n        }));\r\n        update();\r\n        return _this;\r\n    }\r\n    SuggestMemoryService.prototype._update = function (mode, shareMem, force) {\r\n        if (!force && this._mode === mode && this._shareMem === shareMem) {\r\n            return;\r\n        }\r\n        this._shareMem = shareMem;\r\n        this._mode = mode;\r\n        this._strategy = mode === 'recentlyUsedByPrefix' ? new PrefixMemory() : mode === 'recentlyUsed' ? new LRUMemory() : new NoMemory();\r\n        try {\r\n            var scope = shareMem ? 0 /* GLOBAL */ : 1 /* WORKSPACE */;\r\n            var raw = this._storageService.get(this._storagePrefix + \"/\" + this._mode, scope);\r\n            if (raw) {\r\n                this._strategy.fromJSON(JSON.parse(raw));\r\n            }\r\n        }\r\n        catch (e) {\r\n            // things can go wrong with JSON...\r\n        }\r\n    };\r\n    SuggestMemoryService.prototype.memorize = function (model, pos, item) {\r\n        this._strategy.memorize(model, pos, item);\r\n        this._persistSoon.schedule();\r\n    };\r\n    SuggestMemoryService.prototype.select = function (model, pos, items) {\r\n        return this._strategy.select(model, pos, items);\r\n    };\r\n    SuggestMemoryService.prototype._saveState = function () {\r\n        var raw = JSON.stringify(this._strategy);\r\n        var scope = this._shareMem ? 0 /* GLOBAL */ : 1 /* WORKSPACE */;\r\n        this._storageService.store(this._storagePrefix + \"/\" + this._mode, raw, scope);\r\n    };\r\n    SuggestMemoryService = __decorate([\r\n        __param(0, IStorageService),\r\n        __param(1, IConfigurationService)\r\n    ], SuggestMemoryService);\r\n    return SuggestMemoryService;\r\n}(Disposable));\r\nexport { SuggestMemoryService };\r\nexport var ISuggestMemoryService = createDecorator('ISuggestMemories');\r\nregisterSingleton(ISuggestMemoryService, SuggestMemoryService, true);\r\n"]},"metadata":{},"sourceType":"module"}