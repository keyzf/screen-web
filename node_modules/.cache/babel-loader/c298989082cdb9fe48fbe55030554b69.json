{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport { equals, flatten, isNonEmptyArray, mergeSort } from '../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { illegalArgument, isPromiseCanceledError, onUnexpectedExternalError } from '../../../base/common/errors.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { TextModelCancellationTokenSource } from '../../browser/core/editorState.js';\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport * as modes from '../../common/modes.js';\nimport { IModelService } from '../../common/services/modelService.js';\nimport { CodeActionKind, filtersAction, mayIncludeActionsOfKind } from './types.js';\nexport var codeActionCommandId = 'editor.action.codeAction';\nexport var refactorCommandId = 'editor.action.refactor';\nexport var sourceActionCommandId = 'editor.action.sourceAction';\nexport var organizeImportsCommandId = 'editor.action.organizeImports';\nexport var fixAllCommandId = 'editor.action.fixAll';\n\nvar ManagedCodeActionSet =\n/** @class */\nfunction (_super) {\n  __extends(ManagedCodeActionSet, _super);\n\n  function ManagedCodeActionSet(actions, disposables) {\n    var _this = _super.call(this) || this;\n\n    _this._register(disposables);\n\n    _this.allActions = mergeSort(__spreadArrays(actions), ManagedCodeActionSet.codeActionsComparator);\n    _this.validActions = _this.allActions.filter(function (action) {\n      return !action.disabled;\n    });\n    return _this;\n  }\n\n  ManagedCodeActionSet.codeActionsComparator = function (a, b) {\n    if (isNonEmptyArray(a.diagnostics)) {\n      if (isNonEmptyArray(b.diagnostics)) {\n        return a.diagnostics[0].message.localeCompare(b.diagnostics[0].message);\n      } else {\n        return -1;\n      }\n    } else if (isNonEmptyArray(b.diagnostics)) {\n      return 1;\n    } else {\n      return 0; // both have no diagnostics\n    }\n  };\n\n  Object.defineProperty(ManagedCodeActionSet.prototype, \"hasAutoFix\", {\n    get: function () {\n      return this.validActions.some(function (fix) {\n        return !!fix.kind && CodeActionKind.QuickFix.contains(new CodeActionKind(fix.kind)) && !!fix.isPreferred;\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return ManagedCodeActionSet;\n}(Disposable);\n\nexport function getCodeActions(model, rangeOrSelection, trigger, token) {\n  var _this = this;\n\n  var _a;\n\n  var filter = trigger.filter || {};\n  var codeActionContext = {\n    only: (_a = filter.include) === null || _a === void 0 ? void 0 : _a.value,\n    trigger: trigger.type\n  };\n  var cts = new TextModelCancellationTokenSource(model, token);\n  var providers = getCodeActionProviders(model, filter);\n  var disposables = new DisposableStore();\n  var promises = providers.map(function (provider) {\n    return __awaiter(_this, void 0, void 0, function () {\n      var providedCodeActions, err_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4\n            /*yield*/\n            , provider.provideCodeActions(model, rangeOrSelection, codeActionContext, cts.token)];\n\n          case 1:\n            providedCodeActions = _a.sent();\n\n            if (cts.token.isCancellationRequested || !providedCodeActions) {\n              return [2\n              /*return*/\n              , []];\n            }\n\n            disposables.add(providedCodeActions);\n            return [2\n            /*return*/\n            , providedCodeActions.actions.filter(function (action) {\n              return action && filtersAction(filter, action);\n            })];\n\n          case 2:\n            err_1 = _a.sent();\n\n            if (isPromiseCanceledError(err_1)) {\n              throw err_1;\n            }\n\n            onUnexpectedExternalError(err_1);\n            return [2\n            /*return*/\n            , []];\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  });\n  var listener = modes.CodeActionProviderRegistry.onDidChange(function () {\n    var newProviders = modes.CodeActionProviderRegistry.all(model);\n\n    if (!equals(newProviders, providers)) {\n      cts.cancel();\n    }\n  });\n  return Promise.all(promises).then(flatten).then(function (actions) {\n    return new ManagedCodeActionSet(actions, disposables);\n  }).finally(function () {\n    listener.dispose();\n    cts.dispose();\n  });\n}\n\nfunction getCodeActionProviders(model, filter) {\n  return modes.CodeActionProviderRegistry.all(model) // Don't include providers that we know will not return code actions of interest\n  .filter(function (provider) {\n    if (!provider.providedCodeActionKinds) {\n      // We don't know what type of actions this provider will return.\n      return true;\n    }\n\n    return provider.providedCodeActionKinds.some(function (kind) {\n      return mayIncludeActionsOfKind(filter, new CodeActionKind(kind));\n    });\n  });\n}\n\nregisterLanguageCommand('_executeCodeActionProvider', function (accessor, args) {\n  return __awaiter(this, void 0, void 0, function () {\n    var resource, rangeOrSelection, kind, model, validatedRangeOrSelection, codeActionSet;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          resource = args.resource, rangeOrSelection = args.rangeOrSelection, kind = args.kind;\n\n          if (!(resource instanceof URI)) {\n            throw illegalArgument();\n          }\n\n          model = accessor.get(IModelService).getModel(resource);\n\n          if (!model) {\n            throw illegalArgument();\n          }\n\n          validatedRangeOrSelection = Selection.isISelection(rangeOrSelection) ? Selection.liftSelection(rangeOrSelection) : Range.isIRange(rangeOrSelection) ? model.validateRange(rangeOrSelection) : undefined;\n\n          if (!validatedRangeOrSelection) {\n            throw illegalArgument();\n          }\n\n          return [4\n          /*yield*/\n          , getCodeActions(model, validatedRangeOrSelection, {\n            type: 2\n            /* Manual */\n            ,\n            filter: {\n              includeSourceActions: true,\n              include: kind && kind.value ? new CodeActionKind(kind.value) : undefined\n            }\n          }, CancellationToken.None)];\n\n        case 1:\n          codeActionSet = _a.sent();\n          setTimeout(function () {\n            return codeActionSet.dispose();\n          }, 100);\n          return [2\n          /*return*/\n          , codeActionSet.validActions];\n      }\n    });\n  });\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeAction.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__spreadArrays","s","i","il","arguments","r","k","a","j","jl","equals","flatten","isNonEmptyArray","mergeSort","CancellationToken","illegalArgument","isPromiseCanceledError","onUnexpectedExternalError","Disposable","DisposableStore","URI","TextModelCancellationTokenSource","registerLanguageCommand","Range","Selection","modes","IModelService","CodeActionKind","filtersAction","mayIncludeActionsOfKind","codeActionCommandId","refactorCommandId","sourceActionCommandId","organizeImportsCommandId","fixAllCommandId","ManagedCodeActionSet","_super","actions","disposables","_this","_register","allActions","codeActionsComparator","validActions","filter","action","disabled","diagnostics","message","localeCompare","defineProperty","get","some","fix","kind","QuickFix","contains","isPreferred","enumerable","configurable","getCodeActions","model","rangeOrSelection","trigger","token","_a","codeActionContext","only","include","type","cts","providers","getCodeActionProviders","promises","map","provider","providedCodeActions","err_1","provideCodeActions","isCancellationRequested","add","listener","CodeActionProviderRegistry","onDidChange","newProviders","all","cancel","finally","dispose","providedCodeActionKinds","accessor","args","resource","validatedRangeOrSelection","codeActionSet","getModel","isISelection","liftSelection","isIRange","validateRange","undefined","includeSourceActions","None","setTimeout"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { equals, flatten, isNonEmptyArray, mergeSort } from '../../../base/common/arrays.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { illegalArgument, isPromiseCanceledError, onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { TextModelCancellationTokenSource } from '../../browser/core/editorState.js';\r\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport * as modes from '../../common/modes.js';\r\nimport { IModelService } from '../../common/services/modelService.js';\r\nimport { CodeActionKind, filtersAction, mayIncludeActionsOfKind } from './types.js';\r\nexport var codeActionCommandId = 'editor.action.codeAction';\r\nexport var refactorCommandId = 'editor.action.refactor';\r\nexport var sourceActionCommandId = 'editor.action.sourceAction';\r\nexport var organizeImportsCommandId = 'editor.action.organizeImports';\r\nexport var fixAllCommandId = 'editor.action.fixAll';\r\nvar ManagedCodeActionSet = /** @class */ (function (_super) {\r\n    __extends(ManagedCodeActionSet, _super);\r\n    function ManagedCodeActionSet(actions, disposables) {\r\n        var _this = _super.call(this) || this;\r\n        _this._register(disposables);\r\n        _this.allActions = mergeSort(__spreadArrays(actions), ManagedCodeActionSet.codeActionsComparator);\r\n        _this.validActions = _this.allActions.filter(function (action) { return !action.disabled; });\r\n        return _this;\r\n    }\r\n    ManagedCodeActionSet.codeActionsComparator = function (a, b) {\r\n        if (isNonEmptyArray(a.diagnostics)) {\r\n            if (isNonEmptyArray(b.diagnostics)) {\r\n                return a.diagnostics[0].message.localeCompare(b.diagnostics[0].message);\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (isNonEmptyArray(b.diagnostics)) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return 0; // both have no diagnostics\r\n        }\r\n    };\r\n    Object.defineProperty(ManagedCodeActionSet.prototype, \"hasAutoFix\", {\r\n        get: function () {\r\n            return this.validActions.some(function (fix) { return !!fix.kind && CodeActionKind.QuickFix.contains(new CodeActionKind(fix.kind)) && !!fix.isPreferred; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ManagedCodeActionSet;\r\n}(Disposable));\r\nexport function getCodeActions(model, rangeOrSelection, trigger, token) {\r\n    var _this = this;\r\n    var _a;\r\n    var filter = trigger.filter || {};\r\n    var codeActionContext = {\r\n        only: (_a = filter.include) === null || _a === void 0 ? void 0 : _a.value,\r\n        trigger: trigger.type,\r\n    };\r\n    var cts = new TextModelCancellationTokenSource(model, token);\r\n    var providers = getCodeActionProviders(model, filter);\r\n    var disposables = new DisposableStore();\r\n    var promises = providers.map(function (provider) { return __awaiter(_this, void 0, void 0, function () {\r\n        var providedCodeActions, err_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 3]);\r\n                    return [4 /*yield*/, provider.provideCodeActions(model, rangeOrSelection, codeActionContext, cts.token)];\r\n                case 1:\r\n                    providedCodeActions = _a.sent();\r\n                    if (cts.token.isCancellationRequested || !providedCodeActions) {\r\n                        return [2 /*return*/, []];\r\n                    }\r\n                    disposables.add(providedCodeActions);\r\n                    return [2 /*return*/, providedCodeActions.actions.filter(function (action) { return action && filtersAction(filter, action); })];\r\n                case 2:\r\n                    err_1 = _a.sent();\r\n                    if (isPromiseCanceledError(err_1)) {\r\n                        throw err_1;\r\n                    }\r\n                    onUnexpectedExternalError(err_1);\r\n                    return [2 /*return*/, []];\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    }); });\r\n    var listener = modes.CodeActionProviderRegistry.onDidChange(function () {\r\n        var newProviders = modes.CodeActionProviderRegistry.all(model);\r\n        if (!equals(newProviders, providers)) {\r\n            cts.cancel();\r\n        }\r\n    });\r\n    return Promise.all(promises)\r\n        .then(flatten)\r\n        .then(function (actions) { return new ManagedCodeActionSet(actions, disposables); })\r\n        .finally(function () {\r\n        listener.dispose();\r\n        cts.dispose();\r\n    });\r\n}\r\nfunction getCodeActionProviders(model, filter) {\r\n    return modes.CodeActionProviderRegistry.all(model)\r\n        // Don't include providers that we know will not return code actions of interest\r\n        .filter(function (provider) {\r\n        if (!provider.providedCodeActionKinds) {\r\n            // We don't know what type of actions this provider will return.\r\n            return true;\r\n        }\r\n        return provider.providedCodeActionKinds.some(function (kind) { return mayIncludeActionsOfKind(filter, new CodeActionKind(kind)); });\r\n    });\r\n}\r\nregisterLanguageCommand('_executeCodeActionProvider', function (accessor, args) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var resource, rangeOrSelection, kind, model, validatedRangeOrSelection, codeActionSet;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    resource = args.resource, rangeOrSelection = args.rangeOrSelection, kind = args.kind;\r\n                    if (!(resource instanceof URI)) {\r\n                        throw illegalArgument();\r\n                    }\r\n                    model = accessor.get(IModelService).getModel(resource);\r\n                    if (!model) {\r\n                        throw illegalArgument();\r\n                    }\r\n                    validatedRangeOrSelection = Selection.isISelection(rangeOrSelection)\r\n                        ? Selection.liftSelection(rangeOrSelection)\r\n                        : Range.isIRange(rangeOrSelection)\r\n                            ? model.validateRange(rangeOrSelection)\r\n                            : undefined;\r\n                    if (!validatedRangeOrSelection) {\r\n                        throw illegalArgument();\r\n                    }\r\n                    return [4 /*yield*/, getCodeActions(model, validatedRangeOrSelection, { type: 2 /* Manual */, filter: { includeSourceActions: true, include: kind && kind.value ? new CodeActionKind(kind.value) : undefined } }, CancellationToken.None)];\r\n                case 1:\r\n                    codeActionSet = _a.sent();\r\n                    setTimeout(function () { return codeActionSet.dispose(); }, 100);\r\n                    return [2 /*return*/, codeActionSet.validActions];\r\n            }\r\n        });\r\n    });\r\n});\r\n"]},"metadata":{},"sourceType":"module"}