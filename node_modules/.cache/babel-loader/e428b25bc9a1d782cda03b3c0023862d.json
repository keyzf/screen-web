{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { ViewPart } from '../../view/viewPart.js';\nimport { Position } from '../../../common/core/position.js';\nimport { TokenizationRegistry } from '../../../common/modes.js';\nimport { editorCursorForeground, editorOverviewRulerBorder } from '../../../common/view/editorColorRegistry.js';\n\nvar Settings =\n/** @class */\nfunction () {\n  function Settings(config, theme) {\n    var options = config.options;\n    this.lineHeight = options.get(49\n    /* lineHeight */\n    );\n    this.pixelRatio = options.get(105\n    /* pixelRatio */\n    );\n    this.overviewRulerLanes = options.get(63\n    /* overviewRulerLanes */\n    );\n    this.renderBorder = options.get(62\n    /* overviewRulerBorder */\n    );\n    var borderColor = theme.getColor(editorOverviewRulerBorder);\n    this.borderColor = borderColor ? borderColor.toString() : null;\n    this.hideCursor = options.get(42\n    /* hideCursorInOverviewRuler */\n    );\n    var cursorColor = theme.getColor(editorCursorForeground);\n    this.cursorColor = cursorColor ? cursorColor.transparent(0.7).toString() : null;\n    this.themeType = theme.type;\n    var minimapOpts = options.get(54\n    /* minimap */\n    );\n    var minimapEnabled = minimapOpts.enabled;\n    var minimapSide = minimapOpts.side;\n    var backgroundColor = minimapEnabled ? TokenizationRegistry.getDefaultBackground() : null;\n\n    if (backgroundColor === null || minimapSide === 'left') {\n      this.backgroundColor = null;\n    } else {\n      this.backgroundColor = Color.Format.CSS.formatHex(backgroundColor);\n    }\n\n    var layoutInfo = options.get(107\n    /* layoutInfo */\n    );\n    var position = layoutInfo.overviewRuler;\n    this.top = position.top;\n    this.right = position.right;\n    this.domWidth = position.width;\n    this.domHeight = position.height;\n\n    if (this.overviewRulerLanes === 0) {\n      // overview ruler is off\n      this.canvasWidth = 0;\n      this.canvasHeight = 0;\n    } else {\n      this.canvasWidth = this.domWidth * this.pixelRatio | 0;\n      this.canvasHeight = this.domHeight * this.pixelRatio | 0;\n    }\n\n    var _a = this._initLanes(1, this.canvasWidth, this.overviewRulerLanes),\n        x = _a[0],\n        w = _a[1];\n\n    this.x = x;\n    this.w = w;\n  }\n\n  Settings.prototype._initLanes = function (canvasLeftOffset, canvasWidth, laneCount) {\n    var remainingWidth = canvasWidth - canvasLeftOffset;\n\n    if (laneCount >= 3) {\n      var leftWidth = Math.floor(remainingWidth / 3);\n      var rightWidth = Math.floor(remainingWidth / 3);\n      var centerWidth = remainingWidth - leftWidth - rightWidth;\n      var leftOffset = canvasLeftOffset;\n      var centerOffset = leftOffset + leftWidth;\n      var rightOffset = leftOffset + leftWidth + centerWidth;\n      return [[0, leftOffset, centerOffset, leftOffset, rightOffset, leftOffset, centerOffset, leftOffset], [0, leftWidth, centerWidth, leftWidth + centerWidth, rightWidth, leftWidth + centerWidth + rightWidth, centerWidth + rightWidth, leftWidth + centerWidth + rightWidth]];\n    } else if (laneCount === 2) {\n      var leftWidth = Math.floor(remainingWidth / 2);\n      var rightWidth = remainingWidth - leftWidth;\n      var leftOffset = canvasLeftOffset;\n      var rightOffset = leftOffset + leftWidth;\n      return [[0, leftOffset, leftOffset, leftOffset, rightOffset, leftOffset, leftOffset, leftOffset], [0, leftWidth, leftWidth, leftWidth, rightWidth, leftWidth + rightWidth, leftWidth + rightWidth, leftWidth + rightWidth]];\n    } else {\n      var offset = canvasLeftOffset;\n      var width = remainingWidth;\n      return [[0, offset, offset, offset, offset, offset, offset, offset], [0, width, width, width, width, width, width, width]];\n    }\n  };\n\n  Settings.prototype.equals = function (other) {\n    return this.lineHeight === other.lineHeight && this.pixelRatio === other.pixelRatio && this.overviewRulerLanes === other.overviewRulerLanes && this.renderBorder === other.renderBorder && this.borderColor === other.borderColor && this.hideCursor === other.hideCursor && this.cursorColor === other.cursorColor && this.themeType === other.themeType && this.backgroundColor === other.backgroundColor && this.top === other.top && this.right === other.right && this.domWidth === other.domWidth && this.domHeight === other.domHeight && this.canvasWidth === other.canvasWidth && this.canvasHeight === other.canvasHeight;\n  };\n\n  return Settings;\n}();\n\nvar DecorationsOverviewRuler =\n/** @class */\nfunction (_super) {\n  __extends(DecorationsOverviewRuler, _super);\n\n  function DecorationsOverviewRuler(context) {\n    var _this = _super.call(this, context) || this;\n\n    _this._domNode = createFastDomNode(document.createElement('canvas'));\n\n    _this._domNode.setClassName('decorationsOverviewRuler');\n\n    _this._domNode.setPosition('absolute');\n\n    _this._domNode.setLayerHinting(true);\n\n    _this._domNode.setContain('strict');\n\n    _this._domNode.setAttribute('aria-hidden', 'true');\n\n    _this._updateSettings(false);\n\n    _this._tokensColorTrackerListener = TokenizationRegistry.onDidChange(function (e) {\n      if (e.changedColorMap) {\n        _this._updateSettings(true);\n      }\n    });\n    _this._cursorPositions = [];\n    return _this;\n  }\n\n  DecorationsOverviewRuler.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this._tokensColorTrackerListener.dispose();\n  };\n\n  DecorationsOverviewRuler.prototype._updateSettings = function (renderNow) {\n    var newSettings = new Settings(this._context.configuration, this._context.theme);\n\n    if (this._settings && this._settings.equals(newSettings)) {\n      // nothing to do\n      return false;\n    }\n\n    this._settings = newSettings;\n\n    this._domNode.setTop(this._settings.top);\n\n    this._domNode.setRight(this._settings.right);\n\n    this._domNode.setWidth(this._settings.domWidth);\n\n    this._domNode.setHeight(this._settings.domHeight);\n\n    this._domNode.domNode.width = this._settings.canvasWidth;\n    this._domNode.domNode.height = this._settings.canvasHeight;\n\n    if (renderNow) {\n      this._render();\n    }\n\n    return true;\n  }; // ---- begin view event handlers\n\n\n  DecorationsOverviewRuler.prototype.onConfigurationChanged = function (e) {\n    return this._updateSettings(false);\n  };\n\n  DecorationsOverviewRuler.prototype.onCursorStateChanged = function (e) {\n    this._cursorPositions = [];\n\n    for (var i = 0, len = e.selections.length; i < len; i++) {\n      this._cursorPositions[i] = e.selections[i].getPosition();\n    }\n\n    this._cursorPositions.sort(Position.compare);\n\n    return true;\n  };\n\n  DecorationsOverviewRuler.prototype.onDecorationsChanged = function (e) {\n    return true;\n  };\n\n  DecorationsOverviewRuler.prototype.onFlushed = function (e) {\n    return true;\n  };\n\n  DecorationsOverviewRuler.prototype.onScrollChanged = function (e) {\n    return e.scrollHeightChanged;\n  };\n\n  DecorationsOverviewRuler.prototype.onZonesChanged = function (e) {\n    return true;\n  };\n\n  DecorationsOverviewRuler.prototype.onThemeChanged = function (e) {\n    // invalidate color cache\n    this._context.model.invalidateOverviewRulerColorCache();\n\n    return this._updateSettings(false);\n  }; // ---- end view event handlers\n\n\n  DecorationsOverviewRuler.prototype.getDomNode = function () {\n    return this._domNode.domNode;\n  };\n\n  DecorationsOverviewRuler.prototype.prepareRender = function (ctx) {// Nothing to read\n  };\n\n  DecorationsOverviewRuler.prototype.render = function (editorCtx) {\n    this._render();\n  };\n\n  DecorationsOverviewRuler.prototype._render = function () {\n    if (this._settings.overviewRulerLanes === 0) {\n      // overview ruler is off\n      this._domNode.setBackgroundColor(this._settings.backgroundColor ? this._settings.backgroundColor : '');\n\n      return;\n    }\n\n    var canvasWidth = this._settings.canvasWidth;\n    var canvasHeight = this._settings.canvasHeight;\n    var lineHeight = this._settings.lineHeight;\n    var viewLayout = this._context.viewLayout;\n\n    var outerHeight = this._context.viewLayout.getScrollHeight();\n\n    var heightRatio = canvasHeight / outerHeight;\n\n    var decorations = this._context.model.getAllOverviewRulerDecorations(this._context.theme);\n\n    var minDecorationHeight = 6\n    /* MIN_DECORATION_HEIGHT */\n    * this._settings.pixelRatio | 0;\n    var halfMinDecorationHeight = minDecorationHeight / 2 | 0;\n\n    var canvasCtx = this._domNode.domNode.getContext('2d');\n\n    if (this._settings.backgroundColor === null) {\n      canvasCtx.clearRect(0, 0, canvasWidth, canvasHeight);\n    } else {\n      canvasCtx.fillStyle = this._settings.backgroundColor;\n      canvasCtx.fillRect(0, 0, canvasWidth, canvasHeight);\n    }\n\n    var x = this._settings.x;\n    var w = this._settings.w; // Avoid flickering by always rendering the colors in the same order\n    // colors that don't use transparency will be sorted last (they start with #)\n\n    var colors = Object.keys(decorations);\n    colors.sort();\n\n    for (var cIndex = 0, cLen = colors.length; cIndex < cLen; cIndex++) {\n      var color = colors[cIndex];\n      var colorDecorations = decorations[color];\n      canvasCtx.fillStyle = color;\n      var prevLane = 0;\n      var prevY1 = 0;\n      var prevY2 = 0;\n\n      for (var i = 0, len = colorDecorations.length; i < len; i++) {\n        var lane = colorDecorations[3 * i];\n        var startLineNumber = colorDecorations[3 * i + 1];\n        var endLineNumber = colorDecorations[3 * i + 2];\n        var y1 = viewLayout.getVerticalOffsetForLineNumber(startLineNumber) * heightRatio | 0;\n        var y2 = (viewLayout.getVerticalOffsetForLineNumber(endLineNumber) + lineHeight) * heightRatio | 0;\n        var height = y2 - y1;\n\n        if (height < minDecorationHeight) {\n          var yCenter = (y1 + y2) / 2 | 0;\n\n          if (yCenter < halfMinDecorationHeight) {\n            yCenter = halfMinDecorationHeight;\n          } else if (yCenter + halfMinDecorationHeight > canvasHeight) {\n            yCenter = canvasHeight - halfMinDecorationHeight;\n          }\n\n          y1 = yCenter - halfMinDecorationHeight;\n          y2 = yCenter + halfMinDecorationHeight;\n        }\n\n        if (y1 > prevY2 + 1 || lane !== prevLane) {\n          // flush prev\n          if (i !== 0) {\n            canvasCtx.fillRect(x[prevLane], prevY1, w[prevLane], prevY2 - prevY1);\n          }\n\n          prevLane = lane;\n          prevY1 = y1;\n          prevY2 = y2;\n        } else {\n          // merge into prev\n          if (y2 > prevY2) {\n            prevY2 = y2;\n          }\n        }\n      }\n\n      canvasCtx.fillRect(x[prevLane], prevY1, w[prevLane], prevY2 - prevY1);\n    } // Draw cursors\n\n\n    if (!this._settings.hideCursor && this._settings.cursorColor) {\n      var cursorHeight = 2 * this._settings.pixelRatio | 0;\n      var halfCursorHeight = cursorHeight / 2 | 0;\n      var cursorX = this._settings.x[7\n      /* Full */\n      ];\n      var cursorW = this._settings.w[7\n      /* Full */\n      ];\n      canvasCtx.fillStyle = this._settings.cursorColor;\n      var prevY1 = -100;\n      var prevY2 = -100;\n\n      for (var i = 0, len = this._cursorPositions.length; i < len; i++) {\n        var cursor = this._cursorPositions[i];\n        var yCenter = viewLayout.getVerticalOffsetForLineNumber(cursor.lineNumber) * heightRatio | 0;\n\n        if (yCenter < halfCursorHeight) {\n          yCenter = halfCursorHeight;\n        } else if (yCenter + halfCursorHeight > canvasHeight) {\n          yCenter = canvasHeight - halfCursorHeight;\n        }\n\n        var y1 = yCenter - halfCursorHeight;\n        var y2 = y1 + cursorHeight;\n\n        if (y1 > prevY2 + 1) {\n          // flush prev\n          if (i !== 0) {\n            canvasCtx.fillRect(cursorX, prevY1, cursorW, prevY2 - prevY1);\n          }\n\n          prevY1 = y1;\n          prevY2 = y2;\n        } else {\n          // merge into prev\n          if (y2 > prevY2) {\n            prevY2 = y2;\n          }\n        }\n      }\n\n      canvasCtx.fillRect(cursorX, prevY1, cursorW, prevY2 - prevY1);\n    }\n\n    if (this._settings.renderBorder && this._settings.borderColor && this._settings.overviewRulerLanes > 0) {\n      canvasCtx.beginPath();\n      canvasCtx.lineWidth = 1;\n      canvasCtx.strokeStyle = this._settings.borderColor;\n      canvasCtx.moveTo(0, 0);\n      canvasCtx.lineTo(0, canvasHeight);\n      canvasCtx.stroke();\n      canvasCtx.moveTo(0, 0);\n      canvasCtx.lineTo(canvasWidth, 0);\n      canvasCtx.stroke();\n    }\n  };\n\n  return DecorationsOverviewRuler;\n}(ViewPart);\n\nexport { DecorationsOverviewRuler };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/viewParts/overviewRuler/decorationsOverviewRuler.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","createFastDomNode","Color","ViewPart","Position","TokenizationRegistry","editorCursorForeground","editorOverviewRulerBorder","Settings","config","theme","options","lineHeight","get","pixelRatio","overviewRulerLanes","renderBorder","borderColor","getColor","toString","hideCursor","cursorColor","transparent","themeType","type","minimapOpts","minimapEnabled","enabled","minimapSide","side","backgroundColor","getDefaultBackground","Format","CSS","formatHex","layoutInfo","position","overviewRuler","top","right","domWidth","width","domHeight","height","canvasWidth","canvasHeight","_a","_initLanes","x","w","canvasLeftOffset","laneCount","remainingWidth","leftWidth","Math","floor","rightWidth","centerWidth","leftOffset","centerOffset","rightOffset","offset","equals","other","DecorationsOverviewRuler","_super","context","_this","call","_domNode","document","createElement","setClassName","setPosition","setLayerHinting","setContain","setAttribute","_updateSettings","_tokensColorTrackerListener","onDidChange","e","changedColorMap","_cursorPositions","dispose","renderNow","newSettings","_context","configuration","_settings","setTop","setRight","setWidth","setHeight","domNode","_render","onConfigurationChanged","onCursorStateChanged","i","len","selections","length","getPosition","sort","compare","onDecorationsChanged","onFlushed","onScrollChanged","scrollHeightChanged","onZonesChanged","onThemeChanged","model","invalidateOverviewRulerColorCache","getDomNode","prepareRender","ctx","render","editorCtx","setBackgroundColor","viewLayout","outerHeight","getScrollHeight","heightRatio","decorations","getAllOverviewRulerDecorations","minDecorationHeight","halfMinDecorationHeight","canvasCtx","getContext","clearRect","fillStyle","fillRect","colors","keys","cIndex","cLen","color","colorDecorations","prevLane","prevY1","prevY2","lane","startLineNumber","endLineNumber","y1","getVerticalOffsetForLineNumber","y2","yCenter","cursorHeight","halfCursorHeight","cursorX","cursorW","cursor","lineNumber","beginPath","lineWidth","strokeStyle","moveTo","lineTo","stroke"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\r\nimport { Color } from '../../../../base/common/color.js';\r\nimport { ViewPart } from '../../view/viewPart.js';\r\nimport { Position } from '../../../common/core/position.js';\r\nimport { TokenizationRegistry } from '../../../common/modes.js';\r\nimport { editorCursorForeground, editorOverviewRulerBorder } from '../../../common/view/editorColorRegistry.js';\r\nvar Settings = /** @class */ (function () {\r\n    function Settings(config, theme) {\r\n        var options = config.options;\r\n        this.lineHeight = options.get(49 /* lineHeight */);\r\n        this.pixelRatio = options.get(105 /* pixelRatio */);\r\n        this.overviewRulerLanes = options.get(63 /* overviewRulerLanes */);\r\n        this.renderBorder = options.get(62 /* overviewRulerBorder */);\r\n        var borderColor = theme.getColor(editorOverviewRulerBorder);\r\n        this.borderColor = borderColor ? borderColor.toString() : null;\r\n        this.hideCursor = options.get(42 /* hideCursorInOverviewRuler */);\r\n        var cursorColor = theme.getColor(editorCursorForeground);\r\n        this.cursorColor = cursorColor ? cursorColor.transparent(0.7).toString() : null;\r\n        this.themeType = theme.type;\r\n        var minimapOpts = options.get(54 /* minimap */);\r\n        var minimapEnabled = minimapOpts.enabled;\r\n        var minimapSide = minimapOpts.side;\r\n        var backgroundColor = (minimapEnabled ? TokenizationRegistry.getDefaultBackground() : null);\r\n        if (backgroundColor === null || minimapSide === 'left') {\r\n            this.backgroundColor = null;\r\n        }\r\n        else {\r\n            this.backgroundColor = Color.Format.CSS.formatHex(backgroundColor);\r\n        }\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        var position = layoutInfo.overviewRuler;\r\n        this.top = position.top;\r\n        this.right = position.right;\r\n        this.domWidth = position.width;\r\n        this.domHeight = position.height;\r\n        if (this.overviewRulerLanes === 0) {\r\n            // overview ruler is off\r\n            this.canvasWidth = 0;\r\n            this.canvasHeight = 0;\r\n        }\r\n        else {\r\n            this.canvasWidth = (this.domWidth * this.pixelRatio) | 0;\r\n            this.canvasHeight = (this.domHeight * this.pixelRatio) | 0;\r\n        }\r\n        var _a = this._initLanes(1, this.canvasWidth, this.overviewRulerLanes), x = _a[0], w = _a[1];\r\n        this.x = x;\r\n        this.w = w;\r\n    }\r\n    Settings.prototype._initLanes = function (canvasLeftOffset, canvasWidth, laneCount) {\r\n        var remainingWidth = canvasWidth - canvasLeftOffset;\r\n        if (laneCount >= 3) {\r\n            var leftWidth = Math.floor(remainingWidth / 3);\r\n            var rightWidth = Math.floor(remainingWidth / 3);\r\n            var centerWidth = remainingWidth - leftWidth - rightWidth;\r\n            var leftOffset = canvasLeftOffset;\r\n            var centerOffset = leftOffset + leftWidth;\r\n            var rightOffset = leftOffset + leftWidth + centerWidth;\r\n            return [\r\n                [\r\n                    0,\r\n                    leftOffset,\r\n                    centerOffset,\r\n                    leftOffset,\r\n                    rightOffset,\r\n                    leftOffset,\r\n                    centerOffset,\r\n                    leftOffset,\r\n                ], [\r\n                    0,\r\n                    leftWidth,\r\n                    centerWidth,\r\n                    leftWidth + centerWidth,\r\n                    rightWidth,\r\n                    leftWidth + centerWidth + rightWidth,\r\n                    centerWidth + rightWidth,\r\n                    leftWidth + centerWidth + rightWidth,\r\n                ]\r\n            ];\r\n        }\r\n        else if (laneCount === 2) {\r\n            var leftWidth = Math.floor(remainingWidth / 2);\r\n            var rightWidth = remainingWidth - leftWidth;\r\n            var leftOffset = canvasLeftOffset;\r\n            var rightOffset = leftOffset + leftWidth;\r\n            return [\r\n                [\r\n                    0,\r\n                    leftOffset,\r\n                    leftOffset,\r\n                    leftOffset,\r\n                    rightOffset,\r\n                    leftOffset,\r\n                    leftOffset,\r\n                    leftOffset,\r\n                ], [\r\n                    0,\r\n                    leftWidth,\r\n                    leftWidth,\r\n                    leftWidth,\r\n                    rightWidth,\r\n                    leftWidth + rightWidth,\r\n                    leftWidth + rightWidth,\r\n                    leftWidth + rightWidth,\r\n                ]\r\n            ];\r\n        }\r\n        else {\r\n            var offset = canvasLeftOffset;\r\n            var width = remainingWidth;\r\n            return [\r\n                [\r\n                    0,\r\n                    offset,\r\n                    offset,\r\n                    offset,\r\n                    offset,\r\n                    offset,\r\n                    offset,\r\n                    offset,\r\n                ], [\r\n                    0,\r\n                    width,\r\n                    width,\r\n                    width,\r\n                    width,\r\n                    width,\r\n                    width,\r\n                    width,\r\n                ]\r\n            ];\r\n        }\r\n    };\r\n    Settings.prototype.equals = function (other) {\r\n        return (this.lineHeight === other.lineHeight\r\n            && this.pixelRatio === other.pixelRatio\r\n            && this.overviewRulerLanes === other.overviewRulerLanes\r\n            && this.renderBorder === other.renderBorder\r\n            && this.borderColor === other.borderColor\r\n            && this.hideCursor === other.hideCursor\r\n            && this.cursorColor === other.cursorColor\r\n            && this.themeType === other.themeType\r\n            && this.backgroundColor === other.backgroundColor\r\n            && this.top === other.top\r\n            && this.right === other.right\r\n            && this.domWidth === other.domWidth\r\n            && this.domHeight === other.domHeight\r\n            && this.canvasWidth === other.canvasWidth\r\n            && this.canvasHeight === other.canvasHeight);\r\n    };\r\n    return Settings;\r\n}());\r\nvar DecorationsOverviewRuler = /** @class */ (function (_super) {\r\n    __extends(DecorationsOverviewRuler, _super);\r\n    function DecorationsOverviewRuler(context) {\r\n        var _this = _super.call(this, context) || this;\r\n        _this._domNode = createFastDomNode(document.createElement('canvas'));\r\n        _this._domNode.setClassName('decorationsOverviewRuler');\r\n        _this._domNode.setPosition('absolute');\r\n        _this._domNode.setLayerHinting(true);\r\n        _this._domNode.setContain('strict');\r\n        _this._domNode.setAttribute('aria-hidden', 'true');\r\n        _this._updateSettings(false);\r\n        _this._tokensColorTrackerListener = TokenizationRegistry.onDidChange(function (e) {\r\n            if (e.changedColorMap) {\r\n                _this._updateSettings(true);\r\n            }\r\n        });\r\n        _this._cursorPositions = [];\r\n        return _this;\r\n    }\r\n    DecorationsOverviewRuler.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this._tokensColorTrackerListener.dispose();\r\n    };\r\n    DecorationsOverviewRuler.prototype._updateSettings = function (renderNow) {\r\n        var newSettings = new Settings(this._context.configuration, this._context.theme);\r\n        if (this._settings && this._settings.equals(newSettings)) {\r\n            // nothing to do\r\n            return false;\r\n        }\r\n        this._settings = newSettings;\r\n        this._domNode.setTop(this._settings.top);\r\n        this._domNode.setRight(this._settings.right);\r\n        this._domNode.setWidth(this._settings.domWidth);\r\n        this._domNode.setHeight(this._settings.domHeight);\r\n        this._domNode.domNode.width = this._settings.canvasWidth;\r\n        this._domNode.domNode.height = this._settings.canvasHeight;\r\n        if (renderNow) {\r\n            this._render();\r\n        }\r\n        return true;\r\n    };\r\n    // ---- begin view event handlers\r\n    DecorationsOverviewRuler.prototype.onConfigurationChanged = function (e) {\r\n        return this._updateSettings(false);\r\n    };\r\n    DecorationsOverviewRuler.prototype.onCursorStateChanged = function (e) {\r\n        this._cursorPositions = [];\r\n        for (var i = 0, len = e.selections.length; i < len; i++) {\r\n            this._cursorPositions[i] = e.selections[i].getPosition();\r\n        }\r\n        this._cursorPositions.sort(Position.compare);\r\n        return true;\r\n    };\r\n    DecorationsOverviewRuler.prototype.onDecorationsChanged = function (e) {\r\n        return true;\r\n    };\r\n    DecorationsOverviewRuler.prototype.onFlushed = function (e) {\r\n        return true;\r\n    };\r\n    DecorationsOverviewRuler.prototype.onScrollChanged = function (e) {\r\n        return e.scrollHeightChanged;\r\n    };\r\n    DecorationsOverviewRuler.prototype.onZonesChanged = function (e) {\r\n        return true;\r\n    };\r\n    DecorationsOverviewRuler.prototype.onThemeChanged = function (e) {\r\n        // invalidate color cache\r\n        this._context.model.invalidateOverviewRulerColorCache();\r\n        return this._updateSettings(false);\r\n    };\r\n    // ---- end view event handlers\r\n    DecorationsOverviewRuler.prototype.getDomNode = function () {\r\n        return this._domNode.domNode;\r\n    };\r\n    DecorationsOverviewRuler.prototype.prepareRender = function (ctx) {\r\n        // Nothing to read\r\n    };\r\n    DecorationsOverviewRuler.prototype.render = function (editorCtx) {\r\n        this._render();\r\n    };\r\n    DecorationsOverviewRuler.prototype._render = function () {\r\n        if (this._settings.overviewRulerLanes === 0) {\r\n            // overview ruler is off\r\n            this._domNode.setBackgroundColor(this._settings.backgroundColor ? this._settings.backgroundColor : '');\r\n            return;\r\n        }\r\n        var canvasWidth = this._settings.canvasWidth;\r\n        var canvasHeight = this._settings.canvasHeight;\r\n        var lineHeight = this._settings.lineHeight;\r\n        var viewLayout = this._context.viewLayout;\r\n        var outerHeight = this._context.viewLayout.getScrollHeight();\r\n        var heightRatio = canvasHeight / outerHeight;\r\n        var decorations = this._context.model.getAllOverviewRulerDecorations(this._context.theme);\r\n        var minDecorationHeight = (6 /* MIN_DECORATION_HEIGHT */ * this._settings.pixelRatio) | 0;\r\n        var halfMinDecorationHeight = (minDecorationHeight / 2) | 0;\r\n        var canvasCtx = this._domNode.domNode.getContext('2d');\r\n        if (this._settings.backgroundColor === null) {\r\n            canvasCtx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n        }\r\n        else {\r\n            canvasCtx.fillStyle = this._settings.backgroundColor;\r\n            canvasCtx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n        }\r\n        var x = this._settings.x;\r\n        var w = this._settings.w;\r\n        // Avoid flickering by always rendering the colors in the same order\r\n        // colors that don't use transparency will be sorted last (they start with #)\r\n        var colors = Object.keys(decorations);\r\n        colors.sort();\r\n        for (var cIndex = 0, cLen = colors.length; cIndex < cLen; cIndex++) {\r\n            var color = colors[cIndex];\r\n            var colorDecorations = decorations[color];\r\n            canvasCtx.fillStyle = color;\r\n            var prevLane = 0;\r\n            var prevY1 = 0;\r\n            var prevY2 = 0;\r\n            for (var i = 0, len = colorDecorations.length; i < len; i++) {\r\n                var lane = colorDecorations[3 * i];\r\n                var startLineNumber = colorDecorations[3 * i + 1];\r\n                var endLineNumber = colorDecorations[3 * i + 2];\r\n                var y1 = (viewLayout.getVerticalOffsetForLineNumber(startLineNumber) * heightRatio) | 0;\r\n                var y2 = ((viewLayout.getVerticalOffsetForLineNumber(endLineNumber) + lineHeight) * heightRatio) | 0;\r\n                var height = y2 - y1;\r\n                if (height < minDecorationHeight) {\r\n                    var yCenter = ((y1 + y2) / 2) | 0;\r\n                    if (yCenter < halfMinDecorationHeight) {\r\n                        yCenter = halfMinDecorationHeight;\r\n                    }\r\n                    else if (yCenter + halfMinDecorationHeight > canvasHeight) {\r\n                        yCenter = canvasHeight - halfMinDecorationHeight;\r\n                    }\r\n                    y1 = yCenter - halfMinDecorationHeight;\r\n                    y2 = yCenter + halfMinDecorationHeight;\r\n                }\r\n                if (y1 > prevY2 + 1 || lane !== prevLane) {\r\n                    // flush prev\r\n                    if (i !== 0) {\r\n                        canvasCtx.fillRect(x[prevLane], prevY1, w[prevLane], prevY2 - prevY1);\r\n                    }\r\n                    prevLane = lane;\r\n                    prevY1 = y1;\r\n                    prevY2 = y2;\r\n                }\r\n                else {\r\n                    // merge into prev\r\n                    if (y2 > prevY2) {\r\n                        prevY2 = y2;\r\n                    }\r\n                }\r\n            }\r\n            canvasCtx.fillRect(x[prevLane], prevY1, w[prevLane], prevY2 - prevY1);\r\n        }\r\n        // Draw cursors\r\n        if (!this._settings.hideCursor && this._settings.cursorColor) {\r\n            var cursorHeight = (2 * this._settings.pixelRatio) | 0;\r\n            var halfCursorHeight = (cursorHeight / 2) | 0;\r\n            var cursorX = this._settings.x[7 /* Full */];\r\n            var cursorW = this._settings.w[7 /* Full */];\r\n            canvasCtx.fillStyle = this._settings.cursorColor;\r\n            var prevY1 = -100;\r\n            var prevY2 = -100;\r\n            for (var i = 0, len = this._cursorPositions.length; i < len; i++) {\r\n                var cursor = this._cursorPositions[i];\r\n                var yCenter = (viewLayout.getVerticalOffsetForLineNumber(cursor.lineNumber) * heightRatio) | 0;\r\n                if (yCenter < halfCursorHeight) {\r\n                    yCenter = halfCursorHeight;\r\n                }\r\n                else if (yCenter + halfCursorHeight > canvasHeight) {\r\n                    yCenter = canvasHeight - halfCursorHeight;\r\n                }\r\n                var y1 = yCenter - halfCursorHeight;\r\n                var y2 = y1 + cursorHeight;\r\n                if (y1 > prevY2 + 1) {\r\n                    // flush prev\r\n                    if (i !== 0) {\r\n                        canvasCtx.fillRect(cursorX, prevY1, cursorW, prevY2 - prevY1);\r\n                    }\r\n                    prevY1 = y1;\r\n                    prevY2 = y2;\r\n                }\r\n                else {\r\n                    // merge into prev\r\n                    if (y2 > prevY2) {\r\n                        prevY2 = y2;\r\n                    }\r\n                }\r\n            }\r\n            canvasCtx.fillRect(cursorX, prevY1, cursorW, prevY2 - prevY1);\r\n        }\r\n        if (this._settings.renderBorder && this._settings.borderColor && this._settings.overviewRulerLanes > 0) {\r\n            canvasCtx.beginPath();\r\n            canvasCtx.lineWidth = 1;\r\n            canvasCtx.strokeStyle = this._settings.borderColor;\r\n            canvasCtx.moveTo(0, 0);\r\n            canvasCtx.lineTo(0, canvasHeight);\r\n            canvasCtx.stroke();\r\n            canvasCtx.moveTo(0, 0);\r\n            canvasCtx.lineTo(canvasWidth, 0);\r\n            canvasCtx.stroke();\r\n        }\r\n    };\r\n    return DecorationsOverviewRuler;\r\n}(ViewPart));\r\nexport { DecorationsOverviewRuler };\r\n"]},"metadata":{},"sourceType":"module"}