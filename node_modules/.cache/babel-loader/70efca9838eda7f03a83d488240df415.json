{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport './bracketMatching.css';\nimport * as nls from '../../../nls.js';\nimport { RunOnceScheduler } from '../../../base/common/async.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { OverviewRulerLane } from '../../common/model.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\nimport { editorBracketMatchBackground, editorBracketMatchBorder } from '../../common/view/editorColorRegistry.js';\nimport { registerColor } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant, themeColorFromId } from '../../../platform/theme/common/themeService.js';\nimport { MenuRegistry } from '../../../platform/actions/common/actions.js';\nvar overviewRulerBracketMatchForeground = registerColor('editorOverviewRuler.bracketMatchForeground', {\n  dark: '#A0A0A0',\n  light: '#A0A0A0',\n  hc: '#A0A0A0'\n}, nls.localize('overviewRulerBracketMatchForeground', 'Overview ruler marker color for matching brackets.'));\n\nvar JumpToBracketAction =\n/** @class */\nfunction (_super) {\n  __extends(JumpToBracketAction, _super);\n\n  function JumpToBracketAction() {\n    return _super.call(this, {\n      id: 'editor.action.jumpToBracket',\n      label: nls.localize('smartSelect.jumpBracket', \"Go to Bracket\"),\n      alias: 'Go to Bracket',\n      precondition: undefined,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 88\n        /* US_BACKSLASH */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  JumpToBracketAction.prototype.run = function (accessor, editor) {\n    var controller = BracketMatchingController.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    controller.jumpToBracket();\n  };\n\n  return JumpToBracketAction;\n}(EditorAction);\n\nvar SelectToBracketAction =\n/** @class */\nfunction (_super) {\n  __extends(SelectToBracketAction, _super);\n\n  function SelectToBracketAction() {\n    return _super.call(this, {\n      id: 'editor.action.selectToBracket',\n      label: nls.localize('smartSelect.selectToBracket', \"Select to Bracket\"),\n      alias: 'Select to Bracket',\n      precondition: undefined,\n      description: {\n        description: \"Select to Bracket\",\n        args: [{\n          name: 'args',\n          schema: {\n            type: 'object',\n            properties: {\n              'selectBrackets': {\n                type: 'boolean',\n                default: true\n              }\n            }\n          }\n        }]\n      }\n    }) || this;\n  }\n\n  SelectToBracketAction.prototype.run = function (accessor, editor, args) {\n    var controller = BracketMatchingController.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    var selectBrackets = true;\n\n    if (args && args.selectBrackets === false) {\n      selectBrackets = false;\n    }\n\n    controller.selectToBracket(selectBrackets);\n  };\n\n  return SelectToBracketAction;\n}(EditorAction);\n\nvar BracketsData =\n/** @class */\nfunction () {\n  function BracketsData(position, brackets, options) {\n    this.position = position;\n    this.brackets = brackets;\n    this.options = options;\n  }\n\n  return BracketsData;\n}();\n\nvar BracketMatchingController =\n/** @class */\nfunction (_super) {\n  __extends(BracketMatchingController, _super);\n\n  function BracketMatchingController(editor) {\n    var _this = _super.call(this) || this;\n\n    _this._editor = editor;\n    _this._lastBracketsData = [];\n    _this._lastVersionId = 0;\n    _this._decorations = [];\n    _this._updateBracketsSoon = _this._register(new RunOnceScheduler(function () {\n      return _this._updateBrackets();\n    }, 50));\n    _this._matchBrackets = _this._editor.getOption(53\n    /* matchBrackets */\n    );\n\n    _this._updateBracketsSoon.schedule();\n\n    _this._register(editor.onDidChangeCursorPosition(function (e) {\n      if (_this._matchBrackets === 'never') {\n        // Early exit if nothing needs to be done!\n        // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\n        return;\n      }\n\n      _this._updateBracketsSoon.schedule();\n    }));\n\n    _this._register(editor.onDidChangeModelContent(function (e) {\n      _this._updateBracketsSoon.schedule();\n    }));\n\n    _this._register(editor.onDidChangeModel(function (e) {\n      _this._lastBracketsData = [];\n      _this._decorations = [];\n\n      _this._updateBracketsSoon.schedule();\n    }));\n\n    _this._register(editor.onDidChangeModelLanguageConfiguration(function (e) {\n      _this._lastBracketsData = [];\n\n      _this._updateBracketsSoon.schedule();\n    }));\n\n    _this._register(editor.onDidChangeConfiguration(function (e) {\n      if (e.hasChanged(53\n      /* matchBrackets */\n      )) {\n        _this._matchBrackets = _this._editor.getOption(53\n        /* matchBrackets */\n        );\n        _this._decorations = _this._editor.deltaDecorations(_this._decorations, []);\n        _this._lastBracketsData = [];\n        _this._lastVersionId = 0;\n\n        _this._updateBracketsSoon.schedule();\n      }\n    }));\n\n    return _this;\n  }\n\n  BracketMatchingController.get = function (editor) {\n    return editor.getContribution(BracketMatchingController.ID);\n  };\n\n  BracketMatchingController.prototype.jumpToBracket = function () {\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    var model = this._editor.getModel();\n\n    var newSelections = this._editor.getSelections().map(function (selection) {\n      var position = selection.getStartPosition(); // find matching brackets if position is on a bracket\n\n      var brackets = model.matchBracket(position);\n      var newCursorPosition = null;\n\n      if (brackets) {\n        if (brackets[0].containsPosition(position)) {\n          newCursorPosition = brackets[1].getStartPosition();\n        } else if (brackets[1].containsPosition(position)) {\n          newCursorPosition = brackets[0].getStartPosition();\n        }\n      } else {\n        // find the enclosing brackets if the position isn't on a matching bracket\n        var enclosingBrackets = model.findEnclosingBrackets(position);\n\n        if (enclosingBrackets) {\n          newCursorPosition = enclosingBrackets[0].getStartPosition();\n        } else {\n          // no enclosing brackets, try the very first next bracket\n          var nextBracket = model.findNextBracket(position);\n\n          if (nextBracket && nextBracket.range) {\n            newCursorPosition = nextBracket.range.getStartPosition();\n          }\n        }\n      }\n\n      if (newCursorPosition) {\n        return new Selection(newCursorPosition.lineNumber, newCursorPosition.column, newCursorPosition.lineNumber, newCursorPosition.column);\n      }\n\n      return new Selection(position.lineNumber, position.column, position.lineNumber, position.column);\n    });\n\n    this._editor.setSelections(newSelections);\n\n    this._editor.revealRange(newSelections[0]);\n  };\n\n  BracketMatchingController.prototype.selectToBracket = function (selectBrackets) {\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    var model = this._editor.getModel();\n\n    var newSelections = [];\n\n    this._editor.getSelections().forEach(function (selection) {\n      var position = selection.getStartPosition();\n      var brackets = model.matchBracket(position);\n\n      if (!brackets) {\n        brackets = model.findEnclosingBrackets(position);\n\n        if (!brackets) {\n          var nextBracket = model.findNextBracket(position);\n\n          if (nextBracket && nextBracket.range) {\n            brackets = model.matchBracket(nextBracket.range.getStartPosition());\n          }\n        }\n      }\n\n      var selectFrom = null;\n      var selectTo = null;\n\n      if (brackets) {\n        brackets.sort(Range.compareRangesUsingStarts);\n        var open_1 = brackets[0],\n            close_1 = brackets[1];\n        selectFrom = selectBrackets ? open_1.getStartPosition() : open_1.getEndPosition();\n        selectTo = selectBrackets ? close_1.getEndPosition() : close_1.getStartPosition();\n      }\n\n      if (selectFrom && selectTo) {\n        newSelections.push(new Selection(selectFrom.lineNumber, selectFrom.column, selectTo.lineNumber, selectTo.column));\n      }\n    });\n\n    if (newSelections.length > 0) {\n      this._editor.setSelections(newSelections);\n\n      this._editor.revealRange(newSelections[0]);\n    }\n  };\n\n  BracketMatchingController.prototype._updateBrackets = function () {\n    if (this._matchBrackets === 'never') {\n      return;\n    }\n\n    this._recomputeBrackets();\n\n    var newDecorations = [],\n        newDecorationsLen = 0;\n\n    for (var _i = 0, _a = this._lastBracketsData; _i < _a.length; _i++) {\n      var bracketData = _a[_i];\n      var brackets = bracketData.brackets;\n\n      if (brackets) {\n        newDecorations[newDecorationsLen++] = {\n          range: brackets[0],\n          options: bracketData.options\n        };\n        newDecorations[newDecorationsLen++] = {\n          range: brackets[1],\n          options: bracketData.options\n        };\n      }\n    }\n\n    this._decorations = this._editor.deltaDecorations(this._decorations, newDecorations);\n  };\n\n  BracketMatchingController.prototype._recomputeBrackets = function () {\n    if (!this._editor.hasModel()) {\n      // no model => no brackets!\n      this._lastBracketsData = [];\n      this._lastVersionId = 0;\n      return;\n    }\n\n    var selections = this._editor.getSelections();\n\n    if (selections.length > 100) {\n      // no bracket matching for high numbers of selections\n      this._lastBracketsData = [];\n      this._lastVersionId = 0;\n      return;\n    }\n\n    var model = this._editor.getModel();\n\n    var versionId = model.getVersionId();\n    var previousData = [];\n\n    if (this._lastVersionId === versionId) {\n      // use the previous data only if the model is at the same version id\n      previousData = this._lastBracketsData;\n    }\n\n    var positions = [],\n        positionsLen = 0;\n\n    for (var i = 0, len = selections.length; i < len; i++) {\n      var selection = selections[i];\n\n      if (selection.isEmpty()) {\n        // will bracket match a cursor only if the selection is collapsed\n        positions[positionsLen++] = selection.getStartPosition();\n      }\n    } // sort positions for `previousData` cache hits\n\n\n    if (positions.length > 1) {\n      positions.sort(Position.compare);\n    }\n\n    var newData = [],\n        newDataLen = 0;\n    var previousIndex = 0,\n        previousLen = previousData.length;\n\n    for (var i = 0, len = positions.length; i < len; i++) {\n      var position = positions[i];\n\n      while (previousIndex < previousLen && previousData[previousIndex].position.isBefore(position)) {\n        previousIndex++;\n      }\n\n      if (previousIndex < previousLen && previousData[previousIndex].position.equals(position)) {\n        newData[newDataLen++] = previousData[previousIndex];\n      } else {\n        var brackets = model.matchBracket(position);\n        var options = BracketMatchingController._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;\n\n        if (!brackets && this._matchBrackets === 'always') {\n          brackets = model.findEnclosingBrackets(position, 20\n          /* give at most 20ms to compute */\n          );\n          options = BracketMatchingController._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER;\n        }\n\n        newData[newDataLen++] = new BracketsData(position, brackets, options);\n      }\n    }\n\n    this._lastBracketsData = newData;\n    this._lastVersionId = versionId;\n  };\n\n  BracketMatchingController.ID = 'editor.contrib.bracketMatchingController';\n  BracketMatchingController._DECORATION_OPTIONS_WITH_OVERVIEW_RULER = ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    className: 'bracket-match',\n    overviewRuler: {\n      color: themeColorFromId(overviewRulerBracketMatchForeground),\n      position: OverviewRulerLane.Center\n    }\n  });\n  BracketMatchingController._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER = ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    className: 'bracket-match'\n  });\n  return BracketMatchingController;\n}(Disposable);\n\nexport { BracketMatchingController };\nregisterEditorContribution(BracketMatchingController.ID, BracketMatchingController);\nregisterEditorAction(SelectToBracketAction);\nregisterEditorAction(JumpToBracketAction);\nregisterThemingParticipant(function (theme, collector) {\n  var bracketMatchBackground = theme.getColor(editorBracketMatchBackground);\n\n  if (bracketMatchBackground) {\n    collector.addRule(\".monaco-editor .bracket-match { background-color: \" + bracketMatchBackground + \"; }\");\n  }\n\n  var bracketMatchBorder = theme.getColor(editorBracketMatchBorder);\n\n  if (bracketMatchBorder) {\n    collector.addRule(\".monaco-editor .bracket-match { border: 1px solid \" + bracketMatchBorder + \"; }\");\n  }\n}); // Go to menu\n\nMenuRegistry.appendMenuItem(19\n/* MenubarGoMenu */\n, {\n  group: '5_infile_nav',\n  command: {\n    id: 'editor.action.jumpToBracket',\n    title: nls.localize({\n      key: 'miGoToBracket',\n      comment: ['&& denotes a mnemonic']\n    }, \"Go to &&Bracket\")\n  },\n  order: 2\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/bracketMatching/bracketMatching.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","nls","RunOnceScheduler","Disposable","EditorAction","registerEditorAction","registerEditorContribution","Position","Range","Selection","EditorContextKeys","OverviewRulerLane","ModelDecorationOptions","editorBracketMatchBackground","editorBracketMatchBorder","registerColor","registerThemingParticipant","themeColorFromId","MenuRegistry","overviewRulerBracketMatchForeground","dark","light","hc","localize","JumpToBracketAction","_super","call","id","label","alias","precondition","undefined","kbOpts","kbExpr","editorTextFocus","primary","weight","run","accessor","editor","controller","BracketMatchingController","get","jumpToBracket","SelectToBracketAction","description","args","name","schema","type","properties","default","selectBrackets","selectToBracket","BracketsData","position","brackets","options","_this","_editor","_lastBracketsData","_lastVersionId","_decorations","_updateBracketsSoon","_register","_updateBrackets","_matchBrackets","getOption","schedule","onDidChangeCursorPosition","e","onDidChangeModelContent","onDidChangeModel","onDidChangeModelLanguageConfiguration","onDidChangeConfiguration","hasChanged","deltaDecorations","getContribution","ID","hasModel","model","getModel","newSelections","getSelections","map","selection","getStartPosition","matchBracket","newCursorPosition","containsPosition","enclosingBrackets","findEnclosingBrackets","nextBracket","findNextBracket","range","lineNumber","column","setSelections","revealRange","forEach","selectFrom","selectTo","sort","compareRangesUsingStarts","open_1","close_1","getEndPosition","push","length","_recomputeBrackets","newDecorations","newDecorationsLen","_i","_a","bracketData","selections","versionId","getVersionId","previousData","positions","positionsLen","i","len","isEmpty","compare","newData","newDataLen","previousIndex","previousLen","isBefore","equals","_DECORATION_OPTIONS_WITH_OVERVIEW_RULER","_DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER","register","stickiness","className","overviewRuler","color","Center","theme","collector","bracketMatchBackground","getColor","addRule","bracketMatchBorder","appendMenuItem","group","command","title","key","comment","order"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './bracketMatching.css';\r\nimport * as nls from '../../../nls.js';\r\nimport { RunOnceScheduler } from '../../../base/common/async.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { OverviewRulerLane } from '../../common/model.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { editorBracketMatchBackground, editorBracketMatchBorder } from '../../common/view/editorColorRegistry.js';\r\nimport { registerColor } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant, themeColorFromId } from '../../../platform/theme/common/themeService.js';\r\nimport { MenuRegistry } from '../../../platform/actions/common/actions.js';\r\nvar overviewRulerBracketMatchForeground = registerColor('editorOverviewRuler.bracketMatchForeground', { dark: '#A0A0A0', light: '#A0A0A0', hc: '#A0A0A0' }, nls.localize('overviewRulerBracketMatchForeground', 'Overview ruler marker color for matching brackets.'));\r\nvar JumpToBracketAction = /** @class */ (function (_super) {\r\n    __extends(JumpToBracketAction, _super);\r\n    function JumpToBracketAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.jumpToBracket',\r\n            label: nls.localize('smartSelect.jumpBracket', \"Go to Bracket\"),\r\n            alias: 'Go to Bracket',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 88 /* US_BACKSLASH */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    JumpToBracketAction.prototype.run = function (accessor, editor) {\r\n        var controller = BracketMatchingController.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        controller.jumpToBracket();\r\n    };\r\n    return JumpToBracketAction;\r\n}(EditorAction));\r\nvar SelectToBracketAction = /** @class */ (function (_super) {\r\n    __extends(SelectToBracketAction, _super);\r\n    function SelectToBracketAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.selectToBracket',\r\n            label: nls.localize('smartSelect.selectToBracket', \"Select to Bracket\"),\r\n            alias: 'Select to Bracket',\r\n            precondition: undefined,\r\n            description: {\r\n                description: \"Select to Bracket\",\r\n                args: [{\r\n                        name: 'args',\r\n                        schema: {\r\n                            type: 'object',\r\n                            properties: {\r\n                                'selectBrackets': {\r\n                                    type: 'boolean',\r\n                                    default: true\r\n                                }\r\n                            },\r\n                        }\r\n                    }]\r\n            }\r\n        }) || this;\r\n    }\r\n    SelectToBracketAction.prototype.run = function (accessor, editor, args) {\r\n        var controller = BracketMatchingController.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        var selectBrackets = true;\r\n        if (args && args.selectBrackets === false) {\r\n            selectBrackets = false;\r\n        }\r\n        controller.selectToBracket(selectBrackets);\r\n    };\r\n    return SelectToBracketAction;\r\n}(EditorAction));\r\nvar BracketsData = /** @class */ (function () {\r\n    function BracketsData(position, brackets, options) {\r\n        this.position = position;\r\n        this.brackets = brackets;\r\n        this.options = options;\r\n    }\r\n    return BracketsData;\r\n}());\r\nvar BracketMatchingController = /** @class */ (function (_super) {\r\n    __extends(BracketMatchingController, _super);\r\n    function BracketMatchingController(editor) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = editor;\r\n        _this._lastBracketsData = [];\r\n        _this._lastVersionId = 0;\r\n        _this._decorations = [];\r\n        _this._updateBracketsSoon = _this._register(new RunOnceScheduler(function () { return _this._updateBrackets(); }, 50));\r\n        _this._matchBrackets = _this._editor.getOption(53 /* matchBrackets */);\r\n        _this._updateBracketsSoon.schedule();\r\n        _this._register(editor.onDidChangeCursorPosition(function (e) {\r\n            if (_this._matchBrackets === 'never') {\r\n                // Early exit if nothing needs to be done!\r\n                // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\r\n                return;\r\n            }\r\n            _this._updateBracketsSoon.schedule();\r\n        }));\r\n        _this._register(editor.onDidChangeModelContent(function (e) {\r\n            _this._updateBracketsSoon.schedule();\r\n        }));\r\n        _this._register(editor.onDidChangeModel(function (e) {\r\n            _this._lastBracketsData = [];\r\n            _this._decorations = [];\r\n            _this._updateBracketsSoon.schedule();\r\n        }));\r\n        _this._register(editor.onDidChangeModelLanguageConfiguration(function (e) {\r\n            _this._lastBracketsData = [];\r\n            _this._updateBracketsSoon.schedule();\r\n        }));\r\n        _this._register(editor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(53 /* matchBrackets */)) {\r\n                _this._matchBrackets = _this._editor.getOption(53 /* matchBrackets */);\r\n                _this._decorations = _this._editor.deltaDecorations(_this._decorations, []);\r\n                _this._lastBracketsData = [];\r\n                _this._lastVersionId = 0;\r\n                _this._updateBracketsSoon.schedule();\r\n            }\r\n        }));\r\n        return _this;\r\n    }\r\n    BracketMatchingController.get = function (editor) {\r\n        return editor.getContribution(BracketMatchingController.ID);\r\n    };\r\n    BracketMatchingController.prototype.jumpToBracket = function () {\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var newSelections = this._editor.getSelections().map(function (selection) {\r\n            var position = selection.getStartPosition();\r\n            // find matching brackets if position is on a bracket\r\n            var brackets = model.matchBracket(position);\r\n            var newCursorPosition = null;\r\n            if (brackets) {\r\n                if (brackets[0].containsPosition(position)) {\r\n                    newCursorPosition = brackets[1].getStartPosition();\r\n                }\r\n                else if (brackets[1].containsPosition(position)) {\r\n                    newCursorPosition = brackets[0].getStartPosition();\r\n                }\r\n            }\r\n            else {\r\n                // find the enclosing brackets if the position isn't on a matching bracket\r\n                var enclosingBrackets = model.findEnclosingBrackets(position);\r\n                if (enclosingBrackets) {\r\n                    newCursorPosition = enclosingBrackets[0].getStartPosition();\r\n                }\r\n                else {\r\n                    // no enclosing brackets, try the very first next bracket\r\n                    var nextBracket = model.findNextBracket(position);\r\n                    if (nextBracket && nextBracket.range) {\r\n                        newCursorPosition = nextBracket.range.getStartPosition();\r\n                    }\r\n                }\r\n            }\r\n            if (newCursorPosition) {\r\n                return new Selection(newCursorPosition.lineNumber, newCursorPosition.column, newCursorPosition.lineNumber, newCursorPosition.column);\r\n            }\r\n            return new Selection(position.lineNumber, position.column, position.lineNumber, position.column);\r\n        });\r\n        this._editor.setSelections(newSelections);\r\n        this._editor.revealRange(newSelections[0]);\r\n    };\r\n    BracketMatchingController.prototype.selectToBracket = function (selectBrackets) {\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var newSelections = [];\r\n        this._editor.getSelections().forEach(function (selection) {\r\n            var position = selection.getStartPosition();\r\n            var brackets = model.matchBracket(position);\r\n            if (!brackets) {\r\n                brackets = model.findEnclosingBrackets(position);\r\n                if (!brackets) {\r\n                    var nextBracket = model.findNextBracket(position);\r\n                    if (nextBracket && nextBracket.range) {\r\n                        brackets = model.matchBracket(nextBracket.range.getStartPosition());\r\n                    }\r\n                }\r\n            }\r\n            var selectFrom = null;\r\n            var selectTo = null;\r\n            if (brackets) {\r\n                brackets.sort(Range.compareRangesUsingStarts);\r\n                var open_1 = brackets[0], close_1 = brackets[1];\r\n                selectFrom = selectBrackets ? open_1.getStartPosition() : open_1.getEndPosition();\r\n                selectTo = selectBrackets ? close_1.getEndPosition() : close_1.getStartPosition();\r\n            }\r\n            if (selectFrom && selectTo) {\r\n                newSelections.push(new Selection(selectFrom.lineNumber, selectFrom.column, selectTo.lineNumber, selectTo.column));\r\n            }\r\n        });\r\n        if (newSelections.length > 0) {\r\n            this._editor.setSelections(newSelections);\r\n            this._editor.revealRange(newSelections[0]);\r\n        }\r\n    };\r\n    BracketMatchingController.prototype._updateBrackets = function () {\r\n        if (this._matchBrackets === 'never') {\r\n            return;\r\n        }\r\n        this._recomputeBrackets();\r\n        var newDecorations = [], newDecorationsLen = 0;\r\n        for (var _i = 0, _a = this._lastBracketsData; _i < _a.length; _i++) {\r\n            var bracketData = _a[_i];\r\n            var brackets = bracketData.brackets;\r\n            if (brackets) {\r\n                newDecorations[newDecorationsLen++] = { range: brackets[0], options: bracketData.options };\r\n                newDecorations[newDecorationsLen++] = { range: brackets[1], options: bracketData.options };\r\n            }\r\n        }\r\n        this._decorations = this._editor.deltaDecorations(this._decorations, newDecorations);\r\n    };\r\n    BracketMatchingController.prototype._recomputeBrackets = function () {\r\n        if (!this._editor.hasModel()) {\r\n            // no model => no brackets!\r\n            this._lastBracketsData = [];\r\n            this._lastVersionId = 0;\r\n            return;\r\n        }\r\n        var selections = this._editor.getSelections();\r\n        if (selections.length > 100) {\r\n            // no bracket matching for high numbers of selections\r\n            this._lastBracketsData = [];\r\n            this._lastVersionId = 0;\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var versionId = model.getVersionId();\r\n        var previousData = [];\r\n        if (this._lastVersionId === versionId) {\r\n            // use the previous data only if the model is at the same version id\r\n            previousData = this._lastBracketsData;\r\n        }\r\n        var positions = [], positionsLen = 0;\r\n        for (var i = 0, len = selections.length; i < len; i++) {\r\n            var selection = selections[i];\r\n            if (selection.isEmpty()) {\r\n                // will bracket match a cursor only if the selection is collapsed\r\n                positions[positionsLen++] = selection.getStartPosition();\r\n            }\r\n        }\r\n        // sort positions for `previousData` cache hits\r\n        if (positions.length > 1) {\r\n            positions.sort(Position.compare);\r\n        }\r\n        var newData = [], newDataLen = 0;\r\n        var previousIndex = 0, previousLen = previousData.length;\r\n        for (var i = 0, len = positions.length; i < len; i++) {\r\n            var position = positions[i];\r\n            while (previousIndex < previousLen && previousData[previousIndex].position.isBefore(position)) {\r\n                previousIndex++;\r\n            }\r\n            if (previousIndex < previousLen && previousData[previousIndex].position.equals(position)) {\r\n                newData[newDataLen++] = previousData[previousIndex];\r\n            }\r\n            else {\r\n                var brackets = model.matchBracket(position);\r\n                var options = BracketMatchingController._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;\r\n                if (!brackets && this._matchBrackets === 'always') {\r\n                    brackets = model.findEnclosingBrackets(position, 20 /* give at most 20ms to compute */);\r\n                    options = BracketMatchingController._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER;\r\n                }\r\n                newData[newDataLen++] = new BracketsData(position, brackets, options);\r\n            }\r\n        }\r\n        this._lastBracketsData = newData;\r\n        this._lastVersionId = versionId;\r\n    };\r\n    BracketMatchingController.ID = 'editor.contrib.bracketMatchingController';\r\n    BracketMatchingController._DECORATION_OPTIONS_WITH_OVERVIEW_RULER = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        className: 'bracket-match',\r\n        overviewRuler: {\r\n            color: themeColorFromId(overviewRulerBracketMatchForeground),\r\n            position: OverviewRulerLane.Center\r\n        }\r\n    });\r\n    BracketMatchingController._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        className: 'bracket-match'\r\n    });\r\n    return BracketMatchingController;\r\n}(Disposable));\r\nexport { BracketMatchingController };\r\nregisterEditorContribution(BracketMatchingController.ID, BracketMatchingController);\r\nregisterEditorAction(SelectToBracketAction);\r\nregisterEditorAction(JumpToBracketAction);\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var bracketMatchBackground = theme.getColor(editorBracketMatchBackground);\r\n    if (bracketMatchBackground) {\r\n        collector.addRule(\".monaco-editor .bracket-match { background-color: \" + bracketMatchBackground + \"; }\");\r\n    }\r\n    var bracketMatchBorder = theme.getColor(editorBracketMatchBorder);\r\n    if (bracketMatchBorder) {\r\n        collector.addRule(\".monaco-editor .bracket-match { border: 1px solid \" + bracketMatchBorder + \"; }\");\r\n    }\r\n});\r\n// Go to menu\r\nMenuRegistry.appendMenuItem(19 /* MenubarGoMenu */, {\r\n    group: '5_infile_nav',\r\n    command: {\r\n        id: 'editor.action.jumpToBracket',\r\n        title: nls.localize({ key: 'miGoToBracket', comment: ['&& denotes a mnemonic'] }, \"Go to &&Bracket\")\r\n    },\r\n    order: 2\r\n});\r\n"]},"metadata":{},"sourceType":"module"}