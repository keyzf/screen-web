{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport * as nls from '../../../nls.js';\nimport { illegalArgument, onUnexpectedError } from '../../../base/common/errors.js';\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\nimport { IEditorProgressService } from '../../../platform/progress/common/progress.js';\nimport { registerEditorAction, registerEditorContribution, EditorAction, EditorCommand, registerEditorCommand, registerDefaultLanguageCommand } from '../../browser/editorExtensions.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { RenameInputField, CONTEXT_RENAME_INPUT_VISIBLE } from './renameInputField.js';\nimport { RenameProviderRegistry } from '../../common/modes.js';\nimport { Position } from '../../common/core/position.js';\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\nimport { Range } from '../../common/core/range.js';\nimport { MessageController } from '../message/messageController.js';\nimport { EditorStateCancellationTokenSource } from '../../browser/core/editorState.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { IBulkEditService } from '../../browser/services/bulkEditService.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { IdleValue, raceCancellation } from '../../../base/common/async.js';\nimport { withNullAsUndefined } from '../../../base/common/types.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { Registry } from '../../../platform/registry/common/platform.js';\nimport { Extensions } from '../../../platform/configuration/common/configurationRegistry.js';\nimport { ITextResourceConfigurationService } from '../../common/services/textResourceConfigurationService.js';\n\nvar RenameSkeleton =\n/** @class */\nfunction () {\n  function RenameSkeleton(model, position) {\n    this.model = model;\n    this.position = position;\n    this._providers = RenameProviderRegistry.ordered(model);\n  }\n\n  RenameSkeleton.prototype.hasProvider = function () {\n    return this._providers.length > 0;\n  };\n\n  RenameSkeleton.prototype.resolveRenameLocation = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var firstProvider, res, _a, word;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            firstProvider = this._providers[0];\n\n            if (!firstProvider) {\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            if (!firstProvider.resolveRenameLocation) return [3\n            /*break*/\n            , 2];\n            _a = withNullAsUndefined;\n            return [4\n            /*yield*/\n            , firstProvider.resolveRenameLocation(this.model, this.position, token)];\n\n          case 1:\n            res = _a.apply(void 0, [_b.sent()]);\n            _b.label = 2;\n\n          case 2:\n            if (!res) {\n              word = this.model.getWordAtPosition(this.position);\n\n              if (word) {\n                return [2\n                /*return*/\n                , {\n                  range: new Range(this.position.lineNumber, word.startColumn, this.position.lineNumber, word.endColumn),\n                  text: word.word\n                }];\n              }\n            }\n\n            return [2\n            /*return*/\n            , res];\n        }\n      });\n    });\n  };\n\n  RenameSkeleton.prototype.provideRenameEdits = function (newName, i, rejects, token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var provider, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            provider = this._providers[i];\n\n            if (!provider) {\n              return [2\n              /*return*/\n              , {\n                edits: [],\n                rejectReason: rejects.join('\\n')\n              }];\n            }\n\n            return [4\n            /*yield*/\n            , provider.provideRenameEdits(this.model, this.position, newName, token)];\n\n          case 1:\n            result = _a.sent();\n\n            if (!result) {\n              return [2\n              /*return*/\n              , this.provideRenameEdits(newName, i + 1, rejects.concat(nls.localize('no result', \"No result.\")), token)];\n            } else if (result.rejectReason) {\n              return [2\n              /*return*/\n              , this.provideRenameEdits(newName, i + 1, rejects.concat(result.rejectReason), token)];\n            }\n\n            return [2\n            /*return*/\n            , result];\n        }\n      });\n    });\n  };\n\n  return RenameSkeleton;\n}();\n\nexport function rename(model, position, newName) {\n  return __awaiter(this, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n      return [2\n      /*return*/\n      , new RenameSkeleton(model, position).provideRenameEdits(newName, 0, [], CancellationToken.None)];\n    });\n  });\n} // ---  register actions and commands\n\nvar RenameController =\n/** @class */\nfunction () {\n  function RenameController(editor, _instaService, _notificationService, _bulkEditService, _progressService, _logService, _configService) {\n    var _this = this;\n\n    this.editor = editor;\n    this._instaService = _instaService;\n    this._notificationService = _notificationService;\n    this._bulkEditService = _bulkEditService;\n    this._progressService = _progressService;\n    this._logService = _logService;\n    this._configService = _configService;\n    this._dispoableStore = new DisposableStore();\n    this._cts = new CancellationTokenSource();\n    this._renameInputField = this._dispoableStore.add(new IdleValue(function () {\n      return _this._dispoableStore.add(_this._instaService.createInstance(RenameInputField, _this.editor, ['acceptRenameInput', 'acceptRenameInputWithPreview']));\n    }));\n  }\n\n  RenameController.get = function (editor) {\n    return editor.getContribution(RenameController.ID);\n  };\n\n  RenameController.prototype.dispose = function () {\n    this._dispoableStore.dispose();\n\n    this._cts.dispose(true);\n  };\n\n  RenameController.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var position, skeleton, loc, resolveLocationOperation, e_1, selection, selectionStart, selectionEnd, supportPreview, inputFieldResult, renameOperation;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this._cts.dispose(true);\n\n            if (!this.editor.hasModel()) {\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            position = this.editor.getPosition();\n            skeleton = new RenameSkeleton(this.editor.getModel(), position);\n\n            if (!skeleton.hasProvider()) {\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            this._cts = new EditorStateCancellationTokenSource(this.editor, 4\n            /* Position */\n            | 1\n            /* Value */\n            );\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n\n            resolveLocationOperation = skeleton.resolveRenameLocation(this._cts.token);\n\n            this._progressService.showWhile(resolveLocationOperation, 250);\n\n            return [4\n            /*yield*/\n            , resolveLocationOperation];\n\n          case 2:\n            loc = _a.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_1 = _a.sent();\n            MessageController.get(this.editor).showMessage(e_1 || nls.localize('resolveRenameLocationFailed', \"An unknown error occurred while resolving rename location\"), position);\n            return [2\n            /*return*/\n            , undefined];\n\n          case 4:\n            if (!loc) {\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            if (loc.rejectReason) {\n              MessageController.get(this.editor).showMessage(loc.rejectReason, position);\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            if (this._cts.token.isCancellationRequested) {\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            selection = this.editor.getSelection();\n            selectionStart = 0;\n            selectionEnd = loc.text.length;\n\n            if (!Range.isEmpty(selection) && !Range.spansMultipleLines(selection) && Range.containsRange(loc.range, selection)) {\n              selectionStart = Math.max(0, selection.startColumn - loc.range.startColumn);\n              selectionEnd = Math.min(loc.range.endColumn, selection.endColumn) - loc.range.startColumn;\n            }\n\n            supportPreview = this._bulkEditService.hasPreviewHandler() && this._configService.getValue(this.editor.getModel().uri, 'editor.rename.enablePreview');\n            return [4\n            /*yield*/\n            , this._renameInputField.getValue().getInput(loc.range, loc.text, selectionStart, selectionEnd, supportPreview)];\n\n          case 5:\n            inputFieldResult = _a.sent(); // no result, only hint to focus the editor or not\n\n            if (typeof inputFieldResult === 'boolean') {\n              if (inputFieldResult) {\n                this.editor.focus();\n              }\n\n              return [2\n              /*return*/\n              , undefined];\n            }\n\n            this.editor.focus();\n            renameOperation = raceCancellation(skeleton.provideRenameEdits(inputFieldResult.newName, 0, [], this._cts.token), this._cts.token).then(function (renameResult) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var _this = this;\n\n                return __generator(this, function (_a) {\n                  if (!renameResult || !this.editor.hasModel()) {\n                    return [2\n                    /*return*/\n                    ];\n                  }\n\n                  if (renameResult.rejectReason) {\n                    this._notificationService.info(renameResult.rejectReason);\n\n                    return [2\n                    /*return*/\n                    ];\n                  }\n\n                  this._bulkEditService.apply(renameResult, {\n                    editor: this.editor,\n                    showPreview: inputFieldResult.wantsPreview,\n                    label: nls.localize('label', \"Renaming '{0}'\", loc === null || loc === void 0 ? void 0 : loc.text)\n                  }).then(function (result) {\n                    if (result.ariaSummary) {\n                      alert(nls.localize('aria', \"Successfully renamed '{0}' to '{1}'. Summary: {2}\", loc.text, inputFieldResult.newName, result.ariaSummary));\n                    }\n                  }).catch(function (err) {\n                    _this._notificationService.error(nls.localize('rename.failedApply', \"Rename failed to apply edits\"));\n\n                    _this._logService.error(err);\n                  });\n\n                  return [2\n                  /*return*/\n                  ];\n                });\n              });\n            }, function (err) {\n              _this._notificationService.error(nls.localize('rename.failed', \"Rename failed to compute edits\"));\n\n              _this._logService.error(err);\n            });\n\n            this._progressService.showWhile(renameOperation, 250);\n\n            return [2\n            /*return*/\n            , renameOperation];\n        }\n      });\n    });\n  };\n\n  RenameController.prototype.acceptRenameInput = function (wantsPreview) {\n    this._renameInputField.getValue().acceptInput(wantsPreview);\n  };\n\n  RenameController.prototype.cancelRenameInput = function () {\n    this._renameInputField.getValue().cancelInput(true);\n  };\n\n  RenameController.ID = 'editor.contrib.renameController';\n  RenameController = __decorate([__param(1, IInstantiationService), __param(2, INotificationService), __param(3, IBulkEditService), __param(4, IEditorProgressService), __param(5, ILogService), __param(6, ITextResourceConfigurationService)], RenameController);\n  return RenameController;\n}(); // ---- action implementation\n\n\nvar RenameAction =\n/** @class */\nfunction (_super) {\n  __extends(RenameAction, _super);\n\n  function RenameAction() {\n    return _super.call(this, {\n      id: 'editor.action.rename',\n      label: nls.localize('rename.label', \"Rename Symbol\"),\n      alias: 'Rename Symbol',\n      precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasRenameProvider),\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 60\n        /* F2 */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      },\n      contextMenuOpts: {\n        group: '1_modification',\n        order: 1.1\n      }\n    }) || this;\n  }\n\n  RenameAction.prototype.runCommand = function (accessor, args) {\n    var _this = this;\n\n    var editorService = accessor.get(ICodeEditorService);\n\n    var _a = Array.isArray(args) && args || [undefined, undefined],\n        uri = _a[0],\n        pos = _a[1];\n\n    if (URI.isUri(uri) && Position.isIPosition(pos)) {\n      return editorService.openCodeEditor({\n        resource: uri\n      }, editorService.getActiveCodeEditor()).then(function (editor) {\n        if (!editor) {\n          return;\n        }\n\n        editor.setPosition(pos);\n        editor.invokeWithinContext(function (accessor) {\n          _this.reportTelemetry(accessor, editor);\n\n          return _this.run(accessor, editor);\n        });\n      }, onUnexpectedError);\n    }\n\n    return _super.prototype.runCommand.call(this, accessor, args);\n  };\n\n  RenameAction.prototype.run = function (accessor, editor) {\n    var controller = RenameController.get(editor);\n\n    if (controller) {\n      return controller.run();\n    }\n\n    return Promise.resolve();\n  };\n\n  return RenameAction;\n}(EditorAction);\n\nexport { RenameAction };\nregisterEditorContribution(RenameController.ID, RenameController);\nregisterEditorAction(RenameAction);\nvar RenameCommand = EditorCommand.bindToContribution(RenameController.get);\nregisterEditorCommand(new RenameCommand({\n  id: 'acceptRenameInput',\n  precondition: CONTEXT_RENAME_INPUT_VISIBLE,\n  handler: function (x) {\n    return x.acceptRenameInput(false);\n  },\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 99,\n    kbExpr: EditorContextKeys.focus,\n    primary: 3\n    /* Enter */\n\n  }\n}));\nregisterEditorCommand(new RenameCommand({\n  id: 'acceptRenameInputWithPreview',\n  precondition: ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE, ContextKeyExpr.has('config.editor.rename.enablePreview')),\n  handler: function (x) {\n    return x.acceptRenameInput(true);\n  },\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 99,\n    kbExpr: EditorContextKeys.focus,\n    primary: 1024\n    /* Shift */\n    + 3\n    /* Enter */\n\n  }\n}));\nregisterEditorCommand(new RenameCommand({\n  id: 'cancelRenameInput',\n  precondition: CONTEXT_RENAME_INPUT_VISIBLE,\n  handler: function (x) {\n    return x.cancelRenameInput();\n  },\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 99,\n    kbExpr: EditorContextKeys.focus,\n    primary: 9\n    /* Escape */\n    ,\n    secondary: [1024\n    /* Shift */\n    | 9\n    /* Escape */\n    ]\n  }\n})); // ---- api bridge command\n\nregisterDefaultLanguageCommand('_executeDocumentRenameProvider', function (model, position, args) {\n  var newName = args.newName;\n\n  if (typeof newName !== 'string') {\n    throw illegalArgument('newName');\n  }\n\n  return rename(model, position, newName);\n}); //todo@joh use editor options world\n\nRegistry.as(Extensions.Configuration).registerConfiguration({\n  id: 'editor',\n  properties: {\n    'editor.rename.enablePreview': {\n      scope: 5\n      /* LANGUAGE_OVERRIDABLE */\n      ,\n      description: nls.localize('enablePreview', \"Enable/disable the ability to preview changes before renaming\"),\n      default: true,\n      type: 'boolean'\n    }\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/rename/rename.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","push","nls","illegalArgument","onUnexpectedError","ContextKeyExpr","IEditorProgressService","registerEditorAction","registerEditorContribution","EditorAction","EditorCommand","registerEditorCommand","registerDefaultLanguageCommand","EditorContextKeys","RenameInputField","CONTEXT_RENAME_INPUT_VISIBLE","RenameProviderRegistry","Position","alert","Range","MessageController","EditorStateCancellationTokenSource","INotificationService","IBulkEditService","URI","ICodeEditorService","CancellationToken","CancellationTokenSource","DisposableStore","IdleValue","raceCancellation","withNullAsUndefined","ILogService","IInstantiationService","Registry","Extensions","ITextResourceConfigurationService","RenameSkeleton","model","position","_providers","ordered","hasProvider","resolveRenameLocation","token","firstProvider","res","_a","word","_b","undefined","getWordAtPosition","range","lineNumber","startColumn","endColumn","text","provideRenameEdits","newName","rejects","provider","edits","rejectReason","join","concat","localize","rename","None","RenameController","editor","_instaService","_notificationService","_bulkEditService","_progressService","_logService","_configService","_this","_dispoableStore","_cts","_renameInputField","add","createInstance","get","getContribution","ID","dispose","run","skeleton","loc","resolveLocationOperation","e_1","selection","selectionStart","selectionEnd","supportPreview","inputFieldResult","renameOperation","hasModel","getPosition","getModel","showWhile","showMessage","isCancellationRequested","getSelection","isEmpty","spansMultipleLines","containsRange","Math","max","min","hasPreviewHandler","getValue","uri","getInput","focus","renameResult","info","showPreview","wantsPreview","ariaSummary","catch","err","error","acceptRenameInput","acceptInput","cancelRenameInput","cancelInput","RenameAction","_super","id","alias","precondition","and","writable","hasRenameProvider","kbOpts","kbExpr","editorTextFocus","primary","weight","contextMenuOpts","group","order","runCommand","accessor","args","editorService","isArray","pos","isUri","isIPosition","openCodeEditor","resource","getActiveCodeEditor","setPosition","invokeWithinContext","reportTelemetry","controller","RenameCommand","bindToContribution","handler","x","has","secondary","as","Configuration","registerConfiguration","properties","scope","description","default","type"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport * as nls from '../../../nls.js';\r\nimport { illegalArgument, onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { IEditorProgressService } from '../../../platform/progress/common/progress.js';\r\nimport { registerEditorAction, registerEditorContribution, EditorAction, EditorCommand, registerEditorCommand, registerDefaultLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { RenameInputField, CONTEXT_RENAME_INPUT_VISIBLE } from './renameInputField.js';\r\nimport { RenameProviderRegistry } from '../../common/modes.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { MessageController } from '../message/messageController.js';\r\nimport { EditorStateCancellationTokenSource } from '../../browser/core/editorState.js';\r\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\r\nimport { IBulkEditService } from '../../browser/services/bulkEditService.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\r\nimport { CancellationToken, CancellationTokenSource } from '../../../base/common/cancellation.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { IdleValue, raceCancellation } from '../../../base/common/async.js';\r\nimport { withNullAsUndefined } from '../../../base/common/types.js';\r\nimport { ILogService } from '../../../platform/log/common/log.js';\r\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { Registry } from '../../../platform/registry/common/platform.js';\r\nimport { Extensions } from '../../../platform/configuration/common/configurationRegistry.js';\r\nimport { ITextResourceConfigurationService } from '../../common/services/textResourceConfigurationService.js';\r\nvar RenameSkeleton = /** @class */ (function () {\r\n    function RenameSkeleton(model, position) {\r\n        this.model = model;\r\n        this.position = position;\r\n        this._providers = RenameProviderRegistry.ordered(model);\r\n    }\r\n    RenameSkeleton.prototype.hasProvider = function () {\r\n        return this._providers.length > 0;\r\n    };\r\n    RenameSkeleton.prototype.resolveRenameLocation = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var firstProvider, res, _a, word;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        firstProvider = this._providers[0];\r\n                        if (!firstProvider) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        if (!firstProvider.resolveRenameLocation) return [3 /*break*/, 2];\r\n                        _a = withNullAsUndefined;\r\n                        return [4 /*yield*/, firstProvider.resolveRenameLocation(this.model, this.position, token)];\r\n                    case 1:\r\n                        res = _a.apply(void 0, [_b.sent()]);\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        if (!res) {\r\n                            word = this.model.getWordAtPosition(this.position);\r\n                            if (word) {\r\n                                return [2 /*return*/, {\r\n                                        range: new Range(this.position.lineNumber, word.startColumn, this.position.lineNumber, word.endColumn),\r\n                                        text: word.word\r\n                                    }];\r\n                            }\r\n                        }\r\n                        return [2 /*return*/, res];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RenameSkeleton.prototype.provideRenameEdits = function (newName, i, rejects, token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var provider, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        provider = this._providers[i];\r\n                        if (!provider) {\r\n                            return [2 /*return*/, {\r\n                                    edits: [],\r\n                                    rejectReason: rejects.join('\\n')\r\n                                }];\r\n                        }\r\n                        return [4 /*yield*/, provider.provideRenameEdits(this.model, this.position, newName, token)];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        if (!result) {\r\n                            return [2 /*return*/, this.provideRenameEdits(newName, i + 1, rejects.concat(nls.localize('no result', \"No result.\")), token)];\r\n                        }\r\n                        else if (result.rejectReason) {\r\n                            return [2 /*return*/, this.provideRenameEdits(newName, i + 1, rejects.concat(result.rejectReason), token)];\r\n                        }\r\n                        return [2 /*return*/, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return RenameSkeleton;\r\n}());\r\nexport function rename(model, position, newName) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            return [2 /*return*/, new RenameSkeleton(model, position).provideRenameEdits(newName, 0, [], CancellationToken.None)];\r\n        });\r\n    });\r\n}\r\n// ---  register actions and commands\r\nvar RenameController = /** @class */ (function () {\r\n    function RenameController(editor, _instaService, _notificationService, _bulkEditService, _progressService, _logService, _configService) {\r\n        var _this = this;\r\n        this.editor = editor;\r\n        this._instaService = _instaService;\r\n        this._notificationService = _notificationService;\r\n        this._bulkEditService = _bulkEditService;\r\n        this._progressService = _progressService;\r\n        this._logService = _logService;\r\n        this._configService = _configService;\r\n        this._dispoableStore = new DisposableStore();\r\n        this._cts = new CancellationTokenSource();\r\n        this._renameInputField = this._dispoableStore.add(new IdleValue(function () { return _this._dispoableStore.add(_this._instaService.createInstance(RenameInputField, _this.editor, ['acceptRenameInput', 'acceptRenameInputWithPreview'])); }));\r\n    }\r\n    RenameController.get = function (editor) {\r\n        return editor.getContribution(RenameController.ID);\r\n    };\r\n    RenameController.prototype.dispose = function () {\r\n        this._dispoableStore.dispose();\r\n        this._cts.dispose(true);\r\n    };\r\n    RenameController.prototype.run = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var position, skeleton, loc, resolveLocationOperation, e_1, selection, selectionStart, selectionEnd, supportPreview, inputFieldResult, renameOperation;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this._cts.dispose(true);\r\n                        if (!this.editor.hasModel()) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        position = this.editor.getPosition();\r\n                        skeleton = new RenameSkeleton(this.editor.getModel(), position);\r\n                        if (!skeleton.hasProvider()) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        this._cts = new EditorStateCancellationTokenSource(this.editor, 4 /* Position */ | 1 /* Value */);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        resolveLocationOperation = skeleton.resolveRenameLocation(this._cts.token);\r\n                        this._progressService.showWhile(resolveLocationOperation, 250);\r\n                        return [4 /*yield*/, resolveLocationOperation];\r\n                    case 2:\r\n                        loc = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        MessageController.get(this.editor).showMessage(e_1 || nls.localize('resolveRenameLocationFailed', \"An unknown error occurred while resolving rename location\"), position);\r\n                        return [2 /*return*/, undefined];\r\n                    case 4:\r\n                        if (!loc) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        if (loc.rejectReason) {\r\n                            MessageController.get(this.editor).showMessage(loc.rejectReason, position);\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        if (this._cts.token.isCancellationRequested) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        selection = this.editor.getSelection();\r\n                        selectionStart = 0;\r\n                        selectionEnd = loc.text.length;\r\n                        if (!Range.isEmpty(selection) && !Range.spansMultipleLines(selection) && Range.containsRange(loc.range, selection)) {\r\n                            selectionStart = Math.max(0, selection.startColumn - loc.range.startColumn);\r\n                            selectionEnd = Math.min(loc.range.endColumn, selection.endColumn) - loc.range.startColumn;\r\n                        }\r\n                        supportPreview = this._bulkEditService.hasPreviewHandler() && this._configService.getValue(this.editor.getModel().uri, 'editor.rename.enablePreview');\r\n                        return [4 /*yield*/, this._renameInputField.getValue().getInput(loc.range, loc.text, selectionStart, selectionEnd, supportPreview)];\r\n                    case 5:\r\n                        inputFieldResult = _a.sent();\r\n                        // no result, only hint to focus the editor or not\r\n                        if (typeof inputFieldResult === 'boolean') {\r\n                            if (inputFieldResult) {\r\n                                this.editor.focus();\r\n                            }\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        this.editor.focus();\r\n                        renameOperation = raceCancellation(skeleton.provideRenameEdits(inputFieldResult.newName, 0, [], this._cts.token), this._cts.token).then(function (renameResult) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var _this = this;\r\n                            return __generator(this, function (_a) {\r\n                                if (!renameResult || !this.editor.hasModel()) {\r\n                                    return [2 /*return*/];\r\n                                }\r\n                                if (renameResult.rejectReason) {\r\n                                    this._notificationService.info(renameResult.rejectReason);\r\n                                    return [2 /*return*/];\r\n                                }\r\n                                this._bulkEditService.apply(renameResult, {\r\n                                    editor: this.editor,\r\n                                    showPreview: inputFieldResult.wantsPreview,\r\n                                    label: nls.localize('label', \"Renaming '{0}'\", loc === null || loc === void 0 ? void 0 : loc.text)\r\n                                }).then(function (result) {\r\n                                    if (result.ariaSummary) {\r\n                                        alert(nls.localize('aria', \"Successfully renamed '{0}' to '{1}'. Summary: {2}\", loc.text, inputFieldResult.newName, result.ariaSummary));\r\n                                    }\r\n                                }).catch(function (err) {\r\n                                    _this._notificationService.error(nls.localize('rename.failedApply', \"Rename failed to apply edits\"));\r\n                                    _this._logService.error(err);\r\n                                });\r\n                                return [2 /*return*/];\r\n                            });\r\n                        }); }, function (err) {\r\n                            _this._notificationService.error(nls.localize('rename.failed', \"Rename failed to compute edits\"));\r\n                            _this._logService.error(err);\r\n                        });\r\n                        this._progressService.showWhile(renameOperation, 250);\r\n                        return [2 /*return*/, renameOperation];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RenameController.prototype.acceptRenameInput = function (wantsPreview) {\r\n        this._renameInputField.getValue().acceptInput(wantsPreview);\r\n    };\r\n    RenameController.prototype.cancelRenameInput = function () {\r\n        this._renameInputField.getValue().cancelInput(true);\r\n    };\r\n    RenameController.ID = 'editor.contrib.renameController';\r\n    RenameController = __decorate([\r\n        __param(1, IInstantiationService),\r\n        __param(2, INotificationService),\r\n        __param(3, IBulkEditService),\r\n        __param(4, IEditorProgressService),\r\n        __param(5, ILogService),\r\n        __param(6, ITextResourceConfigurationService)\r\n    ], RenameController);\r\n    return RenameController;\r\n}());\r\n// ---- action implementation\r\nvar RenameAction = /** @class */ (function (_super) {\r\n    __extends(RenameAction, _super);\r\n    function RenameAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.rename',\r\n            label: nls.localize('rename.label', \"Rename Symbol\"),\r\n            alias: 'Rename Symbol',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasRenameProvider),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 60 /* F2 */,\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            contextMenuOpts: {\r\n                group: '1_modification',\r\n                order: 1.1\r\n            }\r\n        }) || this;\r\n    }\r\n    RenameAction.prototype.runCommand = function (accessor, args) {\r\n        var _this = this;\r\n        var editorService = accessor.get(ICodeEditorService);\r\n        var _a = Array.isArray(args) && args || [undefined, undefined], uri = _a[0], pos = _a[1];\r\n        if (URI.isUri(uri) && Position.isIPosition(pos)) {\r\n            return editorService.openCodeEditor({ resource: uri }, editorService.getActiveCodeEditor()).then(function (editor) {\r\n                if (!editor) {\r\n                    return;\r\n                }\r\n                editor.setPosition(pos);\r\n                editor.invokeWithinContext(function (accessor) {\r\n                    _this.reportTelemetry(accessor, editor);\r\n                    return _this.run(accessor, editor);\r\n                });\r\n            }, onUnexpectedError);\r\n        }\r\n        return _super.prototype.runCommand.call(this, accessor, args);\r\n    };\r\n    RenameAction.prototype.run = function (accessor, editor) {\r\n        var controller = RenameController.get(editor);\r\n        if (controller) {\r\n            return controller.run();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    return RenameAction;\r\n}(EditorAction));\r\nexport { RenameAction };\r\nregisterEditorContribution(RenameController.ID, RenameController);\r\nregisterEditorAction(RenameAction);\r\nvar RenameCommand = EditorCommand.bindToContribution(RenameController.get);\r\nregisterEditorCommand(new RenameCommand({\r\n    id: 'acceptRenameInput',\r\n    precondition: CONTEXT_RENAME_INPUT_VISIBLE,\r\n    handler: function (x) { return x.acceptRenameInput(false); },\r\n    kbOpts: {\r\n        weight: 100 /* EditorContrib */ + 99,\r\n        kbExpr: EditorContextKeys.focus,\r\n        primary: 3 /* Enter */\r\n    }\r\n}));\r\nregisterEditorCommand(new RenameCommand({\r\n    id: 'acceptRenameInputWithPreview',\r\n    precondition: ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE, ContextKeyExpr.has('config.editor.rename.enablePreview')),\r\n    handler: function (x) { return x.acceptRenameInput(true); },\r\n    kbOpts: {\r\n        weight: 100 /* EditorContrib */ + 99,\r\n        kbExpr: EditorContextKeys.focus,\r\n        primary: 1024 /* Shift */ + 3 /* Enter */\r\n    }\r\n}));\r\nregisterEditorCommand(new RenameCommand({\r\n    id: 'cancelRenameInput',\r\n    precondition: CONTEXT_RENAME_INPUT_VISIBLE,\r\n    handler: function (x) { return x.cancelRenameInput(); },\r\n    kbOpts: {\r\n        weight: 100 /* EditorContrib */ + 99,\r\n        kbExpr: EditorContextKeys.focus,\r\n        primary: 9 /* Escape */,\r\n        secondary: [1024 /* Shift */ | 9 /* Escape */]\r\n    }\r\n}));\r\n// ---- api bridge command\r\nregisterDefaultLanguageCommand('_executeDocumentRenameProvider', function (model, position, args) {\r\n    var newName = args.newName;\r\n    if (typeof newName !== 'string') {\r\n        throw illegalArgument('newName');\r\n    }\r\n    return rename(model, position, newName);\r\n});\r\n//todo@joh use editor options world\r\nRegistry.as(Extensions.Configuration).registerConfiguration({\r\n    id: 'editor',\r\n    properties: {\r\n        'editor.rename.enablePreview': {\r\n            scope: 5 /* LANGUAGE_OVERRIDABLE */,\r\n            description: nls.localize('enablePreview', \"Enable/disable the ability to preview changes before renaming\"),\r\n            default: true,\r\n            type: 'boolean'\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}