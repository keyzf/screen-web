{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport * as DOM from './dom.js';\nimport { createElement } from './formattedTextRenderer.js';\nimport { onUnexpectedError } from '../common/errors.js';\nimport { parseHrefAndDimensions, removeMarkdownEscapes } from '../common/htmlContent.js';\nimport { defaultGenerator } from '../common/idGenerator.js';\nimport * as marked from '../common/marked/marked.js';\nimport { insane } from '../common/insane/insane.js';\nimport { parse } from '../common/marshalling.js';\nimport { cloneAndChange } from '../common/objects.js';\nimport { escape } from '../common/strings.js';\nimport { URI } from '../common/uri.js';\nimport { Schemas } from '../common/network.js';\nimport { renderCodicons, markdownEscapeEscapedCodicons } from '../common/codicons.js';\n/**\r\n * Create html nodes for the given content element.\r\n */\n\nexport function renderMarkdown(markdown, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var element = createElement(options);\n\n  var _uriMassage = function (part) {\n    var data;\n\n    try {\n      data = parse(decodeURIComponent(part));\n    } catch (e) {// ignore\n    }\n\n    if (!data) {\n      return part;\n    }\n\n    data = cloneAndChange(data, function (value) {\n      if (markdown.uris && markdown.uris[value]) {\n        return URI.revive(markdown.uris[value]);\n      } else {\n        return undefined;\n      }\n    });\n    return encodeURIComponent(JSON.stringify(data));\n  };\n\n  var _href = function (href, isDomUri) {\n    var data = markdown.uris && markdown.uris[href];\n\n    if (!data) {\n      return href; // no uri exists\n    }\n\n    var uri = URI.revive(data);\n\n    if (URI.parse(href).toString() === uri.toString()) {\n      return href; // no tranformation performed\n    }\n\n    if (isDomUri) {\n      uri = DOM.asDomUri(uri);\n    }\n\n    if (uri.query) {\n      uri = uri.with({\n        query: _uriMassage(uri.query)\n      });\n    }\n\n    return uri.toString(true);\n  }; // signal to code-block render that the\n  // element has been created\n\n\n  var signalInnerHTML;\n  var withInnerHTML = new Promise(function (c) {\n    return signalInnerHTML = c;\n  });\n  var renderer = new marked.Renderer();\n\n  renderer.image = function (href, title, text) {\n    var _a;\n\n    var dimensions = [];\n    var attributes = [];\n\n    if (href) {\n      _a = parseHrefAndDimensions(href), href = _a.href, dimensions = _a.dimensions;\n      href = _href(href, true);\n      attributes.push(\"src=\\\"\" + href + \"\\\"\");\n    }\n\n    if (text) {\n      attributes.push(\"alt=\\\"\" + text + \"\\\"\");\n    }\n\n    if (title) {\n      attributes.push(\"title=\\\"\" + title + \"\\\"\");\n    }\n\n    if (dimensions.length) {\n      attributes = attributes.concat(dimensions);\n    }\n\n    return '<img ' + attributes.join(' ') + '>';\n  };\n\n  renderer.link = function (href, title, text) {\n    // Remove markdown escapes. Workaround for https://github.com/chjj/marked/issues/829\n    if (href === text) {\n      // raw link case\n      text = removeMarkdownEscapes(text);\n    }\n\n    href = _href(href, false);\n    title = removeMarkdownEscapes(title);\n    href = removeMarkdownEscapes(href);\n\n    if (!href || href.match(/^data:|javascript:/i) || href.match(/^command:/i) && !markdown.isTrusted || href.match(/^command:(\\/\\/\\/)?_workbench\\.downloadResource/i)) {\n      // drop the link\n      return text;\n    } else {\n      // HTML Encode href\n      href = href.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n      return \"<a href=\\\"#\\\" data-href=\\\"\" + href + \"\\\" title=\\\"\" + (title || href) + \"\\\">\" + text + \"</a>\";\n    }\n  };\n\n  renderer.paragraph = function (text) {\n    return \"<p>\" + (markdown.supportThemeIcons ? renderCodicons(text) : text) + \"</p>\";\n  };\n\n  if (options.codeBlockRenderer) {\n    renderer.code = function (code, lang) {\n      var value = options.codeBlockRenderer(lang, code); // when code-block rendering is async we return sync\n      // but update the node with the real result later.\n\n      var id = defaultGenerator.nextId();\n      var promise = Promise.all([value, withInnerHTML]).then(function (values) {\n        var strValue = values[0];\n        var span = element.querySelector(\"div[data-code=\\\"\" + id + \"\\\"]\");\n\n        if (span) {\n          span.innerHTML = strValue;\n        }\n      }).catch(function (err) {// ignore\n      });\n\n      if (options.codeBlockRenderCallback) {\n        promise.then(options.codeBlockRenderCallback);\n      }\n\n      return \"<div class=\\\"code\\\" data-code=\\\"\" + id + \"\\\">\" + escape(code) + \"</div>\";\n    };\n  }\n\n  var actionHandler = options.actionHandler;\n\n  if (actionHandler) {\n    actionHandler.disposeables.add(DOM.addStandardDisposableListener(element, 'click', function (event) {\n      var target = event.target;\n\n      if (target.tagName !== 'A') {\n        target = target.parentElement;\n\n        if (!target || target.tagName !== 'A') {\n          return;\n        }\n      }\n\n      try {\n        var href = target.dataset['href'];\n\n        if (href) {\n          actionHandler.callback(href, event);\n        }\n      } catch (err) {\n        onUnexpectedError(err);\n      } finally {\n        event.preventDefault();\n      }\n    }));\n  }\n\n  var markedOptions = {\n    sanitize: true,\n    renderer: renderer\n  };\n  var allowedSchemes = [Schemas.http, Schemas.https, Schemas.mailto, Schemas.data, Schemas.file, Schemas.vscodeRemote, Schemas.vscodeRemoteResource];\n\n  if (markdown.isTrusted) {\n    allowedSchemes.push(Schemas.command);\n  }\n\n  var renderedMarkdown = marked.parse(markdown.supportThemeIcons ? markdownEscapeEscapedCodicons(markdown.value) : markdown.value, markedOptions);\n  element.innerHTML = insane(renderedMarkdown, {\n    allowedSchemes: allowedSchemes,\n    allowedAttributes: {\n      'a': ['href', 'name', 'target', 'data-href'],\n      'iframe': ['allowfullscreen', 'frameborder', 'src'],\n      'img': ['src', 'title', 'alt', 'width', 'height'],\n      'div': ['class', 'data-code'],\n      'span': ['class']\n    }\n  });\n  signalInnerHTML();\n  return element;\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/markdownRenderer.js"],"names":["DOM","createElement","onUnexpectedError","parseHrefAndDimensions","removeMarkdownEscapes","defaultGenerator","marked","insane","parse","cloneAndChange","escape","URI","Schemas","renderCodicons","markdownEscapeEscapedCodicons","renderMarkdown","markdown","options","element","_uriMassage","part","data","decodeURIComponent","e","value","uris","revive","undefined","encodeURIComponent","JSON","stringify","_href","href","isDomUri","uri","toString","asDomUri","query","with","signalInnerHTML","withInnerHTML","Promise","c","renderer","Renderer","image","title","text","_a","dimensions","attributes","push","length","concat","join","link","match","isTrusted","replace","paragraph","supportThemeIcons","codeBlockRenderer","code","lang","id","nextId","promise","all","then","values","strValue","span","querySelector","innerHTML","catch","err","codeBlockRenderCallback","actionHandler","disposeables","add","addStandardDisposableListener","event","target","tagName","parentElement","dataset","callback","preventDefault","markedOptions","sanitize","allowedSchemes","http","https","mailto","file","vscodeRemote","vscodeRemoteResource","command","renderedMarkdown","allowedAttributes"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as DOM from './dom.js';\r\nimport { createElement } from './formattedTextRenderer.js';\r\nimport { onUnexpectedError } from '../common/errors.js';\r\nimport { parseHrefAndDimensions, removeMarkdownEscapes } from '../common/htmlContent.js';\r\nimport { defaultGenerator } from '../common/idGenerator.js';\r\nimport * as marked from '../common/marked/marked.js';\r\nimport { insane } from '../common/insane/insane.js';\r\nimport { parse } from '../common/marshalling.js';\r\nimport { cloneAndChange } from '../common/objects.js';\r\nimport { escape } from '../common/strings.js';\r\nimport { URI } from '../common/uri.js';\r\nimport { Schemas } from '../common/network.js';\r\nimport { renderCodicons, markdownEscapeEscapedCodicons } from '../common/codicons.js';\r\n/**\r\n * Create html nodes for the given content element.\r\n */\r\nexport function renderMarkdown(markdown, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var element = createElement(options);\r\n    var _uriMassage = function (part) {\r\n        var data;\r\n        try {\r\n            data = parse(decodeURIComponent(part));\r\n        }\r\n        catch (e) {\r\n            // ignore\r\n        }\r\n        if (!data) {\r\n            return part;\r\n        }\r\n        data = cloneAndChange(data, function (value) {\r\n            if (markdown.uris && markdown.uris[value]) {\r\n                return URI.revive(markdown.uris[value]);\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        });\r\n        return encodeURIComponent(JSON.stringify(data));\r\n    };\r\n    var _href = function (href, isDomUri) {\r\n        var data = markdown.uris && markdown.uris[href];\r\n        if (!data) {\r\n            return href; // no uri exists\r\n        }\r\n        var uri = URI.revive(data);\r\n        if (URI.parse(href).toString() === uri.toString()) {\r\n            return href; // no tranformation performed\r\n        }\r\n        if (isDomUri) {\r\n            uri = DOM.asDomUri(uri);\r\n        }\r\n        if (uri.query) {\r\n            uri = uri.with({ query: _uriMassage(uri.query) });\r\n        }\r\n        return uri.toString(true);\r\n    };\r\n    // signal to code-block render that the\r\n    // element has been created\r\n    var signalInnerHTML;\r\n    var withInnerHTML = new Promise(function (c) { return signalInnerHTML = c; });\r\n    var renderer = new marked.Renderer();\r\n    renderer.image = function (href, title, text) {\r\n        var _a;\r\n        var dimensions = [];\r\n        var attributes = [];\r\n        if (href) {\r\n            (_a = parseHrefAndDimensions(href), href = _a.href, dimensions = _a.dimensions);\r\n            href = _href(href, true);\r\n            attributes.push(\"src=\\\"\" + href + \"\\\"\");\r\n        }\r\n        if (text) {\r\n            attributes.push(\"alt=\\\"\" + text + \"\\\"\");\r\n        }\r\n        if (title) {\r\n            attributes.push(\"title=\\\"\" + title + \"\\\"\");\r\n        }\r\n        if (dimensions.length) {\r\n            attributes = attributes.concat(dimensions);\r\n        }\r\n        return '<img ' + attributes.join(' ') + '>';\r\n    };\r\n    renderer.link = function (href, title, text) {\r\n        // Remove markdown escapes. Workaround for https://github.com/chjj/marked/issues/829\r\n        if (href === text) { // raw link case\r\n            text = removeMarkdownEscapes(text);\r\n        }\r\n        href = _href(href, false);\r\n        title = removeMarkdownEscapes(title);\r\n        href = removeMarkdownEscapes(href);\r\n        if (!href\r\n            || href.match(/^data:|javascript:/i)\r\n            || (href.match(/^command:/i) && !markdown.isTrusted)\r\n            || href.match(/^command:(\\/\\/\\/)?_workbench\\.downloadResource/i)) {\r\n            // drop the link\r\n            return text;\r\n        }\r\n        else {\r\n            // HTML Encode href\r\n            href = href.replace(/&/g, '&amp;')\r\n                .replace(/</g, '&lt;')\r\n                .replace(/>/g, '&gt;')\r\n                .replace(/\"/g, '&quot;')\r\n                .replace(/'/g, '&#39;');\r\n            return \"<a href=\\\"#\\\" data-href=\\\"\" + href + \"\\\" title=\\\"\" + (title || href) + \"\\\">\" + text + \"</a>\";\r\n        }\r\n    };\r\n    renderer.paragraph = function (text) {\r\n        return \"<p>\" + (markdown.supportThemeIcons ? renderCodicons(text) : text) + \"</p>\";\r\n    };\r\n    if (options.codeBlockRenderer) {\r\n        renderer.code = function (code, lang) {\r\n            var value = options.codeBlockRenderer(lang, code);\r\n            // when code-block rendering is async we return sync\r\n            // but update the node with the real result later.\r\n            var id = defaultGenerator.nextId();\r\n            var promise = Promise.all([value, withInnerHTML]).then(function (values) {\r\n                var strValue = values[0];\r\n                var span = element.querySelector(\"div[data-code=\\\"\" + id + \"\\\"]\");\r\n                if (span) {\r\n                    span.innerHTML = strValue;\r\n                }\r\n            }).catch(function (err) {\r\n                // ignore\r\n            });\r\n            if (options.codeBlockRenderCallback) {\r\n                promise.then(options.codeBlockRenderCallback);\r\n            }\r\n            return \"<div class=\\\"code\\\" data-code=\\\"\" + id + \"\\\">\" + escape(code) + \"</div>\";\r\n        };\r\n    }\r\n    var actionHandler = options.actionHandler;\r\n    if (actionHandler) {\r\n        actionHandler.disposeables.add(DOM.addStandardDisposableListener(element, 'click', function (event) {\r\n            var target = event.target;\r\n            if (target.tagName !== 'A') {\r\n                target = target.parentElement;\r\n                if (!target || target.tagName !== 'A') {\r\n                    return;\r\n                }\r\n            }\r\n            try {\r\n                var href = target.dataset['href'];\r\n                if (href) {\r\n                    actionHandler.callback(href, event);\r\n                }\r\n            }\r\n            catch (err) {\r\n                onUnexpectedError(err);\r\n            }\r\n            finally {\r\n                event.preventDefault();\r\n            }\r\n        }));\r\n    }\r\n    var markedOptions = {\r\n        sanitize: true,\r\n        renderer: renderer\r\n    };\r\n    var allowedSchemes = [Schemas.http, Schemas.https, Schemas.mailto, Schemas.data, Schemas.file, Schemas.vscodeRemote, Schemas.vscodeRemoteResource];\r\n    if (markdown.isTrusted) {\r\n        allowedSchemes.push(Schemas.command);\r\n    }\r\n    var renderedMarkdown = marked.parse(markdown.supportThemeIcons\r\n        ? markdownEscapeEscapedCodicons(markdown.value)\r\n        : markdown.value, markedOptions);\r\n    element.innerHTML = insane(renderedMarkdown, {\r\n        allowedSchemes: allowedSchemes,\r\n        allowedAttributes: {\r\n            'a': ['href', 'name', 'target', 'data-href'],\r\n            'iframe': ['allowfullscreen', 'frameborder', 'src'],\r\n            'img': ['src', 'title', 'alt', 'width', 'height'],\r\n            'div': ['class', 'data-code'],\r\n            'span': ['class']\r\n        }\r\n    });\r\n    signalInnerHTML();\r\n    return element;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}