{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport { PartFingerprints, ViewPart } from '../../view/viewPart.js';\n\nvar Coordinate =\n/** @class */\nfunction () {\n  function Coordinate(top, left) {\n    this.top = top;\n    this.left = left;\n  }\n\n  return Coordinate;\n}();\n\nvar ViewContentWidgets =\n/** @class */\nfunction (_super) {\n  __extends(ViewContentWidgets, _super);\n\n  function ViewContentWidgets(context, viewDomNode) {\n    var _this = _super.call(this, context) || this;\n\n    _this._viewDomNode = viewDomNode;\n    _this._widgets = {};\n    _this.domNode = createFastDomNode(document.createElement('div'));\n    PartFingerprints.write(_this.domNode, 1\n    /* ContentWidgets */\n    );\n\n    _this.domNode.setClassName('contentWidgets');\n\n    _this.domNode.setPosition('absolute');\n\n    _this.domNode.setTop(0);\n\n    _this.overflowingContentWidgetsDomNode = createFastDomNode(document.createElement('div'));\n    PartFingerprints.write(_this.overflowingContentWidgetsDomNode, 2\n    /* OverflowingContentWidgets */\n    );\n\n    _this.overflowingContentWidgetsDomNode.setClassName('overflowingContentWidgets');\n\n    return _this;\n  }\n\n  ViewContentWidgets.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this._widgets = {};\n  }; // --- begin event handlers\n\n\n  ViewContentWidgets.prototype.onConfigurationChanged = function (e) {\n    var keys = Object.keys(this._widgets);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var widgetId = keys_1[_i];\n\n      this._widgets[widgetId].onConfigurationChanged(e);\n    }\n\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onDecorationsChanged = function (e) {\n    // true for inline decorations that can end up relayouting text\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onFlushed = function (e) {\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onLineMappingChanged = function (e) {\n    var keys = Object.keys(this._widgets);\n\n    for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\n      var widgetId = keys_2[_i];\n\n      this._widgets[widgetId].onLineMappingChanged(e);\n    }\n\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onLinesChanged = function (e) {\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onLinesDeleted = function (e) {\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onLinesInserted = function (e) {\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onScrollChanged = function (e) {\n    return true;\n  };\n\n  ViewContentWidgets.prototype.onZonesChanged = function (e) {\n    return true;\n  }; // ---- end view event handlers\n\n\n  ViewContentWidgets.prototype.addWidget = function (_widget) {\n    var myWidget = new Widget(this._context, this._viewDomNode, _widget);\n    this._widgets[myWidget.id] = myWidget;\n\n    if (myWidget.allowEditorOverflow) {\n      this.overflowingContentWidgetsDomNode.appendChild(myWidget.domNode);\n    } else {\n      this.domNode.appendChild(myWidget.domNode);\n    }\n\n    this.setShouldRender();\n  };\n\n  ViewContentWidgets.prototype.setWidgetPosition = function (widget, range, preference) {\n    var myWidget = this._widgets[widget.getId()];\n\n    myWidget.setPosition(range, preference);\n    this.setShouldRender();\n  };\n\n  ViewContentWidgets.prototype.removeWidget = function (widget) {\n    var widgetId = widget.getId();\n\n    if (this._widgets.hasOwnProperty(widgetId)) {\n      var myWidget = this._widgets[widgetId];\n      delete this._widgets[widgetId];\n      var domNode = myWidget.domNode.domNode;\n      domNode.parentNode.removeChild(domNode);\n      domNode.removeAttribute('monaco-visible-content-widget');\n      this.setShouldRender();\n    }\n  };\n\n  ViewContentWidgets.prototype.shouldSuppressMouseDownOnWidget = function (widgetId) {\n    if (this._widgets.hasOwnProperty(widgetId)) {\n      return this._widgets[widgetId].suppressMouseDown;\n    }\n\n    return false;\n  };\n\n  ViewContentWidgets.prototype.onBeforeRender = function (viewportData) {\n    var keys = Object.keys(this._widgets);\n\n    for (var _i = 0, keys_3 = keys; _i < keys_3.length; _i++) {\n      var widgetId = keys_3[_i];\n\n      this._widgets[widgetId].onBeforeRender(viewportData);\n    }\n  };\n\n  ViewContentWidgets.prototype.prepareRender = function (ctx) {\n    var keys = Object.keys(this._widgets);\n\n    for (var _i = 0, keys_4 = keys; _i < keys_4.length; _i++) {\n      var widgetId = keys_4[_i];\n\n      this._widgets[widgetId].prepareRender(ctx);\n    }\n  };\n\n  ViewContentWidgets.prototype.render = function (ctx) {\n    var keys = Object.keys(this._widgets);\n\n    for (var _i = 0, keys_5 = keys; _i < keys_5.length; _i++) {\n      var widgetId = keys_5[_i];\n\n      this._widgets[widgetId].render(ctx);\n    }\n  };\n\n  return ViewContentWidgets;\n}(ViewPart);\n\nexport { ViewContentWidgets };\n\nvar Widget =\n/** @class */\nfunction () {\n  function Widget(context, viewDomNode, actual) {\n    this._context = context;\n    this._viewDomNode = viewDomNode;\n    this._actual = actual;\n    this.domNode = createFastDomNode(this._actual.getDomNode());\n    this.id = this._actual.getId();\n    this.allowEditorOverflow = this._actual.allowEditorOverflow || false;\n    this.suppressMouseDown = this._actual.suppressMouseDown || false;\n    var options = this._context.configuration.options;\n    var layoutInfo = options.get(107\n    /* layoutInfo */\n    );\n    this._fixedOverflowWidgets = options.get(29\n    /* fixedOverflowWidgets */\n    );\n    this._contentWidth = layoutInfo.contentWidth;\n    this._contentLeft = layoutInfo.contentLeft;\n    this._lineHeight = options.get(49\n    /* lineHeight */\n    );\n    this._range = null;\n    this._viewRange = null;\n    this._preference = [];\n    this._cachedDomNodeClientWidth = -1;\n    this._cachedDomNodeClientHeight = -1;\n    this._maxWidth = this._getMaxWidth();\n    this._isVisible = false;\n    this._renderData = null;\n    this.domNode.setPosition(this._fixedOverflowWidgets && this.allowEditorOverflow ? 'fixed' : 'absolute');\n    this.domNode.setVisibility('hidden');\n    this.domNode.setAttribute('widgetId', this.id);\n    this.domNode.setMaxWidth(this._maxWidth);\n  }\n\n  Widget.prototype.onConfigurationChanged = function (e) {\n    var options = this._context.configuration.options;\n    this._lineHeight = options.get(49\n    /* lineHeight */\n    );\n\n    if (e.hasChanged(107\n    /* layoutInfo */\n    )) {\n      var layoutInfo = options.get(107\n      /* layoutInfo */\n      );\n      this._contentLeft = layoutInfo.contentLeft;\n      this._contentWidth = layoutInfo.contentWidth;\n      this._maxWidth = this._getMaxWidth();\n    }\n  };\n\n  Widget.prototype.onLineMappingChanged = function (e) {\n    this._setPosition(this._range);\n  };\n\n  Widget.prototype._setPosition = function (range) {\n    this._range = range;\n    this._viewRange = null;\n\n    if (this._range) {\n      // Do not trust that widgets give a valid position\n      var validModelRange = this._context.model.validateModelRange(this._range);\n\n      if (this._context.model.coordinatesConverter.modelPositionIsVisible(validModelRange.getStartPosition()) || this._context.model.coordinatesConverter.modelPositionIsVisible(validModelRange.getEndPosition())) {\n        this._viewRange = this._context.model.coordinatesConverter.convertModelRangeToViewRange(validModelRange);\n      }\n    }\n  };\n\n  Widget.prototype._getMaxWidth = function () {\n    return this.allowEditorOverflow ? window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth : this._contentWidth;\n  };\n\n  Widget.prototype.setPosition = function (range, preference) {\n    this._setPosition(range);\n\n    this._preference = preference;\n    this._cachedDomNodeClientWidth = -1;\n    this._cachedDomNodeClientHeight = -1;\n  };\n\n  Widget.prototype._layoutBoxInViewport = function (topLeft, bottomLeft, width, height, ctx) {\n    // Our visible box is split horizontally by the current line => 2 boxes\n    // a) the box above the line\n    var aboveLineTop = topLeft.top;\n    var heightAboveLine = aboveLineTop; // b) the box under the line\n\n    var underLineTop = bottomLeft.top + this._lineHeight;\n    var heightUnderLine = ctx.viewportHeight - underLineTop;\n    var aboveTop = aboveLineTop - height;\n    var fitsAbove = heightAboveLine >= height;\n    var belowTop = underLineTop;\n    var fitsBelow = heightUnderLine >= height; // And its left\n\n    var actualAboveLeft = topLeft.left;\n    var actualBelowLeft = bottomLeft.left;\n\n    if (actualAboveLeft + width > ctx.scrollLeft + ctx.viewportWidth) {\n      actualAboveLeft = ctx.scrollLeft + ctx.viewportWidth - width;\n    }\n\n    if (actualBelowLeft + width > ctx.scrollLeft + ctx.viewportWidth) {\n      actualBelowLeft = ctx.scrollLeft + ctx.viewportWidth - width;\n    }\n\n    if (actualAboveLeft < ctx.scrollLeft) {\n      actualAboveLeft = ctx.scrollLeft;\n    }\n\n    if (actualBelowLeft < ctx.scrollLeft) {\n      actualBelowLeft = ctx.scrollLeft;\n    }\n\n    return {\n      fitsAbove: fitsAbove,\n      aboveTop: aboveTop,\n      aboveLeft: actualAboveLeft,\n      fitsBelow: fitsBelow,\n      belowTop: belowTop,\n      belowLeft: actualBelowLeft\n    };\n  };\n\n  Widget.prototype._layoutHorizontalSegmentInPage = function (windowSize, domNodePosition, left, width) {\n    // Initially, the limits are defined as the dom node limits\n    var MIN_LIMIT = Math.max(0, domNodePosition.left - width);\n    var MAX_LIMIT = Math.min(domNodePosition.left + domNodePosition.width + width, windowSize.width);\n    var absoluteLeft = domNodePosition.left + left - dom.StandardWindow.scrollX;\n\n    if (absoluteLeft + width > MAX_LIMIT) {\n      var delta = absoluteLeft - (MAX_LIMIT - width);\n      absoluteLeft -= delta;\n      left -= delta;\n    }\n\n    if (absoluteLeft < MIN_LIMIT) {\n      var delta = absoluteLeft - MIN_LIMIT;\n      absoluteLeft -= delta;\n      left -= delta;\n    }\n\n    return [left, absoluteLeft];\n  };\n\n  Widget.prototype._layoutBoxInPage = function (topLeft, bottomLeft, width, height, ctx) {\n    var aboveTop = topLeft.top - height;\n    var belowTop = bottomLeft.top + this._lineHeight;\n    var domNodePosition = dom.getDomNodePagePosition(this._viewDomNode.domNode);\n    var absoluteAboveTop = domNodePosition.top + aboveTop - dom.StandardWindow.scrollY;\n    var absoluteBelowTop = domNodePosition.top + belowTop - dom.StandardWindow.scrollY;\n    var windowSize = dom.getClientArea(document.body);\n\n    var _a = this._layoutHorizontalSegmentInPage(windowSize, domNodePosition, topLeft.left - ctx.scrollLeft + this._contentLeft, width),\n        aboveLeft = _a[0],\n        absoluteAboveLeft = _a[1];\n\n    var _b = this._layoutHorizontalSegmentInPage(windowSize, domNodePosition, bottomLeft.left - ctx.scrollLeft + this._contentLeft, width),\n        belowLeft = _b[0],\n        absoluteBelowLeft = _b[1]; // Leave some clearance to the top/bottom\n\n\n    var TOP_PADDING = 22;\n    var BOTTOM_PADDING = 22;\n    var fitsAbove = absoluteAboveTop >= TOP_PADDING;\n    var fitsBelow = absoluteBelowTop + height <= windowSize.height - BOTTOM_PADDING;\n\n    if (this._fixedOverflowWidgets) {\n      return {\n        fitsAbove: fitsAbove,\n        aboveTop: Math.max(absoluteAboveTop, TOP_PADDING),\n        aboveLeft: absoluteAboveLeft,\n        fitsBelow: fitsBelow,\n        belowTop: absoluteBelowTop,\n        belowLeft: absoluteBelowLeft\n      };\n    }\n\n    return {\n      fitsAbove: fitsAbove,\n      aboveTop: Math.max(aboveTop, TOP_PADDING),\n      aboveLeft: aboveLeft,\n      fitsBelow: fitsBelow,\n      belowTop: belowTop,\n      belowLeft: belowLeft\n    };\n  };\n\n  Widget.prototype._prepareRenderWidgetAtExactPositionOverflowing = function (topLeft) {\n    return new Coordinate(topLeft.top, topLeft.left + this._contentLeft);\n  };\n  /**\r\n   * Compute `this._topLeft`\r\n   */\n\n\n  Widget.prototype._getTopAndBottomLeft = function (ctx) {\n    if (!this._viewRange) {\n      return [null, null];\n    }\n\n    var visibleRangesForRange = ctx.linesVisibleRangesForRange(this._viewRange, false);\n\n    if (!visibleRangesForRange || visibleRangesForRange.length === 0) {\n      return [null, null];\n    }\n\n    var firstLine = visibleRangesForRange[0];\n    var lastLine = visibleRangesForRange[0];\n\n    for (var _i = 0, visibleRangesForRange_1 = visibleRangesForRange; _i < visibleRangesForRange_1.length; _i++) {\n      var visibleRangesForLine = visibleRangesForRange_1[_i];\n\n      if (visibleRangesForLine.lineNumber < firstLine.lineNumber) {\n        firstLine = visibleRangesForLine;\n      }\n\n      if (visibleRangesForLine.lineNumber > lastLine.lineNumber) {\n        lastLine = visibleRangesForLine;\n      }\n    }\n\n    var firstLineMinLeft = 1073741824\n    /* MAX_SAFE_SMALL_INTEGER */\n    ; //firstLine.Constants.MAX_SAFE_SMALL_INTEGER;\n\n    for (var _a = 0, _b = firstLine.ranges; _a < _b.length; _a++) {\n      var visibleRange = _b[_a];\n\n      if (visibleRange.left < firstLineMinLeft) {\n        firstLineMinLeft = visibleRange.left;\n      }\n    }\n\n    var lastLineMinLeft = 1073741824\n    /* MAX_SAFE_SMALL_INTEGER */\n    ; //lastLine.Constants.MAX_SAFE_SMALL_INTEGER;\n\n    for (var _c = 0, _d = lastLine.ranges; _c < _d.length; _c++) {\n      var visibleRange = _d[_c];\n\n      if (visibleRange.left < lastLineMinLeft) {\n        lastLineMinLeft = visibleRange.left;\n      }\n    }\n\n    var topForPosition = ctx.getVerticalOffsetForLineNumber(firstLine.lineNumber) - ctx.scrollTop;\n    var topLeft = new Coordinate(topForPosition, firstLineMinLeft);\n    var topForBottomLine = ctx.getVerticalOffsetForLineNumber(lastLine.lineNumber) - ctx.scrollTop;\n    var bottomLeft = new Coordinate(topForBottomLine, lastLineMinLeft);\n    return [topLeft, bottomLeft];\n  };\n\n  Widget.prototype._prepareRenderWidget = function (ctx) {\n    var _a = this._getTopAndBottomLeft(ctx),\n        topLeft = _a[0],\n        bottomLeft = _a[1];\n\n    if (!topLeft || !bottomLeft) {\n      return null;\n    }\n\n    if (this._cachedDomNodeClientWidth === -1 || this._cachedDomNodeClientHeight === -1) {\n      var domNode = this.domNode.domNode;\n      this._cachedDomNodeClientWidth = domNode.clientWidth;\n      this._cachedDomNodeClientHeight = domNode.clientHeight;\n    }\n\n    var placement;\n\n    if (this.allowEditorOverflow) {\n      placement = this._layoutBoxInPage(topLeft, bottomLeft, this._cachedDomNodeClientWidth, this._cachedDomNodeClientHeight, ctx);\n    } else {\n      placement = this._layoutBoxInViewport(topLeft, bottomLeft, this._cachedDomNodeClientWidth, this._cachedDomNodeClientHeight, ctx);\n    } // Do two passes, first for perfect fit, second picks first option\n\n\n    if (this._preference) {\n      for (var pass = 1; pass <= 2; pass++) {\n        for (var _i = 0, _b = this._preference; _i < _b.length; _i++) {\n          var pref = _b[_i]; // placement\n\n          if (pref === 1\n          /* ABOVE */\n          ) {\n              if (!placement) {\n                // Widget outside of viewport\n                return null;\n              }\n\n              if (pass === 2 || placement.fitsAbove) {\n                return new Coordinate(placement.aboveTop, placement.aboveLeft);\n              }\n            } else if (pref === 2\n          /* BELOW */\n          ) {\n              if (!placement) {\n                // Widget outside of viewport\n                return null;\n              }\n\n              if (pass === 2 || placement.fitsBelow) {\n                return new Coordinate(placement.belowTop, placement.belowLeft);\n              }\n            } else {\n            if (this.allowEditorOverflow) {\n              return this._prepareRenderWidgetAtExactPositionOverflowing(topLeft);\n            } else {\n              return topLeft;\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  /**\r\n   * On this first pass, we ensure that the content widget (if it is in the viewport) has the max width set correctly.\r\n   */\n\n\n  Widget.prototype.onBeforeRender = function (viewportData) {\n    if (!this._viewRange || !this._preference) {\n      return;\n    }\n\n    if (this._viewRange.endLineNumber < viewportData.startLineNumber || this._viewRange.startLineNumber > viewportData.endLineNumber) {\n      // Outside of viewport\n      return;\n    }\n\n    this.domNode.setMaxWidth(this._maxWidth);\n  };\n\n  Widget.prototype.prepareRender = function (ctx) {\n    this._renderData = this._prepareRenderWidget(ctx);\n  };\n\n  Widget.prototype.render = function (ctx) {\n    if (!this._renderData) {\n      // This widget should be invisible\n      if (this._isVisible) {\n        this.domNode.removeAttribute('monaco-visible-content-widget');\n        this._isVisible = false;\n        this.domNode.setVisibility('hidden');\n      }\n\n      return;\n    } // This widget should be visible\n\n\n    if (this.allowEditorOverflow) {\n      this.domNode.setTop(this._renderData.top);\n      this.domNode.setLeft(this._renderData.left);\n    } else {\n      this.domNode.setTop(this._renderData.top + ctx.scrollTop - ctx.bigNumbersDelta);\n      this.domNode.setLeft(this._renderData.left);\n    }\n\n    if (!this._isVisible) {\n      this.domNode.setVisibility('inherit');\n      this.domNode.setAttribute('monaco-visible-content-widget', 'true');\n      this._isVisible = true;\n    }\n  };\n\n  return Widget;\n}();","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/viewParts/contentWidgets/contentWidgets.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","dom","createFastDomNode","PartFingerprints","ViewPart","Coordinate","top","left","ViewContentWidgets","_super","context","viewDomNode","_this","call","_viewDomNode","_widgets","domNode","document","createElement","write","setClassName","setPosition","setTop","overflowingContentWidgetsDomNode","dispose","onConfigurationChanged","e","keys","_i","keys_1","length","widgetId","onDecorationsChanged","onFlushed","onLineMappingChanged","keys_2","onLinesChanged","onLinesDeleted","onLinesInserted","onScrollChanged","onZonesChanged","addWidget","_widget","myWidget","Widget","_context","id","allowEditorOverflow","appendChild","setShouldRender","setWidgetPosition","widget","range","preference","getId","removeWidget","parentNode","removeChild","removeAttribute","shouldSuppressMouseDownOnWidget","suppressMouseDown","onBeforeRender","viewportData","keys_3","prepareRender","ctx","keys_4","render","keys_5","actual","_actual","getDomNode","options","configuration","layoutInfo","get","_fixedOverflowWidgets","_contentWidth","contentWidth","_contentLeft","contentLeft","_lineHeight","_range","_viewRange","_preference","_cachedDomNodeClientWidth","_cachedDomNodeClientHeight","_maxWidth","_getMaxWidth","_isVisible","_renderData","setVisibility","setAttribute","setMaxWidth","hasChanged","_setPosition","validModelRange","model","validateModelRange","coordinatesConverter","modelPositionIsVisible","getStartPosition","getEndPosition","convertModelRangeToViewRange","window","innerWidth","documentElement","clientWidth","body","_layoutBoxInViewport","topLeft","bottomLeft","width","height","aboveLineTop","heightAboveLine","underLineTop","heightUnderLine","viewportHeight","aboveTop","fitsAbove","belowTop","fitsBelow","actualAboveLeft","actualBelowLeft","scrollLeft","viewportWidth","aboveLeft","belowLeft","_layoutHorizontalSegmentInPage","windowSize","domNodePosition","MIN_LIMIT","Math","max","MAX_LIMIT","min","absoluteLeft","StandardWindow","scrollX","delta","_layoutBoxInPage","getDomNodePagePosition","absoluteAboveTop","scrollY","absoluteBelowTop","getClientArea","_a","absoluteAboveLeft","_b","absoluteBelowLeft","TOP_PADDING","BOTTOM_PADDING","_prepareRenderWidgetAtExactPositionOverflowing","_getTopAndBottomLeft","visibleRangesForRange","linesVisibleRangesForRange","firstLine","lastLine","visibleRangesForRange_1","visibleRangesForLine","lineNumber","firstLineMinLeft","ranges","visibleRange","lastLineMinLeft","_c","_d","topForPosition","getVerticalOffsetForLineNumber","scrollTop","topForBottomLine","_prepareRenderWidget","clientHeight","placement","pass","pref","endLineNumber","startLineNumber","setLeft","bigNumbersDelta"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as dom from '../../../../base/browser/dom.js';\r\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\r\nimport { PartFingerprints, ViewPart } from '../../view/viewPart.js';\r\nvar Coordinate = /** @class */ (function () {\r\n    function Coordinate(top, left) {\r\n        this.top = top;\r\n        this.left = left;\r\n    }\r\n    return Coordinate;\r\n}());\r\nvar ViewContentWidgets = /** @class */ (function (_super) {\r\n    __extends(ViewContentWidgets, _super);\r\n    function ViewContentWidgets(context, viewDomNode) {\r\n        var _this = _super.call(this, context) || this;\r\n        _this._viewDomNode = viewDomNode;\r\n        _this._widgets = {};\r\n        _this.domNode = createFastDomNode(document.createElement('div'));\r\n        PartFingerprints.write(_this.domNode, 1 /* ContentWidgets */);\r\n        _this.domNode.setClassName('contentWidgets');\r\n        _this.domNode.setPosition('absolute');\r\n        _this.domNode.setTop(0);\r\n        _this.overflowingContentWidgetsDomNode = createFastDomNode(document.createElement('div'));\r\n        PartFingerprints.write(_this.overflowingContentWidgetsDomNode, 2 /* OverflowingContentWidgets */);\r\n        _this.overflowingContentWidgetsDomNode.setClassName('overflowingContentWidgets');\r\n        return _this;\r\n    }\r\n    ViewContentWidgets.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this._widgets = {};\r\n    };\r\n    // --- begin event handlers\r\n    ViewContentWidgets.prototype.onConfigurationChanged = function (e) {\r\n        var keys = Object.keys(this._widgets);\r\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n            var widgetId = keys_1[_i];\r\n            this._widgets[widgetId].onConfigurationChanged(e);\r\n        }\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onDecorationsChanged = function (e) {\r\n        // true for inline decorations that can end up relayouting text\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onFlushed = function (e) {\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onLineMappingChanged = function (e) {\r\n        var keys = Object.keys(this._widgets);\r\n        for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\r\n            var widgetId = keys_2[_i];\r\n            this._widgets[widgetId].onLineMappingChanged(e);\r\n        }\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onLinesChanged = function (e) {\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onLinesDeleted = function (e) {\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onLinesInserted = function (e) {\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onScrollChanged = function (e) {\r\n        return true;\r\n    };\r\n    ViewContentWidgets.prototype.onZonesChanged = function (e) {\r\n        return true;\r\n    };\r\n    // ---- end view event handlers\r\n    ViewContentWidgets.prototype.addWidget = function (_widget) {\r\n        var myWidget = new Widget(this._context, this._viewDomNode, _widget);\r\n        this._widgets[myWidget.id] = myWidget;\r\n        if (myWidget.allowEditorOverflow) {\r\n            this.overflowingContentWidgetsDomNode.appendChild(myWidget.domNode);\r\n        }\r\n        else {\r\n            this.domNode.appendChild(myWidget.domNode);\r\n        }\r\n        this.setShouldRender();\r\n    };\r\n    ViewContentWidgets.prototype.setWidgetPosition = function (widget, range, preference) {\r\n        var myWidget = this._widgets[widget.getId()];\r\n        myWidget.setPosition(range, preference);\r\n        this.setShouldRender();\r\n    };\r\n    ViewContentWidgets.prototype.removeWidget = function (widget) {\r\n        var widgetId = widget.getId();\r\n        if (this._widgets.hasOwnProperty(widgetId)) {\r\n            var myWidget = this._widgets[widgetId];\r\n            delete this._widgets[widgetId];\r\n            var domNode = myWidget.domNode.domNode;\r\n            domNode.parentNode.removeChild(domNode);\r\n            domNode.removeAttribute('monaco-visible-content-widget');\r\n            this.setShouldRender();\r\n        }\r\n    };\r\n    ViewContentWidgets.prototype.shouldSuppressMouseDownOnWidget = function (widgetId) {\r\n        if (this._widgets.hasOwnProperty(widgetId)) {\r\n            return this._widgets[widgetId].suppressMouseDown;\r\n        }\r\n        return false;\r\n    };\r\n    ViewContentWidgets.prototype.onBeforeRender = function (viewportData) {\r\n        var keys = Object.keys(this._widgets);\r\n        for (var _i = 0, keys_3 = keys; _i < keys_3.length; _i++) {\r\n            var widgetId = keys_3[_i];\r\n            this._widgets[widgetId].onBeforeRender(viewportData);\r\n        }\r\n    };\r\n    ViewContentWidgets.prototype.prepareRender = function (ctx) {\r\n        var keys = Object.keys(this._widgets);\r\n        for (var _i = 0, keys_4 = keys; _i < keys_4.length; _i++) {\r\n            var widgetId = keys_4[_i];\r\n            this._widgets[widgetId].prepareRender(ctx);\r\n        }\r\n    };\r\n    ViewContentWidgets.prototype.render = function (ctx) {\r\n        var keys = Object.keys(this._widgets);\r\n        for (var _i = 0, keys_5 = keys; _i < keys_5.length; _i++) {\r\n            var widgetId = keys_5[_i];\r\n            this._widgets[widgetId].render(ctx);\r\n        }\r\n    };\r\n    return ViewContentWidgets;\r\n}(ViewPart));\r\nexport { ViewContentWidgets };\r\nvar Widget = /** @class */ (function () {\r\n    function Widget(context, viewDomNode, actual) {\r\n        this._context = context;\r\n        this._viewDomNode = viewDomNode;\r\n        this._actual = actual;\r\n        this.domNode = createFastDomNode(this._actual.getDomNode());\r\n        this.id = this._actual.getId();\r\n        this.allowEditorOverflow = this._actual.allowEditorOverflow || false;\r\n        this.suppressMouseDown = this._actual.suppressMouseDown || false;\r\n        var options = this._context.configuration.options;\r\n        var layoutInfo = options.get(107 /* layoutInfo */);\r\n        this._fixedOverflowWidgets = options.get(29 /* fixedOverflowWidgets */);\r\n        this._contentWidth = layoutInfo.contentWidth;\r\n        this._contentLeft = layoutInfo.contentLeft;\r\n        this._lineHeight = options.get(49 /* lineHeight */);\r\n        this._range = null;\r\n        this._viewRange = null;\r\n        this._preference = [];\r\n        this._cachedDomNodeClientWidth = -1;\r\n        this._cachedDomNodeClientHeight = -1;\r\n        this._maxWidth = this._getMaxWidth();\r\n        this._isVisible = false;\r\n        this._renderData = null;\r\n        this.domNode.setPosition((this._fixedOverflowWidgets && this.allowEditorOverflow) ? 'fixed' : 'absolute');\r\n        this.domNode.setVisibility('hidden');\r\n        this.domNode.setAttribute('widgetId', this.id);\r\n        this.domNode.setMaxWidth(this._maxWidth);\r\n    }\r\n    Widget.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._context.configuration.options;\r\n        this._lineHeight = options.get(49 /* lineHeight */);\r\n        if (e.hasChanged(107 /* layoutInfo */)) {\r\n            var layoutInfo = options.get(107 /* layoutInfo */);\r\n            this._contentLeft = layoutInfo.contentLeft;\r\n            this._contentWidth = layoutInfo.contentWidth;\r\n            this._maxWidth = this._getMaxWidth();\r\n        }\r\n    };\r\n    Widget.prototype.onLineMappingChanged = function (e) {\r\n        this._setPosition(this._range);\r\n    };\r\n    Widget.prototype._setPosition = function (range) {\r\n        this._range = range;\r\n        this._viewRange = null;\r\n        if (this._range) {\r\n            // Do not trust that widgets give a valid position\r\n            var validModelRange = this._context.model.validateModelRange(this._range);\r\n            if (this._context.model.coordinatesConverter.modelPositionIsVisible(validModelRange.getStartPosition()) || this._context.model.coordinatesConverter.modelPositionIsVisible(validModelRange.getEndPosition())) {\r\n                this._viewRange = this._context.model.coordinatesConverter.convertModelRangeToViewRange(validModelRange);\r\n            }\r\n        }\r\n    };\r\n    Widget.prototype._getMaxWidth = function () {\r\n        return (this.allowEditorOverflow\r\n            ? window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth\r\n            : this._contentWidth);\r\n    };\r\n    Widget.prototype.setPosition = function (range, preference) {\r\n        this._setPosition(range);\r\n        this._preference = preference;\r\n        this._cachedDomNodeClientWidth = -1;\r\n        this._cachedDomNodeClientHeight = -1;\r\n    };\r\n    Widget.prototype._layoutBoxInViewport = function (topLeft, bottomLeft, width, height, ctx) {\r\n        // Our visible box is split horizontally by the current line => 2 boxes\r\n        // a) the box above the line\r\n        var aboveLineTop = topLeft.top;\r\n        var heightAboveLine = aboveLineTop;\r\n        // b) the box under the line\r\n        var underLineTop = bottomLeft.top + this._lineHeight;\r\n        var heightUnderLine = ctx.viewportHeight - underLineTop;\r\n        var aboveTop = aboveLineTop - height;\r\n        var fitsAbove = (heightAboveLine >= height);\r\n        var belowTop = underLineTop;\r\n        var fitsBelow = (heightUnderLine >= height);\r\n        // And its left\r\n        var actualAboveLeft = topLeft.left;\r\n        var actualBelowLeft = bottomLeft.left;\r\n        if (actualAboveLeft + width > ctx.scrollLeft + ctx.viewportWidth) {\r\n            actualAboveLeft = ctx.scrollLeft + ctx.viewportWidth - width;\r\n        }\r\n        if (actualBelowLeft + width > ctx.scrollLeft + ctx.viewportWidth) {\r\n            actualBelowLeft = ctx.scrollLeft + ctx.viewportWidth - width;\r\n        }\r\n        if (actualAboveLeft < ctx.scrollLeft) {\r\n            actualAboveLeft = ctx.scrollLeft;\r\n        }\r\n        if (actualBelowLeft < ctx.scrollLeft) {\r\n            actualBelowLeft = ctx.scrollLeft;\r\n        }\r\n        return {\r\n            fitsAbove: fitsAbove,\r\n            aboveTop: aboveTop,\r\n            aboveLeft: actualAboveLeft,\r\n            fitsBelow: fitsBelow,\r\n            belowTop: belowTop,\r\n            belowLeft: actualBelowLeft,\r\n        };\r\n    };\r\n    Widget.prototype._layoutHorizontalSegmentInPage = function (windowSize, domNodePosition, left, width) {\r\n        // Initially, the limits are defined as the dom node limits\r\n        var MIN_LIMIT = Math.max(0, domNodePosition.left - width);\r\n        var MAX_LIMIT = Math.min(domNodePosition.left + domNodePosition.width + width, windowSize.width);\r\n        var absoluteLeft = domNodePosition.left + left - dom.StandardWindow.scrollX;\r\n        if (absoluteLeft + width > MAX_LIMIT) {\r\n            var delta = absoluteLeft - (MAX_LIMIT - width);\r\n            absoluteLeft -= delta;\r\n            left -= delta;\r\n        }\r\n        if (absoluteLeft < MIN_LIMIT) {\r\n            var delta = absoluteLeft - MIN_LIMIT;\r\n            absoluteLeft -= delta;\r\n            left -= delta;\r\n        }\r\n        return [left, absoluteLeft];\r\n    };\r\n    Widget.prototype._layoutBoxInPage = function (topLeft, bottomLeft, width, height, ctx) {\r\n        var aboveTop = topLeft.top - height;\r\n        var belowTop = bottomLeft.top + this._lineHeight;\r\n        var domNodePosition = dom.getDomNodePagePosition(this._viewDomNode.domNode);\r\n        var absoluteAboveTop = domNodePosition.top + aboveTop - dom.StandardWindow.scrollY;\r\n        var absoluteBelowTop = domNodePosition.top + belowTop - dom.StandardWindow.scrollY;\r\n        var windowSize = dom.getClientArea(document.body);\r\n        var _a = this._layoutHorizontalSegmentInPage(windowSize, domNodePosition, topLeft.left - ctx.scrollLeft + this._contentLeft, width), aboveLeft = _a[0], absoluteAboveLeft = _a[1];\r\n        var _b = this._layoutHorizontalSegmentInPage(windowSize, domNodePosition, bottomLeft.left - ctx.scrollLeft + this._contentLeft, width), belowLeft = _b[0], absoluteBelowLeft = _b[1];\r\n        // Leave some clearance to the top/bottom\r\n        var TOP_PADDING = 22;\r\n        var BOTTOM_PADDING = 22;\r\n        var fitsAbove = (absoluteAboveTop >= TOP_PADDING);\r\n        var fitsBelow = (absoluteBelowTop + height <= windowSize.height - BOTTOM_PADDING);\r\n        if (this._fixedOverflowWidgets) {\r\n            return {\r\n                fitsAbove: fitsAbove,\r\n                aboveTop: Math.max(absoluteAboveTop, TOP_PADDING),\r\n                aboveLeft: absoluteAboveLeft,\r\n                fitsBelow: fitsBelow,\r\n                belowTop: absoluteBelowTop,\r\n                belowLeft: absoluteBelowLeft\r\n            };\r\n        }\r\n        return {\r\n            fitsAbove: fitsAbove,\r\n            aboveTop: Math.max(aboveTop, TOP_PADDING),\r\n            aboveLeft: aboveLeft,\r\n            fitsBelow: fitsBelow,\r\n            belowTop: belowTop,\r\n            belowLeft: belowLeft\r\n        };\r\n    };\r\n    Widget.prototype._prepareRenderWidgetAtExactPositionOverflowing = function (topLeft) {\r\n        return new Coordinate(topLeft.top, topLeft.left + this._contentLeft);\r\n    };\r\n    /**\r\n     * Compute `this._topLeft`\r\n     */\r\n    Widget.prototype._getTopAndBottomLeft = function (ctx) {\r\n        if (!this._viewRange) {\r\n            return [null, null];\r\n        }\r\n        var visibleRangesForRange = ctx.linesVisibleRangesForRange(this._viewRange, false);\r\n        if (!visibleRangesForRange || visibleRangesForRange.length === 0) {\r\n            return [null, null];\r\n        }\r\n        var firstLine = visibleRangesForRange[0];\r\n        var lastLine = visibleRangesForRange[0];\r\n        for (var _i = 0, visibleRangesForRange_1 = visibleRangesForRange; _i < visibleRangesForRange_1.length; _i++) {\r\n            var visibleRangesForLine = visibleRangesForRange_1[_i];\r\n            if (visibleRangesForLine.lineNumber < firstLine.lineNumber) {\r\n                firstLine = visibleRangesForLine;\r\n            }\r\n            if (visibleRangesForLine.lineNumber > lastLine.lineNumber) {\r\n                lastLine = visibleRangesForLine;\r\n            }\r\n        }\r\n        var firstLineMinLeft = 1073741824 /* MAX_SAFE_SMALL_INTEGER */; //firstLine.Constants.MAX_SAFE_SMALL_INTEGER;\r\n        for (var _a = 0, _b = firstLine.ranges; _a < _b.length; _a++) {\r\n            var visibleRange = _b[_a];\r\n            if (visibleRange.left < firstLineMinLeft) {\r\n                firstLineMinLeft = visibleRange.left;\r\n            }\r\n        }\r\n        var lastLineMinLeft = 1073741824 /* MAX_SAFE_SMALL_INTEGER */; //lastLine.Constants.MAX_SAFE_SMALL_INTEGER;\r\n        for (var _c = 0, _d = lastLine.ranges; _c < _d.length; _c++) {\r\n            var visibleRange = _d[_c];\r\n            if (visibleRange.left < lastLineMinLeft) {\r\n                lastLineMinLeft = visibleRange.left;\r\n            }\r\n        }\r\n        var topForPosition = ctx.getVerticalOffsetForLineNumber(firstLine.lineNumber) - ctx.scrollTop;\r\n        var topLeft = new Coordinate(topForPosition, firstLineMinLeft);\r\n        var topForBottomLine = ctx.getVerticalOffsetForLineNumber(lastLine.lineNumber) - ctx.scrollTop;\r\n        var bottomLeft = new Coordinate(topForBottomLine, lastLineMinLeft);\r\n        return [topLeft, bottomLeft];\r\n    };\r\n    Widget.prototype._prepareRenderWidget = function (ctx) {\r\n        var _a = this._getTopAndBottomLeft(ctx), topLeft = _a[0], bottomLeft = _a[1];\r\n        if (!topLeft || !bottomLeft) {\r\n            return null;\r\n        }\r\n        if (this._cachedDomNodeClientWidth === -1 || this._cachedDomNodeClientHeight === -1) {\r\n            var domNode = this.domNode.domNode;\r\n            this._cachedDomNodeClientWidth = domNode.clientWidth;\r\n            this._cachedDomNodeClientHeight = domNode.clientHeight;\r\n        }\r\n        var placement;\r\n        if (this.allowEditorOverflow) {\r\n            placement = this._layoutBoxInPage(topLeft, bottomLeft, this._cachedDomNodeClientWidth, this._cachedDomNodeClientHeight, ctx);\r\n        }\r\n        else {\r\n            placement = this._layoutBoxInViewport(topLeft, bottomLeft, this._cachedDomNodeClientWidth, this._cachedDomNodeClientHeight, ctx);\r\n        }\r\n        // Do two passes, first for perfect fit, second picks first option\r\n        if (this._preference) {\r\n            for (var pass = 1; pass <= 2; pass++) {\r\n                for (var _i = 0, _b = this._preference; _i < _b.length; _i++) {\r\n                    var pref = _b[_i];\r\n                    // placement\r\n                    if (pref === 1 /* ABOVE */) {\r\n                        if (!placement) {\r\n                            // Widget outside of viewport\r\n                            return null;\r\n                        }\r\n                        if (pass === 2 || placement.fitsAbove) {\r\n                            return new Coordinate(placement.aboveTop, placement.aboveLeft);\r\n                        }\r\n                    }\r\n                    else if (pref === 2 /* BELOW */) {\r\n                        if (!placement) {\r\n                            // Widget outside of viewport\r\n                            return null;\r\n                        }\r\n                        if (pass === 2 || placement.fitsBelow) {\r\n                            return new Coordinate(placement.belowTop, placement.belowLeft);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (this.allowEditorOverflow) {\r\n                            return this._prepareRenderWidgetAtExactPositionOverflowing(topLeft);\r\n                        }\r\n                        else {\r\n                            return topLeft;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * On this first pass, we ensure that the content widget (if it is in the viewport) has the max width set correctly.\r\n     */\r\n    Widget.prototype.onBeforeRender = function (viewportData) {\r\n        if (!this._viewRange || !this._preference) {\r\n            return;\r\n        }\r\n        if (this._viewRange.endLineNumber < viewportData.startLineNumber || this._viewRange.startLineNumber > viewportData.endLineNumber) {\r\n            // Outside of viewport\r\n            return;\r\n        }\r\n        this.domNode.setMaxWidth(this._maxWidth);\r\n    };\r\n    Widget.prototype.prepareRender = function (ctx) {\r\n        this._renderData = this._prepareRenderWidget(ctx);\r\n    };\r\n    Widget.prototype.render = function (ctx) {\r\n        if (!this._renderData) {\r\n            // This widget should be invisible\r\n            if (this._isVisible) {\r\n                this.domNode.removeAttribute('monaco-visible-content-widget');\r\n                this._isVisible = false;\r\n                this.domNode.setVisibility('hidden');\r\n            }\r\n            return;\r\n        }\r\n        // This widget should be visible\r\n        if (this.allowEditorOverflow) {\r\n            this.domNode.setTop(this._renderData.top);\r\n            this.domNode.setLeft(this._renderData.left);\r\n        }\r\n        else {\r\n            this.domNode.setTop(this._renderData.top + ctx.scrollTop - ctx.bigNumbersDelta);\r\n            this.domNode.setLeft(this._renderData.left);\r\n        }\r\n        if (!this._isVisible) {\r\n            this.domNode.setVisibility('inherit');\r\n            this.domNode.setAttribute('monaco-visible-content-widget', 'true');\r\n            this._isVisible = true;\r\n        }\r\n    };\r\n    return Widget;\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}