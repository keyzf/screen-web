{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as browser from '../../../base/browser/browser.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { CharWidthRequest, readCharWidths } from './charWidthReader.js';\nimport { ElementSizeObserver } from './elementSizeObserver.js';\nimport { CommonEditorConfiguration } from '../../common/config/commonEditorConfig.js';\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\nimport { FontInfo } from '../../common/config/fontInfo.js';\n\nvar CSSBasedConfigurationCache =\n/** @class */\nfunction () {\n  function CSSBasedConfigurationCache() {\n    this._keys = Object.create(null);\n    this._values = Object.create(null);\n  }\n\n  CSSBasedConfigurationCache.prototype.has = function (item) {\n    var itemId = item.getId();\n    return !!this._values[itemId];\n  };\n\n  CSSBasedConfigurationCache.prototype.get = function (item) {\n    var itemId = item.getId();\n    return this._values[itemId];\n  };\n\n  CSSBasedConfigurationCache.prototype.put = function (item, value) {\n    var itemId = item.getId();\n    this._keys[itemId] = item;\n    this._values[itemId] = value;\n  };\n\n  CSSBasedConfigurationCache.prototype.remove = function (item) {\n    var itemId = item.getId();\n    delete this._keys[itemId];\n    delete this._values[itemId];\n  };\n\n  CSSBasedConfigurationCache.prototype.getValues = function () {\n    var _this = this;\n\n    return Object.keys(this._keys).map(function (id) {\n      return _this._values[id];\n    });\n  };\n\n  return CSSBasedConfigurationCache;\n}();\n\nexport function clearAllFontInfos() {\n  CSSBasedConfiguration.INSTANCE.clearCache();\n}\n\nvar CSSBasedConfiguration =\n/** @class */\nfunction (_super) {\n  __extends(CSSBasedConfiguration, _super);\n\n  function CSSBasedConfiguration() {\n    var _this = _super.call(this) || this;\n\n    _this._onDidChange = _this._register(new Emitter());\n    _this.onDidChange = _this._onDidChange.event;\n    _this._cache = new CSSBasedConfigurationCache();\n    _this._evictUntrustedReadingsTimeout = -1;\n    return _this;\n  }\n\n  CSSBasedConfiguration.prototype.dispose = function () {\n    if (this._evictUntrustedReadingsTimeout !== -1) {\n      clearTimeout(this._evictUntrustedReadingsTimeout);\n      this._evictUntrustedReadingsTimeout = -1;\n    }\n\n    _super.prototype.dispose.call(this);\n  };\n\n  CSSBasedConfiguration.prototype.clearCache = function () {\n    this._cache = new CSSBasedConfigurationCache();\n\n    this._onDidChange.fire();\n  };\n\n  CSSBasedConfiguration.prototype._writeToCache = function (item, value) {\n    var _this = this;\n\n    this._cache.put(item, value);\n\n    if (!value.isTrusted && this._evictUntrustedReadingsTimeout === -1) {\n      // Try reading again after some time\n      this._evictUntrustedReadingsTimeout = setTimeout(function () {\n        _this._evictUntrustedReadingsTimeout = -1;\n\n        _this._evictUntrustedReadings();\n      }, 5000);\n    }\n  };\n\n  CSSBasedConfiguration.prototype._evictUntrustedReadings = function () {\n    var values = this._cache.getValues();\n\n    var somethingRemoved = false;\n\n    for (var i = 0, len = values.length; i < len; i++) {\n      var item = values[i];\n\n      if (!item.isTrusted) {\n        somethingRemoved = true;\n\n        this._cache.remove(item);\n      }\n    }\n\n    if (somethingRemoved) {\n      this._onDidChange.fire();\n    }\n  };\n\n  CSSBasedConfiguration.prototype.readConfiguration = function (bareFontInfo) {\n    if (!this._cache.has(bareFontInfo)) {\n      var readConfig = CSSBasedConfiguration._actualReadConfiguration(bareFontInfo);\n\n      if (readConfig.typicalHalfwidthCharacterWidth <= 2 || readConfig.typicalFullwidthCharacterWidth <= 2 || readConfig.spaceWidth <= 2 || readConfig.maxDigitWidth <= 2) {\n        // Hey, it's Bug 14341 ... we couldn't read\n        readConfig = new FontInfo({\n          zoomLevel: browser.getZoomLevel(),\n          fontFamily: readConfig.fontFamily,\n          fontWeight: readConfig.fontWeight,\n          fontSize: readConfig.fontSize,\n          fontFeatureSettings: readConfig.fontFeatureSettings,\n          lineHeight: readConfig.lineHeight,\n          letterSpacing: readConfig.letterSpacing,\n          isMonospace: readConfig.isMonospace,\n          typicalHalfwidthCharacterWidth: Math.max(readConfig.typicalHalfwidthCharacterWidth, 5),\n          typicalFullwidthCharacterWidth: Math.max(readConfig.typicalFullwidthCharacterWidth, 5),\n          canUseHalfwidthRightwardsArrow: readConfig.canUseHalfwidthRightwardsArrow,\n          spaceWidth: Math.max(readConfig.spaceWidth, 5),\n          middotWidth: Math.max(readConfig.middotWidth, 5),\n          maxDigitWidth: Math.max(readConfig.maxDigitWidth, 5)\n        }, false);\n      }\n\n      this._writeToCache(bareFontInfo, readConfig);\n    }\n\n    return this._cache.get(bareFontInfo);\n  };\n\n  CSSBasedConfiguration.createRequest = function (chr, type, all, monospace) {\n    var result = new CharWidthRequest(chr, type);\n    all.push(result);\n\n    if (monospace) {\n      monospace.push(result);\n    }\n\n    return result;\n  };\n\n  CSSBasedConfiguration._actualReadConfiguration = function (bareFontInfo) {\n    var all = [];\n    var monospace = [];\n    var typicalHalfwidthCharacter = this.createRequest('n', 0\n    /* Regular */\n    , all, monospace);\n    var typicalFullwidthCharacter = this.createRequest('\\uff4d', 0\n    /* Regular */\n    , all, null);\n    var space = this.createRequest(' ', 0\n    /* Regular */\n    , all, monospace);\n    var digit0 = this.createRequest('0', 0\n    /* Regular */\n    , all, monospace);\n    var digit1 = this.createRequest('1', 0\n    /* Regular */\n    , all, monospace);\n    var digit2 = this.createRequest('2', 0\n    /* Regular */\n    , all, monospace);\n    var digit3 = this.createRequest('3', 0\n    /* Regular */\n    , all, monospace);\n    var digit4 = this.createRequest('4', 0\n    /* Regular */\n    , all, monospace);\n    var digit5 = this.createRequest('5', 0\n    /* Regular */\n    , all, monospace);\n    var digit6 = this.createRequest('6', 0\n    /* Regular */\n    , all, monospace);\n    var digit7 = this.createRequest('7', 0\n    /* Regular */\n    , all, monospace);\n    var digit8 = this.createRequest('8', 0\n    /* Regular */\n    , all, monospace);\n    var digit9 = this.createRequest('9', 0\n    /* Regular */\n    , all, monospace); // monospace test: used for whitespace rendering\n\n    var rightwardsArrow = this.createRequest('→', 0\n    /* Regular */\n    , all, monospace);\n    var halfwidthRightwardsArrow = this.createRequest('￫', 0\n    /* Regular */\n    , all, null); // middle dot character\n\n    var middot = this.createRequest('·', 0\n    /* Regular */\n    , all, monospace); // monospace test: some characters\n\n    this.createRequest('|', 0\n    /* Regular */\n    , all, monospace);\n    this.createRequest('/', 0\n    /* Regular */\n    , all, monospace);\n    this.createRequest('-', 0\n    /* Regular */\n    , all, monospace);\n    this.createRequest('_', 0\n    /* Regular */\n    , all, monospace);\n    this.createRequest('i', 0\n    /* Regular */\n    , all, monospace);\n    this.createRequest('l', 0\n    /* Regular */\n    , all, monospace);\n    this.createRequest('m', 0\n    /* Regular */\n    , all, monospace); // monospace italic test\n\n    this.createRequest('|', 1\n    /* Italic */\n    , all, monospace);\n    this.createRequest('_', 1\n    /* Italic */\n    , all, monospace);\n    this.createRequest('i', 1\n    /* Italic */\n    , all, monospace);\n    this.createRequest('l', 1\n    /* Italic */\n    , all, monospace);\n    this.createRequest('m', 1\n    /* Italic */\n    , all, monospace);\n    this.createRequest('n', 1\n    /* Italic */\n    , all, monospace); // monospace bold test\n\n    this.createRequest('|', 2\n    /* Bold */\n    , all, monospace);\n    this.createRequest('_', 2\n    /* Bold */\n    , all, monospace);\n    this.createRequest('i', 2\n    /* Bold */\n    , all, monospace);\n    this.createRequest('l', 2\n    /* Bold */\n    , all, monospace);\n    this.createRequest('m', 2\n    /* Bold */\n    , all, monospace);\n    this.createRequest('n', 2\n    /* Bold */\n    , all, monospace);\n    readCharWidths(bareFontInfo, all);\n    var maxDigitWidth = Math.max(digit0.width, digit1.width, digit2.width, digit3.width, digit4.width, digit5.width, digit6.width, digit7.width, digit8.width, digit9.width);\n    var isMonospace = bareFontInfo.fontFeatureSettings === EditorFontLigatures.OFF;\n    var referenceWidth = monospace[0].width;\n\n    for (var i = 1, len = monospace.length; isMonospace && i < len; i++) {\n      var diff = referenceWidth - monospace[i].width;\n\n      if (diff < -0.001 || diff > 0.001) {\n        isMonospace = false;\n        break;\n      }\n    }\n\n    var canUseHalfwidthRightwardsArrow = true;\n\n    if (isMonospace && halfwidthRightwardsArrow.width !== referenceWidth) {\n      // using a halfwidth rightwards arrow would break monospace...\n      canUseHalfwidthRightwardsArrow = false;\n    }\n\n    if (halfwidthRightwardsArrow.width > rightwardsArrow.width) {\n      // using a halfwidth rightwards arrow would paint a larger arrow than a regular rightwards arrow\n      canUseHalfwidthRightwardsArrow = false;\n    } // let's trust the zoom level only 2s after it was changed.\n\n\n    var canTrustBrowserZoomLevel = browser.getTimeSinceLastZoomLevelChanged() > 2000;\n    return new FontInfo({\n      zoomLevel: browser.getZoomLevel(),\n      fontFamily: bareFontInfo.fontFamily,\n      fontWeight: bareFontInfo.fontWeight,\n      fontSize: bareFontInfo.fontSize,\n      fontFeatureSettings: bareFontInfo.fontFeatureSettings,\n      lineHeight: bareFontInfo.lineHeight,\n      letterSpacing: bareFontInfo.letterSpacing,\n      isMonospace: isMonospace,\n      typicalHalfwidthCharacterWidth: typicalHalfwidthCharacter.width,\n      typicalFullwidthCharacterWidth: typicalFullwidthCharacter.width,\n      canUseHalfwidthRightwardsArrow: canUseHalfwidthRightwardsArrow,\n      spaceWidth: space.width,\n      middotWidth: middot.width,\n      maxDigitWidth: maxDigitWidth\n    }, canTrustBrowserZoomLevel);\n  };\n\n  CSSBasedConfiguration.INSTANCE = new CSSBasedConfiguration();\n  return CSSBasedConfiguration;\n}(Disposable);\n\nvar Configuration =\n/** @class */\nfunction (_super) {\n  __extends(Configuration, _super);\n\n  function Configuration(isSimpleWidget, options, referenceDomElement, accessibilityService) {\n    if (referenceDomElement === void 0) {\n      referenceDomElement = null;\n    }\n\n    var _this = _super.call(this, isSimpleWidget, options) || this;\n\n    _this.accessibilityService = accessibilityService;\n    _this._elementSizeObserver = _this._register(new ElementSizeObserver(referenceDomElement, options.dimension, function () {\n      return _this._onReferenceDomElementSizeChanged();\n    }));\n\n    _this._register(CSSBasedConfiguration.INSTANCE.onDidChange(function () {\n      return _this._onCSSBasedConfigurationChanged();\n    }));\n\n    if (_this._validatedOptions.get(9\n    /* automaticLayout */\n    )) {\n      _this._elementSizeObserver.startObserving();\n    }\n\n    _this._register(browser.onDidChangeZoomLevel(function (_) {\n      return _this._recomputeOptions();\n    }));\n\n    _this._register(_this.accessibilityService.onDidChangeScreenReaderOptimized(function () {\n      return _this._recomputeOptions();\n    }));\n\n    _this._recomputeOptions();\n\n    return _this;\n  }\n\n  Configuration.applyFontInfoSlow = function (domNode, fontInfo) {\n    domNode.style.fontFamily = fontInfo.getMassagedFontFamily();\n    domNode.style.fontWeight = fontInfo.fontWeight;\n    domNode.style.fontSize = fontInfo.fontSize + 'px';\n    domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\n    domNode.style.lineHeight = fontInfo.lineHeight + 'px';\n    domNode.style.letterSpacing = fontInfo.letterSpacing + 'px';\n  };\n\n  Configuration.applyFontInfo = function (domNode, fontInfo) {\n    domNode.setFontFamily(fontInfo.getMassagedFontFamily());\n    domNode.setFontWeight(fontInfo.fontWeight);\n    domNode.setFontSize(fontInfo.fontSize);\n    domNode.setFontFeatureSettings(fontInfo.fontFeatureSettings);\n    domNode.setLineHeight(fontInfo.lineHeight);\n    domNode.setLetterSpacing(fontInfo.letterSpacing);\n  };\n\n  Configuration.prototype._onReferenceDomElementSizeChanged = function () {\n    this._recomputeOptions();\n  };\n\n  Configuration.prototype._onCSSBasedConfigurationChanged = function () {\n    this._recomputeOptions();\n  };\n\n  Configuration.prototype.observeReferenceElement = function (dimension) {\n    this._elementSizeObserver.observe(dimension);\n  };\n\n  Configuration.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n  };\n\n  Configuration.prototype._getExtraEditorClassName = function () {\n    var extra = '';\n\n    if (!browser.isSafari && !browser.isWebkitWebView) {\n      // Use user-select: none in all browsers except Safari and native macOS WebView\n      extra += 'no-user-select ';\n    }\n\n    if (platform.isMacintosh) {\n      extra += 'mac ';\n    }\n\n    return extra;\n  };\n\n  Configuration.prototype._getEnvConfiguration = function () {\n    return {\n      extraEditorClassName: this._getExtraEditorClassName(),\n      outerWidth: this._elementSizeObserver.getWidth(),\n      outerHeight: this._elementSizeObserver.getHeight(),\n      emptySelectionClipboard: browser.isWebKit || browser.isFirefox,\n      pixelRatio: browser.getPixelRatio(),\n      zoomLevel: browser.getZoomLevel(),\n      accessibilitySupport: this.accessibilityService.isScreenReaderOptimized() ? 2\n      /* Enabled */\n      : this.accessibilityService.getAccessibilitySupport()\n    };\n  };\n\n  Configuration.prototype.readConfiguration = function (bareFontInfo) {\n    return CSSBasedConfiguration.INSTANCE.readConfiguration(bareFontInfo);\n  };\n\n  return Configuration;\n}(CommonEditorConfiguration);\n\nexport { Configuration };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/config/configuration.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","browser","Emitter","Disposable","platform","CharWidthRequest","readCharWidths","ElementSizeObserver","CommonEditorConfiguration","EditorFontLigatures","FontInfo","CSSBasedConfigurationCache","_keys","_values","has","item","itemId","getId","get","put","value","remove","getValues","_this","keys","map","id","clearAllFontInfos","CSSBasedConfiguration","INSTANCE","clearCache","_super","call","_onDidChange","_register","onDidChange","event","_cache","_evictUntrustedReadingsTimeout","dispose","clearTimeout","fire","_writeToCache","isTrusted","setTimeout","_evictUntrustedReadings","values","somethingRemoved","i","len","length","readConfiguration","bareFontInfo","readConfig","_actualReadConfiguration","typicalHalfwidthCharacterWidth","typicalFullwidthCharacterWidth","spaceWidth","maxDigitWidth","zoomLevel","getZoomLevel","fontFamily","fontWeight","fontSize","fontFeatureSettings","lineHeight","letterSpacing","isMonospace","Math","max","canUseHalfwidthRightwardsArrow","middotWidth","createRequest","chr","type","all","monospace","result","push","typicalHalfwidthCharacter","typicalFullwidthCharacter","space","digit0","digit1","digit2","digit3","digit4","digit5","digit6","digit7","digit8","digit9","rightwardsArrow","halfwidthRightwardsArrow","middot","width","OFF","referenceWidth","diff","canTrustBrowserZoomLevel","getTimeSinceLastZoomLevelChanged","Configuration","isSimpleWidget","options","referenceDomElement","accessibilityService","_elementSizeObserver","dimension","_onReferenceDomElementSizeChanged","_onCSSBasedConfigurationChanged","_validatedOptions","startObserving","onDidChangeZoomLevel","_","_recomputeOptions","onDidChangeScreenReaderOptimized","applyFontInfoSlow","domNode","fontInfo","style","getMassagedFontFamily","applyFontInfo","setFontFamily","setFontWeight","setFontSize","setFontFeatureSettings","setLineHeight","setLetterSpacing","observeReferenceElement","observe","_getExtraEditorClassName","extra","isSafari","isWebkitWebView","isMacintosh","_getEnvConfiguration","extraEditorClassName","outerWidth","getWidth","outerHeight","getHeight","emptySelectionClipboard","isWebKit","isFirefox","pixelRatio","getPixelRatio","accessibilitySupport","isScreenReaderOptimized","getAccessibilitySupport"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { CharWidthRequest, readCharWidths } from './charWidthReader.js';\r\nimport { ElementSizeObserver } from './elementSizeObserver.js';\r\nimport { CommonEditorConfiguration } from '../../common/config/commonEditorConfig.js';\r\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\r\nimport { FontInfo } from '../../common/config/fontInfo.js';\r\nvar CSSBasedConfigurationCache = /** @class */ (function () {\r\n    function CSSBasedConfigurationCache() {\r\n        this._keys = Object.create(null);\r\n        this._values = Object.create(null);\r\n    }\r\n    CSSBasedConfigurationCache.prototype.has = function (item) {\r\n        var itemId = item.getId();\r\n        return !!this._values[itemId];\r\n    };\r\n    CSSBasedConfigurationCache.prototype.get = function (item) {\r\n        var itemId = item.getId();\r\n        return this._values[itemId];\r\n    };\r\n    CSSBasedConfigurationCache.prototype.put = function (item, value) {\r\n        var itemId = item.getId();\r\n        this._keys[itemId] = item;\r\n        this._values[itemId] = value;\r\n    };\r\n    CSSBasedConfigurationCache.prototype.remove = function (item) {\r\n        var itemId = item.getId();\r\n        delete this._keys[itemId];\r\n        delete this._values[itemId];\r\n    };\r\n    CSSBasedConfigurationCache.prototype.getValues = function () {\r\n        var _this = this;\r\n        return Object.keys(this._keys).map(function (id) { return _this._values[id]; });\r\n    };\r\n    return CSSBasedConfigurationCache;\r\n}());\r\nexport function clearAllFontInfos() {\r\n    CSSBasedConfiguration.INSTANCE.clearCache();\r\n}\r\nvar CSSBasedConfiguration = /** @class */ (function (_super) {\r\n    __extends(CSSBasedConfiguration, _super);\r\n    function CSSBasedConfiguration() {\r\n        var _this = _super.call(this) || this;\r\n        _this._onDidChange = _this._register(new Emitter());\r\n        _this.onDidChange = _this._onDidChange.event;\r\n        _this._cache = new CSSBasedConfigurationCache();\r\n        _this._evictUntrustedReadingsTimeout = -1;\r\n        return _this;\r\n    }\r\n    CSSBasedConfiguration.prototype.dispose = function () {\r\n        if (this._evictUntrustedReadingsTimeout !== -1) {\r\n            clearTimeout(this._evictUntrustedReadingsTimeout);\r\n            this._evictUntrustedReadingsTimeout = -1;\r\n        }\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    CSSBasedConfiguration.prototype.clearCache = function () {\r\n        this._cache = new CSSBasedConfigurationCache();\r\n        this._onDidChange.fire();\r\n    };\r\n    CSSBasedConfiguration.prototype._writeToCache = function (item, value) {\r\n        var _this = this;\r\n        this._cache.put(item, value);\r\n        if (!value.isTrusted && this._evictUntrustedReadingsTimeout === -1) {\r\n            // Try reading again after some time\r\n            this._evictUntrustedReadingsTimeout = setTimeout(function () {\r\n                _this._evictUntrustedReadingsTimeout = -1;\r\n                _this._evictUntrustedReadings();\r\n            }, 5000);\r\n        }\r\n    };\r\n    CSSBasedConfiguration.prototype._evictUntrustedReadings = function () {\r\n        var values = this._cache.getValues();\r\n        var somethingRemoved = false;\r\n        for (var i = 0, len = values.length; i < len; i++) {\r\n            var item = values[i];\r\n            if (!item.isTrusted) {\r\n                somethingRemoved = true;\r\n                this._cache.remove(item);\r\n            }\r\n        }\r\n        if (somethingRemoved) {\r\n            this._onDidChange.fire();\r\n        }\r\n    };\r\n    CSSBasedConfiguration.prototype.readConfiguration = function (bareFontInfo) {\r\n        if (!this._cache.has(bareFontInfo)) {\r\n            var readConfig = CSSBasedConfiguration._actualReadConfiguration(bareFontInfo);\r\n            if (readConfig.typicalHalfwidthCharacterWidth <= 2 || readConfig.typicalFullwidthCharacterWidth <= 2 || readConfig.spaceWidth <= 2 || readConfig.maxDigitWidth <= 2) {\r\n                // Hey, it's Bug 14341 ... we couldn't read\r\n                readConfig = new FontInfo({\r\n                    zoomLevel: browser.getZoomLevel(),\r\n                    fontFamily: readConfig.fontFamily,\r\n                    fontWeight: readConfig.fontWeight,\r\n                    fontSize: readConfig.fontSize,\r\n                    fontFeatureSettings: readConfig.fontFeatureSettings,\r\n                    lineHeight: readConfig.lineHeight,\r\n                    letterSpacing: readConfig.letterSpacing,\r\n                    isMonospace: readConfig.isMonospace,\r\n                    typicalHalfwidthCharacterWidth: Math.max(readConfig.typicalHalfwidthCharacterWidth, 5),\r\n                    typicalFullwidthCharacterWidth: Math.max(readConfig.typicalFullwidthCharacterWidth, 5),\r\n                    canUseHalfwidthRightwardsArrow: readConfig.canUseHalfwidthRightwardsArrow,\r\n                    spaceWidth: Math.max(readConfig.spaceWidth, 5),\r\n                    middotWidth: Math.max(readConfig.middotWidth, 5),\r\n                    maxDigitWidth: Math.max(readConfig.maxDigitWidth, 5),\r\n                }, false);\r\n            }\r\n            this._writeToCache(bareFontInfo, readConfig);\r\n        }\r\n        return this._cache.get(bareFontInfo);\r\n    };\r\n    CSSBasedConfiguration.createRequest = function (chr, type, all, monospace) {\r\n        var result = new CharWidthRequest(chr, type);\r\n        all.push(result);\r\n        if (monospace) {\r\n            monospace.push(result);\r\n        }\r\n        return result;\r\n    };\r\n    CSSBasedConfiguration._actualReadConfiguration = function (bareFontInfo) {\r\n        var all = [];\r\n        var monospace = [];\r\n        var typicalHalfwidthCharacter = this.createRequest('n', 0 /* Regular */, all, monospace);\r\n        var typicalFullwidthCharacter = this.createRequest('\\uff4d', 0 /* Regular */, all, null);\r\n        var space = this.createRequest(' ', 0 /* Regular */, all, monospace);\r\n        var digit0 = this.createRequest('0', 0 /* Regular */, all, monospace);\r\n        var digit1 = this.createRequest('1', 0 /* Regular */, all, monospace);\r\n        var digit2 = this.createRequest('2', 0 /* Regular */, all, monospace);\r\n        var digit3 = this.createRequest('3', 0 /* Regular */, all, monospace);\r\n        var digit4 = this.createRequest('4', 0 /* Regular */, all, monospace);\r\n        var digit5 = this.createRequest('5', 0 /* Regular */, all, monospace);\r\n        var digit6 = this.createRequest('6', 0 /* Regular */, all, monospace);\r\n        var digit7 = this.createRequest('7', 0 /* Regular */, all, monospace);\r\n        var digit8 = this.createRequest('8', 0 /* Regular */, all, monospace);\r\n        var digit9 = this.createRequest('9', 0 /* Regular */, all, monospace);\r\n        // monospace test: used for whitespace rendering\r\n        var rightwardsArrow = this.createRequest('→', 0 /* Regular */, all, monospace);\r\n        var halfwidthRightwardsArrow = this.createRequest('￫', 0 /* Regular */, all, null);\r\n        // middle dot character\r\n        var middot = this.createRequest('·', 0 /* Regular */, all, monospace);\r\n        // monospace test: some characters\r\n        this.createRequest('|', 0 /* Regular */, all, monospace);\r\n        this.createRequest('/', 0 /* Regular */, all, monospace);\r\n        this.createRequest('-', 0 /* Regular */, all, monospace);\r\n        this.createRequest('_', 0 /* Regular */, all, monospace);\r\n        this.createRequest('i', 0 /* Regular */, all, monospace);\r\n        this.createRequest('l', 0 /* Regular */, all, monospace);\r\n        this.createRequest('m', 0 /* Regular */, all, monospace);\r\n        // monospace italic test\r\n        this.createRequest('|', 1 /* Italic */, all, monospace);\r\n        this.createRequest('_', 1 /* Italic */, all, monospace);\r\n        this.createRequest('i', 1 /* Italic */, all, monospace);\r\n        this.createRequest('l', 1 /* Italic */, all, monospace);\r\n        this.createRequest('m', 1 /* Italic */, all, monospace);\r\n        this.createRequest('n', 1 /* Italic */, all, monospace);\r\n        // monospace bold test\r\n        this.createRequest('|', 2 /* Bold */, all, monospace);\r\n        this.createRequest('_', 2 /* Bold */, all, monospace);\r\n        this.createRequest('i', 2 /* Bold */, all, monospace);\r\n        this.createRequest('l', 2 /* Bold */, all, monospace);\r\n        this.createRequest('m', 2 /* Bold */, all, monospace);\r\n        this.createRequest('n', 2 /* Bold */, all, monospace);\r\n        readCharWidths(bareFontInfo, all);\r\n        var maxDigitWidth = Math.max(digit0.width, digit1.width, digit2.width, digit3.width, digit4.width, digit5.width, digit6.width, digit7.width, digit8.width, digit9.width);\r\n        var isMonospace = (bareFontInfo.fontFeatureSettings === EditorFontLigatures.OFF);\r\n        var referenceWidth = monospace[0].width;\r\n        for (var i = 1, len = monospace.length; isMonospace && i < len; i++) {\r\n            var diff = referenceWidth - monospace[i].width;\r\n            if (diff < -0.001 || diff > 0.001) {\r\n                isMonospace = false;\r\n                break;\r\n            }\r\n        }\r\n        var canUseHalfwidthRightwardsArrow = true;\r\n        if (isMonospace && halfwidthRightwardsArrow.width !== referenceWidth) {\r\n            // using a halfwidth rightwards arrow would break monospace...\r\n            canUseHalfwidthRightwardsArrow = false;\r\n        }\r\n        if (halfwidthRightwardsArrow.width > rightwardsArrow.width) {\r\n            // using a halfwidth rightwards arrow would paint a larger arrow than a regular rightwards arrow\r\n            canUseHalfwidthRightwardsArrow = false;\r\n        }\r\n        // let's trust the zoom level only 2s after it was changed.\r\n        var canTrustBrowserZoomLevel = (browser.getTimeSinceLastZoomLevelChanged() > 2000);\r\n        return new FontInfo({\r\n            zoomLevel: browser.getZoomLevel(),\r\n            fontFamily: bareFontInfo.fontFamily,\r\n            fontWeight: bareFontInfo.fontWeight,\r\n            fontSize: bareFontInfo.fontSize,\r\n            fontFeatureSettings: bareFontInfo.fontFeatureSettings,\r\n            lineHeight: bareFontInfo.lineHeight,\r\n            letterSpacing: bareFontInfo.letterSpacing,\r\n            isMonospace: isMonospace,\r\n            typicalHalfwidthCharacterWidth: typicalHalfwidthCharacter.width,\r\n            typicalFullwidthCharacterWidth: typicalFullwidthCharacter.width,\r\n            canUseHalfwidthRightwardsArrow: canUseHalfwidthRightwardsArrow,\r\n            spaceWidth: space.width,\r\n            middotWidth: middot.width,\r\n            maxDigitWidth: maxDigitWidth\r\n        }, canTrustBrowserZoomLevel);\r\n    };\r\n    CSSBasedConfiguration.INSTANCE = new CSSBasedConfiguration();\r\n    return CSSBasedConfiguration;\r\n}(Disposable));\r\nvar Configuration = /** @class */ (function (_super) {\r\n    __extends(Configuration, _super);\r\n    function Configuration(isSimpleWidget, options, referenceDomElement, accessibilityService) {\r\n        if (referenceDomElement === void 0) { referenceDomElement = null; }\r\n        var _this = _super.call(this, isSimpleWidget, options) || this;\r\n        _this.accessibilityService = accessibilityService;\r\n        _this._elementSizeObserver = _this._register(new ElementSizeObserver(referenceDomElement, options.dimension, function () { return _this._onReferenceDomElementSizeChanged(); }));\r\n        _this._register(CSSBasedConfiguration.INSTANCE.onDidChange(function () { return _this._onCSSBasedConfigurationChanged(); }));\r\n        if (_this._validatedOptions.get(9 /* automaticLayout */)) {\r\n            _this._elementSizeObserver.startObserving();\r\n        }\r\n        _this._register(browser.onDidChangeZoomLevel(function (_) { return _this._recomputeOptions(); }));\r\n        _this._register(_this.accessibilityService.onDidChangeScreenReaderOptimized(function () { return _this._recomputeOptions(); }));\r\n        _this._recomputeOptions();\r\n        return _this;\r\n    }\r\n    Configuration.applyFontInfoSlow = function (domNode, fontInfo) {\r\n        domNode.style.fontFamily = fontInfo.getMassagedFontFamily();\r\n        domNode.style.fontWeight = fontInfo.fontWeight;\r\n        domNode.style.fontSize = fontInfo.fontSize + 'px';\r\n        domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\r\n        domNode.style.lineHeight = fontInfo.lineHeight + 'px';\r\n        domNode.style.letterSpacing = fontInfo.letterSpacing + 'px';\r\n    };\r\n    Configuration.applyFontInfo = function (domNode, fontInfo) {\r\n        domNode.setFontFamily(fontInfo.getMassagedFontFamily());\r\n        domNode.setFontWeight(fontInfo.fontWeight);\r\n        domNode.setFontSize(fontInfo.fontSize);\r\n        domNode.setFontFeatureSettings(fontInfo.fontFeatureSettings);\r\n        domNode.setLineHeight(fontInfo.lineHeight);\r\n        domNode.setLetterSpacing(fontInfo.letterSpacing);\r\n    };\r\n    Configuration.prototype._onReferenceDomElementSizeChanged = function () {\r\n        this._recomputeOptions();\r\n    };\r\n    Configuration.prototype._onCSSBasedConfigurationChanged = function () {\r\n        this._recomputeOptions();\r\n    };\r\n    Configuration.prototype.observeReferenceElement = function (dimension) {\r\n        this._elementSizeObserver.observe(dimension);\r\n    };\r\n    Configuration.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    Configuration.prototype._getExtraEditorClassName = function () {\r\n        var extra = '';\r\n        if (!browser.isSafari && !browser.isWebkitWebView) {\r\n            // Use user-select: none in all browsers except Safari and native macOS WebView\r\n            extra += 'no-user-select ';\r\n        }\r\n        if (platform.isMacintosh) {\r\n            extra += 'mac ';\r\n        }\r\n        return extra;\r\n    };\r\n    Configuration.prototype._getEnvConfiguration = function () {\r\n        return {\r\n            extraEditorClassName: this._getExtraEditorClassName(),\r\n            outerWidth: this._elementSizeObserver.getWidth(),\r\n            outerHeight: this._elementSizeObserver.getHeight(),\r\n            emptySelectionClipboard: browser.isWebKit || browser.isFirefox,\r\n            pixelRatio: browser.getPixelRatio(),\r\n            zoomLevel: browser.getZoomLevel(),\r\n            accessibilitySupport: (this.accessibilityService.isScreenReaderOptimized()\r\n                ? 2 /* Enabled */\r\n                : this.accessibilityService.getAccessibilitySupport())\r\n        };\r\n    };\r\n    Configuration.prototype.readConfiguration = function (bareFontInfo) {\r\n        return CSSBasedConfiguration.INSTANCE.readConfiguration(bareFontInfo);\r\n    };\r\n    return Configuration;\r\n}(CommonEditorConfiguration));\r\nexport { Configuration };\r\n"]},"metadata":{},"sourceType":"module"}