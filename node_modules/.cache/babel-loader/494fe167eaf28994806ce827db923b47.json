{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { Event, PauseableEmitter } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { keys } from '../../../base/common/map.js';\nimport { CommandsRegistry } from '../../commands/common/commands.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IContextKeyService, SET_CONTEXT_COMMAND_ID } from '../common/contextkey.js';\nimport { KeybindingResolver } from '../../keybinding/common/keybindingResolver.js';\nvar KEYBINDING_CONTEXT_ATTR = 'data-keybinding-context';\n\nvar Context =\n/** @class */\nfunction () {\n  function Context(id, parent) {\n    this._id = id;\n    this._parent = parent;\n    this._value = Object.create(null);\n    this._value['_contextId'] = id;\n  }\n\n  Context.prototype.setValue = function (key, value) {\n    // console.log('SET ' + key + ' = ' + value + ' ON ' + this._id);\n    if (this._value[key] !== value) {\n      this._value[key] = value;\n      return true;\n    }\n\n    return false;\n  };\n\n  Context.prototype.removeValue = function (key) {\n    // console.log('REMOVE ' + key + ' FROM ' + this._id);\n    if (key in this._value) {\n      delete this._value[key];\n      return true;\n    }\n\n    return false;\n  };\n\n  Context.prototype.getValue = function (key) {\n    var ret = this._value[key];\n\n    if (typeof ret === 'undefined' && this._parent) {\n      return this._parent.getValue(key);\n    }\n\n    return ret;\n  };\n\n  return Context;\n}();\n\nexport { Context };\n\nvar NullContext =\n/** @class */\nfunction (_super) {\n  __extends(NullContext, _super);\n\n  function NullContext() {\n    return _super.call(this, -1, null) || this;\n  }\n\n  NullContext.prototype.setValue = function (key, value) {\n    return false;\n  };\n\n  NullContext.prototype.removeValue = function (key) {\n    return false;\n  };\n\n  NullContext.prototype.getValue = function (key) {\n    return undefined;\n  };\n\n  NullContext.INSTANCE = new NullContext();\n  return NullContext;\n}(Context);\n\nvar ConfigAwareContextValuesContainer =\n/** @class */\nfunction (_super) {\n  __extends(ConfigAwareContextValuesContainer, _super);\n\n  function ConfigAwareContextValuesContainer(id, _configurationService, emitter) {\n    var _this = _super.call(this, id, null) || this;\n\n    _this._configurationService = _configurationService;\n    _this._values = new Map();\n    _this._listener = _this._configurationService.onDidChangeConfiguration(function (event) {\n      if (event.source === 6\n      /* DEFAULT */\n      ) {\n          // new setting, reset everything\n          var allKeys = keys(_this._values);\n\n          _this._values.clear();\n\n          emitter.fire(new ArrayContextKeyChangeEvent(allKeys));\n        } else {\n        var changedKeys = [];\n\n        for (var _i = 0, _a = event.affectedKeys; _i < _a.length; _i++) {\n          var configKey = _a[_i];\n          var contextKey = \"config.\" + configKey;\n\n          if (_this._values.has(contextKey)) {\n            _this._values.delete(contextKey);\n\n            changedKeys.push(contextKey);\n          }\n        }\n\n        emitter.fire(new ArrayContextKeyChangeEvent(changedKeys));\n      }\n    });\n    return _this;\n  }\n\n  ConfigAwareContextValuesContainer.prototype.dispose = function () {\n    this._listener.dispose();\n  };\n\n  ConfigAwareContextValuesContainer.prototype.getValue = function (key) {\n    if (key.indexOf(ConfigAwareContextValuesContainer._keyPrefix) !== 0) {\n      return _super.prototype.getValue.call(this, key);\n    }\n\n    if (this._values.has(key)) {\n      return this._values.get(key);\n    }\n\n    var configKey = key.substr(ConfigAwareContextValuesContainer._keyPrefix.length);\n\n    var configValue = this._configurationService.getValue(configKey);\n\n    var value = undefined;\n\n    switch (typeof configValue) {\n      case 'number':\n      case 'boolean':\n      case 'string':\n        value = configValue;\n        break;\n    }\n\n    this._values.set(key, value);\n\n    return value;\n  };\n\n  ConfigAwareContextValuesContainer.prototype.setValue = function (key, value) {\n    return _super.prototype.setValue.call(this, key, value);\n  };\n\n  ConfigAwareContextValuesContainer.prototype.removeValue = function (key) {\n    return _super.prototype.removeValue.call(this, key);\n  };\n\n  ConfigAwareContextValuesContainer._keyPrefix = 'config.';\n  return ConfigAwareContextValuesContainer;\n}(Context);\n\nvar ContextKey =\n/** @class */\nfunction () {\n  function ContextKey(service, key, defaultValue) {\n    this._service = service;\n    this._key = key;\n    this._defaultValue = defaultValue;\n    this.reset();\n  }\n\n  ContextKey.prototype.set = function (value) {\n    this._service.setContext(this._key, value);\n  };\n\n  ContextKey.prototype.reset = function () {\n    if (typeof this._defaultValue === 'undefined') {\n      this._service.removeContext(this._key);\n    } else {\n      this._service.setContext(this._key, this._defaultValue);\n    }\n  };\n\n  ContextKey.prototype.get = function () {\n    return this._service.getContextKeyValue(this._key);\n  };\n\n  return ContextKey;\n}();\n\nvar SimpleContextKeyChangeEvent =\n/** @class */\nfunction () {\n  function SimpleContextKeyChangeEvent(key) {\n    this.key = key;\n  }\n\n  SimpleContextKeyChangeEvent.prototype.affectsSome = function (keys) {\n    return keys.has(this.key);\n  };\n\n  return SimpleContextKeyChangeEvent;\n}();\n\nvar ArrayContextKeyChangeEvent =\n/** @class */\nfunction () {\n  function ArrayContextKeyChangeEvent(keys) {\n    this.keys = keys;\n  }\n\n  ArrayContextKeyChangeEvent.prototype.affectsSome = function (keys) {\n    for (var _i = 0, _a = this.keys; _i < _a.length; _i++) {\n      var key = _a[_i];\n\n      if (keys.has(key)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  return ArrayContextKeyChangeEvent;\n}();\n\nvar CompositeContextKeyChangeEvent =\n/** @class */\nfunction () {\n  function CompositeContextKeyChangeEvent(events) {\n    this.events = events;\n  }\n\n  CompositeContextKeyChangeEvent.prototype.affectsSome = function (keys) {\n    for (var _i = 0, _a = this.events; _i < _a.length; _i++) {\n      var e = _a[_i];\n\n      if (e.affectsSome(keys)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  return CompositeContextKeyChangeEvent;\n}();\n\nvar AbstractContextKeyService =\n/** @class */\nfunction () {\n  function AbstractContextKeyService(myContextId) {\n    this._onDidChangeContext = new PauseableEmitter({\n      merge: function (input) {\n        return new CompositeContextKeyChangeEvent(input);\n      }\n    });\n    this._isDisposed = false;\n    this._myContextId = myContextId;\n  }\n\n  AbstractContextKeyService.prototype.createKey = function (key, defaultValue) {\n    if (this._isDisposed) {\n      throw new Error(\"AbstractContextKeyService has been disposed\");\n    }\n\n    return new ContextKey(this, key, defaultValue);\n  };\n\n  Object.defineProperty(AbstractContextKeyService.prototype, \"onDidChangeContext\", {\n    get: function () {\n      return this._onDidChangeContext.event;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AbstractContextKeyService.prototype.bufferChangeEvents = function (callback) {\n    this._onDidChangeContext.pause();\n\n    try {\n      callback();\n    } finally {\n      this._onDidChangeContext.resume();\n    }\n  };\n\n  AbstractContextKeyService.prototype.createScoped = function (domNode) {\n    if (this._isDisposed) {\n      throw new Error(\"AbstractContextKeyService has been disposed\");\n    }\n\n    return new ScopedContextKeyService(this, domNode);\n  };\n\n  AbstractContextKeyService.prototype.contextMatchesRules = function (rules) {\n    if (this._isDisposed) {\n      throw new Error(\"AbstractContextKeyService has been disposed\");\n    }\n\n    var context = this.getContextValuesContainer(this._myContextId);\n    var result = KeybindingResolver.contextMatchesRules(context, rules); // console.group(rules.serialize() + ' -> ' + result);\n    // rules.keys().forEach(key => { console.log(key, ctx[key]); });\n    // console.groupEnd();\n\n    return result;\n  };\n\n  AbstractContextKeyService.prototype.getContextKeyValue = function (key) {\n    if (this._isDisposed) {\n      return undefined;\n    }\n\n    return this.getContextValuesContainer(this._myContextId).getValue(key);\n  };\n\n  AbstractContextKeyService.prototype.setContext = function (key, value) {\n    if (this._isDisposed) {\n      return;\n    }\n\n    var myContext = this.getContextValuesContainer(this._myContextId);\n\n    if (!myContext) {\n      return;\n    }\n\n    if (myContext.setValue(key, value)) {\n      this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(key));\n    }\n  };\n\n  AbstractContextKeyService.prototype.removeContext = function (key) {\n    if (this._isDisposed) {\n      return;\n    }\n\n    if (this.getContextValuesContainer(this._myContextId).removeValue(key)) {\n      this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(key));\n    }\n  };\n\n  AbstractContextKeyService.prototype.getContext = function (target) {\n    if (this._isDisposed) {\n      return NullContext.INSTANCE;\n    }\n\n    return this.getContextValuesContainer(findContextAttr(target));\n  };\n\n  return AbstractContextKeyService;\n}();\n\nexport { AbstractContextKeyService };\n\nvar ContextKeyService =\n/** @class */\nfunction (_super) {\n  __extends(ContextKeyService, _super);\n\n  function ContextKeyService(configurationService) {\n    var _this = _super.call(this, 0) || this;\n\n    _this._contexts = new Map();\n    _this._toDispose = new DisposableStore();\n    _this._lastContextId = 0;\n    var myContext = new ConfigAwareContextValuesContainer(_this._myContextId, configurationService, _this._onDidChangeContext);\n\n    _this._contexts.set(_this._myContextId, myContext);\n\n    _this._toDispose.add(myContext);\n\n    return _this; // Uncomment this to see the contexts continuously logged\n    // let lastLoggedValue: string | null = null;\n    // setInterval(() => {\n    // \tlet values = Object.keys(this._contexts).map((key) => this._contexts[key]);\n    // \tlet logValue = values.map(v => JSON.stringify(v._value, null, '\\t')).join('\\n');\n    // \tif (lastLoggedValue !== logValue) {\n    // \t\tlastLoggedValue = logValue;\n    // \t\tconsole.log(lastLoggedValue);\n    // \t}\n    // }, 2000);\n  }\n\n  ContextKeyService.prototype.dispose = function () {\n    this._isDisposed = true;\n\n    this._toDispose.dispose();\n  };\n\n  ContextKeyService.prototype.getContextValuesContainer = function (contextId) {\n    if (this._isDisposed) {\n      return NullContext.INSTANCE;\n    }\n\n    return this._contexts.get(contextId) || NullContext.INSTANCE;\n  };\n\n  ContextKeyService.prototype.createChildContext = function (parentContextId) {\n    if (parentContextId === void 0) {\n      parentContextId = this._myContextId;\n    }\n\n    if (this._isDisposed) {\n      throw new Error(\"ContextKeyService has been disposed\");\n    }\n\n    var id = ++this._lastContextId;\n\n    this._contexts.set(id, new Context(id, this.getContextValuesContainer(parentContextId)));\n\n    return id;\n  };\n\n  ContextKeyService.prototype.disposeContext = function (contextId) {\n    if (!this._isDisposed) {\n      this._contexts.delete(contextId);\n    }\n  };\n\n  ContextKeyService = __decorate([__param(0, IConfigurationService)], ContextKeyService);\n  return ContextKeyService;\n}(AbstractContextKeyService);\n\nexport { ContextKeyService };\n\nvar ScopedContextKeyService =\n/** @class */\nfunction (_super) {\n  __extends(ScopedContextKeyService, _super);\n\n  function ScopedContextKeyService(parent, domNode) {\n    var _this = _super.call(this, parent.createChildContext()) || this;\n\n    _this._parent = parent;\n\n    if (domNode) {\n      _this._domNode = domNode;\n\n      _this._domNode.setAttribute(KEYBINDING_CONTEXT_ATTR, String(_this._myContextId));\n    }\n\n    return _this;\n  }\n\n  ScopedContextKeyService.prototype.dispose = function () {\n    this._isDisposed = true;\n\n    this._parent.disposeContext(this._myContextId);\n\n    if (this._domNode) {\n      this._domNode.removeAttribute(KEYBINDING_CONTEXT_ATTR);\n\n      this._domNode = undefined;\n    }\n  };\n\n  Object.defineProperty(ScopedContextKeyService.prototype, \"onDidChangeContext\", {\n    get: function () {\n      return Event.any(this._parent.onDidChangeContext, this._onDidChangeContext.event);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ScopedContextKeyService.prototype.getContextValuesContainer = function (contextId) {\n    if (this._isDisposed) {\n      return NullContext.INSTANCE;\n    }\n\n    return this._parent.getContextValuesContainer(contextId);\n  };\n\n  ScopedContextKeyService.prototype.createChildContext = function (parentContextId) {\n    if (parentContextId === void 0) {\n      parentContextId = this._myContextId;\n    }\n\n    if (this._isDisposed) {\n      throw new Error(\"ScopedContextKeyService has been disposed\");\n    }\n\n    return this._parent.createChildContext(parentContextId);\n  };\n\n  ScopedContextKeyService.prototype.disposeContext = function (contextId) {\n    if (this._isDisposed) {\n      return;\n    }\n\n    this._parent.disposeContext(contextId);\n  };\n\n  return ScopedContextKeyService;\n}(AbstractContextKeyService);\n\nfunction findContextAttr(domNode) {\n  while (domNode) {\n    if (domNode.hasAttribute(KEYBINDING_CONTEXT_ATTR)) {\n      var attr = domNode.getAttribute(KEYBINDING_CONTEXT_ATTR);\n\n      if (attr) {\n        return parseInt(attr, 10);\n      }\n\n      return NaN;\n    }\n\n    domNode = domNode.parentElement;\n  }\n\n  return 0;\n}\n\nCommandsRegistry.registerCommand(SET_CONTEXT_COMMAND_ID, function (accessor, contextKey, contextValue) {\n  accessor.get(IContextKeyService).createKey(String(contextKey), contextValue);\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/platform/contextkey/browser/contextKeyService.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","Event","PauseableEmitter","DisposableStore","keys","CommandsRegistry","IConfigurationService","IContextKeyService","SET_CONTEXT_COMMAND_ID","KeybindingResolver","KEYBINDING_CONTEXT_ATTR","Context","id","parent","_id","_parent","_value","setValue","value","removeValue","getValue","ret","NullContext","_super","call","undefined","INSTANCE","ConfigAwareContextValuesContainer","_configurationService","emitter","_this","_values","Map","_listener","onDidChangeConfiguration","event","source","allKeys","clear","fire","ArrayContextKeyChangeEvent","changedKeys","_i","_a","affectedKeys","configKey","contextKey","has","delete","push","dispose","indexOf","_keyPrefix","get","substr","configValue","set","ContextKey","service","defaultValue","_service","_key","_defaultValue","reset","setContext","removeContext","getContextKeyValue","SimpleContextKeyChangeEvent","affectsSome","CompositeContextKeyChangeEvent","events","e","AbstractContextKeyService","myContextId","_onDidChangeContext","merge","input","_isDisposed","_myContextId","createKey","Error","enumerable","configurable","bufferChangeEvents","callback","pause","resume","createScoped","domNode","ScopedContextKeyService","contextMatchesRules","rules","context","getContextValuesContainer","result","myContext","getContext","findContextAttr","ContextKeyService","configurationService","_contexts","_toDispose","_lastContextId","add","contextId","createChildContext","parentContextId","disposeContext","_domNode","setAttribute","String","removeAttribute","any","onDidChangeContext","hasAttribute","attr","getAttribute","parseInt","NaN","parentElement","registerCommand","accessor","contextValue"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { Event, PauseableEmitter } from '../../../base/common/event.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { keys } from '../../../base/common/map.js';\r\nimport { CommandsRegistry } from '../../commands/common/commands.js';\r\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\r\nimport { IContextKeyService, SET_CONTEXT_COMMAND_ID } from '../common/contextkey.js';\r\nimport { KeybindingResolver } from '../../keybinding/common/keybindingResolver.js';\r\nvar KEYBINDING_CONTEXT_ATTR = 'data-keybinding-context';\r\nvar Context = /** @class */ (function () {\r\n    function Context(id, parent) {\r\n        this._id = id;\r\n        this._parent = parent;\r\n        this._value = Object.create(null);\r\n        this._value['_contextId'] = id;\r\n    }\r\n    Context.prototype.setValue = function (key, value) {\r\n        // console.log('SET ' + key + ' = ' + value + ' ON ' + this._id);\r\n        if (this._value[key] !== value) {\r\n            this._value[key] = value;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    Context.prototype.removeValue = function (key) {\r\n        // console.log('REMOVE ' + key + ' FROM ' + this._id);\r\n        if (key in this._value) {\r\n            delete this._value[key];\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    Context.prototype.getValue = function (key) {\r\n        var ret = this._value[key];\r\n        if (typeof ret === 'undefined' && this._parent) {\r\n            return this._parent.getValue(key);\r\n        }\r\n        return ret;\r\n    };\r\n    return Context;\r\n}());\r\nexport { Context };\r\nvar NullContext = /** @class */ (function (_super) {\r\n    __extends(NullContext, _super);\r\n    function NullContext() {\r\n        return _super.call(this, -1, null) || this;\r\n    }\r\n    NullContext.prototype.setValue = function (key, value) {\r\n        return false;\r\n    };\r\n    NullContext.prototype.removeValue = function (key) {\r\n        return false;\r\n    };\r\n    NullContext.prototype.getValue = function (key) {\r\n        return undefined;\r\n    };\r\n    NullContext.INSTANCE = new NullContext();\r\n    return NullContext;\r\n}(Context));\r\nvar ConfigAwareContextValuesContainer = /** @class */ (function (_super) {\r\n    __extends(ConfigAwareContextValuesContainer, _super);\r\n    function ConfigAwareContextValuesContainer(id, _configurationService, emitter) {\r\n        var _this = _super.call(this, id, null) || this;\r\n        _this._configurationService = _configurationService;\r\n        _this._values = new Map();\r\n        _this._listener = _this._configurationService.onDidChangeConfiguration(function (event) {\r\n            if (event.source === 6 /* DEFAULT */) {\r\n                // new setting, reset everything\r\n                var allKeys = keys(_this._values);\r\n                _this._values.clear();\r\n                emitter.fire(new ArrayContextKeyChangeEvent(allKeys));\r\n            }\r\n            else {\r\n                var changedKeys = [];\r\n                for (var _i = 0, _a = event.affectedKeys; _i < _a.length; _i++) {\r\n                    var configKey = _a[_i];\r\n                    var contextKey = \"config.\" + configKey;\r\n                    if (_this._values.has(contextKey)) {\r\n                        _this._values.delete(contextKey);\r\n                        changedKeys.push(contextKey);\r\n                    }\r\n                }\r\n                emitter.fire(new ArrayContextKeyChangeEvent(changedKeys));\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    ConfigAwareContextValuesContainer.prototype.dispose = function () {\r\n        this._listener.dispose();\r\n    };\r\n    ConfigAwareContextValuesContainer.prototype.getValue = function (key) {\r\n        if (key.indexOf(ConfigAwareContextValuesContainer._keyPrefix) !== 0) {\r\n            return _super.prototype.getValue.call(this, key);\r\n        }\r\n        if (this._values.has(key)) {\r\n            return this._values.get(key);\r\n        }\r\n        var configKey = key.substr(ConfigAwareContextValuesContainer._keyPrefix.length);\r\n        var configValue = this._configurationService.getValue(configKey);\r\n        var value = undefined;\r\n        switch (typeof configValue) {\r\n            case 'number':\r\n            case 'boolean':\r\n            case 'string':\r\n                value = configValue;\r\n                break;\r\n        }\r\n        this._values.set(key, value);\r\n        return value;\r\n    };\r\n    ConfigAwareContextValuesContainer.prototype.setValue = function (key, value) {\r\n        return _super.prototype.setValue.call(this, key, value);\r\n    };\r\n    ConfigAwareContextValuesContainer.prototype.removeValue = function (key) {\r\n        return _super.prototype.removeValue.call(this, key);\r\n    };\r\n    ConfigAwareContextValuesContainer._keyPrefix = 'config.';\r\n    return ConfigAwareContextValuesContainer;\r\n}(Context));\r\nvar ContextKey = /** @class */ (function () {\r\n    function ContextKey(service, key, defaultValue) {\r\n        this._service = service;\r\n        this._key = key;\r\n        this._defaultValue = defaultValue;\r\n        this.reset();\r\n    }\r\n    ContextKey.prototype.set = function (value) {\r\n        this._service.setContext(this._key, value);\r\n    };\r\n    ContextKey.prototype.reset = function () {\r\n        if (typeof this._defaultValue === 'undefined') {\r\n            this._service.removeContext(this._key);\r\n        }\r\n        else {\r\n            this._service.setContext(this._key, this._defaultValue);\r\n        }\r\n    };\r\n    ContextKey.prototype.get = function () {\r\n        return this._service.getContextKeyValue(this._key);\r\n    };\r\n    return ContextKey;\r\n}());\r\nvar SimpleContextKeyChangeEvent = /** @class */ (function () {\r\n    function SimpleContextKeyChangeEvent(key) {\r\n        this.key = key;\r\n    }\r\n    SimpleContextKeyChangeEvent.prototype.affectsSome = function (keys) {\r\n        return keys.has(this.key);\r\n    };\r\n    return SimpleContextKeyChangeEvent;\r\n}());\r\nvar ArrayContextKeyChangeEvent = /** @class */ (function () {\r\n    function ArrayContextKeyChangeEvent(keys) {\r\n        this.keys = keys;\r\n    }\r\n    ArrayContextKeyChangeEvent.prototype.affectsSome = function (keys) {\r\n        for (var _i = 0, _a = this.keys; _i < _a.length; _i++) {\r\n            var key = _a[_i];\r\n            if (keys.has(key)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    return ArrayContextKeyChangeEvent;\r\n}());\r\nvar CompositeContextKeyChangeEvent = /** @class */ (function () {\r\n    function CompositeContextKeyChangeEvent(events) {\r\n        this.events = events;\r\n    }\r\n    CompositeContextKeyChangeEvent.prototype.affectsSome = function (keys) {\r\n        for (var _i = 0, _a = this.events; _i < _a.length; _i++) {\r\n            var e = _a[_i];\r\n            if (e.affectsSome(keys)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    return CompositeContextKeyChangeEvent;\r\n}());\r\nvar AbstractContextKeyService = /** @class */ (function () {\r\n    function AbstractContextKeyService(myContextId) {\r\n        this._onDidChangeContext = new PauseableEmitter({ merge: function (input) { return new CompositeContextKeyChangeEvent(input); } });\r\n        this._isDisposed = false;\r\n        this._myContextId = myContextId;\r\n    }\r\n    AbstractContextKeyService.prototype.createKey = function (key, defaultValue) {\r\n        if (this._isDisposed) {\r\n            throw new Error(\"AbstractContextKeyService has been disposed\");\r\n        }\r\n        return new ContextKey(this, key, defaultValue);\r\n    };\r\n    Object.defineProperty(AbstractContextKeyService.prototype, \"onDidChangeContext\", {\r\n        get: function () {\r\n            return this._onDidChangeContext.event;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AbstractContextKeyService.prototype.bufferChangeEvents = function (callback) {\r\n        this._onDidChangeContext.pause();\r\n        try {\r\n            callback();\r\n        }\r\n        finally {\r\n            this._onDidChangeContext.resume();\r\n        }\r\n    };\r\n    AbstractContextKeyService.prototype.createScoped = function (domNode) {\r\n        if (this._isDisposed) {\r\n            throw new Error(\"AbstractContextKeyService has been disposed\");\r\n        }\r\n        return new ScopedContextKeyService(this, domNode);\r\n    };\r\n    AbstractContextKeyService.prototype.contextMatchesRules = function (rules) {\r\n        if (this._isDisposed) {\r\n            throw new Error(\"AbstractContextKeyService has been disposed\");\r\n        }\r\n        var context = this.getContextValuesContainer(this._myContextId);\r\n        var result = KeybindingResolver.contextMatchesRules(context, rules);\r\n        // console.group(rules.serialize() + ' -> ' + result);\r\n        // rules.keys().forEach(key => { console.log(key, ctx[key]); });\r\n        // console.groupEnd();\r\n        return result;\r\n    };\r\n    AbstractContextKeyService.prototype.getContextKeyValue = function (key) {\r\n        if (this._isDisposed) {\r\n            return undefined;\r\n        }\r\n        return this.getContextValuesContainer(this._myContextId).getValue(key);\r\n    };\r\n    AbstractContextKeyService.prototype.setContext = function (key, value) {\r\n        if (this._isDisposed) {\r\n            return;\r\n        }\r\n        var myContext = this.getContextValuesContainer(this._myContextId);\r\n        if (!myContext) {\r\n            return;\r\n        }\r\n        if (myContext.setValue(key, value)) {\r\n            this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(key));\r\n        }\r\n    };\r\n    AbstractContextKeyService.prototype.removeContext = function (key) {\r\n        if (this._isDisposed) {\r\n            return;\r\n        }\r\n        if (this.getContextValuesContainer(this._myContextId).removeValue(key)) {\r\n            this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(key));\r\n        }\r\n    };\r\n    AbstractContextKeyService.prototype.getContext = function (target) {\r\n        if (this._isDisposed) {\r\n            return NullContext.INSTANCE;\r\n        }\r\n        return this.getContextValuesContainer(findContextAttr(target));\r\n    };\r\n    return AbstractContextKeyService;\r\n}());\r\nexport { AbstractContextKeyService };\r\nvar ContextKeyService = /** @class */ (function (_super) {\r\n    __extends(ContextKeyService, _super);\r\n    function ContextKeyService(configurationService) {\r\n        var _this = _super.call(this, 0) || this;\r\n        _this._contexts = new Map();\r\n        _this._toDispose = new DisposableStore();\r\n        _this._lastContextId = 0;\r\n        var myContext = new ConfigAwareContextValuesContainer(_this._myContextId, configurationService, _this._onDidChangeContext);\r\n        _this._contexts.set(_this._myContextId, myContext);\r\n        _this._toDispose.add(myContext);\r\n        return _this;\r\n        // Uncomment this to see the contexts continuously logged\r\n        // let lastLoggedValue: string | null = null;\r\n        // setInterval(() => {\r\n        // \tlet values = Object.keys(this._contexts).map((key) => this._contexts[key]);\r\n        // \tlet logValue = values.map(v => JSON.stringify(v._value, null, '\\t')).join('\\n');\r\n        // \tif (lastLoggedValue !== logValue) {\r\n        // \t\tlastLoggedValue = logValue;\r\n        // \t\tconsole.log(lastLoggedValue);\r\n        // \t}\r\n        // }, 2000);\r\n    }\r\n    ContextKeyService.prototype.dispose = function () {\r\n        this._isDisposed = true;\r\n        this._toDispose.dispose();\r\n    };\r\n    ContextKeyService.prototype.getContextValuesContainer = function (contextId) {\r\n        if (this._isDisposed) {\r\n            return NullContext.INSTANCE;\r\n        }\r\n        return this._contexts.get(contextId) || NullContext.INSTANCE;\r\n    };\r\n    ContextKeyService.prototype.createChildContext = function (parentContextId) {\r\n        if (parentContextId === void 0) { parentContextId = this._myContextId; }\r\n        if (this._isDisposed) {\r\n            throw new Error(\"ContextKeyService has been disposed\");\r\n        }\r\n        var id = (++this._lastContextId);\r\n        this._contexts.set(id, new Context(id, this.getContextValuesContainer(parentContextId)));\r\n        return id;\r\n    };\r\n    ContextKeyService.prototype.disposeContext = function (contextId) {\r\n        if (!this._isDisposed) {\r\n            this._contexts.delete(contextId);\r\n        }\r\n    };\r\n    ContextKeyService = __decorate([\r\n        __param(0, IConfigurationService)\r\n    ], ContextKeyService);\r\n    return ContextKeyService;\r\n}(AbstractContextKeyService));\r\nexport { ContextKeyService };\r\nvar ScopedContextKeyService = /** @class */ (function (_super) {\r\n    __extends(ScopedContextKeyService, _super);\r\n    function ScopedContextKeyService(parent, domNode) {\r\n        var _this = _super.call(this, parent.createChildContext()) || this;\r\n        _this._parent = parent;\r\n        if (domNode) {\r\n            _this._domNode = domNode;\r\n            _this._domNode.setAttribute(KEYBINDING_CONTEXT_ATTR, String(_this._myContextId));\r\n        }\r\n        return _this;\r\n    }\r\n    ScopedContextKeyService.prototype.dispose = function () {\r\n        this._isDisposed = true;\r\n        this._parent.disposeContext(this._myContextId);\r\n        if (this._domNode) {\r\n            this._domNode.removeAttribute(KEYBINDING_CONTEXT_ATTR);\r\n            this._domNode = undefined;\r\n        }\r\n    };\r\n    Object.defineProperty(ScopedContextKeyService.prototype, \"onDidChangeContext\", {\r\n        get: function () {\r\n            return Event.any(this._parent.onDidChangeContext, this._onDidChangeContext.event);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ScopedContextKeyService.prototype.getContextValuesContainer = function (contextId) {\r\n        if (this._isDisposed) {\r\n            return NullContext.INSTANCE;\r\n        }\r\n        return this._parent.getContextValuesContainer(contextId);\r\n    };\r\n    ScopedContextKeyService.prototype.createChildContext = function (parentContextId) {\r\n        if (parentContextId === void 0) { parentContextId = this._myContextId; }\r\n        if (this._isDisposed) {\r\n            throw new Error(\"ScopedContextKeyService has been disposed\");\r\n        }\r\n        return this._parent.createChildContext(parentContextId);\r\n    };\r\n    ScopedContextKeyService.prototype.disposeContext = function (contextId) {\r\n        if (this._isDisposed) {\r\n            return;\r\n        }\r\n        this._parent.disposeContext(contextId);\r\n    };\r\n    return ScopedContextKeyService;\r\n}(AbstractContextKeyService));\r\nfunction findContextAttr(domNode) {\r\n    while (domNode) {\r\n        if (domNode.hasAttribute(KEYBINDING_CONTEXT_ATTR)) {\r\n            var attr = domNode.getAttribute(KEYBINDING_CONTEXT_ATTR);\r\n            if (attr) {\r\n                return parseInt(attr, 10);\r\n            }\r\n            return NaN;\r\n        }\r\n        domNode = domNode.parentElement;\r\n    }\r\n    return 0;\r\n}\r\nCommandsRegistry.registerCommand(SET_CONTEXT_COMMAND_ID, function (accessor, contextKey, contextValue) {\r\n    accessor.get(IContextKeyService).createKey(String(contextKey), contextValue);\r\n});\r\n"]},"metadata":{},"sourceType":"module"}