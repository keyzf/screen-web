{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as Assert from '../../../common/assert.js';\nimport { onUnexpectedError } from '../../../common/errors.js';\nimport { combinedDisposable, Disposable } from '../../../common/lifecycle.js';\nimport { Event, Emitter, EventMultiplexer, Relay } from '../../../common/event.js';\n\nvar LockData =\n/** @class */\nfunction () {\n  function LockData(item) {\n    this._onDispose = new Emitter();\n    this.onDispose = this._onDispose.event;\n    this._item = item;\n  }\n\n  Object.defineProperty(LockData.prototype, \"item\", {\n    get: function () {\n      return this._item;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  LockData.prototype.dispose = function () {\n    if (this._onDispose) {\n      this._onDispose.fire();\n\n      this._onDispose.dispose();\n\n      this._onDispose = undefined;\n    }\n  };\n\n  return LockData;\n}();\n\nexport { LockData };\n\nvar Lock =\n/** @class */\nfunction () {\n  function Lock() {\n    this.locks = Object.create({});\n  }\n\n  Lock.prototype.isLocked = function (item) {\n    return !!this.locks[item.id];\n  };\n\n  Lock.prototype.run = function (item, fn) {\n    var _this = this;\n\n    var lock = this.getLock(item);\n\n    if (lock) {\n      return new Promise(function (c, e) {\n        Event.once(lock.onDispose)(function () {\n          return _this.run(item, fn).then(c, e);\n        });\n      });\n    }\n\n    var result;\n    return new Promise(function (c, e) {\n      if (item.isDisposed()) {\n        return e(new Error('Item is disposed.'));\n      }\n\n      var lock = _this.locks[item.id] = new LockData(item);\n      result = fn().then(function (r) {\n        delete _this.locks[item.id];\n        lock.dispose();\n        return r;\n      }).then(c, e);\n      return result;\n    });\n  };\n\n  Lock.prototype.getLock = function (item) {\n    var key;\n\n    for (key in this.locks) {\n      var lock = this.locks[key];\n\n      if (item.intersects(lock.item)) {\n        return lock;\n      }\n    }\n\n    return null;\n  };\n\n  return Lock;\n}();\n\nexport { Lock };\n\nvar ItemRegistry =\n/** @class */\nfunction () {\n  function ItemRegistry() {\n    this._isDisposed = false;\n    this._onDidRevealItem = new EventMultiplexer();\n    this.onDidRevealItem = this._onDidRevealItem.event;\n    this._onExpandItem = new EventMultiplexer();\n    this.onExpandItem = this._onExpandItem.event;\n    this._onDidExpandItem = new EventMultiplexer();\n    this.onDidExpandItem = this._onDidExpandItem.event;\n    this._onCollapseItem = new EventMultiplexer();\n    this.onCollapseItem = this._onCollapseItem.event;\n    this._onDidCollapseItem = new EventMultiplexer();\n    this.onDidCollapseItem = this._onDidCollapseItem.event;\n    this._onDidAddTraitItem = new EventMultiplexer();\n    this.onDidAddTraitItem = this._onDidAddTraitItem.event;\n    this._onDidRemoveTraitItem = new EventMultiplexer();\n    this.onDidRemoveTraitItem = this._onDidRemoveTraitItem.event;\n    this._onDidRefreshItem = new EventMultiplexer();\n    this.onDidRefreshItem = this._onDidRefreshItem.event;\n    this._onRefreshItemChildren = new EventMultiplexer();\n    this.onRefreshItemChildren = this._onRefreshItemChildren.event;\n    this._onDidRefreshItemChildren = new EventMultiplexer();\n    this.onDidRefreshItemChildren = this._onDidRefreshItemChildren.event;\n    this._onDidDisposeItem = new EventMultiplexer();\n    this.onDidDisposeItem = this._onDidDisposeItem.event;\n    this.items = {};\n  }\n\n  ItemRegistry.prototype.register = function (item) {\n    Assert.ok(!this.isRegistered(item.id), 'item already registered: ' + item.id);\n    var disposable = combinedDisposable(this._onDidRevealItem.add(item.onDidReveal), this._onExpandItem.add(item.onExpand), this._onDidExpandItem.add(item.onDidExpand), this._onCollapseItem.add(item.onCollapse), this._onDidCollapseItem.add(item.onDidCollapse), this._onDidAddTraitItem.add(item.onDidAddTrait), this._onDidRemoveTraitItem.add(item.onDidRemoveTrait), this._onDidRefreshItem.add(item.onDidRefresh), this._onRefreshItemChildren.add(item.onRefreshChildren), this._onDidRefreshItemChildren.add(item.onDidRefreshChildren), this._onDidDisposeItem.add(item.onDidDispose));\n    this.items[item.id] = {\n      item: item,\n      disposable: disposable\n    };\n  };\n\n  ItemRegistry.prototype.deregister = function (item) {\n    Assert.ok(this.isRegistered(item.id), 'item not registered: ' + item.id);\n    this.items[item.id].disposable.dispose();\n    delete this.items[item.id];\n  };\n\n  ItemRegistry.prototype.isRegistered = function (id) {\n    return this.items.hasOwnProperty(id);\n  };\n\n  ItemRegistry.prototype.getItem = function (id) {\n    var result = this.items[id];\n    return result ? result.item : null;\n  };\n\n  ItemRegistry.prototype.dispose = function () {\n    this.items = {};\n\n    this._onDidRevealItem.dispose();\n\n    this._onExpandItem.dispose();\n\n    this._onDidExpandItem.dispose();\n\n    this._onCollapseItem.dispose();\n\n    this._onDidCollapseItem.dispose();\n\n    this._onDidAddTraitItem.dispose();\n\n    this._onDidRemoveTraitItem.dispose();\n\n    this._onDidRefreshItem.dispose();\n\n    this._onRefreshItemChildren.dispose();\n\n    this._onDidRefreshItemChildren.dispose();\n\n    this._isDisposed = true;\n  };\n\n  ItemRegistry.prototype.isDisposed = function () {\n    return this._isDisposed;\n  };\n\n  return ItemRegistry;\n}();\n\nexport { ItemRegistry };\n\nvar Item =\n/** @class */\nfunction () {\n  function Item(id, registry, context, lock, element) {\n    this._onDidCreate = new Emitter();\n    this._onDidReveal = new Emitter();\n    this.onDidReveal = this._onDidReveal.event;\n    this._onExpand = new Emitter();\n    this.onExpand = this._onExpand.event;\n    this._onDidExpand = new Emitter();\n    this.onDidExpand = this._onDidExpand.event;\n    this._onCollapse = new Emitter();\n    this.onCollapse = this._onCollapse.event;\n    this._onDidCollapse = new Emitter();\n    this.onDidCollapse = this._onDidCollapse.event;\n    this._onDidAddTrait = new Emitter();\n    this.onDidAddTrait = this._onDidAddTrait.event;\n    this._onDidRemoveTrait = new Emitter();\n    this.onDidRemoveTrait = this._onDidRemoveTrait.event;\n    this._onDidRefresh = new Emitter();\n    this.onDidRefresh = this._onDidRefresh.event;\n    this._onRefreshChildren = new Emitter();\n    this.onRefreshChildren = this._onRefreshChildren.event;\n    this._onDidRefreshChildren = new Emitter();\n    this.onDidRefreshChildren = this._onDidRefreshChildren.event;\n    this._onDidDispose = new Emitter();\n    this.onDidDispose = this._onDidDispose.event;\n    this.registry = registry;\n    this.context = context;\n    this.lock = lock;\n    this.element = element;\n    this.id = id;\n    this.registry.register(this);\n    this.doesHaveChildren = this.context.dataSource.hasChildren(this.context.tree, this.element);\n    this.needsChildrenRefresh = true;\n    this.parent = null;\n    this.previous = null;\n    this.next = null;\n    this.firstChild = null;\n    this.lastChild = null;\n    this.traits = {};\n    this.depth = 0;\n    this.expanded = !!(this.context.dataSource.shouldAutoexpand && this.context.dataSource.shouldAutoexpand(this.context.tree, element));\n\n    this._onDidCreate.fire(this);\n\n    this.visible = this._isVisible();\n    this.height = this._getHeight();\n    this._isDisposed = false;\n  }\n\n  Item.prototype.getElement = function () {\n    return this.element;\n  };\n\n  Item.prototype.hasChildren = function () {\n    return this.doesHaveChildren;\n  };\n\n  Item.prototype.getDepth = function () {\n    return this.depth;\n  };\n\n  Item.prototype.isVisible = function () {\n    return this.visible;\n  };\n\n  Item.prototype.setVisible = function (value) {\n    this.visible = value;\n  };\n\n  Item.prototype.isExpanded = function () {\n    return this.expanded;\n  };\n  /* protected */\n\n\n  Item.prototype._setExpanded = function (value) {\n    this.expanded = value;\n  };\n\n  Item.prototype.reveal = function (relativeTop) {\n    if (relativeTop === void 0) {\n      relativeTop = null;\n    }\n\n    var eventData = {\n      item: this,\n      relativeTop: relativeTop\n    };\n\n    this._onDidReveal.fire(eventData);\n  };\n\n  Item.prototype.expand = function () {\n    var _this = this;\n\n    if (this.isExpanded() || !this.doesHaveChildren || this.lock.isLocked(this)) {\n      return Promise.resolve(false);\n    }\n\n    var result = this.lock.run(this, function () {\n      if (_this.isExpanded() || !_this.doesHaveChildren) {\n        return Promise.resolve(false);\n      }\n\n      var eventData = {\n        item: _this\n      };\n      var result;\n\n      _this._onExpand.fire(eventData);\n\n      if (_this.needsChildrenRefresh) {\n        result = _this.refreshChildren(false, true, true);\n      } else {\n        result = Promise.resolve(null);\n      }\n\n      return result.then(function () {\n        _this._setExpanded(true);\n\n        _this._onDidExpand.fire(eventData);\n\n        return true;\n      });\n    });\n    return result.then(function (r) {\n      if (_this.isDisposed()) {\n        return false;\n      } // Auto expand single child folders\n\n\n      if (_this.context.options.autoExpandSingleChildren && r && _this.firstChild !== null && _this.firstChild === _this.lastChild && _this.firstChild.isVisible()) {\n        return _this.firstChild.expand().then(function () {\n          return true;\n        });\n      }\n\n      return r;\n    });\n  };\n\n  Item.prototype.collapse = function (recursive) {\n    var _this = this;\n\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    if (recursive) {\n      var collapseChildrenPromise_1 = Promise.resolve(null);\n      this.forEachChild(function (child) {\n        collapseChildrenPromise_1 = collapseChildrenPromise_1.then(function () {\n          return child.collapse(true);\n        });\n      });\n      return collapseChildrenPromise_1.then(function () {\n        return _this.collapse(false);\n      });\n    } else {\n      if (!this.isExpanded() || this.lock.isLocked(this)) {\n        return Promise.resolve(false);\n      }\n\n      return this.lock.run(this, function () {\n        var eventData = {\n          item: _this\n        };\n\n        _this._onCollapse.fire(eventData);\n\n        _this._setExpanded(false);\n\n        _this._onDidCollapse.fire(eventData);\n\n        return Promise.resolve(true);\n      });\n    }\n  };\n\n  Item.prototype.addTrait = function (trait) {\n    var eventData = {\n      item: this,\n      trait: trait\n    };\n    this.traits[trait] = true;\n\n    this._onDidAddTrait.fire(eventData);\n  };\n\n  Item.prototype.removeTrait = function (trait) {\n    var eventData = {\n      item: this,\n      trait: trait\n    };\n    delete this.traits[trait];\n\n    this._onDidRemoveTrait.fire(eventData);\n  };\n\n  Item.prototype.hasTrait = function (trait) {\n    return this.traits[trait] || false;\n  };\n\n  Item.prototype.getAllTraits = function () {\n    var result = [];\n    var trait;\n\n    for (trait in this.traits) {\n      if (this.traits.hasOwnProperty(trait) && this.traits[trait]) {\n        result.push(trait);\n      }\n    }\n\n    return result;\n  };\n\n  Item.prototype.getHeight = function () {\n    return this.height;\n  };\n\n  Item.prototype.refreshChildren = function (recursive, safe, force) {\n    var _this = this;\n\n    if (safe === void 0) {\n      safe = false;\n    }\n\n    if (force === void 0) {\n      force = false;\n    }\n\n    if (!force && !this.isExpanded()) {\n      var setNeedsChildrenRefresh_1 = function (item) {\n        item.needsChildrenRefresh = true;\n        item.forEachChild(setNeedsChildrenRefresh_1);\n      };\n\n      setNeedsChildrenRefresh_1(this);\n      return Promise.resolve(this);\n    }\n\n    this.needsChildrenRefresh = false;\n\n    var doRefresh = function () {\n      var eventData = {\n        item: _this,\n        isNested: safe\n      };\n\n      _this._onRefreshChildren.fire(eventData);\n\n      var childrenPromise;\n\n      if (_this.doesHaveChildren) {\n        childrenPromise = _this.context.dataSource.getChildren(_this.context.tree, _this.element);\n      } else {\n        childrenPromise = Promise.resolve([]);\n      }\n\n      var result = childrenPromise.then(function (elements) {\n        if (_this.isDisposed() || _this.registry.isDisposed()) {\n          return Promise.resolve(null);\n        }\n\n        if (!Array.isArray(elements)) {\n          return Promise.reject(new Error('Please return an array of children.'));\n        }\n\n        elements = !elements ? [] : elements.slice(0);\n        elements = _this.sort(elements);\n        var staleItems = {};\n\n        while (_this.firstChild !== null) {\n          staleItems[_this.firstChild.id] = _this.firstChild;\n\n          _this.removeChild(_this.firstChild);\n        }\n\n        for (var i = 0, len = elements.length; i < len; i++) {\n          var element = elements[i];\n\n          var id = _this.context.dataSource.getId(_this.context.tree, element);\n\n          var item = staleItems[id] || new Item(id, _this.registry, _this.context, _this.lock, element);\n          item.element = element;\n\n          if (recursive) {\n            item.needsChildrenRefresh = recursive;\n          }\n\n          delete staleItems[id];\n\n          _this.addChild(item);\n        }\n\n        for (var staleItemId in staleItems) {\n          if (staleItems.hasOwnProperty(staleItemId)) {\n            staleItems[staleItemId].dispose();\n          }\n        }\n\n        if (recursive) {\n          return Promise.all(_this.mapEachChild(function (child) {\n            return child.doRefresh(recursive, true);\n          }));\n        } else {\n          return Promise.all(_this.mapEachChild(function (child) {\n            if (child.isExpanded() && child.needsChildrenRefresh) {\n              return child.doRefresh(recursive, true);\n            } else {\n              child.updateVisibility();\n              return Promise.resolve(null);\n            }\n          }));\n        }\n      });\n      return result.then(undefined, onUnexpectedError).then(function () {\n        return _this._onDidRefreshChildren.fire(eventData);\n      });\n    };\n\n    return safe ? doRefresh() : this.lock.run(this, doRefresh);\n  };\n\n  Item.prototype.doRefresh = function (recursive, safe) {\n    if (safe === void 0) {\n      safe = false;\n    }\n\n    this.doesHaveChildren = this.context.dataSource.hasChildren(this.context.tree, this.element);\n    this.height = this._getHeight();\n    this.updateVisibility();\n\n    this._onDidRefresh.fire(this);\n\n    return this.refreshChildren(recursive, safe);\n  };\n\n  Item.prototype.updateVisibility = function () {\n    this.setVisible(this._isVisible());\n  };\n\n  Item.prototype.refresh = function (recursive) {\n    return this.doRefresh(recursive);\n  };\n\n  Item.prototype.getNavigator = function () {\n    return new TreeNavigator(this);\n  };\n\n  Item.prototype.intersects = function (other) {\n    return this.isAncestorOf(other) || other.isAncestorOf(this);\n  };\n\n  Item.prototype.isAncestorOf = function (startItem) {\n    var item = startItem;\n\n    while (item) {\n      if (item.id === this.id) {\n        return true;\n      }\n\n      item = item.parent;\n    }\n\n    return false;\n  };\n\n  Item.prototype.addChild = function (item, afterItem) {\n    if (afterItem === void 0) {\n      afterItem = this.lastChild;\n    }\n\n    var isEmpty = this.firstChild === null;\n    var atHead = afterItem === null;\n    var atTail = afterItem === this.lastChild;\n\n    if (isEmpty) {\n      this.firstChild = this.lastChild = item;\n      item.next = item.previous = null;\n    } else if (atHead) {\n      if (!this.firstChild) {\n        throw new Error('Invalid tree state');\n      }\n\n      this.firstChild.previous = item;\n      item.next = this.firstChild;\n      item.previous = null;\n      this.firstChild = item;\n    } else if (atTail) {\n      if (!this.lastChild) {\n        throw new Error('Invalid tree state');\n      }\n\n      this.lastChild.next = item;\n      item.next = null;\n      item.previous = this.lastChild;\n      this.lastChild = item;\n    } else {\n      item.previous = afterItem;\n\n      if (!afterItem) {\n        throw new Error('Invalid tree state');\n      }\n\n      item.next = afterItem.next;\n\n      if (!afterItem.next) {\n        throw new Error('Invalid tree state');\n      }\n\n      afterItem.next.previous = item;\n      afterItem.next = item;\n    }\n\n    item.parent = this;\n    item.depth = this.depth + 1;\n  };\n\n  Item.prototype.removeChild = function (item) {\n    var isFirstChild = this.firstChild === item;\n    var isLastChild = this.lastChild === item;\n\n    if (isFirstChild && isLastChild) {\n      this.firstChild = this.lastChild = null;\n    } else if (isFirstChild) {\n      if (!item.next) {\n        throw new Error('Invalid tree state');\n      }\n\n      item.next.previous = null;\n      this.firstChild = item.next;\n    } else if (isLastChild) {\n      if (!item.previous) {\n        throw new Error('Invalid tree state');\n      }\n\n      item.previous.next = null;\n      this.lastChild = item.previous;\n    } else {\n      if (!item.next) {\n        throw new Error('Invalid tree state');\n      }\n\n      item.next.previous = item.previous;\n\n      if (!item.previous) {\n        throw new Error('Invalid tree state');\n      }\n\n      item.previous.next = item.next;\n    }\n\n    item.parent = null;\n    item.depth = NaN;\n  };\n\n  Item.prototype.forEachChild = function (fn) {\n    var child = this.firstChild;\n    var next;\n\n    while (child) {\n      next = child.next;\n      fn(child);\n      child = next;\n    }\n  };\n\n  Item.prototype.mapEachChild = function (fn) {\n    var result = [];\n    this.forEachChild(function (child) {\n      result.push(fn(child));\n    });\n    return result;\n  };\n\n  Item.prototype.sort = function (elements) {\n    var _this = this;\n\n    var sorter = this.context.sorter;\n\n    if (sorter) {\n      return elements.sort(function (element, otherElement) {\n        return sorter.compare(_this.context.tree, element, otherElement);\n      });\n    }\n\n    return elements;\n  };\n  /* protected */\n\n\n  Item.prototype._getHeight = function () {\n    if (!this.context.renderer) {\n      return 0;\n    }\n\n    return this.context.renderer.getHeight(this.context.tree, this.element);\n  };\n  /* protected */\n\n\n  Item.prototype._isVisible = function () {\n    if (!this.context.filter) {\n      return false;\n    }\n\n    return this.context.filter.isVisible(this.context.tree, this.element);\n  };\n\n  Item.prototype.isDisposed = function () {\n    return this._isDisposed;\n  };\n\n  Item.prototype.dispose = function () {\n    this.forEachChild(function (child) {\n      return child.dispose();\n    });\n    this.parent = null;\n    this.previous = null;\n    this.next = null;\n    this.firstChild = null;\n    this.lastChild = null;\n\n    this._onDidDispose.fire(this);\n\n    this.registry.deregister(this);\n\n    this._onDidCreate.dispose();\n\n    this._onDidReveal.dispose();\n\n    this._onExpand.dispose();\n\n    this._onDidExpand.dispose();\n\n    this._onCollapse.dispose();\n\n    this._onDidCollapse.dispose();\n\n    this._onDidAddTrait.dispose();\n\n    this._onDidRemoveTrait.dispose();\n\n    this._onDidRefresh.dispose();\n\n    this._onRefreshChildren.dispose();\n\n    this._onDidRefreshChildren.dispose();\n\n    this._onDidDispose.dispose();\n\n    this._isDisposed = true;\n  };\n\n  return Item;\n}();\n\nexport { Item };\n\nvar RootItem =\n/** @class */\nfunction (_super) {\n  __extends(RootItem, _super);\n\n  function RootItem(id, registry, context, lock, element) {\n    return _super.call(this, id, registry, context, lock, element) || this;\n  }\n\n  RootItem.prototype.isVisible = function () {\n    return false;\n  };\n\n  RootItem.prototype.setVisible = function (value) {// no-op\n  };\n\n  RootItem.prototype.isExpanded = function () {\n    return true;\n  };\n  /* protected */\n\n\n  RootItem.prototype._setExpanded = function (value) {// no-op\n  };\n  /* protected */\n\n\n  RootItem.prototype._getHeight = function () {\n    return 0;\n  };\n  /* protected */\n\n\n  RootItem.prototype._isVisible = function () {\n    return false;\n  };\n\n  return RootItem;\n}(Item);\n\nvar TreeNavigator =\n/** @class */\nfunction () {\n  function TreeNavigator(item, subTreeOnly) {\n    if (subTreeOnly === void 0) {\n      subTreeOnly = true;\n    }\n\n    this.item = item;\n    this.start = subTreeOnly ? item : null;\n  }\n\n  TreeNavigator.lastDescendantOf = function (item) {\n    if (!item) {\n      return null;\n    }\n\n    if (item instanceof RootItem) {\n      return TreeNavigator.lastDescendantOf(item.lastChild);\n    }\n\n    if (!item.isVisible()) {\n      return TreeNavigator.lastDescendantOf(item.previous);\n    }\n\n    if (!item.isExpanded() || item.lastChild === null) {\n      return item;\n    }\n\n    return TreeNavigator.lastDescendantOf(item.lastChild);\n  };\n\n  TreeNavigator.prototype.current = function () {\n    return this.item || null;\n  };\n\n  TreeNavigator.prototype.next = function () {\n    if (this.item) {\n      do {\n        if ((this.item instanceof RootItem || this.item.isVisible() && this.item.isExpanded()) && this.item.firstChild) {\n          this.item = this.item.firstChild;\n        } else if (this.item === this.start) {\n          this.item = null;\n        } else {\n          // select next brother, next uncle, next great-uncle, etc...\n          while (this.item && this.item !== this.start && !this.item.next) {\n            this.item = this.item.parent;\n          }\n\n          if (this.item === this.start) {\n            this.item = null;\n          }\n\n          this.item = !this.item ? null : this.item.next;\n        }\n      } while (this.item && !this.item.isVisible());\n    }\n\n    return this.item || null;\n  };\n\n  TreeNavigator.prototype.previous = function () {\n    if (this.item) {\n      do {\n        var previous = TreeNavigator.lastDescendantOf(this.item.previous);\n\n        if (previous) {\n          this.item = previous;\n        } else if (this.item.parent && this.item.parent !== this.start && this.item.parent.isVisible()) {\n          this.item = this.item.parent;\n        } else {\n          this.item = null;\n        }\n      } while (this.item && !this.item.isVisible());\n    }\n\n    return this.item || null;\n  };\n\n  TreeNavigator.prototype.parent = function () {\n    if (this.item) {\n      var parent_1 = this.item.parent;\n\n      if (parent_1 && parent_1 !== this.start && parent_1.isVisible()) {\n        this.item = parent_1;\n      } else {\n        this.item = null;\n      }\n    }\n\n    return this.item || null;\n  };\n\n  TreeNavigator.prototype.first = function () {\n    this.item = this.start;\n    this.next();\n    return this.item || null;\n  };\n\n  TreeNavigator.prototype.last = function () {\n    return TreeNavigator.lastDescendantOf(this.start);\n  };\n\n  return TreeNavigator;\n}();\n\nexport { TreeNavigator };\n\nvar TreeModel =\n/** @class */\nfunction () {\n  function TreeModel(context) {\n    this.registry = new ItemRegistry();\n    this.registryDisposable = Disposable.None;\n    this._onSetInput = new Emitter();\n    this.onSetInput = this._onSetInput.event;\n    this._onDidSetInput = new Emitter();\n    this.onDidSetInput = this._onDidSetInput.event;\n    this._onRefresh = new Emitter();\n    this.onRefresh = this._onRefresh.event;\n    this._onDidRefresh = new Emitter();\n    this.onDidRefresh = this._onDidRefresh.event;\n    this._onDidHighlight = new Emitter();\n    this.onDidHighlight = this._onDidHighlight.event;\n    this._onDidSelect = new Emitter();\n    this.onDidSelect = this._onDidSelect.event;\n    this._onDidFocus = new Emitter();\n    this.onDidFocus = this._onDidFocus.event;\n    this._onDidRevealItem = new Relay();\n    this.onDidRevealItem = this._onDidRevealItem.event;\n    this._onExpandItem = new Relay();\n    this.onExpandItem = this._onExpandItem.event;\n    this._onDidExpandItem = new Relay();\n    this.onDidExpandItem = this._onDidExpandItem.event;\n    this._onCollapseItem = new Relay();\n    this.onCollapseItem = this._onCollapseItem.event;\n    this._onDidCollapseItem = new Relay();\n    this.onDidCollapseItem = this._onDidCollapseItem.event;\n    this._onDidAddTraitItem = new Relay();\n    this.onDidAddTraitItem = this._onDidAddTraitItem.event;\n    this._onDidRemoveTraitItem = new Relay();\n    this.onDidRemoveTraitItem = this._onDidRemoveTraitItem.event;\n    this._onDidRefreshItem = new Relay();\n    this.onDidRefreshItem = this._onDidRefreshItem.event;\n    this._onRefreshItemChildren = new Relay();\n    this.onRefreshItemChildren = this._onRefreshItemChildren.event;\n    this._onDidRefreshItemChildren = new Relay();\n    this.onDidRefreshItemChildren = this._onDidRefreshItemChildren.event;\n    this._onDidDisposeItem = new Relay();\n    this.context = context;\n    this.input = null;\n    this.traitsToItems = {};\n  }\n\n  TreeModel.prototype.setInput = function (element) {\n    var _this = this;\n\n    var eventData = {\n      item: this.input\n    };\n\n    this._onSetInput.fire(eventData);\n\n    this.setSelection([]);\n    this.setFocus();\n    this.setHighlight();\n    this.lock = new Lock();\n\n    if (this.input) {\n      this.input.dispose();\n    }\n\n    if (this.registry) {\n      this.registry.dispose();\n      this.registryDisposable.dispose();\n    }\n\n    this.registry = new ItemRegistry();\n    this._onDidRevealItem.input = this.registry.onDidRevealItem;\n    this._onExpandItem.input = this.registry.onExpandItem;\n    this._onDidExpandItem.input = this.registry.onDidExpandItem;\n    this._onCollapseItem.input = this.registry.onCollapseItem;\n    this._onDidCollapseItem.input = this.registry.onDidCollapseItem;\n    this._onDidAddTraitItem.input = this.registry.onDidAddTraitItem;\n    this._onDidRemoveTraitItem.input = this.registry.onDidRemoveTraitItem;\n    this._onDidRefreshItem.input = this.registry.onDidRefreshItem;\n    this._onRefreshItemChildren.input = this.registry.onRefreshItemChildren;\n    this._onDidRefreshItemChildren.input = this.registry.onDidRefreshItemChildren;\n    this._onDidDisposeItem.input = this.registry.onDidDisposeItem;\n    this.registryDisposable = this.registry.onDidDisposeItem(function (item) {\n      return item.getAllTraits().forEach(function (trait) {\n        return delete _this.traitsToItems[trait][item.id];\n      });\n    });\n    var id = this.context.dataSource.getId(this.context.tree, element);\n    this.input = new RootItem(id, this.registry, this.context, this.lock, element);\n    eventData = {\n      item: this.input\n    };\n\n    this._onDidSetInput.fire(eventData);\n\n    return this.refresh(this.input);\n  };\n\n  TreeModel.prototype.getInput = function () {\n    return this.input ? this.input.getElement() : null;\n  };\n\n  TreeModel.prototype.refresh = function (element, recursive) {\n    var _this = this;\n\n    if (element === void 0) {\n      element = null;\n    }\n\n    if (recursive === void 0) {\n      recursive = true;\n    }\n\n    var item = this.getItem(element);\n\n    if (!item) {\n      return Promise.resolve(null);\n    }\n\n    var eventData = {\n      item: item,\n      recursive: recursive\n    };\n\n    this._onRefresh.fire(eventData);\n\n    return item.refresh(recursive).then(function () {\n      _this._onDidRefresh.fire(eventData);\n    });\n  };\n\n  TreeModel.prototype.expand = function (element) {\n    var item = this.getItem(element);\n\n    if (!item) {\n      return Promise.resolve(false);\n    }\n\n    return item.expand();\n  };\n\n  TreeModel.prototype.collapse = function (element, recursive) {\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    var item = this.getItem(element);\n\n    if (!item) {\n      return Promise.resolve(false);\n    }\n\n    return item.collapse(recursive);\n  };\n\n  TreeModel.prototype.toggleExpansion = function (element, recursive) {\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    return this.isExpanded(element) ? this.collapse(element, recursive) : this.expand(element);\n  };\n\n  TreeModel.prototype.isExpanded = function (element) {\n    var item = this.getItem(element);\n\n    if (!item) {\n      return false;\n    }\n\n    return item.isExpanded();\n  };\n\n  TreeModel.prototype.reveal = function (element, relativeTop) {\n    var _this = this;\n\n    if (relativeTop === void 0) {\n      relativeTop = null;\n    }\n\n    return this.resolveUnknownParentChain(element).then(function (chain) {\n      var result = Promise.resolve(null);\n      chain.forEach(function (e) {\n        result = result.then(function () {\n          return _this.expand(e);\n        });\n      });\n      return result;\n    }).then(function () {\n      var item = _this.getItem(element);\n\n      if (item) {\n        return item.reveal(relativeTop);\n      }\n    });\n  };\n\n  TreeModel.prototype.resolveUnknownParentChain = function (element) {\n    var _this = this;\n\n    return this.context.dataSource.getParent(this.context.tree, element).then(function (parent) {\n      if (!parent) {\n        return Promise.resolve([]);\n      }\n\n      return _this.resolveUnknownParentChain(parent).then(function (result) {\n        result.push(parent);\n        return result;\n      });\n    });\n  };\n\n  TreeModel.prototype.setHighlight = function (element, eventPayload) {\n    this.setTraits('highlighted', element ? [element] : []);\n    var eventData = {\n      highlight: this.getHighlight(),\n      payload: eventPayload\n    };\n\n    this._onDidHighlight.fire(eventData);\n  };\n\n  TreeModel.prototype.getHighlight = function (includeHidden) {\n    if (includeHidden === void 0) {\n      includeHidden = false;\n    }\n\n    var result = this.getElementsWithTrait('highlighted', includeHidden);\n    return result.length === 0 ? null : result[0];\n  };\n\n  TreeModel.prototype.setSelection = function (elements, eventPayload) {\n    this.setTraits('selected', elements);\n    var eventData = {\n      selection: this.getSelection(),\n      payload: eventPayload\n    };\n\n    this._onDidSelect.fire(eventData);\n  };\n\n  TreeModel.prototype.getSelection = function (includeHidden) {\n    if (includeHidden === void 0) {\n      includeHidden = false;\n    }\n\n    return this.getElementsWithTrait('selected', includeHidden);\n  };\n\n  TreeModel.prototype.setFocus = function (element, eventPayload) {\n    this.setTraits('focused', element ? [element] : []);\n    var eventData = {\n      focus: this.getFocus(),\n      payload: eventPayload\n    };\n\n    this._onDidFocus.fire(eventData);\n  };\n\n  TreeModel.prototype.getFocus = function (includeHidden) {\n    if (includeHidden === void 0) {\n      includeHidden = false;\n    }\n\n    var result = this.getElementsWithTrait('focused', includeHidden);\n    return result.length === 0 ? null : result[0];\n  };\n\n  TreeModel.prototype.focusNext = function (count, eventPayload) {\n    if (count === void 0) {\n      count = 1;\n    }\n\n    var item = this.getFocus() || this.input;\n    var nextItem;\n    var nav = this.getNavigator(item, false);\n\n    for (var i = 0; i < count; i++) {\n      nextItem = nav.next();\n\n      if (!nextItem) {\n        break;\n      }\n\n      item = nextItem;\n    }\n\n    this.setFocus(item, eventPayload);\n  };\n\n  TreeModel.prototype.focusPrevious = function (count, eventPayload) {\n    if (count === void 0) {\n      count = 1;\n    }\n\n    var item = this.getFocus() || this.input;\n    var previousItem;\n    var nav = this.getNavigator(item, false);\n\n    for (var i = 0; i < count; i++) {\n      previousItem = nav.previous();\n\n      if (!previousItem) {\n        break;\n      }\n\n      item = previousItem;\n    }\n\n    this.setFocus(item, eventPayload);\n  };\n\n  TreeModel.prototype.focusParent = function (eventPayload) {\n    var item = this.getFocus() || this.input;\n    var nav = this.getNavigator(item, false);\n    var parent = nav.parent();\n\n    if (parent) {\n      this.setFocus(parent, eventPayload);\n    }\n  };\n\n  TreeModel.prototype.focusFirstChild = function (eventPayload) {\n    var item = this.getItem(this.getFocus() || this.input);\n    var nav = this.getNavigator(item, false);\n    var next = nav.next();\n    var parent = nav.parent();\n\n    if (parent === item) {\n      this.setFocus(next, eventPayload);\n    }\n  };\n\n  TreeModel.prototype.focusFirst = function (eventPayload, from) {\n    this.focusNth(0, eventPayload, from);\n  };\n\n  TreeModel.prototype.focusNth = function (index, eventPayload, from) {\n    var navItem = this.getParent(from);\n    var nav = this.getNavigator(navItem);\n    var item = nav.first();\n\n    for (var i = 0; i < index; i++) {\n      item = nav.next();\n    }\n\n    if (item) {\n      this.setFocus(item, eventPayload);\n    }\n  };\n\n  TreeModel.prototype.focusLast = function (eventPayload, from) {\n    var navItem = this.getParent(from);\n    var item;\n\n    if (from && navItem) {\n      item = navItem.lastChild;\n    } else {\n      var nav = this.getNavigator(navItem);\n      item = nav.last();\n    }\n\n    if (item) {\n      this.setFocus(item, eventPayload);\n    }\n  };\n\n  TreeModel.prototype.getParent = function (from) {\n    if (from) {\n      var fromItem = this.getItem(from);\n\n      if (fromItem && fromItem.parent) {\n        return fromItem.parent;\n      }\n    }\n\n    return this.getItem(this.input);\n  };\n\n  TreeModel.prototype.getNavigator = function (element, subTreeOnly) {\n    if (element === void 0) {\n      element = null;\n    }\n\n    if (subTreeOnly === void 0) {\n      subTreeOnly = true;\n    }\n\n    return new TreeNavigator(this.getItem(element), subTreeOnly);\n  };\n\n  TreeModel.prototype.getItem = function (element) {\n    if (element === void 0) {\n      element = null;\n    }\n\n    if (element === null) {\n      return this.input;\n    } else if (element instanceof Item) {\n      return element;\n    } else if (typeof element === 'string') {\n      return this.registry.getItem(element);\n    } else {\n      return this.registry.getItem(this.context.dataSource.getId(this.context.tree, element));\n    }\n  };\n\n  TreeModel.prototype.removeTraits = function (trait, elements) {\n    var items = this.traitsToItems[trait] || {};\n    var item;\n    var id;\n\n    if (elements.length === 0) {\n      for (id in items) {\n        if (items.hasOwnProperty(id)) {\n          item = items[id];\n          item.removeTrait(trait);\n        }\n      }\n\n      delete this.traitsToItems[trait];\n    } else {\n      for (var i = 0, len = elements.length; i < len; i++) {\n        item = this.getItem(elements[i]);\n\n        if (item) {\n          item.removeTrait(trait);\n          delete items[item.id];\n        }\n      }\n    }\n  };\n\n  TreeModel.prototype.setTraits = function (trait, elements) {\n    if (elements.length === 0) {\n      this.removeTraits(trait, elements);\n    } else {\n      var items = {};\n      var item = void 0;\n\n      for (var i = 0, len = elements.length; i < len; i++) {\n        item = this.getItem(elements[i]);\n\n        if (item) {\n          items[item.id] = item;\n        }\n      }\n\n      var traitItems = this.traitsToItems[trait] || {};\n      var itemsToRemoveTrait = [];\n      var id = void 0;\n\n      for (id in traitItems) {\n        if (traitItems.hasOwnProperty(id)) {\n          if (items.hasOwnProperty(id)) {\n            delete items[id];\n          } else {\n            itemsToRemoveTrait.push(traitItems[id]);\n          }\n        }\n      }\n\n      for (var i = 0, len = itemsToRemoveTrait.length; i < len; i++) {\n        item = itemsToRemoveTrait[i];\n        item.removeTrait(trait);\n        delete traitItems[item.id];\n      }\n\n      for (id in items) {\n        if (items.hasOwnProperty(id)) {\n          item = items[id];\n          item.addTrait(trait);\n          traitItems[id] = item;\n        }\n      }\n\n      this.traitsToItems[trait] = traitItems;\n    }\n  };\n\n  TreeModel.prototype.getElementsWithTrait = function (trait, includeHidden) {\n    var elements = [];\n    var items = this.traitsToItems[trait] || {};\n    var id;\n\n    for (id in items) {\n      if (items.hasOwnProperty(id) && (items[id].isVisible() || includeHidden)) {\n        elements.push(items[id].getElement());\n      }\n    }\n\n    return elements;\n  };\n\n  TreeModel.prototype.dispose = function () {\n    this.registry.dispose();\n\n    this._onSetInput.dispose();\n\n    this._onDidSetInput.dispose();\n\n    this._onRefresh.dispose();\n\n    this._onDidRefresh.dispose();\n\n    this._onDidHighlight.dispose();\n\n    this._onDidSelect.dispose();\n\n    this._onDidFocus.dispose();\n\n    this._onDidRevealItem.dispose();\n\n    this._onExpandItem.dispose();\n\n    this._onDidExpandItem.dispose();\n\n    this._onCollapseItem.dispose();\n\n    this._onDidCollapseItem.dispose();\n\n    this._onDidAddTraitItem.dispose();\n\n    this._onDidRemoveTraitItem.dispose();\n\n    this._onDidRefreshItem.dispose();\n\n    this._onRefreshItemChildren.dispose();\n\n    this._onDidRefreshItemChildren.dispose();\n\n    this._onDidDisposeItem.dispose();\n  };\n\n  return TreeModel;\n}();\n\nexport { TreeModel };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/parts/tree/browser/treeModel.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Assert","onUnexpectedError","combinedDisposable","Disposable","Event","Emitter","EventMultiplexer","Relay","LockData","item","_onDispose","onDispose","event","_item","defineProperty","get","enumerable","configurable","dispose","fire","undefined","Lock","locks","isLocked","id","run","fn","_this","lock","getLock","Promise","c","e","once","then","result","isDisposed","Error","r","key","intersects","ItemRegistry","_isDisposed","_onDidRevealItem","onDidRevealItem","_onExpandItem","onExpandItem","_onDidExpandItem","onDidExpandItem","_onCollapseItem","onCollapseItem","_onDidCollapseItem","onDidCollapseItem","_onDidAddTraitItem","onDidAddTraitItem","_onDidRemoveTraitItem","onDidRemoveTraitItem","_onDidRefreshItem","onDidRefreshItem","_onRefreshItemChildren","onRefreshItemChildren","_onDidRefreshItemChildren","onDidRefreshItemChildren","_onDidDisposeItem","onDidDisposeItem","items","register","ok","isRegistered","disposable","add","onDidReveal","onExpand","onDidExpand","onCollapse","onDidCollapse","onDidAddTrait","onDidRemoveTrait","onDidRefresh","onRefreshChildren","onDidRefreshChildren","onDidDispose","deregister","getItem","Item","registry","context","element","_onDidCreate","_onDidReveal","_onExpand","_onDidExpand","_onCollapse","_onDidCollapse","_onDidAddTrait","_onDidRemoveTrait","_onDidRefresh","_onRefreshChildren","_onDidRefreshChildren","_onDidDispose","doesHaveChildren","dataSource","hasChildren","tree","needsChildrenRefresh","parent","previous","next","firstChild","lastChild","traits","depth","expanded","shouldAutoexpand","visible","_isVisible","height","_getHeight","getElement","getDepth","isVisible","setVisible","value","isExpanded","_setExpanded","reveal","relativeTop","eventData","expand","resolve","refreshChildren","options","autoExpandSingleChildren","collapse","recursive","collapseChildrenPromise_1","forEachChild","child","addTrait","trait","removeTrait","hasTrait","getAllTraits","push","getHeight","safe","force","setNeedsChildrenRefresh_1","doRefresh","isNested","childrenPromise","getChildren","elements","isArray","reject","slice","sort","staleItems","removeChild","i","len","length","getId","addChild","staleItemId","all","mapEachChild","updateVisibility","refresh","getNavigator","TreeNavigator","other","isAncestorOf","startItem","afterItem","isEmpty","atHead","atTail","isFirstChild","isLastChild","NaN","sorter","otherElement","compare","renderer","filter","RootItem","_super","call","subTreeOnly","start","lastDescendantOf","current","parent_1","first","last","TreeModel","registryDisposable","None","_onSetInput","onSetInput","_onDidSetInput","onDidSetInput","_onRefresh","onRefresh","_onDidHighlight","onDidHighlight","_onDidSelect","onDidSelect","_onDidFocus","onDidFocus","input","traitsToItems","setInput","setSelection","setFocus","setHighlight","forEach","getInput","toggleExpansion","resolveUnknownParentChain","chain","getParent","eventPayload","setTraits","highlight","getHighlight","payload","includeHidden","getElementsWithTrait","selection","getSelection","focus","getFocus","focusNext","count","nextItem","nav","focusPrevious","previousItem","focusParent","focusFirstChild","focusFirst","from","focusNth","index","navItem","focusLast","fromItem","removeTraits","traitItems","itemsToRemoveTrait"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as Assert from '../../../common/assert.js';\r\nimport { onUnexpectedError } from '../../../common/errors.js';\r\nimport { combinedDisposable, Disposable } from '../../../common/lifecycle.js';\r\nimport { Event, Emitter, EventMultiplexer, Relay } from '../../../common/event.js';\r\nvar LockData = /** @class */ (function () {\r\n    function LockData(item) {\r\n        this._onDispose = new Emitter();\r\n        this.onDispose = this._onDispose.event;\r\n        this._item = item;\r\n    }\r\n    Object.defineProperty(LockData.prototype, \"item\", {\r\n        get: function () {\r\n            return this._item;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LockData.prototype.dispose = function () {\r\n        if (this._onDispose) {\r\n            this._onDispose.fire();\r\n            this._onDispose.dispose();\r\n            this._onDispose = undefined;\r\n        }\r\n    };\r\n    return LockData;\r\n}());\r\nexport { LockData };\r\nvar Lock = /** @class */ (function () {\r\n    function Lock() {\r\n        this.locks = Object.create({});\r\n    }\r\n    Lock.prototype.isLocked = function (item) {\r\n        return !!this.locks[item.id];\r\n    };\r\n    Lock.prototype.run = function (item, fn) {\r\n        var _this = this;\r\n        var lock = this.getLock(item);\r\n        if (lock) {\r\n            return new Promise(function (c, e) {\r\n                Event.once(lock.onDispose)(function () {\r\n                    return _this.run(item, fn).then(c, e);\r\n                });\r\n            });\r\n        }\r\n        var result;\r\n        return new Promise(function (c, e) {\r\n            if (item.isDisposed()) {\r\n                return e(new Error('Item is disposed.'));\r\n            }\r\n            var lock = _this.locks[item.id] = new LockData(item);\r\n            result = fn().then(function (r) {\r\n                delete _this.locks[item.id];\r\n                lock.dispose();\r\n                return r;\r\n            }).then(c, e);\r\n            return result;\r\n        });\r\n    };\r\n    Lock.prototype.getLock = function (item) {\r\n        var key;\r\n        for (key in this.locks) {\r\n            var lock = this.locks[key];\r\n            if (item.intersects(lock.item)) {\r\n                return lock;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    return Lock;\r\n}());\r\nexport { Lock };\r\nvar ItemRegistry = /** @class */ (function () {\r\n    function ItemRegistry() {\r\n        this._isDisposed = false;\r\n        this._onDidRevealItem = new EventMultiplexer();\r\n        this.onDidRevealItem = this._onDidRevealItem.event;\r\n        this._onExpandItem = new EventMultiplexer();\r\n        this.onExpandItem = this._onExpandItem.event;\r\n        this._onDidExpandItem = new EventMultiplexer();\r\n        this.onDidExpandItem = this._onDidExpandItem.event;\r\n        this._onCollapseItem = new EventMultiplexer();\r\n        this.onCollapseItem = this._onCollapseItem.event;\r\n        this._onDidCollapseItem = new EventMultiplexer();\r\n        this.onDidCollapseItem = this._onDidCollapseItem.event;\r\n        this._onDidAddTraitItem = new EventMultiplexer();\r\n        this.onDidAddTraitItem = this._onDidAddTraitItem.event;\r\n        this._onDidRemoveTraitItem = new EventMultiplexer();\r\n        this.onDidRemoveTraitItem = this._onDidRemoveTraitItem.event;\r\n        this._onDidRefreshItem = new EventMultiplexer();\r\n        this.onDidRefreshItem = this._onDidRefreshItem.event;\r\n        this._onRefreshItemChildren = new EventMultiplexer();\r\n        this.onRefreshItemChildren = this._onRefreshItemChildren.event;\r\n        this._onDidRefreshItemChildren = new EventMultiplexer();\r\n        this.onDidRefreshItemChildren = this._onDidRefreshItemChildren.event;\r\n        this._onDidDisposeItem = new EventMultiplexer();\r\n        this.onDidDisposeItem = this._onDidDisposeItem.event;\r\n        this.items = {};\r\n    }\r\n    ItemRegistry.prototype.register = function (item) {\r\n        Assert.ok(!this.isRegistered(item.id), 'item already registered: ' + item.id);\r\n        var disposable = combinedDisposable(this._onDidRevealItem.add(item.onDidReveal), this._onExpandItem.add(item.onExpand), this._onDidExpandItem.add(item.onDidExpand), this._onCollapseItem.add(item.onCollapse), this._onDidCollapseItem.add(item.onDidCollapse), this._onDidAddTraitItem.add(item.onDidAddTrait), this._onDidRemoveTraitItem.add(item.onDidRemoveTrait), this._onDidRefreshItem.add(item.onDidRefresh), this._onRefreshItemChildren.add(item.onRefreshChildren), this._onDidRefreshItemChildren.add(item.onDidRefreshChildren), this._onDidDisposeItem.add(item.onDidDispose));\r\n        this.items[item.id] = { item: item, disposable: disposable };\r\n    };\r\n    ItemRegistry.prototype.deregister = function (item) {\r\n        Assert.ok(this.isRegistered(item.id), 'item not registered: ' + item.id);\r\n        this.items[item.id].disposable.dispose();\r\n        delete this.items[item.id];\r\n    };\r\n    ItemRegistry.prototype.isRegistered = function (id) {\r\n        return this.items.hasOwnProperty(id);\r\n    };\r\n    ItemRegistry.prototype.getItem = function (id) {\r\n        var result = this.items[id];\r\n        return result ? result.item : null;\r\n    };\r\n    ItemRegistry.prototype.dispose = function () {\r\n        this.items = {};\r\n        this._onDidRevealItem.dispose();\r\n        this._onExpandItem.dispose();\r\n        this._onDidExpandItem.dispose();\r\n        this._onCollapseItem.dispose();\r\n        this._onDidCollapseItem.dispose();\r\n        this._onDidAddTraitItem.dispose();\r\n        this._onDidRemoveTraitItem.dispose();\r\n        this._onDidRefreshItem.dispose();\r\n        this._onRefreshItemChildren.dispose();\r\n        this._onDidRefreshItemChildren.dispose();\r\n        this._isDisposed = true;\r\n    };\r\n    ItemRegistry.prototype.isDisposed = function () {\r\n        return this._isDisposed;\r\n    };\r\n    return ItemRegistry;\r\n}());\r\nexport { ItemRegistry };\r\nvar Item = /** @class */ (function () {\r\n    function Item(id, registry, context, lock, element) {\r\n        this._onDidCreate = new Emitter();\r\n        this._onDidReveal = new Emitter();\r\n        this.onDidReveal = this._onDidReveal.event;\r\n        this._onExpand = new Emitter();\r\n        this.onExpand = this._onExpand.event;\r\n        this._onDidExpand = new Emitter();\r\n        this.onDidExpand = this._onDidExpand.event;\r\n        this._onCollapse = new Emitter();\r\n        this.onCollapse = this._onCollapse.event;\r\n        this._onDidCollapse = new Emitter();\r\n        this.onDidCollapse = this._onDidCollapse.event;\r\n        this._onDidAddTrait = new Emitter();\r\n        this.onDidAddTrait = this._onDidAddTrait.event;\r\n        this._onDidRemoveTrait = new Emitter();\r\n        this.onDidRemoveTrait = this._onDidRemoveTrait.event;\r\n        this._onDidRefresh = new Emitter();\r\n        this.onDidRefresh = this._onDidRefresh.event;\r\n        this._onRefreshChildren = new Emitter();\r\n        this.onRefreshChildren = this._onRefreshChildren.event;\r\n        this._onDidRefreshChildren = new Emitter();\r\n        this.onDidRefreshChildren = this._onDidRefreshChildren.event;\r\n        this._onDidDispose = new Emitter();\r\n        this.onDidDispose = this._onDidDispose.event;\r\n        this.registry = registry;\r\n        this.context = context;\r\n        this.lock = lock;\r\n        this.element = element;\r\n        this.id = id;\r\n        this.registry.register(this);\r\n        this.doesHaveChildren = this.context.dataSource.hasChildren(this.context.tree, this.element);\r\n        this.needsChildrenRefresh = true;\r\n        this.parent = null;\r\n        this.previous = null;\r\n        this.next = null;\r\n        this.firstChild = null;\r\n        this.lastChild = null;\r\n        this.traits = {};\r\n        this.depth = 0;\r\n        this.expanded = !!(this.context.dataSource.shouldAutoexpand && this.context.dataSource.shouldAutoexpand(this.context.tree, element));\r\n        this._onDidCreate.fire(this);\r\n        this.visible = this._isVisible();\r\n        this.height = this._getHeight();\r\n        this._isDisposed = false;\r\n    }\r\n    Item.prototype.getElement = function () {\r\n        return this.element;\r\n    };\r\n    Item.prototype.hasChildren = function () {\r\n        return this.doesHaveChildren;\r\n    };\r\n    Item.prototype.getDepth = function () {\r\n        return this.depth;\r\n    };\r\n    Item.prototype.isVisible = function () {\r\n        return this.visible;\r\n    };\r\n    Item.prototype.setVisible = function (value) {\r\n        this.visible = value;\r\n    };\r\n    Item.prototype.isExpanded = function () {\r\n        return this.expanded;\r\n    };\r\n    /* protected */ Item.prototype._setExpanded = function (value) {\r\n        this.expanded = value;\r\n    };\r\n    Item.prototype.reveal = function (relativeTop) {\r\n        if (relativeTop === void 0) { relativeTop = null; }\r\n        var eventData = { item: this, relativeTop: relativeTop };\r\n        this._onDidReveal.fire(eventData);\r\n    };\r\n    Item.prototype.expand = function () {\r\n        var _this = this;\r\n        if (this.isExpanded() || !this.doesHaveChildren || this.lock.isLocked(this)) {\r\n            return Promise.resolve(false);\r\n        }\r\n        var result = this.lock.run(this, function () {\r\n            if (_this.isExpanded() || !_this.doesHaveChildren) {\r\n                return Promise.resolve(false);\r\n            }\r\n            var eventData = { item: _this };\r\n            var result;\r\n            _this._onExpand.fire(eventData);\r\n            if (_this.needsChildrenRefresh) {\r\n                result = _this.refreshChildren(false, true, true);\r\n            }\r\n            else {\r\n                result = Promise.resolve(null);\r\n            }\r\n            return result.then(function () {\r\n                _this._setExpanded(true);\r\n                _this._onDidExpand.fire(eventData);\r\n                return true;\r\n            });\r\n        });\r\n        return result.then(function (r) {\r\n            if (_this.isDisposed()) {\r\n                return false;\r\n            }\r\n            // Auto expand single child folders\r\n            if (_this.context.options.autoExpandSingleChildren && r && _this.firstChild !== null && _this.firstChild === _this.lastChild && _this.firstChild.isVisible()) {\r\n                return _this.firstChild.expand().then(function () { return true; });\r\n            }\r\n            return r;\r\n        });\r\n    };\r\n    Item.prototype.collapse = function (recursive) {\r\n        var _this = this;\r\n        if (recursive === void 0) { recursive = false; }\r\n        if (recursive) {\r\n            var collapseChildrenPromise_1 = Promise.resolve(null);\r\n            this.forEachChild(function (child) {\r\n                collapseChildrenPromise_1 = collapseChildrenPromise_1.then(function () { return child.collapse(true); });\r\n            });\r\n            return collapseChildrenPromise_1.then(function () {\r\n                return _this.collapse(false);\r\n            });\r\n        }\r\n        else {\r\n            if (!this.isExpanded() || this.lock.isLocked(this)) {\r\n                return Promise.resolve(false);\r\n            }\r\n            return this.lock.run(this, function () {\r\n                var eventData = { item: _this };\r\n                _this._onCollapse.fire(eventData);\r\n                _this._setExpanded(false);\r\n                _this._onDidCollapse.fire(eventData);\r\n                return Promise.resolve(true);\r\n            });\r\n        }\r\n    };\r\n    Item.prototype.addTrait = function (trait) {\r\n        var eventData = { item: this, trait: trait };\r\n        this.traits[trait] = true;\r\n        this._onDidAddTrait.fire(eventData);\r\n    };\r\n    Item.prototype.removeTrait = function (trait) {\r\n        var eventData = { item: this, trait: trait };\r\n        delete this.traits[trait];\r\n        this._onDidRemoveTrait.fire(eventData);\r\n    };\r\n    Item.prototype.hasTrait = function (trait) {\r\n        return this.traits[trait] || false;\r\n    };\r\n    Item.prototype.getAllTraits = function () {\r\n        var result = [];\r\n        var trait;\r\n        for (trait in this.traits) {\r\n            if (this.traits.hasOwnProperty(trait) && this.traits[trait]) {\r\n                result.push(trait);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    Item.prototype.getHeight = function () {\r\n        return this.height;\r\n    };\r\n    Item.prototype.refreshChildren = function (recursive, safe, force) {\r\n        var _this = this;\r\n        if (safe === void 0) { safe = false; }\r\n        if (force === void 0) { force = false; }\r\n        if (!force && !this.isExpanded()) {\r\n            var setNeedsChildrenRefresh_1 = function (item) {\r\n                item.needsChildrenRefresh = true;\r\n                item.forEachChild(setNeedsChildrenRefresh_1);\r\n            };\r\n            setNeedsChildrenRefresh_1(this);\r\n            return Promise.resolve(this);\r\n        }\r\n        this.needsChildrenRefresh = false;\r\n        var doRefresh = function () {\r\n            var eventData = { item: _this, isNested: safe };\r\n            _this._onRefreshChildren.fire(eventData);\r\n            var childrenPromise;\r\n            if (_this.doesHaveChildren) {\r\n                childrenPromise = _this.context.dataSource.getChildren(_this.context.tree, _this.element);\r\n            }\r\n            else {\r\n                childrenPromise = Promise.resolve([]);\r\n            }\r\n            var result = childrenPromise.then(function (elements) {\r\n                if (_this.isDisposed() || _this.registry.isDisposed()) {\r\n                    return Promise.resolve(null);\r\n                }\r\n                if (!Array.isArray(elements)) {\r\n                    return Promise.reject(new Error('Please return an array of children.'));\r\n                }\r\n                elements = !elements ? [] : elements.slice(0);\r\n                elements = _this.sort(elements);\r\n                var staleItems = {};\r\n                while (_this.firstChild !== null) {\r\n                    staleItems[_this.firstChild.id] = _this.firstChild;\r\n                    _this.removeChild(_this.firstChild);\r\n                }\r\n                for (var i = 0, len = elements.length; i < len; i++) {\r\n                    var element = elements[i];\r\n                    var id = _this.context.dataSource.getId(_this.context.tree, element);\r\n                    var item = staleItems[id] || new Item(id, _this.registry, _this.context, _this.lock, element);\r\n                    item.element = element;\r\n                    if (recursive) {\r\n                        item.needsChildrenRefresh = recursive;\r\n                    }\r\n                    delete staleItems[id];\r\n                    _this.addChild(item);\r\n                }\r\n                for (var staleItemId in staleItems) {\r\n                    if (staleItems.hasOwnProperty(staleItemId)) {\r\n                        staleItems[staleItemId].dispose();\r\n                    }\r\n                }\r\n                if (recursive) {\r\n                    return Promise.all(_this.mapEachChild(function (child) {\r\n                        return child.doRefresh(recursive, true);\r\n                    }));\r\n                }\r\n                else {\r\n                    return Promise.all(_this.mapEachChild(function (child) {\r\n                        if (child.isExpanded() && child.needsChildrenRefresh) {\r\n                            return child.doRefresh(recursive, true);\r\n                        }\r\n                        else {\r\n                            child.updateVisibility();\r\n                            return Promise.resolve(null);\r\n                        }\r\n                    }));\r\n                }\r\n            });\r\n            return result\r\n                .then(undefined, onUnexpectedError)\r\n                .then(function () { return _this._onDidRefreshChildren.fire(eventData); });\r\n        };\r\n        return safe ? doRefresh() : this.lock.run(this, doRefresh);\r\n    };\r\n    Item.prototype.doRefresh = function (recursive, safe) {\r\n        if (safe === void 0) { safe = false; }\r\n        this.doesHaveChildren = this.context.dataSource.hasChildren(this.context.tree, this.element);\r\n        this.height = this._getHeight();\r\n        this.updateVisibility();\r\n        this._onDidRefresh.fire(this);\r\n        return this.refreshChildren(recursive, safe);\r\n    };\r\n    Item.prototype.updateVisibility = function () {\r\n        this.setVisible(this._isVisible());\r\n    };\r\n    Item.prototype.refresh = function (recursive) {\r\n        return this.doRefresh(recursive);\r\n    };\r\n    Item.prototype.getNavigator = function () {\r\n        return new TreeNavigator(this);\r\n    };\r\n    Item.prototype.intersects = function (other) {\r\n        return this.isAncestorOf(other) || other.isAncestorOf(this);\r\n    };\r\n    Item.prototype.isAncestorOf = function (startItem) {\r\n        var item = startItem;\r\n        while (item) {\r\n            if (item.id === this.id) {\r\n                return true;\r\n            }\r\n            item = item.parent;\r\n        }\r\n        return false;\r\n    };\r\n    Item.prototype.addChild = function (item, afterItem) {\r\n        if (afterItem === void 0) { afterItem = this.lastChild; }\r\n        var isEmpty = this.firstChild === null;\r\n        var atHead = afterItem === null;\r\n        var atTail = afterItem === this.lastChild;\r\n        if (isEmpty) {\r\n            this.firstChild = this.lastChild = item;\r\n            item.next = item.previous = null;\r\n        }\r\n        else if (atHead) {\r\n            if (!this.firstChild) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            this.firstChild.previous = item;\r\n            item.next = this.firstChild;\r\n            item.previous = null;\r\n            this.firstChild = item;\r\n        }\r\n        else if (atTail) {\r\n            if (!this.lastChild) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            this.lastChild.next = item;\r\n            item.next = null;\r\n            item.previous = this.lastChild;\r\n            this.lastChild = item;\r\n        }\r\n        else {\r\n            item.previous = afterItem;\r\n            if (!afterItem) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            item.next = afterItem.next;\r\n            if (!afterItem.next) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            afterItem.next.previous = item;\r\n            afterItem.next = item;\r\n        }\r\n        item.parent = this;\r\n        item.depth = this.depth + 1;\r\n    };\r\n    Item.prototype.removeChild = function (item) {\r\n        var isFirstChild = this.firstChild === item;\r\n        var isLastChild = this.lastChild === item;\r\n        if (isFirstChild && isLastChild) {\r\n            this.firstChild = this.lastChild = null;\r\n        }\r\n        else if (isFirstChild) {\r\n            if (!item.next) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            item.next.previous = null;\r\n            this.firstChild = item.next;\r\n        }\r\n        else if (isLastChild) {\r\n            if (!item.previous) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            item.previous.next = null;\r\n            this.lastChild = item.previous;\r\n        }\r\n        else {\r\n            if (!item.next) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            item.next.previous = item.previous;\r\n            if (!item.previous) {\r\n                throw new Error('Invalid tree state');\r\n            }\r\n            item.previous.next = item.next;\r\n        }\r\n        item.parent = null;\r\n        item.depth = NaN;\r\n    };\r\n    Item.prototype.forEachChild = function (fn) {\r\n        var child = this.firstChild;\r\n        var next;\r\n        while (child) {\r\n            next = child.next;\r\n            fn(child);\r\n            child = next;\r\n        }\r\n    };\r\n    Item.prototype.mapEachChild = function (fn) {\r\n        var result = [];\r\n        this.forEachChild(function (child) {\r\n            result.push(fn(child));\r\n        });\r\n        return result;\r\n    };\r\n    Item.prototype.sort = function (elements) {\r\n        var _this = this;\r\n        var sorter = this.context.sorter;\r\n        if (sorter) {\r\n            return elements.sort(function (element, otherElement) {\r\n                return sorter.compare(_this.context.tree, element, otherElement);\r\n            });\r\n        }\r\n        return elements;\r\n    };\r\n    /* protected */ Item.prototype._getHeight = function () {\r\n        if (!this.context.renderer) {\r\n            return 0;\r\n        }\r\n        return this.context.renderer.getHeight(this.context.tree, this.element);\r\n    };\r\n    /* protected */ Item.prototype._isVisible = function () {\r\n        if (!this.context.filter) {\r\n            return false;\r\n        }\r\n        return this.context.filter.isVisible(this.context.tree, this.element);\r\n    };\r\n    Item.prototype.isDisposed = function () {\r\n        return this._isDisposed;\r\n    };\r\n    Item.prototype.dispose = function () {\r\n        this.forEachChild(function (child) { return child.dispose(); });\r\n        this.parent = null;\r\n        this.previous = null;\r\n        this.next = null;\r\n        this.firstChild = null;\r\n        this.lastChild = null;\r\n        this._onDidDispose.fire(this);\r\n        this.registry.deregister(this);\r\n        this._onDidCreate.dispose();\r\n        this._onDidReveal.dispose();\r\n        this._onExpand.dispose();\r\n        this._onDidExpand.dispose();\r\n        this._onCollapse.dispose();\r\n        this._onDidCollapse.dispose();\r\n        this._onDidAddTrait.dispose();\r\n        this._onDidRemoveTrait.dispose();\r\n        this._onDidRefresh.dispose();\r\n        this._onRefreshChildren.dispose();\r\n        this._onDidRefreshChildren.dispose();\r\n        this._onDidDispose.dispose();\r\n        this._isDisposed = true;\r\n    };\r\n    return Item;\r\n}());\r\nexport { Item };\r\nvar RootItem = /** @class */ (function (_super) {\r\n    __extends(RootItem, _super);\r\n    function RootItem(id, registry, context, lock, element) {\r\n        return _super.call(this, id, registry, context, lock, element) || this;\r\n    }\r\n    RootItem.prototype.isVisible = function () {\r\n        return false;\r\n    };\r\n    RootItem.prototype.setVisible = function (value) {\r\n        // no-op\r\n    };\r\n    RootItem.prototype.isExpanded = function () {\r\n        return true;\r\n    };\r\n    /* protected */ RootItem.prototype._setExpanded = function (value) {\r\n        // no-op\r\n    };\r\n    /* protected */ RootItem.prototype._getHeight = function () {\r\n        return 0;\r\n    };\r\n    /* protected */ RootItem.prototype._isVisible = function () {\r\n        return false;\r\n    };\r\n    return RootItem;\r\n}(Item));\r\nvar TreeNavigator = /** @class */ (function () {\r\n    function TreeNavigator(item, subTreeOnly) {\r\n        if (subTreeOnly === void 0) { subTreeOnly = true; }\r\n        this.item = item;\r\n        this.start = subTreeOnly ? item : null;\r\n    }\r\n    TreeNavigator.lastDescendantOf = function (item) {\r\n        if (!item) {\r\n            return null;\r\n        }\r\n        if (item instanceof RootItem) {\r\n            return TreeNavigator.lastDescendantOf(item.lastChild);\r\n        }\r\n        if (!item.isVisible()) {\r\n            return TreeNavigator.lastDescendantOf(item.previous);\r\n        }\r\n        if (!item.isExpanded() || item.lastChild === null) {\r\n            return item;\r\n        }\r\n        return TreeNavigator.lastDescendantOf(item.lastChild);\r\n    };\r\n    TreeNavigator.prototype.current = function () {\r\n        return this.item || null;\r\n    };\r\n    TreeNavigator.prototype.next = function () {\r\n        if (this.item) {\r\n            do {\r\n                if ((this.item instanceof RootItem || (this.item.isVisible() && this.item.isExpanded())) && this.item.firstChild) {\r\n                    this.item = this.item.firstChild;\r\n                }\r\n                else if (this.item === this.start) {\r\n                    this.item = null;\r\n                }\r\n                else {\r\n                    // select next brother, next uncle, next great-uncle, etc...\r\n                    while (this.item && this.item !== this.start && !this.item.next) {\r\n                        this.item = this.item.parent;\r\n                    }\r\n                    if (this.item === this.start) {\r\n                        this.item = null;\r\n                    }\r\n                    this.item = !this.item ? null : this.item.next;\r\n                }\r\n            } while (this.item && !this.item.isVisible());\r\n        }\r\n        return this.item || null;\r\n    };\r\n    TreeNavigator.prototype.previous = function () {\r\n        if (this.item) {\r\n            do {\r\n                var previous = TreeNavigator.lastDescendantOf(this.item.previous);\r\n                if (previous) {\r\n                    this.item = previous;\r\n                }\r\n                else if (this.item.parent && this.item.parent !== this.start && this.item.parent.isVisible()) {\r\n                    this.item = this.item.parent;\r\n                }\r\n                else {\r\n                    this.item = null;\r\n                }\r\n            } while (this.item && !this.item.isVisible());\r\n        }\r\n        return this.item || null;\r\n    };\r\n    TreeNavigator.prototype.parent = function () {\r\n        if (this.item) {\r\n            var parent_1 = this.item.parent;\r\n            if (parent_1 && parent_1 !== this.start && parent_1.isVisible()) {\r\n                this.item = parent_1;\r\n            }\r\n            else {\r\n                this.item = null;\r\n            }\r\n        }\r\n        return this.item || null;\r\n    };\r\n    TreeNavigator.prototype.first = function () {\r\n        this.item = this.start;\r\n        this.next();\r\n        return this.item || null;\r\n    };\r\n    TreeNavigator.prototype.last = function () {\r\n        return TreeNavigator.lastDescendantOf(this.start);\r\n    };\r\n    return TreeNavigator;\r\n}());\r\nexport { TreeNavigator };\r\nvar TreeModel = /** @class */ (function () {\r\n    function TreeModel(context) {\r\n        this.registry = new ItemRegistry();\r\n        this.registryDisposable = Disposable.None;\r\n        this._onSetInput = new Emitter();\r\n        this.onSetInput = this._onSetInput.event;\r\n        this._onDidSetInput = new Emitter();\r\n        this.onDidSetInput = this._onDidSetInput.event;\r\n        this._onRefresh = new Emitter();\r\n        this.onRefresh = this._onRefresh.event;\r\n        this._onDidRefresh = new Emitter();\r\n        this.onDidRefresh = this._onDidRefresh.event;\r\n        this._onDidHighlight = new Emitter();\r\n        this.onDidHighlight = this._onDidHighlight.event;\r\n        this._onDidSelect = new Emitter();\r\n        this.onDidSelect = this._onDidSelect.event;\r\n        this._onDidFocus = new Emitter();\r\n        this.onDidFocus = this._onDidFocus.event;\r\n        this._onDidRevealItem = new Relay();\r\n        this.onDidRevealItem = this._onDidRevealItem.event;\r\n        this._onExpandItem = new Relay();\r\n        this.onExpandItem = this._onExpandItem.event;\r\n        this._onDidExpandItem = new Relay();\r\n        this.onDidExpandItem = this._onDidExpandItem.event;\r\n        this._onCollapseItem = new Relay();\r\n        this.onCollapseItem = this._onCollapseItem.event;\r\n        this._onDidCollapseItem = new Relay();\r\n        this.onDidCollapseItem = this._onDidCollapseItem.event;\r\n        this._onDidAddTraitItem = new Relay();\r\n        this.onDidAddTraitItem = this._onDidAddTraitItem.event;\r\n        this._onDidRemoveTraitItem = new Relay();\r\n        this.onDidRemoveTraitItem = this._onDidRemoveTraitItem.event;\r\n        this._onDidRefreshItem = new Relay();\r\n        this.onDidRefreshItem = this._onDidRefreshItem.event;\r\n        this._onRefreshItemChildren = new Relay();\r\n        this.onRefreshItemChildren = this._onRefreshItemChildren.event;\r\n        this._onDidRefreshItemChildren = new Relay();\r\n        this.onDidRefreshItemChildren = this._onDidRefreshItemChildren.event;\r\n        this._onDidDisposeItem = new Relay();\r\n        this.context = context;\r\n        this.input = null;\r\n        this.traitsToItems = {};\r\n    }\r\n    TreeModel.prototype.setInput = function (element) {\r\n        var _this = this;\r\n        var eventData = { item: this.input };\r\n        this._onSetInput.fire(eventData);\r\n        this.setSelection([]);\r\n        this.setFocus();\r\n        this.setHighlight();\r\n        this.lock = new Lock();\r\n        if (this.input) {\r\n            this.input.dispose();\r\n        }\r\n        if (this.registry) {\r\n            this.registry.dispose();\r\n            this.registryDisposable.dispose();\r\n        }\r\n        this.registry = new ItemRegistry();\r\n        this._onDidRevealItem.input = this.registry.onDidRevealItem;\r\n        this._onExpandItem.input = this.registry.onExpandItem;\r\n        this._onDidExpandItem.input = this.registry.onDidExpandItem;\r\n        this._onCollapseItem.input = this.registry.onCollapseItem;\r\n        this._onDidCollapseItem.input = this.registry.onDidCollapseItem;\r\n        this._onDidAddTraitItem.input = this.registry.onDidAddTraitItem;\r\n        this._onDidRemoveTraitItem.input = this.registry.onDidRemoveTraitItem;\r\n        this._onDidRefreshItem.input = this.registry.onDidRefreshItem;\r\n        this._onRefreshItemChildren.input = this.registry.onRefreshItemChildren;\r\n        this._onDidRefreshItemChildren.input = this.registry.onDidRefreshItemChildren;\r\n        this._onDidDisposeItem.input = this.registry.onDidDisposeItem;\r\n        this.registryDisposable = this.registry\r\n            .onDidDisposeItem(function (item) { return item.getAllTraits().forEach(function (trait) { return delete _this.traitsToItems[trait][item.id]; }); });\r\n        var id = this.context.dataSource.getId(this.context.tree, element);\r\n        this.input = new RootItem(id, this.registry, this.context, this.lock, element);\r\n        eventData = { item: this.input };\r\n        this._onDidSetInput.fire(eventData);\r\n        return this.refresh(this.input);\r\n    };\r\n    TreeModel.prototype.getInput = function () {\r\n        return this.input ? this.input.getElement() : null;\r\n    };\r\n    TreeModel.prototype.refresh = function (element, recursive) {\r\n        var _this = this;\r\n        if (element === void 0) { element = null; }\r\n        if (recursive === void 0) { recursive = true; }\r\n        var item = this.getItem(element);\r\n        if (!item) {\r\n            return Promise.resolve(null);\r\n        }\r\n        var eventData = { item: item, recursive: recursive };\r\n        this._onRefresh.fire(eventData);\r\n        return item.refresh(recursive).then(function () {\r\n            _this._onDidRefresh.fire(eventData);\r\n        });\r\n    };\r\n    TreeModel.prototype.expand = function (element) {\r\n        var item = this.getItem(element);\r\n        if (!item) {\r\n            return Promise.resolve(false);\r\n        }\r\n        return item.expand();\r\n    };\r\n    TreeModel.prototype.collapse = function (element, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        var item = this.getItem(element);\r\n        if (!item) {\r\n            return Promise.resolve(false);\r\n        }\r\n        return item.collapse(recursive);\r\n    };\r\n    TreeModel.prototype.toggleExpansion = function (element, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return this.isExpanded(element) ? this.collapse(element, recursive) : this.expand(element);\r\n    };\r\n    TreeModel.prototype.isExpanded = function (element) {\r\n        var item = this.getItem(element);\r\n        if (!item) {\r\n            return false;\r\n        }\r\n        return item.isExpanded();\r\n    };\r\n    TreeModel.prototype.reveal = function (element, relativeTop) {\r\n        var _this = this;\r\n        if (relativeTop === void 0) { relativeTop = null; }\r\n        return this.resolveUnknownParentChain(element).then(function (chain) {\r\n            var result = Promise.resolve(null);\r\n            chain.forEach(function (e) {\r\n                result = result.then(function () { return _this.expand(e); });\r\n            });\r\n            return result;\r\n        }).then(function () {\r\n            var item = _this.getItem(element);\r\n            if (item) {\r\n                return item.reveal(relativeTop);\r\n            }\r\n        });\r\n    };\r\n    TreeModel.prototype.resolveUnknownParentChain = function (element) {\r\n        var _this = this;\r\n        return this.context.dataSource.getParent(this.context.tree, element).then(function (parent) {\r\n            if (!parent) {\r\n                return Promise.resolve([]);\r\n            }\r\n            return _this.resolveUnknownParentChain(parent).then(function (result) {\r\n                result.push(parent);\r\n                return result;\r\n            });\r\n        });\r\n    };\r\n    TreeModel.prototype.setHighlight = function (element, eventPayload) {\r\n        this.setTraits('highlighted', element ? [element] : []);\r\n        var eventData = { highlight: this.getHighlight(), payload: eventPayload };\r\n        this._onDidHighlight.fire(eventData);\r\n    };\r\n    TreeModel.prototype.getHighlight = function (includeHidden) {\r\n        if (includeHidden === void 0) { includeHidden = false; }\r\n        var result = this.getElementsWithTrait('highlighted', includeHidden);\r\n        return result.length === 0 ? null : result[0];\r\n    };\r\n    TreeModel.prototype.setSelection = function (elements, eventPayload) {\r\n        this.setTraits('selected', elements);\r\n        var eventData = { selection: this.getSelection(), payload: eventPayload };\r\n        this._onDidSelect.fire(eventData);\r\n    };\r\n    TreeModel.prototype.getSelection = function (includeHidden) {\r\n        if (includeHidden === void 0) { includeHidden = false; }\r\n        return this.getElementsWithTrait('selected', includeHidden);\r\n    };\r\n    TreeModel.prototype.setFocus = function (element, eventPayload) {\r\n        this.setTraits('focused', element ? [element] : []);\r\n        var eventData = { focus: this.getFocus(), payload: eventPayload };\r\n        this._onDidFocus.fire(eventData);\r\n    };\r\n    TreeModel.prototype.getFocus = function (includeHidden) {\r\n        if (includeHidden === void 0) { includeHidden = false; }\r\n        var result = this.getElementsWithTrait('focused', includeHidden);\r\n        return result.length === 0 ? null : result[0];\r\n    };\r\n    TreeModel.prototype.focusNext = function (count, eventPayload) {\r\n        if (count === void 0) { count = 1; }\r\n        var item = this.getFocus() || this.input;\r\n        var nextItem;\r\n        var nav = this.getNavigator(item, false);\r\n        for (var i = 0; i < count; i++) {\r\n            nextItem = nav.next();\r\n            if (!nextItem) {\r\n                break;\r\n            }\r\n            item = nextItem;\r\n        }\r\n        this.setFocus(item, eventPayload);\r\n    };\r\n    TreeModel.prototype.focusPrevious = function (count, eventPayload) {\r\n        if (count === void 0) { count = 1; }\r\n        var item = this.getFocus() || this.input;\r\n        var previousItem;\r\n        var nav = this.getNavigator(item, false);\r\n        for (var i = 0; i < count; i++) {\r\n            previousItem = nav.previous();\r\n            if (!previousItem) {\r\n                break;\r\n            }\r\n            item = previousItem;\r\n        }\r\n        this.setFocus(item, eventPayload);\r\n    };\r\n    TreeModel.prototype.focusParent = function (eventPayload) {\r\n        var item = this.getFocus() || this.input;\r\n        var nav = this.getNavigator(item, false);\r\n        var parent = nav.parent();\r\n        if (parent) {\r\n            this.setFocus(parent, eventPayload);\r\n        }\r\n    };\r\n    TreeModel.prototype.focusFirstChild = function (eventPayload) {\r\n        var item = this.getItem(this.getFocus() || this.input);\r\n        var nav = this.getNavigator(item, false);\r\n        var next = nav.next();\r\n        var parent = nav.parent();\r\n        if (parent === item) {\r\n            this.setFocus(next, eventPayload);\r\n        }\r\n    };\r\n    TreeModel.prototype.focusFirst = function (eventPayload, from) {\r\n        this.focusNth(0, eventPayload, from);\r\n    };\r\n    TreeModel.prototype.focusNth = function (index, eventPayload, from) {\r\n        var navItem = this.getParent(from);\r\n        var nav = this.getNavigator(navItem);\r\n        var item = nav.first();\r\n        for (var i = 0; i < index; i++) {\r\n            item = nav.next();\r\n        }\r\n        if (item) {\r\n            this.setFocus(item, eventPayload);\r\n        }\r\n    };\r\n    TreeModel.prototype.focusLast = function (eventPayload, from) {\r\n        var navItem = this.getParent(from);\r\n        var item;\r\n        if (from && navItem) {\r\n            item = navItem.lastChild;\r\n        }\r\n        else {\r\n            var nav = this.getNavigator(navItem);\r\n            item = nav.last();\r\n        }\r\n        if (item) {\r\n            this.setFocus(item, eventPayload);\r\n        }\r\n    };\r\n    TreeModel.prototype.getParent = function (from) {\r\n        if (from) {\r\n            var fromItem = this.getItem(from);\r\n            if (fromItem && fromItem.parent) {\r\n                return fromItem.parent;\r\n            }\r\n        }\r\n        return this.getItem(this.input);\r\n    };\r\n    TreeModel.prototype.getNavigator = function (element, subTreeOnly) {\r\n        if (element === void 0) { element = null; }\r\n        if (subTreeOnly === void 0) { subTreeOnly = true; }\r\n        return new TreeNavigator(this.getItem(element), subTreeOnly);\r\n    };\r\n    TreeModel.prototype.getItem = function (element) {\r\n        if (element === void 0) { element = null; }\r\n        if (element === null) {\r\n            return this.input;\r\n        }\r\n        else if (element instanceof Item) {\r\n            return element;\r\n        }\r\n        else if (typeof element === 'string') {\r\n            return this.registry.getItem(element);\r\n        }\r\n        else {\r\n            return this.registry.getItem(this.context.dataSource.getId(this.context.tree, element));\r\n        }\r\n    };\r\n    TreeModel.prototype.removeTraits = function (trait, elements) {\r\n        var items = this.traitsToItems[trait] || {};\r\n        var item;\r\n        var id;\r\n        if (elements.length === 0) {\r\n            for (id in items) {\r\n                if (items.hasOwnProperty(id)) {\r\n                    item = items[id];\r\n                    item.removeTrait(trait);\r\n                }\r\n            }\r\n            delete this.traitsToItems[trait];\r\n        }\r\n        else {\r\n            for (var i = 0, len = elements.length; i < len; i++) {\r\n                item = this.getItem(elements[i]);\r\n                if (item) {\r\n                    item.removeTrait(trait);\r\n                    delete items[item.id];\r\n                }\r\n            }\r\n        }\r\n    };\r\n    TreeModel.prototype.setTraits = function (trait, elements) {\r\n        if (elements.length === 0) {\r\n            this.removeTraits(trait, elements);\r\n        }\r\n        else {\r\n            var items = {};\r\n            var item = void 0;\r\n            for (var i = 0, len = elements.length; i < len; i++) {\r\n                item = this.getItem(elements[i]);\r\n                if (item) {\r\n                    items[item.id] = item;\r\n                }\r\n            }\r\n            var traitItems = this.traitsToItems[trait] || {};\r\n            var itemsToRemoveTrait = [];\r\n            var id = void 0;\r\n            for (id in traitItems) {\r\n                if (traitItems.hasOwnProperty(id)) {\r\n                    if (items.hasOwnProperty(id)) {\r\n                        delete items[id];\r\n                    }\r\n                    else {\r\n                        itemsToRemoveTrait.push(traitItems[id]);\r\n                    }\r\n                }\r\n            }\r\n            for (var i = 0, len = itemsToRemoveTrait.length; i < len; i++) {\r\n                item = itemsToRemoveTrait[i];\r\n                item.removeTrait(trait);\r\n                delete traitItems[item.id];\r\n            }\r\n            for (id in items) {\r\n                if (items.hasOwnProperty(id)) {\r\n                    item = items[id];\r\n                    item.addTrait(trait);\r\n                    traitItems[id] = item;\r\n                }\r\n            }\r\n            this.traitsToItems[trait] = traitItems;\r\n        }\r\n    };\r\n    TreeModel.prototype.getElementsWithTrait = function (trait, includeHidden) {\r\n        var elements = [];\r\n        var items = this.traitsToItems[trait] || {};\r\n        var id;\r\n        for (id in items) {\r\n            if (items.hasOwnProperty(id) && (items[id].isVisible() || includeHidden)) {\r\n                elements.push(items[id].getElement());\r\n            }\r\n        }\r\n        return elements;\r\n    };\r\n    TreeModel.prototype.dispose = function () {\r\n        this.registry.dispose();\r\n        this._onSetInput.dispose();\r\n        this._onDidSetInput.dispose();\r\n        this._onRefresh.dispose();\r\n        this._onDidRefresh.dispose();\r\n        this._onDidHighlight.dispose();\r\n        this._onDidSelect.dispose();\r\n        this._onDidFocus.dispose();\r\n        this._onDidRevealItem.dispose();\r\n        this._onExpandItem.dispose();\r\n        this._onDidExpandItem.dispose();\r\n        this._onCollapseItem.dispose();\r\n        this._onDidCollapseItem.dispose();\r\n        this._onDidAddTraitItem.dispose();\r\n        this._onDidRemoveTraitItem.dispose();\r\n        this._onDidRefreshItem.dispose();\r\n        this._onRefreshItemChildren.dispose();\r\n        this._onDidRefreshItemChildren.dispose();\r\n        this._onDidDisposeItem.dispose();\r\n    };\r\n    return TreeModel;\r\n}());\r\nexport { TreeModel };\r\n"]},"metadata":{},"sourceType":"module"}