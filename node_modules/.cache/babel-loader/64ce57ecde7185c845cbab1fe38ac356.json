{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport './dnd.css';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { isMacintosh } from '../../../base/common/platform.js';\nimport { registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { DragAndDropCommand } from './dragAndDropCommand.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\n\nfunction hasTriggerModifier(e) {\n  if (isMacintosh) {\n    return e.altKey;\n  } else {\n    return e.ctrlKey;\n  }\n}\n\nvar DragAndDropController =\n/** @class */\nfunction (_super) {\n  __extends(DragAndDropController, _super);\n\n  function DragAndDropController(editor) {\n    var _this = _super.call(this) || this;\n\n    _this._editor = editor;\n\n    _this._register(_this._editor.onMouseDown(function (e) {\n      return _this._onEditorMouseDown(e);\n    }));\n\n    _this._register(_this._editor.onMouseUp(function (e) {\n      return _this._onEditorMouseUp(e);\n    }));\n\n    _this._register(_this._editor.onMouseDrag(function (e) {\n      return _this._onEditorMouseDrag(e);\n    }));\n\n    _this._register(_this._editor.onMouseDrop(function (e) {\n      return _this._onEditorMouseDrop(e);\n    }));\n\n    _this._register(_this._editor.onKeyDown(function (e) {\n      return _this.onEditorKeyDown(e);\n    }));\n\n    _this._register(_this._editor.onKeyUp(function (e) {\n      return _this.onEditorKeyUp(e);\n    }));\n\n    _this._register(_this._editor.onDidBlurEditorWidget(function () {\n      return _this.onEditorBlur();\n    }));\n\n    _this._dndDecorationIds = [];\n    _this._mouseDown = false;\n    _this._modifierPressed = false;\n    _this._dragSelection = null;\n    return _this;\n  }\n\n  DragAndDropController.prototype.onEditorBlur = function () {\n    this._removeDecoration();\n\n    this._dragSelection = null;\n    this._mouseDown = false;\n    this._modifierPressed = false;\n  };\n\n  DragAndDropController.prototype.onEditorKeyDown = function (e) {\n    if (!this._editor.getOption(24\n    /* dragAndDrop */\n    )) {\n      return;\n    }\n\n    if (hasTriggerModifier(e)) {\n      this._modifierPressed = true;\n    }\n\n    if (this._mouseDown && hasTriggerModifier(e)) {\n      this._editor.updateOptions({\n        mouseStyle: 'copy'\n      });\n    }\n  };\n\n  DragAndDropController.prototype.onEditorKeyUp = function (e) {\n    if (!this._editor.getOption(24\n    /* dragAndDrop */\n    )) {\n      return;\n    }\n\n    if (hasTriggerModifier(e)) {\n      this._modifierPressed = false;\n    }\n\n    if (this._mouseDown && e.keyCode === DragAndDropController.TRIGGER_KEY_VALUE) {\n      this._editor.updateOptions({\n        mouseStyle: 'default'\n      });\n    }\n  };\n\n  DragAndDropController.prototype._onEditorMouseDown = function (mouseEvent) {\n    this._mouseDown = true;\n  };\n\n  DragAndDropController.prototype._onEditorMouseUp = function (mouseEvent) {\n    this._mouseDown = false; // Whenever users release the mouse, the drag and drop operation should finish and the cursor should revert to text.\n\n    this._editor.updateOptions({\n      mouseStyle: 'text'\n    });\n  };\n\n  DragAndDropController.prototype._onEditorMouseDrag = function (mouseEvent) {\n    var target = mouseEvent.target;\n\n    if (this._dragSelection === null) {\n      var selections = this._editor.getSelections() || [];\n      var possibleSelections = selections.filter(function (selection) {\n        return target.position && selection.containsPosition(target.position);\n      });\n\n      if (possibleSelections.length === 1) {\n        this._dragSelection = possibleSelections[0];\n      } else {\n        return;\n      }\n    }\n\n    if (hasTriggerModifier(mouseEvent.event)) {\n      this._editor.updateOptions({\n        mouseStyle: 'copy'\n      });\n    } else {\n      this._editor.updateOptions({\n        mouseStyle: 'default'\n      });\n    }\n\n    if (target.position) {\n      if (this._dragSelection.containsPosition(target.position)) {\n        this._removeDecoration();\n      } else {\n        this.showAt(target.position);\n      }\n    }\n  };\n\n  DragAndDropController.prototype._onEditorMouseDrop = function (mouseEvent) {\n    if (mouseEvent.target && (this._hitContent(mouseEvent.target) || this._hitMargin(mouseEvent.target)) && mouseEvent.target.position) {\n      var newCursorPosition_1 = new Position(mouseEvent.target.position.lineNumber, mouseEvent.target.position.column);\n\n      if (this._dragSelection === null) {\n        var newSelections = null;\n\n        if (mouseEvent.event.shiftKey) {\n          var primarySelection = this._editor.getSelection();\n\n          if (primarySelection) {\n            var selectionStartLineNumber = primarySelection.selectionStartLineNumber,\n                selectionStartColumn = primarySelection.selectionStartColumn;\n            newSelections = [new Selection(selectionStartLineNumber, selectionStartColumn, newCursorPosition_1.lineNumber, newCursorPosition_1.column)];\n          }\n        } else {\n          newSelections = (this._editor.getSelections() || []).map(function (selection) {\n            if (selection.containsPosition(newCursorPosition_1)) {\n              return new Selection(newCursorPosition_1.lineNumber, newCursorPosition_1.column, newCursorPosition_1.lineNumber, newCursorPosition_1.column);\n            } else {\n              return selection;\n            }\n          });\n        } // Use `mouse` as the source instead of `api`.\n\n\n        this._editor.setSelections(newSelections || [], 'mouse');\n      } else if (!this._dragSelection.containsPosition(newCursorPosition_1) || (hasTriggerModifier(mouseEvent.event) || this._modifierPressed) && (this._dragSelection.getEndPosition().equals(newCursorPosition_1) || this._dragSelection.getStartPosition().equals(newCursorPosition_1)) // we allow users to paste content beside the selection\n      ) {\n        this._editor.pushUndoStop();\n\n        this._editor.executeCommand(DragAndDropController.ID, new DragAndDropCommand(this._dragSelection, newCursorPosition_1, hasTriggerModifier(mouseEvent.event) || this._modifierPressed));\n\n        this._editor.pushUndoStop();\n      }\n    }\n\n    this._editor.updateOptions({\n      mouseStyle: 'text'\n    });\n\n    this._removeDecoration();\n\n    this._dragSelection = null;\n    this._mouseDown = false;\n  };\n\n  DragAndDropController.prototype.showAt = function (position) {\n    var newDecorations = [{\n      range: new Range(position.lineNumber, position.column, position.lineNumber, position.column),\n      options: DragAndDropController._DECORATION_OPTIONS\n    }];\n    this._dndDecorationIds = this._editor.deltaDecorations(this._dndDecorationIds, newDecorations);\n\n    this._editor.revealPosition(position, 1\n    /* Immediate */\n    );\n  };\n\n  DragAndDropController.prototype._removeDecoration = function () {\n    this._dndDecorationIds = this._editor.deltaDecorations(this._dndDecorationIds, []);\n  };\n\n  DragAndDropController.prototype._hitContent = function (target) {\n    return target.type === 6\n    /* CONTENT_TEXT */\n    || target.type === 7\n    /* CONTENT_EMPTY */\n    ;\n  };\n\n  DragAndDropController.prototype._hitMargin = function (target) {\n    return target.type === 2\n    /* GUTTER_GLYPH_MARGIN */\n    || target.type === 3\n    /* GUTTER_LINE_NUMBERS */\n    || target.type === 4\n    /* GUTTER_LINE_DECORATIONS */\n    ;\n  };\n\n  DragAndDropController.prototype.dispose = function () {\n    this._removeDecoration();\n\n    this._dragSelection = null;\n    this._mouseDown = false;\n    this._modifierPressed = false;\n\n    _super.prototype.dispose.call(this);\n  };\n\n  DragAndDropController.ID = 'editor.contrib.dragAndDrop';\n  DragAndDropController.TRIGGER_KEY_VALUE = isMacintosh ? 6\n  /* Alt */\n  : 5\n  /* Ctrl */\n  ;\n  DragAndDropController._DECORATION_OPTIONS = ModelDecorationOptions.register({\n    className: 'dnd-target'\n  });\n  return DragAndDropController;\n}(Disposable);\n\nexport { DragAndDropController };\nregisterEditorContribution(DragAndDropController.ID, DragAndDropController);","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/dnd/dnd.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Disposable","isMacintosh","registerEditorContribution","Position","Range","Selection","DragAndDropCommand","ModelDecorationOptions","hasTriggerModifier","e","altKey","ctrlKey","DragAndDropController","_super","editor","_this","call","_editor","_register","onMouseDown","_onEditorMouseDown","onMouseUp","_onEditorMouseUp","onMouseDrag","_onEditorMouseDrag","onMouseDrop","_onEditorMouseDrop","onKeyDown","onEditorKeyDown","onKeyUp","onEditorKeyUp","onDidBlurEditorWidget","onEditorBlur","_dndDecorationIds","_mouseDown","_modifierPressed","_dragSelection","_removeDecoration","getOption","updateOptions","mouseStyle","keyCode","TRIGGER_KEY_VALUE","mouseEvent","target","selections","getSelections","possibleSelections","filter","selection","position","containsPosition","length","event","showAt","_hitContent","_hitMargin","newCursorPosition_1","lineNumber","column","newSelections","shiftKey","primarySelection","getSelection","selectionStartLineNumber","selectionStartColumn","map","setSelections","getEndPosition","equals","getStartPosition","pushUndoStop","executeCommand","ID","newDecorations","range","options","_DECORATION_OPTIONS","deltaDecorations","revealPosition","type","dispose","register","className"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './dnd.css';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport { isMacintosh } from '../../../base/common/platform.js';\r\nimport { registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { DragAndDropCommand } from './dragAndDropCommand.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nfunction hasTriggerModifier(e) {\r\n    if (isMacintosh) {\r\n        return e.altKey;\r\n    }\r\n    else {\r\n        return e.ctrlKey;\r\n    }\r\n}\r\nvar DragAndDropController = /** @class */ (function (_super) {\r\n    __extends(DragAndDropController, _super);\r\n    function DragAndDropController(editor) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = editor;\r\n        _this._register(_this._editor.onMouseDown(function (e) { return _this._onEditorMouseDown(e); }));\r\n        _this._register(_this._editor.onMouseUp(function (e) { return _this._onEditorMouseUp(e); }));\r\n        _this._register(_this._editor.onMouseDrag(function (e) { return _this._onEditorMouseDrag(e); }));\r\n        _this._register(_this._editor.onMouseDrop(function (e) { return _this._onEditorMouseDrop(e); }));\r\n        _this._register(_this._editor.onKeyDown(function (e) { return _this.onEditorKeyDown(e); }));\r\n        _this._register(_this._editor.onKeyUp(function (e) { return _this.onEditorKeyUp(e); }));\r\n        _this._register(_this._editor.onDidBlurEditorWidget(function () { return _this.onEditorBlur(); }));\r\n        _this._dndDecorationIds = [];\r\n        _this._mouseDown = false;\r\n        _this._modifierPressed = false;\r\n        _this._dragSelection = null;\r\n        return _this;\r\n    }\r\n    DragAndDropController.prototype.onEditorBlur = function () {\r\n        this._removeDecoration();\r\n        this._dragSelection = null;\r\n        this._mouseDown = false;\r\n        this._modifierPressed = false;\r\n    };\r\n    DragAndDropController.prototype.onEditorKeyDown = function (e) {\r\n        if (!this._editor.getOption(24 /* dragAndDrop */)) {\r\n            return;\r\n        }\r\n        if (hasTriggerModifier(e)) {\r\n            this._modifierPressed = true;\r\n        }\r\n        if (this._mouseDown && hasTriggerModifier(e)) {\r\n            this._editor.updateOptions({\r\n                mouseStyle: 'copy'\r\n            });\r\n        }\r\n    };\r\n    DragAndDropController.prototype.onEditorKeyUp = function (e) {\r\n        if (!this._editor.getOption(24 /* dragAndDrop */)) {\r\n            return;\r\n        }\r\n        if (hasTriggerModifier(e)) {\r\n            this._modifierPressed = false;\r\n        }\r\n        if (this._mouseDown && e.keyCode === DragAndDropController.TRIGGER_KEY_VALUE) {\r\n            this._editor.updateOptions({\r\n                mouseStyle: 'default'\r\n            });\r\n        }\r\n    };\r\n    DragAndDropController.prototype._onEditorMouseDown = function (mouseEvent) {\r\n        this._mouseDown = true;\r\n    };\r\n    DragAndDropController.prototype._onEditorMouseUp = function (mouseEvent) {\r\n        this._mouseDown = false;\r\n        // Whenever users release the mouse, the drag and drop operation should finish and the cursor should revert to text.\r\n        this._editor.updateOptions({\r\n            mouseStyle: 'text'\r\n        });\r\n    };\r\n    DragAndDropController.prototype._onEditorMouseDrag = function (mouseEvent) {\r\n        var target = mouseEvent.target;\r\n        if (this._dragSelection === null) {\r\n            var selections = this._editor.getSelections() || [];\r\n            var possibleSelections = selections.filter(function (selection) { return target.position && selection.containsPosition(target.position); });\r\n            if (possibleSelections.length === 1) {\r\n                this._dragSelection = possibleSelections[0];\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n        }\r\n        if (hasTriggerModifier(mouseEvent.event)) {\r\n            this._editor.updateOptions({\r\n                mouseStyle: 'copy'\r\n            });\r\n        }\r\n        else {\r\n            this._editor.updateOptions({\r\n                mouseStyle: 'default'\r\n            });\r\n        }\r\n        if (target.position) {\r\n            if (this._dragSelection.containsPosition(target.position)) {\r\n                this._removeDecoration();\r\n            }\r\n            else {\r\n                this.showAt(target.position);\r\n            }\r\n        }\r\n    };\r\n    DragAndDropController.prototype._onEditorMouseDrop = function (mouseEvent) {\r\n        if (mouseEvent.target && (this._hitContent(mouseEvent.target) || this._hitMargin(mouseEvent.target)) && mouseEvent.target.position) {\r\n            var newCursorPosition_1 = new Position(mouseEvent.target.position.lineNumber, mouseEvent.target.position.column);\r\n            if (this._dragSelection === null) {\r\n                var newSelections = null;\r\n                if (mouseEvent.event.shiftKey) {\r\n                    var primarySelection = this._editor.getSelection();\r\n                    if (primarySelection) {\r\n                        var selectionStartLineNumber = primarySelection.selectionStartLineNumber, selectionStartColumn = primarySelection.selectionStartColumn;\r\n                        newSelections = [new Selection(selectionStartLineNumber, selectionStartColumn, newCursorPosition_1.lineNumber, newCursorPosition_1.column)];\r\n                    }\r\n                }\r\n                else {\r\n                    newSelections = (this._editor.getSelections() || []).map(function (selection) {\r\n                        if (selection.containsPosition(newCursorPosition_1)) {\r\n                            return new Selection(newCursorPosition_1.lineNumber, newCursorPosition_1.column, newCursorPosition_1.lineNumber, newCursorPosition_1.column);\r\n                        }\r\n                        else {\r\n                            return selection;\r\n                        }\r\n                    });\r\n                }\r\n                // Use `mouse` as the source instead of `api`.\r\n                this._editor.setSelections(newSelections || [], 'mouse');\r\n            }\r\n            else if (!this._dragSelection.containsPosition(newCursorPosition_1) ||\r\n                ((hasTriggerModifier(mouseEvent.event) ||\r\n                    this._modifierPressed) && (this._dragSelection.getEndPosition().equals(newCursorPosition_1) || this._dragSelection.getStartPosition().equals(newCursorPosition_1)) // we allow users to paste content beside the selection\r\n                )) {\r\n                this._editor.pushUndoStop();\r\n                this._editor.executeCommand(DragAndDropController.ID, new DragAndDropCommand(this._dragSelection, newCursorPosition_1, hasTriggerModifier(mouseEvent.event) || this._modifierPressed));\r\n                this._editor.pushUndoStop();\r\n            }\r\n        }\r\n        this._editor.updateOptions({\r\n            mouseStyle: 'text'\r\n        });\r\n        this._removeDecoration();\r\n        this._dragSelection = null;\r\n        this._mouseDown = false;\r\n    };\r\n    DragAndDropController.prototype.showAt = function (position) {\r\n        var newDecorations = [{\r\n                range: new Range(position.lineNumber, position.column, position.lineNumber, position.column),\r\n                options: DragAndDropController._DECORATION_OPTIONS\r\n            }];\r\n        this._dndDecorationIds = this._editor.deltaDecorations(this._dndDecorationIds, newDecorations);\r\n        this._editor.revealPosition(position, 1 /* Immediate */);\r\n    };\r\n    DragAndDropController.prototype._removeDecoration = function () {\r\n        this._dndDecorationIds = this._editor.deltaDecorations(this._dndDecorationIds, []);\r\n    };\r\n    DragAndDropController.prototype._hitContent = function (target) {\r\n        return target.type === 6 /* CONTENT_TEXT */ ||\r\n            target.type === 7 /* CONTENT_EMPTY */;\r\n    };\r\n    DragAndDropController.prototype._hitMargin = function (target) {\r\n        return target.type === 2 /* GUTTER_GLYPH_MARGIN */ ||\r\n            target.type === 3 /* GUTTER_LINE_NUMBERS */ ||\r\n            target.type === 4 /* GUTTER_LINE_DECORATIONS */;\r\n    };\r\n    DragAndDropController.prototype.dispose = function () {\r\n        this._removeDecoration();\r\n        this._dragSelection = null;\r\n        this._mouseDown = false;\r\n        this._modifierPressed = false;\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    DragAndDropController.ID = 'editor.contrib.dragAndDrop';\r\n    DragAndDropController.TRIGGER_KEY_VALUE = isMacintosh ? 6 /* Alt */ : 5 /* Ctrl */;\r\n    DragAndDropController._DECORATION_OPTIONS = ModelDecorationOptions.register({\r\n        className: 'dnd-target'\r\n    });\r\n    return DragAndDropController;\r\n}(Disposable));\r\nexport { DragAndDropController };\r\nregisterEditorContribution(DragAndDropController.ID, DragAndDropController);\r\n"]},"metadata":{},"sourceType":"module"}