{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport * as nls from '../../../nls.js';\nimport * as dom from '../../../base/browser/dom.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Color, RGBA } from '../../../base/common/color.js';\nimport { MarkdownString, isEmptyMarkdownString, markedStringsEquals } from '../../../base/common/htmlContent.js';\nimport { toDisposable, DisposableStore, combinedDisposable, MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\nimport { HoverProviderRegistry, TokenizationRegistry } from '../../common/modes.js';\nimport { getColorPresentations } from '../colorPicker/color.js';\nimport { ColorDetector } from '../colorPicker/colorDetector.js';\nimport { ColorPickerModel } from '../colorPicker/colorPickerModel.js';\nimport { ColorPickerWidget } from '../colorPicker/colorPickerWidget.js';\nimport { getHover } from './getHover.js';\nimport { HoverOperation } from './hoverOperation.js';\nimport { ContentHoverWidget } from './hoverWidgets.js';\nimport { MarkdownRenderer } from '../markdown/markdownRenderer.js';\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { coalesce, isNonEmptyArray, asArray } from '../../../base/common/arrays.js';\nimport { IMarkerData, MarkerSeverity } from '../../../platform/markers/common/markers.js';\nimport { basename } from '../../../base/common/resources.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { NullOpenerService } from '../../../platform/opener/common/opener.js';\nimport { MarkerController, NextMarkerAction } from '../gotoError/gotoError.js';\nimport { createCancelablePromise } from '../../../base/common/async.js';\nimport { getCodeActions } from '../codeAction/codeAction.js';\nimport { QuickFixAction, QuickFixController } from '../codeAction/codeActionCommands.js';\nimport { CodeActionKind } from '../codeAction/types.js';\nimport { textLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\nvar $ = dom.$;\n\nvar ColorHover =\n/** @class */\nfunction () {\n  function ColorHover(range, color, provider) {\n    this.range = range;\n    this.color = color;\n    this.provider = provider;\n  }\n\n  return ColorHover;\n}();\n\nvar MarkerHover =\n/** @class */\nfunction () {\n  function MarkerHover(range, marker) {\n    this.range = range;\n    this.marker = marker;\n  }\n\n  return MarkerHover;\n}();\n\nvar ModesContentComputer =\n/** @class */\nfunction () {\n  function ModesContentComputer(editor, _markerDecorationsService) {\n    this._markerDecorationsService = _markerDecorationsService;\n    this._editor = editor;\n    this._result = [];\n  }\n\n  ModesContentComputer.prototype.setRange = function (range) {\n    this._range = range;\n    this._result = [];\n  };\n\n  ModesContentComputer.prototype.clearResult = function () {\n    this._result = [];\n  };\n\n  ModesContentComputer.prototype.computeAsync = function (token) {\n    if (!this._editor.hasModel() || !this._range) {\n      return Promise.resolve([]);\n    }\n\n    var model = this._editor.getModel();\n\n    if (!HoverProviderRegistry.has(model)) {\n      return Promise.resolve([]);\n    }\n\n    return getHover(model, new Position(this._range.startLineNumber, this._range.startColumn), token);\n  };\n\n  ModesContentComputer.prototype.computeSync = function () {\n    var _this = this;\n\n    if (!this._editor.hasModel() || !this._range) {\n      return [];\n    }\n\n    var model = this._editor.getModel();\n\n    var lineNumber = this._range.startLineNumber;\n\n    if (lineNumber > this._editor.getModel().getLineCount()) {\n      // Illegal line number => no results\n      return [];\n    }\n\n    var colorDetector = ColorDetector.get(this._editor);\n    var maxColumn = model.getLineMaxColumn(lineNumber);\n\n    var lineDecorations = this._editor.getLineDecorations(lineNumber);\n\n    var didFindColor = false;\n    var hoverRange = this._range;\n    var result = lineDecorations.map(function (d) {\n      var startColumn = d.range.startLineNumber === lineNumber ? d.range.startColumn : 1;\n      var endColumn = d.range.endLineNumber === lineNumber ? d.range.endColumn : maxColumn;\n\n      if (startColumn > hoverRange.startColumn || hoverRange.endColumn > endColumn) {\n        return null;\n      }\n\n      var range = new Range(hoverRange.startLineNumber, startColumn, hoverRange.startLineNumber, endColumn);\n\n      var marker = _this._markerDecorationsService.getMarker(model, d);\n\n      if (marker) {\n        return new MarkerHover(range, marker);\n      }\n\n      var colorData = colorDetector.getColorData(d.range.getStartPosition());\n\n      if (!didFindColor && colorData) {\n        didFindColor = true;\n        var _a = colorData.colorInfo,\n            color = _a.color,\n            range_1 = _a.range;\n        return new ColorHover(range_1, color, colorData.provider);\n      } else {\n        if (isEmptyMarkdownString(d.options.hoverMessage)) {\n          return null;\n        }\n\n        var contents = d.options.hoverMessage ? asArray(d.options.hoverMessage) : [];\n        return {\n          contents: contents,\n          range: range\n        };\n      }\n    });\n    return coalesce(result);\n  };\n\n  ModesContentComputer.prototype.onResult = function (result, isFromSynchronousComputation) {\n    // Always put synchronous messages before asynchronous ones\n    if (isFromSynchronousComputation) {\n      this._result = result.concat(this._result.sort(function (a, b) {\n        if (a instanceof ColorHover) {\n          // sort picker messages at to the top\n          return -1;\n        } else if (b instanceof ColorHover) {\n          return 1;\n        }\n\n        return 0;\n      }));\n    } else {\n      this._result = this._result.concat(result);\n    }\n  };\n\n  ModesContentComputer.prototype.getResult = function () {\n    return this._result.slice(0);\n  };\n\n  ModesContentComputer.prototype.getResultWithLoadingMessage = function () {\n    return this._result.slice(0).concat([this._getLoadingMessage()]);\n  };\n\n  ModesContentComputer.prototype._getLoadingMessage = function () {\n    return {\n      range: this._range,\n      contents: [new MarkdownString().appendText(nls.localize('modesContentHover.loading', \"Loading...\"))]\n    };\n  };\n\n  return ModesContentComputer;\n}();\n\nvar markerCodeActionTrigger = {\n  type: 2\n  /* Manual */\n  ,\n  filter: {\n    include: CodeActionKind.QuickFix\n  }\n};\n\nvar ModesContentHoverWidget =\n/** @class */\nfunction (_super) {\n  __extends(ModesContentHoverWidget, _super);\n\n  function ModesContentHoverWidget(editor, markerDecorationsService, _themeService, _keybindingService, _modeService, _openerService) {\n    if (_openerService === void 0) {\n      _openerService = NullOpenerService;\n    }\n\n    var _this = _super.call(this, ModesContentHoverWidget.ID, editor) || this;\n\n    _this._themeService = _themeService;\n    _this._keybindingService = _keybindingService;\n    _this._modeService = _modeService;\n    _this._openerService = _openerService;\n    _this.renderDisposable = _this._register(new MutableDisposable());\n    _this._messages = [];\n    _this._lastRange = null;\n    _this._computer = new ModesContentComputer(_this._editor, markerDecorationsService);\n    _this._highlightDecorations = [];\n    _this._isChangingDecorations = false;\n    _this._shouldFocus = false;\n    _this._colorPicker = null;\n    _this._hoverOperation = new HoverOperation(_this._computer, function (result) {\n      return _this._withResult(result, true);\n    }, null, function (result) {\n      return _this._withResult(result, false);\n    }, _this._editor.getOption(44\n    /* hover */\n    ).delay);\n\n    _this._register(dom.addStandardDisposableListener(_this.getDomNode(), dom.EventType.FOCUS, function () {\n      if (_this._colorPicker) {\n        dom.addClass(_this.getDomNode(), 'colorpicker-hover');\n      }\n    }));\n\n    _this._register(dom.addStandardDisposableListener(_this.getDomNode(), dom.EventType.BLUR, function () {\n      dom.removeClass(_this.getDomNode(), 'colorpicker-hover');\n    }));\n\n    _this._register(editor.onDidChangeConfiguration(function (e) {\n      _this._hoverOperation.setHoverTime(_this._editor.getOption(44\n      /* hover */\n      ).delay);\n    }));\n\n    _this._register(TokenizationRegistry.onDidChange(function (e) {\n      if (_this.isVisible && _this._lastRange && _this._messages.length > 0) {\n        _this._domNode.textContent = '';\n\n        _this._renderMessages(_this._lastRange, _this._messages);\n      }\n    }));\n\n    return _this;\n  }\n\n  ModesContentHoverWidget.prototype.dispose = function () {\n    this._hoverOperation.cancel();\n\n    _super.prototype.dispose.call(this);\n  };\n\n  ModesContentHoverWidget.prototype.onModelDecorationsChanged = function () {\n    if (this._isChangingDecorations) {\n      return;\n    }\n\n    if (this.isVisible) {\n      // The decorations have changed and the hover is visible,\n      // we need to recompute the displayed text\n      this._hoverOperation.cancel();\n\n      this._computer.clearResult();\n\n      if (!this._colorPicker) {\n        // TODO@Michel ensure that displayed text for other decorations is computed even if color picker is in place\n        this._hoverOperation.start(0\n        /* Delayed */\n        );\n      }\n    }\n  };\n\n  ModesContentHoverWidget.prototype.startShowingAt = function (range, mode, focus) {\n    if (this._lastRange && this._lastRange.equalsRange(range)) {\n      // We have to show the widget at the exact same range as before, so no work is needed\n      return;\n    }\n\n    this._hoverOperation.cancel();\n\n    if (this.isVisible) {\n      // The range might have changed, but the hover is visible\n      // Instead of hiding it completely, filter out messages that are still in the new range and\n      // kick off a new computation\n      if (!this._showAtPosition || this._showAtPosition.lineNumber !== range.startLineNumber) {\n        this.hide();\n      } else {\n        var filteredMessages = [];\n\n        for (var i = 0, len = this._messages.length; i < len; i++) {\n          var msg = this._messages[i];\n          var rng = msg.range;\n\n          if (rng && rng.startColumn <= range.startColumn && rng.endColumn >= range.endColumn) {\n            filteredMessages.push(msg);\n          }\n        }\n\n        if (filteredMessages.length > 0) {\n          if (hoverContentsEquals(filteredMessages, this._messages)) {\n            return;\n          }\n\n          this._renderMessages(range, filteredMessages);\n        } else {\n          this.hide();\n        }\n      }\n    }\n\n    this._lastRange = range;\n\n    this._computer.setRange(range);\n\n    this._shouldFocus = focus;\n\n    this._hoverOperation.start(mode);\n  };\n\n  ModesContentHoverWidget.prototype.hide = function () {\n    this._lastRange = null;\n\n    this._hoverOperation.cancel();\n\n    _super.prototype.hide.call(this);\n\n    this._isChangingDecorations = true;\n    this._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, []);\n    this._isChangingDecorations = false;\n    this.renderDisposable.clear();\n    this._colorPicker = null;\n  };\n\n  ModesContentHoverWidget.prototype.isColorPickerVisible = function () {\n    if (this._colorPicker) {\n      return true;\n    }\n\n    return false;\n  };\n\n  ModesContentHoverWidget.prototype._withResult = function (result, complete) {\n    this._messages = result;\n\n    if (this._lastRange && this._messages.length > 0) {\n      this._renderMessages(this._lastRange, this._messages);\n    } else if (complete) {\n      this.hide();\n    }\n  };\n\n  ModesContentHoverWidget.prototype._renderMessages = function (renderRange, messages) {\n    var _this = this;\n\n    this.renderDisposable.dispose();\n    this._colorPicker = null; // update column from which to show\n\n    var renderColumn = 1073741824\n    /* MAX_SAFE_SMALL_INTEGER */\n    ;\n    var highlightRange = messages[0].range ? Range.lift(messages[0].range) : null;\n    var fragment = document.createDocumentFragment();\n    var isEmptyHoverContent = true;\n    var containColorPicker = false;\n    var markdownDisposeables = new DisposableStore();\n    var markerMessages = [];\n    messages.forEach(function (msg) {\n      if (!msg.range) {\n        return;\n      }\n\n      renderColumn = Math.min(renderColumn, msg.range.startColumn);\n      highlightRange = highlightRange ? Range.plusRange(highlightRange, msg.range) : Range.lift(msg.range);\n\n      if (msg instanceof ColorHover) {\n        containColorPicker = true;\n        var _a = msg.color,\n            red = _a.red,\n            green = _a.green,\n            blue = _a.blue,\n            alpha = _a.alpha;\n        var rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\n        var color_1 = new Color(rgba);\n\n        if (!_this._editor.hasModel()) {\n          return;\n        }\n\n        var editorModel_1 = _this._editor.getModel();\n\n        var range_2 = new Range(msg.range.startLineNumber, msg.range.startColumn, msg.range.endLineNumber, msg.range.endColumn);\n        var colorInfo = {\n          range: msg.range,\n          color: msg.color\n        }; // create blank olor picker model and widget first to ensure it's positioned correctly.\n\n        var model_1 = new ColorPickerModel(color_1, [], 0);\n        var widget_1 = new ColorPickerWidget(fragment, model_1, _this._editor.getOption(105\n        /* pixelRatio */\n        ), _this._themeService);\n        getColorPresentations(editorModel_1, colorInfo, msg.provider, CancellationToken.None).then(function (colorPresentations) {\n          model_1.colorPresentations = colorPresentations || [];\n\n          if (!_this._editor.hasModel()) {\n            // gone...\n            return;\n          }\n\n          var originalText = _this._editor.getModel().getValueInRange(msg.range);\n\n          model_1.guessColorPresentation(color_1, originalText);\n\n          var updateEditorModel = function () {\n            var textEdits;\n            var newRange;\n\n            if (model_1.presentation.textEdit) {\n              textEdits = [model_1.presentation.textEdit];\n              newRange = new Range(model_1.presentation.textEdit.range.startLineNumber, model_1.presentation.textEdit.range.startColumn, model_1.presentation.textEdit.range.endLineNumber, model_1.presentation.textEdit.range.endColumn);\n              newRange = newRange.setEndPosition(newRange.endLineNumber, newRange.startColumn + model_1.presentation.textEdit.text.length);\n            } else {\n              textEdits = [{\n                identifier: null,\n                range: range_2,\n                text: model_1.presentation.label,\n                forceMoveMarkers: false\n              }];\n              newRange = range_2.setEndPosition(range_2.endLineNumber, range_2.startColumn + model_1.presentation.label.length);\n            }\n\n            _this._editor.pushUndoStop();\n\n            _this._editor.executeEdits('colorpicker', textEdits);\n\n            if (model_1.presentation.additionalTextEdits) {\n              textEdits = __spreadArrays(model_1.presentation.additionalTextEdits);\n\n              _this._editor.executeEdits('colorpicker', textEdits);\n\n              _this.hide();\n            }\n\n            _this._editor.pushUndoStop();\n\n            range_2 = newRange;\n          };\n\n          var updateColorPresentations = function (color) {\n            return getColorPresentations(editorModel_1, {\n              range: range_2,\n              color: {\n                red: color.rgba.r / 255,\n                green: color.rgba.g / 255,\n                blue: color.rgba.b / 255,\n                alpha: color.rgba.a\n              }\n            }, msg.provider, CancellationToken.None).then(function (colorPresentations) {\n              model_1.colorPresentations = colorPresentations || [];\n            });\n          };\n\n          var colorListener = model_1.onColorFlushed(function (color) {\n            updateColorPresentations(color).then(updateEditorModel);\n          });\n          var colorChangeListener = model_1.onDidChangeColor(updateColorPresentations);\n          _this._colorPicker = widget_1;\n\n          _this.showAt(range_2.getStartPosition(), range_2, _this._shouldFocus);\n\n          _this.updateContents(fragment);\n\n          _this._colorPicker.layout();\n\n          _this.renderDisposable.value = combinedDisposable(colorListener, colorChangeListener, widget_1, markdownDisposeables);\n        });\n      } else {\n        if (msg instanceof MarkerHover) {\n          markerMessages.push(msg);\n          isEmptyHoverContent = false;\n        } else {\n          msg.contents.filter(function (contents) {\n            return !isEmptyMarkdownString(contents);\n          }).forEach(function (contents) {\n            var markdownHoverElement = $('div.hover-row.markdown-hover');\n            var hoverContentsElement = dom.append(markdownHoverElement, $('div.hover-contents'));\n            var renderer = markdownDisposeables.add(new MarkdownRenderer(_this._editor, _this._modeService, _this._openerService));\n            markdownDisposeables.add(renderer.onDidRenderCodeBlock(function () {\n              hoverContentsElement.className = 'hover-contents code-hover-contents';\n\n              _this.onContentsChange();\n            }));\n            var renderedContents = markdownDisposeables.add(renderer.render(contents));\n            hoverContentsElement.appendChild(renderedContents.element);\n            fragment.appendChild(markdownHoverElement);\n            isEmptyHoverContent = false;\n          });\n        }\n      }\n    });\n\n    if (markerMessages.length) {\n      markerMessages.forEach(function (msg) {\n        return fragment.appendChild(_this.renderMarkerHover(msg));\n      });\n      var markerHoverForStatusbar = markerMessages.length === 1 ? markerMessages[0] : markerMessages.sort(function (a, b) {\n        return MarkerSeverity.compare(a.marker.severity, b.marker.severity);\n      })[0];\n      fragment.appendChild(this.renderMarkerStatusbar(markerHoverForStatusbar));\n    } // show\n\n\n    if (!containColorPicker && !isEmptyHoverContent) {\n      this.showAt(new Position(renderRange.startLineNumber, renderColumn), highlightRange, this._shouldFocus);\n      this.updateContents(fragment);\n    }\n\n    this._isChangingDecorations = true;\n    this._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, highlightRange ? [{\n      range: highlightRange,\n      options: ModesContentHoverWidget._DECORATION_OPTIONS\n    }] : []);\n    this._isChangingDecorations = false;\n  };\n\n  ModesContentHoverWidget.prototype.renderMarkerHover = function (markerHover) {\n    var _this = this;\n\n    var hoverElement = $('div.hover-row');\n    var markerElement = dom.append(hoverElement, $('div.marker.hover-contents'));\n    var _a = markerHover.marker,\n        source = _a.source,\n        message = _a.message,\n        code = _a.code,\n        relatedInformation = _a.relatedInformation;\n\n    this._editor.applyFontInfo(markerElement);\n\n    var messageElement = dom.append(markerElement, $('span'));\n    messageElement.style.whiteSpace = 'pre-wrap';\n    messageElement.innerText = message;\n\n    if (source || code) {\n      if (typeof code === 'string') {\n        var detailsElement = dom.append(markerElement, $('span'));\n        detailsElement.style.opacity = '0.6';\n        detailsElement.style.paddingLeft = '6px';\n        detailsElement.innerText = source && code ? source + \"(\" + code + \")\" : source ? source : \"(\" + code + \")\";\n      } else {\n        if (code) {\n          var sourceAndCodeElement = $('span');\n\n          if (source) {\n            var sourceElement = dom.append(sourceAndCodeElement, $('span'));\n            sourceElement.innerText = source;\n          }\n\n          this._codeLink = dom.append(sourceAndCodeElement, $('a.code-link'));\n\n          this._codeLink.setAttribute('href', code.link.toString());\n\n          this._codeLink.onclick = function (e) {\n            _this._openerService.open(code.link);\n\n            e.preventDefault();\n            e.stopPropagation();\n          };\n\n          var codeElement = dom.append(this._codeLink, $('span'));\n          codeElement.innerText = code.value;\n          var detailsElement = dom.append(markerElement, sourceAndCodeElement);\n          detailsElement.style.opacity = '0.6';\n          detailsElement.style.paddingLeft = '6px';\n        }\n      }\n    }\n\n    if (isNonEmptyArray(relatedInformation)) {\n      var _loop_1 = function (message_1, resource, startLineNumber, startColumn) {\n        var relatedInfoContainer = dom.append(markerElement, $('div'));\n        relatedInfoContainer.style.marginTop = '8px';\n        var a = dom.append(relatedInfoContainer, $('a'));\n        a.innerText = basename(resource) + \"(\" + startLineNumber + \", \" + startColumn + \"): \";\n        a.style.cursor = 'pointer';\n\n        a.onclick = function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n\n          if (_this._openerService) {\n            _this._openerService.open(resource.with({\n              fragment: startLineNumber + \",\" + startColumn\n            }), {\n              fromUserGesture: true\n            }).catch(onUnexpectedError);\n          }\n        };\n\n        var messageElement_1 = dom.append(relatedInfoContainer, $('span'));\n        messageElement_1.innerText = message_1;\n\n        this_1._editor.applyFontInfo(messageElement_1);\n      };\n\n      var this_1 = this;\n\n      for (var _i = 0, relatedInformation_1 = relatedInformation; _i < relatedInformation_1.length; _i++) {\n        var _b = relatedInformation_1[_i],\n            message_1 = _b.message,\n            resource = _b.resource,\n            startLineNumber = _b.startLineNumber,\n            startColumn = _b.startColumn;\n\n        _loop_1(message_1, resource, startLineNumber, startColumn);\n      }\n    }\n\n    return hoverElement;\n  };\n\n  ModesContentHoverWidget.prototype.renderMarkerStatusbar = function (markerHover) {\n    var _this = this;\n\n    var hoverElement = $('div.hover-row.status-bar');\n    var disposables = new DisposableStore();\n    var actionsElement = dom.append(hoverElement, $('div.actions'));\n\n    if (markerHover.marker.severity === MarkerSeverity.Error || markerHover.marker.severity === MarkerSeverity.Warning || markerHover.marker.severity === MarkerSeverity.Info) {\n      disposables.add(this.renderAction(actionsElement, {\n        label: nls.localize('peek problem', \"Peek Problem\"),\n        commandId: NextMarkerAction.ID,\n        run: function () {\n          _this.hide();\n\n          MarkerController.get(_this._editor).show(markerHover.marker);\n\n          _this._editor.focus();\n        }\n      }));\n    }\n\n    var quickfixPlaceholderElement = dom.append(actionsElement, $('div'));\n    quickfixPlaceholderElement.style.opacity = '0';\n    quickfixPlaceholderElement.style.transition = 'opacity 0.2s';\n    setTimeout(function () {\n      return quickfixPlaceholderElement.style.opacity = '1';\n    }, 200);\n    quickfixPlaceholderElement.textContent = nls.localize('checkingForQuickFixes', \"Checking for quick fixes...\");\n    disposables.add(toDisposable(function () {\n      return quickfixPlaceholderElement.remove();\n    }));\n    var codeActionsPromise = this.getCodeActions(markerHover.marker);\n    disposables.add(toDisposable(function () {\n      return codeActionsPromise.cancel();\n    }));\n    codeActionsPromise.then(function (actions) {\n      quickfixPlaceholderElement.style.transition = '';\n      quickfixPlaceholderElement.style.opacity = '1';\n\n      if (!actions.validActions.length) {\n        actions.dispose();\n        quickfixPlaceholderElement.textContent = nls.localize('noQuickFixes', \"No quick fixes available\");\n        return;\n      }\n\n      quickfixPlaceholderElement.remove();\n      var showing = false;\n      disposables.add(toDisposable(function () {\n        if (!showing) {\n          actions.dispose();\n        }\n      }));\n      disposables.add(_this.renderAction(actionsElement, {\n        label: nls.localize('quick fixes', \"Quick Fix...\"),\n        commandId: QuickFixAction.Id,\n        run: function (target) {\n          showing = true;\n          var controller = QuickFixController.get(_this._editor);\n          var elementPosition = dom.getDomNodePagePosition(target);\n          controller.showCodeActions(markerCodeActionTrigger, actions, {\n            x: elementPosition.left + 6,\n            y: elementPosition.top + elementPosition.height + 6\n          });\n        }\n      }));\n    });\n    this.renderDisposable.value = disposables;\n    return hoverElement;\n  };\n\n  ModesContentHoverWidget.prototype.getCodeActions = function (marker) {\n    var _this = this;\n\n    return createCancelablePromise(function (cancellationToken) {\n      return getCodeActions(_this._editor.getModel(), new Range(marker.startLineNumber, marker.startColumn, marker.endLineNumber, marker.endColumn), markerCodeActionTrigger, cancellationToken);\n    });\n  };\n\n  ModesContentHoverWidget.prototype.renderAction = function (parent, actionOptions) {\n    var actionContainer = dom.append(parent, $('div.action-container'));\n    var action = dom.append(actionContainer, $('a.action'));\n\n    if (actionOptions.iconClass) {\n      dom.append(action, $(\"span.icon.\" + actionOptions.iconClass));\n    }\n\n    var label = dom.append(action, $('span'));\n    label.textContent = actionOptions.label;\n\n    var keybinding = this._keybindingService.lookupKeybinding(actionOptions.commandId);\n\n    if (keybinding) {\n      label.title = actionOptions.label + \" (\" + keybinding.getLabel() + \")\";\n    }\n\n    return dom.addDisposableListener(actionContainer, dom.EventType.CLICK, function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      actionOptions.run(actionContainer);\n    });\n  };\n\n  ModesContentHoverWidget.ID = 'editor.contrib.modesContentHoverWidget';\n  ModesContentHoverWidget._DECORATION_OPTIONS = ModelDecorationOptions.register({\n    className: 'hoverHighlight'\n  });\n  return ModesContentHoverWidget;\n}(ContentHoverWidget);\n\nexport { ModesContentHoverWidget };\n\nfunction hoverContentsEquals(first, second) {\n  if (!first && second || first && !second || first.length !== second.length) {\n    return false;\n  }\n\n  for (var i = 0; i < first.length; i++) {\n    var firstElement = first[i];\n    var secondElement = second[i];\n\n    if (firstElement instanceof MarkerHover && secondElement instanceof MarkerHover) {\n      return IMarkerData.makeKey(firstElement.marker) === IMarkerData.makeKey(secondElement.marker);\n    }\n\n    if (firstElement instanceof ColorHover || secondElement instanceof ColorHover) {\n      return false;\n    }\n\n    if (firstElement instanceof MarkerHover || secondElement instanceof MarkerHover) {\n      return false;\n    }\n\n    if (!markedStringsEquals(firstElement.contents, secondElement.contents)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nregisterThemingParticipant(function (theme, collector) {\n  var linkFg = theme.getColor(textLinkForeground);\n\n  if (linkFg) {\n    collector.addRule(\".monaco-editor-hover .hover-contents a.code-link span:hover { color: \" + linkFg + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/hover/modesContentHover.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","nls","dom","CancellationToken","Color","RGBA","MarkdownString","isEmptyMarkdownString","markedStringsEquals","toDisposable","DisposableStore","combinedDisposable","MutableDisposable","Position","Range","ModelDecorationOptions","HoverProviderRegistry","TokenizationRegistry","getColorPresentations","ColorDetector","ColorPickerModel","ColorPickerWidget","getHover","HoverOperation","ContentHoverWidget","MarkdownRenderer","registerThemingParticipant","coalesce","isNonEmptyArray","asArray","IMarkerData","MarkerSeverity","basename","onUnexpectedError","NullOpenerService","MarkerController","NextMarkerAction","createCancelablePromise","getCodeActions","QuickFixAction","QuickFixController","CodeActionKind","textLinkForeground","$","ColorHover","range","color","provider","MarkerHover","marker","ModesContentComputer","editor","_markerDecorationsService","_editor","_result","setRange","_range","clearResult","computeAsync","token","hasModel","Promise","resolve","model","getModel","has","startLineNumber","startColumn","computeSync","_this","lineNumber","getLineCount","colorDetector","get","maxColumn","getLineMaxColumn","lineDecorations","getLineDecorations","didFindColor","hoverRange","result","map","endColumn","endLineNumber","getMarker","colorData","getColorData","getStartPosition","_a","colorInfo","range_1","options","hoverMessage","contents","onResult","isFromSynchronousComputation","concat","sort","getResult","slice","getResultWithLoadingMessage","_getLoadingMessage","appendText","localize","markerCodeActionTrigger","type","filter","include","QuickFix","ModesContentHoverWidget","_super","markerDecorationsService","_themeService","_keybindingService","_modeService","_openerService","call","ID","renderDisposable","_register","_messages","_lastRange","_computer","_highlightDecorations","_isChangingDecorations","_shouldFocus","_colorPicker","_hoverOperation","_withResult","getOption","delay","addStandardDisposableListener","getDomNode","EventType","FOCUS","addClass","BLUR","removeClass","onDidChangeConfiguration","e","setHoverTime","onDidChange","isVisible","_domNode","textContent","_renderMessages","dispose","cancel","onModelDecorationsChanged","start","startShowingAt","mode","focus","equalsRange","_showAtPosition","hide","filteredMessages","len","msg","rng","push","hoverContentsEquals","deltaDecorations","clear","isColorPickerVisible","complete","renderRange","messages","renderColumn","highlightRange","lift","fragment","document","createDocumentFragment","isEmptyHoverContent","containColorPicker","markdownDisposeables","markerMessages","forEach","Math","min","plusRange","red","green","blue","alpha","rgba","round","color_1","editorModel_1","range_2","model_1","widget_1","None","then","colorPresentations","originalText","getValueInRange","guessColorPresentation","updateEditorModel","textEdits","newRange","presentation","textEdit","setEndPosition","text","identifier","label","forceMoveMarkers","pushUndoStop","executeEdits","additionalTextEdits","updateColorPresentations","g","colorListener","onColorFlushed","colorChangeListener","onDidChangeColor","showAt","updateContents","layout","value","markdownHoverElement","hoverContentsElement","append","renderer","add","onDidRenderCodeBlock","className","onContentsChange","renderedContents","render","appendChild","element","renderMarkerHover","markerHoverForStatusbar","compare","severity","renderMarkerStatusbar","_DECORATION_OPTIONS","markerHover","hoverElement","markerElement","source","message","code","relatedInformation","applyFontInfo","messageElement","style","whiteSpace","innerText","detailsElement","opacity","paddingLeft","sourceAndCodeElement","sourceElement","_codeLink","setAttribute","link","toString","onclick","open","preventDefault","stopPropagation","codeElement","_loop_1","message_1","resource","relatedInfoContainer","marginTop","cursor","with","fromUserGesture","catch","messageElement_1","this_1","_i","relatedInformation_1","_b","disposables","actionsElement","Error","Warning","Info","renderAction","commandId","run","show","quickfixPlaceholderElement","transition","setTimeout","remove","codeActionsPromise","actions","validActions","showing","Id","target","controller","elementPosition","getDomNodePagePosition","showCodeActions","x","left","y","top","height","cancellationToken","parent","actionOptions","actionContainer","action","iconClass","keybinding","lookupKeybinding","title","getLabel","addDisposableListener","CLICK","register","first","second","firstElement","secondElement","makeKey","theme","collector","linkFg","getColor","addRule"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport * as nls from '../../../nls.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { Color, RGBA } from '../../../base/common/color.js';\r\nimport { MarkdownString, isEmptyMarkdownString, markedStringsEquals } from '../../../base/common/htmlContent.js';\r\nimport { toDisposable, DisposableStore, combinedDisposable, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { HoverProviderRegistry, TokenizationRegistry } from '../../common/modes.js';\r\nimport { getColorPresentations } from '../colorPicker/color.js';\r\nimport { ColorDetector } from '../colorPicker/colorDetector.js';\r\nimport { ColorPickerModel } from '../colorPicker/colorPickerModel.js';\r\nimport { ColorPickerWidget } from '../colorPicker/colorPickerWidget.js';\r\nimport { getHover } from './getHover.js';\r\nimport { HoverOperation } from './hoverOperation.js';\r\nimport { ContentHoverWidget } from './hoverWidgets.js';\r\nimport { MarkdownRenderer } from '../markdown/markdownRenderer.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { coalesce, isNonEmptyArray, asArray } from '../../../base/common/arrays.js';\r\nimport { IMarkerData, MarkerSeverity } from '../../../platform/markers/common/markers.js';\r\nimport { basename } from '../../../base/common/resources.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { NullOpenerService } from '../../../platform/opener/common/opener.js';\r\nimport { MarkerController, NextMarkerAction } from '../gotoError/gotoError.js';\r\nimport { createCancelablePromise } from '../../../base/common/async.js';\r\nimport { getCodeActions } from '../codeAction/codeAction.js';\r\nimport { QuickFixAction, QuickFixController } from '../codeAction/codeActionCommands.js';\r\nimport { CodeActionKind } from '../codeAction/types.js';\r\nimport { textLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nvar $ = dom.$;\r\nvar ColorHover = /** @class */ (function () {\r\n    function ColorHover(range, color, provider) {\r\n        this.range = range;\r\n        this.color = color;\r\n        this.provider = provider;\r\n    }\r\n    return ColorHover;\r\n}());\r\nvar MarkerHover = /** @class */ (function () {\r\n    function MarkerHover(range, marker) {\r\n        this.range = range;\r\n        this.marker = marker;\r\n    }\r\n    return MarkerHover;\r\n}());\r\nvar ModesContentComputer = /** @class */ (function () {\r\n    function ModesContentComputer(editor, _markerDecorationsService) {\r\n        this._markerDecorationsService = _markerDecorationsService;\r\n        this._editor = editor;\r\n        this._result = [];\r\n    }\r\n    ModesContentComputer.prototype.setRange = function (range) {\r\n        this._range = range;\r\n        this._result = [];\r\n    };\r\n    ModesContentComputer.prototype.clearResult = function () {\r\n        this._result = [];\r\n    };\r\n    ModesContentComputer.prototype.computeAsync = function (token) {\r\n        if (!this._editor.hasModel() || !this._range) {\r\n            return Promise.resolve([]);\r\n        }\r\n        var model = this._editor.getModel();\r\n        if (!HoverProviderRegistry.has(model)) {\r\n            return Promise.resolve([]);\r\n        }\r\n        return getHover(model, new Position(this._range.startLineNumber, this._range.startColumn), token);\r\n    };\r\n    ModesContentComputer.prototype.computeSync = function () {\r\n        var _this = this;\r\n        if (!this._editor.hasModel() || !this._range) {\r\n            return [];\r\n        }\r\n        var model = this._editor.getModel();\r\n        var lineNumber = this._range.startLineNumber;\r\n        if (lineNumber > this._editor.getModel().getLineCount()) {\r\n            // Illegal line number => no results\r\n            return [];\r\n        }\r\n        var colorDetector = ColorDetector.get(this._editor);\r\n        var maxColumn = model.getLineMaxColumn(lineNumber);\r\n        var lineDecorations = this._editor.getLineDecorations(lineNumber);\r\n        var didFindColor = false;\r\n        var hoverRange = this._range;\r\n        var result = lineDecorations.map(function (d) {\r\n            var startColumn = (d.range.startLineNumber === lineNumber) ? d.range.startColumn : 1;\r\n            var endColumn = (d.range.endLineNumber === lineNumber) ? d.range.endColumn : maxColumn;\r\n            if (startColumn > hoverRange.startColumn || hoverRange.endColumn > endColumn) {\r\n                return null;\r\n            }\r\n            var range = new Range(hoverRange.startLineNumber, startColumn, hoverRange.startLineNumber, endColumn);\r\n            var marker = _this._markerDecorationsService.getMarker(model, d);\r\n            if (marker) {\r\n                return new MarkerHover(range, marker);\r\n            }\r\n            var colorData = colorDetector.getColorData(d.range.getStartPosition());\r\n            if (!didFindColor && colorData) {\r\n                didFindColor = true;\r\n                var _a = colorData.colorInfo, color = _a.color, range_1 = _a.range;\r\n                return new ColorHover(range_1, color, colorData.provider);\r\n            }\r\n            else {\r\n                if (isEmptyMarkdownString(d.options.hoverMessage)) {\r\n                    return null;\r\n                }\r\n                var contents = d.options.hoverMessage ? asArray(d.options.hoverMessage) : [];\r\n                return { contents: contents, range: range };\r\n            }\r\n        });\r\n        return coalesce(result);\r\n    };\r\n    ModesContentComputer.prototype.onResult = function (result, isFromSynchronousComputation) {\r\n        // Always put synchronous messages before asynchronous ones\r\n        if (isFromSynchronousComputation) {\r\n            this._result = result.concat(this._result.sort(function (a, b) {\r\n                if (a instanceof ColorHover) { // sort picker messages at to the top\r\n                    return -1;\r\n                }\r\n                else if (b instanceof ColorHover) {\r\n                    return 1;\r\n                }\r\n                return 0;\r\n            }));\r\n        }\r\n        else {\r\n            this._result = this._result.concat(result);\r\n        }\r\n    };\r\n    ModesContentComputer.prototype.getResult = function () {\r\n        return this._result.slice(0);\r\n    };\r\n    ModesContentComputer.prototype.getResultWithLoadingMessage = function () {\r\n        return this._result.slice(0).concat([this._getLoadingMessage()]);\r\n    };\r\n    ModesContentComputer.prototype._getLoadingMessage = function () {\r\n        return {\r\n            range: this._range,\r\n            contents: [new MarkdownString().appendText(nls.localize('modesContentHover.loading', \"Loading...\"))]\r\n        };\r\n    };\r\n    return ModesContentComputer;\r\n}());\r\nvar markerCodeActionTrigger = {\r\n    type: 2 /* Manual */,\r\n    filter: { include: CodeActionKind.QuickFix }\r\n};\r\nvar ModesContentHoverWidget = /** @class */ (function (_super) {\r\n    __extends(ModesContentHoverWidget, _super);\r\n    function ModesContentHoverWidget(editor, markerDecorationsService, _themeService, _keybindingService, _modeService, _openerService) {\r\n        if (_openerService === void 0) { _openerService = NullOpenerService; }\r\n        var _this = _super.call(this, ModesContentHoverWidget.ID, editor) || this;\r\n        _this._themeService = _themeService;\r\n        _this._keybindingService = _keybindingService;\r\n        _this._modeService = _modeService;\r\n        _this._openerService = _openerService;\r\n        _this.renderDisposable = _this._register(new MutableDisposable());\r\n        _this._messages = [];\r\n        _this._lastRange = null;\r\n        _this._computer = new ModesContentComputer(_this._editor, markerDecorationsService);\r\n        _this._highlightDecorations = [];\r\n        _this._isChangingDecorations = false;\r\n        _this._shouldFocus = false;\r\n        _this._colorPicker = null;\r\n        _this._hoverOperation = new HoverOperation(_this._computer, function (result) { return _this._withResult(result, true); }, null, function (result) { return _this._withResult(result, false); }, _this._editor.getOption(44 /* hover */).delay);\r\n        _this._register(dom.addStandardDisposableListener(_this.getDomNode(), dom.EventType.FOCUS, function () {\r\n            if (_this._colorPicker) {\r\n                dom.addClass(_this.getDomNode(), 'colorpicker-hover');\r\n            }\r\n        }));\r\n        _this._register(dom.addStandardDisposableListener(_this.getDomNode(), dom.EventType.BLUR, function () {\r\n            dom.removeClass(_this.getDomNode(), 'colorpicker-hover');\r\n        }));\r\n        _this._register(editor.onDidChangeConfiguration(function (e) {\r\n            _this._hoverOperation.setHoverTime(_this._editor.getOption(44 /* hover */).delay);\r\n        }));\r\n        _this._register(TokenizationRegistry.onDidChange(function (e) {\r\n            if (_this.isVisible && _this._lastRange && _this._messages.length > 0) {\r\n                _this._domNode.textContent = '';\r\n                _this._renderMessages(_this._lastRange, _this._messages);\r\n            }\r\n        }));\r\n        return _this;\r\n    }\r\n    ModesContentHoverWidget.prototype.dispose = function () {\r\n        this._hoverOperation.cancel();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ModesContentHoverWidget.prototype.onModelDecorationsChanged = function () {\r\n        if (this._isChangingDecorations) {\r\n            return;\r\n        }\r\n        if (this.isVisible) {\r\n            // The decorations have changed and the hover is visible,\r\n            // we need to recompute the displayed text\r\n            this._hoverOperation.cancel();\r\n            this._computer.clearResult();\r\n            if (!this._colorPicker) { // TODO@Michel ensure that displayed text for other decorations is computed even if color picker is in place\r\n                this._hoverOperation.start(0 /* Delayed */);\r\n            }\r\n        }\r\n    };\r\n    ModesContentHoverWidget.prototype.startShowingAt = function (range, mode, focus) {\r\n        if (this._lastRange && this._lastRange.equalsRange(range)) {\r\n            // We have to show the widget at the exact same range as before, so no work is needed\r\n            return;\r\n        }\r\n        this._hoverOperation.cancel();\r\n        if (this.isVisible) {\r\n            // The range might have changed, but the hover is visible\r\n            // Instead of hiding it completely, filter out messages that are still in the new range and\r\n            // kick off a new computation\r\n            if (!this._showAtPosition || this._showAtPosition.lineNumber !== range.startLineNumber) {\r\n                this.hide();\r\n            }\r\n            else {\r\n                var filteredMessages = [];\r\n                for (var i = 0, len = this._messages.length; i < len; i++) {\r\n                    var msg = this._messages[i];\r\n                    var rng = msg.range;\r\n                    if (rng && rng.startColumn <= range.startColumn && rng.endColumn >= range.endColumn) {\r\n                        filteredMessages.push(msg);\r\n                    }\r\n                }\r\n                if (filteredMessages.length > 0) {\r\n                    if (hoverContentsEquals(filteredMessages, this._messages)) {\r\n                        return;\r\n                    }\r\n                    this._renderMessages(range, filteredMessages);\r\n                }\r\n                else {\r\n                    this.hide();\r\n                }\r\n            }\r\n        }\r\n        this._lastRange = range;\r\n        this._computer.setRange(range);\r\n        this._shouldFocus = focus;\r\n        this._hoverOperation.start(mode);\r\n    };\r\n    ModesContentHoverWidget.prototype.hide = function () {\r\n        this._lastRange = null;\r\n        this._hoverOperation.cancel();\r\n        _super.prototype.hide.call(this);\r\n        this._isChangingDecorations = true;\r\n        this._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, []);\r\n        this._isChangingDecorations = false;\r\n        this.renderDisposable.clear();\r\n        this._colorPicker = null;\r\n    };\r\n    ModesContentHoverWidget.prototype.isColorPickerVisible = function () {\r\n        if (this._colorPicker) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    ModesContentHoverWidget.prototype._withResult = function (result, complete) {\r\n        this._messages = result;\r\n        if (this._lastRange && this._messages.length > 0) {\r\n            this._renderMessages(this._lastRange, this._messages);\r\n        }\r\n        else if (complete) {\r\n            this.hide();\r\n        }\r\n    };\r\n    ModesContentHoverWidget.prototype._renderMessages = function (renderRange, messages) {\r\n        var _this = this;\r\n        this.renderDisposable.dispose();\r\n        this._colorPicker = null;\r\n        // update column from which to show\r\n        var renderColumn = 1073741824 /* MAX_SAFE_SMALL_INTEGER */;\r\n        var highlightRange = messages[0].range ? Range.lift(messages[0].range) : null;\r\n        var fragment = document.createDocumentFragment();\r\n        var isEmptyHoverContent = true;\r\n        var containColorPicker = false;\r\n        var markdownDisposeables = new DisposableStore();\r\n        var markerMessages = [];\r\n        messages.forEach(function (msg) {\r\n            if (!msg.range) {\r\n                return;\r\n            }\r\n            renderColumn = Math.min(renderColumn, msg.range.startColumn);\r\n            highlightRange = highlightRange ? Range.plusRange(highlightRange, msg.range) : Range.lift(msg.range);\r\n            if (msg instanceof ColorHover) {\r\n                containColorPicker = true;\r\n                var _a = msg.color, red = _a.red, green = _a.green, blue = _a.blue, alpha = _a.alpha;\r\n                var rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\r\n                var color_1 = new Color(rgba);\r\n                if (!_this._editor.hasModel()) {\r\n                    return;\r\n                }\r\n                var editorModel_1 = _this._editor.getModel();\r\n                var range_2 = new Range(msg.range.startLineNumber, msg.range.startColumn, msg.range.endLineNumber, msg.range.endColumn);\r\n                var colorInfo = { range: msg.range, color: msg.color };\r\n                // create blank olor picker model and widget first to ensure it's positioned correctly.\r\n                var model_1 = new ColorPickerModel(color_1, [], 0);\r\n                var widget_1 = new ColorPickerWidget(fragment, model_1, _this._editor.getOption(105 /* pixelRatio */), _this._themeService);\r\n                getColorPresentations(editorModel_1, colorInfo, msg.provider, CancellationToken.None).then(function (colorPresentations) {\r\n                    model_1.colorPresentations = colorPresentations || [];\r\n                    if (!_this._editor.hasModel()) {\r\n                        // gone...\r\n                        return;\r\n                    }\r\n                    var originalText = _this._editor.getModel().getValueInRange(msg.range);\r\n                    model_1.guessColorPresentation(color_1, originalText);\r\n                    var updateEditorModel = function () {\r\n                        var textEdits;\r\n                        var newRange;\r\n                        if (model_1.presentation.textEdit) {\r\n                            textEdits = [model_1.presentation.textEdit];\r\n                            newRange = new Range(model_1.presentation.textEdit.range.startLineNumber, model_1.presentation.textEdit.range.startColumn, model_1.presentation.textEdit.range.endLineNumber, model_1.presentation.textEdit.range.endColumn);\r\n                            newRange = newRange.setEndPosition(newRange.endLineNumber, newRange.startColumn + model_1.presentation.textEdit.text.length);\r\n                        }\r\n                        else {\r\n                            textEdits = [{ identifier: null, range: range_2, text: model_1.presentation.label, forceMoveMarkers: false }];\r\n                            newRange = range_2.setEndPosition(range_2.endLineNumber, range_2.startColumn + model_1.presentation.label.length);\r\n                        }\r\n                        _this._editor.pushUndoStop();\r\n                        _this._editor.executeEdits('colorpicker', textEdits);\r\n                        if (model_1.presentation.additionalTextEdits) {\r\n                            textEdits = __spreadArrays(model_1.presentation.additionalTextEdits);\r\n                            _this._editor.executeEdits('colorpicker', textEdits);\r\n                            _this.hide();\r\n                        }\r\n                        _this._editor.pushUndoStop();\r\n                        range_2 = newRange;\r\n                    };\r\n                    var updateColorPresentations = function (color) {\r\n                        return getColorPresentations(editorModel_1, {\r\n                            range: range_2,\r\n                            color: {\r\n                                red: color.rgba.r / 255,\r\n                                green: color.rgba.g / 255,\r\n                                blue: color.rgba.b / 255,\r\n                                alpha: color.rgba.a\r\n                            }\r\n                        }, msg.provider, CancellationToken.None).then(function (colorPresentations) {\r\n                            model_1.colorPresentations = colorPresentations || [];\r\n                        });\r\n                    };\r\n                    var colorListener = model_1.onColorFlushed(function (color) {\r\n                        updateColorPresentations(color).then(updateEditorModel);\r\n                    });\r\n                    var colorChangeListener = model_1.onDidChangeColor(updateColorPresentations);\r\n                    _this._colorPicker = widget_1;\r\n                    _this.showAt(range_2.getStartPosition(), range_2, _this._shouldFocus);\r\n                    _this.updateContents(fragment);\r\n                    _this._colorPicker.layout();\r\n                    _this.renderDisposable.value = combinedDisposable(colorListener, colorChangeListener, widget_1, markdownDisposeables);\r\n                });\r\n            }\r\n            else {\r\n                if (msg instanceof MarkerHover) {\r\n                    markerMessages.push(msg);\r\n                    isEmptyHoverContent = false;\r\n                }\r\n                else {\r\n                    msg.contents\r\n                        .filter(function (contents) { return !isEmptyMarkdownString(contents); })\r\n                        .forEach(function (contents) {\r\n                        var markdownHoverElement = $('div.hover-row.markdown-hover');\r\n                        var hoverContentsElement = dom.append(markdownHoverElement, $('div.hover-contents'));\r\n                        var renderer = markdownDisposeables.add(new MarkdownRenderer(_this._editor, _this._modeService, _this._openerService));\r\n                        markdownDisposeables.add(renderer.onDidRenderCodeBlock(function () {\r\n                            hoverContentsElement.className = 'hover-contents code-hover-contents';\r\n                            _this.onContentsChange();\r\n                        }));\r\n                        var renderedContents = markdownDisposeables.add(renderer.render(contents));\r\n                        hoverContentsElement.appendChild(renderedContents.element);\r\n                        fragment.appendChild(markdownHoverElement);\r\n                        isEmptyHoverContent = false;\r\n                    });\r\n                }\r\n            }\r\n        });\r\n        if (markerMessages.length) {\r\n            markerMessages.forEach(function (msg) { return fragment.appendChild(_this.renderMarkerHover(msg)); });\r\n            var markerHoverForStatusbar = markerMessages.length === 1 ? markerMessages[0] : markerMessages.sort(function (a, b) { return MarkerSeverity.compare(a.marker.severity, b.marker.severity); })[0];\r\n            fragment.appendChild(this.renderMarkerStatusbar(markerHoverForStatusbar));\r\n        }\r\n        // show\r\n        if (!containColorPicker && !isEmptyHoverContent) {\r\n            this.showAt(new Position(renderRange.startLineNumber, renderColumn), highlightRange, this._shouldFocus);\r\n            this.updateContents(fragment);\r\n        }\r\n        this._isChangingDecorations = true;\r\n        this._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, highlightRange ? [{\r\n                range: highlightRange,\r\n                options: ModesContentHoverWidget._DECORATION_OPTIONS\r\n            }] : []);\r\n        this._isChangingDecorations = false;\r\n    };\r\n    ModesContentHoverWidget.prototype.renderMarkerHover = function (markerHover) {\r\n        var _this = this;\r\n        var hoverElement = $('div.hover-row');\r\n        var markerElement = dom.append(hoverElement, $('div.marker.hover-contents'));\r\n        var _a = markerHover.marker, source = _a.source, message = _a.message, code = _a.code, relatedInformation = _a.relatedInformation;\r\n        this._editor.applyFontInfo(markerElement);\r\n        var messageElement = dom.append(markerElement, $('span'));\r\n        messageElement.style.whiteSpace = 'pre-wrap';\r\n        messageElement.innerText = message;\r\n        if (source || code) {\r\n            if (typeof code === 'string') {\r\n                var detailsElement = dom.append(markerElement, $('span'));\r\n                detailsElement.style.opacity = '0.6';\r\n                detailsElement.style.paddingLeft = '6px';\r\n                detailsElement.innerText = source && code ? source + \"(\" + code + \")\" : source ? source : \"(\" + code + \")\";\r\n            }\r\n            else {\r\n                if (code) {\r\n                    var sourceAndCodeElement = $('span');\r\n                    if (source) {\r\n                        var sourceElement = dom.append(sourceAndCodeElement, $('span'));\r\n                        sourceElement.innerText = source;\r\n                    }\r\n                    this._codeLink = dom.append(sourceAndCodeElement, $('a.code-link'));\r\n                    this._codeLink.setAttribute('href', code.link.toString());\r\n                    this._codeLink.onclick = function (e) {\r\n                        _this._openerService.open(code.link);\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                    };\r\n                    var codeElement = dom.append(this._codeLink, $('span'));\r\n                    codeElement.innerText = code.value;\r\n                    var detailsElement = dom.append(markerElement, sourceAndCodeElement);\r\n                    detailsElement.style.opacity = '0.6';\r\n                    detailsElement.style.paddingLeft = '6px';\r\n                }\r\n            }\r\n        }\r\n        if (isNonEmptyArray(relatedInformation)) {\r\n            var _loop_1 = function (message_1, resource, startLineNumber, startColumn) {\r\n                var relatedInfoContainer = dom.append(markerElement, $('div'));\r\n                relatedInfoContainer.style.marginTop = '8px';\r\n                var a = dom.append(relatedInfoContainer, $('a'));\r\n                a.innerText = basename(resource) + \"(\" + startLineNumber + \", \" + startColumn + \"): \";\r\n                a.style.cursor = 'pointer';\r\n                a.onclick = function (e) {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                    if (_this._openerService) {\r\n                        _this._openerService.open(resource.with({ fragment: startLineNumber + \",\" + startColumn }), { fromUserGesture: true }).catch(onUnexpectedError);\r\n                    }\r\n                };\r\n                var messageElement_1 = dom.append(relatedInfoContainer, $('span'));\r\n                messageElement_1.innerText = message_1;\r\n                this_1._editor.applyFontInfo(messageElement_1);\r\n            };\r\n            var this_1 = this;\r\n            for (var _i = 0, relatedInformation_1 = relatedInformation; _i < relatedInformation_1.length; _i++) {\r\n                var _b = relatedInformation_1[_i], message_1 = _b.message, resource = _b.resource, startLineNumber = _b.startLineNumber, startColumn = _b.startColumn;\r\n                _loop_1(message_1, resource, startLineNumber, startColumn);\r\n            }\r\n        }\r\n        return hoverElement;\r\n    };\r\n    ModesContentHoverWidget.prototype.renderMarkerStatusbar = function (markerHover) {\r\n        var _this = this;\r\n        var hoverElement = $('div.hover-row.status-bar');\r\n        var disposables = new DisposableStore();\r\n        var actionsElement = dom.append(hoverElement, $('div.actions'));\r\n        if (markerHover.marker.severity === MarkerSeverity.Error || markerHover.marker.severity === MarkerSeverity.Warning || markerHover.marker.severity === MarkerSeverity.Info) {\r\n            disposables.add(this.renderAction(actionsElement, {\r\n                label: nls.localize('peek problem', \"Peek Problem\"),\r\n                commandId: NextMarkerAction.ID,\r\n                run: function () {\r\n                    _this.hide();\r\n                    MarkerController.get(_this._editor).show(markerHover.marker);\r\n                    _this._editor.focus();\r\n                }\r\n            }));\r\n        }\r\n        var quickfixPlaceholderElement = dom.append(actionsElement, $('div'));\r\n        quickfixPlaceholderElement.style.opacity = '0';\r\n        quickfixPlaceholderElement.style.transition = 'opacity 0.2s';\r\n        setTimeout(function () { return quickfixPlaceholderElement.style.opacity = '1'; }, 200);\r\n        quickfixPlaceholderElement.textContent = nls.localize('checkingForQuickFixes', \"Checking for quick fixes...\");\r\n        disposables.add(toDisposable(function () { return quickfixPlaceholderElement.remove(); }));\r\n        var codeActionsPromise = this.getCodeActions(markerHover.marker);\r\n        disposables.add(toDisposable(function () { return codeActionsPromise.cancel(); }));\r\n        codeActionsPromise.then(function (actions) {\r\n            quickfixPlaceholderElement.style.transition = '';\r\n            quickfixPlaceholderElement.style.opacity = '1';\r\n            if (!actions.validActions.length) {\r\n                actions.dispose();\r\n                quickfixPlaceholderElement.textContent = nls.localize('noQuickFixes', \"No quick fixes available\");\r\n                return;\r\n            }\r\n            quickfixPlaceholderElement.remove();\r\n            var showing = false;\r\n            disposables.add(toDisposable(function () {\r\n                if (!showing) {\r\n                    actions.dispose();\r\n                }\r\n            }));\r\n            disposables.add(_this.renderAction(actionsElement, {\r\n                label: nls.localize('quick fixes', \"Quick Fix...\"),\r\n                commandId: QuickFixAction.Id,\r\n                run: function (target) {\r\n                    showing = true;\r\n                    var controller = QuickFixController.get(_this._editor);\r\n                    var elementPosition = dom.getDomNodePagePosition(target);\r\n                    controller.showCodeActions(markerCodeActionTrigger, actions, {\r\n                        x: elementPosition.left + 6,\r\n                        y: elementPosition.top + elementPosition.height + 6\r\n                    });\r\n                }\r\n            }));\r\n        });\r\n        this.renderDisposable.value = disposables;\r\n        return hoverElement;\r\n    };\r\n    ModesContentHoverWidget.prototype.getCodeActions = function (marker) {\r\n        var _this = this;\r\n        return createCancelablePromise(function (cancellationToken) {\r\n            return getCodeActions(_this._editor.getModel(), new Range(marker.startLineNumber, marker.startColumn, marker.endLineNumber, marker.endColumn), markerCodeActionTrigger, cancellationToken);\r\n        });\r\n    };\r\n    ModesContentHoverWidget.prototype.renderAction = function (parent, actionOptions) {\r\n        var actionContainer = dom.append(parent, $('div.action-container'));\r\n        var action = dom.append(actionContainer, $('a.action'));\r\n        if (actionOptions.iconClass) {\r\n            dom.append(action, $(\"span.icon.\" + actionOptions.iconClass));\r\n        }\r\n        var label = dom.append(action, $('span'));\r\n        label.textContent = actionOptions.label;\r\n        var keybinding = this._keybindingService.lookupKeybinding(actionOptions.commandId);\r\n        if (keybinding) {\r\n            label.title = actionOptions.label + \" (\" + keybinding.getLabel() + \")\";\r\n        }\r\n        return dom.addDisposableListener(actionContainer, dom.EventType.CLICK, function (e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            actionOptions.run(actionContainer);\r\n        });\r\n    };\r\n    ModesContentHoverWidget.ID = 'editor.contrib.modesContentHoverWidget';\r\n    ModesContentHoverWidget._DECORATION_OPTIONS = ModelDecorationOptions.register({\r\n        className: 'hoverHighlight'\r\n    });\r\n    return ModesContentHoverWidget;\r\n}(ContentHoverWidget));\r\nexport { ModesContentHoverWidget };\r\nfunction hoverContentsEquals(first, second) {\r\n    if ((!first && second) || (first && !second) || first.length !== second.length) {\r\n        return false;\r\n    }\r\n    for (var i = 0; i < first.length; i++) {\r\n        var firstElement = first[i];\r\n        var secondElement = second[i];\r\n        if (firstElement instanceof MarkerHover && secondElement instanceof MarkerHover) {\r\n            return IMarkerData.makeKey(firstElement.marker) === IMarkerData.makeKey(secondElement.marker);\r\n        }\r\n        if (firstElement instanceof ColorHover || secondElement instanceof ColorHover) {\r\n            return false;\r\n        }\r\n        if (firstElement instanceof MarkerHover || secondElement instanceof MarkerHover) {\r\n            return false;\r\n        }\r\n        if (!markedStringsEquals(firstElement.contents, secondElement.contents)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var linkFg = theme.getColor(textLinkForeground);\r\n    if (linkFg) {\r\n        collector.addRule(\".monaco-editor-hover .hover-contents a.code-link span:hover { color: \" + linkFg + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}