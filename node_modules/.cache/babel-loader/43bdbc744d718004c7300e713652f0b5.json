{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport './codelensWidget.css';\nimport * as dom from '../../../base/browser/dom.js';\nimport { renderCodicons } from '../../../base/common/codicons.js';\nimport { escape } from '../../../base/common/strings.js';\nimport { Range } from '../../common/core/range.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\nimport { editorCodeLensForeground } from '../../common/view/editorColorRegistry.js';\nimport { editorActiveLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\n\nvar CodeLensViewZone =\n/** @class */\nfunction () {\n  function CodeLensViewZone(afterLineNumber, onHeight) {\n    this.afterLineNumber = afterLineNumber;\n    this._onHeight = onHeight;\n    this.heightInLines = 1;\n    this.suppressMouseDown = true;\n    this.domNode = document.createElement('div');\n  }\n\n  CodeLensViewZone.prototype.onComputedHeight = function (height) {\n    if (this._lastHeight === undefined) {\n      this._lastHeight = height;\n    } else if (this._lastHeight !== height) {\n      this._lastHeight = height;\n\n      this._onHeight();\n    }\n  };\n\n  return CodeLensViewZone;\n}();\n\nvar CodeLensContentWidget =\n/** @class */\nfunction () {\n  function CodeLensContentWidget(editor, className, line) {\n    // Editor.IContentWidget.allowEditorOverflow\n    this.allowEditorOverflow = false;\n    this.suppressMouseDown = true;\n    this._commands = new Map();\n    this._isEmpty = true;\n    this._editor = editor;\n    this._id = \"codelens.widget-\" + CodeLensContentWidget._idPool++;\n    this.updatePosition(line);\n    this._domNode = document.createElement('span');\n    this._domNode.className = \"codelens-decoration \" + className;\n  }\n\n  CodeLensContentWidget.prototype.withCommands = function (lenses, animate) {\n    this._commands.clear();\n\n    var innerHtml = '';\n    var hasSymbol = false;\n\n    for (var i = 0; i < lenses.length; i++) {\n      var lens = lenses[i];\n\n      if (!lens) {\n        continue;\n      }\n\n      hasSymbol = true;\n\n      if (lens.command) {\n        var title = renderCodicons(escape(lens.command.title));\n\n        if (lens.command.id) {\n          innerHtml += \"<a id=\" + i + \">\" + title + \"</a>\";\n\n          this._commands.set(String(i), lens.command);\n        } else {\n          innerHtml += \"<span>\" + title + \"</span>\";\n        }\n\n        if (i + 1 < lenses.length) {\n          innerHtml += '<span>&#160;|&#160;</span>';\n        }\n      }\n    }\n\n    if (!hasSymbol) {\n      // symbols but no commands\n      this._domNode.innerHTML = '<span>no commands</span>';\n    } else {\n      // symbols and commands\n      if (!innerHtml) {\n        innerHtml = '&#160;';\n      }\n\n      this._domNode.innerHTML = innerHtml;\n\n      if (this._isEmpty && animate) {\n        dom.addClass(this._domNode, 'fadein');\n      }\n\n      this._isEmpty = false;\n    }\n  };\n\n  CodeLensContentWidget.prototype.getCommand = function (link) {\n    return link.parentElement === this._domNode ? this._commands.get(link.id) : undefined;\n  };\n\n  CodeLensContentWidget.prototype.getId = function () {\n    return this._id;\n  };\n\n  CodeLensContentWidget.prototype.getDomNode = function () {\n    return this._domNode;\n  };\n\n  CodeLensContentWidget.prototype.updatePosition = function (line) {\n    var column = this._editor.getModel().getLineFirstNonWhitespaceColumn(line);\n\n    this._widgetPosition = {\n      position: {\n        lineNumber: line,\n        column: column\n      },\n      preference: [1\n      /* ABOVE */\n      ]\n    };\n  };\n\n  CodeLensContentWidget.prototype.getPosition = function () {\n    return this._widgetPosition || null;\n  };\n\n  CodeLensContentWidget._idPool = 0;\n  return CodeLensContentWidget;\n}();\n\nvar CodeLensHelper =\n/** @class */\nfunction () {\n  function CodeLensHelper() {\n    this._removeDecorations = [];\n    this._addDecorations = [];\n    this._addDecorationsCallbacks = [];\n  }\n\n  CodeLensHelper.prototype.addDecoration = function (decoration, callback) {\n    this._addDecorations.push(decoration);\n\n    this._addDecorationsCallbacks.push(callback);\n  };\n\n  CodeLensHelper.prototype.removeDecoration = function (decorationId) {\n    this._removeDecorations.push(decorationId);\n  };\n\n  CodeLensHelper.prototype.commit = function (changeAccessor) {\n    var resultingDecorations = changeAccessor.deltaDecorations(this._removeDecorations, this._addDecorations);\n\n    for (var i = 0, len = resultingDecorations.length; i < len; i++) {\n      this._addDecorationsCallbacks[i](resultingDecorations[i]);\n    }\n  };\n\n  return CodeLensHelper;\n}();\n\nexport { CodeLensHelper };\n\nvar CodeLensWidget =\n/** @class */\nfunction () {\n  function CodeLensWidget(data, editor, className, helper, viewZoneChangeAccessor, updateCallback) {\n    var _this = this;\n\n    this._isDisposed = false;\n    this._editor = editor;\n    this._className = className;\n    this._data = data; // create combined range, track all ranges with decorations,\n    // check if there is already something to render\n\n    this._decorationIds = [];\n    var range;\n    var lenses = [];\n\n    this._data.forEach(function (codeLensData, i) {\n      if (codeLensData.symbol.command) {\n        lenses.push(codeLensData.symbol);\n      }\n\n      helper.addDecoration({\n        range: codeLensData.symbol.range,\n        options: ModelDecorationOptions.EMPTY\n      }, function (id) {\n        return _this._decorationIds[i] = id;\n      }); // the range contains all lenses on this line\n\n      if (!range) {\n        range = Range.lift(codeLensData.symbol.range);\n      } else {\n        range = Range.plusRange(range, codeLensData.symbol.range);\n      }\n    });\n\n    this._viewZone = new CodeLensViewZone(range.startLineNumber - 1, updateCallback);\n    this._viewZoneId = viewZoneChangeAccessor.addZone(this._viewZone);\n\n    if (lenses.length > 0) {\n      this._createContentWidgetIfNecessary();\n\n      this._contentWidget.withCommands(lenses, false);\n    }\n  }\n\n  CodeLensWidget.prototype._createContentWidgetIfNecessary = function () {\n    if (!this._contentWidget) {\n      this._contentWidget = new CodeLensContentWidget(this._editor, this._className, this._viewZone.afterLineNumber + 1);\n\n      this._editor.addContentWidget(this._contentWidget);\n    }\n  };\n\n  CodeLensWidget.prototype.dispose = function (helper, viewZoneChangeAccessor) {\n    this._decorationIds.forEach(helper.removeDecoration, helper);\n\n    this._decorationIds = [];\n\n    if (viewZoneChangeAccessor) {\n      viewZoneChangeAccessor.removeZone(this._viewZoneId);\n    }\n\n    if (this._contentWidget) {\n      this._editor.removeContentWidget(this._contentWidget);\n\n      this._contentWidget = undefined;\n    }\n\n    this._isDisposed = true;\n  };\n\n  CodeLensWidget.prototype.isDisposed = function () {\n    return this._isDisposed;\n  };\n\n  CodeLensWidget.prototype.isValid = function () {\n    var _this = this;\n\n    return this._decorationIds.some(function (id, i) {\n      var range = _this._editor.getModel().getDecorationRange(id);\n\n      var symbol = _this._data[i].symbol;\n      return !!(range && Range.isEmpty(symbol.range) === range.isEmpty());\n    });\n  };\n\n  CodeLensWidget.prototype.updateCodeLensSymbols = function (data, helper) {\n    var _this = this;\n\n    this._decorationIds.forEach(helper.removeDecoration, helper);\n\n    this._decorationIds = [];\n    this._data = data;\n\n    this._data.forEach(function (codeLensData, i) {\n      helper.addDecoration({\n        range: codeLensData.symbol.range,\n        options: ModelDecorationOptions.EMPTY\n      }, function (id) {\n        return _this._decorationIds[i] = id;\n      });\n    });\n  };\n\n  CodeLensWidget.prototype.computeIfNecessary = function (model) {\n    if (!this._viewZone.domNode.hasAttribute('monaco-visible-view-zone')) {\n      return null;\n    } // Read editor current state\n\n\n    for (var i = 0; i < this._decorationIds.length; i++) {\n      var range = model.getDecorationRange(this._decorationIds[i]);\n\n      if (range) {\n        this._data[i].symbol.range = range;\n      }\n    }\n\n    return this._data;\n  };\n\n  CodeLensWidget.prototype.updateCommands = function (symbols) {\n    this._createContentWidgetIfNecessary();\n\n    this._contentWidget.withCommands(symbols, true);\n\n    for (var i = 0; i < this._data.length; i++) {\n      var resolved = symbols[i];\n\n      if (resolved) {\n        var symbol = this._data[i].symbol;\n        symbol.command = resolved.command || symbol.command;\n      }\n    }\n  };\n\n  CodeLensWidget.prototype.getCommand = function (link) {\n    var _a;\n\n    return (_a = this._contentWidget) === null || _a === void 0 ? void 0 : _a.getCommand(link);\n  };\n\n  CodeLensWidget.prototype.getLineNumber = function () {\n    var range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\n\n    if (range) {\n      return range.startLineNumber;\n    }\n\n    return -1;\n  };\n\n  CodeLensWidget.prototype.update = function (viewZoneChangeAccessor) {\n    if (this.isValid()) {\n      var range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\n\n      if (range) {\n        this._viewZone.afterLineNumber = range.startLineNumber - 1;\n        viewZoneChangeAccessor.layoutZone(this._viewZoneId);\n\n        if (this._contentWidget) {\n          this._contentWidget.updatePosition(range.startLineNumber);\n\n          this._editor.layoutContentWidget(this._contentWidget);\n        }\n      }\n    }\n  };\n\n  return CodeLensWidget;\n}();\n\nexport { CodeLensWidget };\nregisterThemingParticipant(function (theme, collector) {\n  var codeLensForeground = theme.getColor(editorCodeLensForeground);\n\n  if (codeLensForeground) {\n    collector.addRule(\".monaco-editor .codelens-decoration { color: \" + codeLensForeground + \"; }\");\n    collector.addRule(\".monaco-editor .codelens-decoration .codicon { color: \" + codeLensForeground + \"; }\");\n  }\n\n  var activeLinkForeground = theme.getColor(editorActiveLinkForeground);\n\n  if (activeLinkForeground) {\n    collector.addRule(\".monaco-editor .codelens-decoration > a:hover { color: \" + activeLinkForeground + \" !important; }\");\n    collector.addRule(\".monaco-editor .codelens-decoration > a:hover .codicon { color: \" + activeLinkForeground + \" !important; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/codelens/codelensWidget.js"],"names":["dom","renderCodicons","escape","Range","ModelDecorationOptions","editorCodeLensForeground","editorActiveLinkForeground","registerThemingParticipant","CodeLensViewZone","afterLineNumber","onHeight","_onHeight","heightInLines","suppressMouseDown","domNode","document","createElement","prototype","onComputedHeight","height","_lastHeight","undefined","CodeLensContentWidget","editor","className","line","allowEditorOverflow","_commands","Map","_isEmpty","_editor","_id","_idPool","updatePosition","_domNode","withCommands","lenses","animate","clear","innerHtml","hasSymbol","i","length","lens","command","title","id","set","String","innerHTML","addClass","getCommand","link","parentElement","get","getId","getDomNode","column","getModel","getLineFirstNonWhitespaceColumn","_widgetPosition","position","lineNumber","preference","getPosition","CodeLensHelper","_removeDecorations","_addDecorations","_addDecorationsCallbacks","addDecoration","decoration","callback","push","removeDecoration","decorationId","commit","changeAccessor","resultingDecorations","deltaDecorations","len","CodeLensWidget","data","helper","viewZoneChangeAccessor","updateCallback","_this","_isDisposed","_className","_data","_decorationIds","range","forEach","codeLensData","symbol","options","EMPTY","lift","plusRange","_viewZone","startLineNumber","_viewZoneId","addZone","_createContentWidgetIfNecessary","_contentWidget","addContentWidget","dispose","removeZone","removeContentWidget","isDisposed","isValid","some","getDecorationRange","isEmpty","updateCodeLensSymbols","computeIfNecessary","model","hasAttribute","updateCommands","symbols","resolved","_a","getLineNumber","update","layoutZone","layoutContentWidget","theme","collector","codeLensForeground","getColor","addRule","activeLinkForeground"],"mappings":"AAAA;;;;AAIA,OAAO,sBAAP;AACA,OAAO,KAAKA,GAAZ,MAAqB,8BAArB;AACA,SAASC,cAAT,QAA+B,kCAA/B;AACA,SAASC,MAAT,QAAuB,iCAAvB;AACA,SAASC,KAAT,QAAsB,4BAAtB;AACA,SAASC,sBAAT,QAAuC,iCAAvC;AACA,SAASC,wBAAT,QAAyC,0CAAzC;AACA,SAASC,0BAAT,QAA2C,iDAA3C;AACA,SAASC,0BAAT,QAA2C,gDAA3C;;AACA,IAAIC,gBAAgB;AAAG;AAAe,YAAY;AAC9C,WAASA,gBAAT,CAA0BC,eAA1B,EAA2CC,QAA3C,EAAqD;AACjD,SAAKD,eAAL,GAAuBA,eAAvB;AACA,SAAKE,SAAL,GAAiBD,QAAjB;AACA,SAAKE,aAAL,GAAqB,CAArB;AACA,SAAKC,iBAAL,GAAyB,IAAzB;AACA,SAAKC,OAAL,GAAeC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf;AACH;;AACDR,EAAAA,gBAAgB,CAACS,SAAjB,CAA2BC,gBAA3B,GAA8C,UAAUC,MAAV,EAAkB;AAC5D,QAAI,KAAKC,WAAL,KAAqBC,SAAzB,EAAoC;AAChC,WAAKD,WAAL,GAAmBD,MAAnB;AACH,KAFD,MAGK,IAAI,KAAKC,WAAL,KAAqBD,MAAzB,EAAiC;AAClC,WAAKC,WAAL,GAAmBD,MAAnB;;AACA,WAAKR,SAAL;AACH;AACJ,GARD;;AASA,SAAOH,gBAAP;AACH,CAlBqC,EAAtC;;AAmBA,IAAIc,qBAAqB;AAAG;AAAe,YAAY;AACnD,WAASA,qBAAT,CAA+BC,MAA/B,EAAuCC,SAAvC,EAAkDC,IAAlD,EAAwD;AACpD;AACA,SAAKC,mBAAL,GAA2B,KAA3B;AACA,SAAKb,iBAAL,GAAyB,IAAzB;AACA,SAAKc,SAAL,GAAiB,IAAIC,GAAJ,EAAjB;AACA,SAAKC,QAAL,GAAgB,IAAhB;AACA,SAAKC,OAAL,GAAeP,MAAf;AACA,SAAKQ,GAAL,GAAW,qBAAsBT,qBAAqB,CAACU,OAAtB,EAAjC;AACA,SAAKC,cAAL,CAAoBR,IAApB;AACA,SAAKS,QAAL,GAAgBnB,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAhB;AACA,SAAKkB,QAAL,CAAcV,SAAd,GAA0B,yBAAyBA,SAAnD;AACH;;AACDF,EAAAA,qBAAqB,CAACL,SAAtB,CAAgCkB,YAAhC,GAA+C,UAAUC,MAAV,EAAkBC,OAAlB,EAA2B;AACtE,SAAKV,SAAL,CAAeW,KAAf;;AACA,QAAIC,SAAS,GAAG,EAAhB;AACA,QAAIC,SAAS,GAAG,KAAhB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,MAAM,CAACM,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC,UAAIE,IAAI,GAAGP,MAAM,CAACK,CAAD,CAAjB;;AACA,UAAI,CAACE,IAAL,EAAW;AACP;AACH;;AACDH,MAAAA,SAAS,GAAG,IAAZ;;AACA,UAAIG,IAAI,CAACC,OAAT,EAAkB;AACd,YAAIC,KAAK,GAAG5C,cAAc,CAACC,MAAM,CAACyC,IAAI,CAACC,OAAL,CAAaC,KAAd,CAAP,CAA1B;;AACA,YAAIF,IAAI,CAACC,OAAL,CAAaE,EAAjB,EAAqB;AACjBP,UAAAA,SAAS,IAAI,WAAWE,CAAX,GAAe,GAAf,GAAqBI,KAArB,GAA6B,MAA1C;;AACA,eAAKlB,SAAL,CAAeoB,GAAf,CAAmBC,MAAM,CAACP,CAAD,CAAzB,EAA8BE,IAAI,CAACC,OAAnC;AACH,SAHD,MAIK;AACDL,UAAAA,SAAS,IAAI,WAAWM,KAAX,GAAmB,SAAhC;AACH;;AACD,YAAIJ,CAAC,GAAG,CAAJ,GAAQL,MAAM,CAACM,MAAnB,EAA2B;AACvBH,UAAAA,SAAS,IAAI,4BAAb;AACH;AACJ;AACJ;;AACD,QAAI,CAACC,SAAL,EAAgB;AACZ;AACA,WAAKN,QAAL,CAAce,SAAd,GAA0B,0BAA1B;AACH,KAHD,MAIK;AACD;AACA,UAAI,CAACV,SAAL,EAAgB;AACZA,QAAAA,SAAS,GAAG,QAAZ;AACH;;AACD,WAAKL,QAAL,CAAce,SAAd,GAA0BV,SAA1B;;AACA,UAAI,KAAKV,QAAL,IAAiBQ,OAArB,EAA8B;AAC1BrC,QAAAA,GAAG,CAACkD,QAAJ,CAAa,KAAKhB,QAAlB,EAA4B,QAA5B;AACH;;AACD,WAAKL,QAAL,GAAgB,KAAhB;AACH;AACJ,GAvCD;;AAwCAP,EAAAA,qBAAqB,CAACL,SAAtB,CAAgCkC,UAAhC,GAA6C,UAAUC,IAAV,EAAgB;AACzD,WAAOA,IAAI,CAACC,aAAL,KAAuB,KAAKnB,QAA5B,GACD,KAAKP,SAAL,CAAe2B,GAAf,CAAmBF,IAAI,CAACN,EAAxB,CADC,GAEDzB,SAFN;AAGH,GAJD;;AAKAC,EAAAA,qBAAqB,CAACL,SAAtB,CAAgCsC,KAAhC,GAAwC,YAAY;AAChD,WAAO,KAAKxB,GAAZ;AACH,GAFD;;AAGAT,EAAAA,qBAAqB,CAACL,SAAtB,CAAgCuC,UAAhC,GAA6C,YAAY;AACrD,WAAO,KAAKtB,QAAZ;AACH,GAFD;;AAGAZ,EAAAA,qBAAqB,CAACL,SAAtB,CAAgCgB,cAAhC,GAAiD,UAAUR,IAAV,EAAgB;AAC7D,QAAIgC,MAAM,GAAG,KAAK3B,OAAL,CAAa4B,QAAb,GAAwBC,+BAAxB,CAAwDlC,IAAxD,CAAb;;AACA,SAAKmC,eAAL,GAAuB;AACnBC,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,UAAU,EAAErC,IAAd;AAAoBgC,QAAAA,MAAM,EAAEA;AAA5B,OADS;AAEnBM,MAAAA,UAAU,EAAE,CAAC;AAAE;AAAH;AAFO,KAAvB;AAIH,GAND;;AAOAzC,EAAAA,qBAAqB,CAACL,SAAtB,CAAgC+C,WAAhC,GAA8C,YAAY;AACtD,WAAO,KAAKJ,eAAL,IAAwB,IAA/B;AACH,GAFD;;AAGAtC,EAAAA,qBAAqB,CAACU,OAAtB,GAAgC,CAAhC;AACA,SAAOV,qBAAP;AACH,CA5E0C,EAA3C;;AA6EA,IAAI2C,cAAc;AAAG;AAAe,YAAY;AAC5C,WAASA,cAAT,GAA0B;AACtB,SAAKC,kBAAL,GAA0B,EAA1B;AACA,SAAKC,eAAL,GAAuB,EAAvB;AACA,SAAKC,wBAAL,GAAgC,EAAhC;AACH;;AACDH,EAAAA,cAAc,CAAChD,SAAf,CAAyBoD,aAAzB,GAAyC,UAAUC,UAAV,EAAsBC,QAAtB,EAAgC;AACrE,SAAKJ,eAAL,CAAqBK,IAArB,CAA0BF,UAA1B;;AACA,SAAKF,wBAAL,CAA8BI,IAA9B,CAAmCD,QAAnC;AACH,GAHD;;AAIAN,EAAAA,cAAc,CAAChD,SAAf,CAAyBwD,gBAAzB,GAA4C,UAAUC,YAAV,EAAwB;AAChE,SAAKR,kBAAL,CAAwBM,IAAxB,CAA6BE,YAA7B;AACH,GAFD;;AAGAT,EAAAA,cAAc,CAAChD,SAAf,CAAyB0D,MAAzB,GAAkC,UAAUC,cAAV,EAA0B;AACxD,QAAIC,oBAAoB,GAAGD,cAAc,CAACE,gBAAf,CAAgC,KAAKZ,kBAArC,EAAyD,KAAKC,eAA9D,CAA3B;;AACA,SAAK,IAAI1B,CAAC,GAAG,CAAR,EAAWsC,GAAG,GAAGF,oBAAoB,CAACnC,MAA3C,EAAmDD,CAAC,GAAGsC,GAAvD,EAA4DtC,CAAC,EAA7D,EAAiE;AAC7D,WAAK2B,wBAAL,CAA8B3B,CAA9B,EAAiCoC,oBAAoB,CAACpC,CAAD,CAArD;AACH;AACJ,GALD;;AAMA,SAAOwB,cAAP;AACH,CApBmC,EAApC;;AAqBA,SAASA,cAAT;;AACA,IAAIe,cAAc;AAAG;AAAe,YAAY;AAC5C,WAASA,cAAT,CAAwBC,IAAxB,EAA8B1D,MAA9B,EAAsCC,SAAtC,EAAiD0D,MAAjD,EAAyDC,sBAAzD,EAAiFC,cAAjF,EAAiG;AAC7F,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,WAAL,GAAmB,KAAnB;AACA,SAAKxD,OAAL,GAAeP,MAAf;AACA,SAAKgE,UAAL,GAAkB/D,SAAlB;AACA,SAAKgE,KAAL,GAAaP,IAAb,CAL6F,CAM7F;AACA;;AACA,SAAKQ,cAAL,GAAsB,EAAtB;AACA,QAAIC,KAAJ;AACA,QAAItD,MAAM,GAAG,EAAb;;AACA,SAAKoD,KAAL,CAAWG,OAAX,CAAmB,UAAUC,YAAV,EAAwBnD,CAAxB,EAA2B;AAC1C,UAAImD,YAAY,CAACC,MAAb,CAAoBjD,OAAxB,EAAiC;AAC7BR,QAAAA,MAAM,CAACoC,IAAP,CAAYoB,YAAY,CAACC,MAAzB;AACH;;AACDX,MAAAA,MAAM,CAACb,aAAP,CAAqB;AACjBqB,QAAAA,KAAK,EAAEE,YAAY,CAACC,MAAb,CAAoBH,KADV;AAEjBI,QAAAA,OAAO,EAAE1F,sBAAsB,CAAC2F;AAFf,OAArB,EAGG,UAAUjD,EAAV,EAAc;AAAE,eAAOuC,KAAK,CAACI,cAAN,CAAqBhD,CAArB,IAA0BK,EAAjC;AAAsC,OAHzD,EAJ0C,CAQ1C;;AACA,UAAI,CAAC4C,KAAL,EAAY;AACRA,QAAAA,KAAK,GAAGvF,KAAK,CAAC6F,IAAN,CAAWJ,YAAY,CAACC,MAAb,CAAoBH,KAA/B,CAAR;AACH,OAFD,MAGK;AACDA,QAAAA,KAAK,GAAGvF,KAAK,CAAC8F,SAAN,CAAgBP,KAAhB,EAAuBE,YAAY,CAACC,MAAb,CAAoBH,KAA3C,CAAR;AACH;AACJ,KAfD;;AAgBA,SAAKQ,SAAL,GAAiB,IAAI1F,gBAAJ,CAAqBkF,KAAK,CAACS,eAAN,GAAwB,CAA7C,EAAgDf,cAAhD,CAAjB;AACA,SAAKgB,WAAL,GAAmBjB,sBAAsB,CAACkB,OAAvB,CAA+B,KAAKH,SAApC,CAAnB;;AACA,QAAI9D,MAAM,CAACM,MAAP,GAAgB,CAApB,EAAuB;AACnB,WAAK4D,+BAAL;;AACA,WAAKC,cAAL,CAAoBpE,YAApB,CAAiCC,MAAjC,EAAyC,KAAzC;AACH;AACJ;;AACD4C,EAAAA,cAAc,CAAC/D,SAAf,CAAyBqF,+BAAzB,GAA2D,YAAY;AACnE,QAAI,CAAC,KAAKC,cAAV,EAA0B;AACtB,WAAKA,cAAL,GAAsB,IAAIjF,qBAAJ,CAA0B,KAAKQ,OAA/B,EAAwC,KAAKyD,UAA7C,EAAyD,KAAKW,SAAL,CAAezF,eAAf,GAAiC,CAA1F,CAAtB;;AACA,WAAKqB,OAAL,CAAa0E,gBAAb,CAA8B,KAAKD,cAAnC;AACH;AACJ,GALD;;AAMAvB,EAAAA,cAAc,CAAC/D,SAAf,CAAyBwF,OAAzB,GAAmC,UAAUvB,MAAV,EAAkBC,sBAAlB,EAA0C;AACzE,SAAKM,cAAL,CAAoBE,OAApB,CAA4BT,MAAM,CAACT,gBAAnC,EAAqDS,MAArD;;AACA,SAAKO,cAAL,GAAsB,EAAtB;;AACA,QAAIN,sBAAJ,EAA4B;AACxBA,MAAAA,sBAAsB,CAACuB,UAAvB,CAAkC,KAAKN,WAAvC;AACH;;AACD,QAAI,KAAKG,cAAT,EAAyB;AACrB,WAAKzE,OAAL,CAAa6E,mBAAb,CAAiC,KAAKJ,cAAtC;;AACA,WAAKA,cAAL,GAAsBlF,SAAtB;AACH;;AACD,SAAKiE,WAAL,GAAmB,IAAnB;AACH,GAXD;;AAYAN,EAAAA,cAAc,CAAC/D,SAAf,CAAyB2F,UAAzB,GAAsC,YAAY;AAC9C,WAAO,KAAKtB,WAAZ;AACH,GAFD;;AAGAN,EAAAA,cAAc,CAAC/D,SAAf,CAAyB4F,OAAzB,GAAmC,YAAY;AAC3C,QAAIxB,KAAK,GAAG,IAAZ;;AACA,WAAO,KAAKI,cAAL,CAAoBqB,IAApB,CAAyB,UAAUhE,EAAV,EAAcL,CAAd,EAAiB;AAC7C,UAAIiD,KAAK,GAAGL,KAAK,CAACvD,OAAN,CAAc4B,QAAd,GAAyBqD,kBAAzB,CAA4CjE,EAA5C,CAAZ;;AACA,UAAI+C,MAAM,GAAGR,KAAK,CAACG,KAAN,CAAY/C,CAAZ,EAAeoD,MAA5B;AACA,aAAO,CAAC,EAAEH,KAAK,IAAIvF,KAAK,CAAC6G,OAAN,CAAcnB,MAAM,CAACH,KAArB,MAAgCA,KAAK,CAACsB,OAAN,EAA3C,CAAR;AACH,KAJM,CAAP;AAKH,GAPD;;AAQAhC,EAAAA,cAAc,CAAC/D,SAAf,CAAyBgG,qBAAzB,GAAiD,UAAUhC,IAAV,EAAgBC,MAAhB,EAAwB;AACrE,QAAIG,KAAK,GAAG,IAAZ;;AACA,SAAKI,cAAL,CAAoBE,OAApB,CAA4BT,MAAM,CAACT,gBAAnC,EAAqDS,MAArD;;AACA,SAAKO,cAAL,GAAsB,EAAtB;AACA,SAAKD,KAAL,GAAaP,IAAb;;AACA,SAAKO,KAAL,CAAWG,OAAX,CAAmB,UAAUC,YAAV,EAAwBnD,CAAxB,EAA2B;AAC1CyC,MAAAA,MAAM,CAACb,aAAP,CAAqB;AACjBqB,QAAAA,KAAK,EAAEE,YAAY,CAACC,MAAb,CAAoBH,KADV;AAEjBI,QAAAA,OAAO,EAAE1F,sBAAsB,CAAC2F;AAFf,OAArB,EAGG,UAAUjD,EAAV,EAAc;AAAE,eAAOuC,KAAK,CAACI,cAAN,CAAqBhD,CAArB,IAA0BK,EAAjC;AAAsC,OAHzD;AAIH,KALD;AAMH,GAXD;;AAYAkC,EAAAA,cAAc,CAAC/D,SAAf,CAAyBiG,kBAAzB,GAA8C,UAAUC,KAAV,EAAiB;AAC3D,QAAI,CAAC,KAAKjB,SAAL,CAAepF,OAAf,CAAuBsG,YAAvB,CAAoC,0BAApC,CAAL,EAAsE;AAClE,aAAO,IAAP;AACH,KAH0D,CAI3D;;;AACA,SAAK,IAAI3E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKgD,cAAL,CAAoB/C,MAAxC,EAAgDD,CAAC,EAAjD,EAAqD;AACjD,UAAIiD,KAAK,GAAGyB,KAAK,CAACJ,kBAAN,CAAyB,KAAKtB,cAAL,CAAoBhD,CAApB,CAAzB,CAAZ;;AACA,UAAIiD,KAAJ,EAAW;AACP,aAAKF,KAAL,CAAW/C,CAAX,EAAcoD,MAAd,CAAqBH,KAArB,GAA6BA,KAA7B;AACH;AACJ;;AACD,WAAO,KAAKF,KAAZ;AACH,GAZD;;AAaAR,EAAAA,cAAc,CAAC/D,SAAf,CAAyBoG,cAAzB,GAA0C,UAAUC,OAAV,EAAmB;AACzD,SAAKhB,+BAAL;;AACA,SAAKC,cAAL,CAAoBpE,YAApB,CAAiCmF,OAAjC,EAA0C,IAA1C;;AACA,SAAK,IAAI7E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK+C,KAAL,CAAW9C,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,UAAI8E,QAAQ,GAAGD,OAAO,CAAC7E,CAAD,CAAtB;;AACA,UAAI8E,QAAJ,EAAc;AACV,YAAI1B,MAAM,GAAG,KAAKL,KAAL,CAAW/C,CAAX,EAAcoD,MAA3B;AACAA,QAAAA,MAAM,CAACjD,OAAP,GAAiB2E,QAAQ,CAAC3E,OAAT,IAAoBiD,MAAM,CAACjD,OAA5C;AACH;AACJ;AACJ,GAVD;;AAWAoC,EAAAA,cAAc,CAAC/D,SAAf,CAAyBkC,UAAzB,GAAsC,UAAUC,IAAV,EAAgB;AAClD,QAAIoE,EAAJ;;AACA,WAAO,CAACA,EAAE,GAAG,KAAKjB,cAAX,MAA+B,IAA/B,IAAuCiB,EAAE,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,EAAE,CAACrE,UAAH,CAAcC,IAAd,CAAvE;AACH,GAHD;;AAIA4B,EAAAA,cAAc,CAAC/D,SAAf,CAAyBwG,aAAzB,GAAyC,YAAY;AACjD,QAAI/B,KAAK,GAAG,KAAK5D,OAAL,CAAa4B,QAAb,GAAwBqD,kBAAxB,CAA2C,KAAKtB,cAAL,CAAoB,CAApB,CAA3C,CAAZ;;AACA,QAAIC,KAAJ,EAAW;AACP,aAAOA,KAAK,CAACS,eAAb;AACH;;AACD,WAAO,CAAC,CAAR;AACH,GAND;;AAOAnB,EAAAA,cAAc,CAAC/D,SAAf,CAAyByG,MAAzB,GAAkC,UAAUvC,sBAAV,EAAkC;AAChE,QAAI,KAAK0B,OAAL,EAAJ,EAAoB;AAChB,UAAInB,KAAK,GAAG,KAAK5D,OAAL,CAAa4B,QAAb,GAAwBqD,kBAAxB,CAA2C,KAAKtB,cAAL,CAAoB,CAApB,CAA3C,CAAZ;;AACA,UAAIC,KAAJ,EAAW;AACP,aAAKQ,SAAL,CAAezF,eAAf,GAAiCiF,KAAK,CAACS,eAAN,GAAwB,CAAzD;AACAhB,QAAAA,sBAAsB,CAACwC,UAAvB,CAAkC,KAAKvB,WAAvC;;AACA,YAAI,KAAKG,cAAT,EAAyB;AACrB,eAAKA,cAAL,CAAoBtE,cAApB,CAAmCyD,KAAK,CAACS,eAAzC;;AACA,eAAKrE,OAAL,CAAa8F,mBAAb,CAAiC,KAAKrB,cAAtC;AACH;AACJ;AACJ;AACJ,GAZD;;AAaA,SAAOvB,cAAP;AACH,CA7HmC,EAApC;;AA8HA,SAASA,cAAT;AACAzE,0BAA0B,CAAC,UAAUsH,KAAV,EAAiBC,SAAjB,EAA4B;AACnD,MAAIC,kBAAkB,GAAGF,KAAK,CAACG,QAAN,CAAe3H,wBAAf,CAAzB;;AACA,MAAI0H,kBAAJ,EAAwB;AACpBD,IAAAA,SAAS,CAACG,OAAV,CAAkB,kDAAkDF,kBAAlD,GAAuE,KAAzF;AACAD,IAAAA,SAAS,CAACG,OAAV,CAAkB,2DAA2DF,kBAA3D,GAAgF,KAAlG;AACH;;AACD,MAAIG,oBAAoB,GAAGL,KAAK,CAACG,QAAN,CAAe1H,0BAAf,CAA3B;;AACA,MAAI4H,oBAAJ,EAA0B;AACtBJ,IAAAA,SAAS,CAACG,OAAV,CAAkB,4DAA4DC,oBAA5D,GAAmF,gBAArG;AACAJ,IAAAA,SAAS,CAACG,OAAV,CAAkB,qEAAqEC,oBAArE,GAA4F,gBAA9G;AACH;AACJ,CAXyB,CAA1B","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport './codelensWidget.css';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { renderCodicons } from '../../../base/common/codicons.js';\r\nimport { escape } from '../../../base/common/strings.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { editorCodeLensForeground } from '../../common/view/editorColorRegistry.js';\r\nimport { editorActiveLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nvar CodeLensViewZone = /** @class */ (function () {\r\n    function CodeLensViewZone(afterLineNumber, onHeight) {\r\n        this.afterLineNumber = afterLineNumber;\r\n        this._onHeight = onHeight;\r\n        this.heightInLines = 1;\r\n        this.suppressMouseDown = true;\r\n        this.domNode = document.createElement('div');\r\n    }\r\n    CodeLensViewZone.prototype.onComputedHeight = function (height) {\r\n        if (this._lastHeight === undefined) {\r\n            this._lastHeight = height;\r\n        }\r\n        else if (this._lastHeight !== height) {\r\n            this._lastHeight = height;\r\n            this._onHeight();\r\n        }\r\n    };\r\n    return CodeLensViewZone;\r\n}());\r\nvar CodeLensContentWidget = /** @class */ (function () {\r\n    function CodeLensContentWidget(editor, className, line) {\r\n        // Editor.IContentWidget.allowEditorOverflow\r\n        this.allowEditorOverflow = false;\r\n        this.suppressMouseDown = true;\r\n        this._commands = new Map();\r\n        this._isEmpty = true;\r\n        this._editor = editor;\r\n        this._id = \"codelens.widget-\" + (CodeLensContentWidget._idPool++);\r\n        this.updatePosition(line);\r\n        this._domNode = document.createElement('span');\r\n        this._domNode.className = \"codelens-decoration \" + className;\r\n    }\r\n    CodeLensContentWidget.prototype.withCommands = function (lenses, animate) {\r\n        this._commands.clear();\r\n        var innerHtml = '';\r\n        var hasSymbol = false;\r\n        for (var i = 0; i < lenses.length; i++) {\r\n            var lens = lenses[i];\r\n            if (!lens) {\r\n                continue;\r\n            }\r\n            hasSymbol = true;\r\n            if (lens.command) {\r\n                var title = renderCodicons(escape(lens.command.title));\r\n                if (lens.command.id) {\r\n                    innerHtml += \"<a id=\" + i + \">\" + title + \"</a>\";\r\n                    this._commands.set(String(i), lens.command);\r\n                }\r\n                else {\r\n                    innerHtml += \"<span>\" + title + \"</span>\";\r\n                }\r\n                if (i + 1 < lenses.length) {\r\n                    innerHtml += '<span>&#160;|&#160;</span>';\r\n                }\r\n            }\r\n        }\r\n        if (!hasSymbol) {\r\n            // symbols but no commands\r\n            this._domNode.innerHTML = '<span>no commands</span>';\r\n        }\r\n        else {\r\n            // symbols and commands\r\n            if (!innerHtml) {\r\n                innerHtml = '&#160;';\r\n            }\r\n            this._domNode.innerHTML = innerHtml;\r\n            if (this._isEmpty && animate) {\r\n                dom.addClass(this._domNode, 'fadein');\r\n            }\r\n            this._isEmpty = false;\r\n        }\r\n    };\r\n    CodeLensContentWidget.prototype.getCommand = function (link) {\r\n        return link.parentElement === this._domNode\r\n            ? this._commands.get(link.id)\r\n            : undefined;\r\n    };\r\n    CodeLensContentWidget.prototype.getId = function () {\r\n        return this._id;\r\n    };\r\n    CodeLensContentWidget.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    CodeLensContentWidget.prototype.updatePosition = function (line) {\r\n        var column = this._editor.getModel().getLineFirstNonWhitespaceColumn(line);\r\n        this._widgetPosition = {\r\n            position: { lineNumber: line, column: column },\r\n            preference: [1 /* ABOVE */]\r\n        };\r\n    };\r\n    CodeLensContentWidget.prototype.getPosition = function () {\r\n        return this._widgetPosition || null;\r\n    };\r\n    CodeLensContentWidget._idPool = 0;\r\n    return CodeLensContentWidget;\r\n}());\r\nvar CodeLensHelper = /** @class */ (function () {\r\n    function CodeLensHelper() {\r\n        this._removeDecorations = [];\r\n        this._addDecorations = [];\r\n        this._addDecorationsCallbacks = [];\r\n    }\r\n    CodeLensHelper.prototype.addDecoration = function (decoration, callback) {\r\n        this._addDecorations.push(decoration);\r\n        this._addDecorationsCallbacks.push(callback);\r\n    };\r\n    CodeLensHelper.prototype.removeDecoration = function (decorationId) {\r\n        this._removeDecorations.push(decorationId);\r\n    };\r\n    CodeLensHelper.prototype.commit = function (changeAccessor) {\r\n        var resultingDecorations = changeAccessor.deltaDecorations(this._removeDecorations, this._addDecorations);\r\n        for (var i = 0, len = resultingDecorations.length; i < len; i++) {\r\n            this._addDecorationsCallbacks[i](resultingDecorations[i]);\r\n        }\r\n    };\r\n    return CodeLensHelper;\r\n}());\r\nexport { CodeLensHelper };\r\nvar CodeLensWidget = /** @class */ (function () {\r\n    function CodeLensWidget(data, editor, className, helper, viewZoneChangeAccessor, updateCallback) {\r\n        var _this = this;\r\n        this._isDisposed = false;\r\n        this._editor = editor;\r\n        this._className = className;\r\n        this._data = data;\r\n        // create combined range, track all ranges with decorations,\r\n        // check if there is already something to render\r\n        this._decorationIds = [];\r\n        var range;\r\n        var lenses = [];\r\n        this._data.forEach(function (codeLensData, i) {\r\n            if (codeLensData.symbol.command) {\r\n                lenses.push(codeLensData.symbol);\r\n            }\r\n            helper.addDecoration({\r\n                range: codeLensData.symbol.range,\r\n                options: ModelDecorationOptions.EMPTY\r\n            }, function (id) { return _this._decorationIds[i] = id; });\r\n            // the range contains all lenses on this line\r\n            if (!range) {\r\n                range = Range.lift(codeLensData.symbol.range);\r\n            }\r\n            else {\r\n                range = Range.plusRange(range, codeLensData.symbol.range);\r\n            }\r\n        });\r\n        this._viewZone = new CodeLensViewZone(range.startLineNumber - 1, updateCallback);\r\n        this._viewZoneId = viewZoneChangeAccessor.addZone(this._viewZone);\r\n        if (lenses.length > 0) {\r\n            this._createContentWidgetIfNecessary();\r\n            this._contentWidget.withCommands(lenses, false);\r\n        }\r\n    }\r\n    CodeLensWidget.prototype._createContentWidgetIfNecessary = function () {\r\n        if (!this._contentWidget) {\r\n            this._contentWidget = new CodeLensContentWidget(this._editor, this._className, this._viewZone.afterLineNumber + 1);\r\n            this._editor.addContentWidget(this._contentWidget);\r\n        }\r\n    };\r\n    CodeLensWidget.prototype.dispose = function (helper, viewZoneChangeAccessor) {\r\n        this._decorationIds.forEach(helper.removeDecoration, helper);\r\n        this._decorationIds = [];\r\n        if (viewZoneChangeAccessor) {\r\n            viewZoneChangeAccessor.removeZone(this._viewZoneId);\r\n        }\r\n        if (this._contentWidget) {\r\n            this._editor.removeContentWidget(this._contentWidget);\r\n            this._contentWidget = undefined;\r\n        }\r\n        this._isDisposed = true;\r\n    };\r\n    CodeLensWidget.prototype.isDisposed = function () {\r\n        return this._isDisposed;\r\n    };\r\n    CodeLensWidget.prototype.isValid = function () {\r\n        var _this = this;\r\n        return this._decorationIds.some(function (id, i) {\r\n            var range = _this._editor.getModel().getDecorationRange(id);\r\n            var symbol = _this._data[i].symbol;\r\n            return !!(range && Range.isEmpty(symbol.range) === range.isEmpty());\r\n        });\r\n    };\r\n    CodeLensWidget.prototype.updateCodeLensSymbols = function (data, helper) {\r\n        var _this = this;\r\n        this._decorationIds.forEach(helper.removeDecoration, helper);\r\n        this._decorationIds = [];\r\n        this._data = data;\r\n        this._data.forEach(function (codeLensData, i) {\r\n            helper.addDecoration({\r\n                range: codeLensData.symbol.range,\r\n                options: ModelDecorationOptions.EMPTY\r\n            }, function (id) { return _this._decorationIds[i] = id; });\r\n        });\r\n    };\r\n    CodeLensWidget.prototype.computeIfNecessary = function (model) {\r\n        if (!this._viewZone.domNode.hasAttribute('monaco-visible-view-zone')) {\r\n            return null;\r\n        }\r\n        // Read editor current state\r\n        for (var i = 0; i < this._decorationIds.length; i++) {\r\n            var range = model.getDecorationRange(this._decorationIds[i]);\r\n            if (range) {\r\n                this._data[i].symbol.range = range;\r\n            }\r\n        }\r\n        return this._data;\r\n    };\r\n    CodeLensWidget.prototype.updateCommands = function (symbols) {\r\n        this._createContentWidgetIfNecessary();\r\n        this._contentWidget.withCommands(symbols, true);\r\n        for (var i = 0; i < this._data.length; i++) {\r\n            var resolved = symbols[i];\r\n            if (resolved) {\r\n                var symbol = this._data[i].symbol;\r\n                symbol.command = resolved.command || symbol.command;\r\n            }\r\n        }\r\n    };\r\n    CodeLensWidget.prototype.getCommand = function (link) {\r\n        var _a;\r\n        return (_a = this._contentWidget) === null || _a === void 0 ? void 0 : _a.getCommand(link);\r\n    };\r\n    CodeLensWidget.prototype.getLineNumber = function () {\r\n        var range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\r\n        if (range) {\r\n            return range.startLineNumber;\r\n        }\r\n        return -1;\r\n    };\r\n    CodeLensWidget.prototype.update = function (viewZoneChangeAccessor) {\r\n        if (this.isValid()) {\r\n            var range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);\r\n            if (range) {\r\n                this._viewZone.afterLineNumber = range.startLineNumber - 1;\r\n                viewZoneChangeAccessor.layoutZone(this._viewZoneId);\r\n                if (this._contentWidget) {\r\n                    this._contentWidget.updatePosition(range.startLineNumber);\r\n                    this._editor.layoutContentWidget(this._contentWidget);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return CodeLensWidget;\r\n}());\r\nexport { CodeLensWidget };\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var codeLensForeground = theme.getColor(editorCodeLensForeground);\r\n    if (codeLensForeground) {\r\n        collector.addRule(\".monaco-editor .codelens-decoration { color: \" + codeLensForeground + \"; }\");\r\n        collector.addRule(\".monaco-editor .codelens-decoration .codicon { color: \" + codeLensForeground + \"; }\");\r\n    }\r\n    var activeLinkForeground = theme.getColor(editorActiveLinkForeground);\r\n    if (activeLinkForeground) {\r\n        collector.addRule(\".monaco-editor .codelens-decoration > a:hover { color: \" + activeLinkForeground + \" !important; }\");\r\n        collector.addRule(\".monaco-editor .codelens-decoration > a:hover .codicon { color: \" + activeLinkForeground + \" !important; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}