{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport './links.css';\nimport * as nls from '../../../nls.js';\nimport * as async from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { MarkdownString } from '../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\nimport { LinkProviderRegistry } from '../../common/modes.js';\nimport { ClickLinkGesture } from '../gotoSymbol/link/clickLinkGesture.js';\nimport { getLinks } from './getLinks.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\nimport { editorActiveLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\n\nfunction getHoverMessage(link, useMetaKey) {\n  var executeCmd = link.url && /^command:/i.test(link.url.toString());\n  var label = link.tooltip ? link.tooltip : executeCmd ? nls.localize('links.navigate.executeCmd', 'Execute command') : nls.localize('links.navigate.follow', 'Follow link');\n  var kb = useMetaKey ? platform.isMacintosh ? nls.localize('links.navigate.kb.meta.mac', \"cmd + click\") : nls.localize('links.navigate.kb.meta', \"ctrl + click\") : platform.isMacintosh ? nls.localize('links.navigate.kb.alt.mac', \"option + click\") : nls.localize('links.navigate.kb.alt', \"alt + click\");\n\n  if (link.url) {\n    var hoverMessage = new MarkdownString('', true).appendMarkdown(\"[\" + label + \"](\" + link.url.toString() + \") (\" + kb + \")\");\n    return hoverMessage;\n  } else {\n    return new MarkdownString().appendText(label + \" (\" + kb + \")\");\n  }\n}\n\nvar decoration = {\n  general: ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    collapseOnReplaceEdit: true,\n    inlineClassName: 'detected-link'\n  }),\n  active: ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    collapseOnReplaceEdit: true,\n    inlineClassName: 'detected-link-active'\n  })\n};\n\nvar LinkOccurrence =\n/** @class */\nfunction () {\n  function LinkOccurrence(link, decorationId) {\n    this.link = link;\n    this.decorationId = decorationId;\n  }\n\n  LinkOccurrence.decoration = function (link, useMetaKey) {\n    return {\n      range: link.range,\n      options: LinkOccurrence._getOptions(link, useMetaKey, false)\n    };\n  };\n\n  LinkOccurrence._getOptions = function (link, useMetaKey, isActive) {\n    var options = __assign({}, isActive ? decoration.active : decoration.general);\n\n    options.hoverMessage = getHoverMessage(link, useMetaKey);\n    return options;\n  };\n\n  LinkOccurrence.prototype.activate = function (changeAccessor, useMetaKey) {\n    changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n  };\n\n  LinkOccurrence.prototype.deactivate = function (changeAccessor, useMetaKey) {\n    changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n  };\n\n  return LinkOccurrence;\n}();\n\nvar LinkDetector =\n/** @class */\nfunction () {\n  function LinkDetector(editor, openerService, notificationService) {\n    var _this = this;\n\n    this.listenersToRemove = new DisposableStore();\n    this.editor = editor;\n    this.openerService = openerService;\n    this.notificationService = notificationService;\n    var clickLinkGesture = new ClickLinkGesture(editor);\n    this.listenersToRemove.add(clickLinkGesture);\n    this.listenersToRemove.add(clickLinkGesture.onMouseMoveOrRelevantKeyDown(function (_a) {\n      var mouseEvent = _a[0],\n          keyboardEvent = _a[1];\n\n      _this._onEditorMouseMove(mouseEvent, keyboardEvent);\n    }));\n    this.listenersToRemove.add(clickLinkGesture.onExecute(function (e) {\n      _this.onEditorMouseUp(e);\n    }));\n    this.listenersToRemove.add(clickLinkGesture.onCancel(function (e) {\n      _this.cleanUpActiveLinkDecoration();\n    }));\n    this.enabled = editor.getOption(52\n    /* links */\n    );\n    this.listenersToRemove.add(editor.onDidChangeConfiguration(function (e) {\n      var enabled = editor.getOption(52\n      /* links */\n      );\n\n      if (_this.enabled === enabled) {\n        // No change in our configuration option\n        return;\n      }\n\n      _this.enabled = enabled; // Remove any links (for the getting disabled case)\n\n      _this.updateDecorations([]); // Stop any computation (for the getting disabled case)\n\n\n      _this.stop(); // Start computing (for the getting enabled case)\n\n\n      _this.beginCompute();\n    }));\n    this.listenersToRemove.add(editor.onDidChangeModelContent(function (e) {\n      return _this.onChange();\n    }));\n    this.listenersToRemove.add(editor.onDidChangeModel(function (e) {\n      return _this.onModelChanged();\n    }));\n    this.listenersToRemove.add(editor.onDidChangeModelLanguage(function (e) {\n      return _this.onModelModeChanged();\n    }));\n    this.listenersToRemove.add(LinkProviderRegistry.onDidChange(function (e) {\n      return _this.onModelModeChanged();\n    }));\n    this.timeout = new async.TimeoutTimer();\n    this.computePromise = null;\n    this.activeLinksList = null;\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n    this.beginCompute();\n  }\n\n  LinkDetector.get = function (editor) {\n    return editor.getContribution(LinkDetector.ID);\n  };\n\n  LinkDetector.prototype.onModelChanged = function () {\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n    this.stop();\n    this.beginCompute();\n  };\n\n  LinkDetector.prototype.onModelModeChanged = function () {\n    this.stop();\n    this.beginCompute();\n  };\n\n  LinkDetector.prototype.onChange = function () {\n    var _this = this;\n\n    this.timeout.setIfNotSet(function () {\n      return _this.beginCompute();\n    }, LinkDetector.RECOMPUTE_TIME);\n  };\n\n  LinkDetector.prototype.beginCompute = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var model, _a, err_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!this.editor.hasModel() || !this.enabled) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            model = this.editor.getModel();\n\n            if (!LinkProviderRegistry.has(model)) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (this.activeLinksList) {\n              this.activeLinksList.dispose();\n              this.activeLinksList = null;\n            }\n\n            this.computePromise = async.createCancelablePromise(function (token) {\n              return getLinks(model, token);\n            });\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3, 4, 5]);\n\n            _a = this;\n            return [4\n            /*yield*/\n            , this.computePromise];\n\n          case 2:\n            _a.activeLinksList = _b.sent();\n            this.updateDecorations(this.activeLinksList.links);\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            err_1 = _b.sent();\n            onUnexpectedError(err_1);\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            this.computePromise = null;\n            return [7\n            /*endfinally*/\n            ];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  LinkDetector.prototype.updateDecorations = function (links) {\n    var useMetaKey = this.editor.getOption(59\n    /* multiCursorModifier */\n    ) === 'altKey';\n    var oldDecorations = [];\n    var keys = Object.keys(this.currentOccurrences);\n\n    for (var i = 0, len = keys.length; i < len; i++) {\n      var decorationId = keys[i];\n      var occurance = this.currentOccurrences[decorationId];\n      oldDecorations.push(occurance.decorationId);\n    }\n\n    var newDecorations = [];\n\n    if (links) {\n      // Not sure why this is sometimes null\n      for (var _i = 0, links_1 = links; _i < links_1.length; _i++) {\n        var link = links_1[_i];\n        newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n      }\n    }\n\n    var decorations = this.editor.deltaDecorations(oldDecorations, newDecorations);\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n\n    for (var i = 0, len = decorations.length; i < len; i++) {\n      var occurance = new LinkOccurrence(links[i], decorations[i]);\n      this.currentOccurrences[occurance.decorationId] = occurance;\n    }\n  };\n\n  LinkDetector.prototype._onEditorMouseMove = function (mouseEvent, withKey) {\n    var _this = this;\n\n    var useMetaKey = this.editor.getOption(59\n    /* multiCursorModifier */\n    ) === 'altKey';\n\n    if (this.isEnabled(mouseEvent, withKey)) {\n      this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n\n      var occurrence_1 = this.getLinkOccurrence(mouseEvent.target.position);\n\n      if (occurrence_1) {\n        this.editor.changeDecorations(function (changeAccessor) {\n          occurrence_1.activate(changeAccessor, useMetaKey);\n          _this.activeLinkDecorationId = occurrence_1.decorationId;\n        });\n      }\n    } else {\n      this.cleanUpActiveLinkDecoration();\n    }\n  };\n\n  LinkDetector.prototype.cleanUpActiveLinkDecoration = function () {\n    var useMetaKey = this.editor.getOption(59\n    /* multiCursorModifier */\n    ) === 'altKey';\n\n    if (this.activeLinkDecorationId) {\n      var occurrence_2 = this.currentOccurrences[this.activeLinkDecorationId];\n\n      if (occurrence_2) {\n        this.editor.changeDecorations(function (changeAccessor) {\n          occurrence_2.deactivate(changeAccessor, useMetaKey);\n        });\n      }\n\n      this.activeLinkDecorationId = null;\n    }\n  };\n\n  LinkDetector.prototype.onEditorMouseUp = function (mouseEvent) {\n    if (!this.isEnabled(mouseEvent)) {\n      return;\n    }\n\n    var occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n\n    if (!occurrence) {\n      return;\n    }\n\n    this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true\n    /* from user gesture */\n    );\n  };\n\n  LinkDetector.prototype.openLinkOccurrence = function (occurrence, openToSide, fromUserGesture) {\n    var _this = this;\n\n    if (fromUserGesture === void 0) {\n      fromUserGesture = false;\n    }\n\n    if (!this.openerService) {\n      return;\n    }\n\n    var link = occurrence.link;\n    link.resolve(CancellationToken.None).then(function (uri) {\n      // open the uri\n      return _this.openerService.open(uri, {\n        openToSide: openToSide,\n        fromUserGesture: fromUserGesture\n      });\n    }, function (err) {\n      var messageOrError = err instanceof Error ? err.message : err; // different error cases\n\n      if (messageOrError === 'invalid') {\n        _this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\n      } else if (messageOrError === 'missing') {\n        _this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n      } else {\n        onUnexpectedError(err);\n      }\n    });\n  };\n\n  LinkDetector.prototype.getLinkOccurrence = function (position) {\n    if (!this.editor.hasModel() || !position) {\n      return null;\n    }\n\n    var decorations = this.editor.getModel().getDecorationsInRange({\n      startLineNumber: position.lineNumber,\n      startColumn: position.column,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column\n    }, 0, true);\n\n    for (var _i = 0, decorations_1 = decorations; _i < decorations_1.length; _i++) {\n      var decoration_1 = decorations_1[_i];\n      var currentOccurrence = this.currentOccurrences[decoration_1.id];\n\n      if (currentOccurrence) {\n        return currentOccurrence;\n      }\n    }\n\n    return null;\n  };\n\n  LinkDetector.prototype.isEnabled = function (mouseEvent, withKey) {\n    return Boolean(mouseEvent.target.type === 6\n    /* CONTENT_TEXT */\n    && (mouseEvent.hasTriggerModifier || withKey && withKey.keyCodeIsTriggerKey));\n  };\n\n  LinkDetector.prototype.stop = function () {\n    this.timeout.cancel();\n\n    if (this.activeLinksList) {\n      this.activeLinksList.dispose();\n    }\n\n    if (this.computePromise) {\n      this.computePromise.cancel();\n      this.computePromise = null;\n    }\n  };\n\n  LinkDetector.prototype.dispose = function () {\n    this.listenersToRemove.dispose();\n    this.stop();\n    this.timeout.dispose();\n  };\n\n  LinkDetector.ID = 'editor.linkDetector';\n  LinkDetector.RECOMPUTE_TIME = 1000; // ms\n\n  LinkDetector = __decorate([__param(1, IOpenerService), __param(2, INotificationService)], LinkDetector);\n  return LinkDetector;\n}();\n\nvar OpenLinkAction =\n/** @class */\nfunction (_super) {\n  __extends(OpenLinkAction, _super);\n\n  function OpenLinkAction() {\n    return _super.call(this, {\n      id: 'editor.action.openLink',\n      label: nls.localize('label', \"Open Link\"),\n      alias: 'Open Link',\n      precondition: undefined\n    }) || this;\n  }\n\n  OpenLinkAction.prototype.run = function (accessor, editor) {\n    var linkDetector = LinkDetector.get(editor);\n\n    if (!linkDetector) {\n      return;\n    }\n\n    if (!editor.hasModel()) {\n      return;\n    }\n\n    var selections = editor.getSelections();\n\n    for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\n      var sel = selections_1[_i];\n      var link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n\n      if (link) {\n        linkDetector.openLinkOccurrence(link, false);\n      }\n    }\n  };\n\n  return OpenLinkAction;\n}(EditorAction);\n\nregisterEditorContribution(LinkDetector.ID, LinkDetector);\nregisterEditorAction(OpenLinkAction);\nregisterThemingParticipant(function (theme, collector) {\n  var activeLinkForeground = theme.getColor(editorActiveLinkForeground);\n\n  if (activeLinkForeground) {\n    collector.addRule(\".monaco-editor .detected-link-active { color: \" + activeLinkForeground + \" !important; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/links/links.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","nls","async","CancellationToken","onUnexpectedError","MarkdownString","DisposableStore","platform","EditorAction","registerEditorAction","registerEditorContribution","ModelDecorationOptions","LinkProviderRegistry","ClickLinkGesture","getLinks","INotificationService","IOpenerService","editorActiveLinkForeground","registerThemingParticipant","getHoverMessage","link","useMetaKey","executeCmd","url","test","toString","tooltip","localize","kb","isMacintosh","hoverMessage","appendMarkdown","appendText","decoration","general","register","stickiness","collapseOnReplaceEdit","inlineClassName","active","LinkOccurrence","decorationId","range","options","_getOptions","isActive","activate","changeAccessor","changeDecorationOptions","deactivate","LinkDetector","editor","openerService","notificationService","_this","listenersToRemove","clickLinkGesture","add","onMouseMoveOrRelevantKeyDown","_a","mouseEvent","keyboardEvent","_onEditorMouseMove","onExecute","onEditorMouseUp","onCancel","cleanUpActiveLinkDecoration","enabled","getOption","onDidChangeConfiguration","updateDecorations","stop","beginCompute","onDidChangeModelContent","onChange","onDidChangeModel","onModelChanged","onDidChangeModelLanguage","onModelModeChanged","onDidChange","timeout","TimeoutTimer","computePromise","activeLinksList","currentOccurrences","activeLinkDecorationId","get","getContribution","ID","setIfNotSet","RECOMPUTE_TIME","model","err_1","_b","hasModel","getModel","has","dispose","createCancelablePromise","token","links","oldDecorations","keys","len","occurance","newDecorations","_i","links_1","decorations","deltaDecorations","withKey","isEnabled","occurrence_1","getLinkOccurrence","position","changeDecorations","occurrence_2","occurrence","openLinkOccurrence","hasSideBySideModifier","openToSide","fromUserGesture","None","uri","open","err","messageOrError","Error","message","warn","getDecorationsInRange","startLineNumber","lineNumber","startColumn","column","endLineNumber","endColumn","decorations_1","decoration_1","currentOccurrence","id","Boolean","type","hasTriggerModifier","keyCodeIsTriggerKey","cancel","OpenLinkAction","_super","alias","precondition","undefined","run","accessor","linkDetector","selections","getSelections","selections_1","sel","getEndPosition","theme","collector","activeLinkForeground","getColor","addRule"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport './links.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as async from '../../../base/common/async.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { MarkdownString } from '../../../base/common/htmlContent.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { LinkProviderRegistry } from '../../common/modes.js';\r\nimport { ClickLinkGesture } from '../gotoSymbol/link/clickLinkGesture.js';\r\nimport { getLinks } from './getLinks.js';\r\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\r\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\r\nimport { editorActiveLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nfunction getHoverMessage(link, useMetaKey) {\r\n    var executeCmd = link.url && /^command:/i.test(link.url.toString());\r\n    var label = link.tooltip\r\n        ? link.tooltip\r\n        : executeCmd\r\n            ? nls.localize('links.navigate.executeCmd', 'Execute command')\r\n            : nls.localize('links.navigate.follow', 'Follow link');\r\n    var kb = useMetaKey\r\n        ? platform.isMacintosh\r\n            ? nls.localize('links.navigate.kb.meta.mac', \"cmd + click\")\r\n            : nls.localize('links.navigate.kb.meta', \"ctrl + click\")\r\n        : platform.isMacintosh\r\n            ? nls.localize('links.navigate.kb.alt.mac', \"option + click\")\r\n            : nls.localize('links.navigate.kb.alt', \"alt + click\");\r\n    if (link.url) {\r\n        var hoverMessage = new MarkdownString('', true).appendMarkdown(\"[\" + label + \"](\" + link.url.toString() + \") (\" + kb + \")\");\r\n        return hoverMessage;\r\n    }\r\n    else {\r\n        return new MarkdownString().appendText(label + \" (\" + kb + \")\");\r\n    }\r\n}\r\nvar decoration = {\r\n    general: ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        collapseOnReplaceEdit: true,\r\n        inlineClassName: 'detected-link'\r\n    }),\r\n    active: ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        collapseOnReplaceEdit: true,\r\n        inlineClassName: 'detected-link-active'\r\n    })\r\n};\r\nvar LinkOccurrence = /** @class */ (function () {\r\n    function LinkOccurrence(link, decorationId) {\r\n        this.link = link;\r\n        this.decorationId = decorationId;\r\n    }\r\n    LinkOccurrence.decoration = function (link, useMetaKey) {\r\n        return {\r\n            range: link.range,\r\n            options: LinkOccurrence._getOptions(link, useMetaKey, false)\r\n        };\r\n    };\r\n    LinkOccurrence._getOptions = function (link, useMetaKey, isActive) {\r\n        var options = __assign({}, (isActive ? decoration.active : decoration.general));\r\n        options.hoverMessage = getHoverMessage(link, useMetaKey);\r\n        return options;\r\n    };\r\n    LinkOccurrence.prototype.activate = function (changeAccessor, useMetaKey) {\r\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\r\n    };\r\n    LinkOccurrence.prototype.deactivate = function (changeAccessor, useMetaKey) {\r\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\r\n    };\r\n    return LinkOccurrence;\r\n}());\r\nvar LinkDetector = /** @class */ (function () {\r\n    function LinkDetector(editor, openerService, notificationService) {\r\n        var _this = this;\r\n        this.listenersToRemove = new DisposableStore();\r\n        this.editor = editor;\r\n        this.openerService = openerService;\r\n        this.notificationService = notificationService;\r\n        var clickLinkGesture = new ClickLinkGesture(editor);\r\n        this.listenersToRemove.add(clickLinkGesture);\r\n        this.listenersToRemove.add(clickLinkGesture.onMouseMoveOrRelevantKeyDown(function (_a) {\r\n            var mouseEvent = _a[0], keyboardEvent = _a[1];\r\n            _this._onEditorMouseMove(mouseEvent, keyboardEvent);\r\n        }));\r\n        this.listenersToRemove.add(clickLinkGesture.onExecute(function (e) {\r\n            _this.onEditorMouseUp(e);\r\n        }));\r\n        this.listenersToRemove.add(clickLinkGesture.onCancel(function (e) {\r\n            _this.cleanUpActiveLinkDecoration();\r\n        }));\r\n        this.enabled = editor.getOption(52 /* links */);\r\n        this.listenersToRemove.add(editor.onDidChangeConfiguration(function (e) {\r\n            var enabled = editor.getOption(52 /* links */);\r\n            if (_this.enabled === enabled) {\r\n                // No change in our configuration option\r\n                return;\r\n            }\r\n            _this.enabled = enabled;\r\n            // Remove any links (for the getting disabled case)\r\n            _this.updateDecorations([]);\r\n            // Stop any computation (for the getting disabled case)\r\n            _this.stop();\r\n            // Start computing (for the getting enabled case)\r\n            _this.beginCompute();\r\n        }));\r\n        this.listenersToRemove.add(editor.onDidChangeModelContent(function (e) { return _this.onChange(); }));\r\n        this.listenersToRemove.add(editor.onDidChangeModel(function (e) { return _this.onModelChanged(); }));\r\n        this.listenersToRemove.add(editor.onDidChangeModelLanguage(function (e) { return _this.onModelModeChanged(); }));\r\n        this.listenersToRemove.add(LinkProviderRegistry.onDidChange(function (e) { return _this.onModelModeChanged(); }));\r\n        this.timeout = new async.TimeoutTimer();\r\n        this.computePromise = null;\r\n        this.activeLinksList = null;\r\n        this.currentOccurrences = {};\r\n        this.activeLinkDecorationId = null;\r\n        this.beginCompute();\r\n    }\r\n    LinkDetector.get = function (editor) {\r\n        return editor.getContribution(LinkDetector.ID);\r\n    };\r\n    LinkDetector.prototype.onModelChanged = function () {\r\n        this.currentOccurrences = {};\r\n        this.activeLinkDecorationId = null;\r\n        this.stop();\r\n        this.beginCompute();\r\n    };\r\n    LinkDetector.prototype.onModelModeChanged = function () {\r\n        this.stop();\r\n        this.beginCompute();\r\n    };\r\n    LinkDetector.prototype.onChange = function () {\r\n        var _this = this;\r\n        this.timeout.setIfNotSet(function () { return _this.beginCompute(); }, LinkDetector.RECOMPUTE_TIME);\r\n    };\r\n    LinkDetector.prototype.beginCompute = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, _a, err_1;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!this.editor.hasModel() || !this.enabled) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        model = this.editor.getModel();\r\n                        if (!LinkProviderRegistry.has(model)) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (this.activeLinksList) {\r\n                            this.activeLinksList.dispose();\r\n                            this.activeLinksList = null;\r\n                        }\r\n                        this.computePromise = async.createCancelablePromise(function (token) { return getLinks(model, token); });\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, 4, 5]);\r\n                        _a = this;\r\n                        return [4 /*yield*/, this.computePromise];\r\n                    case 2:\r\n                        _a.activeLinksList = _b.sent();\r\n                        this.updateDecorations(this.activeLinksList.links);\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        err_1 = _b.sent();\r\n                        onUnexpectedError(err_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        this.computePromise = null;\r\n                        return [7 /*endfinally*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LinkDetector.prototype.updateDecorations = function (links) {\r\n        var useMetaKey = (this.editor.getOption(59 /* multiCursorModifier */) === 'altKey');\r\n        var oldDecorations = [];\r\n        var keys = Object.keys(this.currentOccurrences);\r\n        for (var i = 0, len = keys.length; i < len; i++) {\r\n            var decorationId = keys[i];\r\n            var occurance = this.currentOccurrences[decorationId];\r\n            oldDecorations.push(occurance.decorationId);\r\n        }\r\n        var newDecorations = [];\r\n        if (links) {\r\n            // Not sure why this is sometimes null\r\n            for (var _i = 0, links_1 = links; _i < links_1.length; _i++) {\r\n                var link = links_1[_i];\r\n                newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\r\n            }\r\n        }\r\n        var decorations = this.editor.deltaDecorations(oldDecorations, newDecorations);\r\n        this.currentOccurrences = {};\r\n        this.activeLinkDecorationId = null;\r\n        for (var i = 0, len = decorations.length; i < len; i++) {\r\n            var occurance = new LinkOccurrence(links[i], decorations[i]);\r\n            this.currentOccurrences[occurance.decorationId] = occurance;\r\n        }\r\n    };\r\n    LinkDetector.prototype._onEditorMouseMove = function (mouseEvent, withKey) {\r\n        var _this = this;\r\n        var useMetaKey = (this.editor.getOption(59 /* multiCursorModifier */) === 'altKey');\r\n        if (this.isEnabled(mouseEvent, withKey)) {\r\n            this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\r\n            var occurrence_1 = this.getLinkOccurrence(mouseEvent.target.position);\r\n            if (occurrence_1) {\r\n                this.editor.changeDecorations(function (changeAccessor) {\r\n                    occurrence_1.activate(changeAccessor, useMetaKey);\r\n                    _this.activeLinkDecorationId = occurrence_1.decorationId;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.cleanUpActiveLinkDecoration();\r\n        }\r\n    };\r\n    LinkDetector.prototype.cleanUpActiveLinkDecoration = function () {\r\n        var useMetaKey = (this.editor.getOption(59 /* multiCursorModifier */) === 'altKey');\r\n        if (this.activeLinkDecorationId) {\r\n            var occurrence_2 = this.currentOccurrences[this.activeLinkDecorationId];\r\n            if (occurrence_2) {\r\n                this.editor.changeDecorations(function (changeAccessor) {\r\n                    occurrence_2.deactivate(changeAccessor, useMetaKey);\r\n                });\r\n            }\r\n            this.activeLinkDecorationId = null;\r\n        }\r\n    };\r\n    LinkDetector.prototype.onEditorMouseUp = function (mouseEvent) {\r\n        if (!this.isEnabled(mouseEvent)) {\r\n            return;\r\n        }\r\n        var occurrence = this.getLinkOccurrence(mouseEvent.target.position);\r\n        if (!occurrence) {\r\n            return;\r\n        }\r\n        this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true /* from user gesture */);\r\n    };\r\n    LinkDetector.prototype.openLinkOccurrence = function (occurrence, openToSide, fromUserGesture) {\r\n        var _this = this;\r\n        if (fromUserGesture === void 0) { fromUserGesture = false; }\r\n        if (!this.openerService) {\r\n            return;\r\n        }\r\n        var link = occurrence.link;\r\n        link.resolve(CancellationToken.None).then(function (uri) {\r\n            // open the uri\r\n            return _this.openerService.open(uri, { openToSide: openToSide, fromUserGesture: fromUserGesture });\r\n        }, function (err) {\r\n            var messageOrError = err instanceof Error ? err.message : err;\r\n            // different error cases\r\n            if (messageOrError === 'invalid') {\r\n                _this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\r\n            }\r\n            else if (messageOrError === 'missing') {\r\n                _this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\r\n            }\r\n            else {\r\n                onUnexpectedError(err);\r\n            }\r\n        });\r\n    };\r\n    LinkDetector.prototype.getLinkOccurrence = function (position) {\r\n        if (!this.editor.hasModel() || !position) {\r\n            return null;\r\n        }\r\n        var decorations = this.editor.getModel().getDecorationsInRange({\r\n            startLineNumber: position.lineNumber,\r\n            startColumn: position.column,\r\n            endLineNumber: position.lineNumber,\r\n            endColumn: position.column\r\n        }, 0, true);\r\n        for (var _i = 0, decorations_1 = decorations; _i < decorations_1.length; _i++) {\r\n            var decoration_1 = decorations_1[_i];\r\n            var currentOccurrence = this.currentOccurrences[decoration_1.id];\r\n            if (currentOccurrence) {\r\n                return currentOccurrence;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    LinkDetector.prototype.isEnabled = function (mouseEvent, withKey) {\r\n        return Boolean((mouseEvent.target.type === 6 /* CONTENT_TEXT */)\r\n            && (mouseEvent.hasTriggerModifier || (withKey && withKey.keyCodeIsTriggerKey)));\r\n    };\r\n    LinkDetector.prototype.stop = function () {\r\n        this.timeout.cancel();\r\n        if (this.activeLinksList) {\r\n            this.activeLinksList.dispose();\r\n        }\r\n        if (this.computePromise) {\r\n            this.computePromise.cancel();\r\n            this.computePromise = null;\r\n        }\r\n    };\r\n    LinkDetector.prototype.dispose = function () {\r\n        this.listenersToRemove.dispose();\r\n        this.stop();\r\n        this.timeout.dispose();\r\n    };\r\n    LinkDetector.ID = 'editor.linkDetector';\r\n    LinkDetector.RECOMPUTE_TIME = 1000; // ms\r\n    LinkDetector = __decorate([\r\n        __param(1, IOpenerService),\r\n        __param(2, INotificationService)\r\n    ], LinkDetector);\r\n    return LinkDetector;\r\n}());\r\nvar OpenLinkAction = /** @class */ (function (_super) {\r\n    __extends(OpenLinkAction, _super);\r\n    function OpenLinkAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.openLink',\r\n            label: nls.localize('label', \"Open Link\"),\r\n            alias: 'Open Link',\r\n            precondition: undefined\r\n        }) || this;\r\n    }\r\n    OpenLinkAction.prototype.run = function (accessor, editor) {\r\n        var linkDetector = LinkDetector.get(editor);\r\n        if (!linkDetector) {\r\n            return;\r\n        }\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var selections = editor.getSelections();\r\n        for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\r\n            var sel = selections_1[_i];\r\n            var link = linkDetector.getLinkOccurrence(sel.getEndPosition());\r\n            if (link) {\r\n                linkDetector.openLinkOccurrence(link, false);\r\n            }\r\n        }\r\n    };\r\n    return OpenLinkAction;\r\n}(EditorAction));\r\nregisterEditorContribution(LinkDetector.ID, LinkDetector);\r\nregisterEditorAction(OpenLinkAction);\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var activeLinkForeground = theme.getColor(editorActiveLinkForeground);\r\n    if (activeLinkForeground) {\r\n        collector.addRule(\".monaco-editor .detected-link-active { color: \" + activeLinkForeground + \" !important; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}