{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport { HorizontalRange } from '../../../common/view/renderingContext.js';\n\nvar FloatHorizontalRange =\n/** @class */\nfunction () {\n  function FloatHorizontalRange(left, width) {\n    this.left = left;\n    this.width = width;\n  }\n\n  FloatHorizontalRange.prototype.toString = function () {\n    return \"[\" + this.left + \",\" + this.width + \"]\";\n  };\n\n  FloatHorizontalRange.compare = function (a, b) {\n    return a.left - b.left;\n  };\n\n  return FloatHorizontalRange;\n}();\n\nvar RangeUtil =\n/** @class */\nfunction () {\n  function RangeUtil() {}\n\n  RangeUtil._createRange = function () {\n    if (!this._handyReadyRange) {\n      this._handyReadyRange = document.createRange();\n    }\n\n    return this._handyReadyRange;\n  };\n\n  RangeUtil._detachRange = function (range, endNode) {\n    // Move range out of the span node, IE doesn't like having many ranges in\n    // the same spot and will act badly for lines containing dashes ('-')\n    range.selectNodeContents(endNode);\n  };\n\n  RangeUtil._readClientRects = function (startElement, startOffset, endElement, endOffset, endNode) {\n    var range = this._createRange();\n\n    try {\n      range.setStart(startElement, startOffset);\n      range.setEnd(endElement, endOffset);\n      return range.getClientRects();\n    } catch (e) {\n      // This is life ...\n      return null;\n    } finally {\n      this._detachRange(range, endNode);\n    }\n  };\n\n  RangeUtil._mergeAdjacentRanges = function (ranges) {\n    if (ranges.length === 1) {\n      // There is nothing to merge\n      return [new HorizontalRange(ranges[0].left, ranges[0].width)];\n    }\n\n    ranges.sort(FloatHorizontalRange.compare);\n    var result = [],\n        resultLen = 0;\n    var prevLeft = ranges[0].left;\n    var prevWidth = ranges[0].width;\n\n    for (var i = 1, len = ranges.length; i < len; i++) {\n      var range = ranges[i];\n      var myLeft = range.left;\n      var myWidth = range.width;\n\n      if (prevLeft + prevWidth + 0.9\n      /* account for browser's rounding errors*/\n      >= myLeft) {\n        prevWidth = Math.max(prevWidth, myLeft + myWidth - prevLeft);\n      } else {\n        result[resultLen++] = new HorizontalRange(prevLeft, prevWidth);\n        prevLeft = myLeft;\n        prevWidth = myWidth;\n      }\n    }\n\n    result[resultLen++] = new HorizontalRange(prevLeft, prevWidth);\n    return result;\n  };\n\n  RangeUtil._createHorizontalRangesFromClientRects = function (clientRects, clientRectDeltaLeft) {\n    if (!clientRects || clientRects.length === 0) {\n      return null;\n    } // We go through FloatHorizontalRange because it has been observed in bi-di text\n    // that the clientRects are not coming in sorted from the browser\n\n\n    var result = [];\n\n    for (var i = 0, len = clientRects.length; i < len; i++) {\n      var clientRect = clientRects[i];\n      result[i] = new FloatHorizontalRange(Math.max(0, clientRect.left - clientRectDeltaLeft), clientRect.width);\n    }\n\n    return this._mergeAdjacentRanges(result);\n  };\n\n  RangeUtil.readHorizontalRanges = function (domNode, startChildIndex, startOffset, endChildIndex, endOffset, clientRectDeltaLeft, endNode) {\n    // Panic check\n    var min = 0;\n    var max = domNode.children.length - 1;\n\n    if (min > max) {\n      return null;\n    }\n\n    startChildIndex = Math.min(max, Math.max(min, startChildIndex));\n    endChildIndex = Math.min(max, Math.max(min, endChildIndex)); // If crossing over to a span only to select offset 0, then use the previous span's maximum offset\n    // Chrome is buggy and doesn't handle 0 offsets well sometimes.\n\n    if (startChildIndex !== endChildIndex) {\n      if (endChildIndex > 0 && endOffset === 0) {\n        endChildIndex--;\n        endOffset = 1073741824\n        /* MAX_SAFE_SMALL_INTEGER */\n        ;\n      }\n    }\n\n    var startElement = domNode.children[startChildIndex].firstChild;\n    var endElement = domNode.children[endChildIndex].firstChild;\n\n    if (!startElement || !endElement) {\n      // When having an empty <span> (without any text content), try to move to the previous <span>\n      if (!startElement && startOffset === 0 && startChildIndex > 0) {\n        startElement = domNode.children[startChildIndex - 1].firstChild;\n        startOffset = 1073741824\n        /* MAX_SAFE_SMALL_INTEGER */\n        ;\n      }\n\n      if (!endElement && endOffset === 0 && endChildIndex > 0) {\n        endElement = domNode.children[endChildIndex - 1].firstChild;\n        endOffset = 1073741824\n        /* MAX_SAFE_SMALL_INTEGER */\n        ;\n      }\n    }\n\n    if (!startElement || !endElement) {\n      return null;\n    }\n\n    startOffset = Math.min(startElement.textContent.length, Math.max(0, startOffset));\n    endOffset = Math.min(endElement.textContent.length, Math.max(0, endOffset));\n\n    var clientRects = this._readClientRects(startElement, startOffset, endElement, endOffset, endNode);\n\n    return this._createHorizontalRangesFromClientRects(clientRects, clientRectDeltaLeft);\n  };\n\n  return RangeUtil;\n}();\n\nexport { RangeUtil };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/viewParts/lines/rangeUtil.js"],"names":["HorizontalRange","FloatHorizontalRange","left","width","prototype","toString","compare","a","b","RangeUtil","_createRange","_handyReadyRange","document","createRange","_detachRange","range","endNode","selectNodeContents","_readClientRects","startElement","startOffset","endElement","endOffset","setStart","setEnd","getClientRects","e","_mergeAdjacentRanges","ranges","length","sort","result","resultLen","prevLeft","prevWidth","i","len","myLeft","myWidth","Math","max","_createHorizontalRangesFromClientRects","clientRects","clientRectDeltaLeft","clientRect","readHorizontalRanges","domNode","startChildIndex","endChildIndex","min","children","firstChild","textContent"],"mappings":"AAAA;;;;AAIA,SAASA,eAAT,QAAgC,0CAAhC;;AACA,IAAIC,oBAAoB;AAAG;AAAe,YAAY;AAClD,WAASA,oBAAT,CAA8BC,IAA9B,EAAoCC,KAApC,EAA2C;AACvC,SAAKD,IAAL,GAAYA,IAAZ;AACA,SAAKC,KAAL,GAAaA,KAAb;AACH;;AACDF,EAAAA,oBAAoB,CAACG,SAArB,CAA+BC,QAA/B,GAA0C,YAAY;AAClD,WAAO,MAAM,KAAKH,IAAX,GAAkB,GAAlB,GAAwB,KAAKC,KAA7B,GAAqC,GAA5C;AACH,GAFD;;AAGAF,EAAAA,oBAAoB,CAACK,OAArB,GAA+B,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC3C,WAAOD,CAAC,CAACL,IAAF,GAASM,CAAC,CAACN,IAAlB;AACH,GAFD;;AAGA,SAAOD,oBAAP;AACH,CAZyC,EAA1C;;AAaA,IAAIQ,SAAS;AAAG;AAAe,YAAY;AACvC,WAASA,SAAT,GAAqB,CACpB;;AACDA,EAAAA,SAAS,CAACC,YAAV,GAAyB,YAAY;AACjC,QAAI,CAAC,KAAKC,gBAAV,EAA4B;AACxB,WAAKA,gBAAL,GAAwBC,QAAQ,CAACC,WAAT,EAAxB;AACH;;AACD,WAAO,KAAKF,gBAAZ;AACH,GALD;;AAMAF,EAAAA,SAAS,CAACK,YAAV,GAAyB,UAAUC,KAAV,EAAiBC,OAAjB,EAA0B;AAC/C;AACA;AACAD,IAAAA,KAAK,CAACE,kBAAN,CAAyBD,OAAzB;AACH,GAJD;;AAKAP,EAAAA,SAAS,CAACS,gBAAV,GAA6B,UAAUC,YAAV,EAAwBC,WAAxB,EAAqCC,UAArC,EAAiDC,SAAjD,EAA4DN,OAA5D,EAAqE;AAC9F,QAAID,KAAK,GAAG,KAAKL,YAAL,EAAZ;;AACA,QAAI;AACAK,MAAAA,KAAK,CAACQ,QAAN,CAAeJ,YAAf,EAA6BC,WAA7B;AACAL,MAAAA,KAAK,CAACS,MAAN,CAAaH,UAAb,EAAyBC,SAAzB;AACA,aAAOP,KAAK,CAACU,cAAN,EAAP;AACH,KAJD,CAKA,OAAOC,CAAP,EAAU;AACN;AACA,aAAO,IAAP;AACH,KARD,SASQ;AACJ,WAAKZ,YAAL,CAAkBC,KAAlB,EAAyBC,OAAzB;AACH;AACJ,GAdD;;AAeAP,EAAAA,SAAS,CAACkB,oBAAV,GAAiC,UAAUC,MAAV,EAAkB;AAC/C,QAAIA,MAAM,CAACC,MAAP,KAAkB,CAAtB,EAAyB;AACrB;AACA,aAAO,CAAC,IAAI7B,eAAJ,CAAoB4B,MAAM,CAAC,CAAD,CAAN,CAAU1B,IAA9B,EAAoC0B,MAAM,CAAC,CAAD,CAAN,CAAUzB,KAA9C,CAAD,CAAP;AACH;;AACDyB,IAAAA,MAAM,CAACE,IAAP,CAAY7B,oBAAoB,CAACK,OAAjC;AACA,QAAIyB,MAAM,GAAG,EAAb;AAAA,QAAiBC,SAAS,GAAG,CAA7B;AACA,QAAIC,QAAQ,GAAGL,MAAM,CAAC,CAAD,CAAN,CAAU1B,IAAzB;AACA,QAAIgC,SAAS,GAAGN,MAAM,CAAC,CAAD,CAAN,CAAUzB,KAA1B;;AACA,SAAK,IAAIgC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGR,MAAM,CAACC,MAA7B,EAAqCM,CAAC,GAAGC,GAAzC,EAA8CD,CAAC,EAA/C,EAAmD;AAC/C,UAAIpB,KAAK,GAAGa,MAAM,CAACO,CAAD,CAAlB;AACA,UAAIE,MAAM,GAAGtB,KAAK,CAACb,IAAnB;AACA,UAAIoC,OAAO,GAAGvB,KAAK,CAACZ,KAApB;;AACA,UAAI8B,QAAQ,GAAGC,SAAX,GAAuB;AAAI;AAA3B,SAAyEG,MAA7E,EAAqF;AACjFH,QAAAA,SAAS,GAAGK,IAAI,CAACC,GAAL,CAASN,SAAT,EAAoBG,MAAM,GAAGC,OAAT,GAAmBL,QAAvC,CAAZ;AACH,OAFD,MAGK;AACDF,QAAAA,MAAM,CAACC,SAAS,EAAV,CAAN,GAAsB,IAAIhC,eAAJ,CAAoBiC,QAApB,EAA8BC,SAA9B,CAAtB;AACAD,QAAAA,QAAQ,GAAGI,MAAX;AACAH,QAAAA,SAAS,GAAGI,OAAZ;AACH;AACJ;;AACDP,IAAAA,MAAM,CAACC,SAAS,EAAV,CAAN,GAAsB,IAAIhC,eAAJ,CAAoBiC,QAApB,EAA8BC,SAA9B,CAAtB;AACA,WAAOH,MAAP;AACH,GAxBD;;AAyBAtB,EAAAA,SAAS,CAACgC,sCAAV,GAAmD,UAAUC,WAAV,EAAuBC,mBAAvB,EAA4C;AAC3F,QAAI,CAACD,WAAD,IAAgBA,WAAW,CAACb,MAAZ,KAAuB,CAA3C,EAA8C;AAC1C,aAAO,IAAP;AACH,KAH0F,CAI3F;AACA;;;AACA,QAAIE,MAAM,GAAG,EAAb;;AACA,SAAK,IAAII,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGM,WAAW,CAACb,MAAlC,EAA0CM,CAAC,GAAGC,GAA9C,EAAmDD,CAAC,EAApD,EAAwD;AACpD,UAAIS,UAAU,GAAGF,WAAW,CAACP,CAAD,CAA5B;AACAJ,MAAAA,MAAM,CAACI,CAAD,CAAN,GAAY,IAAIlC,oBAAJ,CAAyBsC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYI,UAAU,CAAC1C,IAAX,GAAkByC,mBAA9B,CAAzB,EAA6EC,UAAU,CAACzC,KAAxF,CAAZ;AACH;;AACD,WAAO,KAAKwB,oBAAL,CAA0BI,MAA1B,CAAP;AACH,GAZD;;AAaAtB,EAAAA,SAAS,CAACoC,oBAAV,GAAiC,UAAUC,OAAV,EAAmBC,eAAnB,EAAoC3B,WAApC,EAAiD4B,aAAjD,EAAgE1B,SAAhE,EAA2EqB,mBAA3E,EAAgG3B,OAAhG,EAAyG;AACtI;AACA,QAAIiC,GAAG,GAAG,CAAV;AACA,QAAIT,GAAG,GAAGM,OAAO,CAACI,QAAR,CAAiBrB,MAAjB,GAA0B,CAApC;;AACA,QAAIoB,GAAG,GAAGT,GAAV,EAAe;AACX,aAAO,IAAP;AACH;;AACDO,IAAAA,eAAe,GAAGR,IAAI,CAACU,GAAL,CAAST,GAAT,EAAcD,IAAI,CAACC,GAAL,CAASS,GAAT,EAAcF,eAAd,CAAd,CAAlB;AACAC,IAAAA,aAAa,GAAGT,IAAI,CAACU,GAAL,CAAST,GAAT,EAAcD,IAAI,CAACC,GAAL,CAASS,GAAT,EAAcD,aAAd,CAAd,CAAhB,CARsI,CAStI;AACA;;AACA,QAAID,eAAe,KAAKC,aAAxB,EAAuC;AACnC,UAAIA,aAAa,GAAG,CAAhB,IAAqB1B,SAAS,KAAK,CAAvC,EAA0C;AACtC0B,QAAAA,aAAa;AACb1B,QAAAA,SAAS,GAAG;AAAW;AAAvB;AACH;AACJ;;AACD,QAAIH,YAAY,GAAG2B,OAAO,CAACI,QAAR,CAAiBH,eAAjB,EAAkCI,UAArD;AACA,QAAI9B,UAAU,GAAGyB,OAAO,CAACI,QAAR,CAAiBF,aAAjB,EAAgCG,UAAjD;;AACA,QAAI,CAAChC,YAAD,IAAiB,CAACE,UAAtB,EAAkC;AAC9B;AACA,UAAI,CAACF,YAAD,IAAiBC,WAAW,KAAK,CAAjC,IAAsC2B,eAAe,GAAG,CAA5D,EAA+D;AAC3D5B,QAAAA,YAAY,GAAG2B,OAAO,CAACI,QAAR,CAAiBH,eAAe,GAAG,CAAnC,EAAsCI,UAArD;AACA/B,QAAAA,WAAW,GAAG;AAAW;AAAzB;AACH;;AACD,UAAI,CAACC,UAAD,IAAeC,SAAS,KAAK,CAA7B,IAAkC0B,aAAa,GAAG,CAAtD,EAAyD;AACrD3B,QAAAA,UAAU,GAAGyB,OAAO,CAACI,QAAR,CAAiBF,aAAa,GAAG,CAAjC,EAAoCG,UAAjD;AACA7B,QAAAA,SAAS,GAAG;AAAW;AAAvB;AACH;AACJ;;AACD,QAAI,CAACH,YAAD,IAAiB,CAACE,UAAtB,EAAkC;AAC9B,aAAO,IAAP;AACH;;AACDD,IAAAA,WAAW,GAAGmB,IAAI,CAACU,GAAL,CAAS9B,YAAY,CAACiC,WAAb,CAAyBvB,MAAlC,EAA0CU,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYpB,WAAZ,CAA1C,CAAd;AACAE,IAAAA,SAAS,GAAGiB,IAAI,CAACU,GAAL,CAAS5B,UAAU,CAAC+B,WAAX,CAAuBvB,MAAhC,EAAwCU,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYlB,SAAZ,CAAxC,CAAZ;;AACA,QAAIoB,WAAW,GAAG,KAAKxB,gBAAL,CAAsBC,YAAtB,EAAoCC,WAApC,EAAiDC,UAAjD,EAA6DC,SAA7D,EAAwEN,OAAxE,CAAlB;;AACA,WAAO,KAAKyB,sCAAL,CAA4CC,WAA5C,EAAyDC,mBAAzD,CAAP;AACH,GArCD;;AAsCA,SAAOlC,SAAP;AACH,CA1G8B,EAA/B;;AA2GA,SAASA,SAAT","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { HorizontalRange } from '../../../common/view/renderingContext.js';\r\nvar FloatHorizontalRange = /** @class */ (function () {\r\n    function FloatHorizontalRange(left, width) {\r\n        this.left = left;\r\n        this.width = width;\r\n    }\r\n    FloatHorizontalRange.prototype.toString = function () {\r\n        return \"[\" + this.left + \",\" + this.width + \"]\";\r\n    };\r\n    FloatHorizontalRange.compare = function (a, b) {\r\n        return a.left - b.left;\r\n    };\r\n    return FloatHorizontalRange;\r\n}());\r\nvar RangeUtil = /** @class */ (function () {\r\n    function RangeUtil() {\r\n    }\r\n    RangeUtil._createRange = function () {\r\n        if (!this._handyReadyRange) {\r\n            this._handyReadyRange = document.createRange();\r\n        }\r\n        return this._handyReadyRange;\r\n    };\r\n    RangeUtil._detachRange = function (range, endNode) {\r\n        // Move range out of the span node, IE doesn't like having many ranges in\r\n        // the same spot and will act badly for lines containing dashes ('-')\r\n        range.selectNodeContents(endNode);\r\n    };\r\n    RangeUtil._readClientRects = function (startElement, startOffset, endElement, endOffset, endNode) {\r\n        var range = this._createRange();\r\n        try {\r\n            range.setStart(startElement, startOffset);\r\n            range.setEnd(endElement, endOffset);\r\n            return range.getClientRects();\r\n        }\r\n        catch (e) {\r\n            // This is life ...\r\n            return null;\r\n        }\r\n        finally {\r\n            this._detachRange(range, endNode);\r\n        }\r\n    };\r\n    RangeUtil._mergeAdjacentRanges = function (ranges) {\r\n        if (ranges.length === 1) {\r\n            // There is nothing to merge\r\n            return [new HorizontalRange(ranges[0].left, ranges[0].width)];\r\n        }\r\n        ranges.sort(FloatHorizontalRange.compare);\r\n        var result = [], resultLen = 0;\r\n        var prevLeft = ranges[0].left;\r\n        var prevWidth = ranges[0].width;\r\n        for (var i = 1, len = ranges.length; i < len; i++) {\r\n            var range = ranges[i];\r\n            var myLeft = range.left;\r\n            var myWidth = range.width;\r\n            if (prevLeft + prevWidth + 0.9 /* account for browser's rounding errors*/ >= myLeft) {\r\n                prevWidth = Math.max(prevWidth, myLeft + myWidth - prevLeft);\r\n            }\r\n            else {\r\n                result[resultLen++] = new HorizontalRange(prevLeft, prevWidth);\r\n                prevLeft = myLeft;\r\n                prevWidth = myWidth;\r\n            }\r\n        }\r\n        result[resultLen++] = new HorizontalRange(prevLeft, prevWidth);\r\n        return result;\r\n    };\r\n    RangeUtil._createHorizontalRangesFromClientRects = function (clientRects, clientRectDeltaLeft) {\r\n        if (!clientRects || clientRects.length === 0) {\r\n            return null;\r\n        }\r\n        // We go through FloatHorizontalRange because it has been observed in bi-di text\r\n        // that the clientRects are not coming in sorted from the browser\r\n        var result = [];\r\n        for (var i = 0, len = clientRects.length; i < len; i++) {\r\n            var clientRect = clientRects[i];\r\n            result[i] = new FloatHorizontalRange(Math.max(0, clientRect.left - clientRectDeltaLeft), clientRect.width);\r\n        }\r\n        return this._mergeAdjacentRanges(result);\r\n    };\r\n    RangeUtil.readHorizontalRanges = function (domNode, startChildIndex, startOffset, endChildIndex, endOffset, clientRectDeltaLeft, endNode) {\r\n        // Panic check\r\n        var min = 0;\r\n        var max = domNode.children.length - 1;\r\n        if (min > max) {\r\n            return null;\r\n        }\r\n        startChildIndex = Math.min(max, Math.max(min, startChildIndex));\r\n        endChildIndex = Math.min(max, Math.max(min, endChildIndex));\r\n        // If crossing over to a span only to select offset 0, then use the previous span's maximum offset\r\n        // Chrome is buggy and doesn't handle 0 offsets well sometimes.\r\n        if (startChildIndex !== endChildIndex) {\r\n            if (endChildIndex > 0 && endOffset === 0) {\r\n                endChildIndex--;\r\n                endOffset = 1073741824 /* MAX_SAFE_SMALL_INTEGER */;\r\n            }\r\n        }\r\n        var startElement = domNode.children[startChildIndex].firstChild;\r\n        var endElement = domNode.children[endChildIndex].firstChild;\r\n        if (!startElement || !endElement) {\r\n            // When having an empty <span> (without any text content), try to move to the previous <span>\r\n            if (!startElement && startOffset === 0 && startChildIndex > 0) {\r\n                startElement = domNode.children[startChildIndex - 1].firstChild;\r\n                startOffset = 1073741824 /* MAX_SAFE_SMALL_INTEGER */;\r\n            }\r\n            if (!endElement && endOffset === 0 && endChildIndex > 0) {\r\n                endElement = domNode.children[endChildIndex - 1].firstChild;\r\n                endOffset = 1073741824 /* MAX_SAFE_SMALL_INTEGER */;\r\n            }\r\n        }\r\n        if (!startElement || !endElement) {\r\n            return null;\r\n        }\r\n        startOffset = Math.min(startElement.textContent.length, Math.max(0, startOffset));\r\n        endOffset = Math.min(endElement.textContent.length, Math.max(0, endOffset));\r\n        var clientRects = this._readClientRects(startElement, startOffset, endElement, endOffset, endNode);\r\n        return this._createHorizontalRangesFromClientRects(clientRects, clientRectDeltaLeft);\r\n    };\r\n    return RangeUtil;\r\n}());\r\nexport { RangeUtil };\r\n"]},"metadata":{},"sourceType":"module"}