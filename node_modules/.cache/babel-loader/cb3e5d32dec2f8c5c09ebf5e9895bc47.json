{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport * as nls from '../../../nls.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { registerEditorAction, EditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { IEditorWorkerService } from '../../common/services/editorWorkerService.js';\nimport { InPlaceReplaceCommand } from './inPlaceReplaceCommand.js';\nimport { EditorState } from '../../browser/core/editorState.js';\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { editorBracketMatchBorder } from '../../common/view/editorColorRegistry.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\nimport { createCancelablePromise, timeout } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\n\nvar InPlaceReplaceController =\n/** @class */\nfunction () {\n  function InPlaceReplaceController(editor, editorWorkerService) {\n    this.decorationIds = [];\n    this.editor = editor;\n    this.editorWorkerService = editorWorkerService;\n  }\n\n  InPlaceReplaceController.get = function (editor) {\n    return editor.getContribution(InPlaceReplaceController.ID);\n  };\n\n  InPlaceReplaceController.prototype.dispose = function () {};\n\n  InPlaceReplaceController.prototype.run = function (source, up) {\n    var _this = this; // cancel any pending request\n\n\n    if (this.currentRequest) {\n      this.currentRequest.cancel();\n    }\n\n    var editorSelection = this.editor.getSelection();\n    var model = this.editor.getModel();\n\n    if (!model || !editorSelection) {\n      return undefined;\n    }\n\n    var selection = editorSelection;\n\n    if (selection.startLineNumber !== selection.endLineNumber) {\n      // Can't accept multiline selection\n      return undefined;\n    }\n\n    var state = new EditorState(this.editor, 1\n    /* Value */\n    | 4\n    /* Position */\n    );\n    var modelURI = model.uri;\n\n    if (!this.editorWorkerService.canNavigateValueSet(modelURI)) {\n      return Promise.resolve(undefined);\n    }\n\n    this.currentRequest = createCancelablePromise(function (token) {\n      return _this.editorWorkerService.navigateValueSet(modelURI, selection, up);\n    });\n    return this.currentRequest.then(function (result) {\n      if (!result || !result.range || !result.value) {\n        // No proper result\n        return;\n      }\n\n      if (!state.validate(_this.editor)) {\n        // state has changed\n        return;\n      } // Selection\n\n\n      var editRange = Range.lift(result.range);\n      var highlightRange = result.range;\n      var diff = result.value.length - (selection.endColumn - selection.startColumn); // highlight\n\n      highlightRange = {\n        startLineNumber: highlightRange.startLineNumber,\n        startColumn: highlightRange.startColumn,\n        endLineNumber: highlightRange.endLineNumber,\n        endColumn: highlightRange.startColumn + result.value.length\n      };\n\n      if (diff > 1) {\n        selection = new Selection(selection.startLineNumber, selection.startColumn, selection.endLineNumber, selection.endColumn + diff - 1);\n      } // Insert new text\n\n\n      var command = new InPlaceReplaceCommand(editRange, selection, result.value);\n\n      _this.editor.pushUndoStop();\n\n      _this.editor.executeCommand(source, command);\n\n      _this.editor.pushUndoStop(); // add decoration\n\n\n      _this.decorationIds = _this.editor.deltaDecorations(_this.decorationIds, [{\n        range: highlightRange,\n        options: InPlaceReplaceController.DECORATION\n      }]); // remove decoration after delay\n\n      if (_this.decorationRemover) {\n        _this.decorationRemover.cancel();\n      }\n\n      _this.decorationRemover = timeout(350);\n\n      _this.decorationRemover.then(function () {\n        return _this.decorationIds = _this.editor.deltaDecorations(_this.decorationIds, []);\n      }).catch(onUnexpectedError);\n    }).catch(onUnexpectedError);\n  };\n\n  InPlaceReplaceController.ID = 'editor.contrib.inPlaceReplaceController';\n  InPlaceReplaceController.DECORATION = ModelDecorationOptions.register({\n    className: 'valueSetReplacement'\n  });\n  InPlaceReplaceController = __decorate([__param(1, IEditorWorkerService)], InPlaceReplaceController);\n  return InPlaceReplaceController;\n}();\n\nvar InPlaceReplaceUp =\n/** @class */\nfunction (_super) {\n  __extends(InPlaceReplaceUp, _super);\n\n  function InPlaceReplaceUp() {\n    return _super.call(this, {\n      id: 'editor.action.inPlaceReplace.up',\n      label: nls.localize('InPlaceReplaceAction.previous.label', \"Replace with Previous Value\"),\n      alias: 'Replace with Previous Value',\n      precondition: EditorContextKeys.writable,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 82\n        /* US_COMMA */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  InPlaceReplaceUp.prototype.run = function (accessor, editor) {\n    var controller = InPlaceReplaceController.get(editor);\n\n    if (!controller) {\n      return Promise.resolve(undefined);\n    }\n\n    return controller.run(this.id, true);\n  };\n\n  return InPlaceReplaceUp;\n}(EditorAction);\n\nvar InPlaceReplaceDown =\n/** @class */\nfunction (_super) {\n  __extends(InPlaceReplaceDown, _super);\n\n  function InPlaceReplaceDown() {\n    return _super.call(this, {\n      id: 'editor.action.inPlaceReplace.down',\n      label: nls.localize('InPlaceReplaceAction.next.label', \"Replace with Next Value\"),\n      alias: 'Replace with Next Value',\n      precondition: EditorContextKeys.writable,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 84\n        /* US_DOT */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  InPlaceReplaceDown.prototype.run = function (accessor, editor) {\n    var controller = InPlaceReplaceController.get(editor);\n\n    if (!controller) {\n      return Promise.resolve(undefined);\n    }\n\n    return controller.run(this.id, false);\n  };\n\n  return InPlaceReplaceDown;\n}(EditorAction);\n\nregisterEditorContribution(InPlaceReplaceController.ID, InPlaceReplaceController);\nregisterEditorAction(InPlaceReplaceUp);\nregisterEditorAction(InPlaceReplaceDown);\nregisterThemingParticipant(function (theme, collector) {\n  var border = theme.getColor(editorBracketMatchBorder);\n\n  if (border) {\n    collector.addRule(\".monaco-editor.vs .valueSetReplacement { outline: solid 2px \" + border + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/inPlaceReplace/inPlaceReplace.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","nls","Range","Selection","EditorContextKeys","registerEditorAction","EditorAction","registerEditorContribution","IEditorWorkerService","InPlaceReplaceCommand","EditorState","registerThemingParticipant","editorBracketMatchBorder","ModelDecorationOptions","createCancelablePromise","timeout","onUnexpectedError","InPlaceReplaceController","editor","editorWorkerService","decorationIds","get","getContribution","ID","dispose","run","source","up","_this","currentRequest","cancel","editorSelection","getSelection","model","getModel","undefined","selection","startLineNumber","endLineNumber","state","modelURI","uri","canNavigateValueSet","Promise","resolve","token","navigateValueSet","then","result","range","value","validate","editRange","lift","highlightRange","diff","endColumn","startColumn","command","pushUndoStop","executeCommand","deltaDecorations","options","DECORATION","decorationRemover","catch","register","className","InPlaceReplaceUp","_super","call","id","label","localize","alias","precondition","writable","kbOpts","kbExpr","editorTextFocus","primary","weight","accessor","controller","InPlaceReplaceDown","theme","collector","border","getColor","addRule"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport * as nls from '../../../nls.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { registerEditorAction, EditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { IEditorWorkerService } from '../../common/services/editorWorkerService.js';\r\nimport { InPlaceReplaceCommand } from './inPlaceReplaceCommand.js';\r\nimport { EditorState } from '../../browser/core/editorState.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { editorBracketMatchBorder } from '../../common/view/editorColorRegistry.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { createCancelablePromise, timeout } from '../../../base/common/async.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nvar InPlaceReplaceController = /** @class */ (function () {\r\n    function InPlaceReplaceController(editor, editorWorkerService) {\r\n        this.decorationIds = [];\r\n        this.editor = editor;\r\n        this.editorWorkerService = editorWorkerService;\r\n    }\r\n    InPlaceReplaceController.get = function (editor) {\r\n        return editor.getContribution(InPlaceReplaceController.ID);\r\n    };\r\n    InPlaceReplaceController.prototype.dispose = function () {\r\n    };\r\n    InPlaceReplaceController.prototype.run = function (source, up) {\r\n        var _this = this;\r\n        // cancel any pending request\r\n        if (this.currentRequest) {\r\n            this.currentRequest.cancel();\r\n        }\r\n        var editorSelection = this.editor.getSelection();\r\n        var model = this.editor.getModel();\r\n        if (!model || !editorSelection) {\r\n            return undefined;\r\n        }\r\n        var selection = editorSelection;\r\n        if (selection.startLineNumber !== selection.endLineNumber) {\r\n            // Can't accept multiline selection\r\n            return undefined;\r\n        }\r\n        var state = new EditorState(this.editor, 1 /* Value */ | 4 /* Position */);\r\n        var modelURI = model.uri;\r\n        if (!this.editorWorkerService.canNavigateValueSet(modelURI)) {\r\n            return Promise.resolve(undefined);\r\n        }\r\n        this.currentRequest = createCancelablePromise(function (token) { return _this.editorWorkerService.navigateValueSet(modelURI, selection, up); });\r\n        return this.currentRequest.then(function (result) {\r\n            if (!result || !result.range || !result.value) {\r\n                // No proper result\r\n                return;\r\n            }\r\n            if (!state.validate(_this.editor)) {\r\n                // state has changed\r\n                return;\r\n            }\r\n            // Selection\r\n            var editRange = Range.lift(result.range);\r\n            var highlightRange = result.range;\r\n            var diff = result.value.length - (selection.endColumn - selection.startColumn);\r\n            // highlight\r\n            highlightRange = {\r\n                startLineNumber: highlightRange.startLineNumber,\r\n                startColumn: highlightRange.startColumn,\r\n                endLineNumber: highlightRange.endLineNumber,\r\n                endColumn: highlightRange.startColumn + result.value.length\r\n            };\r\n            if (diff > 1) {\r\n                selection = new Selection(selection.startLineNumber, selection.startColumn, selection.endLineNumber, selection.endColumn + diff - 1);\r\n            }\r\n            // Insert new text\r\n            var command = new InPlaceReplaceCommand(editRange, selection, result.value);\r\n            _this.editor.pushUndoStop();\r\n            _this.editor.executeCommand(source, command);\r\n            _this.editor.pushUndoStop();\r\n            // add decoration\r\n            _this.decorationIds = _this.editor.deltaDecorations(_this.decorationIds, [{\r\n                    range: highlightRange,\r\n                    options: InPlaceReplaceController.DECORATION\r\n                }]);\r\n            // remove decoration after delay\r\n            if (_this.decorationRemover) {\r\n                _this.decorationRemover.cancel();\r\n            }\r\n            _this.decorationRemover = timeout(350);\r\n            _this.decorationRemover.then(function () { return _this.decorationIds = _this.editor.deltaDecorations(_this.decorationIds, []); }).catch(onUnexpectedError);\r\n        }).catch(onUnexpectedError);\r\n    };\r\n    InPlaceReplaceController.ID = 'editor.contrib.inPlaceReplaceController';\r\n    InPlaceReplaceController.DECORATION = ModelDecorationOptions.register({\r\n        className: 'valueSetReplacement'\r\n    });\r\n    InPlaceReplaceController = __decorate([\r\n        __param(1, IEditorWorkerService)\r\n    ], InPlaceReplaceController);\r\n    return InPlaceReplaceController;\r\n}());\r\nvar InPlaceReplaceUp = /** @class */ (function (_super) {\r\n    __extends(InPlaceReplaceUp, _super);\r\n    function InPlaceReplaceUp() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.inPlaceReplace.up',\r\n            label: nls.localize('InPlaceReplaceAction.previous.label', \"Replace with Previous Value\"),\r\n            alias: 'Replace with Previous Value',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 82 /* US_COMMA */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    InPlaceReplaceUp.prototype.run = function (accessor, editor) {\r\n        var controller = InPlaceReplaceController.get(editor);\r\n        if (!controller) {\r\n            return Promise.resolve(undefined);\r\n        }\r\n        return controller.run(this.id, true);\r\n    };\r\n    return InPlaceReplaceUp;\r\n}(EditorAction));\r\nvar InPlaceReplaceDown = /** @class */ (function (_super) {\r\n    __extends(InPlaceReplaceDown, _super);\r\n    function InPlaceReplaceDown() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.inPlaceReplace.down',\r\n            label: nls.localize('InPlaceReplaceAction.next.label', \"Replace with Next Value\"),\r\n            alias: 'Replace with Next Value',\r\n            precondition: EditorContextKeys.writable,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 84 /* US_DOT */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    InPlaceReplaceDown.prototype.run = function (accessor, editor) {\r\n        var controller = InPlaceReplaceController.get(editor);\r\n        if (!controller) {\r\n            return Promise.resolve(undefined);\r\n        }\r\n        return controller.run(this.id, false);\r\n    };\r\n    return InPlaceReplaceDown;\r\n}(EditorAction));\r\nregisterEditorContribution(InPlaceReplaceController.ID, InPlaceReplaceController);\r\nregisterEditorAction(InPlaceReplaceUp);\r\nregisterEditorAction(InPlaceReplaceDown);\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var border = theme.getColor(editorBracketMatchBorder);\r\n    if (border) {\r\n        collector.addRule(\".monaco-editor.vs .valueSetReplacement { outline: solid 2px \" + border + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}