{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport * as nls from '../../../nls.js';\nimport * as arrays from '../../../base/common/arrays.js';\nimport { createCancelablePromise, first, timeout } from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError, onUnexpectedExternalError } from '../../../base/common/errors.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerModelAndPositionCommand } from '../../browser/editorExtensions.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { OverviewRulerLane } from '../../common/model.js';\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\nimport { DocumentHighlightKind, DocumentHighlightProviderRegistry } from '../../common/modes.js';\nimport { IContextKeyService, RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\nimport { activeContrastBorder, editorSelectionHighlight, editorSelectionHighlightBorder, overviewRulerSelectionHighlightForeground, registerColor } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant, themeColorFromId } from '../../../platform/theme/common/themeService.js';\nvar editorWordHighlight = registerColor('editor.wordHighlightBackground', {\n  dark: '#575757B8',\n  light: '#57575740',\n  hc: null\n}, nls.localize('wordHighlight', 'Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations.'), true);\nvar editorWordHighlightStrong = registerColor('editor.wordHighlightStrongBackground', {\n  dark: '#004972B8',\n  light: '#0e639c40',\n  hc: null\n}, nls.localize('wordHighlightStrong', 'Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations.'), true);\nvar editorWordHighlightBorder = registerColor('editor.wordHighlightBorder', {\n  light: null,\n  dark: null,\n  hc: activeContrastBorder\n}, nls.localize('wordHighlightBorder', 'Border color of a symbol during read-access, like reading a variable.'));\nvar editorWordHighlightStrongBorder = registerColor('editor.wordHighlightStrongBorder', {\n  light: null,\n  dark: null,\n  hc: activeContrastBorder\n}, nls.localize('wordHighlightStrongBorder', 'Border color of a symbol during write-access, like writing to a variable.'));\nvar overviewRulerWordHighlightForeground = registerColor('editorOverviewRuler.wordHighlightForeground', {\n  dark: '#A0A0A0CC',\n  light: '#A0A0A0CC',\n  hc: '#A0A0A0CC'\n}, nls.localize('overviewRulerWordHighlightForeground', 'Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations.'), true);\nvar overviewRulerWordHighlightStrongForeground = registerColor('editorOverviewRuler.wordHighlightStrongForeground', {\n  dark: '#C0A0C0CC',\n  light: '#C0A0C0CC',\n  hc: '#C0A0C0CC'\n}, nls.localize('overviewRulerWordHighlightStrongForeground', 'Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations.'), true);\nvar ctxHasWordHighlights = new RawContextKey('hasWordHighlights', false);\nexport function getOccurrencesAtPosition(model, position, token) {\n  var orderedByScore = DocumentHighlightProviderRegistry.ordered(model); // in order of score ask the occurrences provider\n  // until someone response with a good result\n  // (good = none empty array)\n\n  return first(orderedByScore.map(function (provider) {\n    return function () {\n      return Promise.resolve(provider.provideDocumentHighlights(model, position, token)).then(undefined, onUnexpectedExternalError);\n    };\n  }), arrays.isNonEmptyArray);\n}\n\nvar OccurenceAtPositionRequest =\n/** @class */\nfunction () {\n  function OccurenceAtPositionRequest(model, selection, wordSeparators) {\n    var _this = this;\n\n    this._wordRange = this._getCurrentWordRange(model, selection);\n    this.result = createCancelablePromise(function (token) {\n      return _this._compute(model, selection, wordSeparators, token);\n    });\n  }\n\n  OccurenceAtPositionRequest.prototype._getCurrentWordRange = function (model, selection) {\n    var word = model.getWordAtPosition(selection.getPosition());\n\n    if (word) {\n      return new Range(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);\n    }\n\n    return null;\n  };\n\n  OccurenceAtPositionRequest.prototype.isValid = function (model, selection, decorationIds) {\n    var lineNumber = selection.startLineNumber;\n    var startColumn = selection.startColumn;\n    var endColumn = selection.endColumn;\n\n    var currentWordRange = this._getCurrentWordRange(model, selection);\n\n    var requestIsValid = Boolean(this._wordRange && this._wordRange.equalsRange(currentWordRange)); // Even if we are on a different word, if that word is in the decorations ranges, the request is still valid\n    // (Same symbol)\n\n    for (var i = 0, len = decorationIds.length; !requestIsValid && i < len; i++) {\n      var range = model.getDecorationRange(decorationIds[i]);\n\n      if (range && range.startLineNumber === lineNumber) {\n        if (range.startColumn <= startColumn && range.endColumn >= endColumn) {\n          requestIsValid = true;\n        }\n      }\n    }\n\n    return requestIsValid;\n  };\n\n  OccurenceAtPositionRequest.prototype.cancel = function () {\n    this.result.cancel();\n  };\n\n  return OccurenceAtPositionRequest;\n}();\n\nvar SemanticOccurenceAtPositionRequest =\n/** @class */\nfunction (_super) {\n  __extends(SemanticOccurenceAtPositionRequest, _super);\n\n  function SemanticOccurenceAtPositionRequest() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  SemanticOccurenceAtPositionRequest.prototype._compute = function (model, selection, wordSeparators, token) {\n    return getOccurrencesAtPosition(model, selection.getPosition(), token).then(function (value) {\n      return value || [];\n    });\n  };\n\n  return SemanticOccurenceAtPositionRequest;\n}(OccurenceAtPositionRequest);\n\nvar TextualOccurenceAtPositionRequest =\n/** @class */\nfunction (_super) {\n  __extends(TextualOccurenceAtPositionRequest, _super);\n\n  function TextualOccurenceAtPositionRequest(model, selection, wordSeparators) {\n    var _this = _super.call(this, model, selection, wordSeparators) || this;\n\n    _this._selectionIsEmpty = selection.isEmpty();\n    return _this;\n  }\n\n  TextualOccurenceAtPositionRequest.prototype._compute = function (model, selection, wordSeparators, token) {\n    return timeout(250, token).then(function () {\n      if (!selection.isEmpty()) {\n        return [];\n      }\n\n      var word = model.getWordAtPosition(selection.getPosition());\n\n      if (!word) {\n        return [];\n      }\n\n      var matches = model.findMatches(word.word, true, false, true, wordSeparators, false);\n      return matches.map(function (m) {\n        return {\n          range: m.range,\n          kind: DocumentHighlightKind.Text\n        };\n      });\n    });\n  };\n\n  TextualOccurenceAtPositionRequest.prototype.isValid = function (model, selection, decorationIds) {\n    var currentSelectionIsEmpty = selection.isEmpty();\n\n    if (this._selectionIsEmpty !== currentSelectionIsEmpty) {\n      return false;\n    }\n\n    return _super.prototype.isValid.call(this, model, selection, decorationIds);\n  };\n\n  return TextualOccurenceAtPositionRequest;\n}(OccurenceAtPositionRequest);\n\nfunction computeOccurencesAtPosition(model, selection, wordSeparators) {\n  if (DocumentHighlightProviderRegistry.has(model)) {\n    return new SemanticOccurenceAtPositionRequest(model, selection, wordSeparators);\n  }\n\n  return new TextualOccurenceAtPositionRequest(model, selection, wordSeparators);\n}\n\nregisterModelAndPositionCommand('_executeDocumentHighlights', function (model, position) {\n  return getOccurrencesAtPosition(model, position, CancellationToken.None);\n});\n\nvar WordHighlighter =\n/** @class */\nfunction () {\n  function WordHighlighter(editor, contextKeyService) {\n    var _this = this;\n\n    this.toUnhook = new DisposableStore();\n    this.workerRequestTokenId = 0;\n    this.workerRequestCompleted = false;\n    this.workerRequestValue = [];\n    this.lastCursorPositionChangeTime = 0;\n    this.renderDecorationsTimer = -1;\n    this.editor = editor;\n    this._hasWordHighlights = ctxHasWordHighlights.bindTo(contextKeyService);\n    this._ignorePositionChangeEvent = false;\n    this.occurrencesHighlight = this.editor.getOption(61\n    /* occurrencesHighlight */\n    );\n    this.model = this.editor.getModel();\n    this.toUnhook.add(editor.onDidChangeCursorPosition(function (e) {\n      if (_this._ignorePositionChangeEvent) {\n        // We are changing the position => ignore this event\n        return;\n      }\n\n      if (!_this.occurrencesHighlight) {\n        // Early exit if nothing needs to be done!\n        // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\n        return;\n      }\n\n      _this._onPositionChanged(e);\n    }));\n    this.toUnhook.add(editor.onDidChangeModelContent(function (e) {\n      _this._stopAll();\n    }));\n    this.toUnhook.add(editor.onDidChangeConfiguration(function (e) {\n      var newValue = _this.editor.getOption(61\n      /* occurrencesHighlight */\n      );\n\n      if (_this.occurrencesHighlight !== newValue) {\n        _this.occurrencesHighlight = newValue;\n\n        _this._stopAll();\n      }\n    }));\n    this._decorationIds = [];\n    this.workerRequestTokenId = 0;\n    this.workerRequest = null;\n    this.workerRequestCompleted = false;\n    this.lastCursorPositionChangeTime = 0;\n    this.renderDecorationsTimer = -1;\n  }\n\n  WordHighlighter.prototype.hasDecorations = function () {\n    return this._decorationIds.length > 0;\n  };\n\n  WordHighlighter.prototype.restore = function () {\n    if (!this.occurrencesHighlight) {\n      return;\n    }\n\n    this._run();\n  };\n\n  WordHighlighter.prototype._getSortedHighlights = function () {\n    var _this = this;\n\n    return arrays.coalesce(this._decorationIds.map(function (id) {\n      return _this.model.getDecorationRange(id);\n    }).sort(Range.compareRangesUsingStarts));\n  };\n\n  WordHighlighter.prototype.moveNext = function () {\n    var _this = this;\n\n    var highlights = this._getSortedHighlights();\n\n    var index = arrays.firstIndex(highlights, function (range) {\n      return range.containsPosition(_this.editor.getPosition());\n    });\n    var newIndex = (index + 1) % highlights.length;\n    var dest = highlights[newIndex];\n\n    try {\n      this._ignorePositionChangeEvent = true;\n      this.editor.setPosition(dest.getStartPosition());\n      this.editor.revealRangeInCenterIfOutsideViewport(dest);\n    } finally {\n      this._ignorePositionChangeEvent = false;\n    }\n  };\n\n  WordHighlighter.prototype.moveBack = function () {\n    var _this = this;\n\n    var highlights = this._getSortedHighlights();\n\n    var index = arrays.firstIndex(highlights, function (range) {\n      return range.containsPosition(_this.editor.getPosition());\n    });\n    var newIndex = (index - 1 + highlights.length) % highlights.length;\n    var dest = highlights[newIndex];\n\n    try {\n      this._ignorePositionChangeEvent = true;\n      this.editor.setPosition(dest.getStartPosition());\n      this.editor.revealRangeInCenterIfOutsideViewport(dest);\n    } finally {\n      this._ignorePositionChangeEvent = false;\n    }\n  };\n\n  WordHighlighter.prototype._removeDecorations = function () {\n    if (this._decorationIds.length > 0) {\n      // remove decorations\n      this._decorationIds = this.editor.deltaDecorations(this._decorationIds, []);\n\n      this._hasWordHighlights.set(false);\n    }\n  };\n\n  WordHighlighter.prototype._stopAll = function () {\n    // Remove any existing decorations\n    this._removeDecorations(); // Cancel any renderDecorationsTimer\n\n\n    if (this.renderDecorationsTimer !== -1) {\n      clearTimeout(this.renderDecorationsTimer);\n      this.renderDecorationsTimer = -1;\n    } // Cancel any worker request\n\n\n    if (this.workerRequest !== null) {\n      this.workerRequest.cancel();\n      this.workerRequest = null;\n    } // Invalidate any worker request callback\n\n\n    if (!this.workerRequestCompleted) {\n      this.workerRequestTokenId++;\n      this.workerRequestCompleted = true;\n    }\n  };\n\n  WordHighlighter.prototype._onPositionChanged = function (e) {\n    // disabled\n    if (!this.occurrencesHighlight) {\n      this._stopAll();\n\n      return;\n    } // ignore typing & other\n\n\n    if (e.reason !== 3\n    /* Explicit */\n    ) {\n        this._stopAll();\n\n        return;\n      }\n\n    this._run();\n  };\n\n  WordHighlighter.prototype._run = function () {\n    var _this = this;\n\n    var editorSelection = this.editor.getSelection(); // ignore multiline selection\n\n    if (editorSelection.startLineNumber !== editorSelection.endLineNumber) {\n      this._stopAll();\n\n      return;\n    }\n\n    var lineNumber = editorSelection.startLineNumber;\n    var startColumn = editorSelection.startColumn;\n    var endColumn = editorSelection.endColumn;\n    var word = this.model.getWordAtPosition({\n      lineNumber: lineNumber,\n      column: startColumn\n    }); // The selection must be inside a word or surround one word at most\n\n    if (!word || word.startColumn > startColumn || word.endColumn < endColumn) {\n      this._stopAll();\n\n      return;\n    } // All the effort below is trying to achieve this:\n    // - when cursor is moved to a word, trigger immediately a findOccurrences request\n    // - 250ms later after the last cursor move event, render the occurrences\n    // - no flickering!\n\n\n    var workerRequestIsValid = this.workerRequest && this.workerRequest.isValid(this.model, editorSelection, this._decorationIds); // There are 4 cases:\n    // a) old workerRequest is valid & completed, renderDecorationsTimer fired\n    // b) old workerRequest is valid & completed, renderDecorationsTimer not fired\n    // c) old workerRequest is valid, but not completed\n    // d) old workerRequest is not valid\n    // For a) no action is needed\n    // For c), member 'lastCursorPositionChangeTime' will be used when installing the timer so no action is needed\n\n    this.lastCursorPositionChangeTime = new Date().getTime();\n\n    if (workerRequestIsValid) {\n      if (this.workerRequestCompleted && this.renderDecorationsTimer !== -1) {\n        // case b)\n        // Delay the firing of renderDecorationsTimer by an extra 250 ms\n        clearTimeout(this.renderDecorationsTimer);\n        this.renderDecorationsTimer = -1;\n\n        this._beginRenderDecorations();\n      }\n    } else {\n      // case d)\n      // Stop all previous actions and start fresh\n      this._stopAll();\n\n      var myRequestId_1 = ++this.workerRequestTokenId;\n      this.workerRequestCompleted = false;\n      this.workerRequest = computeOccurencesAtPosition(this.model, this.editor.getSelection(), this.editor.getOption(96\n      /* wordSeparators */\n      ));\n      this.workerRequest.result.then(function (data) {\n        if (myRequestId_1 === _this.workerRequestTokenId) {\n          _this.workerRequestCompleted = true;\n          _this.workerRequestValue = data || [];\n\n          _this._beginRenderDecorations();\n        }\n      }, onUnexpectedError);\n    }\n  };\n\n  WordHighlighter.prototype._beginRenderDecorations = function () {\n    var _this = this;\n\n    var currentTime = new Date().getTime();\n    var minimumRenderTime = this.lastCursorPositionChangeTime + 250;\n\n    if (currentTime >= minimumRenderTime) {\n      // Synchronous\n      this.renderDecorationsTimer = -1;\n      this.renderDecorations();\n    } else {\n      // Asynchronous\n      this.renderDecorationsTimer = setTimeout(function () {\n        _this.renderDecorations();\n      }, minimumRenderTime - currentTime);\n    }\n  };\n\n  WordHighlighter.prototype.renderDecorations = function () {\n    this.renderDecorationsTimer = -1;\n    var decorations = [];\n\n    for (var i = 0, len = this.workerRequestValue.length; i < len; i++) {\n      var info = this.workerRequestValue[i];\n      decorations.push({\n        range: info.range,\n        options: WordHighlighter._getDecorationOptions(info.kind)\n      });\n    }\n\n    this._decorationIds = this.editor.deltaDecorations(this._decorationIds, decorations);\n\n    this._hasWordHighlights.set(this.hasDecorations());\n  };\n\n  WordHighlighter._getDecorationOptions = function (kind) {\n    if (kind === DocumentHighlightKind.Write) {\n      return this._WRITE_OPTIONS;\n    } else if (kind === DocumentHighlightKind.Text) {\n      return this._TEXT_OPTIONS;\n    } else {\n      return this._REGULAR_OPTIONS;\n    }\n  };\n\n  WordHighlighter.prototype.dispose = function () {\n    this._stopAll();\n\n    this.toUnhook.dispose();\n  };\n\n  WordHighlighter._WRITE_OPTIONS = ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    className: 'wordHighlightStrong',\n    overviewRuler: {\n      color: themeColorFromId(overviewRulerWordHighlightStrongForeground),\n      position: OverviewRulerLane.Center\n    }\n  });\n  WordHighlighter._TEXT_OPTIONS = ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    className: 'selectionHighlight',\n    overviewRuler: {\n      color: themeColorFromId(overviewRulerSelectionHighlightForeground),\n      position: OverviewRulerLane.Center\n    }\n  });\n  WordHighlighter._REGULAR_OPTIONS = ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    className: 'wordHighlight',\n    overviewRuler: {\n      color: themeColorFromId(overviewRulerWordHighlightForeground),\n      position: OverviewRulerLane.Center\n    }\n  });\n  return WordHighlighter;\n}();\n\nvar WordHighlighterContribution =\n/** @class */\nfunction (_super) {\n  __extends(WordHighlighterContribution, _super);\n\n  function WordHighlighterContribution(editor, contextKeyService) {\n    var _this = _super.call(this) || this;\n\n    _this.wordHighligher = null;\n\n    var createWordHighlighterIfPossible = function () {\n      if (editor.hasModel()) {\n        _this.wordHighligher = new WordHighlighter(editor, contextKeyService);\n      }\n    };\n\n    _this._register(editor.onDidChangeModel(function (e) {\n      if (_this.wordHighligher) {\n        _this.wordHighligher.dispose();\n\n        _this.wordHighligher = null;\n      }\n\n      createWordHighlighterIfPossible();\n    }));\n\n    createWordHighlighterIfPossible();\n    return _this;\n  }\n\n  WordHighlighterContribution.get = function (editor) {\n    return editor.getContribution(WordHighlighterContribution.ID);\n  };\n\n  WordHighlighterContribution.prototype.saveViewState = function () {\n    if (this.wordHighligher && this.wordHighligher.hasDecorations()) {\n      return true;\n    }\n\n    return false;\n  };\n\n  WordHighlighterContribution.prototype.moveNext = function () {\n    if (this.wordHighligher) {\n      this.wordHighligher.moveNext();\n    }\n  };\n\n  WordHighlighterContribution.prototype.moveBack = function () {\n    if (this.wordHighligher) {\n      this.wordHighligher.moveBack();\n    }\n  };\n\n  WordHighlighterContribution.prototype.restoreViewState = function (state) {\n    if (this.wordHighligher && state) {\n      this.wordHighligher.restore();\n    }\n  };\n\n  WordHighlighterContribution.prototype.dispose = function () {\n    if (this.wordHighligher) {\n      this.wordHighligher.dispose();\n      this.wordHighligher = null;\n    }\n\n    _super.prototype.dispose.call(this);\n  };\n\n  WordHighlighterContribution.ID = 'editor.contrib.wordHighlighter';\n  WordHighlighterContribution = __decorate([__param(1, IContextKeyService)], WordHighlighterContribution);\n  return WordHighlighterContribution;\n}(Disposable);\n\nvar WordHighlightNavigationAction =\n/** @class */\nfunction (_super) {\n  __extends(WordHighlightNavigationAction, _super);\n\n  function WordHighlightNavigationAction(next, opts) {\n    var _this = _super.call(this, opts) || this;\n\n    _this._isNext = next;\n    return _this;\n  }\n\n  WordHighlightNavigationAction.prototype.run = function (accessor, editor) {\n    var controller = WordHighlighterContribution.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    if (this._isNext) {\n      controller.moveNext();\n    } else {\n      controller.moveBack();\n    }\n  };\n\n  return WordHighlightNavigationAction;\n}(EditorAction);\n\nvar NextWordHighlightAction =\n/** @class */\nfunction (_super) {\n  __extends(NextWordHighlightAction, _super);\n\n  function NextWordHighlightAction() {\n    return _super.call(this, true, {\n      id: 'editor.action.wordHighlight.next',\n      label: nls.localize('wordHighlight.next.label', \"Go to Next Symbol Highlight\"),\n      alias: 'Go to Next Symbol Highlight',\n      precondition: ctxHasWordHighlights,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 65\n        /* F7 */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  return NextWordHighlightAction;\n}(WordHighlightNavigationAction);\n\nvar PrevWordHighlightAction =\n/** @class */\nfunction (_super) {\n  __extends(PrevWordHighlightAction, _super);\n\n  function PrevWordHighlightAction() {\n    return _super.call(this, false, {\n      id: 'editor.action.wordHighlight.prev',\n      label: nls.localize('wordHighlight.previous.label', \"Go to Previous Symbol Highlight\"),\n      alias: 'Go to Previous Symbol Highlight',\n      precondition: ctxHasWordHighlights,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 1024\n        /* Shift */\n        | 65\n        /* F7 */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  return PrevWordHighlightAction;\n}(WordHighlightNavigationAction);\n\nvar TriggerWordHighlightAction =\n/** @class */\nfunction (_super) {\n  __extends(TriggerWordHighlightAction, _super);\n\n  function TriggerWordHighlightAction() {\n    return _super.call(this, {\n      id: 'editor.action.wordHighlight.trigger',\n      label: nls.localize('wordHighlight.trigger.label', \"Trigger Symbol Highlight\"),\n      alias: 'Trigger Symbol Highlight',\n      precondition: ctxHasWordHighlights.toNegated(),\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 0,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  TriggerWordHighlightAction.prototype.run = function (accessor, editor, args) {\n    var controller = WordHighlighterContribution.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    controller.restoreViewState(true);\n  };\n\n  return TriggerWordHighlightAction;\n}(EditorAction);\n\nregisterEditorContribution(WordHighlighterContribution.ID, WordHighlighterContribution);\nregisterEditorAction(NextWordHighlightAction);\nregisterEditorAction(PrevWordHighlightAction);\nregisterEditorAction(TriggerWordHighlightAction);\nregisterThemingParticipant(function (theme, collector) {\n  var selectionHighlight = theme.getColor(editorSelectionHighlight);\n\n  if (selectionHighlight) {\n    collector.addRule(\".monaco-editor .focused .selectionHighlight { background-color: \" + selectionHighlight + \"; }\");\n    collector.addRule(\".monaco-editor .selectionHighlight { background-color: \" + selectionHighlight.transparent(0.5) + \"; }\");\n  }\n\n  var wordHighlight = theme.getColor(editorWordHighlight);\n\n  if (wordHighlight) {\n    collector.addRule(\".monaco-editor .wordHighlight { background-color: \" + wordHighlight + \"; }\");\n  }\n\n  var wordHighlightStrong = theme.getColor(editorWordHighlightStrong);\n\n  if (wordHighlightStrong) {\n    collector.addRule(\".monaco-editor .wordHighlightStrong { background-color: \" + wordHighlightStrong + \"; }\");\n  }\n\n  var selectionHighlightBorder = theme.getColor(editorSelectionHighlightBorder);\n\n  if (selectionHighlightBorder) {\n    collector.addRule(\".monaco-editor .selectionHighlight { border: 1px \" + (theme.type === 'hc' ? 'dotted' : 'solid') + \" \" + selectionHighlightBorder + \"; box-sizing: border-box; }\");\n  }\n\n  var wordHighlightBorder = theme.getColor(editorWordHighlightBorder);\n\n  if (wordHighlightBorder) {\n    collector.addRule(\".monaco-editor .wordHighlight { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + wordHighlightBorder + \"; box-sizing: border-box; }\");\n  }\n\n  var wordHighlightStrongBorder = theme.getColor(editorWordHighlightStrongBorder);\n\n  if (wordHighlightStrongBorder) {\n    collector.addRule(\".monaco-editor .wordHighlightStrong { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + wordHighlightStrongBorder + \"; box-sizing: border-box; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/wordHighlighter/wordHighlighter.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","nls","arrays","createCancelablePromise","first","timeout","CancellationToken","onUnexpectedError","onUnexpectedExternalError","Disposable","DisposableStore","EditorAction","registerEditorAction","registerEditorContribution","registerModelAndPositionCommand","Range","EditorContextKeys","OverviewRulerLane","ModelDecorationOptions","DocumentHighlightKind","DocumentHighlightProviderRegistry","IContextKeyService","RawContextKey","activeContrastBorder","editorSelectionHighlight","editorSelectionHighlightBorder","overviewRulerSelectionHighlightForeground","registerColor","registerThemingParticipant","themeColorFromId","editorWordHighlight","dark","light","hc","localize","editorWordHighlightStrong","editorWordHighlightBorder","editorWordHighlightStrongBorder","overviewRulerWordHighlightForeground","overviewRulerWordHighlightStrongForeground","ctxHasWordHighlights","getOccurrencesAtPosition","model","position","token","orderedByScore","ordered","map","provider","Promise","resolve","provideDocumentHighlights","then","undefined","isNonEmptyArray","OccurenceAtPositionRequest","selection","wordSeparators","_this","_wordRange","_getCurrentWordRange","result","_compute","word","getWordAtPosition","getPosition","startLineNumber","startColumn","endColumn","isValid","decorationIds","lineNumber","currentWordRange","requestIsValid","Boolean","equalsRange","len","range","getDecorationRange","cancel","SemanticOccurenceAtPositionRequest","_super","apply","value","TextualOccurenceAtPositionRequest","call","_selectionIsEmpty","isEmpty","matches","findMatches","m","kind","Text","currentSelectionIsEmpty","computeOccurencesAtPosition","has","None","WordHighlighter","editor","contextKeyService","toUnhook","workerRequestTokenId","workerRequestCompleted","workerRequestValue","lastCursorPositionChangeTime","renderDecorationsTimer","_hasWordHighlights","bindTo","_ignorePositionChangeEvent","occurrencesHighlight","getOption","getModel","add","onDidChangeCursorPosition","e","_onPositionChanged","onDidChangeModelContent","_stopAll","onDidChangeConfiguration","newValue","_decorationIds","workerRequest","hasDecorations","restore","_run","_getSortedHighlights","coalesce","id","sort","compareRangesUsingStarts","moveNext","highlights","index","firstIndex","containsPosition","newIndex","dest","setPosition","getStartPosition","revealRangeInCenterIfOutsideViewport","moveBack","_removeDecorations","deltaDecorations","set","clearTimeout","reason","editorSelection","getSelection","endLineNumber","column","workerRequestIsValid","Date","getTime","_beginRenderDecorations","myRequestId_1","data","currentTime","minimumRenderTime","renderDecorations","setTimeout","decorations","info","push","options","_getDecorationOptions","Write","_WRITE_OPTIONS","_TEXT_OPTIONS","_REGULAR_OPTIONS","dispose","register","stickiness","className","overviewRuler","color","Center","WordHighlighterContribution","wordHighligher","createWordHighlighterIfPossible","hasModel","_register","onDidChangeModel","get","getContribution","ID","saveViewState","restoreViewState","state","WordHighlightNavigationAction","next","opts","_isNext","run","accessor","controller","NextWordHighlightAction","label","alias","precondition","kbOpts","kbExpr","editorTextFocus","primary","weight","PrevWordHighlightAction","TriggerWordHighlightAction","toNegated","args","theme","collector","selectionHighlight","getColor","addRule","transparent","wordHighlight","wordHighlightStrong","selectionHighlightBorder","type","wordHighlightBorder","wordHighlightStrongBorder"],"mappings":"AAAA;;;;AAIA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,IAAII,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGd,MAAM,CAACmB,wBAAP,CAAgCP,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HhB,CAA3H;AACA,MAAI,OAAOsB,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EH,CAAC,GAAGE,OAAO,CAACC,QAAR,CAAiBV,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIQ,CAAC,GAAGX,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCK,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIxB,CAAC,GAAGa,UAAU,CAACW,CAAD,CAAlB,EAAuBJ,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQjB,CAAC,CAACoB,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQjB,CAAC,CAACc,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BpB,CAAC,CAACc,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAclB,MAAM,CAACuB,cAAP,CAAsBX,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,IAAIM,OAAO,GAAI,QAAQ,KAAKA,OAAd,IAA0B,UAAUC,UAAV,EAAsBC,SAAtB,EAAiC;AACrE,SAAO,UAAUd,MAAV,EAAkBC,GAAlB,EAAuB;AAAEa,IAAAA,SAAS,CAACd,MAAD,EAASC,GAAT,EAAcY,UAAd,CAAT;AAAqC,GAArE;AACH,CAFD;;AAGA,OAAO,KAAKE,GAAZ,MAAqB,iBAArB;AACA,OAAO,KAAKC,MAAZ,MAAwB,gCAAxB;AACA,SAASC,uBAAT,EAAkCC,KAAlC,EAAyCC,OAAzC,QAAwD,+BAAxD;AACA,SAASC,iBAAT,QAAkC,sCAAlC;AACA,SAASC,iBAAT,EAA4BC,yBAA5B,QAA6D,gCAA7D;AACA,SAASC,UAAT,EAAqBC,eAArB,QAA4C,mCAA5C;AACA,SAASC,YAAT,EAAuBC,oBAAvB,EAA6CC,0BAA7C,EAAyEC,+BAAzE,QAAgH,mCAAhH;AACA,SAASC,KAAT,QAAsB,4BAAtB;AACA,SAASC,iBAAT,QAAkC,mCAAlC;AACA,SAASC,iBAAT,QAAkC,uBAAlC;AACA,SAASC,sBAAT,QAAuC,iCAAvC;AACA,SAASC,qBAAT,EAAgCC,iCAAhC,QAAyE,uBAAzE;AACA,SAASC,kBAAT,EAA6BC,aAA7B,QAAkD,mDAAlD;AACA,SAASC,oBAAT,EAA+BC,wBAA/B,EAAyDC,8BAAzD,EAAyFC,yCAAzF,EAAoIC,aAApI,QAAyJ,iDAAzJ;AACA,SAASC,0BAAT,EAAqCC,gBAArC,QAA6D,gDAA7D;AACA,IAAIC,mBAAmB,GAAGH,aAAa,CAAC,gCAAD,EAAmC;AAAEI,EAAAA,IAAI,EAAE,WAAR;AAAqBC,EAAAA,KAAK,EAAE,WAA5B;AAAyCC,EAAAA,EAAE,EAAE;AAA7C,CAAnC,EAAwFhC,GAAG,CAACiC,QAAJ,CAAa,eAAb,EAA8B,kJAA9B,CAAxF,EAA2Q,IAA3Q,CAAvC;AACA,IAAIC,yBAAyB,GAAGR,aAAa,CAAC,sCAAD,EAAyC;AAAEI,EAAAA,IAAI,EAAE,WAAR;AAAqBC,EAAAA,KAAK,EAAE,WAA5B;AAAyCC,EAAAA,EAAE,EAAE;AAA7C,CAAzC,EAA8FhC,GAAG,CAACiC,QAAJ,CAAa,qBAAb,EAAoC,sJAApC,CAA9F,EAA2R,IAA3R,CAA7C;AACA,IAAIE,yBAAyB,GAAGT,aAAa,CAAC,4BAAD,EAA+B;AAAEK,EAAAA,KAAK,EAAE,IAAT;AAAeD,EAAAA,IAAI,EAAE,IAArB;AAA2BE,EAAAA,EAAE,EAAEV;AAA/B,CAA/B,EAAsFtB,GAAG,CAACiC,QAAJ,CAAa,qBAAb,EAAoC,uEAApC,CAAtF,CAA7C;AACA,IAAIG,+BAA+B,GAAGV,aAAa,CAAC,kCAAD,EAAqC;AAAEK,EAAAA,KAAK,EAAE,IAAT;AAAeD,EAAAA,IAAI,EAAE,IAArB;AAA2BE,EAAAA,EAAE,EAAEV;AAA/B,CAArC,EAA4FtB,GAAG,CAACiC,QAAJ,CAAa,2BAAb,EAA0C,2EAA1C,CAA5F,CAAnD;AACA,IAAII,oCAAoC,GAAGX,aAAa,CAAC,6CAAD,EAAgD;AAAEI,EAAAA,IAAI,EAAE,WAAR;AAAqBC,EAAAA,KAAK,EAAE,WAA5B;AAAyCC,EAAAA,EAAE,EAAE;AAA7C,CAAhD,EAA4GhC,GAAG,CAACiC,QAAJ,CAAa,sCAAb,EAAqD,2HAArD,CAA5G,EAA+R,IAA/R,CAAxD;AACA,IAAIK,0CAA0C,GAAGZ,aAAa,CAAC,mDAAD,EAAsD;AAAEI,EAAAA,IAAI,EAAE,WAAR;AAAqBC,EAAAA,KAAK,EAAE,WAA5B;AAAyCC,EAAAA,EAAE,EAAE;AAA7C,CAAtD,EAAkHhC,GAAG,CAACiC,QAAJ,CAAa,4CAAb,EAA2D,wIAA3D,CAAlH,EAAwT,IAAxT,CAA9D;AACA,IAAIM,oBAAoB,GAAG,IAAIlB,aAAJ,CAAkB,mBAAlB,EAAuC,KAAvC,CAA3B;AACA,OAAO,SAASmB,wBAAT,CAAkCC,KAAlC,EAAyCC,QAAzC,EAAmDC,KAAnD,EAA0D;AAC7D,MAAIC,cAAc,GAAGzB,iCAAiC,CAAC0B,OAAlC,CAA0CJ,KAA1C,CAArB,CAD6D,CAE7D;AACA;AACA;;AACA,SAAOtC,KAAK,CAACyC,cAAc,CAACE,GAAf,CAAmB,UAAUC,QAAV,EAAoB;AAAE,WAAO,YAAY;AACrE,aAAOC,OAAO,CAACC,OAAR,CAAgBF,QAAQ,CAACG,yBAAT,CAAmCT,KAAnC,EAA0CC,QAA1C,EAAoDC,KAApD,CAAhB,EACFQ,IADE,CACGC,SADH,EACc7C,yBADd,CAAP;AAEH,KAHqD;AAGlD,GAHS,CAAD,EAGLN,MAAM,CAACoD,eAHF,CAAZ;AAIH;;AACD,IAAIC,0BAA0B;AAAG;AAAe,YAAY;AACxD,WAASA,0BAAT,CAAoCb,KAApC,EAA2Cc,SAA3C,EAAsDC,cAAtD,EAAsE;AAClE,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,UAAL,GAAkB,KAAKC,oBAAL,CAA0BlB,KAA1B,EAAiCc,SAAjC,CAAlB;AACA,SAAKK,MAAL,GAAc1D,uBAAuB,CAAC,UAAUyC,KAAV,EAAiB;AAAE,aAAOc,KAAK,CAACI,QAAN,CAAepB,KAAf,EAAsBc,SAAtB,EAAiCC,cAAjC,EAAiDb,KAAjD,CAAP;AAAiE,KAArF,CAArC;AACH;;AACDW,EAAAA,0BAA0B,CAACzE,SAA3B,CAAqC8E,oBAArC,GAA4D,UAAUlB,KAAV,EAAiBc,SAAjB,EAA4B;AACpF,QAAIO,IAAI,GAAGrB,KAAK,CAACsB,iBAAN,CAAwBR,SAAS,CAACS,WAAV,EAAxB,CAAX;;AACA,QAAIF,IAAJ,EAAU;AACN,aAAO,IAAIhD,KAAJ,CAAUyC,SAAS,CAACU,eAApB,EAAqCH,IAAI,CAACI,WAA1C,EAAuDX,SAAS,CAACU,eAAjE,EAAkFH,IAAI,CAACK,SAAvF,CAAP;AACH;;AACD,WAAO,IAAP;AACH,GAND;;AAOAb,EAAAA,0BAA0B,CAACzE,SAA3B,CAAqCuF,OAArC,GAA+C,UAAU3B,KAAV,EAAiBc,SAAjB,EAA4Bc,aAA5B,EAA2C;AACtF,QAAIC,UAAU,GAAGf,SAAS,CAACU,eAA3B;AACA,QAAIC,WAAW,GAAGX,SAAS,CAACW,WAA5B;AACA,QAAIC,SAAS,GAAGZ,SAAS,CAACY,SAA1B;;AACA,QAAII,gBAAgB,GAAG,KAAKZ,oBAAL,CAA0BlB,KAA1B,EAAiCc,SAAjC,CAAvB;;AACA,QAAIiB,cAAc,GAAGC,OAAO,CAAC,KAAKf,UAAL,IAAmB,KAAKA,UAAL,CAAgBgB,WAAhB,CAA4BH,gBAA5B,CAApB,CAA5B,CALsF,CAMtF;AACA;;AACA,SAAK,IAAI5E,CAAC,GAAG,CAAR,EAAWgF,GAAG,GAAGN,aAAa,CAAC/E,MAApC,EAA4C,CAACkF,cAAD,IAAmB7E,CAAC,GAAGgF,GAAnE,EAAwEhF,CAAC,EAAzE,EAA6E;AACzE,UAAIiF,KAAK,GAAGnC,KAAK,CAACoC,kBAAN,CAAyBR,aAAa,CAAC1E,CAAD,CAAtC,CAAZ;;AACA,UAAIiF,KAAK,IAAIA,KAAK,CAACX,eAAN,KAA0BK,UAAvC,EAAmD;AAC/C,YAAIM,KAAK,CAACV,WAAN,IAAqBA,WAArB,IAAoCU,KAAK,CAACT,SAAN,IAAmBA,SAA3D,EAAsE;AAClEK,UAAAA,cAAc,GAAG,IAAjB;AACH;AACJ;AACJ;;AACD,WAAOA,cAAP;AACH,GAjBD;;AAkBAlB,EAAAA,0BAA0B,CAACzE,SAA3B,CAAqCiG,MAArC,GAA8C,YAAY;AACtD,SAAKlB,MAAL,CAAYkB,MAAZ;AACH,GAFD;;AAGA,SAAOxB,0BAAP;AACH,CAnC+C,EAAhD;;AAoCA,IAAIyB,kCAAkC;AAAG;AAAe,UAAUC,MAAV,EAAkB;AACtE/G,EAAAA,SAAS,CAAC8G,kCAAD,EAAqCC,MAArC,CAAT;;AACA,WAASD,kCAAT,GAA8C;AAC1C,WAAOC,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACC,KAAP,CAAa,IAAb,EAAmB5F,SAAnB,CAAnB,IAAoD,IAA3D;AACH;;AACD0F,EAAAA,kCAAkC,CAAClG,SAAnC,CAA6CgF,QAA7C,GAAwD,UAAUpB,KAAV,EAAiBc,SAAjB,EAA4BC,cAA5B,EAA4Cb,KAA5C,EAAmD;AACvG,WAAOH,wBAAwB,CAACC,KAAD,EAAQc,SAAS,CAACS,WAAV,EAAR,EAAiCrB,KAAjC,CAAxB,CAAgEQ,IAAhE,CAAqE,UAAU+B,KAAV,EAAiB;AAAE,aAAOA,KAAK,IAAI,EAAhB;AAAqB,KAA7G,CAAP;AACH,GAFD;;AAGA,SAAOH,kCAAP;AACH,CATuD,CAStDzB,0BATsD,CAAxD;;AAUA,IAAI6B,iCAAiC;AAAG;AAAe,UAAUH,MAAV,EAAkB;AACrE/G,EAAAA,SAAS,CAACkH,iCAAD,EAAoCH,MAApC,CAAT;;AACA,WAASG,iCAAT,CAA2C1C,KAA3C,EAAkDc,SAAlD,EAA6DC,cAA7D,EAA6E;AACzE,QAAIC,KAAK,GAAGuB,MAAM,CAACI,IAAP,CAAY,IAAZ,EAAkB3C,KAAlB,EAAyBc,SAAzB,EAAoCC,cAApC,KAAuD,IAAnE;;AACAC,IAAAA,KAAK,CAAC4B,iBAAN,GAA0B9B,SAAS,CAAC+B,OAAV,EAA1B;AACA,WAAO7B,KAAP;AACH;;AACD0B,EAAAA,iCAAiC,CAACtG,SAAlC,CAA4CgF,QAA5C,GAAuD,UAAUpB,KAAV,EAAiBc,SAAjB,EAA4BC,cAA5B,EAA4Cb,KAA5C,EAAmD;AACtG,WAAOvC,OAAO,CAAC,GAAD,EAAMuC,KAAN,CAAP,CAAoBQ,IAApB,CAAyB,YAAY;AACxC,UAAI,CAACI,SAAS,CAAC+B,OAAV,EAAL,EAA0B;AACtB,eAAO,EAAP;AACH;;AACD,UAAIxB,IAAI,GAAGrB,KAAK,CAACsB,iBAAN,CAAwBR,SAAS,CAACS,WAAV,EAAxB,CAAX;;AACA,UAAI,CAACF,IAAL,EAAW;AACP,eAAO,EAAP;AACH;;AACD,UAAIyB,OAAO,GAAG9C,KAAK,CAAC+C,WAAN,CAAkB1B,IAAI,CAACA,IAAvB,EAA6B,IAA7B,EAAmC,KAAnC,EAA0C,IAA1C,EAAgDN,cAAhD,EAAgE,KAAhE,CAAd;AACA,aAAO+B,OAAO,CAACzC,GAAR,CAAY,UAAU2C,CAAV,EAAa;AAC5B,eAAO;AACHb,UAAAA,KAAK,EAAEa,CAAC,CAACb,KADN;AAEHc,UAAAA,IAAI,EAAExE,qBAAqB,CAACyE;AAFzB,SAAP;AAIH,OALM,CAAP;AAMH,KAfM,CAAP;AAgBH,GAjBD;;AAkBAR,EAAAA,iCAAiC,CAACtG,SAAlC,CAA4CuF,OAA5C,GAAsD,UAAU3B,KAAV,EAAiBc,SAAjB,EAA4Bc,aAA5B,EAA2C;AAC7F,QAAIuB,uBAAuB,GAAGrC,SAAS,CAAC+B,OAAV,EAA9B;;AACA,QAAI,KAAKD,iBAAL,KAA2BO,uBAA/B,EAAwD;AACpD,aAAO,KAAP;AACH;;AACD,WAAOZ,MAAM,CAACnG,SAAP,CAAiBuF,OAAjB,CAAyBgB,IAAzB,CAA8B,IAA9B,EAAoC3C,KAApC,EAA2Cc,SAA3C,EAAsDc,aAAtD,CAAP;AACH,GAND;;AAOA,SAAOc,iCAAP;AACH,CAjCsD,CAiCrD7B,0BAjCqD,CAAvD;;AAkCA,SAASuC,2BAAT,CAAqCpD,KAArC,EAA4Cc,SAA5C,EAAuDC,cAAvD,EAAuE;AACnE,MAAIrC,iCAAiC,CAAC2E,GAAlC,CAAsCrD,KAAtC,CAAJ,EAAkD;AAC9C,WAAO,IAAIsC,kCAAJ,CAAuCtC,KAAvC,EAA8Cc,SAA9C,EAAyDC,cAAzD,CAAP;AACH;;AACD,SAAO,IAAI2B,iCAAJ,CAAsC1C,KAAtC,EAA6Cc,SAA7C,EAAwDC,cAAxD,CAAP;AACH;;AACD3C,+BAA+B,CAAC,4BAAD,EAA+B,UAAU4B,KAAV,EAAiBC,QAAjB,EAA2B;AAAE,SAAOF,wBAAwB,CAACC,KAAD,EAAQC,QAAR,EAAkBrC,iBAAiB,CAAC0F,IAApC,CAA/B;AAA2E,CAAvI,CAA/B;;AACA,IAAIC,eAAe;AAAG;AAAe,YAAY;AAC7C,WAASA,eAAT,CAAyBC,MAAzB,EAAiCC,iBAAjC,EAAoD;AAChD,QAAIzC,KAAK,GAAG,IAAZ;;AACA,SAAK0C,QAAL,GAAgB,IAAI1F,eAAJ,EAAhB;AACA,SAAK2F,oBAAL,GAA4B,CAA5B;AACA,SAAKC,sBAAL,GAA8B,KAA9B;AACA,SAAKC,kBAAL,GAA0B,EAA1B;AACA,SAAKC,4BAAL,GAAoC,CAApC;AACA,SAAKC,sBAAL,GAA8B,CAAC,CAA/B;AACA,SAAKP,MAAL,GAAcA,MAAd;AACA,SAAKQ,kBAAL,GAA0BlE,oBAAoB,CAACmE,MAArB,CAA4BR,iBAA5B,CAA1B;AACA,SAAKS,0BAAL,GAAkC,KAAlC;AACA,SAAKC,oBAAL,GAA4B,KAAKX,MAAL,CAAYY,SAAZ,CAAsB;AAAG;AAAzB,KAA5B;AACA,SAAKpE,KAAL,GAAa,KAAKwD,MAAL,CAAYa,QAAZ,EAAb;AACA,SAAKX,QAAL,CAAcY,GAAd,CAAkBd,MAAM,CAACe,yBAAP,CAAiC,UAAUC,CAAV,EAAa;AAC5D,UAAIxD,KAAK,CAACkD,0BAAV,EAAsC;AAClC;AACA;AACH;;AACD,UAAI,CAAClD,KAAK,CAACmD,oBAAX,EAAiC;AAC7B;AACA;AACA;AACH;;AACDnD,MAAAA,KAAK,CAACyD,kBAAN,CAAyBD,CAAzB;AACH,KAXiB,CAAlB;AAYA,SAAKd,QAAL,CAAcY,GAAd,CAAkBd,MAAM,CAACkB,uBAAP,CAA+B,UAAUF,CAAV,EAAa;AAC1DxD,MAAAA,KAAK,CAAC2D,QAAN;AACH,KAFiB,CAAlB;AAGA,SAAKjB,QAAL,CAAcY,GAAd,CAAkBd,MAAM,CAACoB,wBAAP,CAAgC,UAAUJ,CAAV,EAAa;AAC3D,UAAIK,QAAQ,GAAG7D,KAAK,CAACwC,MAAN,CAAaY,SAAb,CAAuB;AAAG;AAA1B,OAAf;;AACA,UAAIpD,KAAK,CAACmD,oBAAN,KAA+BU,QAAnC,EAA6C;AACzC7D,QAAAA,KAAK,CAACmD,oBAAN,GAA6BU,QAA7B;;AACA7D,QAAAA,KAAK,CAAC2D,QAAN;AACH;AACJ,KANiB,CAAlB;AAOA,SAAKG,cAAL,GAAsB,EAAtB;AACA,SAAKnB,oBAAL,GAA4B,CAA5B;AACA,SAAKoB,aAAL,GAAqB,IAArB;AACA,SAAKnB,sBAAL,GAA8B,KAA9B;AACA,SAAKE,4BAAL,GAAoC,CAApC;AACA,SAAKC,sBAAL,GAA8B,CAAC,CAA/B;AACH;;AACDR,EAAAA,eAAe,CAACnH,SAAhB,CAA0B4I,cAA1B,GAA2C,YAAY;AACnD,WAAQ,KAAKF,cAAL,CAAoBjI,MAApB,GAA6B,CAArC;AACH,GAFD;;AAGA0G,EAAAA,eAAe,CAACnH,SAAhB,CAA0B6I,OAA1B,GAAoC,YAAY;AAC5C,QAAI,CAAC,KAAKd,oBAAV,EAAgC;AAC5B;AACH;;AACD,SAAKe,IAAL;AACH,GALD;;AAMA3B,EAAAA,eAAe,CAACnH,SAAhB,CAA0B+I,oBAA1B,GAAiD,YAAY;AACzD,QAAInE,KAAK,GAAG,IAAZ;;AACA,WAAOxD,MAAM,CAAC4H,QAAP,CAAgB,KAAKN,cAAL,CAClBzE,GADkB,CACd,UAAUgF,EAAV,EAAc;AAAE,aAAOrE,KAAK,CAAChB,KAAN,CAAYoC,kBAAZ,CAA+BiD,EAA/B,CAAP;AAA4C,KAD9C,EAElBC,IAFkB,CAEbjH,KAAK,CAACkH,wBAFO,CAAhB,CAAP;AAGH,GALD;;AAMAhC,EAAAA,eAAe,CAACnH,SAAhB,CAA0BoJ,QAA1B,GAAqC,YAAY;AAC7C,QAAIxE,KAAK,GAAG,IAAZ;;AACA,QAAIyE,UAAU,GAAG,KAAKN,oBAAL,EAAjB;;AACA,QAAIO,KAAK,GAAGlI,MAAM,CAACmI,UAAP,CAAkBF,UAAlB,EAA8B,UAAUtD,KAAV,EAAiB;AAAE,aAAOA,KAAK,CAACyD,gBAAN,CAAuB5E,KAAK,CAACwC,MAAN,CAAajC,WAAb,EAAvB,CAAP;AAA4D,KAA7G,CAAZ;AACA,QAAIsE,QAAQ,GAAI,CAACH,KAAK,GAAG,CAAT,IAAcD,UAAU,CAAC5I,MAAzC;AACA,QAAIiJ,IAAI,GAAGL,UAAU,CAACI,QAAD,CAArB;;AACA,QAAI;AACA,WAAK3B,0BAAL,GAAkC,IAAlC;AACA,WAAKV,MAAL,CAAYuC,WAAZ,CAAwBD,IAAI,CAACE,gBAAL,EAAxB;AACA,WAAKxC,MAAL,CAAYyC,oCAAZ,CAAiDH,IAAjD;AACH,KAJD,SAKQ;AACJ,WAAK5B,0BAAL,GAAkC,KAAlC;AACH;AACJ,GAdD;;AAeAX,EAAAA,eAAe,CAACnH,SAAhB,CAA0B8J,QAA1B,GAAqC,YAAY;AAC7C,QAAIlF,KAAK,GAAG,IAAZ;;AACA,QAAIyE,UAAU,GAAG,KAAKN,oBAAL,EAAjB;;AACA,QAAIO,KAAK,GAAGlI,MAAM,CAACmI,UAAP,CAAkBF,UAAlB,EAA8B,UAAUtD,KAAV,EAAiB;AAAE,aAAOA,KAAK,CAACyD,gBAAN,CAAuB5E,KAAK,CAACwC,MAAN,CAAajC,WAAb,EAAvB,CAAP;AAA4D,KAA7G,CAAZ;AACA,QAAIsE,QAAQ,GAAI,CAACH,KAAK,GAAG,CAAR,GAAYD,UAAU,CAAC5I,MAAxB,IAAkC4I,UAAU,CAAC5I,MAA7D;AACA,QAAIiJ,IAAI,GAAGL,UAAU,CAACI,QAAD,CAArB;;AACA,QAAI;AACA,WAAK3B,0BAAL,GAAkC,IAAlC;AACA,WAAKV,MAAL,CAAYuC,WAAZ,CAAwBD,IAAI,CAACE,gBAAL,EAAxB;AACA,WAAKxC,MAAL,CAAYyC,oCAAZ,CAAiDH,IAAjD;AACH,KAJD,SAKQ;AACJ,WAAK5B,0BAAL,GAAkC,KAAlC;AACH;AACJ,GAdD;;AAeAX,EAAAA,eAAe,CAACnH,SAAhB,CAA0B+J,kBAA1B,GAA+C,YAAY;AACvD,QAAI,KAAKrB,cAAL,CAAoBjI,MAApB,GAA6B,CAAjC,EAAoC;AAChC;AACA,WAAKiI,cAAL,GAAsB,KAAKtB,MAAL,CAAY4C,gBAAZ,CAA6B,KAAKtB,cAAlC,EAAkD,EAAlD,CAAtB;;AACA,WAAKd,kBAAL,CAAwBqC,GAAxB,CAA4B,KAA5B;AACH;AACJ,GAND;;AAOA9C,EAAAA,eAAe,CAACnH,SAAhB,CAA0BuI,QAA1B,GAAqC,YAAY;AAC7C;AACA,SAAKwB,kBAAL,GAF6C,CAG7C;;;AACA,QAAI,KAAKpC,sBAAL,KAAgC,CAAC,CAArC,EAAwC;AACpCuC,MAAAA,YAAY,CAAC,KAAKvC,sBAAN,CAAZ;AACA,WAAKA,sBAAL,GAA8B,CAAC,CAA/B;AACH,KAP4C,CAQ7C;;;AACA,QAAI,KAAKgB,aAAL,KAAuB,IAA3B,EAAiC;AAC7B,WAAKA,aAAL,CAAmB1C,MAAnB;AACA,WAAK0C,aAAL,GAAqB,IAArB;AACH,KAZ4C,CAa7C;;;AACA,QAAI,CAAC,KAAKnB,sBAAV,EAAkC;AAC9B,WAAKD,oBAAL;AACA,WAAKC,sBAAL,GAA8B,IAA9B;AACH;AACJ,GAlBD;;AAmBAL,EAAAA,eAAe,CAACnH,SAAhB,CAA0BqI,kBAA1B,GAA+C,UAAUD,CAAV,EAAa;AACxD;AACA,QAAI,CAAC,KAAKL,oBAAV,EAAgC;AAC5B,WAAKQ,QAAL;;AACA;AACH,KALuD,CAMxD;;;AACA,QAAIH,CAAC,CAAC+B,MAAF,KAAa;AAAE;AAAnB,MAAmC;AAC/B,aAAK5B,QAAL;;AACA;AACH;;AACD,SAAKO,IAAL;AACH,GAZD;;AAaA3B,EAAAA,eAAe,CAACnH,SAAhB,CAA0B8I,IAA1B,GAAiC,YAAY;AACzC,QAAIlE,KAAK,GAAG,IAAZ;;AACA,QAAIwF,eAAe,GAAG,KAAKhD,MAAL,CAAYiD,YAAZ,EAAtB,CAFyC,CAGzC;;AACA,QAAID,eAAe,CAAChF,eAAhB,KAAoCgF,eAAe,CAACE,aAAxD,EAAuE;AACnE,WAAK/B,QAAL;;AACA;AACH;;AACD,QAAI9C,UAAU,GAAG2E,eAAe,CAAChF,eAAjC;AACA,QAAIC,WAAW,GAAG+E,eAAe,CAAC/E,WAAlC;AACA,QAAIC,SAAS,GAAG8E,eAAe,CAAC9E,SAAhC;AACA,QAAIL,IAAI,GAAG,KAAKrB,KAAL,CAAWsB,iBAAX,CAA6B;AACpCO,MAAAA,UAAU,EAAEA,UADwB;AAEpC8E,MAAAA,MAAM,EAAElF;AAF4B,KAA7B,CAAX,CAXyC,CAezC;;AACA,QAAI,CAACJ,IAAD,IAASA,IAAI,CAACI,WAAL,GAAmBA,WAA5B,IAA2CJ,IAAI,CAACK,SAAL,GAAiBA,SAAhE,EAA2E;AACvE,WAAKiD,QAAL;;AACA;AACH,KAnBwC,CAoBzC;AACA;AACA;AACA;;;AACA,QAAIiC,oBAAoB,GAAI,KAAK7B,aAAL,IAAsB,KAAKA,aAAL,CAAmBpD,OAAnB,CAA2B,KAAK3B,KAAhC,EAAuCwG,eAAvC,EAAwD,KAAK1B,cAA7D,CAAlD,CAxByC,CAyBzC;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAAKhB,4BAAL,GAAqC,IAAI+C,IAAJ,EAAD,CAAaC,OAAb,EAApC;;AACA,QAAIF,oBAAJ,EAA0B;AACtB,UAAI,KAAKhD,sBAAL,IAA+B,KAAKG,sBAAL,KAAgC,CAAC,CAApE,EAAuE;AACnE;AACA;AACAuC,QAAAA,YAAY,CAAC,KAAKvC,sBAAN,CAAZ;AACA,aAAKA,sBAAL,GAA8B,CAAC,CAA/B;;AACA,aAAKgD,uBAAL;AACH;AACJ,KARD,MASK;AACD;AACA;AACA,WAAKpC,QAAL;;AACA,UAAIqC,aAAa,GAAG,EAAE,KAAKrD,oBAA3B;AACA,WAAKC,sBAAL,GAA8B,KAA9B;AACA,WAAKmB,aAAL,GAAqB3B,2BAA2B,CAAC,KAAKpD,KAAN,EAAa,KAAKwD,MAAL,CAAYiD,YAAZ,EAAb,EAAyC,KAAKjD,MAAL,CAAYY,SAAZ,CAAsB;AAAG;AAAzB,OAAzC,CAAhD;AACA,WAAKW,aAAL,CAAmB5D,MAAnB,CAA0BT,IAA1B,CAA+B,UAAUuG,IAAV,EAAgB;AAC3C,YAAID,aAAa,KAAKhG,KAAK,CAAC2C,oBAA5B,EAAkD;AAC9C3C,UAAAA,KAAK,CAAC4C,sBAAN,GAA+B,IAA/B;AACA5C,UAAAA,KAAK,CAAC6C,kBAAN,GAA2BoD,IAAI,IAAI,EAAnC;;AACAjG,UAAAA,KAAK,CAAC+F,uBAAN;AACH;AACJ,OAND,EAMGlJ,iBANH;AAOH;AACJ,GAzDD;;AA0DA0F,EAAAA,eAAe,CAACnH,SAAhB,CAA0B2K,uBAA1B,GAAoD,YAAY;AAC5D,QAAI/F,KAAK,GAAG,IAAZ;;AACA,QAAIkG,WAAW,GAAI,IAAIL,IAAJ,EAAD,CAAaC,OAAb,EAAlB;AACA,QAAIK,iBAAiB,GAAG,KAAKrD,4BAAL,GAAoC,GAA5D;;AACA,QAAIoD,WAAW,IAAIC,iBAAnB,EAAsC;AAClC;AACA,WAAKpD,sBAAL,GAA8B,CAAC,CAA/B;AACA,WAAKqD,iBAAL;AACH,KAJD,MAKK;AACD;AACA,WAAKrD,sBAAL,GAA8BsD,UAAU,CAAC,YAAY;AACjDrG,QAAAA,KAAK,CAACoG,iBAAN;AACH,OAFuC,EAEpCD,iBAAiB,GAAGD,WAFgB,CAAxC;AAGH;AACJ,GAfD;;AAgBA3D,EAAAA,eAAe,CAACnH,SAAhB,CAA0BgL,iBAA1B,GAA8C,YAAY;AACtD,SAAKrD,sBAAL,GAA8B,CAAC,CAA/B;AACA,QAAIuD,WAAW,GAAG,EAAlB;;AACA,SAAK,IAAIpK,CAAC,GAAG,CAAR,EAAWgF,GAAG,GAAG,KAAK2B,kBAAL,CAAwBhH,MAA9C,EAAsDK,CAAC,GAAGgF,GAA1D,EAA+DhF,CAAC,EAAhE,EAAoE;AAChE,UAAIqK,IAAI,GAAG,KAAK1D,kBAAL,CAAwB3G,CAAxB,CAAX;AACAoK,MAAAA,WAAW,CAACE,IAAZ,CAAiB;AACbrF,QAAAA,KAAK,EAAEoF,IAAI,CAACpF,KADC;AAEbsF,QAAAA,OAAO,EAAElE,eAAe,CAACmE,qBAAhB,CAAsCH,IAAI,CAACtE,IAA3C;AAFI,OAAjB;AAIH;;AACD,SAAK6B,cAAL,GAAsB,KAAKtB,MAAL,CAAY4C,gBAAZ,CAA6B,KAAKtB,cAAlC,EAAkDwC,WAAlD,CAAtB;;AACA,SAAKtD,kBAAL,CAAwBqC,GAAxB,CAA4B,KAAKrB,cAAL,EAA5B;AACH,GAZD;;AAaAzB,EAAAA,eAAe,CAACmE,qBAAhB,GAAwC,UAAUzE,IAAV,EAAgB;AACpD,QAAIA,IAAI,KAAKxE,qBAAqB,CAACkJ,KAAnC,EAA0C;AACtC,aAAO,KAAKC,cAAZ;AACH,KAFD,MAGK,IAAI3E,IAAI,KAAKxE,qBAAqB,CAACyE,IAAnC,EAAyC;AAC1C,aAAO,KAAK2E,aAAZ;AACH,KAFI,MAGA;AACD,aAAO,KAAKC,gBAAZ;AACH;AACJ,GAVD;;AAWAvE,EAAAA,eAAe,CAACnH,SAAhB,CAA0B2L,OAA1B,GAAoC,YAAY;AAC5C,SAAKpD,QAAL;;AACA,SAAKjB,QAAL,CAAcqE,OAAd;AACH,GAHD;;AAIAxE,EAAAA,eAAe,CAACqE,cAAhB,GAAiCpJ,sBAAsB,CAACwJ,QAAvB,CAAgC;AAC7DC,IAAAA,UAAU,EAAE;AAAE;AAD+C;AAE7DC,IAAAA,SAAS,EAAE,qBAFkD;AAG7DC,IAAAA,aAAa,EAAE;AACXC,MAAAA,KAAK,EAAEjJ,gBAAgB,CAACU,0CAAD,CADZ;AAEXI,MAAAA,QAAQ,EAAE1B,iBAAiB,CAAC8J;AAFjB;AAH8C,GAAhC,CAAjC;AAQA9E,EAAAA,eAAe,CAACsE,aAAhB,GAAgCrJ,sBAAsB,CAACwJ,QAAvB,CAAgC;AAC5DC,IAAAA,UAAU,EAAE;AAAE;AAD8C;AAE5DC,IAAAA,SAAS,EAAE,oBAFiD;AAG5DC,IAAAA,aAAa,EAAE;AACXC,MAAAA,KAAK,EAAEjJ,gBAAgB,CAACH,yCAAD,CADZ;AAEXiB,MAAAA,QAAQ,EAAE1B,iBAAiB,CAAC8J;AAFjB;AAH6C,GAAhC,CAAhC;AAQA9E,EAAAA,eAAe,CAACuE,gBAAhB,GAAmCtJ,sBAAsB,CAACwJ,QAAvB,CAAgC;AAC/DC,IAAAA,UAAU,EAAE;AAAE;AADiD;AAE/DC,IAAAA,SAAS,EAAE,eAFoD;AAG/DC,IAAAA,aAAa,EAAE;AACXC,MAAAA,KAAK,EAAEjJ,gBAAgB,CAACS,oCAAD,CADZ;AAEXK,MAAAA,QAAQ,EAAE1B,iBAAiB,CAAC8J;AAFjB;AAHgD,GAAhC,CAAnC;AAQA,SAAO9E,eAAP;AACH,CA9PoC,EAArC;;AA+PA,IAAI+E,2BAA2B;AAAG;AAAe,UAAU/F,MAAV,EAAkB;AAC/D/G,EAAAA,SAAS,CAAC8M,2BAAD,EAA8B/F,MAA9B,CAAT;;AACA,WAAS+F,2BAAT,CAAqC9E,MAArC,EAA6CC,iBAA7C,EAAgE;AAC5D,QAAIzC,KAAK,GAAGuB,MAAM,CAACI,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACA3B,IAAAA,KAAK,CAACuH,cAAN,GAAuB,IAAvB;;AACA,QAAIC,+BAA+B,GAAG,YAAY;AAC9C,UAAIhF,MAAM,CAACiF,QAAP,EAAJ,EAAuB;AACnBzH,QAAAA,KAAK,CAACuH,cAAN,GAAuB,IAAIhF,eAAJ,CAAoBC,MAApB,EAA4BC,iBAA5B,CAAvB;AACH;AACJ,KAJD;;AAKAzC,IAAAA,KAAK,CAAC0H,SAAN,CAAgBlF,MAAM,CAACmF,gBAAP,CAAwB,UAAUnE,CAAV,EAAa;AACjD,UAAIxD,KAAK,CAACuH,cAAV,EAA0B;AACtBvH,QAAAA,KAAK,CAACuH,cAAN,CAAqBR,OAArB;;AACA/G,QAAAA,KAAK,CAACuH,cAAN,GAAuB,IAAvB;AACH;;AACDC,MAAAA,+BAA+B;AAClC,KANe,CAAhB;;AAOAA,IAAAA,+BAA+B;AAC/B,WAAOxH,KAAP;AACH;;AACDsH,EAAAA,2BAA2B,CAACM,GAA5B,GAAkC,UAAUpF,MAAV,EAAkB;AAChD,WAAOA,MAAM,CAACqF,eAAP,CAAuBP,2BAA2B,CAACQ,EAAnD,CAAP;AACH,GAFD;;AAGAR,EAAAA,2BAA2B,CAAClM,SAA5B,CAAsC2M,aAAtC,GAAsD,YAAY;AAC9D,QAAI,KAAKR,cAAL,IAAuB,KAAKA,cAAL,CAAoBvD,cAApB,EAA3B,EAAiE;AAC7D,aAAO,IAAP;AACH;;AACD,WAAO,KAAP;AACH,GALD;;AAMAsD,EAAAA,2BAA2B,CAAClM,SAA5B,CAAsCoJ,QAAtC,GAAiD,YAAY;AACzD,QAAI,KAAK+C,cAAT,EAAyB;AACrB,WAAKA,cAAL,CAAoB/C,QAApB;AACH;AACJ,GAJD;;AAKA8C,EAAAA,2BAA2B,CAAClM,SAA5B,CAAsC8J,QAAtC,GAAiD,YAAY;AACzD,QAAI,KAAKqC,cAAT,EAAyB;AACrB,WAAKA,cAAL,CAAoBrC,QAApB;AACH;AACJ,GAJD;;AAKAoC,EAAAA,2BAA2B,CAAClM,SAA5B,CAAsC4M,gBAAtC,GAAyD,UAAUC,KAAV,EAAiB;AACtE,QAAI,KAAKV,cAAL,IAAuBU,KAA3B,EAAkC;AAC9B,WAAKV,cAAL,CAAoBtD,OAApB;AACH;AACJ,GAJD;;AAKAqD,EAAAA,2BAA2B,CAAClM,SAA5B,CAAsC2L,OAAtC,GAAgD,YAAY;AACxD,QAAI,KAAKQ,cAAT,EAAyB;AACrB,WAAKA,cAAL,CAAoBR,OAApB;AACA,WAAKQ,cAAL,GAAsB,IAAtB;AACH;;AACDhG,IAAAA,MAAM,CAACnG,SAAP,CAAiB2L,OAAjB,CAAyBpF,IAAzB,CAA8B,IAA9B;AACH,GAND;;AAOA2F,EAAAA,2BAA2B,CAACQ,EAA5B,GAAiC,gCAAjC;AACAR,EAAAA,2BAA2B,GAAGhM,UAAU,CAAC,CACrCc,OAAO,CAAC,CAAD,EAAIuB,kBAAJ,CAD8B,CAAD,EAErC2J,2BAFqC,CAAxC;AAGA,SAAOA,2BAAP;AACH,CAxDgD,CAwD/CvK,UAxD+C,CAAjD;;AAyDA,IAAImL,6BAA6B;AAAG;AAAe,UAAU3G,MAAV,EAAkB;AACjE/G,EAAAA,SAAS,CAAC0N,6BAAD,EAAgC3G,MAAhC,CAAT;;AACA,WAAS2G,6BAAT,CAAuCC,IAAvC,EAA6CC,IAA7C,EAAmD;AAC/C,QAAIpI,KAAK,GAAGuB,MAAM,CAACI,IAAP,CAAY,IAAZ,EAAkByG,IAAlB,KAA2B,IAAvC;;AACApI,IAAAA,KAAK,CAACqI,OAAN,GAAgBF,IAAhB;AACA,WAAOnI,KAAP;AACH;;AACDkI,EAAAA,6BAA6B,CAAC9M,SAA9B,CAAwCkN,GAAxC,GAA8C,UAAUC,QAAV,EAAoB/F,MAApB,EAA4B;AACtE,QAAIgG,UAAU,GAAGlB,2BAA2B,CAACM,GAA5B,CAAgCpF,MAAhC,CAAjB;;AACA,QAAI,CAACgG,UAAL,EAAiB;AACb;AACH;;AACD,QAAI,KAAKH,OAAT,EAAkB;AACdG,MAAAA,UAAU,CAAChE,QAAX;AACH,KAFD,MAGK;AACDgE,MAAAA,UAAU,CAACtD,QAAX;AACH;AACJ,GAXD;;AAYA,SAAOgD,6BAAP;AACH,CApBkD,CAoBjDjL,YApBiD,CAAnD;;AAqBA,IAAIwL,uBAAuB;AAAG;AAAe,UAAUlH,MAAV,EAAkB;AAC3D/G,EAAAA,SAAS,CAACiO,uBAAD,EAA0BlH,MAA1B,CAAT;;AACA,WAASkH,uBAAT,GAAmC;AAC/B,WAAOlH,MAAM,CAACI,IAAP,CAAY,IAAZ,EAAkB,IAAlB,EAAwB;AAC3B0C,MAAAA,EAAE,EAAE,kCADuB;AAE3BqE,MAAAA,KAAK,EAAEnM,GAAG,CAACiC,QAAJ,CAAa,0BAAb,EAAyC,6BAAzC,CAFoB;AAG3BmK,MAAAA,KAAK,EAAE,6BAHoB;AAI3BC,MAAAA,YAAY,EAAE9J,oBAJa;AAK3B+J,MAAAA,MAAM,EAAE;AACJC,QAAAA,MAAM,EAAExL,iBAAiB,CAACyL,eADtB;AAEJC,QAAAA,OAAO,EAAE;AAAG;AAFR;AAGJC,QAAAA,MAAM,EAAE;AAAI;;AAHR;AALmB,KAAxB,KAUD,IAVN;AAWH;;AACD,SAAOR,uBAAP;AACH,CAhB4C,CAgB3CP,6BAhB2C,CAA7C;;AAiBA,IAAIgB,uBAAuB;AAAG;AAAe,UAAU3H,MAAV,EAAkB;AAC3D/G,EAAAA,SAAS,CAAC0O,uBAAD,EAA0B3H,MAA1B,CAAT;;AACA,WAAS2H,uBAAT,GAAmC;AAC/B,WAAO3H,MAAM,CAACI,IAAP,CAAY,IAAZ,EAAkB,KAAlB,EAAyB;AAC5B0C,MAAAA,EAAE,EAAE,kCADwB;AAE5BqE,MAAAA,KAAK,EAAEnM,GAAG,CAACiC,QAAJ,CAAa,8BAAb,EAA6C,iCAA7C,CAFqB;AAG5BmK,MAAAA,KAAK,EAAE,iCAHqB;AAI5BC,MAAAA,YAAY,EAAE9J,oBAJc;AAK5B+J,MAAAA,MAAM,EAAE;AACJC,QAAAA,MAAM,EAAExL,iBAAiB,CAACyL,eADtB;AAEJC,QAAAA,OAAO,EAAE;AAAK;AAAL,UAAmB;AAAG;AAF3B;AAGJC,QAAAA,MAAM,EAAE;AAAI;;AAHR;AALoB,KAAzB,KAUD,IAVN;AAWH;;AACD,SAAOC,uBAAP;AACH,CAhB4C,CAgB3ChB,6BAhB2C,CAA7C;;AAiBA,IAAIiB,0BAA0B;AAAG;AAAe,UAAU5H,MAAV,EAAkB;AAC9D/G,EAAAA,SAAS,CAAC2O,0BAAD,EAA6B5H,MAA7B,CAAT;;AACA,WAAS4H,0BAAT,GAAsC;AAClC,WAAO5H,MAAM,CAACI,IAAP,CAAY,IAAZ,EAAkB;AACrB0C,MAAAA,EAAE,EAAE,qCADiB;AAErBqE,MAAAA,KAAK,EAAEnM,GAAG,CAACiC,QAAJ,CAAa,6BAAb,EAA4C,0BAA5C,CAFc;AAGrBmK,MAAAA,KAAK,EAAE,0BAHc;AAIrBC,MAAAA,YAAY,EAAE9J,oBAAoB,CAACsK,SAArB,EAJO;AAKrBP,MAAAA,MAAM,EAAE;AACJC,QAAAA,MAAM,EAAExL,iBAAiB,CAACyL,eADtB;AAEJC,QAAAA,OAAO,EAAE,CAFL;AAGJC,QAAAA,MAAM,EAAE;AAAI;;AAHR;AALa,KAAlB,KAUD,IAVN;AAWH;;AACDE,EAAAA,0BAA0B,CAAC/N,SAA3B,CAAqCkN,GAArC,GAA2C,UAAUC,QAAV,EAAoB/F,MAApB,EAA4B6G,IAA5B,EAAkC;AACzE,QAAIb,UAAU,GAAGlB,2BAA2B,CAACM,GAA5B,CAAgCpF,MAAhC,CAAjB;;AACA,QAAI,CAACgG,UAAL,EAAiB;AACb;AACH;;AACDA,IAAAA,UAAU,CAACR,gBAAX,CAA4B,IAA5B;AACH,GAND;;AAOA,SAAOmB,0BAAP;AACH,CAvB+C,CAuB9ClM,YAvB8C,CAAhD;;AAwBAE,0BAA0B,CAACmK,2BAA2B,CAACQ,EAA7B,EAAiCR,2BAAjC,CAA1B;AACApK,oBAAoB,CAACuL,uBAAD,CAApB;AACAvL,oBAAoB,CAACgM,uBAAD,CAApB;AACAhM,oBAAoB,CAACiM,0BAAD,CAApB;AACAjL,0BAA0B,CAAC,UAAUoL,KAAV,EAAiBC,SAAjB,EAA4B;AACnD,MAAIC,kBAAkB,GAAGF,KAAK,CAACG,QAAN,CAAe3L,wBAAf,CAAzB;;AACA,MAAI0L,kBAAJ,EAAwB;AACpBD,IAAAA,SAAS,CAACG,OAAV,CAAkB,qEAAqEF,kBAArE,GAA0F,KAA5G;AACAD,IAAAA,SAAS,CAACG,OAAV,CAAkB,4DAA4DF,kBAAkB,CAACG,WAAnB,CAA+B,GAA/B,CAA5D,GAAkG,KAApH;AACH;;AACD,MAAIC,aAAa,GAAGN,KAAK,CAACG,QAAN,CAAerL,mBAAf,CAApB;;AACA,MAAIwL,aAAJ,EAAmB;AACfL,IAAAA,SAAS,CAACG,OAAV,CAAkB,uDAAuDE,aAAvD,GAAuE,KAAzF;AACH;;AACD,MAAIC,mBAAmB,GAAGP,KAAK,CAACG,QAAN,CAAehL,yBAAf,CAA1B;;AACA,MAAIoL,mBAAJ,EAAyB;AACrBN,IAAAA,SAAS,CAACG,OAAV,CAAkB,6DAA6DG,mBAA7D,GAAmF,KAArG;AACH;;AACD,MAAIC,wBAAwB,GAAGR,KAAK,CAACG,QAAN,CAAe1L,8BAAf,CAA/B;;AACA,MAAI+L,wBAAJ,EAA8B;AAC1BP,IAAAA,SAAS,CAACG,OAAV,CAAkB,uDAAuDJ,KAAK,CAACS,IAAN,KAAe,IAAf,GAAsB,QAAtB,GAAiC,OAAxF,IAAmG,GAAnG,GAAyGD,wBAAzG,GAAoI,6BAAtJ;AACH;;AACD,MAAIE,mBAAmB,GAAGV,KAAK,CAACG,QAAN,CAAe/K,yBAAf,CAA1B;;AACA,MAAIsL,mBAAJ,EAAyB;AACrBT,IAAAA,SAAS,CAACG,OAAV,CAAkB,kDAAkDJ,KAAK,CAACS,IAAN,KAAe,IAAf,GAAsB,QAAtB,GAAiC,OAAnF,IAA8F,GAA9F,GAAoGC,mBAApG,GAA0H,6BAA5I;AACH;;AACD,MAAIC,yBAAyB,GAAGX,KAAK,CAACG,QAAN,CAAe9K,+BAAf,CAAhC;;AACA,MAAIsL,yBAAJ,EAA+B;AAC3BV,IAAAA,SAAS,CAACG,OAAV,CAAkB,wDAAwDJ,KAAK,CAACS,IAAN,KAAe,IAAf,GAAsB,QAAtB,GAAiC,OAAzF,IAAoG,GAApG,GAA0GE,yBAA1G,GAAsI,6BAAxJ;AACH;AACJ,CA1ByB,CAA1B","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport * as nls from '../../../nls.js';\r\nimport * as arrays from '../../../base/common/arrays.js';\r\nimport { createCancelablePromise, first, timeout } from '../../../base/common/async.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { onUnexpectedError, onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerModelAndPositionCommand } from '../../browser/editorExtensions.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { OverviewRulerLane } from '../../common/model.js';\r\nimport { ModelDecorationOptions } from '../../common/model/textModel.js';\r\nimport { DocumentHighlightKind, DocumentHighlightProviderRegistry } from '../../common/modes.js';\r\nimport { IContextKeyService, RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { activeContrastBorder, editorSelectionHighlight, editorSelectionHighlightBorder, overviewRulerSelectionHighlightForeground, registerColor } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant, themeColorFromId } from '../../../platform/theme/common/themeService.js';\r\nvar editorWordHighlight = registerColor('editor.wordHighlightBackground', { dark: '#575757B8', light: '#57575740', hc: null }, nls.localize('wordHighlight', 'Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations.'), true);\r\nvar editorWordHighlightStrong = registerColor('editor.wordHighlightStrongBackground', { dark: '#004972B8', light: '#0e639c40', hc: null }, nls.localize('wordHighlightStrong', 'Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations.'), true);\r\nvar editorWordHighlightBorder = registerColor('editor.wordHighlightBorder', { light: null, dark: null, hc: activeContrastBorder }, nls.localize('wordHighlightBorder', 'Border color of a symbol during read-access, like reading a variable.'));\r\nvar editorWordHighlightStrongBorder = registerColor('editor.wordHighlightStrongBorder', { light: null, dark: null, hc: activeContrastBorder }, nls.localize('wordHighlightStrongBorder', 'Border color of a symbol during write-access, like writing to a variable.'));\r\nvar overviewRulerWordHighlightForeground = registerColor('editorOverviewRuler.wordHighlightForeground', { dark: '#A0A0A0CC', light: '#A0A0A0CC', hc: '#A0A0A0CC' }, nls.localize('overviewRulerWordHighlightForeground', 'Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations.'), true);\r\nvar overviewRulerWordHighlightStrongForeground = registerColor('editorOverviewRuler.wordHighlightStrongForeground', { dark: '#C0A0C0CC', light: '#C0A0C0CC', hc: '#C0A0C0CC' }, nls.localize('overviewRulerWordHighlightStrongForeground', 'Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations.'), true);\r\nvar ctxHasWordHighlights = new RawContextKey('hasWordHighlights', false);\r\nexport function getOccurrencesAtPosition(model, position, token) {\r\n    var orderedByScore = DocumentHighlightProviderRegistry.ordered(model);\r\n    // in order of score ask the occurrences provider\r\n    // until someone response with a good result\r\n    // (good = none empty array)\r\n    return first(orderedByScore.map(function (provider) { return function () {\r\n        return Promise.resolve(provider.provideDocumentHighlights(model, position, token))\r\n            .then(undefined, onUnexpectedExternalError);\r\n    }; }), arrays.isNonEmptyArray);\r\n}\r\nvar OccurenceAtPositionRequest = /** @class */ (function () {\r\n    function OccurenceAtPositionRequest(model, selection, wordSeparators) {\r\n        var _this = this;\r\n        this._wordRange = this._getCurrentWordRange(model, selection);\r\n        this.result = createCancelablePromise(function (token) { return _this._compute(model, selection, wordSeparators, token); });\r\n    }\r\n    OccurenceAtPositionRequest.prototype._getCurrentWordRange = function (model, selection) {\r\n        var word = model.getWordAtPosition(selection.getPosition());\r\n        if (word) {\r\n            return new Range(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);\r\n        }\r\n        return null;\r\n    };\r\n    OccurenceAtPositionRequest.prototype.isValid = function (model, selection, decorationIds) {\r\n        var lineNumber = selection.startLineNumber;\r\n        var startColumn = selection.startColumn;\r\n        var endColumn = selection.endColumn;\r\n        var currentWordRange = this._getCurrentWordRange(model, selection);\r\n        var requestIsValid = Boolean(this._wordRange && this._wordRange.equalsRange(currentWordRange));\r\n        // Even if we are on a different word, if that word is in the decorations ranges, the request is still valid\r\n        // (Same symbol)\r\n        for (var i = 0, len = decorationIds.length; !requestIsValid && i < len; i++) {\r\n            var range = model.getDecorationRange(decorationIds[i]);\r\n            if (range && range.startLineNumber === lineNumber) {\r\n                if (range.startColumn <= startColumn && range.endColumn >= endColumn) {\r\n                    requestIsValid = true;\r\n                }\r\n            }\r\n        }\r\n        return requestIsValid;\r\n    };\r\n    OccurenceAtPositionRequest.prototype.cancel = function () {\r\n        this.result.cancel();\r\n    };\r\n    return OccurenceAtPositionRequest;\r\n}());\r\nvar SemanticOccurenceAtPositionRequest = /** @class */ (function (_super) {\r\n    __extends(SemanticOccurenceAtPositionRequest, _super);\r\n    function SemanticOccurenceAtPositionRequest() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    SemanticOccurenceAtPositionRequest.prototype._compute = function (model, selection, wordSeparators, token) {\r\n        return getOccurrencesAtPosition(model, selection.getPosition(), token).then(function (value) { return value || []; });\r\n    };\r\n    return SemanticOccurenceAtPositionRequest;\r\n}(OccurenceAtPositionRequest));\r\nvar TextualOccurenceAtPositionRequest = /** @class */ (function (_super) {\r\n    __extends(TextualOccurenceAtPositionRequest, _super);\r\n    function TextualOccurenceAtPositionRequest(model, selection, wordSeparators) {\r\n        var _this = _super.call(this, model, selection, wordSeparators) || this;\r\n        _this._selectionIsEmpty = selection.isEmpty();\r\n        return _this;\r\n    }\r\n    TextualOccurenceAtPositionRequest.prototype._compute = function (model, selection, wordSeparators, token) {\r\n        return timeout(250, token).then(function () {\r\n            if (!selection.isEmpty()) {\r\n                return [];\r\n            }\r\n            var word = model.getWordAtPosition(selection.getPosition());\r\n            if (!word) {\r\n                return [];\r\n            }\r\n            var matches = model.findMatches(word.word, true, false, true, wordSeparators, false);\r\n            return matches.map(function (m) {\r\n                return {\r\n                    range: m.range,\r\n                    kind: DocumentHighlightKind.Text\r\n                };\r\n            });\r\n        });\r\n    };\r\n    TextualOccurenceAtPositionRequest.prototype.isValid = function (model, selection, decorationIds) {\r\n        var currentSelectionIsEmpty = selection.isEmpty();\r\n        if (this._selectionIsEmpty !== currentSelectionIsEmpty) {\r\n            return false;\r\n        }\r\n        return _super.prototype.isValid.call(this, model, selection, decorationIds);\r\n    };\r\n    return TextualOccurenceAtPositionRequest;\r\n}(OccurenceAtPositionRequest));\r\nfunction computeOccurencesAtPosition(model, selection, wordSeparators) {\r\n    if (DocumentHighlightProviderRegistry.has(model)) {\r\n        return new SemanticOccurenceAtPositionRequest(model, selection, wordSeparators);\r\n    }\r\n    return new TextualOccurenceAtPositionRequest(model, selection, wordSeparators);\r\n}\r\nregisterModelAndPositionCommand('_executeDocumentHighlights', function (model, position) { return getOccurrencesAtPosition(model, position, CancellationToken.None); });\r\nvar WordHighlighter = /** @class */ (function () {\r\n    function WordHighlighter(editor, contextKeyService) {\r\n        var _this = this;\r\n        this.toUnhook = new DisposableStore();\r\n        this.workerRequestTokenId = 0;\r\n        this.workerRequestCompleted = false;\r\n        this.workerRequestValue = [];\r\n        this.lastCursorPositionChangeTime = 0;\r\n        this.renderDecorationsTimer = -1;\r\n        this.editor = editor;\r\n        this._hasWordHighlights = ctxHasWordHighlights.bindTo(contextKeyService);\r\n        this._ignorePositionChangeEvent = false;\r\n        this.occurrencesHighlight = this.editor.getOption(61 /* occurrencesHighlight */);\r\n        this.model = this.editor.getModel();\r\n        this.toUnhook.add(editor.onDidChangeCursorPosition(function (e) {\r\n            if (_this._ignorePositionChangeEvent) {\r\n                // We are changing the position => ignore this event\r\n                return;\r\n            }\r\n            if (!_this.occurrencesHighlight) {\r\n                // Early exit if nothing needs to be done!\r\n                // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)\r\n                return;\r\n            }\r\n            _this._onPositionChanged(e);\r\n        }));\r\n        this.toUnhook.add(editor.onDidChangeModelContent(function (e) {\r\n            _this._stopAll();\r\n        }));\r\n        this.toUnhook.add(editor.onDidChangeConfiguration(function (e) {\r\n            var newValue = _this.editor.getOption(61 /* occurrencesHighlight */);\r\n            if (_this.occurrencesHighlight !== newValue) {\r\n                _this.occurrencesHighlight = newValue;\r\n                _this._stopAll();\r\n            }\r\n        }));\r\n        this._decorationIds = [];\r\n        this.workerRequestTokenId = 0;\r\n        this.workerRequest = null;\r\n        this.workerRequestCompleted = false;\r\n        this.lastCursorPositionChangeTime = 0;\r\n        this.renderDecorationsTimer = -1;\r\n    }\r\n    WordHighlighter.prototype.hasDecorations = function () {\r\n        return (this._decorationIds.length > 0);\r\n    };\r\n    WordHighlighter.prototype.restore = function () {\r\n        if (!this.occurrencesHighlight) {\r\n            return;\r\n        }\r\n        this._run();\r\n    };\r\n    WordHighlighter.prototype._getSortedHighlights = function () {\r\n        var _this = this;\r\n        return arrays.coalesce(this._decorationIds\r\n            .map(function (id) { return _this.model.getDecorationRange(id); })\r\n            .sort(Range.compareRangesUsingStarts));\r\n    };\r\n    WordHighlighter.prototype.moveNext = function () {\r\n        var _this = this;\r\n        var highlights = this._getSortedHighlights();\r\n        var index = arrays.firstIndex(highlights, function (range) { return range.containsPosition(_this.editor.getPosition()); });\r\n        var newIndex = ((index + 1) % highlights.length);\r\n        var dest = highlights[newIndex];\r\n        try {\r\n            this._ignorePositionChangeEvent = true;\r\n            this.editor.setPosition(dest.getStartPosition());\r\n            this.editor.revealRangeInCenterIfOutsideViewport(dest);\r\n        }\r\n        finally {\r\n            this._ignorePositionChangeEvent = false;\r\n        }\r\n    };\r\n    WordHighlighter.prototype.moveBack = function () {\r\n        var _this = this;\r\n        var highlights = this._getSortedHighlights();\r\n        var index = arrays.firstIndex(highlights, function (range) { return range.containsPosition(_this.editor.getPosition()); });\r\n        var newIndex = ((index - 1 + highlights.length) % highlights.length);\r\n        var dest = highlights[newIndex];\r\n        try {\r\n            this._ignorePositionChangeEvent = true;\r\n            this.editor.setPosition(dest.getStartPosition());\r\n            this.editor.revealRangeInCenterIfOutsideViewport(dest);\r\n        }\r\n        finally {\r\n            this._ignorePositionChangeEvent = false;\r\n        }\r\n    };\r\n    WordHighlighter.prototype._removeDecorations = function () {\r\n        if (this._decorationIds.length > 0) {\r\n            // remove decorations\r\n            this._decorationIds = this.editor.deltaDecorations(this._decorationIds, []);\r\n            this._hasWordHighlights.set(false);\r\n        }\r\n    };\r\n    WordHighlighter.prototype._stopAll = function () {\r\n        // Remove any existing decorations\r\n        this._removeDecorations();\r\n        // Cancel any renderDecorationsTimer\r\n        if (this.renderDecorationsTimer !== -1) {\r\n            clearTimeout(this.renderDecorationsTimer);\r\n            this.renderDecorationsTimer = -1;\r\n        }\r\n        // Cancel any worker request\r\n        if (this.workerRequest !== null) {\r\n            this.workerRequest.cancel();\r\n            this.workerRequest = null;\r\n        }\r\n        // Invalidate any worker request callback\r\n        if (!this.workerRequestCompleted) {\r\n            this.workerRequestTokenId++;\r\n            this.workerRequestCompleted = true;\r\n        }\r\n    };\r\n    WordHighlighter.prototype._onPositionChanged = function (e) {\r\n        // disabled\r\n        if (!this.occurrencesHighlight) {\r\n            this._stopAll();\r\n            return;\r\n        }\r\n        // ignore typing & other\r\n        if (e.reason !== 3 /* Explicit */) {\r\n            this._stopAll();\r\n            return;\r\n        }\r\n        this._run();\r\n    };\r\n    WordHighlighter.prototype._run = function () {\r\n        var _this = this;\r\n        var editorSelection = this.editor.getSelection();\r\n        // ignore multiline selection\r\n        if (editorSelection.startLineNumber !== editorSelection.endLineNumber) {\r\n            this._stopAll();\r\n            return;\r\n        }\r\n        var lineNumber = editorSelection.startLineNumber;\r\n        var startColumn = editorSelection.startColumn;\r\n        var endColumn = editorSelection.endColumn;\r\n        var word = this.model.getWordAtPosition({\r\n            lineNumber: lineNumber,\r\n            column: startColumn\r\n        });\r\n        // The selection must be inside a word or surround one word at most\r\n        if (!word || word.startColumn > startColumn || word.endColumn < endColumn) {\r\n            this._stopAll();\r\n            return;\r\n        }\r\n        // All the effort below is trying to achieve this:\r\n        // - when cursor is moved to a word, trigger immediately a findOccurrences request\r\n        // - 250ms later after the last cursor move event, render the occurrences\r\n        // - no flickering!\r\n        var workerRequestIsValid = (this.workerRequest && this.workerRequest.isValid(this.model, editorSelection, this._decorationIds));\r\n        // There are 4 cases:\r\n        // a) old workerRequest is valid & completed, renderDecorationsTimer fired\r\n        // b) old workerRequest is valid & completed, renderDecorationsTimer not fired\r\n        // c) old workerRequest is valid, but not completed\r\n        // d) old workerRequest is not valid\r\n        // For a) no action is needed\r\n        // For c), member 'lastCursorPositionChangeTime' will be used when installing the timer so no action is needed\r\n        this.lastCursorPositionChangeTime = (new Date()).getTime();\r\n        if (workerRequestIsValid) {\r\n            if (this.workerRequestCompleted && this.renderDecorationsTimer !== -1) {\r\n                // case b)\r\n                // Delay the firing of renderDecorationsTimer by an extra 250 ms\r\n                clearTimeout(this.renderDecorationsTimer);\r\n                this.renderDecorationsTimer = -1;\r\n                this._beginRenderDecorations();\r\n            }\r\n        }\r\n        else {\r\n            // case d)\r\n            // Stop all previous actions and start fresh\r\n            this._stopAll();\r\n            var myRequestId_1 = ++this.workerRequestTokenId;\r\n            this.workerRequestCompleted = false;\r\n            this.workerRequest = computeOccurencesAtPosition(this.model, this.editor.getSelection(), this.editor.getOption(96 /* wordSeparators */));\r\n            this.workerRequest.result.then(function (data) {\r\n                if (myRequestId_1 === _this.workerRequestTokenId) {\r\n                    _this.workerRequestCompleted = true;\r\n                    _this.workerRequestValue = data || [];\r\n                    _this._beginRenderDecorations();\r\n                }\r\n            }, onUnexpectedError);\r\n        }\r\n    };\r\n    WordHighlighter.prototype._beginRenderDecorations = function () {\r\n        var _this = this;\r\n        var currentTime = (new Date()).getTime();\r\n        var minimumRenderTime = this.lastCursorPositionChangeTime + 250;\r\n        if (currentTime >= minimumRenderTime) {\r\n            // Synchronous\r\n            this.renderDecorationsTimer = -1;\r\n            this.renderDecorations();\r\n        }\r\n        else {\r\n            // Asynchronous\r\n            this.renderDecorationsTimer = setTimeout(function () {\r\n                _this.renderDecorations();\r\n            }, (minimumRenderTime - currentTime));\r\n        }\r\n    };\r\n    WordHighlighter.prototype.renderDecorations = function () {\r\n        this.renderDecorationsTimer = -1;\r\n        var decorations = [];\r\n        for (var i = 0, len = this.workerRequestValue.length; i < len; i++) {\r\n            var info = this.workerRequestValue[i];\r\n            decorations.push({\r\n                range: info.range,\r\n                options: WordHighlighter._getDecorationOptions(info.kind)\r\n            });\r\n        }\r\n        this._decorationIds = this.editor.deltaDecorations(this._decorationIds, decorations);\r\n        this._hasWordHighlights.set(this.hasDecorations());\r\n    };\r\n    WordHighlighter._getDecorationOptions = function (kind) {\r\n        if (kind === DocumentHighlightKind.Write) {\r\n            return this._WRITE_OPTIONS;\r\n        }\r\n        else if (kind === DocumentHighlightKind.Text) {\r\n            return this._TEXT_OPTIONS;\r\n        }\r\n        else {\r\n            return this._REGULAR_OPTIONS;\r\n        }\r\n    };\r\n    WordHighlighter.prototype.dispose = function () {\r\n        this._stopAll();\r\n        this.toUnhook.dispose();\r\n    };\r\n    WordHighlighter._WRITE_OPTIONS = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        className: 'wordHighlightStrong',\r\n        overviewRuler: {\r\n            color: themeColorFromId(overviewRulerWordHighlightStrongForeground),\r\n            position: OverviewRulerLane.Center\r\n        }\r\n    });\r\n    WordHighlighter._TEXT_OPTIONS = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        className: 'selectionHighlight',\r\n        overviewRuler: {\r\n            color: themeColorFromId(overviewRulerSelectionHighlightForeground),\r\n            position: OverviewRulerLane.Center\r\n        }\r\n    });\r\n    WordHighlighter._REGULAR_OPTIONS = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        className: 'wordHighlight',\r\n        overviewRuler: {\r\n            color: themeColorFromId(overviewRulerWordHighlightForeground),\r\n            position: OverviewRulerLane.Center\r\n        }\r\n    });\r\n    return WordHighlighter;\r\n}());\r\nvar WordHighlighterContribution = /** @class */ (function (_super) {\r\n    __extends(WordHighlighterContribution, _super);\r\n    function WordHighlighterContribution(editor, contextKeyService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.wordHighligher = null;\r\n        var createWordHighlighterIfPossible = function () {\r\n            if (editor.hasModel()) {\r\n                _this.wordHighligher = new WordHighlighter(editor, contextKeyService);\r\n            }\r\n        };\r\n        _this._register(editor.onDidChangeModel(function (e) {\r\n            if (_this.wordHighligher) {\r\n                _this.wordHighligher.dispose();\r\n                _this.wordHighligher = null;\r\n            }\r\n            createWordHighlighterIfPossible();\r\n        }));\r\n        createWordHighlighterIfPossible();\r\n        return _this;\r\n    }\r\n    WordHighlighterContribution.get = function (editor) {\r\n        return editor.getContribution(WordHighlighterContribution.ID);\r\n    };\r\n    WordHighlighterContribution.prototype.saveViewState = function () {\r\n        if (this.wordHighligher && this.wordHighligher.hasDecorations()) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    WordHighlighterContribution.prototype.moveNext = function () {\r\n        if (this.wordHighligher) {\r\n            this.wordHighligher.moveNext();\r\n        }\r\n    };\r\n    WordHighlighterContribution.prototype.moveBack = function () {\r\n        if (this.wordHighligher) {\r\n            this.wordHighligher.moveBack();\r\n        }\r\n    };\r\n    WordHighlighterContribution.prototype.restoreViewState = function (state) {\r\n        if (this.wordHighligher && state) {\r\n            this.wordHighligher.restore();\r\n        }\r\n    };\r\n    WordHighlighterContribution.prototype.dispose = function () {\r\n        if (this.wordHighligher) {\r\n            this.wordHighligher.dispose();\r\n            this.wordHighligher = null;\r\n        }\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    WordHighlighterContribution.ID = 'editor.contrib.wordHighlighter';\r\n    WordHighlighterContribution = __decorate([\r\n        __param(1, IContextKeyService)\r\n    ], WordHighlighterContribution);\r\n    return WordHighlighterContribution;\r\n}(Disposable));\r\nvar WordHighlightNavigationAction = /** @class */ (function (_super) {\r\n    __extends(WordHighlightNavigationAction, _super);\r\n    function WordHighlightNavigationAction(next, opts) {\r\n        var _this = _super.call(this, opts) || this;\r\n        _this._isNext = next;\r\n        return _this;\r\n    }\r\n    WordHighlightNavigationAction.prototype.run = function (accessor, editor) {\r\n        var controller = WordHighlighterContribution.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        if (this._isNext) {\r\n            controller.moveNext();\r\n        }\r\n        else {\r\n            controller.moveBack();\r\n        }\r\n    };\r\n    return WordHighlightNavigationAction;\r\n}(EditorAction));\r\nvar NextWordHighlightAction = /** @class */ (function (_super) {\r\n    __extends(NextWordHighlightAction, _super);\r\n    function NextWordHighlightAction() {\r\n        return _super.call(this, true, {\r\n            id: 'editor.action.wordHighlight.next',\r\n            label: nls.localize('wordHighlight.next.label', \"Go to Next Symbol Highlight\"),\r\n            alias: 'Go to Next Symbol Highlight',\r\n            precondition: ctxHasWordHighlights,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 65 /* F7 */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    return NextWordHighlightAction;\r\n}(WordHighlightNavigationAction));\r\nvar PrevWordHighlightAction = /** @class */ (function (_super) {\r\n    __extends(PrevWordHighlightAction, _super);\r\n    function PrevWordHighlightAction() {\r\n        return _super.call(this, false, {\r\n            id: 'editor.action.wordHighlight.prev',\r\n            label: nls.localize('wordHighlight.previous.label', \"Go to Previous Symbol Highlight\"),\r\n            alias: 'Go to Previous Symbol Highlight',\r\n            precondition: ctxHasWordHighlights,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 1024 /* Shift */ | 65 /* F7 */,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    return PrevWordHighlightAction;\r\n}(WordHighlightNavigationAction));\r\nvar TriggerWordHighlightAction = /** @class */ (function (_super) {\r\n    __extends(TriggerWordHighlightAction, _super);\r\n    function TriggerWordHighlightAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.wordHighlight.trigger',\r\n            label: nls.localize('wordHighlight.trigger.label', \"Trigger Symbol Highlight\"),\r\n            alias: 'Trigger Symbol Highlight',\r\n            precondition: ctxHasWordHighlights.toNegated(),\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 0,\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    TriggerWordHighlightAction.prototype.run = function (accessor, editor, args) {\r\n        var controller = WordHighlighterContribution.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        controller.restoreViewState(true);\r\n    };\r\n    return TriggerWordHighlightAction;\r\n}(EditorAction));\r\nregisterEditorContribution(WordHighlighterContribution.ID, WordHighlighterContribution);\r\nregisterEditorAction(NextWordHighlightAction);\r\nregisterEditorAction(PrevWordHighlightAction);\r\nregisterEditorAction(TriggerWordHighlightAction);\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var selectionHighlight = theme.getColor(editorSelectionHighlight);\r\n    if (selectionHighlight) {\r\n        collector.addRule(\".monaco-editor .focused .selectionHighlight { background-color: \" + selectionHighlight + \"; }\");\r\n        collector.addRule(\".monaco-editor .selectionHighlight { background-color: \" + selectionHighlight.transparent(0.5) + \"; }\");\r\n    }\r\n    var wordHighlight = theme.getColor(editorWordHighlight);\r\n    if (wordHighlight) {\r\n        collector.addRule(\".monaco-editor .wordHighlight { background-color: \" + wordHighlight + \"; }\");\r\n    }\r\n    var wordHighlightStrong = theme.getColor(editorWordHighlightStrong);\r\n    if (wordHighlightStrong) {\r\n        collector.addRule(\".monaco-editor .wordHighlightStrong { background-color: \" + wordHighlightStrong + \"; }\");\r\n    }\r\n    var selectionHighlightBorder = theme.getColor(editorSelectionHighlightBorder);\r\n    if (selectionHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .selectionHighlight { border: 1px \" + (theme.type === 'hc' ? 'dotted' : 'solid') + \" \" + selectionHighlightBorder + \"; box-sizing: border-box; }\");\r\n    }\r\n    var wordHighlightBorder = theme.getColor(editorWordHighlightBorder);\r\n    if (wordHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .wordHighlight { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + wordHighlightBorder + \"; box-sizing: border-box; }\");\r\n    }\r\n    var wordHighlightStrongBorder = theme.getColor(editorWordHighlightStrongBorder);\r\n    if (wordHighlightStrongBorder) {\r\n        collector.addRule(\".monaco-editor .wordHighlightStrong { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + wordHighlightStrongBorder + \"; box-sizing: border-box; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}