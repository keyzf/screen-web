{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport { RunOnceScheduler, createCancelablePromise } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\n\nvar HoverOperation =\n/** @class */\nfunction () {\n  function HoverOperation(computer, success, error, progress, hoverTime) {\n    var _this = this;\n\n    this._computer = computer;\n    this._state = 0\n    /* IDLE */\n    ;\n    this._hoverTime = hoverTime;\n    this._firstWaitScheduler = new RunOnceScheduler(function () {\n      return _this._triggerAsyncComputation();\n    }, 0);\n    this._secondWaitScheduler = new RunOnceScheduler(function () {\n      return _this._triggerSyncComputation();\n    }, 0);\n    this._loadingMessageScheduler = new RunOnceScheduler(function () {\n      return _this._showLoadingMessage();\n    }, 0);\n    this._asyncComputationPromise = null;\n    this._asyncComputationPromiseDone = false;\n    this._completeCallback = success;\n    this._errorCallback = error;\n    this._progressCallback = progress;\n  }\n\n  HoverOperation.prototype.setHoverTime = function (hoverTime) {\n    this._hoverTime = hoverTime;\n  };\n\n  HoverOperation.prototype._firstWaitTime = function () {\n    return this._hoverTime / 2;\n  };\n\n  HoverOperation.prototype._secondWaitTime = function () {\n    return this._hoverTime / 2;\n  };\n\n  HoverOperation.prototype._loadingMessageTime = function () {\n    return 3 * this._hoverTime;\n  };\n\n  HoverOperation.prototype._triggerAsyncComputation = function () {\n    var _this = this;\n\n    this._state = 2\n    /* SECOND_WAIT */\n    ;\n\n    this._secondWaitScheduler.schedule(this._secondWaitTime());\n\n    if (this._computer.computeAsync) {\n      this._asyncComputationPromiseDone = false;\n      this._asyncComputationPromise = createCancelablePromise(function (token) {\n        return _this._computer.computeAsync(token);\n      });\n\n      this._asyncComputationPromise.then(function (asyncResult) {\n        _this._asyncComputationPromiseDone = true;\n\n        _this._withAsyncResult(asyncResult);\n      }, function (e) {\n        return _this._onError(e);\n      });\n    } else {\n      this._asyncComputationPromiseDone = true;\n    }\n  };\n\n  HoverOperation.prototype._triggerSyncComputation = function () {\n    if (this._computer.computeSync) {\n      this._computer.onResult(this._computer.computeSync(), true);\n    }\n\n    if (this._asyncComputationPromiseDone) {\n      this._state = 0\n      /* IDLE */\n      ;\n\n      this._onComplete(this._computer.getResult());\n    } else {\n      this._state = 3\n      /* WAITING_FOR_ASYNC_COMPUTATION */\n      ;\n\n      this._onProgress(this._computer.getResult());\n    }\n  };\n\n  HoverOperation.prototype._showLoadingMessage = function () {\n    if (this._state === 3\n    /* WAITING_FOR_ASYNC_COMPUTATION */\n    ) {\n        this._onProgress(this._computer.getResultWithLoadingMessage());\n      }\n  };\n\n  HoverOperation.prototype._withAsyncResult = function (asyncResult) {\n    if (asyncResult) {\n      this._computer.onResult(asyncResult, false);\n    }\n\n    if (this._state === 3\n    /* WAITING_FOR_ASYNC_COMPUTATION */\n    ) {\n        this._state = 0\n        /* IDLE */\n        ;\n\n        this._onComplete(this._computer.getResult());\n      }\n  };\n\n  HoverOperation.prototype._onComplete = function (value) {\n    if (this._completeCallback) {\n      this._completeCallback(value);\n    }\n  };\n\n  HoverOperation.prototype._onError = function (error) {\n    if (this._errorCallback) {\n      this._errorCallback(error);\n    } else {\n      onUnexpectedError(error);\n    }\n  };\n\n  HoverOperation.prototype._onProgress = function (value) {\n    if (this._progressCallback) {\n      this._progressCallback(value);\n    }\n  };\n\n  HoverOperation.prototype.start = function (mode) {\n    if (mode === 0\n    /* Delayed */\n    ) {\n        if (this._state === 0\n        /* IDLE */\n        ) {\n            this._state = 1\n            /* FIRST_WAIT */\n            ;\n\n            this._firstWaitScheduler.schedule(this._firstWaitTime());\n\n            this._loadingMessageScheduler.schedule(this._loadingMessageTime());\n          }\n      } else {\n      switch (this._state) {\n        case 0\n        /* IDLE */\n        :\n          this._triggerAsyncComputation();\n\n          this._secondWaitScheduler.cancel();\n\n          this._triggerSyncComputation();\n\n          break;\n\n        case 2\n        /* SECOND_WAIT */\n        :\n          this._secondWaitScheduler.cancel();\n\n          this._triggerSyncComputation();\n\n          break;\n      }\n    }\n  };\n\n  HoverOperation.prototype.cancel = function () {\n    this._loadingMessageScheduler.cancel();\n\n    if (this._state === 1\n    /* FIRST_WAIT */\n    ) {\n        this._firstWaitScheduler.cancel();\n      }\n\n    if (this._state === 2\n    /* SECOND_WAIT */\n    ) {\n        this._secondWaitScheduler.cancel();\n\n        if (this._asyncComputationPromise) {\n          this._asyncComputationPromise.cancel();\n\n          this._asyncComputationPromise = null;\n        }\n      }\n\n    if (this._state === 3\n    /* WAITING_FOR_ASYNC_COMPUTATION */\n    ) {\n        if (this._asyncComputationPromise) {\n          this._asyncComputationPromise.cancel();\n\n          this._asyncComputationPromise = null;\n        }\n      }\n\n    this._state = 0\n    /* IDLE */\n    ;\n  };\n\n  return HoverOperation;\n}();\n\nexport { HoverOperation };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/hover/hoverOperation.js"],"names":["RunOnceScheduler","createCancelablePromise","onUnexpectedError","HoverOperation","computer","success","error","progress","hoverTime","_this","_computer","_state","_hoverTime","_firstWaitScheduler","_triggerAsyncComputation","_secondWaitScheduler","_triggerSyncComputation","_loadingMessageScheduler","_showLoadingMessage","_asyncComputationPromise","_asyncComputationPromiseDone","_completeCallback","_errorCallback","_progressCallback","prototype","setHoverTime","_firstWaitTime","_secondWaitTime","_loadingMessageTime","schedule","computeAsync","token","then","asyncResult","_withAsyncResult","e","_onError","computeSync","onResult","_onComplete","getResult","_onProgress","getResultWithLoadingMessage","value","start","mode","cancel"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { RunOnceScheduler, createCancelablePromise } from '../../../base/common/async.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nvar HoverOperation = /** @class */ (function () {\r\n    function HoverOperation(computer, success, error, progress, hoverTime) {\r\n        var _this = this;\r\n        this._computer = computer;\r\n        this._state = 0 /* IDLE */;\r\n        this._hoverTime = hoverTime;\r\n        this._firstWaitScheduler = new RunOnceScheduler(function () { return _this._triggerAsyncComputation(); }, 0);\r\n        this._secondWaitScheduler = new RunOnceScheduler(function () { return _this._triggerSyncComputation(); }, 0);\r\n        this._loadingMessageScheduler = new RunOnceScheduler(function () { return _this._showLoadingMessage(); }, 0);\r\n        this._asyncComputationPromise = null;\r\n        this._asyncComputationPromiseDone = false;\r\n        this._completeCallback = success;\r\n        this._errorCallback = error;\r\n        this._progressCallback = progress;\r\n    }\r\n    HoverOperation.prototype.setHoverTime = function (hoverTime) {\r\n        this._hoverTime = hoverTime;\r\n    };\r\n    HoverOperation.prototype._firstWaitTime = function () {\r\n        return this._hoverTime / 2;\r\n    };\r\n    HoverOperation.prototype._secondWaitTime = function () {\r\n        return this._hoverTime / 2;\r\n    };\r\n    HoverOperation.prototype._loadingMessageTime = function () {\r\n        return 3 * this._hoverTime;\r\n    };\r\n    HoverOperation.prototype._triggerAsyncComputation = function () {\r\n        var _this = this;\r\n        this._state = 2 /* SECOND_WAIT */;\r\n        this._secondWaitScheduler.schedule(this._secondWaitTime());\r\n        if (this._computer.computeAsync) {\r\n            this._asyncComputationPromiseDone = false;\r\n            this._asyncComputationPromise = createCancelablePromise(function (token) { return _this._computer.computeAsync(token); });\r\n            this._asyncComputationPromise.then(function (asyncResult) {\r\n                _this._asyncComputationPromiseDone = true;\r\n                _this._withAsyncResult(asyncResult);\r\n            }, function (e) { return _this._onError(e); });\r\n        }\r\n        else {\r\n            this._asyncComputationPromiseDone = true;\r\n        }\r\n    };\r\n    HoverOperation.prototype._triggerSyncComputation = function () {\r\n        if (this._computer.computeSync) {\r\n            this._computer.onResult(this._computer.computeSync(), true);\r\n        }\r\n        if (this._asyncComputationPromiseDone) {\r\n            this._state = 0 /* IDLE */;\r\n            this._onComplete(this._computer.getResult());\r\n        }\r\n        else {\r\n            this._state = 3 /* WAITING_FOR_ASYNC_COMPUTATION */;\r\n            this._onProgress(this._computer.getResult());\r\n        }\r\n    };\r\n    HoverOperation.prototype._showLoadingMessage = function () {\r\n        if (this._state === 3 /* WAITING_FOR_ASYNC_COMPUTATION */) {\r\n            this._onProgress(this._computer.getResultWithLoadingMessage());\r\n        }\r\n    };\r\n    HoverOperation.prototype._withAsyncResult = function (asyncResult) {\r\n        if (asyncResult) {\r\n            this._computer.onResult(asyncResult, false);\r\n        }\r\n        if (this._state === 3 /* WAITING_FOR_ASYNC_COMPUTATION */) {\r\n            this._state = 0 /* IDLE */;\r\n            this._onComplete(this._computer.getResult());\r\n        }\r\n    };\r\n    HoverOperation.prototype._onComplete = function (value) {\r\n        if (this._completeCallback) {\r\n            this._completeCallback(value);\r\n        }\r\n    };\r\n    HoverOperation.prototype._onError = function (error) {\r\n        if (this._errorCallback) {\r\n            this._errorCallback(error);\r\n        }\r\n        else {\r\n            onUnexpectedError(error);\r\n        }\r\n    };\r\n    HoverOperation.prototype._onProgress = function (value) {\r\n        if (this._progressCallback) {\r\n            this._progressCallback(value);\r\n        }\r\n    };\r\n    HoverOperation.prototype.start = function (mode) {\r\n        if (mode === 0 /* Delayed */) {\r\n            if (this._state === 0 /* IDLE */) {\r\n                this._state = 1 /* FIRST_WAIT */;\r\n                this._firstWaitScheduler.schedule(this._firstWaitTime());\r\n                this._loadingMessageScheduler.schedule(this._loadingMessageTime());\r\n            }\r\n        }\r\n        else {\r\n            switch (this._state) {\r\n                case 0 /* IDLE */:\r\n                    this._triggerAsyncComputation();\r\n                    this._secondWaitScheduler.cancel();\r\n                    this._triggerSyncComputation();\r\n                    break;\r\n                case 2 /* SECOND_WAIT */:\r\n                    this._secondWaitScheduler.cancel();\r\n                    this._triggerSyncComputation();\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    HoverOperation.prototype.cancel = function () {\r\n        this._loadingMessageScheduler.cancel();\r\n        if (this._state === 1 /* FIRST_WAIT */) {\r\n            this._firstWaitScheduler.cancel();\r\n        }\r\n        if (this._state === 2 /* SECOND_WAIT */) {\r\n            this._secondWaitScheduler.cancel();\r\n            if (this._asyncComputationPromise) {\r\n                this._asyncComputationPromise.cancel();\r\n                this._asyncComputationPromise = null;\r\n            }\r\n        }\r\n        if (this._state === 3 /* WAITING_FOR_ASYNC_COMPUTATION */) {\r\n            if (this._asyncComputationPromise) {\r\n                this._asyncComputationPromise.cancel();\r\n                this._asyncComputationPromise = null;\r\n            }\r\n        }\r\n        this._state = 0 /* IDLE */;\r\n    };\r\n    return HoverOperation;\r\n}());\r\nexport { HoverOperation };\r\n"]},"metadata":{},"sourceType":"module"}