{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport './inspectTokens.css';\nimport { Color } from '../../../../base/common/color.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { escape } from '../../../../base/common/strings.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { TokenMetadata, TokenizationRegistry } from '../../../common/modes.js';\nimport { NULL_STATE, nullTokenize, nullTokenize2 } from '../../../common/modes/nullMode.js';\nimport { IModeService } from '../../../common/services/modeService.js';\nimport { IStandaloneThemeService } from '../../common/standaloneThemeService.js';\nimport { editorHoverBackground, editorHoverBorder, editorHoverForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { HIGH_CONTRAST, registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\nimport { InspectTokensNLS } from '../../../common/standaloneStrings.js';\n\nvar InspectTokensController =\n/** @class */\nfunction (_super) {\n  __extends(InspectTokensController, _super);\n\n  function InspectTokensController(editor, standaloneColorService, modeService) {\n    var _this = _super.call(this) || this;\n\n    _this._editor = editor;\n    _this._modeService = modeService;\n    _this._widget = null;\n\n    _this._register(_this._editor.onDidChangeModel(function (e) {\n      return _this.stop();\n    }));\n\n    _this._register(_this._editor.onDidChangeModelLanguage(function (e) {\n      return _this.stop();\n    }));\n\n    _this._register(TokenizationRegistry.onDidChange(function (e) {\n      return _this.stop();\n    }));\n\n    return _this;\n  }\n\n  InspectTokensController.get = function (editor) {\n    return editor.getContribution(InspectTokensController.ID);\n  };\n\n  InspectTokensController.prototype.dispose = function () {\n    this.stop();\n\n    _super.prototype.dispose.call(this);\n  };\n\n  InspectTokensController.prototype.launch = function () {\n    if (this._widget) {\n      return;\n    }\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    this._widget = new InspectTokensWidget(this._editor, this._modeService);\n  };\n\n  InspectTokensController.prototype.stop = function () {\n    if (this._widget) {\n      this._widget.dispose();\n\n      this._widget = null;\n    }\n  };\n\n  InspectTokensController.ID = 'editor.contrib.inspectTokens';\n  InspectTokensController = __decorate([__param(1, IStandaloneThemeService), __param(2, IModeService)], InspectTokensController);\n  return InspectTokensController;\n}(Disposable);\n\nvar InspectTokens =\n/** @class */\nfunction (_super) {\n  __extends(InspectTokens, _super);\n\n  function InspectTokens() {\n    return _super.call(this, {\n      id: 'editor.action.inspectTokens',\n      label: InspectTokensNLS.inspectTokensAction,\n      alias: 'Developer: Inspect Tokens',\n      precondition: undefined\n    }) || this;\n  }\n\n  InspectTokens.prototype.run = function (accessor, editor) {\n    var controller = InspectTokensController.get(editor);\n\n    if (controller) {\n      controller.launch();\n    }\n  };\n\n  return InspectTokens;\n}(EditorAction);\n\nfunction renderTokenText(tokenText) {\n  var result = '';\n\n  for (var charIndex = 0, len = tokenText.length; charIndex < len; charIndex++) {\n    var charCode = tokenText.charCodeAt(charIndex);\n\n    switch (charCode) {\n      case 9\n      /* Tab */\n      :\n        result += '&rarr;';\n        break;\n\n      case 32\n      /* Space */\n      :\n        result += '&middot;';\n        break;\n\n      case 60\n      /* LessThan */\n      :\n        result += '&lt;';\n        break;\n\n      case 62\n      /* GreaterThan */\n      :\n        result += '&gt;';\n        break;\n\n      case 38\n      /* Ampersand */\n      :\n        result += '&amp;';\n        break;\n\n      default:\n        result += String.fromCharCode(charCode);\n    }\n  }\n\n  return result;\n}\n\nfunction getSafeTokenizationSupport(languageIdentifier) {\n  var tokenizationSupport = TokenizationRegistry.get(languageIdentifier.language);\n\n  if (tokenizationSupport) {\n    return tokenizationSupport;\n  }\n\n  return {\n    getInitialState: function () {\n      return NULL_STATE;\n    },\n    tokenize: function (line, state, deltaOffset) {\n      return nullTokenize(languageIdentifier.language, line, state, deltaOffset);\n    },\n    tokenize2: function (line, state, deltaOffset) {\n      return nullTokenize2(languageIdentifier.id, line, state, deltaOffset);\n    }\n  };\n}\n\nvar InspectTokensWidget =\n/** @class */\nfunction (_super) {\n  __extends(InspectTokensWidget, _super);\n\n  function InspectTokensWidget(editor, modeService) {\n    var _this = _super.call(this) || this; // Editor.IContentWidget.allowEditorOverflow\n\n\n    _this.allowEditorOverflow = true;\n    _this._editor = editor;\n    _this._modeService = modeService;\n    _this._model = _this._editor.getModel();\n    _this._domNode = document.createElement('div');\n    _this._domNode.className = 'tokens-inspect-widget';\n    _this._tokenizationSupport = getSafeTokenizationSupport(_this._model.getLanguageIdentifier());\n\n    _this._compute(_this._editor.getPosition());\n\n    _this._register(_this._editor.onDidChangeCursorPosition(function (e) {\n      return _this._compute(_this._editor.getPosition());\n    }));\n\n    _this._editor.addContentWidget(_this);\n\n    return _this;\n  }\n\n  InspectTokensWidget.prototype.dispose = function () {\n    this._editor.removeContentWidget(this);\n\n    _super.prototype.dispose.call(this);\n  };\n\n  InspectTokensWidget.prototype.getId = function () {\n    return InspectTokensWidget._ID;\n  };\n\n  InspectTokensWidget.prototype._compute = function (position) {\n    var data = this._getTokensAtLine(position.lineNumber);\n\n    var token1Index = 0;\n\n    for (var i = data.tokens1.length - 1; i >= 0; i--) {\n      var t = data.tokens1[i];\n\n      if (position.column - 1 >= t.offset) {\n        token1Index = i;\n        break;\n      }\n    }\n\n    var token2Index = 0;\n\n    for (var i = data.tokens2.length >>> 1; i >= 0; i--) {\n      if (position.column - 1 >= data.tokens2[i << 1]) {\n        token2Index = i;\n        break;\n      }\n    }\n\n    var result = '';\n\n    var lineContent = this._model.getLineContent(position.lineNumber);\n\n    var tokenText = '';\n\n    if (token1Index < data.tokens1.length) {\n      var tokenStartIndex = data.tokens1[token1Index].offset;\n      var tokenEndIndex = token1Index + 1 < data.tokens1.length ? data.tokens1[token1Index + 1].offset : lineContent.length;\n      tokenText = lineContent.substring(tokenStartIndex, tokenEndIndex);\n    }\n\n    result += \"<h2 class=\\\"tm-token\\\">\" + renderTokenText(tokenText) + \"<span class=\\\"tm-token-length\\\">(\" + tokenText.length + \" \" + (tokenText.length === 1 ? 'char' : 'chars') + \")</span></h2>\";\n    result += \"<hr class=\\\"tokens-inspect-separator\\\" style=\\\"clear:both\\\"/>\";\n\n    var metadata = this._decodeMetadata(data.tokens2[(token2Index << 1) + 1]);\n\n    result += \"<table class=\\\"tm-metadata-table\\\"><tbody>\";\n    result += \"<tr><td class=\\\"tm-metadata-key\\\">language</td><td class=\\\"tm-metadata-value\\\">\" + escape(metadata.languageIdentifier.language) + \"</td>\";\n    result += \"<tr><td class=\\\"tm-metadata-key\\\">token type</td><td class=\\\"tm-metadata-value\\\">\" + this._tokenTypeToString(metadata.tokenType) + \"</td>\";\n    result += \"<tr><td class=\\\"tm-metadata-key\\\">font style</td><td class=\\\"tm-metadata-value\\\">\" + this._fontStyleToString(metadata.fontStyle) + \"</td>\";\n    result += \"<tr><td class=\\\"tm-metadata-key\\\">foreground</td><td class=\\\"tm-metadata-value\\\">\" + Color.Format.CSS.formatHex(metadata.foreground) + \"</td>\";\n    result += \"<tr><td class=\\\"tm-metadata-key\\\">background</td><td class=\\\"tm-metadata-value\\\">\" + Color.Format.CSS.formatHex(metadata.background) + \"</td>\";\n    result += \"</tbody></table>\";\n    result += \"<hr class=\\\"tokens-inspect-separator\\\"/>\";\n\n    if (token1Index < data.tokens1.length) {\n      result += \"<span class=\\\"tm-token-type\\\">\" + escape(data.tokens1[token1Index].type) + \"</span>\";\n    }\n\n    this._domNode.innerHTML = result;\n\n    this._editor.layoutContentWidget(this);\n  };\n\n  InspectTokensWidget.prototype._decodeMetadata = function (metadata) {\n    var colorMap = TokenizationRegistry.getColorMap();\n    var languageId = TokenMetadata.getLanguageId(metadata);\n    var tokenType = TokenMetadata.getTokenType(metadata);\n    var fontStyle = TokenMetadata.getFontStyle(metadata);\n    var foreground = TokenMetadata.getForeground(metadata);\n    var background = TokenMetadata.getBackground(metadata);\n    return {\n      languageIdentifier: this._modeService.getLanguageIdentifier(languageId),\n      tokenType: tokenType,\n      fontStyle: fontStyle,\n      foreground: colorMap[foreground],\n      background: colorMap[background]\n    };\n  };\n\n  InspectTokensWidget.prototype._tokenTypeToString = function (tokenType) {\n    switch (tokenType) {\n      case 0\n      /* Other */\n      :\n        return 'Other';\n\n      case 1\n      /* Comment */\n      :\n        return 'Comment';\n\n      case 2\n      /* String */\n      :\n        return 'String';\n\n      case 4\n      /* RegEx */\n      :\n        return 'RegEx';\n    }\n\n    return '??';\n  };\n\n  InspectTokensWidget.prototype._fontStyleToString = function (fontStyle) {\n    var r = '';\n\n    if (fontStyle & 1\n    /* Italic */\n    ) {\n        r += 'italic ';\n      }\n\n    if (fontStyle & 2\n    /* Bold */\n    ) {\n        r += 'bold ';\n      }\n\n    if (fontStyle & 4\n    /* Underline */\n    ) {\n        r += 'underline ';\n      }\n\n    if (r.length === 0) {\n      r = '---';\n    }\n\n    return r;\n  };\n\n  InspectTokensWidget.prototype._getTokensAtLine = function (lineNumber) {\n    var stateBeforeLine = this._getStateBeforeLine(lineNumber);\n\n    var tokenizationResult1 = this._tokenizationSupport.tokenize(this._model.getLineContent(lineNumber), stateBeforeLine, 0);\n\n    var tokenizationResult2 = this._tokenizationSupport.tokenize2(this._model.getLineContent(lineNumber), stateBeforeLine, 0);\n\n    return {\n      startState: stateBeforeLine,\n      tokens1: tokenizationResult1.tokens,\n      tokens2: tokenizationResult2.tokens,\n      endState: tokenizationResult1.endState\n    };\n  };\n\n  InspectTokensWidget.prototype._getStateBeforeLine = function (lineNumber) {\n    var state = this._tokenizationSupport.getInitialState();\n\n    for (var i = 1; i < lineNumber; i++) {\n      var tokenizationResult = this._tokenizationSupport.tokenize(this._model.getLineContent(i), state, 0);\n\n      state = tokenizationResult.endState;\n    }\n\n    return state;\n  };\n\n  InspectTokensWidget.prototype.getDomNode = function () {\n    return this._domNode;\n  };\n\n  InspectTokensWidget.prototype.getPosition = function () {\n    return {\n      position: this._editor.getPosition(),\n      preference: [2\n      /* BELOW */\n      , 1\n      /* ABOVE */\n      ]\n    };\n  };\n\n  InspectTokensWidget._ID = 'editor.contrib.inspectTokensWidget';\n  return InspectTokensWidget;\n}(Disposable);\n\nregisterEditorContribution(InspectTokensController.ID, InspectTokensController);\nregisterEditorAction(InspectTokens);\nregisterThemingParticipant(function (theme, collector) {\n  var border = theme.getColor(editorHoverBorder);\n\n  if (border) {\n    var borderWidth = theme.type === HIGH_CONTRAST ? 2 : 1;\n    collector.addRule(\".monaco-editor .tokens-inspect-widget { border: \" + borderWidth + \"px solid \" + border + \"; }\");\n    collector.addRule(\".monaco-editor .tokens-inspect-widget .tokens-inspect-separator { background-color: \" + border + \"; }\");\n  }\n\n  var background = theme.getColor(editorHoverBackground);\n\n  if (background) {\n    collector.addRule(\".monaco-editor .tokens-inspect-widget { background-color: \" + background + \"; }\");\n  }\n\n  var foreground = theme.getColor(editorHoverForeground);\n\n  if (foreground) {\n    collector.addRule(\".monaco-editor .tokens-inspect-widget { color: \" + foreground + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/standalone/browser/inspectTokens/inspectTokens.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","Color","Disposable","escape","EditorAction","registerEditorAction","registerEditorContribution","TokenMetadata","TokenizationRegistry","NULL_STATE","nullTokenize","nullTokenize2","IModeService","IStandaloneThemeService","editorHoverBackground","editorHoverBorder","editorHoverForeground","HIGH_CONTRAST","registerThemingParticipant","InspectTokensNLS","InspectTokensController","_super","editor","standaloneColorService","modeService","_this","call","_editor","_modeService","_widget","_register","onDidChangeModel","e","stop","onDidChangeModelLanguage","onDidChange","get","getContribution","ID","dispose","launch","hasModel","InspectTokensWidget","InspectTokens","id","label","inspectTokensAction","alias","precondition","undefined","run","accessor","controller","renderTokenText","tokenText","result","charIndex","len","charCode","charCodeAt","String","fromCharCode","getSafeTokenizationSupport","languageIdentifier","tokenizationSupport","language","getInitialState","tokenize","line","state","deltaOffset","tokenize2","allowEditorOverflow","_model","getModel","_domNode","document","createElement","className","_tokenizationSupport","getLanguageIdentifier","_compute","getPosition","onDidChangeCursorPosition","addContentWidget","removeContentWidget","getId","_ID","position","data","_getTokensAtLine","lineNumber","token1Index","tokens1","t","column","offset","token2Index","tokens2","lineContent","getLineContent","tokenStartIndex","tokenEndIndex","substring","metadata","_decodeMetadata","_tokenTypeToString","tokenType","_fontStyleToString","fontStyle","Format","CSS","formatHex","foreground","background","type","innerHTML","layoutContentWidget","colorMap","getColorMap","languageId","getLanguageId","getTokenType","getFontStyle","getForeground","getBackground","stateBeforeLine","_getStateBeforeLine","tokenizationResult1","tokenizationResult2","startState","tokens","endState","tokenizationResult","getDomNode","preference","theme","collector","border","getColor","borderWidth","addRule"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport './inspectTokens.css';\r\nimport { Color } from '../../../../base/common/color.js';\r\nimport { Disposable } from '../../../../base/common/lifecycle.js';\r\nimport { escape } from '../../../../base/common/strings.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\r\nimport { TokenMetadata, TokenizationRegistry } from '../../../common/modes.js';\r\nimport { NULL_STATE, nullTokenize, nullTokenize2 } from '../../../common/modes/nullMode.js';\r\nimport { IModeService } from '../../../common/services/modeService.js';\r\nimport { IStandaloneThemeService } from '../../common/standaloneThemeService.js';\r\nimport { editorHoverBackground, editorHoverBorder, editorHoverForeground } from '../../../../platform/theme/common/colorRegistry.js';\r\nimport { HIGH_CONTRAST, registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\r\nimport { InspectTokensNLS } from '../../../common/standaloneStrings.js';\r\nvar InspectTokensController = /** @class */ (function (_super) {\r\n    __extends(InspectTokensController, _super);\r\n    function InspectTokensController(editor, standaloneColorService, modeService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = editor;\r\n        _this._modeService = modeService;\r\n        _this._widget = null;\r\n        _this._register(_this._editor.onDidChangeModel(function (e) { return _this.stop(); }));\r\n        _this._register(_this._editor.onDidChangeModelLanguage(function (e) { return _this.stop(); }));\r\n        _this._register(TokenizationRegistry.onDidChange(function (e) { return _this.stop(); }));\r\n        return _this;\r\n    }\r\n    InspectTokensController.get = function (editor) {\r\n        return editor.getContribution(InspectTokensController.ID);\r\n    };\r\n    InspectTokensController.prototype.dispose = function () {\r\n        this.stop();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    InspectTokensController.prototype.launch = function () {\r\n        if (this._widget) {\r\n            return;\r\n        }\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        this._widget = new InspectTokensWidget(this._editor, this._modeService);\r\n    };\r\n    InspectTokensController.prototype.stop = function () {\r\n        if (this._widget) {\r\n            this._widget.dispose();\r\n            this._widget = null;\r\n        }\r\n    };\r\n    InspectTokensController.ID = 'editor.contrib.inspectTokens';\r\n    InspectTokensController = __decorate([\r\n        __param(1, IStandaloneThemeService),\r\n        __param(2, IModeService)\r\n    ], InspectTokensController);\r\n    return InspectTokensController;\r\n}(Disposable));\r\nvar InspectTokens = /** @class */ (function (_super) {\r\n    __extends(InspectTokens, _super);\r\n    function InspectTokens() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.inspectTokens',\r\n            label: InspectTokensNLS.inspectTokensAction,\r\n            alias: 'Developer: Inspect Tokens',\r\n            precondition: undefined\r\n        }) || this;\r\n    }\r\n    InspectTokens.prototype.run = function (accessor, editor) {\r\n        var controller = InspectTokensController.get(editor);\r\n        if (controller) {\r\n            controller.launch();\r\n        }\r\n    };\r\n    return InspectTokens;\r\n}(EditorAction));\r\nfunction renderTokenText(tokenText) {\r\n    var result = '';\r\n    for (var charIndex = 0, len = tokenText.length; charIndex < len; charIndex++) {\r\n        var charCode = tokenText.charCodeAt(charIndex);\r\n        switch (charCode) {\r\n            case 9 /* Tab */:\r\n                result += '&rarr;';\r\n                break;\r\n            case 32 /* Space */:\r\n                result += '&middot;';\r\n                break;\r\n            case 60 /* LessThan */:\r\n                result += '&lt;';\r\n                break;\r\n            case 62 /* GreaterThan */:\r\n                result += '&gt;';\r\n                break;\r\n            case 38 /* Ampersand */:\r\n                result += '&amp;';\r\n                break;\r\n            default:\r\n                result += String.fromCharCode(charCode);\r\n        }\r\n    }\r\n    return result;\r\n}\r\nfunction getSafeTokenizationSupport(languageIdentifier) {\r\n    var tokenizationSupport = TokenizationRegistry.get(languageIdentifier.language);\r\n    if (tokenizationSupport) {\r\n        return tokenizationSupport;\r\n    }\r\n    return {\r\n        getInitialState: function () { return NULL_STATE; },\r\n        tokenize: function (line, state, deltaOffset) { return nullTokenize(languageIdentifier.language, line, state, deltaOffset); },\r\n        tokenize2: function (line, state, deltaOffset) { return nullTokenize2(languageIdentifier.id, line, state, deltaOffset); }\r\n    };\r\n}\r\nvar InspectTokensWidget = /** @class */ (function (_super) {\r\n    __extends(InspectTokensWidget, _super);\r\n    function InspectTokensWidget(editor, modeService) {\r\n        var _this = _super.call(this) || this;\r\n        // Editor.IContentWidget.allowEditorOverflow\r\n        _this.allowEditorOverflow = true;\r\n        _this._editor = editor;\r\n        _this._modeService = modeService;\r\n        _this._model = _this._editor.getModel();\r\n        _this._domNode = document.createElement('div');\r\n        _this._domNode.className = 'tokens-inspect-widget';\r\n        _this._tokenizationSupport = getSafeTokenizationSupport(_this._model.getLanguageIdentifier());\r\n        _this._compute(_this._editor.getPosition());\r\n        _this._register(_this._editor.onDidChangeCursorPosition(function (e) { return _this._compute(_this._editor.getPosition()); }));\r\n        _this._editor.addContentWidget(_this);\r\n        return _this;\r\n    }\r\n    InspectTokensWidget.prototype.dispose = function () {\r\n        this._editor.removeContentWidget(this);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    InspectTokensWidget.prototype.getId = function () {\r\n        return InspectTokensWidget._ID;\r\n    };\r\n    InspectTokensWidget.prototype._compute = function (position) {\r\n        var data = this._getTokensAtLine(position.lineNumber);\r\n        var token1Index = 0;\r\n        for (var i = data.tokens1.length - 1; i >= 0; i--) {\r\n            var t = data.tokens1[i];\r\n            if (position.column - 1 >= t.offset) {\r\n                token1Index = i;\r\n                break;\r\n            }\r\n        }\r\n        var token2Index = 0;\r\n        for (var i = (data.tokens2.length >>> 1); i >= 0; i--) {\r\n            if (position.column - 1 >= data.tokens2[(i << 1)]) {\r\n                token2Index = i;\r\n                break;\r\n            }\r\n        }\r\n        var result = '';\r\n        var lineContent = this._model.getLineContent(position.lineNumber);\r\n        var tokenText = '';\r\n        if (token1Index < data.tokens1.length) {\r\n            var tokenStartIndex = data.tokens1[token1Index].offset;\r\n            var tokenEndIndex = token1Index + 1 < data.tokens1.length ? data.tokens1[token1Index + 1].offset : lineContent.length;\r\n            tokenText = lineContent.substring(tokenStartIndex, tokenEndIndex);\r\n        }\r\n        result += \"<h2 class=\\\"tm-token\\\">\" + renderTokenText(tokenText) + \"<span class=\\\"tm-token-length\\\">(\" + tokenText.length + \" \" + (tokenText.length === 1 ? 'char' : 'chars') + \")</span></h2>\";\r\n        result += \"<hr class=\\\"tokens-inspect-separator\\\" style=\\\"clear:both\\\"/>\";\r\n        var metadata = this._decodeMetadata(data.tokens2[(token2Index << 1) + 1]);\r\n        result += \"<table class=\\\"tm-metadata-table\\\"><tbody>\";\r\n        result += \"<tr><td class=\\\"tm-metadata-key\\\">language</td><td class=\\\"tm-metadata-value\\\">\" + escape(metadata.languageIdentifier.language) + \"</td>\";\r\n        result += \"<tr><td class=\\\"tm-metadata-key\\\">token type</td><td class=\\\"tm-metadata-value\\\">\" + this._tokenTypeToString(metadata.tokenType) + \"</td>\";\r\n        result += \"<tr><td class=\\\"tm-metadata-key\\\">font style</td><td class=\\\"tm-metadata-value\\\">\" + this._fontStyleToString(metadata.fontStyle) + \"</td>\";\r\n        result += \"<tr><td class=\\\"tm-metadata-key\\\">foreground</td><td class=\\\"tm-metadata-value\\\">\" + Color.Format.CSS.formatHex(metadata.foreground) + \"</td>\";\r\n        result += \"<tr><td class=\\\"tm-metadata-key\\\">background</td><td class=\\\"tm-metadata-value\\\">\" + Color.Format.CSS.formatHex(metadata.background) + \"</td>\";\r\n        result += \"</tbody></table>\";\r\n        result += \"<hr class=\\\"tokens-inspect-separator\\\"/>\";\r\n        if (token1Index < data.tokens1.length) {\r\n            result += \"<span class=\\\"tm-token-type\\\">\" + escape(data.tokens1[token1Index].type) + \"</span>\";\r\n        }\r\n        this._domNode.innerHTML = result;\r\n        this._editor.layoutContentWidget(this);\r\n    };\r\n    InspectTokensWidget.prototype._decodeMetadata = function (metadata) {\r\n        var colorMap = TokenizationRegistry.getColorMap();\r\n        var languageId = TokenMetadata.getLanguageId(metadata);\r\n        var tokenType = TokenMetadata.getTokenType(metadata);\r\n        var fontStyle = TokenMetadata.getFontStyle(metadata);\r\n        var foreground = TokenMetadata.getForeground(metadata);\r\n        var background = TokenMetadata.getBackground(metadata);\r\n        return {\r\n            languageIdentifier: this._modeService.getLanguageIdentifier(languageId),\r\n            tokenType: tokenType,\r\n            fontStyle: fontStyle,\r\n            foreground: colorMap[foreground],\r\n            background: colorMap[background]\r\n        };\r\n    };\r\n    InspectTokensWidget.prototype._tokenTypeToString = function (tokenType) {\r\n        switch (tokenType) {\r\n            case 0 /* Other */: return 'Other';\r\n            case 1 /* Comment */: return 'Comment';\r\n            case 2 /* String */: return 'String';\r\n            case 4 /* RegEx */: return 'RegEx';\r\n        }\r\n        return '??';\r\n    };\r\n    InspectTokensWidget.prototype._fontStyleToString = function (fontStyle) {\r\n        var r = '';\r\n        if (fontStyle & 1 /* Italic */) {\r\n            r += 'italic ';\r\n        }\r\n        if (fontStyle & 2 /* Bold */) {\r\n            r += 'bold ';\r\n        }\r\n        if (fontStyle & 4 /* Underline */) {\r\n            r += 'underline ';\r\n        }\r\n        if (r.length === 0) {\r\n            r = '---';\r\n        }\r\n        return r;\r\n    };\r\n    InspectTokensWidget.prototype._getTokensAtLine = function (lineNumber) {\r\n        var stateBeforeLine = this._getStateBeforeLine(lineNumber);\r\n        var tokenizationResult1 = this._tokenizationSupport.tokenize(this._model.getLineContent(lineNumber), stateBeforeLine, 0);\r\n        var tokenizationResult2 = this._tokenizationSupport.tokenize2(this._model.getLineContent(lineNumber), stateBeforeLine, 0);\r\n        return {\r\n            startState: stateBeforeLine,\r\n            tokens1: tokenizationResult1.tokens,\r\n            tokens2: tokenizationResult2.tokens,\r\n            endState: tokenizationResult1.endState\r\n        };\r\n    };\r\n    InspectTokensWidget.prototype._getStateBeforeLine = function (lineNumber) {\r\n        var state = this._tokenizationSupport.getInitialState();\r\n        for (var i = 1; i < lineNumber; i++) {\r\n            var tokenizationResult = this._tokenizationSupport.tokenize(this._model.getLineContent(i), state, 0);\r\n            state = tokenizationResult.endState;\r\n        }\r\n        return state;\r\n    };\r\n    InspectTokensWidget.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    InspectTokensWidget.prototype.getPosition = function () {\r\n        return {\r\n            position: this._editor.getPosition(),\r\n            preference: [2 /* BELOW */, 1 /* ABOVE */]\r\n        };\r\n    };\r\n    InspectTokensWidget._ID = 'editor.contrib.inspectTokensWidget';\r\n    return InspectTokensWidget;\r\n}(Disposable));\r\nregisterEditorContribution(InspectTokensController.ID, InspectTokensController);\r\nregisterEditorAction(InspectTokens);\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var border = theme.getColor(editorHoverBorder);\r\n    if (border) {\r\n        var borderWidth = theme.type === HIGH_CONTRAST ? 2 : 1;\r\n        collector.addRule(\".monaco-editor .tokens-inspect-widget { border: \" + borderWidth + \"px solid \" + border + \"; }\");\r\n        collector.addRule(\".monaco-editor .tokens-inspect-widget .tokens-inspect-separator { background-color: \" + border + \"; }\");\r\n    }\r\n    var background = theme.getColor(editorHoverBackground);\r\n    if (background) {\r\n        collector.addRule(\".monaco-editor .tokens-inspect-widget { background-color: \" + background + \"; }\");\r\n    }\r\n    var foreground = theme.getColor(editorHoverForeground);\r\n    if (foreground) {\r\n        collector.addRule(\".monaco-editor .tokens-inspect-widget { color: \" + foreground + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}