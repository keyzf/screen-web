{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport { mergeSort } from '../../../base/common/arrays.js';\nimport { stringDiff } from '../../../base/common/diff/diff.js';\nimport { FIN } from '../../../base/common/iterator.js';\nimport { globals } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { Position } from '../core/position.js';\nimport { Range } from '../core/range.js';\nimport { DiffComputer } from '../diff/diffComputer.js';\nimport { MirrorTextModel as BaseMirrorModel } from '../model/mirrorTextModel.js';\nimport { ensureValidWordDefinition, getWordAtText } from '../model/wordHelper.js';\nimport { computeLinks } from '../modes/linkComputer.js';\nimport { BasicInplaceReplace } from '../modes/supports/inplaceReplaceSupport.js';\nimport { createMonacoBaseAPI } from '../standalone/standaloneBase.js';\nimport * as types from '../../../base/common/types.js';\n/**\r\n * @internal\r\n */\n\nvar MirrorModel =\n/** @class */\nfunction (_super) {\n  __extends(MirrorModel, _super);\n\n  function MirrorModel() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Object.defineProperty(MirrorModel.prototype, \"uri\", {\n    get: function () {\n      return this._uri;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MirrorModel.prototype, \"version\", {\n    get: function () {\n      return this._versionId;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MirrorModel.prototype, \"eol\", {\n    get: function () {\n      return this._eol;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  MirrorModel.prototype.getValue = function () {\n    return this.getText();\n  };\n\n  MirrorModel.prototype.getLinesContent = function () {\n    return this._lines.slice(0);\n  };\n\n  MirrorModel.prototype.getLineCount = function () {\n    return this._lines.length;\n  };\n\n  MirrorModel.prototype.getLineContent = function (lineNumber) {\n    return this._lines[lineNumber - 1];\n  };\n\n  MirrorModel.prototype.getWordAtPosition = function (position, wordDefinition) {\n    var wordAtText = getWordAtText(position.column, ensureValidWordDefinition(wordDefinition), this._lines[position.lineNumber - 1], 0);\n\n    if (wordAtText) {\n      return new Range(position.lineNumber, wordAtText.startColumn, position.lineNumber, wordAtText.endColumn);\n    }\n\n    return null;\n  };\n\n  MirrorModel.prototype.createWordIterator = function (wordDefinition) {\n    var _this = this;\n\n    var obj;\n    var lineNumber = 0;\n    var lineText;\n    var wordRangesIdx = 0;\n    var wordRanges = [];\n\n    var next = function () {\n      if (wordRangesIdx < wordRanges.length) {\n        var value = lineText.substring(wordRanges[wordRangesIdx].start, wordRanges[wordRangesIdx].end);\n        wordRangesIdx += 1;\n\n        if (!obj) {\n          obj = {\n            done: false,\n            value: value\n          };\n        } else {\n          obj.value = value;\n        }\n\n        return obj;\n      } else if (lineNumber >= _this._lines.length) {\n        return FIN;\n      } else {\n        lineText = _this._lines[lineNumber];\n        wordRanges = _this._wordenize(lineText, wordDefinition);\n        wordRangesIdx = 0;\n        lineNumber += 1;\n        return next();\n      }\n    };\n\n    return {\n      next: next\n    };\n  };\n\n  MirrorModel.prototype.getLineWords = function (lineNumber, wordDefinition) {\n    var content = this._lines[lineNumber - 1];\n\n    var ranges = this._wordenize(content, wordDefinition);\n\n    var words = [];\n\n    for (var _i = 0, ranges_1 = ranges; _i < ranges_1.length; _i++) {\n      var range = ranges_1[_i];\n      words.push({\n        word: content.substring(range.start, range.end),\n        startColumn: range.start + 1,\n        endColumn: range.end + 1\n      });\n    }\n\n    return words;\n  };\n\n  MirrorModel.prototype._wordenize = function (content, wordDefinition) {\n    var result = [];\n    var match;\n    wordDefinition.lastIndex = 0; // reset lastIndex just to be sure\n\n    while (match = wordDefinition.exec(content)) {\n      if (match[0].length === 0) {\n        // it did match the empty string\n        break;\n      }\n\n      result.push({\n        start: match.index,\n        end: match.index + match[0].length\n      });\n    }\n\n    return result;\n  };\n\n  MirrorModel.prototype.getValueInRange = function (range) {\n    range = this._validateRange(range);\n\n    if (range.startLineNumber === range.endLineNumber) {\n      return this._lines[range.startLineNumber - 1].substring(range.startColumn - 1, range.endColumn - 1);\n    }\n\n    var lineEnding = this._eol;\n    var startLineIndex = range.startLineNumber - 1;\n    var endLineIndex = range.endLineNumber - 1;\n    var resultLines = [];\n    resultLines.push(this._lines[startLineIndex].substring(range.startColumn - 1));\n\n    for (var i = startLineIndex + 1; i < endLineIndex; i++) {\n      resultLines.push(this._lines[i]);\n    }\n\n    resultLines.push(this._lines[endLineIndex].substring(0, range.endColumn - 1));\n    return resultLines.join(lineEnding);\n  };\n\n  MirrorModel.prototype.offsetAt = function (position) {\n    position = this._validatePosition(position);\n\n    this._ensureLineStarts();\n\n    return this._lineStarts.getAccumulatedValue(position.lineNumber - 2) + (position.column - 1);\n  };\n\n  MirrorModel.prototype.positionAt = function (offset) {\n    offset = Math.floor(offset);\n    offset = Math.max(0, offset);\n\n    this._ensureLineStarts();\n\n    var out = this._lineStarts.getIndexOf(offset);\n\n    var lineLength = this._lines[out.index].length; // Ensure we return a valid position\n\n    return {\n      lineNumber: 1 + out.index,\n      column: 1 + Math.min(out.remainder, lineLength)\n    };\n  };\n\n  MirrorModel.prototype._validateRange = function (range) {\n    var start = this._validatePosition({\n      lineNumber: range.startLineNumber,\n      column: range.startColumn\n    });\n\n    var end = this._validatePosition({\n      lineNumber: range.endLineNumber,\n      column: range.endColumn\n    });\n\n    if (start.lineNumber !== range.startLineNumber || start.column !== range.startColumn || end.lineNumber !== range.endLineNumber || end.column !== range.endColumn) {\n      return {\n        startLineNumber: start.lineNumber,\n        startColumn: start.column,\n        endLineNumber: end.lineNumber,\n        endColumn: end.column\n      };\n    }\n\n    return range;\n  };\n\n  MirrorModel.prototype._validatePosition = function (position) {\n    if (!Position.isIPosition(position)) {\n      throw new Error('bad position');\n    }\n\n    var lineNumber = position.lineNumber,\n        column = position.column;\n    var hasChanged = false;\n\n    if (lineNumber < 1) {\n      lineNumber = 1;\n      column = 1;\n      hasChanged = true;\n    } else if (lineNumber > this._lines.length) {\n      lineNumber = this._lines.length;\n      column = this._lines[lineNumber - 1].length + 1;\n      hasChanged = true;\n    } else {\n      var maxCharacter = this._lines[lineNumber - 1].length + 1;\n\n      if (column < 1) {\n        column = 1;\n        hasChanged = true;\n      } else if (column > maxCharacter) {\n        column = maxCharacter;\n        hasChanged = true;\n      }\n    }\n\n    if (!hasChanged) {\n      return position;\n    } else {\n      return {\n        lineNumber: lineNumber,\n        column: column\n      };\n    }\n  };\n\n  return MirrorModel;\n}(BaseMirrorModel);\n/**\r\n * @internal\r\n */\n\n\nvar EditorSimpleWorker =\n/** @class */\nfunction () {\n  function EditorSimpleWorker(host, foreignModuleFactory) {\n    this._host = host;\n    this._models = Object.create(null);\n    this._foreignModuleFactory = foreignModuleFactory;\n    this._foreignModule = null;\n  }\n\n  EditorSimpleWorker.prototype.dispose = function () {\n    this._models = Object.create(null);\n  };\n\n  EditorSimpleWorker.prototype._getModel = function (uri) {\n    return this._models[uri];\n  };\n\n  EditorSimpleWorker.prototype._getModels = function () {\n    var _this = this;\n\n    var all = [];\n    Object.keys(this._models).forEach(function (key) {\n      return all.push(_this._models[key]);\n    });\n    return all;\n  };\n\n  EditorSimpleWorker.prototype.acceptNewModel = function (data) {\n    this._models[data.url] = new MirrorModel(URI.parse(data.url), data.lines, data.EOL, data.versionId);\n  };\n\n  EditorSimpleWorker.prototype.acceptModelChanged = function (strURL, e) {\n    if (!this._models[strURL]) {\n      return;\n    }\n\n    var model = this._models[strURL];\n    model.onEvents(e);\n  };\n\n  EditorSimpleWorker.prototype.acceptRemovedModel = function (strURL) {\n    if (!this._models[strURL]) {\n      return;\n    }\n\n    delete this._models[strURL];\n  }; // ---- BEGIN diff --------------------------------------------------------------------------\n\n\n  EditorSimpleWorker.prototype.computeDiff = function (originalUrl, modifiedUrl, ignoreTrimWhitespace, maxComputationTime) {\n    return __awaiter(this, void 0, void 0, function () {\n      var original, modified, originalLines, modifiedLines, diffComputer, diffResult, identical;\n      return __generator(this, function (_a) {\n        original = this._getModel(originalUrl);\n        modified = this._getModel(modifiedUrl);\n\n        if (!original || !modified) {\n          return [2\n          /*return*/\n          , null];\n        }\n\n        originalLines = original.getLinesContent();\n        modifiedLines = modified.getLinesContent();\n        diffComputer = new DiffComputer(originalLines, modifiedLines, {\n          shouldComputeCharChanges: true,\n          shouldPostProcessCharChanges: true,\n          shouldIgnoreTrimWhitespace: ignoreTrimWhitespace,\n          shouldMakePrettyDiff: true,\n          maxComputationTime: maxComputationTime\n        });\n        diffResult = diffComputer.computeDiff();\n        identical = diffResult.changes.length > 0 ? false : this._modelsAreIdentical(original, modified);\n        return [2\n        /*return*/\n        , {\n          quitEarly: diffResult.quitEarly,\n          identical: identical,\n          changes: diffResult.changes\n        }];\n      });\n    });\n  };\n\n  EditorSimpleWorker.prototype._modelsAreIdentical = function (original, modified) {\n    var originalLineCount = original.getLineCount();\n    var modifiedLineCount = modified.getLineCount();\n\n    if (originalLineCount !== modifiedLineCount) {\n      return false;\n    }\n\n    for (var line = 1; line <= originalLineCount; line++) {\n      var originalLine = original.getLineContent(line);\n      var modifiedLine = modified.getLineContent(line);\n\n      if (originalLine !== modifiedLine) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  EditorSimpleWorker.prototype.computeMoreMinimalEdits = function (modelUrl, edits) {\n    return __awaiter(this, void 0, void 0, function () {\n      var model, result, lastEol, _i, edits_1, _a, range, text, eol, original, changes, editOffset, _b, changes_1, change, start, end, newEdit;\n\n      return __generator(this, function (_c) {\n        model = this._getModel(modelUrl);\n\n        if (!model) {\n          return [2\n          /*return*/\n          , edits];\n        }\n\n        result = [];\n        lastEol = undefined;\n        edits = mergeSort(edits, function (a, b) {\n          if (a.range && b.range) {\n            return Range.compareRangesUsingStarts(a.range, b.range);\n          } // eol only changes should go to the end\n\n\n          var aRng = a.range ? 0 : 1;\n          var bRng = b.range ? 0 : 1;\n          return aRng - bRng;\n        });\n\n        for (_i = 0, edits_1 = edits; _i < edits_1.length; _i++) {\n          _a = edits_1[_i], range = _a.range, text = _a.text, eol = _a.eol;\n\n          if (typeof eol === 'number') {\n            lastEol = eol;\n          }\n\n          if (Range.isEmpty(range) && !text) {\n            // empty change\n            continue;\n          }\n\n          original = model.getValueInRange(range);\n          text = text.replace(/\\r\\n|\\n|\\r/g, model.eol);\n\n          if (original === text) {\n            // noop\n            continue;\n          } // make sure diff won't take too long\n\n\n          if (Math.max(text.length, original.length) > EditorSimpleWorker._diffLimit) {\n            result.push({\n              range: range,\n              text: text\n            });\n            continue;\n          }\n\n          changes = stringDiff(original, text, false);\n          editOffset = model.offsetAt(Range.lift(range).getStartPosition());\n\n          for (_b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            change = changes_1[_b];\n            start = model.positionAt(editOffset + change.originalStart);\n            end = model.positionAt(editOffset + change.originalStart + change.originalLength);\n            newEdit = {\n              text: text.substr(change.modifiedStart, change.modifiedLength),\n              range: {\n                startLineNumber: start.lineNumber,\n                startColumn: start.column,\n                endLineNumber: end.lineNumber,\n                endColumn: end.column\n              }\n            };\n\n            if (model.getValueInRange(newEdit.range) !== newEdit.text) {\n              result.push(newEdit);\n            }\n          }\n        }\n\n        if (typeof lastEol === 'number') {\n          result.push({\n            eol: lastEol,\n            text: '',\n            range: {\n              startLineNumber: 0,\n              startColumn: 0,\n              endLineNumber: 0,\n              endColumn: 0\n            }\n          });\n        }\n\n        return [2\n        /*return*/\n        , result];\n      });\n    });\n  }; // ---- END minimal edits ---------------------------------------------------------------\n\n\n  EditorSimpleWorker.prototype.computeLinks = function (modelUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var model;\n      return __generator(this, function (_a) {\n        model = this._getModel(modelUrl);\n\n        if (!model) {\n          return [2\n          /*return*/\n          , null];\n        }\n\n        return [2\n        /*return*/\n        , computeLinks(model)];\n      });\n    });\n  };\n\n  EditorSimpleWorker.prototype.textualSuggest = function (modelUrl, position, wordDef, wordDefFlags) {\n    return __awaiter(this, void 0, void 0, function () {\n      var model, words, seen, wordDefRegExp, wordAt, iter, e, word;\n      return __generator(this, function (_a) {\n        model = this._getModel(modelUrl);\n\n        if (!model) {\n          return [2\n          /*return*/\n          , null];\n        }\n\n        words = [];\n        seen = new Set();\n        wordDefRegExp = new RegExp(wordDef, wordDefFlags);\n        wordAt = model.getWordAtPosition(position, wordDefRegExp);\n\n        if (wordAt) {\n          seen.add(model.getValueInRange(wordAt));\n        }\n\n        for (iter = model.createWordIterator(wordDefRegExp), e = iter.next(); !e.done && seen.size <= EditorSimpleWorker._suggestionsLimit; e = iter.next()) {\n          word = e.value;\n\n          if (seen.has(word)) {\n            continue;\n          }\n\n          seen.add(word);\n\n          if (!isNaN(Number(word))) {\n            continue;\n          }\n\n          words.push(word);\n        }\n\n        return [2\n        /*return*/\n        , words];\n      });\n    });\n  }; // ---- END suggest --------------------------------------------------------------------------\n  //#region -- word ranges --\n\n\n  EditorSimpleWorker.prototype.computeWordRanges = function (modelUrl, range, wordDef, wordDefFlags) {\n    return __awaiter(this, void 0, void 0, function () {\n      var model, wordDefRegExp, result, line, words, _i, words_1, word, array;\n\n      return __generator(this, function (_a) {\n        model = this._getModel(modelUrl);\n\n        if (!model) {\n          return [2\n          /*return*/\n          , Object.create(null)];\n        }\n\n        wordDefRegExp = new RegExp(wordDef, wordDefFlags);\n        result = Object.create(null);\n\n        for (line = range.startLineNumber; line < range.endLineNumber; line++) {\n          words = model.getLineWords(line, wordDefRegExp);\n\n          for (_i = 0, words_1 = words; _i < words_1.length; _i++) {\n            word = words_1[_i];\n\n            if (!isNaN(Number(word.word))) {\n              continue;\n            }\n\n            array = result[word.word];\n\n            if (!array) {\n              array = [];\n              result[word.word] = array;\n            }\n\n            array.push({\n              startLineNumber: line,\n              startColumn: word.startColumn,\n              endLineNumber: line,\n              endColumn: word.endColumn\n            });\n          }\n        }\n\n        return [2\n        /*return*/\n        , result];\n      });\n    });\n  }; //#endregion\n\n\n  EditorSimpleWorker.prototype.navigateValueSet = function (modelUrl, range, up, wordDef, wordDefFlags) {\n    return __awaiter(this, void 0, void 0, function () {\n      var model, wordDefRegExp, selectionText, wordRange, word, result;\n      return __generator(this, function (_a) {\n        model = this._getModel(modelUrl);\n\n        if (!model) {\n          return [2\n          /*return*/\n          , null];\n        }\n\n        wordDefRegExp = new RegExp(wordDef, wordDefFlags);\n\n        if (range.startColumn === range.endColumn) {\n          range = {\n            startLineNumber: range.startLineNumber,\n            startColumn: range.startColumn,\n            endLineNumber: range.endLineNumber,\n            endColumn: range.endColumn + 1\n          };\n        }\n\n        selectionText = model.getValueInRange(range);\n        wordRange = model.getWordAtPosition({\n          lineNumber: range.startLineNumber,\n          column: range.startColumn\n        }, wordDefRegExp);\n\n        if (!wordRange) {\n          return [2\n          /*return*/\n          , null];\n        }\n\n        word = model.getValueInRange(wordRange);\n        result = BasicInplaceReplace.INSTANCE.navigateValueSet(range, selectionText, wordRange, word, up);\n        return [2\n        /*return*/\n        , result];\n      });\n    });\n  }; // ---- BEGIN foreign module support --------------------------------------------------------------------------\n\n\n  EditorSimpleWorker.prototype.loadForeignModule = function (moduleId, createData, foreignHostMethods) {\n    var _this = this;\n\n    var proxyMethodRequest = function (method, args) {\n      return _this._host.fhr(method, args);\n    };\n\n    var foreignHost = types.createProxyObject(foreignHostMethods, proxyMethodRequest);\n    var ctx = {\n      host: foreignHost,\n      getMirrorModels: function () {\n        return _this._getModels();\n      }\n    };\n\n    if (this._foreignModuleFactory) {\n      this._foreignModule = this._foreignModuleFactory(ctx, createData); // static foreing module\n\n      return Promise.resolve(types.getAllMethodNames(this._foreignModule));\n    } // ESM-comment-begin\n    // \t\treturn new Promise<any>((resolve, reject) => {\n    // \t\t\trequire([moduleId], (foreignModule: { create: IForeignModuleFactory }) => {\n    // \t\t\t\tthis._foreignModule = foreignModule.create(ctx, createData);\n    // \n    // \t\t\t\tresolve(types.getAllMethodNames(this._foreignModule));\n    // \n    // \t\t\t}, reject);\n    // \t\t});\n    // ESM-comment-end\n    // ESM-uncomment-begin\n\n\n    return Promise.reject(new Error(\"Unexpected usage\")); // ESM-uncomment-end\n  }; // foreign method request\n\n\n  EditorSimpleWorker.prototype.fmr = function (method, args) {\n    if (!this._foreignModule || typeof this._foreignModule[method] !== 'function') {\n      return Promise.reject(new Error('Missing requestHandler or method: ' + method));\n    }\n\n    try {\n      return Promise.resolve(this._foreignModule[method].apply(this._foreignModule, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  }; // ---- END diff --------------------------------------------------------------------------\n  // ---- BEGIN minimal edits ---------------------------------------------------------------\n\n\n  EditorSimpleWorker._diffLimit = 100000; // ---- BEGIN suggest --------------------------------------------------------------------------\n\n  EditorSimpleWorker._suggestionsLimit = 10000;\n  return EditorSimpleWorker;\n}();\n\nexport { EditorSimpleWorker };\n/**\r\n * Called on the worker side\r\n * @internal\r\n */\n\nexport function create(host) {\n  return new EditorSimpleWorker(host, null);\n}\n\nif (typeof importScripts === 'function') {\n  // Running in a web worker\n  globals.monaco = createMonacoBaseAPI();\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","mergeSort","stringDiff","FIN","globals","URI","Position","Range","DiffComputer","MirrorTextModel","BaseMirrorModel","ensureValidWordDefinition","getWordAtText","computeLinks","BasicInplaceReplace","createMonacoBaseAPI","types","MirrorModel","_super","arguments","defineProperty","get","_uri","enumerable","configurable","_versionId","_eol","getValue","getText","getLinesContent","_lines","slice","getLineCount","getLineContent","lineNumber","getWordAtPosition","position","wordDefinition","wordAtText","column","startColumn","endColumn","createWordIterator","_this","obj","lineText","wordRangesIdx","wordRanges","substring","start","end","_wordenize","getLineWords","content","ranges","words","_i","ranges_1","range","word","match","lastIndex","exec","index","getValueInRange","_validateRange","startLineNumber","endLineNumber","lineEnding","startLineIndex","endLineIndex","resultLines","i","join","offsetAt","_validatePosition","_ensureLineStarts","_lineStarts","getAccumulatedValue","positionAt","offset","Math","floor","max","out","getIndexOf","lineLength","min","remainder","isIPosition","Error","hasChanged","maxCharacter","EditorSimpleWorker","host","foreignModuleFactory","_host","_models","_foreignModuleFactory","_foreignModule","dispose","_getModel","uri","_getModels","all","keys","forEach","key","acceptNewModel","data","url","parse","lines","EOL","versionId","acceptModelChanged","strURL","model","onEvents","acceptRemovedModel","computeDiff","originalUrl","modifiedUrl","ignoreTrimWhitespace","maxComputationTime","original","modified","originalLines","modifiedLines","diffComputer","diffResult","identical","_a","shouldComputeCharChanges","shouldPostProcessCharChanges","shouldIgnoreTrimWhitespace","shouldMakePrettyDiff","changes","_modelsAreIdentical","quitEarly","originalLineCount","modifiedLineCount","line","originalLine","modifiedLine","computeMoreMinimalEdits","modelUrl","edits","lastEol","edits_1","text","eol","editOffset","_b","changes_1","change","newEdit","_c","undefined","a","compareRangesUsingStarts","aRng","bRng","isEmpty","replace","_diffLimit","lift","getStartPosition","originalStart","originalLength","substr","modifiedStart","modifiedLength","textualSuggest","wordDef","wordDefFlags","seen","wordDefRegExp","wordAt","iter","Set","RegExp","add","size","_suggestionsLimit","has","isNaN","Number","computeWordRanges","words_1","array","navigateValueSet","up","selectionText","wordRange","INSTANCE","loadForeignModule","moduleId","createData","foreignHostMethods","proxyMethodRequest","method","args","fhr","foreignHost","createProxyObject","ctx","getMirrorModels","getAllMethodNames","fmr","importScripts","monaco"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { mergeSort } from '../../../base/common/arrays.js';\r\nimport { stringDiff } from '../../../base/common/diff/diff.js';\r\nimport { FIN } from '../../../base/common/iterator.js';\r\nimport { globals } from '../../../base/common/platform.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { Position } from '../core/position.js';\r\nimport { Range } from '../core/range.js';\r\nimport { DiffComputer } from '../diff/diffComputer.js';\r\nimport { MirrorTextModel as BaseMirrorModel } from '../model/mirrorTextModel.js';\r\nimport { ensureValidWordDefinition, getWordAtText } from '../model/wordHelper.js';\r\nimport { computeLinks } from '../modes/linkComputer.js';\r\nimport { BasicInplaceReplace } from '../modes/supports/inplaceReplaceSupport.js';\r\nimport { createMonacoBaseAPI } from '../standalone/standaloneBase.js';\r\nimport * as types from '../../../base/common/types.js';\r\n/**\r\n * @internal\r\n */\r\nvar MirrorModel = /** @class */ (function (_super) {\r\n    __extends(MirrorModel, _super);\r\n    function MirrorModel() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Object.defineProperty(MirrorModel.prototype, \"uri\", {\r\n        get: function () {\r\n            return this._uri;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MirrorModel.prototype, \"version\", {\r\n        get: function () {\r\n            return this._versionId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MirrorModel.prototype, \"eol\", {\r\n        get: function () {\r\n            return this._eol;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    MirrorModel.prototype.getValue = function () {\r\n        return this.getText();\r\n    };\r\n    MirrorModel.prototype.getLinesContent = function () {\r\n        return this._lines.slice(0);\r\n    };\r\n    MirrorModel.prototype.getLineCount = function () {\r\n        return this._lines.length;\r\n    };\r\n    MirrorModel.prototype.getLineContent = function (lineNumber) {\r\n        return this._lines[lineNumber - 1];\r\n    };\r\n    MirrorModel.prototype.getWordAtPosition = function (position, wordDefinition) {\r\n        var wordAtText = getWordAtText(position.column, ensureValidWordDefinition(wordDefinition), this._lines[position.lineNumber - 1], 0);\r\n        if (wordAtText) {\r\n            return new Range(position.lineNumber, wordAtText.startColumn, position.lineNumber, wordAtText.endColumn);\r\n        }\r\n        return null;\r\n    };\r\n    MirrorModel.prototype.createWordIterator = function (wordDefinition) {\r\n        var _this = this;\r\n        var obj;\r\n        var lineNumber = 0;\r\n        var lineText;\r\n        var wordRangesIdx = 0;\r\n        var wordRanges = [];\r\n        var next = function () {\r\n            if (wordRangesIdx < wordRanges.length) {\r\n                var value = lineText.substring(wordRanges[wordRangesIdx].start, wordRanges[wordRangesIdx].end);\r\n                wordRangesIdx += 1;\r\n                if (!obj) {\r\n                    obj = { done: false, value: value };\r\n                }\r\n                else {\r\n                    obj.value = value;\r\n                }\r\n                return obj;\r\n            }\r\n            else if (lineNumber >= _this._lines.length) {\r\n                return FIN;\r\n            }\r\n            else {\r\n                lineText = _this._lines[lineNumber];\r\n                wordRanges = _this._wordenize(lineText, wordDefinition);\r\n                wordRangesIdx = 0;\r\n                lineNumber += 1;\r\n                return next();\r\n            }\r\n        };\r\n        return { next: next };\r\n    };\r\n    MirrorModel.prototype.getLineWords = function (lineNumber, wordDefinition) {\r\n        var content = this._lines[lineNumber - 1];\r\n        var ranges = this._wordenize(content, wordDefinition);\r\n        var words = [];\r\n        for (var _i = 0, ranges_1 = ranges; _i < ranges_1.length; _i++) {\r\n            var range = ranges_1[_i];\r\n            words.push({\r\n                word: content.substring(range.start, range.end),\r\n                startColumn: range.start + 1,\r\n                endColumn: range.end + 1\r\n            });\r\n        }\r\n        return words;\r\n    };\r\n    MirrorModel.prototype._wordenize = function (content, wordDefinition) {\r\n        var result = [];\r\n        var match;\r\n        wordDefinition.lastIndex = 0; // reset lastIndex just to be sure\r\n        while (match = wordDefinition.exec(content)) {\r\n            if (match[0].length === 0) {\r\n                // it did match the empty string\r\n                break;\r\n            }\r\n            result.push({ start: match.index, end: match.index + match[0].length });\r\n        }\r\n        return result;\r\n    };\r\n    MirrorModel.prototype.getValueInRange = function (range) {\r\n        range = this._validateRange(range);\r\n        if (range.startLineNumber === range.endLineNumber) {\r\n            return this._lines[range.startLineNumber - 1].substring(range.startColumn - 1, range.endColumn - 1);\r\n        }\r\n        var lineEnding = this._eol;\r\n        var startLineIndex = range.startLineNumber - 1;\r\n        var endLineIndex = range.endLineNumber - 1;\r\n        var resultLines = [];\r\n        resultLines.push(this._lines[startLineIndex].substring(range.startColumn - 1));\r\n        for (var i = startLineIndex + 1; i < endLineIndex; i++) {\r\n            resultLines.push(this._lines[i]);\r\n        }\r\n        resultLines.push(this._lines[endLineIndex].substring(0, range.endColumn - 1));\r\n        return resultLines.join(lineEnding);\r\n    };\r\n    MirrorModel.prototype.offsetAt = function (position) {\r\n        position = this._validatePosition(position);\r\n        this._ensureLineStarts();\r\n        return this._lineStarts.getAccumulatedValue(position.lineNumber - 2) + (position.column - 1);\r\n    };\r\n    MirrorModel.prototype.positionAt = function (offset) {\r\n        offset = Math.floor(offset);\r\n        offset = Math.max(0, offset);\r\n        this._ensureLineStarts();\r\n        var out = this._lineStarts.getIndexOf(offset);\r\n        var lineLength = this._lines[out.index].length;\r\n        // Ensure we return a valid position\r\n        return {\r\n            lineNumber: 1 + out.index,\r\n            column: 1 + Math.min(out.remainder, lineLength)\r\n        };\r\n    };\r\n    MirrorModel.prototype._validateRange = function (range) {\r\n        var start = this._validatePosition({ lineNumber: range.startLineNumber, column: range.startColumn });\r\n        var end = this._validatePosition({ lineNumber: range.endLineNumber, column: range.endColumn });\r\n        if (start.lineNumber !== range.startLineNumber\r\n            || start.column !== range.startColumn\r\n            || end.lineNumber !== range.endLineNumber\r\n            || end.column !== range.endColumn) {\r\n            return {\r\n                startLineNumber: start.lineNumber,\r\n                startColumn: start.column,\r\n                endLineNumber: end.lineNumber,\r\n                endColumn: end.column\r\n            };\r\n        }\r\n        return range;\r\n    };\r\n    MirrorModel.prototype._validatePosition = function (position) {\r\n        if (!Position.isIPosition(position)) {\r\n            throw new Error('bad position');\r\n        }\r\n        var lineNumber = position.lineNumber, column = position.column;\r\n        var hasChanged = false;\r\n        if (lineNumber < 1) {\r\n            lineNumber = 1;\r\n            column = 1;\r\n            hasChanged = true;\r\n        }\r\n        else if (lineNumber > this._lines.length) {\r\n            lineNumber = this._lines.length;\r\n            column = this._lines[lineNumber - 1].length + 1;\r\n            hasChanged = true;\r\n        }\r\n        else {\r\n            var maxCharacter = this._lines[lineNumber - 1].length + 1;\r\n            if (column < 1) {\r\n                column = 1;\r\n                hasChanged = true;\r\n            }\r\n            else if (column > maxCharacter) {\r\n                column = maxCharacter;\r\n                hasChanged = true;\r\n            }\r\n        }\r\n        if (!hasChanged) {\r\n            return position;\r\n        }\r\n        else {\r\n            return { lineNumber: lineNumber, column: column };\r\n        }\r\n    };\r\n    return MirrorModel;\r\n}(BaseMirrorModel));\r\n/**\r\n * @internal\r\n */\r\nvar EditorSimpleWorker = /** @class */ (function () {\r\n    function EditorSimpleWorker(host, foreignModuleFactory) {\r\n        this._host = host;\r\n        this._models = Object.create(null);\r\n        this._foreignModuleFactory = foreignModuleFactory;\r\n        this._foreignModule = null;\r\n    }\r\n    EditorSimpleWorker.prototype.dispose = function () {\r\n        this._models = Object.create(null);\r\n    };\r\n    EditorSimpleWorker.prototype._getModel = function (uri) {\r\n        return this._models[uri];\r\n    };\r\n    EditorSimpleWorker.prototype._getModels = function () {\r\n        var _this = this;\r\n        var all = [];\r\n        Object.keys(this._models).forEach(function (key) { return all.push(_this._models[key]); });\r\n        return all;\r\n    };\r\n    EditorSimpleWorker.prototype.acceptNewModel = function (data) {\r\n        this._models[data.url] = new MirrorModel(URI.parse(data.url), data.lines, data.EOL, data.versionId);\r\n    };\r\n    EditorSimpleWorker.prototype.acceptModelChanged = function (strURL, e) {\r\n        if (!this._models[strURL]) {\r\n            return;\r\n        }\r\n        var model = this._models[strURL];\r\n        model.onEvents(e);\r\n    };\r\n    EditorSimpleWorker.prototype.acceptRemovedModel = function (strURL) {\r\n        if (!this._models[strURL]) {\r\n            return;\r\n        }\r\n        delete this._models[strURL];\r\n    };\r\n    // ---- BEGIN diff --------------------------------------------------------------------------\r\n    EditorSimpleWorker.prototype.computeDiff = function (originalUrl, modifiedUrl, ignoreTrimWhitespace, maxComputationTime) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var original, modified, originalLines, modifiedLines, diffComputer, diffResult, identical;\r\n            return __generator(this, function (_a) {\r\n                original = this._getModel(originalUrl);\r\n                modified = this._getModel(modifiedUrl);\r\n                if (!original || !modified) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                originalLines = original.getLinesContent();\r\n                modifiedLines = modified.getLinesContent();\r\n                diffComputer = new DiffComputer(originalLines, modifiedLines, {\r\n                    shouldComputeCharChanges: true,\r\n                    shouldPostProcessCharChanges: true,\r\n                    shouldIgnoreTrimWhitespace: ignoreTrimWhitespace,\r\n                    shouldMakePrettyDiff: true,\r\n                    maxComputationTime: maxComputationTime\r\n                });\r\n                diffResult = diffComputer.computeDiff();\r\n                identical = (diffResult.changes.length > 0 ? false : this._modelsAreIdentical(original, modified));\r\n                return [2 /*return*/, {\r\n                        quitEarly: diffResult.quitEarly,\r\n                        identical: identical,\r\n                        changes: diffResult.changes\r\n                    }];\r\n            });\r\n        });\r\n    };\r\n    EditorSimpleWorker.prototype._modelsAreIdentical = function (original, modified) {\r\n        var originalLineCount = original.getLineCount();\r\n        var modifiedLineCount = modified.getLineCount();\r\n        if (originalLineCount !== modifiedLineCount) {\r\n            return false;\r\n        }\r\n        for (var line = 1; line <= originalLineCount; line++) {\r\n            var originalLine = original.getLineContent(line);\r\n            var modifiedLine = modified.getLineContent(line);\r\n            if (originalLine !== modifiedLine) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    EditorSimpleWorker.prototype.computeMoreMinimalEdits = function (modelUrl, edits) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, result, lastEol, _i, edits_1, _a, range, text, eol, original, changes, editOffset, _b, changes_1, change, start, end, newEdit;\r\n            return __generator(this, function (_c) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, edits];\r\n                }\r\n                result = [];\r\n                lastEol = undefined;\r\n                edits = mergeSort(edits, function (a, b) {\r\n                    if (a.range && b.range) {\r\n                        return Range.compareRangesUsingStarts(a.range, b.range);\r\n                    }\r\n                    // eol only changes should go to the end\r\n                    var aRng = a.range ? 0 : 1;\r\n                    var bRng = b.range ? 0 : 1;\r\n                    return aRng - bRng;\r\n                });\r\n                for (_i = 0, edits_1 = edits; _i < edits_1.length; _i++) {\r\n                    _a = edits_1[_i], range = _a.range, text = _a.text, eol = _a.eol;\r\n                    if (typeof eol === 'number') {\r\n                        lastEol = eol;\r\n                    }\r\n                    if (Range.isEmpty(range) && !text) {\r\n                        // empty change\r\n                        continue;\r\n                    }\r\n                    original = model.getValueInRange(range);\r\n                    text = text.replace(/\\r\\n|\\n|\\r/g, model.eol);\r\n                    if (original === text) {\r\n                        // noop\r\n                        continue;\r\n                    }\r\n                    // make sure diff won't take too long\r\n                    if (Math.max(text.length, original.length) > EditorSimpleWorker._diffLimit) {\r\n                        result.push({ range: range, text: text });\r\n                        continue;\r\n                    }\r\n                    changes = stringDiff(original, text, false);\r\n                    editOffset = model.offsetAt(Range.lift(range).getStartPosition());\r\n                    for (_b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\r\n                        change = changes_1[_b];\r\n                        start = model.positionAt(editOffset + change.originalStart);\r\n                        end = model.positionAt(editOffset + change.originalStart + change.originalLength);\r\n                        newEdit = {\r\n                            text: text.substr(change.modifiedStart, change.modifiedLength),\r\n                            range: { startLineNumber: start.lineNumber, startColumn: start.column, endLineNumber: end.lineNumber, endColumn: end.column }\r\n                        };\r\n                        if (model.getValueInRange(newEdit.range) !== newEdit.text) {\r\n                            result.push(newEdit);\r\n                        }\r\n                    }\r\n                }\r\n                if (typeof lastEol === 'number') {\r\n                    result.push({ eol: lastEol, text: '', range: { startLineNumber: 0, startColumn: 0, endLineNumber: 0, endColumn: 0 } });\r\n                }\r\n                return [2 /*return*/, result];\r\n            });\r\n        });\r\n    };\r\n    // ---- END minimal edits ---------------------------------------------------------------\r\n    EditorSimpleWorker.prototype.computeLinks = function (modelUrl) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                return [2 /*return*/, computeLinks(model)];\r\n            });\r\n        });\r\n    };\r\n    EditorSimpleWorker.prototype.textualSuggest = function (modelUrl, position, wordDef, wordDefFlags) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, words, seen, wordDefRegExp, wordAt, iter, e, word;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                words = [];\r\n                seen = new Set();\r\n                wordDefRegExp = new RegExp(wordDef, wordDefFlags);\r\n                wordAt = model.getWordAtPosition(position, wordDefRegExp);\r\n                if (wordAt) {\r\n                    seen.add(model.getValueInRange(wordAt));\r\n                }\r\n                for (iter = model.createWordIterator(wordDefRegExp), e = iter.next(); !e.done && seen.size <= EditorSimpleWorker._suggestionsLimit; e = iter.next()) {\r\n                    word = e.value;\r\n                    if (seen.has(word)) {\r\n                        continue;\r\n                    }\r\n                    seen.add(word);\r\n                    if (!isNaN(Number(word))) {\r\n                        continue;\r\n                    }\r\n                    words.push(word);\r\n                }\r\n                return [2 /*return*/, words];\r\n            });\r\n        });\r\n    };\r\n    // ---- END suggest --------------------------------------------------------------------------\r\n    //#region -- word ranges --\r\n    EditorSimpleWorker.prototype.computeWordRanges = function (modelUrl, range, wordDef, wordDefFlags) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, wordDefRegExp, result, line, words, _i, words_1, word, array;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, Object.create(null)];\r\n                }\r\n                wordDefRegExp = new RegExp(wordDef, wordDefFlags);\r\n                result = Object.create(null);\r\n                for (line = range.startLineNumber; line < range.endLineNumber; line++) {\r\n                    words = model.getLineWords(line, wordDefRegExp);\r\n                    for (_i = 0, words_1 = words; _i < words_1.length; _i++) {\r\n                        word = words_1[_i];\r\n                        if (!isNaN(Number(word.word))) {\r\n                            continue;\r\n                        }\r\n                        array = result[word.word];\r\n                        if (!array) {\r\n                            array = [];\r\n                            result[word.word] = array;\r\n                        }\r\n                        array.push({\r\n                            startLineNumber: line,\r\n                            startColumn: word.startColumn,\r\n                            endLineNumber: line,\r\n                            endColumn: word.endColumn\r\n                        });\r\n                    }\r\n                }\r\n                return [2 /*return*/, result];\r\n            });\r\n        });\r\n    };\r\n    //#endregion\r\n    EditorSimpleWorker.prototype.navigateValueSet = function (modelUrl, range, up, wordDef, wordDefFlags) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var model, wordDefRegExp, selectionText, wordRange, word, result;\r\n            return __generator(this, function (_a) {\r\n                model = this._getModel(modelUrl);\r\n                if (!model) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                wordDefRegExp = new RegExp(wordDef, wordDefFlags);\r\n                if (range.startColumn === range.endColumn) {\r\n                    range = {\r\n                        startLineNumber: range.startLineNumber,\r\n                        startColumn: range.startColumn,\r\n                        endLineNumber: range.endLineNumber,\r\n                        endColumn: range.endColumn + 1\r\n                    };\r\n                }\r\n                selectionText = model.getValueInRange(range);\r\n                wordRange = model.getWordAtPosition({ lineNumber: range.startLineNumber, column: range.startColumn }, wordDefRegExp);\r\n                if (!wordRange) {\r\n                    return [2 /*return*/, null];\r\n                }\r\n                word = model.getValueInRange(wordRange);\r\n                result = BasicInplaceReplace.INSTANCE.navigateValueSet(range, selectionText, wordRange, word, up);\r\n                return [2 /*return*/, result];\r\n            });\r\n        });\r\n    };\r\n    // ---- BEGIN foreign module support --------------------------------------------------------------------------\r\n    EditorSimpleWorker.prototype.loadForeignModule = function (moduleId, createData, foreignHostMethods) {\r\n        var _this = this;\r\n        var proxyMethodRequest = function (method, args) {\r\n            return _this._host.fhr(method, args);\r\n        };\r\n        var foreignHost = types.createProxyObject(foreignHostMethods, proxyMethodRequest);\r\n        var ctx = {\r\n            host: foreignHost,\r\n            getMirrorModels: function () {\r\n                return _this._getModels();\r\n            }\r\n        };\r\n        if (this._foreignModuleFactory) {\r\n            this._foreignModule = this._foreignModuleFactory(ctx, createData);\r\n            // static foreing module\r\n            return Promise.resolve(types.getAllMethodNames(this._foreignModule));\r\n        }\r\n        // ESM-comment-begin\r\n        // \t\treturn new Promise<any>((resolve, reject) => {\r\n        // \t\t\trequire([moduleId], (foreignModule: { create: IForeignModuleFactory }) => {\r\n        // \t\t\t\tthis._foreignModule = foreignModule.create(ctx, createData);\r\n        // \r\n        // \t\t\t\tresolve(types.getAllMethodNames(this._foreignModule));\r\n        // \r\n        // \t\t\t}, reject);\r\n        // \t\t});\r\n        // ESM-comment-end\r\n        // ESM-uncomment-begin\r\n        return Promise.reject(new Error(\"Unexpected usage\"));\r\n        // ESM-uncomment-end\r\n    };\r\n    // foreign method request\r\n    EditorSimpleWorker.prototype.fmr = function (method, args) {\r\n        if (!this._foreignModule || typeof this._foreignModule[method] !== 'function') {\r\n            return Promise.reject(new Error('Missing requestHandler or method: ' + method));\r\n        }\r\n        try {\r\n            return Promise.resolve(this._foreignModule[method].apply(this._foreignModule, args));\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    };\r\n    // ---- END diff --------------------------------------------------------------------------\r\n    // ---- BEGIN minimal edits ---------------------------------------------------------------\r\n    EditorSimpleWorker._diffLimit = 100000;\r\n    // ---- BEGIN suggest --------------------------------------------------------------------------\r\n    EditorSimpleWorker._suggestionsLimit = 10000;\r\n    return EditorSimpleWorker;\r\n}());\r\nexport { EditorSimpleWorker };\r\n/**\r\n * Called on the worker side\r\n * @internal\r\n */\r\nexport function create(host) {\r\n    return new EditorSimpleWorker(host, null);\r\n}\r\nif (typeof importScripts === 'function') {\r\n    // Running in a web worker\r\n    globals.monaco = createMonacoBaseAPI();\r\n}\r\n"]},"metadata":{},"sourceType":"module"}