{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as browser from '../../../base/browser/browser.js';\nimport * as dom from '../../../base/browser/dom.js';\nimport { StandardWheelEvent } from '../../../base/browser/mouseEvent.js';\nimport { RunOnceScheduler, TimeoutTimer } from '../../../base/common/async.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { HitTestContext, MouseTarget, MouseTargetFactory } from './mouseTarget.js';\nimport { ClientCoordinates, EditorMouseEventFactory, GlobalEditorMouseMoveMonitor, createEditorPagePosition } from '../editorDom.js';\nimport { EditorZoom } from '../../common/config/editorZoom.js';\nimport { Position } from '../../common/core/position.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { ViewEventHandler } from '../../common/viewModel/viewEventHandler.js';\n/**\r\n * Merges mouse events when mouse move events are throttled\r\n */\n\nexport function createMouseMoveEventMerger(mouseTargetFactory) {\n  return function (lastEvent, currentEvent) {\n    var targetIsWidget = false;\n\n    if (mouseTargetFactory) {\n      targetIsWidget = mouseTargetFactory.mouseTargetIsWidget(currentEvent);\n    }\n\n    if (!targetIsWidget) {\n      currentEvent.preventDefault();\n    }\n\n    return currentEvent;\n  };\n}\n\nvar MouseHandler =\n/** @class */\nfunction (_super) {\n  __extends(MouseHandler, _super);\n\n  function MouseHandler(context, viewController, viewHelper) {\n    var _this = _super.call(this) || this;\n\n    _this._isFocused = false;\n    _this._context = context;\n    _this.viewController = viewController;\n    _this.viewHelper = viewHelper;\n    _this.mouseTargetFactory = new MouseTargetFactory(_this._context, viewHelper);\n    _this._mouseDownOperation = _this._register(new MouseDownOperation(_this._context, _this.viewController, _this.viewHelper, function (e, testEventTarget) {\n      return _this._createMouseTarget(e, testEventTarget);\n    }, function (e) {\n      return _this._getMouseColumn(e);\n    }));\n    _this._asyncFocus = _this._register(new RunOnceScheduler(function () {\n      return _this.viewHelper.focusTextArea();\n    }, 0));\n    _this.lastMouseLeaveTime = -1;\n    var mouseEvents = new EditorMouseEventFactory(_this.viewHelper.viewDomNode);\n\n    _this._register(mouseEvents.onContextMenu(_this.viewHelper.viewDomNode, function (e) {\n      return _this._onContextMenu(e, true);\n    }));\n\n    _this._register(mouseEvents.onMouseMoveThrottled(_this.viewHelper.viewDomNode, function (e) {\n      return _this._onMouseMove(e);\n    }, createMouseMoveEventMerger(_this.mouseTargetFactory), MouseHandler.MOUSE_MOVE_MINIMUM_TIME));\n\n    _this._register(mouseEvents.onMouseUp(_this.viewHelper.viewDomNode, function (e) {\n      return _this._onMouseUp(e);\n    }));\n\n    _this._register(mouseEvents.onMouseLeave(_this.viewHelper.viewDomNode, function (e) {\n      return _this._onMouseLeave(e);\n    }));\n\n    _this._register(mouseEvents.onMouseDown(_this.viewHelper.viewDomNode, function (e) {\n      return _this._onMouseDown(e);\n    }));\n\n    var onMouseWheel = function (browserEvent) {\n      _this.viewController.emitMouseWheel(browserEvent);\n\n      if (!_this._context.configuration.options.get(57\n      /* mouseWheelZoom */\n      )) {\n        return;\n      }\n\n      var e = new StandardWheelEvent(browserEvent);\n\n      if (e.browserEvent.ctrlKey || e.browserEvent.metaKey) {\n        var zoomLevel = EditorZoom.getZoomLevel();\n        var delta = e.deltaY > 0 ? 1 : -1;\n        EditorZoom.setZoomLevel(zoomLevel + delta);\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    };\n\n    _this._register(dom.addDisposableListener(_this.viewHelper.viewDomNode, browser.isEdgeOrIE ? 'mousewheel' : 'wheel', onMouseWheel, {\n      capture: true,\n      passive: false\n    }));\n\n    _this._context.addEventHandler(_this);\n\n    return _this;\n  }\n\n  MouseHandler.prototype.dispose = function () {\n    this._context.removeEventHandler(this);\n\n    _super.prototype.dispose.call(this);\n  }; // --- begin event handlers\n\n\n  MouseHandler.prototype.onCursorStateChanged = function (e) {\n    this._mouseDownOperation.onCursorStateChanged(e);\n\n    return false;\n  };\n\n  MouseHandler.prototype.onFocusChanged = function (e) {\n    this._isFocused = e.isFocused;\n    return false;\n  };\n\n  MouseHandler.prototype.onScrollChanged = function (e) {\n    this._mouseDownOperation.onScrollChanged();\n\n    return false;\n  }; // --- end event handlers\n\n\n  MouseHandler.prototype.getTargetAtClientPoint = function (clientX, clientY) {\n    var clientPos = new ClientCoordinates(clientX, clientY);\n    var pos = clientPos.toPageCoordinates();\n    var editorPos = createEditorPagePosition(this.viewHelper.viewDomNode);\n\n    if (pos.y < editorPos.y || pos.y > editorPos.y + editorPos.height || pos.x < editorPos.x || pos.x > editorPos.x + editorPos.width) {\n      return null;\n    }\n\n    return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), editorPos, pos, null);\n  };\n\n  MouseHandler.prototype._createMouseTarget = function (e, testEventTarget) {\n    return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), e.editorPos, e.pos, testEventTarget ? e.target : null);\n  };\n\n  MouseHandler.prototype._getMouseColumn = function (e) {\n    return this.mouseTargetFactory.getMouseColumn(e.editorPos, e.pos);\n  };\n\n  MouseHandler.prototype._onContextMenu = function (e, testEventTarget) {\n    this.viewController.emitContextMenu({\n      event: e,\n      target: this._createMouseTarget(e, testEventTarget)\n    });\n  };\n\n  MouseHandler.prototype._onMouseMove = function (e) {\n    if (this._mouseDownOperation.isActive()) {\n      // In selection/drag operation\n      return;\n    }\n\n    var actualMouseMoveTime = e.timestamp;\n\n    if (actualMouseMoveTime < this.lastMouseLeaveTime) {\n      // Due to throttling, this event occurred before the mouse left the editor, therefore ignore it.\n      return;\n    }\n\n    this.viewController.emitMouseMove({\n      event: e,\n      target: this._createMouseTarget(e, true)\n    });\n  };\n\n  MouseHandler.prototype._onMouseLeave = function (e) {\n    this.lastMouseLeaveTime = new Date().getTime();\n    this.viewController.emitMouseLeave({\n      event: e,\n      target: null\n    });\n  };\n\n  MouseHandler.prototype._onMouseUp = function (e) {\n    this.viewController.emitMouseUp({\n      event: e,\n      target: this._createMouseTarget(e, true)\n    });\n  };\n\n  MouseHandler.prototype._onMouseDown = function (e) {\n    var _this = this;\n\n    var t = this._createMouseTarget(e, true);\n\n    var targetIsContent = t.type === 6\n    /* CONTENT_TEXT */\n    || t.type === 7\n    /* CONTENT_EMPTY */\n    ;\n    var targetIsGutter = t.type === 2\n    /* GUTTER_GLYPH_MARGIN */\n    || t.type === 3\n    /* GUTTER_LINE_NUMBERS */\n    || t.type === 4\n    /* GUTTER_LINE_DECORATIONS */\n    ;\n    var targetIsLineNumbers = t.type === 3\n    /* GUTTER_LINE_NUMBERS */\n    ;\n\n    var selectOnLineNumbers = this._context.configuration.options.get(83\n    /* selectOnLineNumbers */\n    );\n\n    var targetIsViewZone = t.type === 8\n    /* CONTENT_VIEW_ZONE */\n    || t.type === 5\n    /* GUTTER_VIEW_ZONE */\n    ;\n    var targetIsWidget = t.type === 9\n    /* CONTENT_WIDGET */\n    ;\n    var shouldHandle = e.leftButton || e.middleButton;\n\n    if (platform.isMacintosh && e.leftButton && e.ctrlKey) {\n      shouldHandle = false;\n    }\n\n    var focus = function () {\n      // In IE11, if the focus is in the browser's address bar and\n      // then you click in the editor, calling preventDefault()\n      // will not move focus properly (focus remains the address bar)\n      if (browser.isIE && !_this._isFocused) {\n        _this._asyncFocus.schedule();\n      } else {\n        e.preventDefault();\n\n        _this.viewHelper.focusTextArea();\n      }\n    };\n\n    if (shouldHandle && (targetIsContent || targetIsLineNumbers && selectOnLineNumbers)) {\n      focus();\n\n      this._mouseDownOperation.start(t.type, e);\n    } else if (targetIsGutter) {\n      // Do not steal focus\n      e.preventDefault();\n    } else if (targetIsViewZone) {\n      var viewZoneData = t.detail;\n\n      if (this.viewHelper.shouldSuppressMouseDownOnViewZone(viewZoneData.viewZoneId)) {\n        focus();\n\n        this._mouseDownOperation.start(t.type, e);\n\n        e.preventDefault();\n      }\n    } else if (targetIsWidget && this.viewHelper.shouldSuppressMouseDownOnWidget(t.detail)) {\n      focus();\n      e.preventDefault();\n    }\n\n    this.viewController.emitMouseDown({\n      event: e,\n      target: t\n    });\n  };\n\n  MouseHandler.MOUSE_MOVE_MINIMUM_TIME = 100; // ms\n\n  return MouseHandler;\n}(ViewEventHandler);\n\nexport { MouseHandler };\n\nvar MouseDownOperation =\n/** @class */\nfunction (_super) {\n  __extends(MouseDownOperation, _super);\n\n  function MouseDownOperation(context, viewController, viewHelper, createMouseTarget, getMouseColumn) {\n    var _this = _super.call(this) || this;\n\n    _this._context = context;\n    _this._viewController = viewController;\n    _this._viewHelper = viewHelper;\n    _this._createMouseTarget = createMouseTarget;\n    _this._getMouseColumn = getMouseColumn;\n    _this._mouseMoveMonitor = _this._register(new GlobalEditorMouseMoveMonitor(_this._viewHelper.viewDomNode));\n    _this._onScrollTimeout = _this._register(new TimeoutTimer());\n    _this._mouseState = new MouseDownState();\n    _this._currentSelection = new Selection(1, 1, 1, 1);\n    _this._isActive = false;\n    _this._lastMouseEvent = null;\n    return _this;\n  }\n\n  MouseDownOperation.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n  };\n\n  MouseDownOperation.prototype.isActive = function () {\n    return this._isActive;\n  };\n\n  MouseDownOperation.prototype._onMouseDownThenMove = function (e) {\n    this._lastMouseEvent = e;\n\n    this._mouseState.setModifiers(e);\n\n    var position = this._findMousePosition(e, true);\n\n    if (!position) {\n      // Ignoring because position is unknown\n      return;\n    }\n\n    if (this._mouseState.isDragAndDrop) {\n      this._viewController.emitMouseDrag({\n        event: e,\n        target: position\n      });\n    } else {\n      this._dispatchMouse(position, true);\n    }\n  };\n\n  MouseDownOperation.prototype.start = function (targetType, e) {\n    var _this = this;\n\n    this._lastMouseEvent = e;\n\n    this._mouseState.setStartedOnLineNumbers(targetType === 3\n    /* GUTTER_LINE_NUMBERS */\n    );\n\n    this._mouseState.setStartButtons(e);\n\n    this._mouseState.setModifiers(e);\n\n    var position = this._findMousePosition(e, true);\n\n    if (!position || !position.position) {\n      // Ignoring because position is unknown\n      return;\n    }\n\n    this._mouseState.trySetCount(e.detail, position.position); // Overwrite the detail of the MouseEvent, as it will be sent out in an event and contributions might rely on it.\n\n\n    e.detail = this._mouseState.count;\n    var options = this._context.configuration.options;\n\n    if (!options.get(68\n    /* readOnly */\n    ) && options.get(24\n    /* dragAndDrop */\n    ) && !this._mouseState.altKey // we don't support multiple mouse\n    && e.detail < 2 // only single click on a selection can work\n    && !this._isActive // the mouse is not down yet\n    && !this._currentSelection.isEmpty() // we don't drag single cursor\n    && position.type === 6\n    /* CONTENT_TEXT */\n    // single click on text\n    && position.position && this._currentSelection.containsPosition(position.position) // single click on a selection\n    ) {\n        this._mouseState.isDragAndDrop = true;\n        this._isActive = true;\n\n        this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, createMouseMoveEventMerger(null), function (e) {\n          return _this._onMouseDownThenMove(e);\n        }, function () {\n          var position = _this._findMousePosition(_this._lastMouseEvent, true);\n\n          _this._viewController.emitMouseDrop({\n            event: _this._lastMouseEvent,\n            target: position ? _this._createMouseTarget(_this._lastMouseEvent, true) : null // Ignoring because position is unknown, e.g., Content View Zone\n\n          });\n\n          _this._stop();\n        });\n\n        return;\n      }\n\n    this._mouseState.isDragAndDrop = false;\n\n    this._dispatchMouse(position, e.shiftKey);\n\n    if (!this._isActive) {\n      this._isActive = true;\n\n      this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, createMouseMoveEventMerger(null), function (e) {\n        return _this._onMouseDownThenMove(e);\n      }, function () {\n        return _this._stop();\n      });\n    }\n  };\n\n  MouseDownOperation.prototype._stop = function () {\n    this._isActive = false;\n\n    this._onScrollTimeout.cancel();\n  };\n\n  MouseDownOperation.prototype.onScrollChanged = function () {\n    var _this = this;\n\n    if (!this._isActive) {\n      return;\n    }\n\n    this._onScrollTimeout.setIfNotSet(function () {\n      if (!_this._lastMouseEvent) {\n        return;\n      }\n\n      var position = _this._findMousePosition(_this._lastMouseEvent, false);\n\n      if (!position) {\n        // Ignoring because position is unknown\n        return;\n      }\n\n      if (_this._mouseState.isDragAndDrop) {\n        // Ignoring because users are dragging the text\n        return;\n      }\n\n      _this._dispatchMouse(position, true);\n    }, 10);\n  };\n\n  MouseDownOperation.prototype.onCursorStateChanged = function (e) {\n    this._currentSelection = e.selections[0];\n  };\n\n  MouseDownOperation.prototype._getPositionOutsideEditor = function (e) {\n    var editorContent = e.editorPos;\n    var model = this._context.model;\n    var viewLayout = this._context.viewLayout;\n\n    var mouseColumn = this._getMouseColumn(e);\n\n    if (e.posy < editorContent.y) {\n      var verticalOffset = Math.max(viewLayout.getCurrentScrollTop() - (editorContent.y - e.posy), 0);\n      var viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\n\n      if (viewZoneData) {\n        var newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\n\n        if (newPosition) {\n          return new MouseTarget(null, 13\n          /* OUTSIDE_EDITOR */\n          , mouseColumn, newPosition);\n        }\n      }\n\n      var aboveLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\n      return new MouseTarget(null, 13\n      /* OUTSIDE_EDITOR */\n      , mouseColumn, new Position(aboveLineNumber, 1));\n    }\n\n    if (e.posy > editorContent.y + editorContent.height) {\n      var verticalOffset = viewLayout.getCurrentScrollTop() + (e.posy - editorContent.y);\n      var viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\n\n      if (viewZoneData) {\n        var newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\n\n        if (newPosition) {\n          return new MouseTarget(null, 13\n          /* OUTSIDE_EDITOR */\n          , mouseColumn, newPosition);\n        }\n      }\n\n      var belowLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\n      return new MouseTarget(null, 13\n      /* OUTSIDE_EDITOR */\n      , mouseColumn, new Position(belowLineNumber, model.getLineMaxColumn(belowLineNumber)));\n    }\n\n    var possibleLineNumber = viewLayout.getLineNumberAtVerticalOffset(viewLayout.getCurrentScrollTop() + (e.posy - editorContent.y));\n\n    if (e.posx < editorContent.x) {\n      return new MouseTarget(null, 13\n      /* OUTSIDE_EDITOR */\n      , mouseColumn, new Position(possibleLineNumber, 1));\n    }\n\n    if (e.posx > editorContent.x + editorContent.width) {\n      return new MouseTarget(null, 13\n      /* OUTSIDE_EDITOR */\n      , mouseColumn, new Position(possibleLineNumber, model.getLineMaxColumn(possibleLineNumber)));\n    }\n\n    return null;\n  };\n\n  MouseDownOperation.prototype._findMousePosition = function (e, testEventTarget) {\n    var positionOutsideEditor = this._getPositionOutsideEditor(e);\n\n    if (positionOutsideEditor) {\n      return positionOutsideEditor;\n    }\n\n    var t = this._createMouseTarget(e, testEventTarget);\n\n    var hintedPosition = t.position;\n\n    if (!hintedPosition) {\n      return null;\n    }\n\n    if (t.type === 8\n    /* CONTENT_VIEW_ZONE */\n    || t.type === 5\n    /* GUTTER_VIEW_ZONE */\n    ) {\n        var newPosition = this._helpPositionJumpOverViewZone(t.detail);\n\n        if (newPosition) {\n          return new MouseTarget(t.element, t.type, t.mouseColumn, newPosition, null, t.detail);\n        }\n      }\n\n    return t;\n  };\n\n  MouseDownOperation.prototype._helpPositionJumpOverViewZone = function (viewZoneData) {\n    // Force position on view zones to go above or below depending on where selection started from\n    var selectionStart = new Position(this._currentSelection.selectionStartLineNumber, this._currentSelection.selectionStartColumn);\n    var positionBefore = viewZoneData.positionBefore;\n    var positionAfter = viewZoneData.positionAfter;\n\n    if (positionBefore && positionAfter) {\n      if (positionBefore.isBefore(selectionStart)) {\n        return positionBefore;\n      } else {\n        return positionAfter;\n      }\n    }\n\n    return null;\n  };\n\n  MouseDownOperation.prototype._dispatchMouse = function (position, inSelectionMode) {\n    if (!position.position) {\n      return;\n    }\n\n    this._viewController.dispatchMouse({\n      position: position.position,\n      mouseColumn: position.mouseColumn,\n      startedOnLineNumbers: this._mouseState.startedOnLineNumbers,\n      inSelectionMode: inSelectionMode,\n      mouseDownCount: this._mouseState.count,\n      altKey: this._mouseState.altKey,\n      ctrlKey: this._mouseState.ctrlKey,\n      metaKey: this._mouseState.metaKey,\n      shiftKey: this._mouseState.shiftKey,\n      leftButton: this._mouseState.leftButton,\n      middleButton: this._mouseState.middleButton\n    });\n  };\n\n  return MouseDownOperation;\n}(Disposable);\n\nvar MouseDownState =\n/** @class */\nfunction () {\n  function MouseDownState() {\n    this._altKey = false;\n    this._ctrlKey = false;\n    this._metaKey = false;\n    this._shiftKey = false;\n    this._leftButton = false;\n    this._middleButton = false;\n    this._startedOnLineNumbers = false;\n    this._lastMouseDownPosition = null;\n    this._lastMouseDownPositionEqualCount = 0;\n    this._lastMouseDownCount = 0;\n    this._lastSetMouseDownCountTime = 0;\n    this.isDragAndDrop = false;\n  }\n\n  Object.defineProperty(MouseDownState.prototype, \"altKey\", {\n    get: function () {\n      return this._altKey;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"ctrlKey\", {\n    get: function () {\n      return this._ctrlKey;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"metaKey\", {\n    get: function () {\n      return this._metaKey;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"shiftKey\", {\n    get: function () {\n      return this._shiftKey;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"leftButton\", {\n    get: function () {\n      return this._leftButton;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"middleButton\", {\n    get: function () {\n      return this._middleButton;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"startedOnLineNumbers\", {\n    get: function () {\n      return this._startedOnLineNumbers;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(MouseDownState.prototype, \"count\", {\n    get: function () {\n      return this._lastMouseDownCount;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  MouseDownState.prototype.setModifiers = function (source) {\n    this._altKey = source.altKey;\n    this._ctrlKey = source.ctrlKey;\n    this._metaKey = source.metaKey;\n    this._shiftKey = source.shiftKey;\n  };\n\n  MouseDownState.prototype.setStartButtons = function (source) {\n    this._leftButton = source.leftButton;\n    this._middleButton = source.middleButton;\n  };\n\n  MouseDownState.prototype.setStartedOnLineNumbers = function (startedOnLineNumbers) {\n    this._startedOnLineNumbers = startedOnLineNumbers;\n  };\n\n  MouseDownState.prototype.trySetCount = function (setMouseDownCount, newMouseDownPosition) {\n    // a. Invalidate multiple clicking if too much time has passed (will be hit by IE because the detail field of mouse events contains garbage in IE10)\n    var currentTime = new Date().getTime();\n\n    if (currentTime - this._lastSetMouseDownCountTime > MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME) {\n      setMouseDownCount = 1;\n    }\n\n    this._lastSetMouseDownCountTime = currentTime; // b. Ensure that we don't jump from single click to triple click in one go (will be hit by IE because the detail field of mouse events contains garbage in IE10)\n\n    if (setMouseDownCount > this._lastMouseDownCount + 1) {\n      setMouseDownCount = this._lastMouseDownCount + 1;\n    } // c. Invalidate multiple clicking if the logical position is different\n\n\n    if (this._lastMouseDownPosition && this._lastMouseDownPosition.equals(newMouseDownPosition)) {\n      this._lastMouseDownPositionEqualCount++;\n    } else {\n      this._lastMouseDownPositionEqualCount = 1;\n    }\n\n    this._lastMouseDownPosition = newMouseDownPosition; // Finally set the lastMouseDownCount\n\n    this._lastMouseDownCount = Math.min(setMouseDownCount, this._lastMouseDownPositionEqualCount);\n  };\n\n  MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME = 400; // ms\n\n  return MouseDownState;\n}();","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/controller/mouseHandler.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","browser","dom","StandardWheelEvent","RunOnceScheduler","TimeoutTimer","Disposable","platform","HitTestContext","MouseTarget","MouseTargetFactory","ClientCoordinates","EditorMouseEventFactory","GlobalEditorMouseMoveMonitor","createEditorPagePosition","EditorZoom","Position","Selection","ViewEventHandler","createMouseMoveEventMerger","mouseTargetFactory","lastEvent","currentEvent","targetIsWidget","mouseTargetIsWidget","preventDefault","MouseHandler","_super","context","viewController","viewHelper","_this","call","_isFocused","_context","_mouseDownOperation","_register","MouseDownOperation","e","testEventTarget","_createMouseTarget","_getMouseColumn","_asyncFocus","focusTextArea","lastMouseLeaveTime","mouseEvents","viewDomNode","onContextMenu","_onContextMenu","onMouseMoveThrottled","_onMouseMove","MOUSE_MOVE_MINIMUM_TIME","onMouseUp","_onMouseUp","onMouseLeave","_onMouseLeave","onMouseDown","_onMouseDown","onMouseWheel","browserEvent","emitMouseWheel","configuration","options","get","ctrlKey","metaKey","zoomLevel","getZoomLevel","delta","deltaY","setZoomLevel","stopPropagation","addDisposableListener","isEdgeOrIE","capture","passive","addEventHandler","dispose","removeEventHandler","onCursorStateChanged","onFocusChanged","isFocused","onScrollChanged","getTargetAtClientPoint","clientX","clientY","clientPos","pos","toPageCoordinates","editorPos","y","height","x","width","createMouseTarget","getLastRenderData","target","getMouseColumn","emitContextMenu","event","isActive","actualMouseMoveTime","timestamp","emitMouseMove","Date","getTime","emitMouseLeave","emitMouseUp","t","targetIsContent","type","targetIsGutter","targetIsLineNumbers","selectOnLineNumbers","targetIsViewZone","shouldHandle","leftButton","middleButton","isMacintosh","focus","isIE","schedule","start","viewZoneData","detail","shouldSuppressMouseDownOnViewZone","viewZoneId","shouldSuppressMouseDownOnWidget","emitMouseDown","_viewController","_viewHelper","_mouseMoveMonitor","_onScrollTimeout","_mouseState","MouseDownState","_currentSelection","_isActive","_lastMouseEvent","_onMouseDownThenMove","setModifiers","position","_findMousePosition","isDragAndDrop","emitMouseDrag","_dispatchMouse","targetType","setStartedOnLineNumbers","setStartButtons","trySetCount","count","altKey","isEmpty","containsPosition","startMonitoring","buttons","emitMouseDrop","_stop","shiftKey","cancel","setIfNotSet","selections","_getPositionOutsideEditor","editorContent","model","viewLayout","mouseColumn","posy","verticalOffset","Math","max","getCurrentScrollTop","getZoneAtCoord","newPosition","_helpPositionJumpOverViewZone","aboveLineNumber","getLineNumberAtVerticalOffset","belowLineNumber","getLineMaxColumn","possibleLineNumber","posx","positionOutsideEditor","hintedPosition","element","selectionStart","selectionStartLineNumber","selectionStartColumn","positionBefore","positionAfter","isBefore","inSelectionMode","dispatchMouse","startedOnLineNumbers","mouseDownCount","_altKey","_ctrlKey","_metaKey","_shiftKey","_leftButton","_middleButton","_startedOnLineNumbers","_lastMouseDownPosition","_lastMouseDownPositionEqualCount","_lastMouseDownCount","_lastSetMouseDownCountTime","defineProperty","enumerable","configurable","source","setMouseDownCount","newMouseDownPosition","currentTime","CLEAR_MOUSE_DOWN_COUNT_TIME","equals","min"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { StandardWheelEvent } from '../../../base/browser/mouseEvent.js';\r\nimport { RunOnceScheduler, TimeoutTimer } from '../../../base/common/async.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { HitTestContext, MouseTarget, MouseTargetFactory } from './mouseTarget.js';\r\nimport { ClientCoordinates, EditorMouseEventFactory, GlobalEditorMouseMoveMonitor, createEditorPagePosition } from '../editorDom.js';\r\nimport { EditorZoom } from '../../common/config/editorZoom.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { ViewEventHandler } from '../../common/viewModel/viewEventHandler.js';\r\n/**\r\n * Merges mouse events when mouse move events are throttled\r\n */\r\nexport function createMouseMoveEventMerger(mouseTargetFactory) {\r\n    return function (lastEvent, currentEvent) {\r\n        var targetIsWidget = false;\r\n        if (mouseTargetFactory) {\r\n            targetIsWidget = mouseTargetFactory.mouseTargetIsWidget(currentEvent);\r\n        }\r\n        if (!targetIsWidget) {\r\n            currentEvent.preventDefault();\r\n        }\r\n        return currentEvent;\r\n    };\r\n}\r\nvar MouseHandler = /** @class */ (function (_super) {\r\n    __extends(MouseHandler, _super);\r\n    function MouseHandler(context, viewController, viewHelper) {\r\n        var _this = _super.call(this) || this;\r\n        _this._isFocused = false;\r\n        _this._context = context;\r\n        _this.viewController = viewController;\r\n        _this.viewHelper = viewHelper;\r\n        _this.mouseTargetFactory = new MouseTargetFactory(_this._context, viewHelper);\r\n        _this._mouseDownOperation = _this._register(new MouseDownOperation(_this._context, _this.viewController, _this.viewHelper, function (e, testEventTarget) { return _this._createMouseTarget(e, testEventTarget); }, function (e) { return _this._getMouseColumn(e); }));\r\n        _this._asyncFocus = _this._register(new RunOnceScheduler(function () { return _this.viewHelper.focusTextArea(); }, 0));\r\n        _this.lastMouseLeaveTime = -1;\r\n        var mouseEvents = new EditorMouseEventFactory(_this.viewHelper.viewDomNode);\r\n        _this._register(mouseEvents.onContextMenu(_this.viewHelper.viewDomNode, function (e) { return _this._onContextMenu(e, true); }));\r\n        _this._register(mouseEvents.onMouseMoveThrottled(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseMove(e); }, createMouseMoveEventMerger(_this.mouseTargetFactory), MouseHandler.MOUSE_MOVE_MINIMUM_TIME));\r\n        _this._register(mouseEvents.onMouseUp(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseUp(e); }));\r\n        _this._register(mouseEvents.onMouseLeave(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseLeave(e); }));\r\n        _this._register(mouseEvents.onMouseDown(_this.viewHelper.viewDomNode, function (e) { return _this._onMouseDown(e); }));\r\n        var onMouseWheel = function (browserEvent) {\r\n            _this.viewController.emitMouseWheel(browserEvent);\r\n            if (!_this._context.configuration.options.get(57 /* mouseWheelZoom */)) {\r\n                return;\r\n            }\r\n            var e = new StandardWheelEvent(browserEvent);\r\n            if (e.browserEvent.ctrlKey || e.browserEvent.metaKey) {\r\n                var zoomLevel = EditorZoom.getZoomLevel();\r\n                var delta = e.deltaY > 0 ? 1 : -1;\r\n                EditorZoom.setZoomLevel(zoomLevel + delta);\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n        };\r\n        _this._register(dom.addDisposableListener(_this.viewHelper.viewDomNode, browser.isEdgeOrIE ? 'mousewheel' : 'wheel', onMouseWheel, { capture: true, passive: false }));\r\n        _this._context.addEventHandler(_this);\r\n        return _this;\r\n    }\r\n    MouseHandler.prototype.dispose = function () {\r\n        this._context.removeEventHandler(this);\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    // --- begin event handlers\r\n    MouseHandler.prototype.onCursorStateChanged = function (e) {\r\n        this._mouseDownOperation.onCursorStateChanged(e);\r\n        return false;\r\n    };\r\n    MouseHandler.prototype.onFocusChanged = function (e) {\r\n        this._isFocused = e.isFocused;\r\n        return false;\r\n    };\r\n    MouseHandler.prototype.onScrollChanged = function (e) {\r\n        this._mouseDownOperation.onScrollChanged();\r\n        return false;\r\n    };\r\n    // --- end event handlers\r\n    MouseHandler.prototype.getTargetAtClientPoint = function (clientX, clientY) {\r\n        var clientPos = new ClientCoordinates(clientX, clientY);\r\n        var pos = clientPos.toPageCoordinates();\r\n        var editorPos = createEditorPagePosition(this.viewHelper.viewDomNode);\r\n        if (pos.y < editorPos.y || pos.y > editorPos.y + editorPos.height || pos.x < editorPos.x || pos.x > editorPos.x + editorPos.width) {\r\n            return null;\r\n        }\r\n        return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), editorPos, pos, null);\r\n    };\r\n    MouseHandler.prototype._createMouseTarget = function (e, testEventTarget) {\r\n        return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), e.editorPos, e.pos, testEventTarget ? e.target : null);\r\n    };\r\n    MouseHandler.prototype._getMouseColumn = function (e) {\r\n        return this.mouseTargetFactory.getMouseColumn(e.editorPos, e.pos);\r\n    };\r\n    MouseHandler.prototype._onContextMenu = function (e, testEventTarget) {\r\n        this.viewController.emitContextMenu({\r\n            event: e,\r\n            target: this._createMouseTarget(e, testEventTarget)\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseMove = function (e) {\r\n        if (this._mouseDownOperation.isActive()) {\r\n            // In selection/drag operation\r\n            return;\r\n        }\r\n        var actualMouseMoveTime = e.timestamp;\r\n        if (actualMouseMoveTime < this.lastMouseLeaveTime) {\r\n            // Due to throttling, this event occurred before the mouse left the editor, therefore ignore it.\r\n            return;\r\n        }\r\n        this.viewController.emitMouseMove({\r\n            event: e,\r\n            target: this._createMouseTarget(e, true)\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseLeave = function (e) {\r\n        this.lastMouseLeaveTime = (new Date()).getTime();\r\n        this.viewController.emitMouseLeave({\r\n            event: e,\r\n            target: null\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseUp = function (e) {\r\n        this.viewController.emitMouseUp({\r\n            event: e,\r\n            target: this._createMouseTarget(e, true)\r\n        });\r\n    };\r\n    MouseHandler.prototype._onMouseDown = function (e) {\r\n        var _this = this;\r\n        var t = this._createMouseTarget(e, true);\r\n        var targetIsContent = (t.type === 6 /* CONTENT_TEXT */ || t.type === 7 /* CONTENT_EMPTY */);\r\n        var targetIsGutter = (t.type === 2 /* GUTTER_GLYPH_MARGIN */ || t.type === 3 /* GUTTER_LINE_NUMBERS */ || t.type === 4 /* GUTTER_LINE_DECORATIONS */);\r\n        var targetIsLineNumbers = (t.type === 3 /* GUTTER_LINE_NUMBERS */);\r\n        var selectOnLineNumbers = this._context.configuration.options.get(83 /* selectOnLineNumbers */);\r\n        var targetIsViewZone = (t.type === 8 /* CONTENT_VIEW_ZONE */ || t.type === 5 /* GUTTER_VIEW_ZONE */);\r\n        var targetIsWidget = (t.type === 9 /* CONTENT_WIDGET */);\r\n        var shouldHandle = e.leftButton || e.middleButton;\r\n        if (platform.isMacintosh && e.leftButton && e.ctrlKey) {\r\n            shouldHandle = false;\r\n        }\r\n        var focus = function () {\r\n            // In IE11, if the focus is in the browser's address bar and\r\n            // then you click in the editor, calling preventDefault()\r\n            // will not move focus properly (focus remains the address bar)\r\n            if (browser.isIE && !_this._isFocused) {\r\n                _this._asyncFocus.schedule();\r\n            }\r\n            else {\r\n                e.preventDefault();\r\n                _this.viewHelper.focusTextArea();\r\n            }\r\n        };\r\n        if (shouldHandle && (targetIsContent || (targetIsLineNumbers && selectOnLineNumbers))) {\r\n            focus();\r\n            this._mouseDownOperation.start(t.type, e);\r\n        }\r\n        else if (targetIsGutter) {\r\n            // Do not steal focus\r\n            e.preventDefault();\r\n        }\r\n        else if (targetIsViewZone) {\r\n            var viewZoneData = t.detail;\r\n            if (this.viewHelper.shouldSuppressMouseDownOnViewZone(viewZoneData.viewZoneId)) {\r\n                focus();\r\n                this._mouseDownOperation.start(t.type, e);\r\n                e.preventDefault();\r\n            }\r\n        }\r\n        else if (targetIsWidget && this.viewHelper.shouldSuppressMouseDownOnWidget(t.detail)) {\r\n            focus();\r\n            e.preventDefault();\r\n        }\r\n        this.viewController.emitMouseDown({\r\n            event: e,\r\n            target: t\r\n        });\r\n    };\r\n    MouseHandler.MOUSE_MOVE_MINIMUM_TIME = 100; // ms\r\n    return MouseHandler;\r\n}(ViewEventHandler));\r\nexport { MouseHandler };\r\nvar MouseDownOperation = /** @class */ (function (_super) {\r\n    __extends(MouseDownOperation, _super);\r\n    function MouseDownOperation(context, viewController, viewHelper, createMouseTarget, getMouseColumn) {\r\n        var _this = _super.call(this) || this;\r\n        _this._context = context;\r\n        _this._viewController = viewController;\r\n        _this._viewHelper = viewHelper;\r\n        _this._createMouseTarget = createMouseTarget;\r\n        _this._getMouseColumn = getMouseColumn;\r\n        _this._mouseMoveMonitor = _this._register(new GlobalEditorMouseMoveMonitor(_this._viewHelper.viewDomNode));\r\n        _this._onScrollTimeout = _this._register(new TimeoutTimer());\r\n        _this._mouseState = new MouseDownState();\r\n        _this._currentSelection = new Selection(1, 1, 1, 1);\r\n        _this._isActive = false;\r\n        _this._lastMouseEvent = null;\r\n        return _this;\r\n    }\r\n    MouseDownOperation.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    MouseDownOperation.prototype.isActive = function () {\r\n        return this._isActive;\r\n    };\r\n    MouseDownOperation.prototype._onMouseDownThenMove = function (e) {\r\n        this._lastMouseEvent = e;\r\n        this._mouseState.setModifiers(e);\r\n        var position = this._findMousePosition(e, true);\r\n        if (!position) {\r\n            // Ignoring because position is unknown\r\n            return;\r\n        }\r\n        if (this._mouseState.isDragAndDrop) {\r\n            this._viewController.emitMouseDrag({\r\n                event: e,\r\n                target: position\r\n            });\r\n        }\r\n        else {\r\n            this._dispatchMouse(position, true);\r\n        }\r\n    };\r\n    MouseDownOperation.prototype.start = function (targetType, e) {\r\n        var _this = this;\r\n        this._lastMouseEvent = e;\r\n        this._mouseState.setStartedOnLineNumbers(targetType === 3 /* GUTTER_LINE_NUMBERS */);\r\n        this._mouseState.setStartButtons(e);\r\n        this._mouseState.setModifiers(e);\r\n        var position = this._findMousePosition(e, true);\r\n        if (!position || !position.position) {\r\n            // Ignoring because position is unknown\r\n            return;\r\n        }\r\n        this._mouseState.trySetCount(e.detail, position.position);\r\n        // Overwrite the detail of the MouseEvent, as it will be sent out in an event and contributions might rely on it.\r\n        e.detail = this._mouseState.count;\r\n        var options = this._context.configuration.options;\r\n        if (!options.get(68 /* readOnly */)\r\n            && options.get(24 /* dragAndDrop */)\r\n            && !this._mouseState.altKey // we don't support multiple mouse\r\n            && e.detail < 2 // only single click on a selection can work\r\n            && !this._isActive // the mouse is not down yet\r\n            && !this._currentSelection.isEmpty() // we don't drag single cursor\r\n            && (position.type === 6 /* CONTENT_TEXT */) // single click on text\r\n            && position.position && this._currentSelection.containsPosition(position.position) // single click on a selection\r\n        ) {\r\n            this._mouseState.isDragAndDrop = true;\r\n            this._isActive = true;\r\n            this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, createMouseMoveEventMerger(null), function (e) { return _this._onMouseDownThenMove(e); }, function () {\r\n                var position = _this._findMousePosition(_this._lastMouseEvent, true);\r\n                _this._viewController.emitMouseDrop({\r\n                    event: _this._lastMouseEvent,\r\n                    target: (position ? _this._createMouseTarget(_this._lastMouseEvent, true) : null) // Ignoring because position is unknown, e.g., Content View Zone\r\n                });\r\n                _this._stop();\r\n            });\r\n            return;\r\n        }\r\n        this._mouseState.isDragAndDrop = false;\r\n        this._dispatchMouse(position, e.shiftKey);\r\n        if (!this._isActive) {\r\n            this._isActive = true;\r\n            this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, createMouseMoveEventMerger(null), function (e) { return _this._onMouseDownThenMove(e); }, function () { return _this._stop(); });\r\n        }\r\n    };\r\n    MouseDownOperation.prototype._stop = function () {\r\n        this._isActive = false;\r\n        this._onScrollTimeout.cancel();\r\n    };\r\n    MouseDownOperation.prototype.onScrollChanged = function () {\r\n        var _this = this;\r\n        if (!this._isActive) {\r\n            return;\r\n        }\r\n        this._onScrollTimeout.setIfNotSet(function () {\r\n            if (!_this._lastMouseEvent) {\r\n                return;\r\n            }\r\n            var position = _this._findMousePosition(_this._lastMouseEvent, false);\r\n            if (!position) {\r\n                // Ignoring because position is unknown\r\n                return;\r\n            }\r\n            if (_this._mouseState.isDragAndDrop) {\r\n                // Ignoring because users are dragging the text\r\n                return;\r\n            }\r\n            _this._dispatchMouse(position, true);\r\n        }, 10);\r\n    };\r\n    MouseDownOperation.prototype.onCursorStateChanged = function (e) {\r\n        this._currentSelection = e.selections[0];\r\n    };\r\n    MouseDownOperation.prototype._getPositionOutsideEditor = function (e) {\r\n        var editorContent = e.editorPos;\r\n        var model = this._context.model;\r\n        var viewLayout = this._context.viewLayout;\r\n        var mouseColumn = this._getMouseColumn(e);\r\n        if (e.posy < editorContent.y) {\r\n            var verticalOffset = Math.max(viewLayout.getCurrentScrollTop() - (editorContent.y - e.posy), 0);\r\n            var viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\r\n            if (viewZoneData) {\r\n                var newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\r\n                if (newPosition) {\r\n                    return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, newPosition);\r\n                }\r\n            }\r\n            var aboveLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(aboveLineNumber, 1));\r\n        }\r\n        if (e.posy > editorContent.y + editorContent.height) {\r\n            var verticalOffset = viewLayout.getCurrentScrollTop() + (e.posy - editorContent.y);\r\n            var viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\r\n            if (viewZoneData) {\r\n                var newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\r\n                if (newPosition) {\r\n                    return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, newPosition);\r\n                }\r\n            }\r\n            var belowLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(belowLineNumber, model.getLineMaxColumn(belowLineNumber)));\r\n        }\r\n        var possibleLineNumber = viewLayout.getLineNumberAtVerticalOffset(viewLayout.getCurrentScrollTop() + (e.posy - editorContent.y));\r\n        if (e.posx < editorContent.x) {\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(possibleLineNumber, 1));\r\n        }\r\n        if (e.posx > editorContent.x + editorContent.width) {\r\n            return new MouseTarget(null, 13 /* OUTSIDE_EDITOR */, mouseColumn, new Position(possibleLineNumber, model.getLineMaxColumn(possibleLineNumber)));\r\n        }\r\n        return null;\r\n    };\r\n    MouseDownOperation.prototype._findMousePosition = function (e, testEventTarget) {\r\n        var positionOutsideEditor = this._getPositionOutsideEditor(e);\r\n        if (positionOutsideEditor) {\r\n            return positionOutsideEditor;\r\n        }\r\n        var t = this._createMouseTarget(e, testEventTarget);\r\n        var hintedPosition = t.position;\r\n        if (!hintedPosition) {\r\n            return null;\r\n        }\r\n        if (t.type === 8 /* CONTENT_VIEW_ZONE */ || t.type === 5 /* GUTTER_VIEW_ZONE */) {\r\n            var newPosition = this._helpPositionJumpOverViewZone(t.detail);\r\n            if (newPosition) {\r\n                return new MouseTarget(t.element, t.type, t.mouseColumn, newPosition, null, t.detail);\r\n            }\r\n        }\r\n        return t;\r\n    };\r\n    MouseDownOperation.prototype._helpPositionJumpOverViewZone = function (viewZoneData) {\r\n        // Force position on view zones to go above or below depending on where selection started from\r\n        var selectionStart = new Position(this._currentSelection.selectionStartLineNumber, this._currentSelection.selectionStartColumn);\r\n        var positionBefore = viewZoneData.positionBefore;\r\n        var positionAfter = viewZoneData.positionAfter;\r\n        if (positionBefore && positionAfter) {\r\n            if (positionBefore.isBefore(selectionStart)) {\r\n                return positionBefore;\r\n            }\r\n            else {\r\n                return positionAfter;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    MouseDownOperation.prototype._dispatchMouse = function (position, inSelectionMode) {\r\n        if (!position.position) {\r\n            return;\r\n        }\r\n        this._viewController.dispatchMouse({\r\n            position: position.position,\r\n            mouseColumn: position.mouseColumn,\r\n            startedOnLineNumbers: this._mouseState.startedOnLineNumbers,\r\n            inSelectionMode: inSelectionMode,\r\n            mouseDownCount: this._mouseState.count,\r\n            altKey: this._mouseState.altKey,\r\n            ctrlKey: this._mouseState.ctrlKey,\r\n            metaKey: this._mouseState.metaKey,\r\n            shiftKey: this._mouseState.shiftKey,\r\n            leftButton: this._mouseState.leftButton,\r\n            middleButton: this._mouseState.middleButton,\r\n        });\r\n    };\r\n    return MouseDownOperation;\r\n}(Disposable));\r\nvar MouseDownState = /** @class */ (function () {\r\n    function MouseDownState() {\r\n        this._altKey = false;\r\n        this._ctrlKey = false;\r\n        this._metaKey = false;\r\n        this._shiftKey = false;\r\n        this._leftButton = false;\r\n        this._middleButton = false;\r\n        this._startedOnLineNumbers = false;\r\n        this._lastMouseDownPosition = null;\r\n        this._lastMouseDownPositionEqualCount = 0;\r\n        this._lastMouseDownCount = 0;\r\n        this._lastSetMouseDownCountTime = 0;\r\n        this.isDragAndDrop = false;\r\n    }\r\n    Object.defineProperty(MouseDownState.prototype, \"altKey\", {\r\n        get: function () { return this._altKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"ctrlKey\", {\r\n        get: function () { return this._ctrlKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"metaKey\", {\r\n        get: function () { return this._metaKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"shiftKey\", {\r\n        get: function () { return this._shiftKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"leftButton\", {\r\n        get: function () { return this._leftButton; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"middleButton\", {\r\n        get: function () { return this._middleButton; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"startedOnLineNumbers\", {\r\n        get: function () { return this._startedOnLineNumbers; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(MouseDownState.prototype, \"count\", {\r\n        get: function () {\r\n            return this._lastMouseDownCount;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    MouseDownState.prototype.setModifiers = function (source) {\r\n        this._altKey = source.altKey;\r\n        this._ctrlKey = source.ctrlKey;\r\n        this._metaKey = source.metaKey;\r\n        this._shiftKey = source.shiftKey;\r\n    };\r\n    MouseDownState.prototype.setStartButtons = function (source) {\r\n        this._leftButton = source.leftButton;\r\n        this._middleButton = source.middleButton;\r\n    };\r\n    MouseDownState.prototype.setStartedOnLineNumbers = function (startedOnLineNumbers) {\r\n        this._startedOnLineNumbers = startedOnLineNumbers;\r\n    };\r\n    MouseDownState.prototype.trySetCount = function (setMouseDownCount, newMouseDownPosition) {\r\n        // a. Invalidate multiple clicking if too much time has passed (will be hit by IE because the detail field of mouse events contains garbage in IE10)\r\n        var currentTime = (new Date()).getTime();\r\n        if (currentTime - this._lastSetMouseDownCountTime > MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME) {\r\n            setMouseDownCount = 1;\r\n        }\r\n        this._lastSetMouseDownCountTime = currentTime;\r\n        // b. Ensure that we don't jump from single click to triple click in one go (will be hit by IE because the detail field of mouse events contains garbage in IE10)\r\n        if (setMouseDownCount > this._lastMouseDownCount + 1) {\r\n            setMouseDownCount = this._lastMouseDownCount + 1;\r\n        }\r\n        // c. Invalidate multiple clicking if the logical position is different\r\n        if (this._lastMouseDownPosition && this._lastMouseDownPosition.equals(newMouseDownPosition)) {\r\n            this._lastMouseDownPositionEqualCount++;\r\n        }\r\n        else {\r\n            this._lastMouseDownPositionEqualCount = 1;\r\n        }\r\n        this._lastMouseDownPosition = newMouseDownPosition;\r\n        // Finally set the lastMouseDownCount\r\n        this._lastMouseDownCount = Math.min(setMouseDownCount, this._lastMouseDownPositionEqualCount);\r\n    };\r\n    MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME = 400; // ms\r\n    return MouseDownState;\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}