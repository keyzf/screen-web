{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { createCancelablePromise, TimeoutTimer } from '../../../base/common/async.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { Range } from '../../common/core/range.js';\nimport { CodeActionProviderRegistry } from '../../common/modes.js';\nimport { RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\nimport { getCodeActions } from './codeAction.js';\nimport { isEqual } from '../../../base/common/resources.js';\nexport var SUPPORTED_CODE_ACTIONS = new RawContextKey('supportedCodeAction', '');\n\nvar CodeActionOracle =\n/** @class */\nfunction (_super) {\n  __extends(CodeActionOracle, _super);\n\n  function CodeActionOracle(_editor, _markerService, _signalChange, _delay) {\n    if (_delay === void 0) {\n      _delay = 250;\n    }\n\n    var _this = _super.call(this) || this;\n\n    _this._editor = _editor;\n    _this._markerService = _markerService;\n    _this._signalChange = _signalChange;\n    _this._delay = _delay;\n    _this._autoTriggerTimer = _this._register(new TimeoutTimer());\n\n    _this._register(_this._markerService.onMarkerChanged(function (e) {\n      return _this._onMarkerChanges(e);\n    }));\n\n    _this._register(_this._editor.onDidChangeCursorPosition(function () {\n      return _this._onCursorChange();\n    }));\n\n    return _this;\n  }\n\n  CodeActionOracle.prototype.trigger = function (trigger) {\n    var selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);\n\n    return this._createEventAndSignalChange(trigger, selection);\n  };\n\n  CodeActionOracle.prototype._onMarkerChanges = function (resources) {\n    var _this = this;\n\n    var model = this._editor.getModel();\n\n    if (!model) {\n      return;\n    }\n\n    if (resources.some(function (resource) {\n      return isEqual(resource, model.uri);\n    })) {\n      this._autoTriggerTimer.cancelAndSet(function () {\n        _this.trigger({\n          type: 1\n          /* Auto */\n\n        });\n      }, this._delay);\n    }\n  };\n\n  CodeActionOracle.prototype._onCursorChange = function () {\n    var _this = this;\n\n    this._autoTriggerTimer.cancelAndSet(function () {\n      _this.trigger({\n        type: 1\n        /* Auto */\n\n      });\n    }, this._delay);\n  };\n\n  CodeActionOracle.prototype._getRangeOfMarker = function (selection) {\n    var model = this._editor.getModel();\n\n    if (!model) {\n      return undefined;\n    }\n\n    for (var _i = 0, _a = this._markerService.read({\n      resource: model.uri\n    }); _i < _a.length; _i++) {\n      var marker = _a[_i];\n      var markerRange = model.validateRange(marker);\n\n      if (Range.intersectRanges(markerRange, selection)) {\n        return Range.lift(markerRange);\n      }\n    }\n\n    return undefined;\n  };\n\n  CodeActionOracle.prototype._getRangeOfSelectionUnlessWhitespaceEnclosed = function (trigger) {\n    if (!this._editor.hasModel()) {\n      return undefined;\n    }\n\n    var model = this._editor.getModel();\n\n    var selection = this._editor.getSelection();\n\n    if (selection.isEmpty() && trigger.type === 1\n    /* Auto */\n    ) {\n        var _a = selection.getPosition(),\n            lineNumber = _a.lineNumber,\n            column = _a.column;\n\n        var line = model.getLineContent(lineNumber);\n\n        if (line.length === 0) {\n          // empty line\n          return undefined;\n        } else if (column === 1) {\n          // look only right\n          if (/\\s/.test(line[0])) {\n            return undefined;\n          }\n        } else if (column === model.getLineMaxColumn(lineNumber)) {\n          // look only left\n          if (/\\s/.test(line[line.length - 1])) {\n            return undefined;\n          }\n        } else {\n          // look left and right\n          if (/\\s/.test(line[column - 2]) && /\\s/.test(line[column - 1])) {\n            return undefined;\n          }\n        }\n      }\n\n    return selection;\n  };\n\n  CodeActionOracle.prototype._createEventAndSignalChange = function (trigger, selection) {\n    var model = this._editor.getModel();\n\n    if (!selection || !model) {\n      // cancel\n      this._signalChange(undefined);\n\n      return undefined;\n    }\n\n    var markerRange = this._getRangeOfMarker(selection);\n\n    var position = markerRange ? markerRange.getStartPosition() : selection.getStartPosition();\n    var e = {\n      trigger: trigger,\n      selection: selection,\n      position: position\n    };\n\n    this._signalChange(e);\n\n    return e;\n  };\n\n  return CodeActionOracle;\n}(Disposable);\n\nexport var CodeActionsState;\n\n(function (CodeActionsState) {\n  CodeActionsState.Empty = {\n    type: 0\n    /* Empty */\n\n  };\n\n  var Triggered =\n  /** @class */\n  function () {\n    function Triggered(trigger, rangeOrSelection, position, actions) {\n      this.trigger = trigger;\n      this.rangeOrSelection = rangeOrSelection;\n      this.position = position;\n      this.actions = actions;\n      this.type = 1\n      /* Triggered */\n      ;\n    }\n\n    return Triggered;\n  }();\n\n  CodeActionsState.Triggered = Triggered;\n})(CodeActionsState || (CodeActionsState = {}));\n\nvar CodeActionModel =\n/** @class */\nfunction (_super) {\n  __extends(CodeActionModel, _super);\n\n  function CodeActionModel(_editor, _markerService, contextKeyService, _progressService) {\n    var _this = _super.call(this) || this;\n\n    _this._editor = _editor;\n    _this._markerService = _markerService;\n    _this._progressService = _progressService;\n    _this._codeActionOracle = _this._register(new MutableDisposable());\n    _this._state = CodeActionsState.Empty;\n    _this._onDidChangeState = _this._register(new Emitter());\n    _this.onDidChangeState = _this._onDidChangeState.event;\n    _this._supportedCodeActions = SUPPORTED_CODE_ACTIONS.bindTo(contextKeyService);\n\n    _this._register(_this._editor.onDidChangeModel(function () {\n      return _this._update();\n    }));\n\n    _this._register(_this._editor.onDidChangeModelLanguage(function () {\n      return _this._update();\n    }));\n\n    _this._register(CodeActionProviderRegistry.onDidChange(function () {\n      return _this._update();\n    }));\n\n    _this._update();\n\n    return _this;\n  }\n\n  CodeActionModel.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this.setState(CodeActionsState.Empty, true);\n  };\n\n  CodeActionModel.prototype._update = function () {\n    var _this = this;\n\n    this._codeActionOracle.value = undefined;\n    this.setState(CodeActionsState.Empty);\n\n    var model = this._editor.getModel();\n\n    if (model && CodeActionProviderRegistry.has(model) && !this._editor.getOption(68\n    /* readOnly */\n    )) {\n      var supportedActions = [];\n\n      for (var _i = 0, _a = CodeActionProviderRegistry.all(model); _i < _a.length; _i++) {\n        var provider = _a[_i];\n\n        if (Array.isArray(provider.providedCodeActionKinds)) {\n          supportedActions.push.apply(supportedActions, provider.providedCodeActionKinds);\n        }\n      }\n\n      this._supportedCodeActions.set(supportedActions.join(' '));\n\n      this._codeActionOracle.value = new CodeActionOracle(this._editor, this._markerService, function (trigger) {\n        if (!trigger) {\n          _this.setState(CodeActionsState.Empty);\n\n          return;\n        }\n\n        var actions = createCancelablePromise(function (token) {\n          return getCodeActions(model, trigger.selection, trigger.trigger, token);\n        });\n\n        if (_this._progressService && trigger.trigger.type === 2\n        /* Manual */\n        ) {\n            _this._progressService.showWhile(actions, 250);\n          }\n\n        _this.setState(new CodeActionsState.Triggered(trigger.trigger, trigger.selection, trigger.position, actions));\n      }, undefined);\n\n      this._codeActionOracle.value.trigger({\n        type: 1\n        /* Auto */\n\n      });\n    } else {\n      this._supportedCodeActions.reset();\n    }\n  };\n\n  CodeActionModel.prototype.trigger = function (trigger) {\n    if (this._codeActionOracle.value) {\n      this._codeActionOracle.value.trigger(trigger);\n    }\n  };\n\n  CodeActionModel.prototype.setState = function (newState, skipNotify) {\n    if (newState === this._state) {\n      return;\n    } // Cancel old request\n\n\n    if (this._state.type === 1\n    /* Triggered */\n    ) {\n        this._state.actions.cancel();\n      }\n\n    this._state = newState;\n\n    if (!skipNotify) {\n      this._onDidChangeState.fire(newState);\n    }\n  };\n\n  return CodeActionModel;\n}(Disposable);\n\nexport { CodeActionModel };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/codeAction/codeActionModel.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","createCancelablePromise","TimeoutTimer","Emitter","Disposable","MutableDisposable","Range","CodeActionProviderRegistry","RawContextKey","getCodeActions","isEqual","SUPPORTED_CODE_ACTIONS","CodeActionOracle","_super","_editor","_markerService","_signalChange","_delay","_this","call","_autoTriggerTimer","_register","onMarkerChanged","e","_onMarkerChanges","onDidChangeCursorPosition","_onCursorChange","trigger","selection","_getRangeOfSelectionUnlessWhitespaceEnclosed","_createEventAndSignalChange","resources","model","getModel","some","resource","uri","cancelAndSet","type","_getRangeOfMarker","undefined","_i","_a","read","length","marker","markerRange","validateRange","intersectRanges","lift","hasModel","getSelection","isEmpty","getPosition","lineNumber","column","line","getLineContent","test","getLineMaxColumn","position","getStartPosition","CodeActionsState","Empty","Triggered","rangeOrSelection","actions","CodeActionModel","contextKeyService","_progressService","_codeActionOracle","_state","_onDidChangeState","onDidChangeState","event","_supportedCodeActions","bindTo","onDidChangeModel","_update","onDidChangeModelLanguage","onDidChange","dispose","setState","value","has","getOption","supportedActions","all","provider","isArray","providedCodeActionKinds","push","apply","set","join","token","showWhile","reset","newState","skipNotify","cancel","fire"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { createCancelablePromise, TimeoutTimer } from '../../../base/common/async.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { CodeActionProviderRegistry } from '../../common/modes.js';\r\nimport { RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { getCodeActions } from './codeAction.js';\r\nimport { isEqual } from '../../../base/common/resources.js';\r\nexport var SUPPORTED_CODE_ACTIONS = new RawContextKey('supportedCodeAction', '');\r\nvar CodeActionOracle = /** @class */ (function (_super) {\r\n    __extends(CodeActionOracle, _super);\r\n    function CodeActionOracle(_editor, _markerService, _signalChange, _delay) {\r\n        if (_delay === void 0) { _delay = 250; }\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._markerService = _markerService;\r\n        _this._signalChange = _signalChange;\r\n        _this._delay = _delay;\r\n        _this._autoTriggerTimer = _this._register(new TimeoutTimer());\r\n        _this._register(_this._markerService.onMarkerChanged(function (e) { return _this._onMarkerChanges(e); }));\r\n        _this._register(_this._editor.onDidChangeCursorPosition(function () { return _this._onCursorChange(); }));\r\n        return _this;\r\n    }\r\n    CodeActionOracle.prototype.trigger = function (trigger) {\r\n        var selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);\r\n        return this._createEventAndSignalChange(trigger, selection);\r\n    };\r\n    CodeActionOracle.prototype._onMarkerChanges = function (resources) {\r\n        var _this = this;\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return;\r\n        }\r\n        if (resources.some(function (resource) { return isEqual(resource, model.uri); })) {\r\n            this._autoTriggerTimer.cancelAndSet(function () {\r\n                _this.trigger({ type: 1 /* Auto */ });\r\n            }, this._delay);\r\n        }\r\n    };\r\n    CodeActionOracle.prototype._onCursorChange = function () {\r\n        var _this = this;\r\n        this._autoTriggerTimer.cancelAndSet(function () {\r\n            _this.trigger({ type: 1 /* Auto */ });\r\n        }, this._delay);\r\n    };\r\n    CodeActionOracle.prototype._getRangeOfMarker = function (selection) {\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return undefined;\r\n        }\r\n        for (var _i = 0, _a = this._markerService.read({ resource: model.uri }); _i < _a.length; _i++) {\r\n            var marker = _a[_i];\r\n            var markerRange = model.validateRange(marker);\r\n            if (Range.intersectRanges(markerRange, selection)) {\r\n                return Range.lift(markerRange);\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    CodeActionOracle.prototype._getRangeOfSelectionUnlessWhitespaceEnclosed = function (trigger) {\r\n        if (!this._editor.hasModel()) {\r\n            return undefined;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var selection = this._editor.getSelection();\r\n        if (selection.isEmpty() && trigger.type === 1 /* Auto */) {\r\n            var _a = selection.getPosition(), lineNumber = _a.lineNumber, column = _a.column;\r\n            var line = model.getLineContent(lineNumber);\r\n            if (line.length === 0) {\r\n                // empty line\r\n                return undefined;\r\n            }\r\n            else if (column === 1) {\r\n                // look only right\r\n                if (/\\s/.test(line[0])) {\r\n                    return undefined;\r\n                }\r\n            }\r\n            else if (column === model.getLineMaxColumn(lineNumber)) {\r\n                // look only left\r\n                if (/\\s/.test(line[line.length - 1])) {\r\n                    return undefined;\r\n                }\r\n            }\r\n            else {\r\n                // look left and right\r\n                if (/\\s/.test(line[column - 2]) && /\\s/.test(line[column - 1])) {\r\n                    return undefined;\r\n                }\r\n            }\r\n        }\r\n        return selection;\r\n    };\r\n    CodeActionOracle.prototype._createEventAndSignalChange = function (trigger, selection) {\r\n        var model = this._editor.getModel();\r\n        if (!selection || !model) {\r\n            // cancel\r\n            this._signalChange(undefined);\r\n            return undefined;\r\n        }\r\n        var markerRange = this._getRangeOfMarker(selection);\r\n        var position = markerRange ? markerRange.getStartPosition() : selection.getStartPosition();\r\n        var e = {\r\n            trigger: trigger,\r\n            selection: selection,\r\n            position: position\r\n        };\r\n        this._signalChange(e);\r\n        return e;\r\n    };\r\n    return CodeActionOracle;\r\n}(Disposable));\r\nexport var CodeActionsState;\r\n(function (CodeActionsState) {\r\n    CodeActionsState.Empty = { type: 0 /* Empty */ };\r\n    var Triggered = /** @class */ (function () {\r\n        function Triggered(trigger, rangeOrSelection, position, actions) {\r\n            this.trigger = trigger;\r\n            this.rangeOrSelection = rangeOrSelection;\r\n            this.position = position;\r\n            this.actions = actions;\r\n            this.type = 1 /* Triggered */;\r\n        }\r\n        return Triggered;\r\n    }());\r\n    CodeActionsState.Triggered = Triggered;\r\n})(CodeActionsState || (CodeActionsState = {}));\r\nvar CodeActionModel = /** @class */ (function (_super) {\r\n    __extends(CodeActionModel, _super);\r\n    function CodeActionModel(_editor, _markerService, contextKeyService, _progressService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._editor = _editor;\r\n        _this._markerService = _markerService;\r\n        _this._progressService = _progressService;\r\n        _this._codeActionOracle = _this._register(new MutableDisposable());\r\n        _this._state = CodeActionsState.Empty;\r\n        _this._onDidChangeState = _this._register(new Emitter());\r\n        _this.onDidChangeState = _this._onDidChangeState.event;\r\n        _this._supportedCodeActions = SUPPORTED_CODE_ACTIONS.bindTo(contextKeyService);\r\n        _this._register(_this._editor.onDidChangeModel(function () { return _this._update(); }));\r\n        _this._register(_this._editor.onDidChangeModelLanguage(function () { return _this._update(); }));\r\n        _this._register(CodeActionProviderRegistry.onDidChange(function () { return _this._update(); }));\r\n        _this._update();\r\n        return _this;\r\n    }\r\n    CodeActionModel.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this.setState(CodeActionsState.Empty, true);\r\n    };\r\n    CodeActionModel.prototype._update = function () {\r\n        var _this = this;\r\n        this._codeActionOracle.value = undefined;\r\n        this.setState(CodeActionsState.Empty);\r\n        var model = this._editor.getModel();\r\n        if (model\r\n            && CodeActionProviderRegistry.has(model)\r\n            && !this._editor.getOption(68 /* readOnly */)) {\r\n            var supportedActions = [];\r\n            for (var _i = 0, _a = CodeActionProviderRegistry.all(model); _i < _a.length; _i++) {\r\n                var provider = _a[_i];\r\n                if (Array.isArray(provider.providedCodeActionKinds)) {\r\n                    supportedActions.push.apply(supportedActions, provider.providedCodeActionKinds);\r\n                }\r\n            }\r\n            this._supportedCodeActions.set(supportedActions.join(' '));\r\n            this._codeActionOracle.value = new CodeActionOracle(this._editor, this._markerService, function (trigger) {\r\n                if (!trigger) {\r\n                    _this.setState(CodeActionsState.Empty);\r\n                    return;\r\n                }\r\n                var actions = createCancelablePromise(function (token) { return getCodeActions(model, trigger.selection, trigger.trigger, token); });\r\n                if (_this._progressService && trigger.trigger.type === 2 /* Manual */) {\r\n                    _this._progressService.showWhile(actions, 250);\r\n                }\r\n                _this.setState(new CodeActionsState.Triggered(trigger.trigger, trigger.selection, trigger.position, actions));\r\n            }, undefined);\r\n            this._codeActionOracle.value.trigger({ type: 1 /* Auto */ });\r\n        }\r\n        else {\r\n            this._supportedCodeActions.reset();\r\n        }\r\n    };\r\n    CodeActionModel.prototype.trigger = function (trigger) {\r\n        if (this._codeActionOracle.value) {\r\n            this._codeActionOracle.value.trigger(trigger);\r\n        }\r\n    };\r\n    CodeActionModel.prototype.setState = function (newState, skipNotify) {\r\n        if (newState === this._state) {\r\n            return;\r\n        }\r\n        // Cancel old request\r\n        if (this._state.type === 1 /* Triggered */) {\r\n            this._state.actions.cancel();\r\n        }\r\n        this._state = newState;\r\n        if (!skipNotify) {\r\n            this._onDidChangeState.fire(newState);\r\n        }\r\n    };\r\n    return CodeActionModel;\r\n}(Disposable));\r\nexport { CodeActionModel };\r\n"]},"metadata":{},"sourceType":"module"}