{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport { first } from '../../../base/common/async.js';\nimport { assign } from '../../../base/common/objects.js';\nimport { onUnexpectedExternalError, canceled, isPromiseCanceledError } from '../../../base/common/errors.js';\nimport { registerDefaultLanguageCommand } from '../../browser/editorExtensions.js';\nimport * as modes from '../../common/modes.js';\nimport { Position } from '../../common/core/position.js';\nimport { RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Range } from '../../common/core/range.js';\nimport { FuzzyScore } from '../../../base/common/filters.js';\nimport { isDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\nexport var Context = {\n  Visible: new RawContextKey('suggestWidgetVisible', false),\n  MultipleSuggestions: new RawContextKey('suggestWidgetMultipleSuggestions', false),\n  MakesTextEdit: new RawContextKey('suggestionMakesTextEdit', true),\n  AcceptSuggestionsOnEnter: new RawContextKey('acceptSuggestionOnEnter', true)\n};\n\nvar CompletionItem =\n/** @class */\nfunction () {\n  function CompletionItem(position, completion, container, provider, model) {\n    var _this = this;\n\n    this.position = position;\n    this.completion = completion;\n    this.container = container;\n    this.provider = provider;\n    this.isResolved = false; // sorting, filtering\n\n    this.score = FuzzyScore.Default;\n    this.distance = 0;\n    this.textLabel = typeof completion.label === 'string' ? completion.label : completion.label.name; // ensure lower-variants (perf)\n\n    this.labelLow = this.textLabel.toLowerCase();\n    this.sortTextLow = completion.sortText && completion.sortText.toLowerCase();\n    this.filterTextLow = completion.filterText && completion.filterText.toLowerCase(); // normalize ranges\n\n    if (Range.isIRange(completion.range)) {\n      this.editStart = new Position(completion.range.startLineNumber, completion.range.startColumn);\n      this.editInsertEnd = new Position(completion.range.endLineNumber, completion.range.endColumn);\n      this.editReplaceEnd = new Position(completion.range.endLineNumber, completion.range.endColumn);\n    } else {\n      this.editStart = new Position(completion.range.insert.startLineNumber, completion.range.insert.startColumn);\n      this.editInsertEnd = new Position(completion.range.insert.endLineNumber, completion.range.insert.endColumn);\n      this.editReplaceEnd = new Position(completion.range.replace.endLineNumber, completion.range.replace.endColumn);\n    } // create the suggestion resolver\n\n\n    var resolveCompletionItem = provider.resolveCompletionItem;\n\n    if (typeof resolveCompletionItem !== 'function') {\n      this.resolve = function () {\n        return Promise.resolve();\n      };\n\n      this.isResolved = true;\n    } else {\n      var cached_1;\n\n      this.resolve = function (token) {\n        if (!cached_1) {\n          cached_1 = Promise.resolve(resolveCompletionItem.call(provider, model, position, completion, token)).then(function (value) {\n            assign(completion, value);\n            _this.isResolved = true;\n          }, function (err) {\n            if (isPromiseCanceledError(err)) {\n              // the IPC queue will reject the request with the\n              // cancellation error -> reset cached\n              cached_1 = undefined;\n            }\n          });\n          token.onCancellationRequested(function () {\n            if (!_this.isResolved) {\n              // cancellation after the request has been\n              // dispatched -> reset cache\n              cached_1 = undefined;\n            }\n          });\n        }\n\n        return cached_1;\n      };\n    }\n  }\n\n  return CompletionItem;\n}();\n\nexport { CompletionItem };\n\nvar CompletionOptions =\n/** @class */\nfunction () {\n  function CompletionOptions(snippetSortOrder, kindFilter, providerFilter) {\n    if (snippetSortOrder === void 0) {\n      snippetSortOrder = 2\n      /* Bottom */\n      ;\n    }\n\n    if (kindFilter === void 0) {\n      kindFilter = new Set();\n    }\n\n    if (providerFilter === void 0) {\n      providerFilter = new Set();\n    }\n\n    this.snippetSortOrder = snippetSortOrder;\n    this.kindFilter = kindFilter;\n    this.providerFilter = providerFilter;\n  }\n\n  CompletionOptions.default = new CompletionOptions();\n  return CompletionOptions;\n}();\n\nexport { CompletionOptions };\n\nvar _snippetSuggestSupport;\n\nexport function getSnippetSuggestSupport() {\n  return _snippetSuggestSupport;\n}\nexport function provideSuggestionItems(model, position, options, context, token) {\n  if (options === void 0) {\n    options = CompletionOptions.default;\n  }\n\n  if (context === void 0) {\n    context = {\n      triggerKind: 0\n      /* Invoke */\n\n    };\n  }\n\n  if (token === void 0) {\n    token = CancellationToken.None;\n  }\n\n  var word = model.getWordAtPosition(position);\n  var defaultReplaceRange = word ? new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn) : Range.fromPositions(position);\n  var defaultInsertRange = defaultReplaceRange.setEndPosition(position.lineNumber, position.column); // const wordUntil = model.getWordUntilPosition(position);\n  // const defaultRange = new Range(position.lineNumber, wordUntil.startColumn, position.lineNumber, wordUntil.endColumn);\n\n  position = position.clone(); // get provider groups, always add snippet suggestion provider\n\n  var supports = modes.CompletionProviderRegistry.orderedGroups(model); // add snippets provider unless turned off\n\n  if (!options.kindFilter.has(25\n  /* Snippet */\n  ) && _snippetSuggestSupport) {\n    supports.unshift([_snippetSuggestSupport]);\n  }\n\n  var allSuggestions = [];\n  var disposables = new DisposableStore();\n  var hasResult = false; // add suggestions from contributed providers - providers are ordered in groups of\n  // equal score and once a group produces a result the process stops\n\n  var factory = supports.map(function (supports) {\n    return function () {\n      // for each support in the group ask for suggestions\n      return Promise.all(supports.map(function (provider) {\n        if (options.providerFilter.size > 0 && !options.providerFilter.has(provider)) {\n          return undefined;\n        }\n\n        return Promise.resolve(provider.provideCompletionItems(model, position, context, token)).then(function (container) {\n          var len = allSuggestions.length;\n\n          if (container) {\n            for (var _i = 0, _a = container.suggestions || []; _i < _a.length; _i++) {\n              var suggestion = _a[_i];\n\n              if (!options.kindFilter.has(suggestion.kind)) {\n                // fill in default range when missing\n                if (!suggestion.range) {\n                  suggestion.range = {\n                    insert: defaultInsertRange,\n                    replace: defaultReplaceRange\n                  };\n                } // fill in default sortText when missing\n\n\n                if (!suggestion.sortText) {\n                  suggestion.sortText = typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.name;\n                }\n\n                allSuggestions.push(new CompletionItem(position, suggestion, container, provider, model));\n              }\n            }\n\n            if (isDisposable(container)) {\n              disposables.add(container);\n            }\n          }\n\n          if (len !== allSuggestions.length && provider !== _snippetSuggestSupport) {\n            hasResult = true;\n          }\n        }, onUnexpectedExternalError);\n      }));\n    };\n  });\n  var result = first(factory, function () {\n    // stop on result or cancellation\n    return hasResult || token.isCancellationRequested;\n  }).then(function () {\n    if (token.isCancellationRequested) {\n      disposables.dispose();\n      return Promise.reject(canceled());\n    }\n\n    return allSuggestions.sort(getSuggestionComparator(options.snippetSortOrder));\n  }); // result.then(items => {\n  // \tconsole.log(model.getWordUntilPosition(position), items.map(item => `${item.suggestion.label}, type=${item.suggestion.type}, incomplete?${item.container.incomplete}, overwriteBefore=${item.suggestion.overwriteBefore}`));\n  // \treturn items;\n  // }, err => {\n  // \tconsole.warn(model.getWordUntilPosition(position), err);\n  // });\n\n  return result;\n}\n\nfunction defaultComparator(a, b) {\n  // check with 'sortText'\n  if (a.sortTextLow && b.sortTextLow) {\n    if (a.sortTextLow < b.sortTextLow) {\n      return -1;\n    } else if (a.sortTextLow > b.sortTextLow) {\n      return 1;\n    }\n  } // check with 'label'\n\n\n  if (a.completion.label < b.completion.label) {\n    return -1;\n  } else if (a.completion.label > b.completion.label) {\n    return 1;\n  } // check with 'type'\n\n\n  return a.completion.kind - b.completion.kind;\n}\n\nfunction snippetUpComparator(a, b) {\n  if (a.completion.kind !== b.completion.kind) {\n    if (a.completion.kind === 25\n    /* Snippet */\n    ) {\n        return -1;\n      } else if (b.completion.kind === 25\n    /* Snippet */\n    ) {\n        return 1;\n      }\n  }\n\n  return defaultComparator(a, b);\n}\n\nfunction snippetDownComparator(a, b) {\n  if (a.completion.kind !== b.completion.kind) {\n    if (a.completion.kind === 25\n    /* Snippet */\n    ) {\n        return 1;\n      } else if (b.completion.kind === 25\n    /* Snippet */\n    ) {\n        return -1;\n      }\n  }\n\n  return defaultComparator(a, b);\n}\n\nvar _snippetComparators = new Map();\n\n_snippetComparators.set(0\n/* Top */\n, snippetUpComparator);\n\n_snippetComparators.set(2\n/* Bottom */\n, snippetDownComparator);\n\n_snippetComparators.set(1\n/* Inline */\n, defaultComparator);\n\nexport function getSuggestionComparator(snippetConfig) {\n  return _snippetComparators.get(snippetConfig);\n}\nregisterDefaultLanguageCommand('_executeCompletionItemProvider', function (model, position, args) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var result, disposables, resolving, maxItemsToResolve, items, _i, items_1, item;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          result = {\n            incomplete: false,\n            suggestions: []\n          };\n          disposables = new DisposableStore();\n          resolving = [];\n          maxItemsToResolve = args['maxItemsToResolve'] || 0;\n          return [4\n          /*yield*/\n          , provideSuggestionItems(model, position)];\n\n        case 1:\n          items = _a.sent();\n\n          for (_i = 0, items_1 = items; _i < items_1.length; _i++) {\n            item = items_1[_i];\n\n            if (resolving.length < maxItemsToResolve) {\n              resolving.push(item.resolve(CancellationToken.None));\n            }\n\n            result.incomplete = result.incomplete || item.container.incomplete;\n            result.suggestions.push(item.completion);\n\n            if (isDisposable(item.container)) {\n              disposables.add(item.container);\n            }\n          }\n\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2,, 4, 5]);\n\n          return [4\n          /*yield*/\n          , Promise.all(resolving)];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , result];\n\n        case 4:\n          setTimeout(function () {\n            return disposables.dispose();\n          }, 100);\n          return [7\n          /*endfinally*/\n          ];\n\n        case 5:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n});\n\nvar _provider = new (\n/** @class */\nfunction () {\n  function class_1() {\n    this.onlyOnceSuggestions = [];\n  }\n\n  class_1.prototype.provideCompletionItems = function () {\n    var suggestions = this.onlyOnceSuggestions.slice(0);\n    var result = {\n      suggestions: suggestions\n    };\n    this.onlyOnceSuggestions.length = 0;\n    return result;\n  };\n\n  return class_1;\n}())();\n\nmodes.CompletionProviderRegistry.register('*', _provider);\nexport function showSimpleSuggestions(editor, suggestions) {\n  setTimeout(function () {\n    var _a;\n\n    (_a = _provider.onlyOnceSuggestions).push.apply(_a, suggestions);\n\n    editor.getContribution('editor.contrib.suggestController').triggerSuggest(new Set().add(_provider));\n  }, 0);\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggest.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","first","assign","onUnexpectedExternalError","canceled","isPromiseCanceledError","registerDefaultLanguageCommand","modes","Position","RawContextKey","CancellationToken","Range","FuzzyScore","isDisposable","DisposableStore","Context","Visible","MultipleSuggestions","MakesTextEdit","AcceptSuggestionsOnEnter","CompletionItem","position","completion","container","provider","model","_this","isResolved","score","Default","distance","textLabel","name","labelLow","toLowerCase","sortTextLow","sortText","filterTextLow","filterText","isIRange","range","editStart","startLineNumber","startColumn","editInsertEnd","endLineNumber","endColumn","editReplaceEnd","insert","replace","resolveCompletionItem","cached_1","token","err","undefined","onCancellationRequested","CompletionOptions","snippetSortOrder","kindFilter","providerFilter","Set","default","_snippetSuggestSupport","getSnippetSuggestSupport","provideSuggestionItems","options","context","triggerKind","None","word","getWordAtPosition","defaultReplaceRange","lineNumber","fromPositions","defaultInsertRange","setEndPosition","column","clone","supports","CompletionProviderRegistry","orderedGroups","has","unshift","allSuggestions","disposables","hasResult","factory","map","all","size","provideCompletionItems","len","_i","_a","suggestions","suggestion","kind","add","isCancellationRequested","dispose","sort","getSuggestionComparator","defaultComparator","a","b","snippetUpComparator","snippetDownComparator","_snippetComparators","Map","set","snippetConfig","get","args","resolving","maxItemsToResolve","items","items_1","item","incomplete","setTimeout","_provider","class_1","onlyOnceSuggestions","prototype","slice","register","showSimpleSuggestions","editor","getContribution","triggerSuggest"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { first } from '../../../base/common/async.js';\r\nimport { assign } from '../../../base/common/objects.js';\r\nimport { onUnexpectedExternalError, canceled, isPromiseCanceledError } from '../../../base/common/errors.js';\r\nimport { registerDefaultLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport * as modes from '../../common/modes.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { FuzzyScore } from '../../../base/common/filters.js';\r\nimport { isDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nexport var Context = {\r\n    Visible: new RawContextKey('suggestWidgetVisible', false),\r\n    MultipleSuggestions: new RawContextKey('suggestWidgetMultipleSuggestions', false),\r\n    MakesTextEdit: new RawContextKey('suggestionMakesTextEdit', true),\r\n    AcceptSuggestionsOnEnter: new RawContextKey('acceptSuggestionOnEnter', true)\r\n};\r\nvar CompletionItem = /** @class */ (function () {\r\n    function CompletionItem(position, completion, container, provider, model) {\r\n        var _this = this;\r\n        this.position = position;\r\n        this.completion = completion;\r\n        this.container = container;\r\n        this.provider = provider;\r\n        this.isResolved = false;\r\n        // sorting, filtering\r\n        this.score = FuzzyScore.Default;\r\n        this.distance = 0;\r\n        this.textLabel = typeof completion.label === 'string'\r\n            ? completion.label\r\n            : completion.label.name;\r\n        // ensure lower-variants (perf)\r\n        this.labelLow = this.textLabel.toLowerCase();\r\n        this.sortTextLow = completion.sortText && completion.sortText.toLowerCase();\r\n        this.filterTextLow = completion.filterText && completion.filterText.toLowerCase();\r\n        // normalize ranges\r\n        if (Range.isIRange(completion.range)) {\r\n            this.editStart = new Position(completion.range.startLineNumber, completion.range.startColumn);\r\n            this.editInsertEnd = new Position(completion.range.endLineNumber, completion.range.endColumn);\r\n            this.editReplaceEnd = new Position(completion.range.endLineNumber, completion.range.endColumn);\r\n        }\r\n        else {\r\n            this.editStart = new Position(completion.range.insert.startLineNumber, completion.range.insert.startColumn);\r\n            this.editInsertEnd = new Position(completion.range.insert.endLineNumber, completion.range.insert.endColumn);\r\n            this.editReplaceEnd = new Position(completion.range.replace.endLineNumber, completion.range.replace.endColumn);\r\n        }\r\n        // create the suggestion resolver\r\n        var resolveCompletionItem = provider.resolveCompletionItem;\r\n        if (typeof resolveCompletionItem !== 'function') {\r\n            this.resolve = function () { return Promise.resolve(); };\r\n            this.isResolved = true;\r\n        }\r\n        else {\r\n            var cached_1;\r\n            this.resolve = function (token) {\r\n                if (!cached_1) {\r\n                    cached_1 = Promise.resolve(resolveCompletionItem.call(provider, model, position, completion, token)).then(function (value) {\r\n                        assign(completion, value);\r\n                        _this.isResolved = true;\r\n                    }, function (err) {\r\n                        if (isPromiseCanceledError(err)) {\r\n                            // the IPC queue will reject the request with the\r\n                            // cancellation error -> reset cached\r\n                            cached_1 = undefined;\r\n                        }\r\n                    });\r\n                    token.onCancellationRequested(function () {\r\n                        if (!_this.isResolved) {\r\n                            // cancellation after the request has been\r\n                            // dispatched -> reset cache\r\n                            cached_1 = undefined;\r\n                        }\r\n                    });\r\n                }\r\n                return cached_1;\r\n            };\r\n        }\r\n    }\r\n    return CompletionItem;\r\n}());\r\nexport { CompletionItem };\r\nvar CompletionOptions = /** @class */ (function () {\r\n    function CompletionOptions(snippetSortOrder, kindFilter, providerFilter) {\r\n        if (snippetSortOrder === void 0) { snippetSortOrder = 2 /* Bottom */; }\r\n        if (kindFilter === void 0) { kindFilter = new Set(); }\r\n        if (providerFilter === void 0) { providerFilter = new Set(); }\r\n        this.snippetSortOrder = snippetSortOrder;\r\n        this.kindFilter = kindFilter;\r\n        this.providerFilter = providerFilter;\r\n    }\r\n    CompletionOptions.default = new CompletionOptions();\r\n    return CompletionOptions;\r\n}());\r\nexport { CompletionOptions };\r\nvar _snippetSuggestSupport;\r\nexport function getSnippetSuggestSupport() {\r\n    return _snippetSuggestSupport;\r\n}\r\nexport function provideSuggestionItems(model, position, options, context, token) {\r\n    if (options === void 0) { options = CompletionOptions.default; }\r\n    if (context === void 0) { context = { triggerKind: 0 /* Invoke */ }; }\r\n    if (token === void 0) { token = CancellationToken.None; }\r\n    var word = model.getWordAtPosition(position);\r\n    var defaultReplaceRange = word ? new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn) : Range.fromPositions(position);\r\n    var defaultInsertRange = defaultReplaceRange.setEndPosition(position.lineNumber, position.column);\r\n    // const wordUntil = model.getWordUntilPosition(position);\r\n    // const defaultRange = new Range(position.lineNumber, wordUntil.startColumn, position.lineNumber, wordUntil.endColumn);\r\n    position = position.clone();\r\n    // get provider groups, always add snippet suggestion provider\r\n    var supports = modes.CompletionProviderRegistry.orderedGroups(model);\r\n    // add snippets provider unless turned off\r\n    if (!options.kindFilter.has(25 /* Snippet */) && _snippetSuggestSupport) {\r\n        supports.unshift([_snippetSuggestSupport]);\r\n    }\r\n    var allSuggestions = [];\r\n    var disposables = new DisposableStore();\r\n    var hasResult = false;\r\n    // add suggestions from contributed providers - providers are ordered in groups of\r\n    // equal score and once a group produces a result the process stops\r\n    var factory = supports.map(function (supports) { return function () {\r\n        // for each support in the group ask for suggestions\r\n        return Promise.all(supports.map(function (provider) {\r\n            if (options.providerFilter.size > 0 && !options.providerFilter.has(provider)) {\r\n                return undefined;\r\n            }\r\n            return Promise.resolve(provider.provideCompletionItems(model, position, context, token)).then(function (container) {\r\n                var len = allSuggestions.length;\r\n                if (container) {\r\n                    for (var _i = 0, _a = container.suggestions || []; _i < _a.length; _i++) {\r\n                        var suggestion = _a[_i];\r\n                        if (!options.kindFilter.has(suggestion.kind)) {\r\n                            // fill in default range when missing\r\n                            if (!suggestion.range) {\r\n                                suggestion.range = { insert: defaultInsertRange, replace: defaultReplaceRange };\r\n                            }\r\n                            // fill in default sortText when missing\r\n                            if (!suggestion.sortText) {\r\n                                suggestion.sortText = typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.name;\r\n                            }\r\n                            allSuggestions.push(new CompletionItem(position, suggestion, container, provider, model));\r\n                        }\r\n                    }\r\n                    if (isDisposable(container)) {\r\n                        disposables.add(container);\r\n                    }\r\n                }\r\n                if (len !== allSuggestions.length && provider !== _snippetSuggestSupport) {\r\n                    hasResult = true;\r\n                }\r\n            }, onUnexpectedExternalError);\r\n        }));\r\n    }; });\r\n    var result = first(factory, function () {\r\n        // stop on result or cancellation\r\n        return hasResult || token.isCancellationRequested;\r\n    }).then(function () {\r\n        if (token.isCancellationRequested) {\r\n            disposables.dispose();\r\n            return Promise.reject(canceled());\r\n        }\r\n        return allSuggestions.sort(getSuggestionComparator(options.snippetSortOrder));\r\n    });\r\n    // result.then(items => {\r\n    // \tconsole.log(model.getWordUntilPosition(position), items.map(item => `${item.suggestion.label}, type=${item.suggestion.type}, incomplete?${item.container.incomplete}, overwriteBefore=${item.suggestion.overwriteBefore}`));\r\n    // \treturn items;\r\n    // }, err => {\r\n    // \tconsole.warn(model.getWordUntilPosition(position), err);\r\n    // });\r\n    return result;\r\n}\r\nfunction defaultComparator(a, b) {\r\n    // check with 'sortText'\r\n    if (a.sortTextLow && b.sortTextLow) {\r\n        if (a.sortTextLow < b.sortTextLow) {\r\n            return -1;\r\n        }\r\n        else if (a.sortTextLow > b.sortTextLow) {\r\n            return 1;\r\n        }\r\n    }\r\n    // check with 'label'\r\n    if (a.completion.label < b.completion.label) {\r\n        return -1;\r\n    }\r\n    else if (a.completion.label > b.completion.label) {\r\n        return 1;\r\n    }\r\n    // check with 'type'\r\n    return a.completion.kind - b.completion.kind;\r\n}\r\nfunction snippetUpComparator(a, b) {\r\n    if (a.completion.kind !== b.completion.kind) {\r\n        if (a.completion.kind === 25 /* Snippet */) {\r\n            return -1;\r\n        }\r\n        else if (b.completion.kind === 25 /* Snippet */) {\r\n            return 1;\r\n        }\r\n    }\r\n    return defaultComparator(a, b);\r\n}\r\nfunction snippetDownComparator(a, b) {\r\n    if (a.completion.kind !== b.completion.kind) {\r\n        if (a.completion.kind === 25 /* Snippet */) {\r\n            return 1;\r\n        }\r\n        else if (b.completion.kind === 25 /* Snippet */) {\r\n            return -1;\r\n        }\r\n    }\r\n    return defaultComparator(a, b);\r\n}\r\nvar _snippetComparators = new Map();\r\n_snippetComparators.set(0 /* Top */, snippetUpComparator);\r\n_snippetComparators.set(2 /* Bottom */, snippetDownComparator);\r\n_snippetComparators.set(1 /* Inline */, defaultComparator);\r\nexport function getSuggestionComparator(snippetConfig) {\r\n    return _snippetComparators.get(snippetConfig);\r\n}\r\nregisterDefaultLanguageCommand('_executeCompletionItemProvider', function (model, position, args) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var result, disposables, resolving, maxItemsToResolve, items, _i, items_1, item;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                result = {\r\n                    incomplete: false,\r\n                    suggestions: []\r\n                };\r\n                disposables = new DisposableStore();\r\n                resolving = [];\r\n                maxItemsToResolve = args['maxItemsToResolve'] || 0;\r\n                return [4 /*yield*/, provideSuggestionItems(model, position)];\r\n            case 1:\r\n                items = _a.sent();\r\n                for (_i = 0, items_1 = items; _i < items_1.length; _i++) {\r\n                    item = items_1[_i];\r\n                    if (resolving.length < maxItemsToResolve) {\r\n                        resolving.push(item.resolve(CancellationToken.None));\r\n                    }\r\n                    result.incomplete = result.incomplete || item.container.incomplete;\r\n                    result.suggestions.push(item.completion);\r\n                    if (isDisposable(item.container)) {\r\n                        disposables.add(item.container);\r\n                    }\r\n                }\r\n                _a.label = 2;\r\n            case 2:\r\n                _a.trys.push([2, , 4, 5]);\r\n                return [4 /*yield*/, Promise.all(resolving)];\r\n            case 3:\r\n                _a.sent();\r\n                return [2 /*return*/, result];\r\n            case 4:\r\n                setTimeout(function () { return disposables.dispose(); }, 100);\r\n                return [7 /*endfinally*/];\r\n            case 5: return [2 /*return*/];\r\n        }\r\n    });\r\n}); });\r\nvar _provider = new /** @class */ (function () {\r\n    function class_1() {\r\n        this.onlyOnceSuggestions = [];\r\n    }\r\n    class_1.prototype.provideCompletionItems = function () {\r\n        var suggestions = this.onlyOnceSuggestions.slice(0);\r\n        var result = { suggestions: suggestions };\r\n        this.onlyOnceSuggestions.length = 0;\r\n        return result;\r\n    };\r\n    return class_1;\r\n}());\r\nmodes.CompletionProviderRegistry.register('*', _provider);\r\nexport function showSimpleSuggestions(editor, suggestions) {\r\n    setTimeout(function () {\r\n        var _a;\r\n        (_a = _provider.onlyOnceSuggestions).push.apply(_a, suggestions);\r\n        editor.getContribution('editor.contrib.suggestController').triggerSuggest(new Set().add(_provider));\r\n    }, 0);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}