{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport './findWidget.css';\nimport * as nls from '../../../nls.js';\nimport * as dom from '../../../base/browser/dom.js';\nimport { alert as alertFn } from '../../../base/browser/ui/aria/aria.js';\nimport { Checkbox } from '../../../base/browser/ui/checkbox/checkbox.js';\nimport { Sash } from '../../../base/browser/ui/sash/sash.js';\nimport { Widget } from '../../../base/browser/ui/widget.js';\nimport { Delayer } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { toDisposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport * as strings from '../../../base/common/strings.js';\nimport { Range } from '../../common/core/range.js';\nimport { CONTEXT_FIND_INPUT_FOCUSED, CONTEXT_REPLACE_INPUT_FOCUSED, FIND_IDS, MATCHES_LIMIT } from './findModel.js';\nimport { contrastBorder, editorFindMatch, editorFindMatchBorder, editorFindMatchHighlight, editorFindMatchHighlightBorder, editorFindRangeHighlight, editorFindRangeHighlightBorder, editorWidgetBackground, editorWidgetBorder, editorWidgetResizeBorder, errorForeground, inputActiveOptionBorder, inputActiveOptionBackground, inputBackground, inputBorder, inputForeground, inputValidationErrorBackground, inputValidationErrorBorder, inputValidationErrorForeground, inputValidationInfoBackground, inputValidationInfoBorder, inputValidationInfoForeground, inputValidationWarningBackground, inputValidationWarningBorder, inputValidationWarningForeground, widgetShadow, editorWidgetForeground, focusBorder } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { ContextScopedFindInput, ContextScopedReplaceInput } from '../../../platform/browser/contextScopedHistoryWidget.js';\nvar NLS_FIND_INPUT_LABEL = nls.localize('label.find', \"Find\");\nvar NLS_FIND_INPUT_PLACEHOLDER = nls.localize('placeholder.find', \"Find\");\nvar NLS_PREVIOUS_MATCH_BTN_LABEL = nls.localize('label.previousMatchButton', \"Previous match\");\nvar NLS_NEXT_MATCH_BTN_LABEL = nls.localize('label.nextMatchButton', \"Next match\");\nvar NLS_TOGGLE_SELECTION_FIND_TITLE = nls.localize('label.toggleSelectionFind', \"Find in selection\");\nvar NLS_CLOSE_BTN_LABEL = nls.localize('label.closeButton', \"Close\");\nvar NLS_REPLACE_INPUT_LABEL = nls.localize('label.replace', \"Replace\");\nvar NLS_REPLACE_INPUT_PLACEHOLDER = nls.localize('placeholder.replace', \"Replace\");\nvar NLS_REPLACE_BTN_LABEL = nls.localize('label.replaceButton', \"Replace\");\nvar NLS_REPLACE_ALL_BTN_LABEL = nls.localize('label.replaceAllButton', \"Replace All\");\nvar NLS_TOGGLE_REPLACE_MODE_BTN_LABEL = nls.localize('label.toggleReplaceButton', \"Toggle Replace mode\");\nvar NLS_MATCHES_COUNT_LIMIT_TITLE = nls.localize('title.matchesCountLimit', \"Only the first {0} results are highlighted, but all find operations work on the entire text.\", MATCHES_LIMIT);\nvar NLS_MATCHES_LOCATION = nls.localize('label.matchesLocation', \"{0} of {1}\");\nvar NLS_NO_RESULTS = nls.localize('label.noResults', \"No Results\");\nvar FIND_WIDGET_INITIAL_WIDTH = 419;\nvar PART_WIDTH = 275;\nvar FIND_INPUT_AREA_WIDTH = PART_WIDTH - 54;\nvar MAX_MATCHES_COUNT_WIDTH = 69; // let FIND_ALL_CONTROLS_WIDTH = 17/** Find Input margin-left */ + (MAX_MATCHES_COUNT_WIDTH + 3 + 1) /** Match Results */ + 23 /** Button */ * 4 + 2/** sash */;\n\nvar FIND_INPUT_AREA_HEIGHT = 33; // The height of Find Widget when Replace Input is not visible.\n\nvar ctrlEnterReplaceAllWarningPromptedKey = 'ctrlEnterReplaceAll.windows.donotask';\nvar ctrlKeyMod = platform.isMacintosh ? 256\n/* WinCtrl */\n: 2048\n/* CtrlCmd */\n;\n\nvar FindWidgetViewZone =\n/** @class */\nfunction () {\n  function FindWidgetViewZone(afterLineNumber) {\n    this.afterLineNumber = afterLineNumber;\n    this.heightInPx = FIND_INPUT_AREA_HEIGHT;\n    this.suppressMouseDown = false;\n    this.domNode = document.createElement('div');\n    this.domNode.className = 'dock-find-viewzone';\n  }\n\n  return FindWidgetViewZone;\n}();\n\nexport { FindWidgetViewZone };\n\nfunction stopPropagationForMultiLineUpwards(event, value, textarea) {\n  var isMultiline = !!value.match(/\\n/);\n\n  if (textarea && isMultiline && textarea.selectionStart > 0) {\n    event.stopPropagation();\n    return;\n  }\n}\n\nfunction stopPropagationForMultiLineDownwards(event, value, textarea) {\n  var isMultiline = !!value.match(/\\n/);\n\n  if (textarea && isMultiline && textarea.selectionEnd < textarea.value.length) {\n    event.stopPropagation();\n    return;\n  }\n}\n\nvar FindWidget =\n/** @class */\nfunction (_super) {\n  __extends(FindWidget, _super);\n\n  function FindWidget(codeEditor, controller, state, contextViewProvider, keybindingService, contextKeyService, themeService, storageService, notificationService) {\n    var _this = _super.call(this) || this;\n\n    _this._cachedHeight = null;\n    _this._codeEditor = codeEditor;\n    _this._controller = controller;\n    _this._state = state;\n    _this._contextViewProvider = contextViewProvider;\n    _this._keybindingService = keybindingService;\n    _this._contextKeyService = contextKeyService;\n    _this._storageService = storageService;\n    _this._notificationService = notificationService;\n    _this._ctrlEnterReplaceAllWarningPrompted = !!storageService.getBoolean(ctrlEnterReplaceAllWarningPromptedKey, 0\n    /* GLOBAL */\n    );\n    _this._isVisible = false;\n    _this._isReplaceVisible = false;\n    _this._ignoreChangeEvent = false;\n    _this._updateHistoryDelayer = new Delayer(500);\n\n    _this._register(toDisposable(function () {\n      return _this._updateHistoryDelayer.cancel();\n    }));\n\n    _this._register(_this._state.onFindReplaceStateChange(function (e) {\n      return _this._onStateChanged(e);\n    }));\n\n    _this._buildDomNode();\n\n    _this._updateButtons();\n\n    _this._tryUpdateWidgetWidth();\n\n    _this._findInput.inputBox.layout();\n\n    _this._register(_this._codeEditor.onDidChangeConfiguration(function (e) {\n      if (e.hasChanged(68\n      /* readOnly */\n      )) {\n        if (_this._codeEditor.getOption(68\n        /* readOnly */\n        )) {\n          // Hide replace part if editor becomes read only\n          _this._state.change({\n            isReplaceRevealed: false\n          }, false);\n        }\n\n        _this._updateButtons();\n      }\n\n      if (e.hasChanged(107\n      /* layoutInfo */\n      )) {\n        _this._tryUpdateWidgetWidth();\n      }\n\n      if (e.hasChanged(2\n      /* accessibilitySupport */\n      )) {\n        _this.updateAccessibilitySupport();\n      }\n\n      if (e.hasChanged(28\n      /* find */\n      )) {\n        var addExtraSpaceOnTop = _this._codeEditor.getOption(28\n        /* find */\n        ).addExtraSpaceOnTop;\n\n        if (addExtraSpaceOnTop && !_this._viewZone) {\n          _this._viewZone = new FindWidgetViewZone(0);\n\n          _this._showViewZone();\n        }\n\n        if (!addExtraSpaceOnTop && _this._viewZone) {\n          _this._removeViewZone();\n        }\n      }\n    }));\n\n    _this.updateAccessibilitySupport();\n\n    _this._register(_this._codeEditor.onDidChangeCursorSelection(function () {\n      if (_this._isVisible) {\n        _this._updateToggleSelectionFindButton();\n      }\n    }));\n\n    _this._register(_this._codeEditor.onDidFocusEditorWidget(function () {\n      if (_this._isVisible) {\n        var globalBufferTerm = _this._controller.getGlobalBufferTerm();\n\n        if (globalBufferTerm && globalBufferTerm !== _this._state.searchString) {\n          _this._state.change({\n            searchString: globalBufferTerm\n          }, true);\n\n          _this._findInput.select();\n        }\n      }\n    }));\n\n    _this._findInputFocused = CONTEXT_FIND_INPUT_FOCUSED.bindTo(contextKeyService);\n    _this._findFocusTracker = _this._register(dom.trackFocus(_this._findInput.inputBox.inputElement));\n\n    _this._register(_this._findFocusTracker.onDidFocus(function () {\n      _this._findInputFocused.set(true);\n\n      _this._updateSearchScope();\n    }));\n\n    _this._register(_this._findFocusTracker.onDidBlur(function () {\n      _this._findInputFocused.set(false);\n    }));\n\n    _this._replaceInputFocused = CONTEXT_REPLACE_INPUT_FOCUSED.bindTo(contextKeyService);\n    _this._replaceFocusTracker = _this._register(dom.trackFocus(_this._replaceInput.inputBox.inputElement));\n\n    _this._register(_this._replaceFocusTracker.onDidFocus(function () {\n      _this._replaceInputFocused.set(true);\n\n      _this._updateSearchScope();\n    }));\n\n    _this._register(_this._replaceFocusTracker.onDidBlur(function () {\n      _this._replaceInputFocused.set(false);\n    }));\n\n    _this._codeEditor.addOverlayWidget(_this);\n\n    if (_this._codeEditor.getOption(28\n    /* find */\n    ).addExtraSpaceOnTop) {\n      _this._viewZone = new FindWidgetViewZone(0); // Put it before the first line then users can scroll beyond the first line.\n    }\n\n    _this._applyTheme(themeService.getTheme());\n\n    _this._register(themeService.onThemeChange(_this._applyTheme.bind(_this)));\n\n    _this._register(_this._codeEditor.onDidChangeModel(function () {\n      if (!_this._isVisible) {\n        return;\n      }\n\n      _this._viewZoneId = undefined;\n    }));\n\n    _this._register(_this._codeEditor.onDidScrollChange(function (e) {\n      if (e.scrollTopChanged) {\n        _this._layoutViewZone();\n\n        return;\n      } // for other scroll changes, layout the viewzone in next tick to avoid ruining current rendering.\n\n\n      setTimeout(function () {\n        _this._layoutViewZone();\n      }, 0);\n    }));\n\n    return _this;\n  } // ----- IOverlayWidget API\n\n\n  FindWidget.prototype.getId = function () {\n    return FindWidget.ID;\n  };\n\n  FindWidget.prototype.getDomNode = function () {\n    return this._domNode;\n  };\n\n  FindWidget.prototype.getPosition = function () {\n    if (this._isVisible) {\n      return {\n        preference: 0\n        /* TOP_RIGHT_CORNER */\n\n      };\n    }\n\n    return null;\n  }; // ----- React to state changes\n\n\n  FindWidget.prototype._onStateChanged = function (e) {\n    if (e.searchString) {\n      try {\n        this._ignoreChangeEvent = true;\n\n        this._findInput.setValue(this._state.searchString);\n      } finally {\n        this._ignoreChangeEvent = false;\n      }\n\n      this._updateButtons();\n    }\n\n    if (e.replaceString) {\n      this._replaceInput.inputBox.value = this._state.replaceString;\n    }\n\n    if (e.isRevealed) {\n      if (this._state.isRevealed) {\n        this._reveal();\n      } else {\n        this._hide(true);\n      }\n    }\n\n    if (e.isReplaceRevealed) {\n      if (this._state.isReplaceRevealed) {\n        if (!this._codeEditor.getOption(68\n        /* readOnly */\n        ) && !this._isReplaceVisible) {\n          this._isReplaceVisible = true;\n          this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\n\n          this._updateButtons();\n\n          this._replaceInput.inputBox.layout();\n        }\n      } else {\n        if (this._isReplaceVisible) {\n          this._isReplaceVisible = false;\n\n          this._updateButtons();\n        }\n      }\n    }\n\n    if ((e.isRevealed || e.isReplaceRevealed) && (this._state.isRevealed || this._state.isReplaceRevealed)) {\n      if (this._tryUpdateHeight()) {\n        this._showViewZone();\n      }\n    }\n\n    if (e.isRegex) {\n      this._findInput.setRegex(this._state.isRegex);\n    }\n\n    if (e.wholeWord) {\n      this._findInput.setWholeWords(this._state.wholeWord);\n    }\n\n    if (e.matchCase) {\n      this._findInput.setCaseSensitive(this._state.matchCase);\n    }\n\n    if (e.searchScope) {\n      if (this._state.searchScope) {\n        this._toggleSelectionFind.checked = true;\n      } else {\n        this._toggleSelectionFind.checked = false;\n      }\n\n      this._updateToggleSelectionFindButton();\n    }\n\n    if (e.searchString || e.matchesCount || e.matchesPosition) {\n      var showRedOutline = this._state.searchString.length > 0 && this._state.matchesCount === 0;\n      dom.toggleClass(this._domNode, 'no-results', showRedOutline);\n\n      this._updateMatchesCount();\n\n      this._updateButtons();\n    }\n\n    if (e.searchString || e.currentMatch) {\n      this._layoutViewZone();\n    }\n\n    if (e.updateHistory) {\n      this._delayedUpdateHistory();\n    }\n  };\n\n  FindWidget.prototype._delayedUpdateHistory = function () {\n    this._updateHistoryDelayer.trigger(this._updateHistory.bind(this));\n  };\n\n  FindWidget.prototype._updateHistory = function () {\n    if (this._state.searchString) {\n      this._findInput.inputBox.addToHistory();\n    }\n\n    if (this._state.replaceString) {\n      this._replaceInput.inputBox.addToHistory();\n    }\n  };\n\n  FindWidget.prototype._updateMatchesCount = function () {\n    this._matchesCount.style.minWidth = MAX_MATCHES_COUNT_WIDTH + 'px';\n\n    if (this._state.matchesCount >= MATCHES_LIMIT) {\n      this._matchesCount.title = NLS_MATCHES_COUNT_LIMIT_TITLE;\n    } else {\n      this._matchesCount.title = '';\n    } // remove previous content\n\n\n    if (this._matchesCount.firstChild) {\n      this._matchesCount.removeChild(this._matchesCount.firstChild);\n    }\n\n    var label;\n\n    if (this._state.matchesCount > 0) {\n      var matchesCount = String(this._state.matchesCount);\n\n      if (this._state.matchesCount >= MATCHES_LIMIT) {\n        matchesCount += '+';\n      }\n\n      var matchesPosition = String(this._state.matchesPosition);\n\n      if (matchesPosition === '0') {\n        matchesPosition = '?';\n      }\n\n      label = strings.format(NLS_MATCHES_LOCATION, matchesPosition, matchesCount);\n    } else {\n      label = NLS_NO_RESULTS;\n    }\n\n    this._matchesCount.appendChild(document.createTextNode(label));\n\n    alertFn(this._getAriaLabel(label, this._state.currentMatch, this._state.searchString), true);\n    MAX_MATCHES_COUNT_WIDTH = Math.max(MAX_MATCHES_COUNT_WIDTH, this._matchesCount.clientWidth);\n  }; // ----- actions\n\n\n  FindWidget.prototype._getAriaLabel = function (label, currentMatch, searchString) {\n    if (label === NLS_NO_RESULTS) {\n      return searchString === '' ? nls.localize('ariaSearchNoResultEmpty', \"{0} found\", label) : nls.localize('ariaSearchNoResult', \"{0} found for {1}\", label, searchString);\n    }\n\n    return currentMatch ? nls.localize('ariaSearchNoResultWithLineNum', \"{0} found for {1} at {2}\", label, searchString, currentMatch.startLineNumber + ':' + currentMatch.startColumn) : nls.localize('ariaSearchNoResultWithLineNumNoCurrentMatch', \"{0} found for {1}\", label, searchString);\n  };\n  /**\r\n   * If 'selection find' is ON we should not disable the button (its function is to cancel 'selection find').\r\n   * If 'selection find' is OFF we enable the button only if there is a selection.\r\n   */\n\n\n  FindWidget.prototype._updateToggleSelectionFindButton = function () {\n    var selection = this._codeEditor.getSelection();\n\n    var isSelection = selection ? selection.startLineNumber !== selection.endLineNumber || selection.startColumn !== selection.endColumn : false;\n    var isChecked = this._toggleSelectionFind.checked;\n\n    if (this._isVisible && (isChecked || isSelection)) {\n      this._toggleSelectionFind.enable();\n    } else {\n      this._toggleSelectionFind.disable();\n    }\n  };\n\n  FindWidget.prototype._updateButtons = function () {\n    this._findInput.setEnabled(this._isVisible);\n\n    this._replaceInput.setEnabled(this._isVisible && this._isReplaceVisible);\n\n    this._updateToggleSelectionFindButton();\n\n    this._closeBtn.setEnabled(this._isVisible);\n\n    var findInputIsNonEmpty = this._state.searchString.length > 0;\n    var matchesCount = this._state.matchesCount ? true : false;\n\n    this._prevBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount);\n\n    this._nextBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount);\n\n    this._replaceBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);\n\n    this._replaceAllBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);\n\n    dom.toggleClass(this._domNode, 'replaceToggled', this._isReplaceVisible);\n\n    this._toggleReplaceBtn.toggleClass('codicon-chevron-right', !this._isReplaceVisible);\n\n    this._toggleReplaceBtn.toggleClass('codicon-chevron-down', this._isReplaceVisible);\n\n    this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);\n\n    var canReplace = !this._codeEditor.getOption(68\n    /* readOnly */\n    );\n\n    this._toggleReplaceBtn.setEnabled(this._isVisible && canReplace);\n  };\n\n  FindWidget.prototype._reveal = function () {\n    var _this = this;\n\n    if (!this._isVisible) {\n      this._isVisible = true;\n\n      var selection = this._codeEditor.getSelection();\n\n      switch (this._codeEditor.getOption(28\n      /* find */\n      ).autoFindInSelection) {\n        case 'always':\n          this._toggleSelectionFind.checked = true;\n          break;\n\n        case 'never':\n          this._toggleSelectionFind.checked = false;\n          break;\n\n        case 'multiline':\n          var isSelectionMultipleLine = !!selection && selection.startLineNumber !== selection.endLineNumber;\n          this._toggleSelectionFind.checked = isSelectionMultipleLine;\n          break;\n\n        default:\n          break;\n      }\n\n      this._tryUpdateWidgetWidth();\n\n      this._updateButtons();\n\n      setTimeout(function () {\n        dom.addClass(_this._domNode, 'visible');\n\n        _this._domNode.setAttribute('aria-hidden', 'false');\n      }, 0); // validate query again as it's being dismissed when we hide the find widget.\n\n      setTimeout(function () {\n        _this._findInput.validate();\n      }, 200);\n\n      this._codeEditor.layoutOverlayWidget(this);\n\n      var adjustEditorScrollTop = true;\n\n      if (this._codeEditor.getOption(28\n      /* find */\n      ).seedSearchStringFromSelection && selection) {\n        var domNode = this._codeEditor.getDomNode();\n\n        if (domNode) {\n          var editorCoords = dom.getDomNodePagePosition(domNode);\n\n          var startCoords = this._codeEditor.getScrolledVisiblePosition(selection.getStartPosition());\n\n          var startLeft = editorCoords.left + (startCoords ? startCoords.left : 0);\n          var startTop = startCoords ? startCoords.top : 0;\n\n          if (this._viewZone && startTop < this._viewZone.heightInPx) {\n            if (selection.endLineNumber > selection.startLineNumber) {\n              adjustEditorScrollTop = false;\n            }\n\n            var leftOfFindWidget = dom.getTopLeftOffset(this._domNode).left;\n\n            if (startLeft > leftOfFindWidget) {\n              adjustEditorScrollTop = false;\n            }\n\n            var endCoords = this._codeEditor.getScrolledVisiblePosition(selection.getEndPosition());\n\n            var endLeft = editorCoords.left + (endCoords ? endCoords.left : 0);\n\n            if (endLeft > leftOfFindWidget) {\n              adjustEditorScrollTop = false;\n            }\n          }\n        }\n      }\n\n      this._showViewZone(adjustEditorScrollTop);\n    }\n  };\n\n  FindWidget.prototype._hide = function (focusTheEditor) {\n    if (this._isVisible) {\n      this._isVisible = false;\n\n      this._updateButtons();\n\n      dom.removeClass(this._domNode, 'visible');\n\n      this._domNode.setAttribute('aria-hidden', 'true');\n\n      this._findInput.clearMessage();\n\n      if (focusTheEditor) {\n        this._codeEditor.focus();\n      }\n\n      this._codeEditor.layoutOverlayWidget(this);\n\n      this._removeViewZone();\n    }\n  };\n\n  FindWidget.prototype._layoutViewZone = function () {\n    var _this = this;\n\n    var addExtraSpaceOnTop = this._codeEditor.getOption(28\n    /* find */\n    ).addExtraSpaceOnTop;\n\n    if (!addExtraSpaceOnTop) {\n      this._removeViewZone();\n\n      return;\n    }\n\n    if (!this._isVisible) {\n      return;\n    }\n\n    var viewZone = this._viewZone;\n\n    if (this._viewZoneId !== undefined || !viewZone) {\n      return;\n    }\n\n    this._codeEditor.changeViewZones(function (accessor) {\n      viewZone.heightInPx = _this._getHeight();\n      _this._viewZoneId = accessor.addZone(viewZone); // scroll top adjust to make sure the editor doesn't scroll when adding viewzone at the beginning.\n\n      _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + viewZone.heightInPx);\n    });\n  };\n\n  FindWidget.prototype._showViewZone = function (adjustScroll) {\n    var _this = this;\n\n    if (adjustScroll === void 0) {\n      adjustScroll = true;\n    }\n\n    if (!this._isVisible) {\n      return;\n    }\n\n    var addExtraSpaceOnTop = this._codeEditor.getOption(28\n    /* find */\n    ).addExtraSpaceOnTop;\n\n    if (!addExtraSpaceOnTop) {\n      return;\n    }\n\n    if (this._viewZone === undefined) {\n      this._viewZone = new FindWidgetViewZone(0);\n    }\n\n    var viewZone = this._viewZone;\n\n    this._codeEditor.changeViewZones(function (accessor) {\n      if (_this._viewZoneId !== undefined) {\n        // the view zone already exists, we need to update the height\n        var newHeight = _this._getHeight();\n\n        if (newHeight === viewZone.heightInPx) {\n          return;\n        }\n\n        var scrollAdjustment = newHeight - viewZone.heightInPx;\n        viewZone.heightInPx = newHeight;\n        accessor.layoutZone(_this._viewZoneId);\n\n        if (adjustScroll) {\n          _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + scrollAdjustment);\n        }\n\n        return;\n      } else {\n        var scrollAdjustment = _this._getHeight();\n\n        viewZone.heightInPx = scrollAdjustment;\n        _this._viewZoneId = accessor.addZone(viewZone);\n\n        if (adjustScroll) {\n          _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + scrollAdjustment);\n        }\n      }\n    });\n  };\n\n  FindWidget.prototype._removeViewZone = function () {\n    var _this = this;\n\n    this._codeEditor.changeViewZones(function (accessor) {\n      if (_this._viewZoneId !== undefined) {\n        accessor.removeZone(_this._viewZoneId);\n        _this._viewZoneId = undefined;\n\n        if (_this._viewZone) {\n          _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() - _this._viewZone.heightInPx);\n\n          _this._viewZone = undefined;\n        }\n      }\n    });\n  };\n\n  FindWidget.prototype._applyTheme = function (theme) {\n    var inputStyles = {\n      inputActiveOptionBorder: theme.getColor(inputActiveOptionBorder),\n      inputActiveOptionBackground: theme.getColor(inputActiveOptionBackground),\n      inputBackground: theme.getColor(inputBackground),\n      inputForeground: theme.getColor(inputForeground),\n      inputBorder: theme.getColor(inputBorder),\n      inputValidationInfoBackground: theme.getColor(inputValidationInfoBackground),\n      inputValidationInfoForeground: theme.getColor(inputValidationInfoForeground),\n      inputValidationInfoBorder: theme.getColor(inputValidationInfoBorder),\n      inputValidationWarningBackground: theme.getColor(inputValidationWarningBackground),\n      inputValidationWarningForeground: theme.getColor(inputValidationWarningForeground),\n      inputValidationWarningBorder: theme.getColor(inputValidationWarningBorder),\n      inputValidationErrorBackground: theme.getColor(inputValidationErrorBackground),\n      inputValidationErrorForeground: theme.getColor(inputValidationErrorForeground),\n      inputValidationErrorBorder: theme.getColor(inputValidationErrorBorder)\n    };\n\n    this._findInput.style(inputStyles);\n\n    this._replaceInput.style(inputStyles);\n\n    this._toggleSelectionFind.style(inputStyles);\n  };\n\n  FindWidget.prototype._tryUpdateWidgetWidth = function () {\n    if (!this._isVisible) {\n      return;\n    }\n\n    if (!dom.isInDOM(this._domNode)) {\n      // the widget is not in the DOM\n      return;\n    }\n\n    var layoutInfo = this._codeEditor.getLayoutInfo();\n\n    var editorContentWidth = layoutInfo.contentWidth;\n\n    if (editorContentWidth <= 0) {\n      // for example, diff view original editor\n      dom.addClass(this._domNode, 'hiddenEditor');\n      return;\n    } else if (dom.hasClass(this._domNode, 'hiddenEditor')) {\n      dom.removeClass(this._domNode, 'hiddenEditor');\n    }\n\n    var editorWidth = layoutInfo.width;\n    var minimapWidth = layoutInfo.minimapWidth;\n    var collapsedFindWidget = false;\n    var reducedFindWidget = false;\n    var narrowFindWidget = false;\n\n    if (this._resized) {\n      var widgetWidth = dom.getTotalWidth(this._domNode);\n\n      if (widgetWidth > FIND_WIDGET_INITIAL_WIDTH) {\n        // as the widget is resized by users, we may need to change the max width of the widget as the editor width changes.\n        this._domNode.style.maxWidth = editorWidth - 28 - minimapWidth - 15 + \"px\";\n        this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\n        return;\n      }\n    }\n\n    if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth >= editorWidth) {\n      reducedFindWidget = true;\n    }\n\n    if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - MAX_MATCHES_COUNT_WIDTH >= editorWidth) {\n      narrowFindWidget = true;\n    }\n\n    if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - MAX_MATCHES_COUNT_WIDTH >= editorWidth + 50) {\n      collapsedFindWidget = true;\n    }\n\n    dom.toggleClass(this._domNode, 'collapsed-find-widget', collapsedFindWidget);\n    dom.toggleClass(this._domNode, 'narrow-find-widget', narrowFindWidget);\n    dom.toggleClass(this._domNode, 'reduced-find-widget', reducedFindWidget);\n\n    if (!narrowFindWidget && !collapsedFindWidget) {\n      // the minimal left offset of findwidget is 15px.\n      this._domNode.style.maxWidth = editorWidth - 28 - minimapWidth - 15 + \"px\";\n    }\n\n    if (this._resized) {\n      this._findInput.inputBox.layout();\n\n      var findInputWidth = this._findInput.inputBox.element.clientWidth;\n\n      if (findInputWidth > 0) {\n        this._replaceInput.width = findInputWidth;\n      }\n    } else if (this._isReplaceVisible) {\n      this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\n    }\n  };\n\n  FindWidget.prototype._getHeight = function () {\n    var totalheight = 0; // find input margin top\n\n    totalheight += 4; // find input height\n\n    totalheight += this._findInput.inputBox.height + 2\n    /** input box border */\n    ;\n\n    if (this._isReplaceVisible) {\n      // replace input margin\n      totalheight += 4;\n      totalheight += this._replaceInput.inputBox.height + 2\n      /** input box border */\n      ;\n    } // margin bottom\n\n\n    totalheight += 4;\n    return totalheight;\n  };\n\n  FindWidget.prototype._tryUpdateHeight = function () {\n    var totalHeight = this._getHeight();\n\n    if (this._cachedHeight !== null && this._cachedHeight === totalHeight) {\n      return false;\n    }\n\n    this._cachedHeight = totalHeight;\n    this._domNode.style.height = totalHeight + \"px\";\n    return true;\n  }; // ----- Public\n\n\n  FindWidget.prototype.focusFindInput = function () {\n    this._findInput.select(); // Edge browser requires focus() in addition to select()\n\n\n    this._findInput.focus();\n  };\n\n  FindWidget.prototype.focusReplaceInput = function () {\n    this._replaceInput.select(); // Edge browser requires focus() in addition to select()\n\n\n    this._replaceInput.focus();\n  };\n\n  FindWidget.prototype.highlightFindOptions = function () {\n    this._findInput.highlightFindOptions();\n  };\n\n  FindWidget.prototype._updateSearchScope = function () {\n    if (!this._codeEditor.hasModel()) {\n      return;\n    }\n\n    if (this._toggleSelectionFind.checked) {\n      var selection = this._codeEditor.getSelection();\n\n      if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) {\n        selection = selection.setEndPosition(selection.endLineNumber - 1, this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));\n      }\n\n      var currentMatch = this._state.currentMatch;\n\n      if (selection.startLineNumber !== selection.endLineNumber) {\n        if (!Range.equalsRange(selection, currentMatch)) {\n          // Reseed find scope\n          this._state.change({\n            searchScope: selection\n          }, true);\n        }\n      }\n    }\n  };\n\n  FindWidget.prototype._onFindInputMouseDown = function (e) {\n    // on linux, middle key does pasting.\n    if (e.middleButton) {\n      e.stopPropagation();\n    }\n  };\n\n  FindWidget.prototype._onFindInputKeyDown = function (e) {\n    if (e.equals(ctrlKeyMod | 3\n    /* Enter */\n    )) {\n      this._findInput.inputBox.insertAtCursor('\\n');\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(2\n    /* Tab */\n    )) {\n      if (this._isReplaceVisible) {\n        this._replaceInput.focus();\n      } else {\n        this._findInput.focusOnCaseSensitive();\n      }\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(2048\n    /* CtrlCmd */\n    | 18\n    /* DownArrow */\n    )) {\n      this._codeEditor.focus();\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(16\n    /* UpArrow */\n    )) {\n      return stopPropagationForMultiLineUpwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));\n    }\n\n    if (e.equals(18\n    /* DownArrow */\n    )) {\n      return stopPropagationForMultiLineDownwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));\n    }\n  };\n\n  FindWidget.prototype._onReplaceInputKeyDown = function (e) {\n    if (e.equals(ctrlKeyMod | 3\n    /* Enter */\n    )) {\n      if (platform.isWindows && platform.isNative && !this._ctrlEnterReplaceAllWarningPrompted) {\n        // this is the first time when users press Ctrl + Enter to replace all\n        this._notificationService.info(nls.localize('ctrlEnter.keybindingChanged', 'Ctrl+Enter now inserts line break instead of replacing all. You can modify the keybinding for editor.action.replaceAll to override this behavior.'));\n\n        this._ctrlEnterReplaceAllWarningPrompted = true;\n\n        this._storageService.store(ctrlEnterReplaceAllWarningPromptedKey, true, 0\n        /* GLOBAL */\n        );\n      }\n\n      this._replaceInput.inputBox.insertAtCursor('\\n');\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(2\n    /* Tab */\n    )) {\n      this._findInput.focusOnCaseSensitive();\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(1024\n    /* Shift */\n    | 2\n    /* Tab */\n    )) {\n      this._findInput.focus();\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(2048\n    /* CtrlCmd */\n    | 18\n    /* DownArrow */\n    )) {\n      this._codeEditor.focus();\n\n      e.preventDefault();\n      return;\n    }\n\n    if (e.equals(16\n    /* UpArrow */\n    )) {\n      return stopPropagationForMultiLineUpwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));\n    }\n\n    if (e.equals(18\n    /* DownArrow */\n    )) {\n      return stopPropagationForMultiLineDownwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));\n    }\n  }; // ----- sash\n\n\n  FindWidget.prototype.getHorizontalSashTop = function (_sash) {\n    return 0;\n  };\n\n  FindWidget.prototype.getHorizontalSashLeft = function (_sash) {\n    return 0;\n  };\n\n  FindWidget.prototype.getHorizontalSashWidth = function (_sash) {\n    return 500;\n  }; // ----- initialization\n\n\n  FindWidget.prototype._keybindingLabelFor = function (actionId) {\n    var kb = this._keybindingService.lookupKeybinding(actionId);\n\n    if (!kb) {\n      return '';\n    }\n\n    return \" (\" + kb.getLabel() + \")\";\n  };\n\n  FindWidget.prototype._buildDomNode = function () {\n    var _this = this;\n\n    var flexibleHeight = true;\n    var flexibleWidth = true; // Find input\n\n    this._findInput = this._register(new ContextScopedFindInput(null, this._contextViewProvider, {\n      width: FIND_INPUT_AREA_WIDTH,\n      label: NLS_FIND_INPUT_LABEL,\n      placeholder: NLS_FIND_INPUT_PLACEHOLDER,\n      appendCaseSensitiveLabel: this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),\n      appendWholeWordsLabel: this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),\n      appendRegexLabel: this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),\n      validation: function (value) {\n        if (value.length === 0 || !_this._findInput.getRegex()) {\n          return null;\n        }\n\n        try {\n          new RegExp(value);\n          return null;\n        } catch (e) {\n          return {\n            content: e.message\n          };\n        }\n      },\n      flexibleHeight: flexibleHeight,\n      flexibleWidth: flexibleWidth,\n      flexibleMaxHeight: 118\n    }, this._contextKeyService, true));\n\n    this._findInput.setRegex(!!this._state.isRegex);\n\n    this._findInput.setCaseSensitive(!!this._state.matchCase);\n\n    this._findInput.setWholeWords(!!this._state.wholeWord);\n\n    this._register(this._findInput.onKeyDown(function (e) {\n      return _this._onFindInputKeyDown(e);\n    }));\n\n    this._register(this._findInput.inputBox.onDidChange(function () {\n      if (_this._ignoreChangeEvent) {\n        return;\n      }\n\n      _this._state.change({\n        searchString: _this._findInput.getValue()\n      }, true);\n    }));\n\n    this._register(this._findInput.onDidOptionChange(function () {\n      _this._state.change({\n        isRegex: _this._findInput.getRegex(),\n        wholeWord: _this._findInput.getWholeWords(),\n        matchCase: _this._findInput.getCaseSensitive()\n      }, true);\n    }));\n\n    this._register(this._findInput.onCaseSensitiveKeyDown(function (e) {\n      if (e.equals(1024\n      /* Shift */\n      | 2\n      /* Tab */\n      )) {\n        if (_this._isReplaceVisible) {\n          _this._replaceInput.focus();\n\n          e.preventDefault();\n        }\n      }\n    }));\n\n    this._register(this._findInput.onRegexKeyDown(function (e) {\n      if (e.equals(2\n      /* Tab */\n      )) {\n        if (_this._isReplaceVisible) {\n          _this._replaceInput.focusOnPreserve();\n\n          e.preventDefault();\n        }\n      }\n    }));\n\n    this._register(this._findInput.inputBox.onDidHeightChange(function (e) {\n      if (_this._tryUpdateHeight()) {\n        _this._showViewZone();\n      }\n    }));\n\n    if (platform.isLinux) {\n      this._register(this._findInput.onMouseDown(function (e) {\n        return _this._onFindInputMouseDown(e);\n      }));\n    }\n\n    this._matchesCount = document.createElement('div');\n    this._matchesCount.className = 'matchesCount';\n\n    this._updateMatchesCount(); // Previous button\n\n\n    this._prevBtn = this._register(new SimpleButton({\n      label: NLS_PREVIOUS_MATCH_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.PreviousMatchFindAction),\n      className: 'codicon codicon-arrow-up',\n      onTrigger: function () {\n        _this._codeEditor.getAction(FIND_IDS.PreviousMatchFindAction).run().then(undefined, onUnexpectedError);\n      }\n    })); // Next button\n\n    this._nextBtn = this._register(new SimpleButton({\n      label: NLS_NEXT_MATCH_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.NextMatchFindAction),\n      className: 'codicon codicon-arrow-down',\n      onTrigger: function () {\n        _this._codeEditor.getAction(FIND_IDS.NextMatchFindAction).run().then(undefined, onUnexpectedError);\n      }\n    }));\n    var findPart = document.createElement('div');\n    findPart.className = 'find-part';\n    findPart.appendChild(this._findInput.domNode);\n    var actionsContainer = document.createElement('div');\n    actionsContainer.className = 'find-actions';\n    findPart.appendChild(actionsContainer);\n    actionsContainer.appendChild(this._matchesCount);\n    actionsContainer.appendChild(this._prevBtn.domNode);\n    actionsContainer.appendChild(this._nextBtn.domNode); // Toggle selection button\n\n    this._toggleSelectionFind = this._register(new Checkbox({\n      actionClassName: 'codicon codicon-selection',\n      title: NLS_TOGGLE_SELECTION_FIND_TITLE + this._keybindingLabelFor(FIND_IDS.ToggleSearchScopeCommand),\n      isChecked: false\n    }));\n\n    this._register(this._toggleSelectionFind.onChange(function () {\n      if (_this._toggleSelectionFind.checked) {\n        if (_this._codeEditor.hasModel()) {\n          var selection = _this._codeEditor.getSelection();\n\n          if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) {\n            selection = selection.setEndPosition(selection.endLineNumber - 1, _this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));\n          }\n\n          if (!selection.isEmpty()) {\n            _this._state.change({\n              searchScope: selection\n            }, true);\n          }\n        }\n      } else {\n        _this._state.change({\n          searchScope: null\n        }, true);\n      }\n    }));\n\n    actionsContainer.appendChild(this._toggleSelectionFind.domNode); // Close button\n\n    this._closeBtn = this._register(new SimpleButton({\n      label: NLS_CLOSE_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.CloseFindWidgetCommand),\n      className: 'codicon codicon-close',\n      onTrigger: function () {\n        _this._state.change({\n          isRevealed: false,\n          searchScope: null\n        }, false);\n      },\n      onKeyDown: function (e) {\n        if (e.equals(2\n        /* Tab */\n        )) {\n          if (_this._isReplaceVisible) {\n            if (_this._replaceBtn.isEnabled()) {\n              _this._replaceBtn.focus();\n            } else {\n              _this._codeEditor.focus();\n            }\n\n            e.preventDefault();\n          }\n        }\n      }\n    }));\n    actionsContainer.appendChild(this._closeBtn.domNode); // Replace input\n\n    this._replaceInput = this._register(new ContextScopedReplaceInput(null, undefined, {\n      label: NLS_REPLACE_INPUT_LABEL,\n      placeholder: NLS_REPLACE_INPUT_PLACEHOLDER,\n      history: [],\n      flexibleHeight: flexibleHeight,\n      flexibleWidth: flexibleWidth,\n      flexibleMaxHeight: 118\n    }, this._contextKeyService, true));\n\n    this._replaceInput.setPreserveCase(!!this._state.preserveCase);\n\n    this._register(this._replaceInput.onKeyDown(function (e) {\n      return _this._onReplaceInputKeyDown(e);\n    }));\n\n    this._register(this._replaceInput.inputBox.onDidChange(function () {\n      _this._state.change({\n        replaceString: _this._replaceInput.inputBox.value\n      }, false);\n    }));\n\n    this._register(this._replaceInput.inputBox.onDidHeightChange(function (e) {\n      if (_this._isReplaceVisible && _this._tryUpdateHeight()) {\n        _this._showViewZone();\n      }\n    }));\n\n    this._register(this._replaceInput.onDidOptionChange(function () {\n      _this._state.change({\n        preserveCase: _this._replaceInput.getPreserveCase()\n      }, true);\n    }));\n\n    this._register(this._replaceInput.onPreserveCaseKeyDown(function (e) {\n      if (e.equals(2\n      /* Tab */\n      )) {\n        if (_this._prevBtn.isEnabled()) {\n          _this._prevBtn.focus();\n        } else if (_this._nextBtn.isEnabled()) {\n          _this._nextBtn.focus();\n        } else if (_this._toggleSelectionFind.enabled) {\n          _this._toggleSelectionFind.focus();\n        } else if (_this._closeBtn.isEnabled()) {\n          _this._closeBtn.focus();\n        }\n\n        e.preventDefault();\n      }\n    })); // Replace one button\n\n\n    this._replaceBtn = this._register(new SimpleButton({\n      label: NLS_REPLACE_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.ReplaceOneAction),\n      className: 'codicon codicon-replace',\n      onTrigger: function () {\n        _this._controller.replace();\n      },\n      onKeyDown: function (e) {\n        if (e.equals(1024\n        /* Shift */\n        | 2\n        /* Tab */\n        )) {\n          _this._closeBtn.focus();\n\n          e.preventDefault();\n        }\n      }\n    })); // Replace all button\n\n    this._replaceAllBtn = this._register(new SimpleButton({\n      label: NLS_REPLACE_ALL_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.ReplaceAllAction),\n      className: 'codicon codicon-replace-all',\n      onTrigger: function () {\n        _this._controller.replaceAll();\n      }\n    }));\n    var replacePart = document.createElement('div');\n    replacePart.className = 'replace-part';\n    replacePart.appendChild(this._replaceInput.domNode);\n    var replaceActionsContainer = document.createElement('div');\n    replaceActionsContainer.className = 'replace-actions';\n    replacePart.appendChild(replaceActionsContainer);\n    replaceActionsContainer.appendChild(this._replaceBtn.domNode);\n    replaceActionsContainer.appendChild(this._replaceAllBtn.domNode); // Toggle replace button\n\n    this._toggleReplaceBtn = this._register(new SimpleButton({\n      label: NLS_TOGGLE_REPLACE_MODE_BTN_LABEL,\n      className: 'codicon toggle left',\n      onTrigger: function () {\n        _this._state.change({\n          isReplaceRevealed: !_this._isReplaceVisible\n        }, false);\n\n        if (_this._isReplaceVisible) {\n          _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\n\n          _this._replaceInput.inputBox.layout();\n        }\n\n        _this._showViewZone();\n      }\n    }));\n\n    this._toggleReplaceBtn.toggleClass('codicon-chevron-down', this._isReplaceVisible);\n\n    this._toggleReplaceBtn.toggleClass('codicon-chevron-right', !this._isReplaceVisible);\n\n    this._toggleReplaceBtn.setExpanded(this._isReplaceVisible); // Widget\n\n\n    this._domNode = document.createElement('div');\n    this._domNode.className = 'editor-widget find-widget';\n\n    this._domNode.setAttribute('aria-hidden', 'true'); // We need to set this explicitly, otherwise on IE11, the width inheritence of flex doesn't work.\n\n\n    this._domNode.style.width = FIND_WIDGET_INITIAL_WIDTH + \"px\";\n\n    this._domNode.appendChild(this._toggleReplaceBtn.domNode);\n\n    this._domNode.appendChild(findPart);\n\n    this._domNode.appendChild(replacePart);\n\n    this._resizeSash = new Sash(this._domNode, this, {\n      orientation: 0\n      /* VERTICAL */\n\n    });\n    this._resized = false;\n    var originalWidth = FIND_WIDGET_INITIAL_WIDTH;\n\n    this._register(this._resizeSash.onDidStart(function () {\n      originalWidth = dom.getTotalWidth(_this._domNode);\n    }));\n\n    this._register(this._resizeSash.onDidChange(function (evt) {\n      _this._resized = true;\n      var width = originalWidth + evt.startX - evt.currentX;\n\n      if (width < FIND_WIDGET_INITIAL_WIDTH) {\n        // narrow down the find widget should be handled by CSS.\n        return;\n      }\n\n      var maxWidth = parseFloat(dom.getComputedStyle(_this._domNode).maxWidth) || 0;\n\n      if (width > maxWidth) {\n        return;\n      }\n\n      _this._domNode.style.width = width + \"px\";\n\n      if (_this._isReplaceVisible) {\n        _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\n      }\n\n      _this._findInput.inputBox.layout();\n\n      _this._tryUpdateHeight();\n    }));\n\n    this._register(this._resizeSash.onDidReset(function () {\n      // users double click on the sash\n      var currentWidth = dom.getTotalWidth(_this._domNode);\n\n      if (currentWidth < FIND_WIDGET_INITIAL_WIDTH) {\n        // The editor is narrow and the width of the find widget is controlled fully by CSS.\n        return;\n      }\n\n      var width = FIND_WIDGET_INITIAL_WIDTH;\n\n      if (!_this._resized || currentWidth === FIND_WIDGET_INITIAL_WIDTH) {\n        // 1. never resized before, double click should maximizes it\n        // 2. users resized it already but its width is the same as default\n        var layoutInfo = _this._codeEditor.getLayoutInfo();\n\n        width = layoutInfo.width - 28 - layoutInfo.minimapWidth - 15;\n        _this._resized = true;\n      } else {\n        /**\r\n         * no op, the find widget should be shrinked to its default size.\r\n         */\n      }\n\n      _this._domNode.style.width = width + \"px\";\n\n      if (_this._isReplaceVisible) {\n        _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\n      }\n\n      _this._findInput.inputBox.layout();\n    }));\n  };\n\n  FindWidget.prototype.updateAccessibilitySupport = function () {\n    var value = this._codeEditor.getOption(2\n    /* accessibilitySupport */\n    );\n\n    this._findInput.setFocusInputOnOptionClick(value !== 2\n    /* Enabled */\n    );\n  };\n\n  FindWidget.ID = 'editor.contrib.findWidget';\n  return FindWidget;\n}(Widget);\n\nexport { FindWidget };\n\nvar SimpleButton =\n/** @class */\nfunction (_super) {\n  __extends(SimpleButton, _super);\n\n  function SimpleButton(opts) {\n    var _this = _super.call(this) || this;\n\n    _this._opts = opts;\n    _this._domNode = document.createElement('div');\n    _this._domNode.title = _this._opts.label;\n    _this._domNode.tabIndex = 0;\n    _this._domNode.className = 'button ' + _this._opts.className;\n\n    _this._domNode.setAttribute('role', 'button');\n\n    _this._domNode.setAttribute('aria-label', _this._opts.label);\n\n    _this.onclick(_this._domNode, function (e) {\n      _this._opts.onTrigger();\n\n      e.preventDefault();\n    });\n\n    _this.onkeydown(_this._domNode, function (e) {\n      if (e.equals(10\n      /* Space */\n      ) || e.equals(3\n      /* Enter */\n      )) {\n        _this._opts.onTrigger();\n\n        e.preventDefault();\n        return;\n      }\n\n      if (_this._opts.onKeyDown) {\n        _this._opts.onKeyDown(e);\n      }\n    });\n\n    return _this;\n  }\n\n  Object.defineProperty(SimpleButton.prototype, \"domNode\", {\n    get: function () {\n      return this._domNode;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  SimpleButton.prototype.isEnabled = function () {\n    return this._domNode.tabIndex >= 0;\n  };\n\n  SimpleButton.prototype.focus = function () {\n    this._domNode.focus();\n  };\n\n  SimpleButton.prototype.setEnabled = function (enabled) {\n    dom.toggleClass(this._domNode, 'disabled', !enabled);\n\n    this._domNode.setAttribute('aria-disabled', String(!enabled));\n\n    this._domNode.tabIndex = enabled ? 0 : -1;\n  };\n\n  SimpleButton.prototype.setExpanded = function (expanded) {\n    this._domNode.setAttribute('aria-expanded', String(!!expanded));\n  };\n\n  SimpleButton.prototype.toggleClass = function (className, shouldHaveIt) {\n    dom.toggleClass(this._domNode, className, shouldHaveIt);\n  };\n\n  return SimpleButton;\n}(Widget);\n\nexport { SimpleButton }; // theming\n\nregisterThemingParticipant(function (theme, collector) {\n  var addBackgroundColorRule = function (selector, color) {\n    if (color) {\n      collector.addRule(\".monaco-editor \" + selector + \" { background-color: \" + color + \"; }\");\n    }\n  };\n\n  addBackgroundColorRule('.findMatch', theme.getColor(editorFindMatchHighlight));\n  addBackgroundColorRule('.currentFindMatch', theme.getColor(editorFindMatch));\n  addBackgroundColorRule('.findScope', theme.getColor(editorFindRangeHighlight));\n  var widgetBackground = theme.getColor(editorWidgetBackground);\n  addBackgroundColorRule('.find-widget', widgetBackground);\n  var widgetShadowColor = theme.getColor(widgetShadow);\n\n  if (widgetShadowColor) {\n    collector.addRule(\".monaco-editor .find-widget { box-shadow: 0 2px 8px \" + widgetShadowColor + \"; }\");\n  }\n\n  var findMatchHighlightBorder = theme.getColor(editorFindMatchHighlightBorder);\n\n  if (findMatchHighlightBorder) {\n    collector.addRule(\".monaco-editor .findMatch { border: 1px \" + (theme.type === 'hc' ? 'dotted' : 'solid') + \" \" + findMatchHighlightBorder + \"; box-sizing: border-box; }\");\n  }\n\n  var findMatchBorder = theme.getColor(editorFindMatchBorder);\n\n  if (findMatchBorder) {\n    collector.addRule(\".monaco-editor .currentFindMatch { border: 2px solid \" + findMatchBorder + \"; padding: 1px; box-sizing: border-box; }\");\n  }\n\n  var findRangeHighlightBorder = theme.getColor(editorFindRangeHighlightBorder);\n\n  if (findRangeHighlightBorder) {\n    collector.addRule(\".monaco-editor .findScope { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + findRangeHighlightBorder + \"; }\");\n  }\n\n  var hcBorder = theme.getColor(contrastBorder);\n\n  if (hcBorder) {\n    collector.addRule(\".monaco-editor .find-widget { border: 1px solid \" + hcBorder + \"; }\");\n  }\n\n  var foreground = theme.getColor(editorWidgetForeground);\n\n  if (foreground) {\n    collector.addRule(\".monaco-editor .find-widget { color: \" + foreground + \"; }\");\n  }\n\n  var error = theme.getColor(errorForeground);\n\n  if (error) {\n    collector.addRule(\".monaco-editor .find-widget.no-results .matchesCount { color: \" + error + \"; }\");\n  }\n\n  var resizeBorderBackground = theme.getColor(editorWidgetResizeBorder);\n\n  if (resizeBorderBackground) {\n    collector.addRule(\".monaco-editor .find-widget .monaco-sash { background-color: \" + resizeBorderBackground + \"; width: 3px !important; margin-left: -4px;}\");\n  } else {\n    var border = theme.getColor(editorWidgetBorder);\n\n    if (border) {\n      collector.addRule(\".monaco-editor .find-widget .monaco-sash { background-color: \" + border + \"; width: 3px !important; margin-left: -4px;}\");\n    }\n  } // This rule is used to override the outline color for synthetic-focus find input.\n\n\n  var focusOutline = theme.getColor(focusBorder);\n\n  if (focusOutline) {\n    collector.addRule(\".monaco-editor .find-widget .monaco-inputbox.synthetic-focus { outline-color: \" + focusOutline + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/find/findWidget.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","nls","dom","alert","alertFn","Checkbox","Sash","Widget","Delayer","onUnexpectedError","toDisposable","platform","strings","Range","CONTEXT_FIND_INPUT_FOCUSED","CONTEXT_REPLACE_INPUT_FOCUSED","FIND_IDS","MATCHES_LIMIT","contrastBorder","editorFindMatch","editorFindMatchBorder","editorFindMatchHighlight","editorFindMatchHighlightBorder","editorFindRangeHighlight","editorFindRangeHighlightBorder","editorWidgetBackground","editorWidgetBorder","editorWidgetResizeBorder","errorForeground","inputActiveOptionBorder","inputActiveOptionBackground","inputBackground","inputBorder","inputForeground","inputValidationErrorBackground","inputValidationErrorBorder","inputValidationErrorForeground","inputValidationInfoBackground","inputValidationInfoBorder","inputValidationInfoForeground","inputValidationWarningBackground","inputValidationWarningBorder","inputValidationWarningForeground","widgetShadow","editorWidgetForeground","focusBorder","registerThemingParticipant","ContextScopedFindInput","ContextScopedReplaceInput","NLS_FIND_INPUT_LABEL","localize","NLS_FIND_INPUT_PLACEHOLDER","NLS_PREVIOUS_MATCH_BTN_LABEL","NLS_NEXT_MATCH_BTN_LABEL","NLS_TOGGLE_SELECTION_FIND_TITLE","NLS_CLOSE_BTN_LABEL","NLS_REPLACE_INPUT_LABEL","NLS_REPLACE_INPUT_PLACEHOLDER","NLS_REPLACE_BTN_LABEL","NLS_REPLACE_ALL_BTN_LABEL","NLS_TOGGLE_REPLACE_MODE_BTN_LABEL","NLS_MATCHES_COUNT_LIMIT_TITLE","NLS_MATCHES_LOCATION","NLS_NO_RESULTS","FIND_WIDGET_INITIAL_WIDTH","PART_WIDTH","FIND_INPUT_AREA_WIDTH","MAX_MATCHES_COUNT_WIDTH","FIND_INPUT_AREA_HEIGHT","ctrlEnterReplaceAllWarningPromptedKey","ctrlKeyMod","isMacintosh","FindWidgetViewZone","afterLineNumber","heightInPx","suppressMouseDown","domNode","document","createElement","className","stopPropagationForMultiLineUpwards","event","value","textarea","isMultiline","match","selectionStart","stopPropagation","stopPropagationForMultiLineDownwards","selectionEnd","length","FindWidget","_super","codeEditor","controller","state","contextViewProvider","keybindingService","contextKeyService","themeService","storageService","notificationService","_this","call","_cachedHeight","_codeEditor","_controller","_state","_contextViewProvider","_keybindingService","_contextKeyService","_storageService","_notificationService","_ctrlEnterReplaceAllWarningPrompted","getBoolean","_isVisible","_isReplaceVisible","_ignoreChangeEvent","_updateHistoryDelayer","_register","cancel","onFindReplaceStateChange","e","_onStateChanged","_buildDomNode","_updateButtons","_tryUpdateWidgetWidth","_findInput","inputBox","layout","onDidChangeConfiguration","hasChanged","getOption","change","isReplaceRevealed","updateAccessibilitySupport","addExtraSpaceOnTop","_viewZone","_showViewZone","_removeViewZone","onDidChangeCursorSelection","_updateToggleSelectionFindButton","onDidFocusEditorWidget","globalBufferTerm","getGlobalBufferTerm","searchString","select","_findInputFocused","bindTo","_findFocusTracker","trackFocus","inputElement","onDidFocus","set","_updateSearchScope","onDidBlur","_replaceInputFocused","_replaceFocusTracker","_replaceInput","addOverlayWidget","_applyTheme","getTheme","onThemeChange","bind","onDidChangeModel","_viewZoneId","undefined","onDidScrollChange","scrollTopChanged","_layoutViewZone","setTimeout","getId","ID","getDomNode","_domNode","getPosition","preference","setValue","replaceString","isRevealed","_reveal","_hide","width","getTotalWidth","_tryUpdateHeight","isRegex","setRegex","wholeWord","setWholeWords","matchCase","setCaseSensitive","searchScope","_toggleSelectionFind","checked","matchesCount","matchesPosition","showRedOutline","toggleClass","_updateMatchesCount","currentMatch","updateHistory","_delayedUpdateHistory","trigger","_updateHistory","addToHistory","_matchesCount","style","minWidth","title","firstChild","removeChild","label","String","format","appendChild","createTextNode","_getAriaLabel","Math","max","clientWidth","startLineNumber","startColumn","selection","getSelection","isSelection","endLineNumber","endColumn","isChecked","enable","disable","setEnabled","_closeBtn","findInputIsNonEmpty","_prevBtn","_nextBtn","_replaceBtn","_replaceAllBtn","_toggleReplaceBtn","setExpanded","canReplace","autoFindInSelection","isSelectionMultipleLine","addClass","setAttribute","validate","layoutOverlayWidget","adjustEditorScrollTop","seedSearchStringFromSelection","editorCoords","getDomNodePagePosition","startCoords","getScrolledVisiblePosition","getStartPosition","startLeft","left","startTop","top","leftOfFindWidget","getTopLeftOffset","endCoords","getEndPosition","endLeft","focusTheEditor","removeClass","clearMessage","focus","viewZone","changeViewZones","accessor","_getHeight","addZone","setScrollTop","getScrollTop","adjustScroll","newHeight","scrollAdjustment","layoutZone","removeZone","theme","inputStyles","getColor","isInDOM","layoutInfo","getLayoutInfo","editorContentWidth","contentWidth","hasClass","editorWidth","minimapWidth","collapsedFindWidget","reducedFindWidget","narrowFindWidget","_resized","widgetWidth","maxWidth","findInputWidth","element","totalheight","height","totalHeight","focusFindInput","focusReplaceInput","highlightFindOptions","hasModel","setEndPosition","getModel","getLineMaxColumn","equalsRange","_onFindInputMouseDown","middleButton","_onFindInputKeyDown","equals","insertAtCursor","preventDefault","focusOnCaseSensitive","getValue","querySelector","_onReplaceInputKeyDown","isWindows","isNative","info","store","getHorizontalSashTop","_sash","getHorizontalSashLeft","getHorizontalSashWidth","_keybindingLabelFor","actionId","kb","lookupKeybinding","getLabel","flexibleHeight","flexibleWidth","placeholder","appendCaseSensitiveLabel","ToggleCaseSensitiveCommand","appendWholeWordsLabel","ToggleWholeWordCommand","appendRegexLabel","ToggleRegexCommand","validation","getRegex","RegExp","content","message","flexibleMaxHeight","onKeyDown","onDidChange","onDidOptionChange","getWholeWords","getCaseSensitive","onCaseSensitiveKeyDown","onRegexKeyDown","focusOnPreserve","onDidHeightChange","isLinux","onMouseDown","SimpleButton","PreviousMatchFindAction","onTrigger","getAction","run","then","NextMatchFindAction","findPart","actionsContainer","actionClassName","ToggleSearchScopeCommand","onChange","isEmpty","CloseFindWidgetCommand","isEnabled","history","setPreserveCase","preserveCase","getPreserveCase","onPreserveCaseKeyDown","enabled","ReplaceOneAction","replace","ReplaceAllAction","replaceAll","replacePart","replaceActionsContainer","_resizeSash","orientation","originalWidth","onDidStart","evt","startX","currentX","parseFloat","getComputedStyle","onDidReset","currentWidth","setFocusInputOnOptionClick","opts","_opts","tabIndex","onclick","onkeydown","defineProperty","get","enumerable","configurable","expanded","shouldHaveIt","collector","addBackgroundColorRule","selector","color","addRule","widgetBackground","widgetShadowColor","findMatchHighlightBorder","type","findMatchBorder","findRangeHighlightBorder","hcBorder","foreground","error","resizeBorderBackground","border","focusOutline"],"mappings":"AAAA;;;;AAIA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,OAAO,kBAAP;AACA,OAAO,KAAKI,GAAZ,MAAqB,iBAArB;AACA,OAAO,KAAKC,GAAZ,MAAqB,8BAArB;AACA,SAASC,KAAK,IAAIC,OAAlB,QAAiC,uCAAjC;AACA,SAASC,QAAT,QAAyB,+CAAzB;AACA,SAASC,IAAT,QAAqB,uCAArB;AACA,SAASC,MAAT,QAAuB,oCAAvB;AACA,SAASC,OAAT,QAAwB,+BAAxB;AACA,SAASC,iBAAT,QAAkC,gCAAlC;AACA,SAASC,YAAT,QAA6B,mCAA7B;AACA,OAAO,KAAKC,QAAZ,MAA0B,kCAA1B;AACA,OAAO,KAAKC,OAAZ,MAAyB,iCAAzB;AACA,SAASC,KAAT,QAAsB,4BAAtB;AACA,SAASC,0BAAT,EAAqCC,6BAArC,EAAoEC,QAApE,EAA8EC,aAA9E,QAAmG,gBAAnG;AACA,SAASC,cAAT,EAAyBC,eAAzB,EAA0CC,qBAA1C,EAAiEC,wBAAjE,EAA2FC,8BAA3F,EAA2HC,wBAA3H,EAAqJC,8BAArJ,EAAqLC,sBAArL,EAA6MC,kBAA7M,EAAiOC,wBAAjO,EAA2PC,eAA3P,EAA4QC,uBAA5Q,EAAqSC,2BAArS,EAAkUC,eAAlU,EAAmVC,WAAnV,EAAgWC,eAAhW,EAAiXC,8BAAjX,EAAiZC,0BAAjZ,EAA6aC,8BAA7a,EAA6cC,6BAA7c,EAA4eC,yBAA5e,EAAugBC,6BAAvgB,EAAsiBC,gCAAtiB,EAAwkBC,4BAAxkB,EAAsmBC,gCAAtmB,EAAwoBC,YAAxoB,EAAspBC,sBAAtpB,EAA8qBC,WAA9qB,QAAisB,iDAAjsB;AACA,SAASC,0BAAT,QAA2C,gDAA3C;AACA,SAASC,sBAAT,EAAiCC,yBAAjC,QAAkE,yDAAlE;AACA,IAAIC,oBAAoB,GAAGhD,GAAG,CAACiD,QAAJ,CAAa,YAAb,EAA2B,MAA3B,CAA3B;AACA,IAAIC,0BAA0B,GAAGlD,GAAG,CAACiD,QAAJ,CAAa,kBAAb,EAAiC,MAAjC,CAAjC;AACA,IAAIE,4BAA4B,GAAGnD,GAAG,CAACiD,QAAJ,CAAa,2BAAb,EAA0C,gBAA1C,CAAnC;AACA,IAAIG,wBAAwB,GAAGpD,GAAG,CAACiD,QAAJ,CAAa,uBAAb,EAAsC,YAAtC,CAA/B;AACA,IAAII,+BAA+B,GAAGrD,GAAG,CAACiD,QAAJ,CAAa,2BAAb,EAA0C,mBAA1C,CAAtC;AACA,IAAIK,mBAAmB,GAAGtD,GAAG,CAACiD,QAAJ,CAAa,mBAAb,EAAkC,OAAlC,CAA1B;AACA,IAAIM,uBAAuB,GAAGvD,GAAG,CAACiD,QAAJ,CAAa,eAAb,EAA8B,SAA9B,CAA9B;AACA,IAAIO,6BAA6B,GAAGxD,GAAG,CAACiD,QAAJ,CAAa,qBAAb,EAAoC,SAApC,CAApC;AACA,IAAIQ,qBAAqB,GAAGzD,GAAG,CAACiD,QAAJ,CAAa,qBAAb,EAAoC,SAApC,CAA5B;AACA,IAAIS,yBAAyB,GAAG1D,GAAG,CAACiD,QAAJ,CAAa,wBAAb,EAAuC,aAAvC,CAAhC;AACA,IAAIU,iCAAiC,GAAG3D,GAAG,CAACiD,QAAJ,CAAa,2BAAb,EAA0C,qBAA1C,CAAxC;AACA,IAAIW,6BAA6B,GAAG5D,GAAG,CAACiD,QAAJ,CAAa,yBAAb,EAAwC,8FAAxC,EAAwIjC,aAAxI,CAApC;AACA,IAAI6C,oBAAoB,GAAG7D,GAAG,CAACiD,QAAJ,CAAa,uBAAb,EAAsC,YAAtC,CAA3B;AACA,IAAIa,cAAc,GAAG9D,GAAG,CAACiD,QAAJ,CAAa,iBAAb,EAAgC,YAAhC,CAArB;AACA,IAAIc,yBAAyB,GAAG,GAAhC;AACA,IAAIC,UAAU,GAAG,GAAjB;AACA,IAAIC,qBAAqB,GAAGD,UAAU,GAAG,EAAzC;AACA,IAAIE,uBAAuB,GAAG,EAA9B,C,CACA;;AACA,IAAIC,sBAAsB,GAAG,EAA7B,C,CAAiC;;AACjC,IAAIC,qCAAqC,GAAG,sCAA5C;AACA,IAAIC,UAAU,GAAI3D,QAAQ,CAAC4D,WAAT,GAAuB;AAAI;AAA3B,EAA2C;AAAK;AAAlE;;AACA,IAAIC,kBAAkB;AAAG;AAAe,YAAY;AAChD,WAASA,kBAAT,CAA4BC,eAA5B,EAA6C;AACzC,SAAKA,eAAL,GAAuBA,eAAvB;AACA,SAAKC,UAAL,GAAkBN,sBAAlB;AACA,SAAKO,iBAAL,GAAyB,KAAzB;AACA,SAAKC,OAAL,GAAeC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf;AACA,SAAKF,OAAL,CAAaG,SAAb,GAAyB,oBAAzB;AACH;;AACD,SAAOP,kBAAP;AACH,CATuC,EAAxC;;AAUA,SAASA,kBAAT;;AACA,SAASQ,kCAAT,CAA4CC,KAA5C,EAAmDC,KAAnD,EAA0DC,QAA1D,EAAoE;AAChE,MAAIC,WAAW,GAAG,CAAC,CAACF,KAAK,CAACG,KAAN,CAAY,IAAZ,CAApB;;AACA,MAAIF,QAAQ,IAAIC,WAAZ,IAA2BD,QAAQ,CAACG,cAAT,GAA0B,CAAzD,EAA4D;AACxDL,IAAAA,KAAK,CAACM,eAAN;AACA;AACH;AACJ;;AACD,SAASC,oCAAT,CAA8CP,KAA9C,EAAqDC,KAArD,EAA4DC,QAA5D,EAAsE;AAClE,MAAIC,WAAW,GAAG,CAAC,CAACF,KAAK,CAACG,KAAN,CAAY,IAAZ,CAApB;;AACA,MAAIF,QAAQ,IAAIC,WAAZ,IAA2BD,QAAQ,CAACM,YAAT,GAAwBN,QAAQ,CAACD,KAAT,CAAeQ,MAAtE,EAA8E;AAC1ET,IAAAA,KAAK,CAACM,eAAN;AACA;AACH;AACJ;;AACD,IAAII,UAAU;AAAG;AAAe,UAAUC,MAAV,EAAkB;AAC9CzG,EAAAA,SAAS,CAACwG,UAAD,EAAaC,MAAb,CAAT;;AACA,WAASD,UAAT,CAAoBE,UAApB,EAAgCC,UAAhC,EAA4CC,KAA5C,EAAmDC,mBAAnD,EAAwEC,iBAAxE,EAA2FC,iBAA3F,EAA8GC,YAA9G,EAA4HC,cAA5H,EAA4IC,mBAA5I,EAAiK;AAC7J,QAAIC,KAAK,GAAGV,MAAM,CAACW,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACAD,IAAAA,KAAK,CAACE,aAAN,GAAsB,IAAtB;AACAF,IAAAA,KAAK,CAACG,WAAN,GAAoBZ,UAApB;AACAS,IAAAA,KAAK,CAACI,WAAN,GAAoBZ,UAApB;AACAQ,IAAAA,KAAK,CAACK,MAAN,GAAeZ,KAAf;AACAO,IAAAA,KAAK,CAACM,oBAAN,GAA6BZ,mBAA7B;AACAM,IAAAA,KAAK,CAACO,kBAAN,GAA2BZ,iBAA3B;AACAK,IAAAA,KAAK,CAACQ,kBAAN,GAA2BZ,iBAA3B;AACAI,IAAAA,KAAK,CAACS,eAAN,GAAwBX,cAAxB;AACAE,IAAAA,KAAK,CAACU,oBAAN,GAA6BX,mBAA7B;AACAC,IAAAA,KAAK,CAACW,mCAAN,GAA4C,CAAC,CAACb,cAAc,CAACc,UAAf,CAA0B7C,qCAA1B,EAAiE;AAAE;AAAnE,KAA9C;AACAiC,IAAAA,KAAK,CAACa,UAAN,GAAmB,KAAnB;AACAb,IAAAA,KAAK,CAACc,iBAAN,GAA0B,KAA1B;AACAd,IAAAA,KAAK,CAACe,kBAAN,GAA2B,KAA3B;AACAf,IAAAA,KAAK,CAACgB,qBAAN,GAA8B,IAAI9G,OAAJ,CAAY,GAAZ,CAA9B;;AACA8F,IAAAA,KAAK,CAACiB,SAAN,CAAgB7G,YAAY,CAAC,YAAY;AAAE,aAAO4F,KAAK,CAACgB,qBAAN,CAA4BE,MAA5B,EAAP;AAA8C,KAA7D,CAA5B;;AACAlB,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACK,MAAN,CAAac,wBAAb,CAAsC,UAAUC,CAAV,EAAa;AAAE,aAAOpB,KAAK,CAACqB,eAAN,CAAsBD,CAAtB,CAAP;AAAkC,KAAvF,CAAhB;;AACApB,IAAAA,KAAK,CAACsB,aAAN;;AACAtB,IAAAA,KAAK,CAACuB,cAAN;;AACAvB,IAAAA,KAAK,CAACwB,qBAAN;;AACAxB,IAAAA,KAAK,CAACyB,UAAN,CAAiBC,QAAjB,CAA0BC,MAA1B;;AACA3B,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACG,WAAN,CAAkByB,wBAAlB,CAA2C,UAAUR,CAAV,EAAa;AACpE,UAAIA,CAAC,CAACS,UAAF,CAAa;AAAG;AAAhB,OAAJ,EAAqC;AACjC,YAAI7B,KAAK,CAACG,WAAN,CAAkB2B,SAAlB,CAA4B;AAAG;AAA/B,SAAJ,EAAoD;AAChD;AACA9B,UAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAEC,YAAAA,iBAAiB,EAAE;AAArB,WAApB,EAAkD,KAAlD;AACH;;AACDhC,QAAAA,KAAK,CAACuB,cAAN;AACH;;AACD,UAAIH,CAAC,CAACS,UAAF,CAAa;AAAI;AAAjB,OAAJ,EAAwC;AACpC7B,QAAAA,KAAK,CAACwB,qBAAN;AACH;;AACD,UAAIJ,CAAC,CAACS,UAAF,CAAa;AAAE;AAAf,OAAJ,EAAgD;AAC5C7B,QAAAA,KAAK,CAACiC,0BAAN;AACH;;AACD,UAAIb,CAAC,CAACS,UAAF,CAAa;AAAG;AAAhB,OAAJ,EAAiC;AAC7B,YAAIK,kBAAkB,GAAGlC,KAAK,CAACG,WAAN,CAAkB2B,SAAlB,CAA4B;AAAG;AAA/B,UAA2CI,kBAApE;;AACA,YAAIA,kBAAkB,IAAI,CAAClC,KAAK,CAACmC,SAAjC,EAA4C;AACxCnC,UAAAA,KAAK,CAACmC,SAAN,GAAkB,IAAIjE,kBAAJ,CAAuB,CAAvB,CAAlB;;AACA8B,UAAAA,KAAK,CAACoC,aAAN;AACH;;AACD,YAAI,CAACF,kBAAD,IAAuBlC,KAAK,CAACmC,SAAjC,EAA4C;AACxCnC,UAAAA,KAAK,CAACqC,eAAN;AACH;AACJ;AACJ,KAxBe,CAAhB;;AAyBArC,IAAAA,KAAK,CAACiC,0BAAN;;AACAjC,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACG,WAAN,CAAkBmC,0BAAlB,CAA6C,YAAY;AACrE,UAAItC,KAAK,CAACa,UAAV,EAAsB;AAClBb,QAAAA,KAAK,CAACuC,gCAAN;AACH;AACJ,KAJe,CAAhB;;AAKAvC,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACG,WAAN,CAAkBqC,sBAAlB,CAAyC,YAAY;AACjE,UAAIxC,KAAK,CAACa,UAAV,EAAsB;AAClB,YAAI4B,gBAAgB,GAAGzC,KAAK,CAACI,WAAN,CAAkBsC,mBAAlB,EAAvB;;AACA,YAAID,gBAAgB,IAAIA,gBAAgB,KAAKzC,KAAK,CAACK,MAAN,CAAasC,YAA1D,EAAwE;AACpE3C,UAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAEY,YAAAA,YAAY,EAAEF;AAAhB,WAApB,EAAwD,IAAxD;;AACAzC,UAAAA,KAAK,CAACyB,UAAN,CAAiBmB,MAAjB;AACH;AACJ;AACJ,KARe,CAAhB;;AASA5C,IAAAA,KAAK,CAAC6C,iBAAN,GAA0BrI,0BAA0B,CAACsI,MAA3B,CAAkClD,iBAAlC,CAA1B;AACAI,IAAAA,KAAK,CAAC+C,iBAAN,GAA0B/C,KAAK,CAACiB,SAAN,CAAgBrH,GAAG,CAACoJ,UAAJ,CAAehD,KAAK,CAACyB,UAAN,CAAiBC,QAAjB,CAA0BuB,YAAzC,CAAhB,CAA1B;;AACAjD,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAAC+C,iBAAN,CAAwBG,UAAxB,CAAmC,YAAY;AAC3DlD,MAAAA,KAAK,CAAC6C,iBAAN,CAAwBM,GAAxB,CAA4B,IAA5B;;AACAnD,MAAAA,KAAK,CAACoD,kBAAN;AACH,KAHe,CAAhB;;AAIApD,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAAC+C,iBAAN,CAAwBM,SAAxB,CAAkC,YAAY;AAC1DrD,MAAAA,KAAK,CAAC6C,iBAAN,CAAwBM,GAAxB,CAA4B,KAA5B;AACH,KAFe,CAAhB;;AAGAnD,IAAAA,KAAK,CAACsD,oBAAN,GAA6B7I,6BAA6B,CAACqI,MAA9B,CAAqClD,iBAArC,CAA7B;AACAI,IAAAA,KAAK,CAACuD,oBAAN,GAA6BvD,KAAK,CAACiB,SAAN,CAAgBrH,GAAG,CAACoJ,UAAJ,CAAehD,KAAK,CAACwD,aAAN,CAAoB9B,QAApB,CAA6BuB,YAA5C,CAAhB,CAA7B;;AACAjD,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACuD,oBAAN,CAA2BL,UAA3B,CAAsC,YAAY;AAC9DlD,MAAAA,KAAK,CAACsD,oBAAN,CAA2BH,GAA3B,CAA+B,IAA/B;;AACAnD,MAAAA,KAAK,CAACoD,kBAAN;AACH,KAHe,CAAhB;;AAIApD,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACuD,oBAAN,CAA2BF,SAA3B,CAAqC,YAAY;AAC7DrD,MAAAA,KAAK,CAACsD,oBAAN,CAA2BH,GAA3B,CAA+B,KAA/B;AACH,KAFe,CAAhB;;AAGAnD,IAAAA,KAAK,CAACG,WAAN,CAAkBsD,gBAAlB,CAAmCzD,KAAnC;;AACA,QAAIA,KAAK,CAACG,WAAN,CAAkB2B,SAAlB,CAA4B;AAAG;AAA/B,MAA2CI,kBAA/C,EAAmE;AAC/DlC,MAAAA,KAAK,CAACmC,SAAN,GAAkB,IAAIjE,kBAAJ,CAAuB,CAAvB,CAAlB,CAD+D,CAClB;AAChD;;AACD8B,IAAAA,KAAK,CAAC0D,WAAN,CAAkB7D,YAAY,CAAC8D,QAAb,EAAlB;;AACA3D,IAAAA,KAAK,CAACiB,SAAN,CAAgBpB,YAAY,CAAC+D,aAAb,CAA2B5D,KAAK,CAAC0D,WAAN,CAAkBG,IAAlB,CAAuB7D,KAAvB,CAA3B,CAAhB;;AACAA,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACG,WAAN,CAAkB2D,gBAAlB,CAAmC,YAAY;AAC3D,UAAI,CAAC9D,KAAK,CAACa,UAAX,EAAuB;AACnB;AACH;;AACDb,MAAAA,KAAK,CAAC+D,WAAN,GAAoBC,SAApB;AACH,KALe,CAAhB;;AAMAhE,IAAAA,KAAK,CAACiB,SAAN,CAAgBjB,KAAK,CAACG,WAAN,CAAkB8D,iBAAlB,CAAoC,UAAU7C,CAAV,EAAa;AAC7D,UAAIA,CAAC,CAAC8C,gBAAN,EAAwB;AACpBlE,QAAAA,KAAK,CAACmE,eAAN;;AACA;AACH,OAJ4D,CAK7D;;;AACAC,MAAAA,UAAU,CAAC,YAAY;AACnBpE,QAAAA,KAAK,CAACmE,eAAN;AACH,OAFS,EAEP,CAFO,CAAV;AAGH,KATe,CAAhB;;AAUA,WAAOnE,KAAP;AACH,GAzG6C,CA0G9C;;;AACAX,EAAAA,UAAU,CAAC5F,SAAX,CAAqB4K,KAArB,GAA6B,YAAY;AACrC,WAAOhF,UAAU,CAACiF,EAAlB;AACH,GAFD;;AAGAjF,EAAAA,UAAU,CAAC5F,SAAX,CAAqB8K,UAArB,GAAkC,YAAY;AAC1C,WAAO,KAAKC,QAAZ;AACH,GAFD;;AAGAnF,EAAAA,UAAU,CAAC5F,SAAX,CAAqBgL,WAArB,GAAmC,YAAY;AAC3C,QAAI,KAAK5D,UAAT,EAAqB;AACjB,aAAO;AACH6D,QAAAA,UAAU,EAAE;AAAE;;AADX,OAAP;AAGH;;AACD,WAAO,IAAP;AACH,GAPD,CAjH8C,CAyH9C;;;AACArF,EAAAA,UAAU,CAAC5F,SAAX,CAAqB4H,eAArB,GAAuC,UAAUD,CAAV,EAAa;AAChD,QAAIA,CAAC,CAACuB,YAAN,EAAoB;AAChB,UAAI;AACA,aAAK5B,kBAAL,GAA0B,IAA1B;;AACA,aAAKU,UAAL,CAAgBkD,QAAhB,CAAyB,KAAKtE,MAAL,CAAYsC,YAArC;AACH,OAHD,SAIQ;AACJ,aAAK5B,kBAAL,GAA0B,KAA1B;AACH;;AACD,WAAKQ,cAAL;AACH;;AACD,QAAIH,CAAC,CAACwD,aAAN,EAAqB;AACjB,WAAKpB,aAAL,CAAmB9B,QAAnB,CAA4B9C,KAA5B,GAAoC,KAAKyB,MAAL,CAAYuE,aAAhD;AACH;;AACD,QAAIxD,CAAC,CAACyD,UAAN,EAAkB;AACd,UAAI,KAAKxE,MAAL,CAAYwE,UAAhB,EAA4B;AACxB,aAAKC,OAAL;AACH,OAFD,MAGK;AACD,aAAKC,KAAL,CAAW,IAAX;AACH;AACJ;;AACD,QAAI3D,CAAC,CAACY,iBAAN,EAAyB;AACrB,UAAI,KAAK3B,MAAL,CAAY2B,iBAAhB,EAAmC;AAC/B,YAAI,CAAC,KAAK7B,WAAL,CAAiB2B,SAAjB,CAA2B;AAAG;AAA9B,SAAD,IAAkD,CAAC,KAAKhB,iBAA5D,EAA+E;AAC3E,eAAKA,iBAAL,GAAyB,IAAzB;AACA,eAAK0C,aAAL,CAAmBwB,KAAnB,GAA2BpL,GAAG,CAACqL,aAAJ,CAAkB,KAAKxD,UAAL,CAAgBnD,OAAlC,CAA3B;;AACA,eAAKiD,cAAL;;AACA,eAAKiC,aAAL,CAAmB9B,QAAnB,CAA4BC,MAA5B;AACH;AACJ,OAPD,MAQK;AACD,YAAI,KAAKb,iBAAT,EAA4B;AACxB,eAAKA,iBAAL,GAAyB,KAAzB;;AACA,eAAKS,cAAL;AACH;AACJ;AACJ;;AACD,QAAI,CAACH,CAAC,CAACyD,UAAF,IAAgBzD,CAAC,CAACY,iBAAnB,MAA0C,KAAK3B,MAAL,CAAYwE,UAAZ,IAA0B,KAAKxE,MAAL,CAAY2B,iBAAhF,CAAJ,EAAwG;AACpG,UAAI,KAAKkD,gBAAL,EAAJ,EAA6B;AACzB,aAAK9C,aAAL;AACH;AACJ;;AACD,QAAIhB,CAAC,CAAC+D,OAAN,EAAe;AACX,WAAK1D,UAAL,CAAgB2D,QAAhB,CAAyB,KAAK/E,MAAL,CAAY8E,OAArC;AACH;;AACD,QAAI/D,CAAC,CAACiE,SAAN,EAAiB;AACb,WAAK5D,UAAL,CAAgB6D,aAAhB,CAA8B,KAAKjF,MAAL,CAAYgF,SAA1C;AACH;;AACD,QAAIjE,CAAC,CAACmE,SAAN,EAAiB;AACb,WAAK9D,UAAL,CAAgB+D,gBAAhB,CAAiC,KAAKnF,MAAL,CAAYkF,SAA7C;AACH;;AACD,QAAInE,CAAC,CAACqE,WAAN,EAAmB;AACf,UAAI,KAAKpF,MAAL,CAAYoF,WAAhB,EAA6B;AACzB,aAAKC,oBAAL,CAA0BC,OAA1B,GAAoC,IAApC;AACH,OAFD,MAGK;AACD,aAAKD,oBAAL,CAA0BC,OAA1B,GAAoC,KAApC;AACH;;AACD,WAAKpD,gCAAL;AACH;;AACD,QAAInB,CAAC,CAACuB,YAAF,IAAkBvB,CAAC,CAACwE,YAApB,IAAoCxE,CAAC,CAACyE,eAA1C,EAA2D;AACvD,UAAIC,cAAc,GAAI,KAAKzF,MAAL,CAAYsC,YAAZ,CAAyBvD,MAAzB,GAAkC,CAAlC,IAAuC,KAAKiB,MAAL,CAAYuF,YAAZ,KAA6B,CAA1F;AACAhM,MAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B,YAA/B,EAA6CsB,cAA7C;;AACA,WAAKE,mBAAL;;AACA,WAAKzE,cAAL;AACH;;AACD,QAAIH,CAAC,CAACuB,YAAF,IAAkBvB,CAAC,CAAC6E,YAAxB,EAAsC;AAClC,WAAK9B,eAAL;AACH;;AACD,QAAI/C,CAAC,CAAC8E,aAAN,EAAqB;AACjB,WAAKC,qBAAL;AACH;AACJ,GAzED;;AA0EA9G,EAAAA,UAAU,CAAC5F,SAAX,CAAqB0M,qBAArB,GAA6C,YAAY;AACrD,SAAKnF,qBAAL,CAA2BoF,OAA3B,CAAmC,KAAKC,cAAL,CAAoBxC,IAApB,CAAyB,IAAzB,CAAnC;AACH,GAFD;;AAGAxE,EAAAA,UAAU,CAAC5F,SAAX,CAAqB4M,cAArB,GAAsC,YAAY;AAC9C,QAAI,KAAKhG,MAAL,CAAYsC,YAAhB,EAA8B;AAC1B,WAAKlB,UAAL,CAAgBC,QAAhB,CAAyB4E,YAAzB;AACH;;AACD,QAAI,KAAKjG,MAAL,CAAYuE,aAAhB,EAA+B;AAC3B,WAAKpB,aAAL,CAAmB9B,QAAnB,CAA4B4E,YAA5B;AACH;AACJ,GAPD;;AAQAjH,EAAAA,UAAU,CAAC5F,SAAX,CAAqBuM,mBAArB,GAA2C,YAAY;AACnD,SAAKO,aAAL,CAAmBC,KAAnB,CAAyBC,QAAzB,GAAoC5I,uBAAuB,GAAG,IAA9D;;AACA,QAAI,KAAKwC,MAAL,CAAYuF,YAAZ,IAA4BjL,aAAhC,EAA+C;AAC3C,WAAK4L,aAAL,CAAmBG,KAAnB,GAA2BnJ,6BAA3B;AACH,KAFD,MAGK;AACD,WAAKgJ,aAAL,CAAmBG,KAAnB,GAA2B,EAA3B;AACH,KAPkD,CAQnD;;;AACA,QAAI,KAAKH,aAAL,CAAmBI,UAAvB,EAAmC;AAC/B,WAAKJ,aAAL,CAAmBK,WAAnB,CAA+B,KAAKL,aAAL,CAAmBI,UAAlD;AACH;;AACD,QAAIE,KAAJ;;AACA,QAAI,KAAKxG,MAAL,CAAYuF,YAAZ,GAA2B,CAA/B,EAAkC;AAC9B,UAAIA,YAAY,GAAGkB,MAAM,CAAC,KAAKzG,MAAL,CAAYuF,YAAb,CAAzB;;AACA,UAAI,KAAKvF,MAAL,CAAYuF,YAAZ,IAA4BjL,aAAhC,EAA+C;AAC3CiL,QAAAA,YAAY,IAAI,GAAhB;AACH;;AACD,UAAIC,eAAe,GAAGiB,MAAM,CAAC,KAAKzG,MAAL,CAAYwF,eAAb,CAA5B;;AACA,UAAIA,eAAe,KAAK,GAAxB,EAA6B;AACzBA,QAAAA,eAAe,GAAG,GAAlB;AACH;;AACDgB,MAAAA,KAAK,GAAGvM,OAAO,CAACyM,MAAR,CAAevJ,oBAAf,EAAqCqI,eAArC,EAAsDD,YAAtD,CAAR;AACH,KAVD,MAWK;AACDiB,MAAAA,KAAK,GAAGpJ,cAAR;AACH;;AACD,SAAK8I,aAAL,CAAmBS,WAAnB,CAA+BzI,QAAQ,CAAC0I,cAAT,CAAwBJ,KAAxB,CAA/B;;AACA/M,IAAAA,OAAO,CAAC,KAAKoN,aAAL,CAAmBL,KAAnB,EAA0B,KAAKxG,MAAL,CAAY4F,YAAtC,EAAoD,KAAK5F,MAAL,CAAYsC,YAAhE,CAAD,EAAgF,IAAhF,CAAP;AACA9E,IAAAA,uBAAuB,GAAGsJ,IAAI,CAACC,GAAL,CAASvJ,uBAAT,EAAkC,KAAK0I,aAAL,CAAmBc,WAArD,CAA1B;AACH,GA9BD,CA/M8C,CA8O9C;;;AACAhI,EAAAA,UAAU,CAAC5F,SAAX,CAAqByN,aAArB,GAAqC,UAAUL,KAAV,EAAiBZ,YAAjB,EAA+BtD,YAA/B,EAA6C;AAC9E,QAAIkE,KAAK,KAAKpJ,cAAd,EAA8B;AAC1B,aAAOkF,YAAY,KAAK,EAAjB,GACDhJ,GAAG,CAACiD,QAAJ,CAAa,yBAAb,EAAwC,WAAxC,EAAqDiK,KAArD,CADC,GAEDlN,GAAG,CAACiD,QAAJ,CAAa,oBAAb,EAAmC,mBAAnC,EAAwDiK,KAAxD,EAA+DlE,YAA/D,CAFN;AAGH;;AACD,WAAOsD,YAAY,GACbtM,GAAG,CAACiD,QAAJ,CAAa,+BAAb,EAA8C,0BAA9C,EAA0EiK,KAA1E,EAAiFlE,YAAjF,EAA+FsD,YAAY,CAACqB,eAAb,GAA+B,GAA/B,GAAqCrB,YAAY,CAACsB,WAAjJ,CADa,GAEb5N,GAAG,CAACiD,QAAJ,CAAa,6CAAb,EAA4D,mBAA5D,EAAiFiK,KAAjF,EAAwFlE,YAAxF,CAFN;AAGH,GATD;AAUA;;;;;;AAIAtD,EAAAA,UAAU,CAAC5F,SAAX,CAAqB8I,gCAArB,GAAwD,YAAY;AAChE,QAAIiF,SAAS,GAAG,KAAKrH,WAAL,CAAiBsH,YAAjB,EAAhB;;AACA,QAAIC,WAAW,GAAGF,SAAS,GAAIA,SAAS,CAACF,eAAV,KAA8BE,SAAS,CAACG,aAAxC,IAAyDH,SAAS,CAACD,WAAV,KAA0BC,SAAS,CAACI,SAAjG,GAA8G,KAAzI;AACA,QAAIC,SAAS,GAAG,KAAKnC,oBAAL,CAA0BC,OAA1C;;AACA,QAAI,KAAK9E,UAAL,KAAoBgH,SAAS,IAAIH,WAAjC,CAAJ,EAAmD;AAC/C,WAAKhC,oBAAL,CAA0BoC,MAA1B;AACH,KAFD,MAGK;AACD,WAAKpC,oBAAL,CAA0BqC,OAA1B;AACH;AACJ,GAVD;;AAWA1I,EAAAA,UAAU,CAAC5F,SAAX,CAAqB8H,cAArB,GAAsC,YAAY;AAC9C,SAAKE,UAAL,CAAgBuG,UAAhB,CAA2B,KAAKnH,UAAhC;;AACA,SAAK2C,aAAL,CAAmBwE,UAAnB,CAA8B,KAAKnH,UAAL,IAAmB,KAAKC,iBAAtD;;AACA,SAAKyB,gCAAL;;AACA,SAAK0F,SAAL,CAAeD,UAAf,CAA0B,KAAKnH,UAA/B;;AACA,QAAIqH,mBAAmB,GAAI,KAAK7H,MAAL,CAAYsC,YAAZ,CAAyBvD,MAAzB,GAAkC,CAA7D;AACA,QAAIwG,YAAY,GAAG,KAAKvF,MAAL,CAAYuF,YAAZ,GAA2B,IAA3B,GAAkC,KAArD;;AACA,SAAKuC,QAAL,CAAcH,UAAd,CAAyB,KAAKnH,UAAL,IAAmBqH,mBAAnB,IAA0CtC,YAAnE;;AACA,SAAKwC,QAAL,CAAcJ,UAAd,CAAyB,KAAKnH,UAAL,IAAmBqH,mBAAnB,IAA0CtC,YAAnE;;AACA,SAAKyC,WAAL,CAAiBL,UAAjB,CAA4B,KAAKnH,UAAL,IAAmB,KAAKC,iBAAxB,IAA6CoH,mBAAzE;;AACA,SAAKI,cAAL,CAAoBN,UAApB,CAA+B,KAAKnH,UAAL,IAAmB,KAAKC,iBAAxB,IAA6CoH,mBAA5E;;AACAtO,IAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B,gBAA/B,EAAiD,KAAK1D,iBAAtD;;AACA,SAAKyH,iBAAL,CAAuBxC,WAAvB,CAAmC,uBAAnC,EAA4D,CAAC,KAAKjF,iBAAlE;;AACA,SAAKyH,iBAAL,CAAuBxC,WAAvB,CAAmC,sBAAnC,EAA2D,KAAKjF,iBAAhE;;AACA,SAAKyH,iBAAL,CAAuBC,WAAvB,CAAmC,KAAK1H,iBAAxC;;AACA,QAAI2H,UAAU,GAAG,CAAC,KAAKtI,WAAL,CAAiB2B,SAAjB,CAA2B;AAAG;AAA9B,KAAlB;;AACA,SAAKyG,iBAAL,CAAuBP,UAAvB,CAAkC,KAAKnH,UAAL,IAAmB4H,UAArD;AACH,GAjBD;;AAkBApJ,EAAAA,UAAU,CAAC5F,SAAX,CAAqBqL,OAArB,GAA+B,YAAY;AACvC,QAAI9E,KAAK,GAAG,IAAZ;;AACA,QAAI,CAAC,KAAKa,UAAV,EAAsB;AAClB,WAAKA,UAAL,GAAkB,IAAlB;;AACA,UAAI2G,SAAS,GAAG,KAAKrH,WAAL,CAAiBsH,YAAjB,EAAhB;;AACA,cAAQ,KAAKtH,WAAL,CAAiB2B,SAAjB,CAA2B;AAAG;AAA9B,QAA0C4G,mBAAlD;AACI,aAAK,QAAL;AACI,eAAKhD,oBAAL,CAA0BC,OAA1B,GAAoC,IAApC;AACA;;AACJ,aAAK,OAAL;AACI,eAAKD,oBAAL,CAA0BC,OAA1B,GAAoC,KAApC;AACA;;AACJ,aAAK,WAAL;AACI,cAAIgD,uBAAuB,GAAG,CAAC,CAACnB,SAAF,IAAeA,SAAS,CAACF,eAAV,KAA8BE,SAAS,CAACG,aAArF;AACA,eAAKjC,oBAAL,CAA0BC,OAA1B,GAAoCgD,uBAApC;AACA;;AACJ;AACI;AAZR;;AAcA,WAAKnH,qBAAL;;AACA,WAAKD,cAAL;;AACA6C,MAAAA,UAAU,CAAC,YAAY;AACnBxK,QAAAA,GAAG,CAACgP,QAAJ,CAAa5I,KAAK,CAACwE,QAAnB,EAA6B,SAA7B;;AACAxE,QAAAA,KAAK,CAACwE,QAAN,CAAeqE,YAAf,CAA4B,aAA5B,EAA2C,OAA3C;AACH,OAHS,EAGP,CAHO,CAAV,CAnBkB,CAuBlB;;AACAzE,MAAAA,UAAU,CAAC,YAAY;AACnBpE,QAAAA,KAAK,CAACyB,UAAN,CAAiBqH,QAAjB;AACH,OAFS,EAEP,GAFO,CAAV;;AAGA,WAAK3I,WAAL,CAAiB4I,mBAAjB,CAAqC,IAArC;;AACA,UAAIC,qBAAqB,GAAG,IAA5B;;AACA,UAAI,KAAK7I,WAAL,CAAiB2B,SAAjB,CAA2B;AAAG;AAA9B,QAA0CmH,6BAA1C,IAA2EzB,SAA/E,EAA0F;AACtF,YAAIlJ,OAAO,GAAG,KAAK6B,WAAL,CAAiBoE,UAAjB,EAAd;;AACA,YAAIjG,OAAJ,EAAa;AACT,cAAI4K,YAAY,GAAGtP,GAAG,CAACuP,sBAAJ,CAA2B7K,OAA3B,CAAnB;;AACA,cAAI8K,WAAW,GAAG,KAAKjJ,WAAL,CAAiBkJ,0BAAjB,CAA4C7B,SAAS,CAAC8B,gBAAV,EAA5C,CAAlB;;AACA,cAAIC,SAAS,GAAGL,YAAY,CAACM,IAAb,IAAqBJ,WAAW,GAAGA,WAAW,CAACI,IAAf,GAAsB,CAAtD,CAAhB;AACA,cAAIC,QAAQ,GAAGL,WAAW,GAAGA,WAAW,CAACM,GAAf,GAAqB,CAA/C;;AACA,cAAI,KAAKvH,SAAL,IAAkBsH,QAAQ,GAAG,KAAKtH,SAAL,CAAe/D,UAAhD,EAA4D;AACxD,gBAAIoJ,SAAS,CAACG,aAAV,GAA0BH,SAAS,CAACF,eAAxC,EAAyD;AACrD0B,cAAAA,qBAAqB,GAAG,KAAxB;AACH;;AACD,gBAAIW,gBAAgB,GAAG/P,GAAG,CAACgQ,gBAAJ,CAAqB,KAAKpF,QAA1B,EAAoCgF,IAA3D;;AACA,gBAAID,SAAS,GAAGI,gBAAhB,EAAkC;AAC9BX,cAAAA,qBAAqB,GAAG,KAAxB;AACH;;AACD,gBAAIa,SAAS,GAAG,KAAK1J,WAAL,CAAiBkJ,0BAAjB,CAA4C7B,SAAS,CAACsC,cAAV,EAA5C,CAAhB;;AACA,gBAAIC,OAAO,GAAGb,YAAY,CAACM,IAAb,IAAqBK,SAAS,GAAGA,SAAS,CAACL,IAAb,GAAoB,CAAlD,CAAd;;AACA,gBAAIO,OAAO,GAAGJ,gBAAd,EAAgC;AAC5BX,cAAAA,qBAAqB,GAAG,KAAxB;AACH;AACJ;AACJ;AACJ;;AACD,WAAK5G,aAAL,CAAmB4G,qBAAnB;AACH;AACJ,GAxDD;;AAyDA3J,EAAAA,UAAU,CAAC5F,SAAX,CAAqBsL,KAArB,GAA6B,UAAUiF,cAAV,EAA0B;AACnD,QAAI,KAAKnJ,UAAT,EAAqB;AACjB,WAAKA,UAAL,GAAkB,KAAlB;;AACA,WAAKU,cAAL;;AACA3H,MAAAA,GAAG,CAACqQ,WAAJ,CAAgB,KAAKzF,QAArB,EAA+B,SAA/B;;AACA,WAAKA,QAAL,CAAcqE,YAAd,CAA2B,aAA3B,EAA0C,MAA1C;;AACA,WAAKpH,UAAL,CAAgByI,YAAhB;;AACA,UAAIF,cAAJ,EAAoB;AAChB,aAAK7J,WAAL,CAAiBgK,KAAjB;AACH;;AACD,WAAKhK,WAAL,CAAiB4I,mBAAjB,CAAqC,IAArC;;AACA,WAAK1G,eAAL;AACH;AACJ,GAbD;;AAcAhD,EAAAA,UAAU,CAAC5F,SAAX,CAAqB0K,eAArB,GAAuC,YAAY;AAC/C,QAAInE,KAAK,GAAG,IAAZ;;AACA,QAAIkC,kBAAkB,GAAG,KAAK/B,WAAL,CAAiB2B,SAAjB,CAA2B;AAAG;AAA9B,MAA0CI,kBAAnE;;AACA,QAAI,CAACA,kBAAL,EAAyB;AACrB,WAAKG,eAAL;;AACA;AACH;;AACD,QAAI,CAAC,KAAKxB,UAAV,EAAsB;AAClB;AACH;;AACD,QAAIuJ,QAAQ,GAAG,KAAKjI,SAApB;;AACA,QAAI,KAAK4B,WAAL,KAAqBC,SAArB,IAAkC,CAACoG,QAAvC,EAAiD;AAC7C;AACH;;AACD,SAAKjK,WAAL,CAAiBkK,eAAjB,CAAiC,UAAUC,QAAV,EAAoB;AACjDF,MAAAA,QAAQ,CAAChM,UAAT,GAAsB4B,KAAK,CAACuK,UAAN,EAAtB;AACAvK,MAAAA,KAAK,CAAC+D,WAAN,GAAoBuG,QAAQ,CAACE,OAAT,CAAiBJ,QAAjB,CAApB,CAFiD,CAGjD;;AACApK,MAAAA,KAAK,CAACG,WAAN,CAAkBsK,YAAlB,CAA+BzK,KAAK,CAACG,WAAN,CAAkBuK,YAAlB,KAAmCN,QAAQ,CAAChM,UAA3E;AACH,KALD;AAMH,GApBD;;AAqBAiB,EAAAA,UAAU,CAAC5F,SAAX,CAAqB2I,aAArB,GAAqC,UAAUuI,YAAV,EAAwB;AACzD,QAAI3K,KAAK,GAAG,IAAZ;;AACA,QAAI2K,YAAY,KAAK,KAAK,CAA1B,EAA6B;AAAEA,MAAAA,YAAY,GAAG,IAAf;AAAsB;;AACrD,QAAI,CAAC,KAAK9J,UAAV,EAAsB;AAClB;AACH;;AACD,QAAIqB,kBAAkB,GAAG,KAAK/B,WAAL,CAAiB2B,SAAjB,CAA2B;AAAG;AAA9B,MAA0CI,kBAAnE;;AACA,QAAI,CAACA,kBAAL,EAAyB;AACrB;AACH;;AACD,QAAI,KAAKC,SAAL,KAAmB6B,SAAvB,EAAkC;AAC9B,WAAK7B,SAAL,GAAiB,IAAIjE,kBAAJ,CAAuB,CAAvB,CAAjB;AACH;;AACD,QAAIkM,QAAQ,GAAG,KAAKjI,SAApB;;AACA,SAAKhC,WAAL,CAAiBkK,eAAjB,CAAiC,UAAUC,QAAV,EAAoB;AACjD,UAAItK,KAAK,CAAC+D,WAAN,KAAsBC,SAA1B,EAAqC;AACjC;AACA,YAAI4G,SAAS,GAAG5K,KAAK,CAACuK,UAAN,EAAhB;;AACA,YAAIK,SAAS,KAAKR,QAAQ,CAAChM,UAA3B,EAAuC;AACnC;AACH;;AACD,YAAIyM,gBAAgB,GAAGD,SAAS,GAAGR,QAAQ,CAAChM,UAA5C;AACAgM,QAAAA,QAAQ,CAAChM,UAAT,GAAsBwM,SAAtB;AACAN,QAAAA,QAAQ,CAACQ,UAAT,CAAoB9K,KAAK,CAAC+D,WAA1B;;AACA,YAAI4G,YAAJ,EAAkB;AACd3K,UAAAA,KAAK,CAACG,WAAN,CAAkBsK,YAAlB,CAA+BzK,KAAK,CAACG,WAAN,CAAkBuK,YAAlB,KAAmCG,gBAAlE;AACH;;AACD;AACH,OAbD,MAcK;AACD,YAAIA,gBAAgB,GAAG7K,KAAK,CAACuK,UAAN,EAAvB;;AACAH,QAAAA,QAAQ,CAAChM,UAAT,GAAsByM,gBAAtB;AACA7K,QAAAA,KAAK,CAAC+D,WAAN,GAAoBuG,QAAQ,CAACE,OAAT,CAAiBJ,QAAjB,CAApB;;AACA,YAAIO,YAAJ,EAAkB;AACd3K,UAAAA,KAAK,CAACG,WAAN,CAAkBsK,YAAlB,CAA+BzK,KAAK,CAACG,WAAN,CAAkBuK,YAAlB,KAAmCG,gBAAlE;AACH;AACJ;AACJ,KAvBD;AAwBH,GAtCD;;AAuCAxL,EAAAA,UAAU,CAAC5F,SAAX,CAAqB4I,eAArB,GAAuC,YAAY;AAC/C,QAAIrC,KAAK,GAAG,IAAZ;;AACA,SAAKG,WAAL,CAAiBkK,eAAjB,CAAiC,UAAUC,QAAV,EAAoB;AACjD,UAAItK,KAAK,CAAC+D,WAAN,KAAsBC,SAA1B,EAAqC;AACjCsG,QAAAA,QAAQ,CAACS,UAAT,CAAoB/K,KAAK,CAAC+D,WAA1B;AACA/D,QAAAA,KAAK,CAAC+D,WAAN,GAAoBC,SAApB;;AACA,YAAIhE,KAAK,CAACmC,SAAV,EAAqB;AACjBnC,UAAAA,KAAK,CAACG,WAAN,CAAkBsK,YAAlB,CAA+BzK,KAAK,CAACG,WAAN,CAAkBuK,YAAlB,KAAmC1K,KAAK,CAACmC,SAAN,CAAgB/D,UAAlF;;AACA4B,UAAAA,KAAK,CAACmC,SAAN,GAAkB6B,SAAlB;AACH;AACJ;AACJ,KATD;AAUH,GAZD;;AAaA3E,EAAAA,UAAU,CAAC5F,SAAX,CAAqBiK,WAArB,GAAmC,UAAUsH,KAAV,EAAiB;AAChD,QAAIC,WAAW,GAAG;AACd1P,MAAAA,uBAAuB,EAAEyP,KAAK,CAACE,QAAN,CAAe3P,uBAAf,CADX;AAEdC,MAAAA,2BAA2B,EAAEwP,KAAK,CAACE,QAAN,CAAe1P,2BAAf,CAFf;AAGdC,MAAAA,eAAe,EAAEuP,KAAK,CAACE,QAAN,CAAezP,eAAf,CAHH;AAIdE,MAAAA,eAAe,EAAEqP,KAAK,CAACE,QAAN,CAAevP,eAAf,CAJH;AAKdD,MAAAA,WAAW,EAAEsP,KAAK,CAACE,QAAN,CAAexP,WAAf,CALC;AAMdK,MAAAA,6BAA6B,EAAEiP,KAAK,CAACE,QAAN,CAAenP,6BAAf,CANjB;AAOdE,MAAAA,6BAA6B,EAAE+O,KAAK,CAACE,QAAN,CAAejP,6BAAf,CAPjB;AAQdD,MAAAA,yBAAyB,EAAEgP,KAAK,CAACE,QAAN,CAAelP,yBAAf,CARb;AASdE,MAAAA,gCAAgC,EAAE8O,KAAK,CAACE,QAAN,CAAehP,gCAAf,CATpB;AAUdE,MAAAA,gCAAgC,EAAE4O,KAAK,CAACE,QAAN,CAAe9O,gCAAf,CAVpB;AAWdD,MAAAA,4BAA4B,EAAE6O,KAAK,CAACE,QAAN,CAAe/O,4BAAf,CAXhB;AAYdP,MAAAA,8BAA8B,EAAEoP,KAAK,CAACE,QAAN,CAAetP,8BAAf,CAZlB;AAadE,MAAAA,8BAA8B,EAAEkP,KAAK,CAACE,QAAN,CAAepP,8BAAf,CAblB;AAcdD,MAAAA,0BAA0B,EAAEmP,KAAK,CAACE,QAAN,CAAerP,0BAAf;AAdd,KAAlB;;AAgBA,SAAK4F,UAAL,CAAgB+E,KAAhB,CAAsByE,WAAtB;;AACA,SAAKzH,aAAL,CAAmBgD,KAAnB,CAAyByE,WAAzB;;AACA,SAAKvF,oBAAL,CAA0Bc,KAA1B,CAAgCyE,WAAhC;AACH,GApBD;;AAqBA5L,EAAAA,UAAU,CAAC5F,SAAX,CAAqB+H,qBAArB,GAA6C,YAAY;AACrD,QAAI,CAAC,KAAKX,UAAV,EAAsB;AAClB;AACH;;AACD,QAAI,CAACjH,GAAG,CAACuR,OAAJ,CAAY,KAAK3G,QAAjB,CAAL,EAAiC;AAC7B;AACA;AACH;;AACD,QAAI4G,UAAU,GAAG,KAAKjL,WAAL,CAAiBkL,aAAjB,EAAjB;;AACA,QAAIC,kBAAkB,GAAGF,UAAU,CAACG,YAApC;;AACA,QAAID,kBAAkB,IAAI,CAA1B,EAA6B;AACzB;AACA1R,MAAAA,GAAG,CAACgP,QAAJ,CAAa,KAAKpE,QAAlB,EAA4B,cAA5B;AACA;AACH,KAJD,MAKK,IAAI5K,GAAG,CAAC4R,QAAJ,CAAa,KAAKhH,QAAlB,EAA4B,cAA5B,CAAJ,EAAiD;AAClD5K,MAAAA,GAAG,CAACqQ,WAAJ,CAAgB,KAAKzF,QAArB,EAA+B,cAA/B;AACH;;AACD,QAAIiH,WAAW,GAAGL,UAAU,CAACpG,KAA7B;AACA,QAAI0G,YAAY,GAAGN,UAAU,CAACM,YAA9B;AACA,QAAIC,mBAAmB,GAAG,KAA1B;AACA,QAAIC,iBAAiB,GAAG,KAAxB;AACA,QAAIC,gBAAgB,GAAG,KAAvB;;AACA,QAAI,KAAKC,QAAT,EAAmB;AACf,UAAIC,WAAW,GAAGnS,GAAG,CAACqL,aAAJ,CAAkB,KAAKT,QAAvB,CAAlB;;AACA,UAAIuH,WAAW,GAAGrO,yBAAlB,EAA6C;AACzC;AACA,aAAK8G,QAAL,CAAcgC,KAAd,CAAoBwF,QAApB,GAA+BP,WAAW,GAAG,EAAd,GAAmBC,YAAnB,GAAkC,EAAlC,GAAuC,IAAtE;AACA,aAAKlI,aAAL,CAAmBwB,KAAnB,GAA2BpL,GAAG,CAACqL,aAAJ,CAAkB,KAAKxD,UAAL,CAAgBnD,OAAlC,CAA3B;AACA;AACH;AACJ;;AACD,QAAIZ,yBAAyB,GAAG,EAA5B,GAAiCgO,YAAjC,IAAiDD,WAArD,EAAkE;AAC9DG,MAAAA,iBAAiB,GAAG,IAApB;AACH;;AACD,QAAIlO,yBAAyB,GAAG,EAA5B,GAAiCgO,YAAjC,GAAgD7N,uBAAhD,IAA2E4N,WAA/E,EAA4F;AACxFI,MAAAA,gBAAgB,GAAG,IAAnB;AACH;;AACD,QAAInO,yBAAyB,GAAG,EAA5B,GAAiCgO,YAAjC,GAAgD7N,uBAAhD,IAA2E4N,WAAW,GAAG,EAA7F,EAAiG;AAC7FE,MAAAA,mBAAmB,GAAG,IAAtB;AACH;;AACD/R,IAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B,uBAA/B,EAAwDmH,mBAAxD;AACA/R,IAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B,oBAA/B,EAAqDqH,gBAArD;AACAjS,IAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B,qBAA/B,EAAsDoH,iBAAtD;;AACA,QAAI,CAACC,gBAAD,IAAqB,CAACF,mBAA1B,EAA+C;AAC3C;AACA,WAAKnH,QAAL,CAAcgC,KAAd,CAAoBwF,QAApB,GAA+BP,WAAW,GAAG,EAAd,GAAmBC,YAAnB,GAAkC,EAAlC,GAAuC,IAAtE;AACH;;AACD,QAAI,KAAKI,QAAT,EAAmB;AACf,WAAKrK,UAAL,CAAgBC,QAAhB,CAAyBC,MAAzB;;AACA,UAAIsK,cAAc,GAAG,KAAKxK,UAAL,CAAgBC,QAAhB,CAAyBwK,OAAzB,CAAiC7E,WAAtD;;AACA,UAAI4E,cAAc,GAAG,CAArB,EAAwB;AACpB,aAAKzI,aAAL,CAAmBwB,KAAnB,GAA2BiH,cAA3B;AACH;AACJ,KAND,MAOK,IAAI,KAAKnL,iBAAT,EAA4B;AAC7B,WAAK0C,aAAL,CAAmBwB,KAAnB,GAA2BpL,GAAG,CAACqL,aAAJ,CAAkB,KAAKxD,UAAL,CAAgBnD,OAAlC,CAA3B;AACH;AACJ,GA1DD;;AA2DAe,EAAAA,UAAU,CAAC5F,SAAX,CAAqB8Q,UAArB,GAAkC,YAAY;AAC1C,QAAI4B,WAAW,GAAG,CAAlB,CAD0C,CAE1C;;AACAA,IAAAA,WAAW,IAAI,CAAf,CAH0C,CAI1C;;AACAA,IAAAA,WAAW,IAAI,KAAK1K,UAAL,CAAgBC,QAAhB,CAAyB0K,MAAzB,GAAkC;AAAE;AAAnD;;AACA,QAAI,KAAKtL,iBAAT,EAA4B;AACxB;AACAqL,MAAAA,WAAW,IAAI,CAAf;AACAA,MAAAA,WAAW,IAAI,KAAK3I,aAAL,CAAmB9B,QAAnB,CAA4B0K,MAA5B,GAAqC;AAAE;AAAtD;AACH,KAVyC,CAW1C;;;AACAD,IAAAA,WAAW,IAAI,CAAf;AACA,WAAOA,WAAP;AACH,GAdD;;AAeA9M,EAAAA,UAAU,CAAC5F,SAAX,CAAqByL,gBAArB,GAAwC,YAAY;AAChD,QAAImH,WAAW,GAAG,KAAK9B,UAAL,EAAlB;;AACA,QAAI,KAAKrK,aAAL,KAAuB,IAAvB,IAA+B,KAAKA,aAAL,KAAuBmM,WAA1D,EAAuE;AACnE,aAAO,KAAP;AACH;;AACD,SAAKnM,aAAL,GAAqBmM,WAArB;AACA,SAAK7H,QAAL,CAAcgC,KAAd,CAAoB4F,MAApB,GAA6BC,WAAW,GAAG,IAA3C;AACA,WAAO,IAAP;AACH,GARD,CAzgB8C,CAkhB9C;;;AACAhN,EAAAA,UAAU,CAAC5F,SAAX,CAAqB6S,cAArB,GAAsC,YAAY;AAC9C,SAAK7K,UAAL,CAAgBmB,MAAhB,GAD8C,CAE9C;;;AACA,SAAKnB,UAAL,CAAgB0I,KAAhB;AACH,GAJD;;AAKA9K,EAAAA,UAAU,CAAC5F,SAAX,CAAqB8S,iBAArB,GAAyC,YAAY;AACjD,SAAK/I,aAAL,CAAmBZ,MAAnB,GADiD,CAEjD;;;AACA,SAAKY,aAAL,CAAmB2G,KAAnB;AACH,GAJD;;AAKA9K,EAAAA,UAAU,CAAC5F,SAAX,CAAqB+S,oBAArB,GAA4C,YAAY;AACpD,SAAK/K,UAAL,CAAgB+K,oBAAhB;AACH,GAFD;;AAGAnN,EAAAA,UAAU,CAAC5F,SAAX,CAAqB2J,kBAArB,GAA0C,YAAY;AAClD,QAAI,CAAC,KAAKjD,WAAL,CAAiBsM,QAAjB,EAAL,EAAkC;AAC9B;AACH;;AACD,QAAI,KAAK/G,oBAAL,CAA0BC,OAA9B,EAAuC;AACnC,UAAI6B,SAAS,GAAG,KAAKrH,WAAL,CAAiBsH,YAAjB,EAAhB;;AACA,UAAID,SAAS,CAACI,SAAV,KAAwB,CAAxB,IAA6BJ,SAAS,CAACG,aAAV,GAA0BH,SAAS,CAACF,eAArE,EAAsF;AAClFE,QAAAA,SAAS,GAAGA,SAAS,CAACkF,cAAV,CAAyBlF,SAAS,CAACG,aAAV,GAA0B,CAAnD,EAAsD,KAAKxH,WAAL,CAAiBwM,QAAjB,GAA4BC,gBAA5B,CAA6CpF,SAAS,CAACG,aAAV,GAA0B,CAAvE,CAAtD,CAAZ;AACH;;AACD,UAAI1B,YAAY,GAAG,KAAK5F,MAAL,CAAY4F,YAA/B;;AACA,UAAIuB,SAAS,CAACF,eAAV,KAA8BE,SAAS,CAACG,aAA5C,EAA2D;AACvD,YAAI,CAACpN,KAAK,CAACsS,WAAN,CAAkBrF,SAAlB,EAA6BvB,YAA7B,CAAL,EAAiD;AAC7C;AACA,eAAK5F,MAAL,CAAY0B,MAAZ,CAAmB;AAAE0D,YAAAA,WAAW,EAAE+B;AAAf,WAAnB,EAA+C,IAA/C;AACH;AACJ;AACJ;AACJ,GAjBD;;AAkBAnI,EAAAA,UAAU,CAAC5F,SAAX,CAAqBqT,qBAArB,GAA6C,UAAU1L,CAAV,EAAa;AACtD;AACA,QAAIA,CAAC,CAAC2L,YAAN,EAAoB;AAChB3L,MAAAA,CAAC,CAACnC,eAAF;AACH;AACJ,GALD;;AAMAI,EAAAA,UAAU,CAAC5F,SAAX,CAAqBuT,mBAArB,GAA2C,UAAU5L,CAAV,EAAa;AACpD,QAAIA,CAAC,CAAC6L,MAAF,CAASjP,UAAU,GAAG;AAAE;AAAxB,KAAJ,EAA0C;AACtC,WAAKyD,UAAL,CAAgBC,QAAhB,CAAyBwL,cAAzB,CAAwC,IAAxC;;AACA9L,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAE;AAAX,KAAJ,EAA2B;AACvB,UAAI,KAAKnM,iBAAT,EAA4B;AACxB,aAAK0C,aAAL,CAAmB2G,KAAnB;AACH,OAFD,MAGK;AACD,aAAK1I,UAAL,CAAgB2L,oBAAhB;AACH;;AACDhM,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAK;AAAL,MAAqB;AAAG;AAAjC,KAAJ,EAAuD;AACnD,WAAK9M,WAAL,CAAiBgK,KAAjB;;AACA/I,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAG;AAAZ,KAAJ,EAAgC;AAC5B,aAAOvO,kCAAkC,CAAC0C,CAAD,EAAI,KAAKK,UAAL,CAAgB4L,QAAhB,EAAJ,EAAgC,KAAK5L,UAAL,CAAgBnD,OAAhB,CAAwBgP,aAAxB,CAAsC,UAAtC,CAAhC,CAAzC;AACH;;AACD,QAAIlM,CAAC,CAAC6L,MAAF,CAAS;AAAG;AAAZ,KAAJ,EAAkC;AAC9B,aAAO/N,oCAAoC,CAACkC,CAAD,EAAI,KAAKK,UAAL,CAAgB4L,QAAhB,EAAJ,EAAgC,KAAK5L,UAAL,CAAgBnD,OAAhB,CAAwBgP,aAAxB,CAAsC,UAAtC,CAAhC,CAA3C;AACH;AACJ,GA3BD;;AA4BAjO,EAAAA,UAAU,CAAC5F,SAAX,CAAqB8T,sBAArB,GAA8C,UAAUnM,CAAV,EAAa;AACvD,QAAIA,CAAC,CAAC6L,MAAF,CAASjP,UAAU,GAAG;AAAE;AAAxB,KAAJ,EAA0C;AACtC,UAAI3D,QAAQ,CAACmT,SAAT,IAAsBnT,QAAQ,CAACoT,QAA/B,IAA2C,CAAC,KAAK9M,mCAArD,EAA0F;AACtF;AACA,aAAKD,oBAAL,CAA0BgN,IAA1B,CAA+B/T,GAAG,CAACiD,QAAJ,CAAa,6BAAb,EAA4C,mJAA5C,CAA/B;;AACA,aAAK+D,mCAAL,GAA2C,IAA3C;;AACA,aAAKF,eAAL,CAAqBkN,KAArB,CAA2B5P,qCAA3B,EAAkE,IAAlE,EAAwE;AAAE;AAA1E;AACH;;AACD,WAAKyF,aAAL,CAAmB9B,QAAnB,CAA4BwL,cAA5B,CAA2C,IAA3C;;AACA9L,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAE;AAAX,KAAJ,EAA2B;AACvB,WAAKxL,UAAL,CAAgB2L,oBAAhB;;AACAhM,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAK;AAAL,MAAmB;AAAE;AAA9B,KAAJ,EAA8C;AAC1C,WAAKxL,UAAL,CAAgB0I,KAAhB;;AACA/I,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAK;AAAL,MAAqB;AAAG;AAAjC,KAAJ,EAAuD;AACnD,WAAK9M,WAAL,CAAiBgK,KAAjB;;AACA/I,MAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,QAAI/L,CAAC,CAAC6L,MAAF,CAAS;AAAG;AAAZ,KAAJ,EAAgC;AAC5B,aAAOvO,kCAAkC,CAAC0C,CAAD,EAAI,KAAKoC,aAAL,CAAmB9B,QAAnB,CAA4B9C,KAAhC,EAAuC,KAAK4E,aAAL,CAAmB9B,QAAnB,CAA4BwK,OAA5B,CAAoCoB,aAApC,CAAkD,UAAlD,CAAvC,CAAzC;AACH;;AACD,QAAIlM,CAAC,CAAC6L,MAAF,CAAS;AAAG;AAAZ,KAAJ,EAAkC;AAC9B,aAAO/N,oCAAoC,CAACkC,CAAD,EAAI,KAAKoC,aAAL,CAAmB9B,QAAnB,CAA4B9C,KAAhC,EAAuC,KAAK4E,aAAL,CAAmB9B,QAAnB,CAA4BwK,OAA5B,CAAoCoB,aAApC,CAAkD,UAAlD,CAAvC,CAA3C;AACH;AACJ,GAjCD,CAplB8C,CAsnB9C;;;AACAjO,EAAAA,UAAU,CAAC5F,SAAX,CAAqBmU,oBAArB,GAA4C,UAAUC,KAAV,EAAiB;AACzD,WAAO,CAAP;AACH,GAFD;;AAGAxO,EAAAA,UAAU,CAAC5F,SAAX,CAAqBqU,qBAArB,GAA6C,UAAUD,KAAV,EAAiB;AAC1D,WAAO,CAAP;AACH,GAFD;;AAGAxO,EAAAA,UAAU,CAAC5F,SAAX,CAAqBsU,sBAArB,GAA8C,UAAUF,KAAV,EAAiB;AAC3D,WAAO,GAAP;AACH,GAFD,CA7nB8C,CAgoB9C;;;AACAxO,EAAAA,UAAU,CAAC5F,SAAX,CAAqBuU,mBAArB,GAA2C,UAAUC,QAAV,EAAoB;AAC3D,QAAIC,EAAE,GAAG,KAAK3N,kBAAL,CAAwB4N,gBAAxB,CAAyCF,QAAzC,CAAT;;AACA,QAAI,CAACC,EAAL,EAAS;AACL,aAAO,EAAP;AACH;;AACD,WAAO,OAAOA,EAAE,CAACE,QAAH,EAAP,GAAuB,GAA9B;AACH,GAND;;AAOA/O,EAAAA,UAAU,CAAC5F,SAAX,CAAqB6H,aAArB,GAAqC,YAAY;AAC7C,QAAItB,KAAK,GAAG,IAAZ;;AACA,QAAIqO,cAAc,GAAG,IAArB;AACA,QAAIC,aAAa,GAAG,IAApB,CAH6C,CAI7C;;AACA,SAAK7M,UAAL,GAAkB,KAAKR,SAAL,CAAe,IAAIxE,sBAAJ,CAA2B,IAA3B,EAAiC,KAAK6D,oBAAtC,EAA4D;AACzF0E,MAAAA,KAAK,EAAEpH,qBADkF;AAEzFiJ,MAAAA,KAAK,EAAElK,oBAFkF;AAGzF4R,MAAAA,WAAW,EAAE1R,0BAH4E;AAIzF2R,MAAAA,wBAAwB,EAAE,KAAKR,mBAAL,CAAyBtT,QAAQ,CAAC+T,0BAAlC,CAJ+D;AAKzFC,MAAAA,qBAAqB,EAAE,KAAKV,mBAAL,CAAyBtT,QAAQ,CAACiU,sBAAlC,CALkE;AAMzFC,MAAAA,gBAAgB,EAAE,KAAKZ,mBAAL,CAAyBtT,QAAQ,CAACmU,kBAAlC,CANuE;AAOzFC,MAAAA,UAAU,EAAE,UAAUlQ,KAAV,EAAiB;AACzB,YAAIA,KAAK,CAACQ,MAAN,KAAiB,CAAjB,IAAsB,CAACY,KAAK,CAACyB,UAAN,CAAiBsN,QAAjB,EAA3B,EAAwD;AACpD,iBAAO,IAAP;AACH;;AACD,YAAI;AACA,cAAIC,MAAJ,CAAWpQ,KAAX;AACA,iBAAO,IAAP;AACH,SAHD,CAIA,OAAOwC,CAAP,EAAU;AACN,iBAAO;AAAE6N,YAAAA,OAAO,EAAE7N,CAAC,CAAC8N;AAAb,WAAP;AACH;AACJ,OAlBwF;AAmBzFb,MAAAA,cAAc,EAAEA,cAnByE;AAoBzFC,MAAAA,aAAa,EAAEA,aApB0E;AAqBzFa,MAAAA,iBAAiB,EAAE;AArBsE,KAA5D,EAsB9B,KAAK3O,kBAtByB,EAsBL,IAtBK,CAAf,CAAlB;;AAuBA,SAAKiB,UAAL,CAAgB2D,QAAhB,CAAyB,CAAC,CAAC,KAAK/E,MAAL,CAAY8E,OAAvC;;AACA,SAAK1D,UAAL,CAAgB+D,gBAAhB,CAAiC,CAAC,CAAC,KAAKnF,MAAL,CAAYkF,SAA/C;;AACA,SAAK9D,UAAL,CAAgB6D,aAAhB,CAA8B,CAAC,CAAC,KAAKjF,MAAL,CAAYgF,SAA5C;;AACA,SAAKpE,SAAL,CAAe,KAAKQ,UAAL,CAAgB2N,SAAhB,CAA0B,UAAUhO,CAAV,EAAa;AAAE,aAAOpB,KAAK,CAACgN,mBAAN,CAA0B5L,CAA1B,CAAP;AAAsC,KAA/E,CAAf;;AACA,SAAKH,SAAL,CAAe,KAAKQ,UAAL,CAAgBC,QAAhB,CAAyB2N,WAAzB,CAAqC,YAAY;AAC5D,UAAIrP,KAAK,CAACe,kBAAV,EAA8B;AAC1B;AACH;;AACDf,MAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAEY,QAAAA,YAAY,EAAE3C,KAAK,CAACyB,UAAN,CAAiB4L,QAAjB;AAAhB,OAApB,EAAmE,IAAnE;AACH,KALc,CAAf;;AAMA,SAAKpM,SAAL,CAAe,KAAKQ,UAAL,CAAgB6N,iBAAhB,CAAkC,YAAY;AACzDtP,MAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAChBoD,QAAAA,OAAO,EAAEnF,KAAK,CAACyB,UAAN,CAAiBsN,QAAjB,EADO;AAEhB1J,QAAAA,SAAS,EAAErF,KAAK,CAACyB,UAAN,CAAiB8N,aAAjB,EAFK;AAGhBhK,QAAAA,SAAS,EAAEvF,KAAK,CAACyB,UAAN,CAAiB+N,gBAAjB;AAHK,OAApB,EAIG,IAJH;AAKH,KANc,CAAf;;AAOA,SAAKvO,SAAL,CAAe,KAAKQ,UAAL,CAAgBgO,sBAAhB,CAAuC,UAAUrO,CAAV,EAAa;AAC/D,UAAIA,CAAC,CAAC6L,MAAF,CAAS;AAAK;AAAL,QAAmB;AAAE;AAA9B,OAAJ,EAA8C;AAC1C,YAAIjN,KAAK,CAACc,iBAAV,EAA6B;AACzBd,UAAAA,KAAK,CAACwD,aAAN,CAAoB2G,KAApB;;AACA/I,UAAAA,CAAC,CAAC+L,cAAF;AACH;AACJ;AACJ,KAPc,CAAf;;AAQA,SAAKlM,SAAL,CAAe,KAAKQ,UAAL,CAAgBiO,cAAhB,CAA+B,UAAUtO,CAAV,EAAa;AACvD,UAAIA,CAAC,CAAC6L,MAAF,CAAS;AAAE;AAAX,OAAJ,EAA2B;AACvB,YAAIjN,KAAK,CAACc,iBAAV,EAA6B;AACzBd,UAAAA,KAAK,CAACwD,aAAN,CAAoBmM,eAApB;;AACAvO,UAAAA,CAAC,CAAC+L,cAAF;AACH;AACJ;AACJ,KAPc,CAAf;;AAQA,SAAKlM,SAAL,CAAe,KAAKQ,UAAL,CAAgBC,QAAhB,CAAyBkO,iBAAzB,CAA2C,UAAUxO,CAAV,EAAa;AACnE,UAAIpB,KAAK,CAACkF,gBAAN,EAAJ,EAA8B;AAC1BlF,QAAAA,KAAK,CAACoC,aAAN;AACH;AACJ,KAJc,CAAf;;AAKA,QAAI/H,QAAQ,CAACwV,OAAb,EAAsB;AAClB,WAAK5O,SAAL,CAAe,KAAKQ,UAAL,CAAgBqO,WAAhB,CAA4B,UAAU1O,CAAV,EAAa;AAAE,eAAOpB,KAAK,CAAC8M,qBAAN,CAA4B1L,CAA5B,CAAP;AAAwC,OAAnF,CAAf;AACH;;AACD,SAAKmF,aAAL,GAAqBhI,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAArB;AACA,SAAK+H,aAAL,CAAmB9H,SAAnB,GAA+B,cAA/B;;AACA,SAAKuH,mBAAL,GAvE6C,CAwE7C;;;AACA,SAAKmC,QAAL,GAAgB,KAAKlH,SAAL,CAAe,IAAI8O,YAAJ,CAAiB;AAC5ClJ,MAAAA,KAAK,EAAE/J,4BAA4B,GAAG,KAAKkR,mBAAL,CAAyBtT,QAAQ,CAACsV,uBAAlC,CADM;AAE5CvR,MAAAA,SAAS,EAAE,0BAFiC;AAG5CwR,MAAAA,SAAS,EAAE,YAAY;AACnBjQ,QAAAA,KAAK,CAACG,WAAN,CAAkB+P,SAAlB,CAA4BxV,QAAQ,CAACsV,uBAArC,EAA8DG,GAA9D,GAAoEC,IAApE,CAAyEpM,SAAzE,EAAoF7J,iBAApF;AACH;AAL2C,KAAjB,CAAf,CAAhB,CAzE6C,CAgF7C;;AACA,SAAKiO,QAAL,GAAgB,KAAKnH,SAAL,CAAe,IAAI8O,YAAJ,CAAiB;AAC5ClJ,MAAAA,KAAK,EAAE9J,wBAAwB,GAAG,KAAKiR,mBAAL,CAAyBtT,QAAQ,CAAC2V,mBAAlC,CADU;AAE5C5R,MAAAA,SAAS,EAAE,4BAFiC;AAG5CwR,MAAAA,SAAS,EAAE,YAAY;AACnBjQ,QAAAA,KAAK,CAACG,WAAN,CAAkB+P,SAAlB,CAA4BxV,QAAQ,CAAC2V,mBAArC,EAA0DF,GAA1D,GAAgEC,IAAhE,CAAqEpM,SAArE,EAAgF7J,iBAAhF;AACH;AAL2C,KAAjB,CAAf,CAAhB;AAOA,QAAImW,QAAQ,GAAG/R,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf;AACA8R,IAAAA,QAAQ,CAAC7R,SAAT,GAAqB,WAArB;AACA6R,IAAAA,QAAQ,CAACtJ,WAAT,CAAqB,KAAKvF,UAAL,CAAgBnD,OAArC;AACA,QAAIiS,gBAAgB,GAAGhS,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAvB;AACA+R,IAAAA,gBAAgB,CAAC9R,SAAjB,GAA6B,cAA7B;AACA6R,IAAAA,QAAQ,CAACtJ,WAAT,CAAqBuJ,gBAArB;AACAA,IAAAA,gBAAgB,CAACvJ,WAAjB,CAA6B,KAAKT,aAAlC;AACAgK,IAAAA,gBAAgB,CAACvJ,WAAjB,CAA6B,KAAKmB,QAAL,CAAc7J,OAA3C;AACAiS,IAAAA,gBAAgB,CAACvJ,WAAjB,CAA6B,KAAKoB,QAAL,CAAc9J,OAA3C,EAhG6C,CAiG7C;;AACA,SAAKoH,oBAAL,GAA4B,KAAKzE,SAAL,CAAe,IAAIlH,QAAJ,CAAa;AACpDyW,MAAAA,eAAe,EAAE,2BADmC;AAEpD9J,MAAAA,KAAK,EAAE1J,+BAA+B,GAAG,KAAKgR,mBAAL,CAAyBtT,QAAQ,CAAC+V,wBAAlC,CAFW;AAGpD5I,MAAAA,SAAS,EAAE;AAHyC,KAAb,CAAf,CAA5B;;AAKA,SAAK5G,SAAL,CAAe,KAAKyE,oBAAL,CAA0BgL,QAA1B,CAAmC,YAAY;AAC1D,UAAI1Q,KAAK,CAAC0F,oBAAN,CAA2BC,OAA/B,EAAwC;AACpC,YAAI3F,KAAK,CAACG,WAAN,CAAkBsM,QAAlB,EAAJ,EAAkC;AAC9B,cAAIjF,SAAS,GAAGxH,KAAK,CAACG,WAAN,CAAkBsH,YAAlB,EAAhB;;AACA,cAAID,SAAS,CAACI,SAAV,KAAwB,CAAxB,IAA6BJ,SAAS,CAACG,aAAV,GAA0BH,SAAS,CAACF,eAArE,EAAsF;AAClFE,YAAAA,SAAS,GAAGA,SAAS,CAACkF,cAAV,CAAyBlF,SAAS,CAACG,aAAV,GAA0B,CAAnD,EAAsD3H,KAAK,CAACG,WAAN,CAAkBwM,QAAlB,GAA6BC,gBAA7B,CAA8CpF,SAAS,CAACG,aAAV,GAA0B,CAAxE,CAAtD,CAAZ;AACH;;AACD,cAAI,CAACH,SAAS,CAACmJ,OAAV,EAAL,EAA0B;AACtB3Q,YAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAE0D,cAAAA,WAAW,EAAE+B;AAAf,aAApB,EAAgD,IAAhD;AACH;AACJ;AACJ,OAVD,MAWK;AACDxH,QAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAE0D,UAAAA,WAAW,EAAE;AAAf,SAApB,EAA2C,IAA3C;AACH;AACJ,KAfc,CAAf;;AAgBA8K,IAAAA,gBAAgB,CAACvJ,WAAjB,CAA6B,KAAKtB,oBAAL,CAA0BpH,OAAvD,EAvH6C,CAwH7C;;AACA,SAAK2J,SAAL,GAAiB,KAAKhH,SAAL,CAAe,IAAI8O,YAAJ,CAAiB;AAC7ClJ,MAAAA,KAAK,EAAE5J,mBAAmB,GAAG,KAAK+Q,mBAAL,CAAyBtT,QAAQ,CAACkW,sBAAlC,CADgB;AAE7CnS,MAAAA,SAAS,EAAE,uBAFkC;AAG7CwR,MAAAA,SAAS,EAAE,YAAY;AACnBjQ,QAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAE8C,UAAAA,UAAU,EAAE,KAAd;AAAqBY,UAAAA,WAAW,EAAE;AAAlC,SAApB,EAA8D,KAA9D;AACH,OAL4C;AAM7C2J,MAAAA,SAAS,EAAE,UAAUhO,CAAV,EAAa;AACpB,YAAIA,CAAC,CAAC6L,MAAF,CAAS;AAAE;AAAX,SAAJ,EAA2B;AACvB,cAAIjN,KAAK,CAACc,iBAAV,EAA6B;AACzB,gBAAId,KAAK,CAACqI,WAAN,CAAkBwI,SAAlB,EAAJ,EAAmC;AAC/B7Q,cAAAA,KAAK,CAACqI,WAAN,CAAkB8B,KAAlB;AACH,aAFD,MAGK;AACDnK,cAAAA,KAAK,CAACG,WAAN,CAAkBgK,KAAlB;AACH;;AACD/I,YAAAA,CAAC,CAAC+L,cAAF;AACH;AACJ;AACJ;AAlB4C,KAAjB,CAAf,CAAjB;AAoBAoD,IAAAA,gBAAgB,CAACvJ,WAAjB,CAA6B,KAAKiB,SAAL,CAAe3J,OAA5C,EA7I6C,CA8I7C;;AACA,SAAKkF,aAAL,GAAqB,KAAKvC,SAAL,CAAe,IAAIvE,yBAAJ,CAA8B,IAA9B,EAAoCsH,SAApC,EAA+C;AAC/E6C,MAAAA,KAAK,EAAE3J,uBADwE;AAE/EqR,MAAAA,WAAW,EAAEpR,6BAFkE;AAG/E2T,MAAAA,OAAO,EAAE,EAHsE;AAI/EzC,MAAAA,cAAc,EAAEA,cAJ+D;AAK/EC,MAAAA,aAAa,EAAEA,aALgE;AAM/Ea,MAAAA,iBAAiB,EAAE;AAN4D,KAA/C,EAOjC,KAAK3O,kBAP4B,EAOR,IAPQ,CAAf,CAArB;;AAQA,SAAKgD,aAAL,CAAmBuN,eAAnB,CAAmC,CAAC,CAAC,KAAK1Q,MAAL,CAAY2Q,YAAjD;;AACA,SAAK/P,SAAL,CAAe,KAAKuC,aAAL,CAAmB4L,SAAnB,CAA6B,UAAUhO,CAAV,EAAa;AAAE,aAAOpB,KAAK,CAACuN,sBAAN,CAA6BnM,CAA7B,CAAP;AAAyC,KAArF,CAAf;;AACA,SAAKH,SAAL,CAAe,KAAKuC,aAAL,CAAmB9B,QAAnB,CAA4B2N,WAA5B,CAAwC,YAAY;AAC/DrP,MAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAE6C,QAAAA,aAAa,EAAE5E,KAAK,CAACwD,aAAN,CAAoB9B,QAApB,CAA6B9C;AAA9C,OAApB,EAA2E,KAA3E;AACH,KAFc,CAAf;;AAGA,SAAKqC,SAAL,CAAe,KAAKuC,aAAL,CAAmB9B,QAAnB,CAA4BkO,iBAA5B,CAA8C,UAAUxO,CAAV,EAAa;AACtE,UAAIpB,KAAK,CAACc,iBAAN,IAA2Bd,KAAK,CAACkF,gBAAN,EAA/B,EAAyD;AACrDlF,QAAAA,KAAK,CAACoC,aAAN;AACH;AACJ,KAJc,CAAf;;AAKA,SAAKnB,SAAL,CAAe,KAAKuC,aAAL,CAAmB8L,iBAAnB,CAAqC,YAAY;AAC5DtP,MAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAChBiP,QAAAA,YAAY,EAAEhR,KAAK,CAACwD,aAAN,CAAoByN,eAApB;AADE,OAApB,EAEG,IAFH;AAGH,KAJc,CAAf;;AAKA,SAAKhQ,SAAL,CAAe,KAAKuC,aAAL,CAAmB0N,qBAAnB,CAAyC,UAAU9P,CAAV,EAAa;AACjE,UAAIA,CAAC,CAAC6L,MAAF,CAAS;AAAE;AAAX,OAAJ,EAA2B;AACvB,YAAIjN,KAAK,CAACmI,QAAN,CAAe0I,SAAf,EAAJ,EAAgC;AAC5B7Q,UAAAA,KAAK,CAACmI,QAAN,CAAegC,KAAf;AACH,SAFD,MAGK,IAAInK,KAAK,CAACoI,QAAN,CAAeyI,SAAf,EAAJ,EAAgC;AACjC7Q,UAAAA,KAAK,CAACoI,QAAN,CAAe+B,KAAf;AACH,SAFI,MAGA,IAAInK,KAAK,CAAC0F,oBAAN,CAA2ByL,OAA/B,EAAwC;AACzCnR,UAAAA,KAAK,CAAC0F,oBAAN,CAA2ByE,KAA3B;AACH,SAFI,MAGA,IAAInK,KAAK,CAACiI,SAAN,CAAgB4I,SAAhB,EAAJ,EAAiC;AAClC7Q,UAAAA,KAAK,CAACiI,SAAN,CAAgBkC,KAAhB;AACH;;AACD/I,QAAAA,CAAC,CAAC+L,cAAF;AACH;AACJ,KAhBc,CAAf,EAtK6C,CAuL7C;;;AACA,SAAK9E,WAAL,GAAmB,KAAKpH,SAAL,CAAe,IAAI8O,YAAJ,CAAiB;AAC/ClJ,MAAAA,KAAK,EAAEzJ,qBAAqB,GAAG,KAAK4Q,mBAAL,CAAyBtT,QAAQ,CAAC0W,gBAAlC,CADgB;AAE/C3S,MAAAA,SAAS,EAAE,yBAFoC;AAG/CwR,MAAAA,SAAS,EAAE,YAAY;AACnBjQ,QAAAA,KAAK,CAACI,WAAN,CAAkBiR,OAAlB;AACH,OAL8C;AAM/CjC,MAAAA,SAAS,EAAE,UAAUhO,CAAV,EAAa;AACpB,YAAIA,CAAC,CAAC6L,MAAF,CAAS;AAAK;AAAL,UAAmB;AAAE;AAA9B,SAAJ,EAA8C;AAC1CjN,UAAAA,KAAK,CAACiI,SAAN,CAAgBkC,KAAhB;;AACA/I,UAAAA,CAAC,CAAC+L,cAAF;AACH;AACJ;AAX8C,KAAjB,CAAf,CAAnB,CAxL6C,CAqM7C;;AACA,SAAK7E,cAAL,GAAsB,KAAKrH,SAAL,CAAe,IAAI8O,YAAJ,CAAiB;AAClDlJ,MAAAA,KAAK,EAAExJ,yBAAyB,GAAG,KAAK2Q,mBAAL,CAAyBtT,QAAQ,CAAC4W,gBAAlC,CADe;AAElD7S,MAAAA,SAAS,EAAE,6BAFuC;AAGlDwR,MAAAA,SAAS,EAAE,YAAY;AACnBjQ,QAAAA,KAAK,CAACI,WAAN,CAAkBmR,UAAlB;AACH;AALiD,KAAjB,CAAf,CAAtB;AAOA,QAAIC,WAAW,GAAGjT,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAgT,IAAAA,WAAW,CAAC/S,SAAZ,GAAwB,cAAxB;AACA+S,IAAAA,WAAW,CAACxK,WAAZ,CAAwB,KAAKxD,aAAL,CAAmBlF,OAA3C;AACA,QAAImT,uBAAuB,GAAGlT,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAA9B;AACAiT,IAAAA,uBAAuB,CAAChT,SAAxB,GAAoC,iBAApC;AACA+S,IAAAA,WAAW,CAACxK,WAAZ,CAAwByK,uBAAxB;AACAA,IAAAA,uBAAuB,CAACzK,WAAxB,CAAoC,KAAKqB,WAAL,CAAiB/J,OAArD;AACAmT,IAAAA,uBAAuB,CAACzK,WAAxB,CAAoC,KAAKsB,cAAL,CAAoBhK,OAAxD,EApN6C,CAqN7C;;AACA,SAAKiK,iBAAL,GAAyB,KAAKtH,SAAL,CAAe,IAAI8O,YAAJ,CAAiB;AACrDlJ,MAAAA,KAAK,EAAEvJ,iCAD8C;AAErDmB,MAAAA,SAAS,EAAE,qBAF0C;AAGrDwR,MAAAA,SAAS,EAAE,YAAY;AACnBjQ,QAAAA,KAAK,CAACK,MAAN,CAAa0B,MAAb,CAAoB;AAAEC,UAAAA,iBAAiB,EAAE,CAAChC,KAAK,CAACc;AAA5B,SAApB,EAAqE,KAArE;;AACA,YAAId,KAAK,CAACc,iBAAV,EAA6B;AACzBd,UAAAA,KAAK,CAACwD,aAAN,CAAoBwB,KAApB,GAA4BpL,GAAG,CAACqL,aAAJ,CAAkBjF,KAAK,CAACyB,UAAN,CAAiBnD,OAAnC,CAA5B;;AACA0B,UAAAA,KAAK,CAACwD,aAAN,CAAoB9B,QAApB,CAA6BC,MAA7B;AACH;;AACD3B,QAAAA,KAAK,CAACoC,aAAN;AACH;AAVoD,KAAjB,CAAf,CAAzB;;AAYA,SAAKmG,iBAAL,CAAuBxC,WAAvB,CAAmC,sBAAnC,EAA2D,KAAKjF,iBAAhE;;AACA,SAAKyH,iBAAL,CAAuBxC,WAAvB,CAAmC,uBAAnC,EAA4D,CAAC,KAAKjF,iBAAlE;;AACA,SAAKyH,iBAAL,CAAuBC,WAAvB,CAAmC,KAAK1H,iBAAxC,EApO6C,CAqO7C;;;AACA,SAAK0D,QAAL,GAAgBjG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB;AACA,SAAKgG,QAAL,CAAc/F,SAAd,GAA0B,2BAA1B;;AACA,SAAK+F,QAAL,CAAcqE,YAAd,CAA2B,aAA3B,EAA0C,MAA1C,EAxO6C,CAyO7C;;;AACA,SAAKrE,QAAL,CAAcgC,KAAd,CAAoBxB,KAApB,GAA4BtH,yBAAyB,GAAG,IAAxD;;AACA,SAAK8G,QAAL,CAAcwC,WAAd,CAA0B,KAAKuB,iBAAL,CAAuBjK,OAAjD;;AACA,SAAKkG,QAAL,CAAcwC,WAAd,CAA0BsJ,QAA1B;;AACA,SAAK9L,QAAL,CAAcwC,WAAd,CAA0BwK,WAA1B;;AACA,SAAKE,WAAL,GAAmB,IAAI1X,IAAJ,CAAS,KAAKwK,QAAd,EAAwB,IAAxB,EAA8B;AAAEmN,MAAAA,WAAW,EAAE;AAAE;;AAAjB,KAA9B,CAAnB;AACA,SAAK7F,QAAL,GAAgB,KAAhB;AACA,QAAI8F,aAAa,GAAGlU,yBAApB;;AACA,SAAKuD,SAAL,CAAe,KAAKyQ,WAAL,CAAiBG,UAAjB,CAA4B,YAAY;AACnDD,MAAAA,aAAa,GAAGhY,GAAG,CAACqL,aAAJ,CAAkBjF,KAAK,CAACwE,QAAxB,CAAhB;AACH,KAFc,CAAf;;AAGA,SAAKvD,SAAL,CAAe,KAAKyQ,WAAL,CAAiBrC,WAAjB,CAA6B,UAAUyC,GAAV,EAAe;AACvD9R,MAAAA,KAAK,CAAC8L,QAAN,GAAiB,IAAjB;AACA,UAAI9G,KAAK,GAAG4M,aAAa,GAAGE,GAAG,CAACC,MAApB,GAA6BD,GAAG,CAACE,QAA7C;;AACA,UAAIhN,KAAK,GAAGtH,yBAAZ,EAAuC;AACnC;AACA;AACH;;AACD,UAAIsO,QAAQ,GAAGiG,UAAU,CAACrY,GAAG,CAACsY,gBAAJ,CAAqBlS,KAAK,CAACwE,QAA3B,EAAqCwH,QAAtC,CAAV,IAA6D,CAA5E;;AACA,UAAIhH,KAAK,GAAGgH,QAAZ,EAAsB;AAClB;AACH;;AACDhM,MAAAA,KAAK,CAACwE,QAAN,CAAegC,KAAf,CAAqBxB,KAArB,GAA6BA,KAAK,GAAG,IAArC;;AACA,UAAIhF,KAAK,CAACc,iBAAV,EAA6B;AACzBd,QAAAA,KAAK,CAACwD,aAAN,CAAoBwB,KAApB,GAA4BpL,GAAG,CAACqL,aAAJ,CAAkBjF,KAAK,CAACyB,UAAN,CAAiBnD,OAAnC,CAA5B;AACH;;AACD0B,MAAAA,KAAK,CAACyB,UAAN,CAAiBC,QAAjB,CAA0BC,MAA1B;;AACA3B,MAAAA,KAAK,CAACkF,gBAAN;AACH,KAjBc,CAAf;;AAkBA,SAAKjE,SAAL,CAAe,KAAKyQ,WAAL,CAAiBS,UAAjB,CAA4B,YAAY;AACnD;AACA,UAAIC,YAAY,GAAGxY,GAAG,CAACqL,aAAJ,CAAkBjF,KAAK,CAACwE,QAAxB,CAAnB;;AACA,UAAI4N,YAAY,GAAG1U,yBAAnB,EAA8C;AAC1C;AACA;AACH;;AACD,UAAIsH,KAAK,GAAGtH,yBAAZ;;AACA,UAAI,CAACsC,KAAK,CAAC8L,QAAP,IAAmBsG,YAAY,KAAK1U,yBAAxC,EAAmE;AAC/D;AACA;AACA,YAAI0N,UAAU,GAAGpL,KAAK,CAACG,WAAN,CAAkBkL,aAAlB,EAAjB;;AACArG,QAAAA,KAAK,GAAGoG,UAAU,CAACpG,KAAX,GAAmB,EAAnB,GAAwBoG,UAAU,CAACM,YAAnC,GAAkD,EAA1D;AACA1L,QAAAA,KAAK,CAAC8L,QAAN,GAAiB,IAAjB;AACH,OAND,MAOK;AACD;;;AAGH;;AACD9L,MAAAA,KAAK,CAACwE,QAAN,CAAegC,KAAf,CAAqBxB,KAArB,GAA6BA,KAAK,GAAG,IAArC;;AACA,UAAIhF,KAAK,CAACc,iBAAV,EAA6B;AACzBd,QAAAA,KAAK,CAACwD,aAAN,CAAoBwB,KAApB,GAA4BpL,GAAG,CAACqL,aAAJ,CAAkBjF,KAAK,CAACyB,UAAN,CAAiBnD,OAAnC,CAA5B;AACH;;AACD0B,MAAAA,KAAK,CAACyB,UAAN,CAAiBC,QAAjB,CAA0BC,MAA1B;AACH,KAzBc,CAAf;AA0BH,GAhSD;;AAiSAtC,EAAAA,UAAU,CAAC5F,SAAX,CAAqBwI,0BAArB,GAAkD,YAAY;AAC1D,QAAIrD,KAAK,GAAG,KAAKuB,WAAL,CAAiB2B,SAAjB,CAA2B;AAAE;AAA7B,KAAZ;;AACA,SAAKL,UAAL,CAAgB4Q,0BAAhB,CAA2CzT,KAAK,KAAK;AAAE;AAAvD;AACH,GAHD;;AAIAS,EAAAA,UAAU,CAACiF,EAAX,GAAgB,2BAAhB;AACA,SAAOjF,UAAP;AACH,CA/6B+B,CA+6B9BpF,MA/6B8B,CAAhC;;AAg7BA,SAASoF,UAAT;;AACA,IAAI0Q,YAAY;AAAG;AAAe,UAAUzQ,MAAV,EAAkB;AAChDzG,EAAAA,SAAS,CAACkX,YAAD,EAAezQ,MAAf,CAAT;;AACA,WAASyQ,YAAT,CAAsBuC,IAAtB,EAA4B;AACxB,QAAItS,KAAK,GAAGV,MAAM,CAACW,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACAD,IAAAA,KAAK,CAACuS,KAAN,GAAcD,IAAd;AACAtS,IAAAA,KAAK,CAACwE,QAAN,GAAiBjG,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;AACAwB,IAAAA,KAAK,CAACwE,QAAN,CAAekC,KAAf,GAAuB1G,KAAK,CAACuS,KAAN,CAAY1L,KAAnC;AACA7G,IAAAA,KAAK,CAACwE,QAAN,CAAegO,QAAf,GAA0B,CAA1B;AACAxS,IAAAA,KAAK,CAACwE,QAAN,CAAe/F,SAAf,GAA2B,YAAYuB,KAAK,CAACuS,KAAN,CAAY9T,SAAnD;;AACAuB,IAAAA,KAAK,CAACwE,QAAN,CAAeqE,YAAf,CAA4B,MAA5B,EAAoC,QAApC;;AACA7I,IAAAA,KAAK,CAACwE,QAAN,CAAeqE,YAAf,CAA4B,YAA5B,EAA0C7I,KAAK,CAACuS,KAAN,CAAY1L,KAAtD;;AACA7G,IAAAA,KAAK,CAACyS,OAAN,CAAczS,KAAK,CAACwE,QAApB,EAA8B,UAAUpD,CAAV,EAAa;AACvCpB,MAAAA,KAAK,CAACuS,KAAN,CAAYtC,SAAZ;;AACA7O,MAAAA,CAAC,CAAC+L,cAAF;AACH,KAHD;;AAIAnN,IAAAA,KAAK,CAAC0S,SAAN,CAAgB1S,KAAK,CAACwE,QAAtB,EAAgC,UAAUpD,CAAV,EAAa;AACzC,UAAIA,CAAC,CAAC6L,MAAF,CAAS;AAAG;AAAZ,WAA4B7L,CAAC,CAAC6L,MAAF,CAAS;AAAE;AAAX,OAAhC,EAAyD;AACrDjN,QAAAA,KAAK,CAACuS,KAAN,CAAYtC,SAAZ;;AACA7O,QAAAA,CAAC,CAAC+L,cAAF;AACA;AACH;;AACD,UAAInN,KAAK,CAACuS,KAAN,CAAYnD,SAAhB,EAA2B;AACvBpP,QAAAA,KAAK,CAACuS,KAAN,CAAYnD,SAAZ,CAAsBhO,CAAtB;AACH;AACJ,KATD;;AAUA,WAAOpB,KAAP;AACH;;AACD/G,EAAAA,MAAM,CAAC0Z,cAAP,CAAsB5C,YAAY,CAACtW,SAAnC,EAA8C,SAA9C,EAAyD;AACrDmZ,IAAAA,GAAG,EAAE,YAAY;AACb,aAAO,KAAKpO,QAAZ;AACH,KAHoD;AAIrDqO,IAAAA,UAAU,EAAE,IAJyC;AAKrDC,IAAAA,YAAY,EAAE;AALuC,GAAzD;;AAOA/C,EAAAA,YAAY,CAACtW,SAAb,CAAuBoX,SAAvB,GAAmC,YAAY;AAC3C,WAAQ,KAAKrM,QAAL,CAAcgO,QAAd,IAA0B,CAAlC;AACH,GAFD;;AAGAzC,EAAAA,YAAY,CAACtW,SAAb,CAAuB0Q,KAAvB,GAA+B,YAAY;AACvC,SAAK3F,QAAL,CAAc2F,KAAd;AACH,GAFD;;AAGA4F,EAAAA,YAAY,CAACtW,SAAb,CAAuBuO,UAAvB,GAAoC,UAAUmJ,OAAV,EAAmB;AACnDvX,IAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B,UAA/B,EAA2C,CAAC2M,OAA5C;;AACA,SAAK3M,QAAL,CAAcqE,YAAd,CAA2B,eAA3B,EAA4C/B,MAAM,CAAC,CAACqK,OAAF,CAAlD;;AACA,SAAK3M,QAAL,CAAcgO,QAAd,GAAyBrB,OAAO,GAAG,CAAH,GAAO,CAAC,CAAxC;AACH,GAJD;;AAKApB,EAAAA,YAAY,CAACtW,SAAb,CAAuB+O,WAAvB,GAAqC,UAAUuK,QAAV,EAAoB;AACrD,SAAKvO,QAAL,CAAcqE,YAAd,CAA2B,eAA3B,EAA4C/B,MAAM,CAAC,CAAC,CAACiM,QAAH,CAAlD;AACH,GAFD;;AAGAhD,EAAAA,YAAY,CAACtW,SAAb,CAAuBsM,WAAvB,GAAqC,UAAUtH,SAAV,EAAqBuU,YAArB,EAAmC;AACpEpZ,IAAAA,GAAG,CAACmM,WAAJ,CAAgB,KAAKvB,QAArB,EAA+B/F,SAA/B,EAA0CuU,YAA1C;AACH,GAFD;;AAGA,SAAOjD,YAAP;AACH,CApDiC,CAoDhC9V,MApDgC,CAAlC;;AAqDA,SAAS8V,YAAT,G,CACA;;AACAvT,0BAA0B,CAAC,UAAUwO,KAAV,EAAiBiI,SAAjB,EAA4B;AACnD,MAAIC,sBAAsB,GAAG,UAAUC,QAAV,EAAoBC,KAApB,EAA2B;AACpD,QAAIA,KAAJ,EAAW;AACPH,MAAAA,SAAS,CAACI,OAAV,CAAkB,oBAAoBF,QAApB,GAA+B,uBAA/B,GAAyDC,KAAzD,GAAiE,KAAnF;AACH;AACJ,GAJD;;AAKAF,EAAAA,sBAAsB,CAAC,YAAD,EAAelI,KAAK,CAACE,QAAN,CAAenQ,wBAAf,CAAf,CAAtB;AACAmY,EAAAA,sBAAsB,CAAC,mBAAD,EAAsBlI,KAAK,CAACE,QAAN,CAAerQ,eAAf,CAAtB,CAAtB;AACAqY,EAAAA,sBAAsB,CAAC,YAAD,EAAelI,KAAK,CAACE,QAAN,CAAejQ,wBAAf,CAAf,CAAtB;AACA,MAAIqY,gBAAgB,GAAGtI,KAAK,CAACE,QAAN,CAAe/P,sBAAf,CAAvB;AACA+X,EAAAA,sBAAsB,CAAC,cAAD,EAAiBI,gBAAjB,CAAtB;AACA,MAAIC,iBAAiB,GAAGvI,KAAK,CAACE,QAAN,CAAe7O,YAAf,CAAxB;;AACA,MAAIkX,iBAAJ,EAAuB;AACnBN,IAAAA,SAAS,CAACI,OAAV,CAAkB,yDAAyDE,iBAAzD,GAA6E,KAA/F;AACH;;AACD,MAAIC,wBAAwB,GAAGxI,KAAK,CAACE,QAAN,CAAelQ,8BAAf,CAA/B;;AACA,MAAIwY,wBAAJ,EAA8B;AAC1BP,IAAAA,SAAS,CAACI,OAAV,CAAkB,8CAA8CrI,KAAK,CAACyI,IAAN,KAAe,IAAf,GAAsB,QAAtB,GAAiC,OAA/E,IAA0F,GAA1F,GAAgGD,wBAAhG,GAA2H,6BAA7I;AACH;;AACD,MAAIE,eAAe,GAAG1I,KAAK,CAACE,QAAN,CAAepQ,qBAAf,CAAtB;;AACA,MAAI4Y,eAAJ,EAAqB;AACjBT,IAAAA,SAAS,CAACI,OAAV,CAAkB,0DAA0DK,eAA1D,GAA4E,2CAA9F;AACH;;AACD,MAAIC,wBAAwB,GAAG3I,KAAK,CAACE,QAAN,CAAehQ,8BAAf,CAA/B;;AACA,MAAIyY,wBAAJ,EAA8B;AAC1BV,IAAAA,SAAS,CAACI,OAAV,CAAkB,8CAA8CrI,KAAK,CAACyI,IAAN,KAAe,IAAf,GAAsB,QAAtB,GAAiC,OAA/E,IAA0F,GAA1F,GAAgGE,wBAAhG,GAA2H,KAA7I;AACH;;AACD,MAAIC,QAAQ,GAAG5I,KAAK,CAACE,QAAN,CAAetQ,cAAf,CAAf;;AACA,MAAIgZ,QAAJ,EAAc;AACVX,IAAAA,SAAS,CAACI,OAAV,CAAkB,qDAAqDO,QAArD,GAAgE,KAAlF;AACH;;AACD,MAAIC,UAAU,GAAG7I,KAAK,CAACE,QAAN,CAAe5O,sBAAf,CAAjB;;AACA,MAAIuX,UAAJ,EAAgB;AACZZ,IAAAA,SAAS,CAACI,OAAV,CAAkB,0CAA0CQ,UAA1C,GAAuD,KAAzE;AACH;;AACD,MAAIC,KAAK,GAAG9I,KAAK,CAACE,QAAN,CAAe5P,eAAf,CAAZ;;AACA,MAAIwY,KAAJ,EAAW;AACPb,IAAAA,SAAS,CAACI,OAAV,CAAkB,mEAAmES,KAAnE,GAA2E,KAA7F;AACH;;AACD,MAAIC,sBAAsB,GAAG/I,KAAK,CAACE,QAAN,CAAe7P,wBAAf,CAA7B;;AACA,MAAI0Y,sBAAJ,EAA4B;AACxBd,IAAAA,SAAS,CAACI,OAAV,CAAkB,kEAAkEU,sBAAlE,GAA2F,8CAA7G;AACH,GAFD,MAGK;AACD,QAAIC,MAAM,GAAGhJ,KAAK,CAACE,QAAN,CAAe9P,kBAAf,CAAb;;AACA,QAAI4Y,MAAJ,EAAY;AACRf,MAAAA,SAAS,CAACI,OAAV,CAAkB,kEAAkEW,MAAlE,GAA2E,8CAA7F;AACH;AACJ,GAhDkD,CAiDnD;;;AACA,MAAIC,YAAY,GAAGjJ,KAAK,CAACE,QAAN,CAAe3O,WAAf,CAAnB;;AACA,MAAI0X,YAAJ,EAAkB;AACdhB,IAAAA,SAAS,CAACI,OAAV,CAAkB,mFAAmFY,YAAnF,GAAkG,KAApH;AACH;AACJ,CAtDyB,CAA1B","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './findWidget.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as dom from '../../../base/browser/dom.js';\r\nimport { alert as alertFn } from '../../../base/browser/ui/aria/aria.js';\r\nimport { Checkbox } from '../../../base/browser/ui/checkbox/checkbox.js';\r\nimport { Sash } from '../../../base/browser/ui/sash/sash.js';\r\nimport { Widget } from '../../../base/browser/ui/widget.js';\r\nimport { Delayer } from '../../../base/common/async.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { toDisposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport * as strings from '../../../base/common/strings.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { CONTEXT_FIND_INPUT_FOCUSED, CONTEXT_REPLACE_INPUT_FOCUSED, FIND_IDS, MATCHES_LIMIT } from './findModel.js';\r\nimport { contrastBorder, editorFindMatch, editorFindMatchBorder, editorFindMatchHighlight, editorFindMatchHighlightBorder, editorFindRangeHighlight, editorFindRangeHighlightBorder, editorWidgetBackground, editorWidgetBorder, editorWidgetResizeBorder, errorForeground, inputActiveOptionBorder, inputActiveOptionBackground, inputBackground, inputBorder, inputForeground, inputValidationErrorBackground, inputValidationErrorBorder, inputValidationErrorForeground, inputValidationInfoBackground, inputValidationInfoBorder, inputValidationInfoForeground, inputValidationWarningBackground, inputValidationWarningBorder, inputValidationWarningForeground, widgetShadow, editorWidgetForeground, focusBorder } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { ContextScopedFindInput, ContextScopedReplaceInput } from '../../../platform/browser/contextScopedHistoryWidget.js';\r\nvar NLS_FIND_INPUT_LABEL = nls.localize('label.find', \"Find\");\r\nvar NLS_FIND_INPUT_PLACEHOLDER = nls.localize('placeholder.find', \"Find\");\r\nvar NLS_PREVIOUS_MATCH_BTN_LABEL = nls.localize('label.previousMatchButton', \"Previous match\");\r\nvar NLS_NEXT_MATCH_BTN_LABEL = nls.localize('label.nextMatchButton', \"Next match\");\r\nvar NLS_TOGGLE_SELECTION_FIND_TITLE = nls.localize('label.toggleSelectionFind', \"Find in selection\");\r\nvar NLS_CLOSE_BTN_LABEL = nls.localize('label.closeButton', \"Close\");\r\nvar NLS_REPLACE_INPUT_LABEL = nls.localize('label.replace', \"Replace\");\r\nvar NLS_REPLACE_INPUT_PLACEHOLDER = nls.localize('placeholder.replace', \"Replace\");\r\nvar NLS_REPLACE_BTN_LABEL = nls.localize('label.replaceButton', \"Replace\");\r\nvar NLS_REPLACE_ALL_BTN_LABEL = nls.localize('label.replaceAllButton', \"Replace All\");\r\nvar NLS_TOGGLE_REPLACE_MODE_BTN_LABEL = nls.localize('label.toggleReplaceButton', \"Toggle Replace mode\");\r\nvar NLS_MATCHES_COUNT_LIMIT_TITLE = nls.localize('title.matchesCountLimit', \"Only the first {0} results are highlighted, but all find operations work on the entire text.\", MATCHES_LIMIT);\r\nvar NLS_MATCHES_LOCATION = nls.localize('label.matchesLocation', \"{0} of {1}\");\r\nvar NLS_NO_RESULTS = nls.localize('label.noResults', \"No Results\");\r\nvar FIND_WIDGET_INITIAL_WIDTH = 419;\r\nvar PART_WIDTH = 275;\r\nvar FIND_INPUT_AREA_WIDTH = PART_WIDTH - 54;\r\nvar MAX_MATCHES_COUNT_WIDTH = 69;\r\n// let FIND_ALL_CONTROLS_WIDTH = 17/** Find Input margin-left */ + (MAX_MATCHES_COUNT_WIDTH + 3 + 1) /** Match Results */ + 23 /** Button */ * 4 + 2/** sash */;\r\nvar FIND_INPUT_AREA_HEIGHT = 33; // The height of Find Widget when Replace Input is not visible.\r\nvar ctrlEnterReplaceAllWarningPromptedKey = 'ctrlEnterReplaceAll.windows.donotask';\r\nvar ctrlKeyMod = (platform.isMacintosh ? 256 /* WinCtrl */ : 2048 /* CtrlCmd */);\r\nvar FindWidgetViewZone = /** @class */ (function () {\r\n    function FindWidgetViewZone(afterLineNumber) {\r\n        this.afterLineNumber = afterLineNumber;\r\n        this.heightInPx = FIND_INPUT_AREA_HEIGHT;\r\n        this.suppressMouseDown = false;\r\n        this.domNode = document.createElement('div');\r\n        this.domNode.className = 'dock-find-viewzone';\r\n    }\r\n    return FindWidgetViewZone;\r\n}());\r\nexport { FindWidgetViewZone };\r\nfunction stopPropagationForMultiLineUpwards(event, value, textarea) {\r\n    var isMultiline = !!value.match(/\\n/);\r\n    if (textarea && isMultiline && textarea.selectionStart > 0) {\r\n        event.stopPropagation();\r\n        return;\r\n    }\r\n}\r\nfunction stopPropagationForMultiLineDownwards(event, value, textarea) {\r\n    var isMultiline = !!value.match(/\\n/);\r\n    if (textarea && isMultiline && textarea.selectionEnd < textarea.value.length) {\r\n        event.stopPropagation();\r\n        return;\r\n    }\r\n}\r\nvar FindWidget = /** @class */ (function (_super) {\r\n    __extends(FindWidget, _super);\r\n    function FindWidget(codeEditor, controller, state, contextViewProvider, keybindingService, contextKeyService, themeService, storageService, notificationService) {\r\n        var _this = _super.call(this) || this;\r\n        _this._cachedHeight = null;\r\n        _this._codeEditor = codeEditor;\r\n        _this._controller = controller;\r\n        _this._state = state;\r\n        _this._contextViewProvider = contextViewProvider;\r\n        _this._keybindingService = keybindingService;\r\n        _this._contextKeyService = contextKeyService;\r\n        _this._storageService = storageService;\r\n        _this._notificationService = notificationService;\r\n        _this._ctrlEnterReplaceAllWarningPrompted = !!storageService.getBoolean(ctrlEnterReplaceAllWarningPromptedKey, 0 /* GLOBAL */);\r\n        _this._isVisible = false;\r\n        _this._isReplaceVisible = false;\r\n        _this._ignoreChangeEvent = false;\r\n        _this._updateHistoryDelayer = new Delayer(500);\r\n        _this._register(toDisposable(function () { return _this._updateHistoryDelayer.cancel(); }));\r\n        _this._register(_this._state.onFindReplaceStateChange(function (e) { return _this._onStateChanged(e); }));\r\n        _this._buildDomNode();\r\n        _this._updateButtons();\r\n        _this._tryUpdateWidgetWidth();\r\n        _this._findInput.inputBox.layout();\r\n        _this._register(_this._codeEditor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(68 /* readOnly */)) {\r\n                if (_this._codeEditor.getOption(68 /* readOnly */)) {\r\n                    // Hide replace part if editor becomes read only\r\n                    _this._state.change({ isReplaceRevealed: false }, false);\r\n                }\r\n                _this._updateButtons();\r\n            }\r\n            if (e.hasChanged(107 /* layoutInfo */)) {\r\n                _this._tryUpdateWidgetWidth();\r\n            }\r\n            if (e.hasChanged(2 /* accessibilitySupport */)) {\r\n                _this.updateAccessibilitySupport();\r\n            }\r\n            if (e.hasChanged(28 /* find */)) {\r\n                var addExtraSpaceOnTop = _this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop;\r\n                if (addExtraSpaceOnTop && !_this._viewZone) {\r\n                    _this._viewZone = new FindWidgetViewZone(0);\r\n                    _this._showViewZone();\r\n                }\r\n                if (!addExtraSpaceOnTop && _this._viewZone) {\r\n                    _this._removeViewZone();\r\n                }\r\n            }\r\n        }));\r\n        _this.updateAccessibilitySupport();\r\n        _this._register(_this._codeEditor.onDidChangeCursorSelection(function () {\r\n            if (_this._isVisible) {\r\n                _this._updateToggleSelectionFindButton();\r\n            }\r\n        }));\r\n        _this._register(_this._codeEditor.onDidFocusEditorWidget(function () {\r\n            if (_this._isVisible) {\r\n                var globalBufferTerm = _this._controller.getGlobalBufferTerm();\r\n                if (globalBufferTerm && globalBufferTerm !== _this._state.searchString) {\r\n                    _this._state.change({ searchString: globalBufferTerm }, true);\r\n                    _this._findInput.select();\r\n                }\r\n            }\r\n        }));\r\n        _this._findInputFocused = CONTEXT_FIND_INPUT_FOCUSED.bindTo(contextKeyService);\r\n        _this._findFocusTracker = _this._register(dom.trackFocus(_this._findInput.inputBox.inputElement));\r\n        _this._register(_this._findFocusTracker.onDidFocus(function () {\r\n            _this._findInputFocused.set(true);\r\n            _this._updateSearchScope();\r\n        }));\r\n        _this._register(_this._findFocusTracker.onDidBlur(function () {\r\n            _this._findInputFocused.set(false);\r\n        }));\r\n        _this._replaceInputFocused = CONTEXT_REPLACE_INPUT_FOCUSED.bindTo(contextKeyService);\r\n        _this._replaceFocusTracker = _this._register(dom.trackFocus(_this._replaceInput.inputBox.inputElement));\r\n        _this._register(_this._replaceFocusTracker.onDidFocus(function () {\r\n            _this._replaceInputFocused.set(true);\r\n            _this._updateSearchScope();\r\n        }));\r\n        _this._register(_this._replaceFocusTracker.onDidBlur(function () {\r\n            _this._replaceInputFocused.set(false);\r\n        }));\r\n        _this._codeEditor.addOverlayWidget(_this);\r\n        if (_this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop) {\r\n            _this._viewZone = new FindWidgetViewZone(0); // Put it before the first line then users can scroll beyond the first line.\r\n        }\r\n        _this._applyTheme(themeService.getTheme());\r\n        _this._register(themeService.onThemeChange(_this._applyTheme.bind(_this)));\r\n        _this._register(_this._codeEditor.onDidChangeModel(function () {\r\n            if (!_this._isVisible) {\r\n                return;\r\n            }\r\n            _this._viewZoneId = undefined;\r\n        }));\r\n        _this._register(_this._codeEditor.onDidScrollChange(function (e) {\r\n            if (e.scrollTopChanged) {\r\n                _this._layoutViewZone();\r\n                return;\r\n            }\r\n            // for other scroll changes, layout the viewzone in next tick to avoid ruining current rendering.\r\n            setTimeout(function () {\r\n                _this._layoutViewZone();\r\n            }, 0);\r\n        }));\r\n        return _this;\r\n    }\r\n    // ----- IOverlayWidget API\r\n    FindWidget.prototype.getId = function () {\r\n        return FindWidget.ID;\r\n    };\r\n    FindWidget.prototype.getDomNode = function () {\r\n        return this._domNode;\r\n    };\r\n    FindWidget.prototype.getPosition = function () {\r\n        if (this._isVisible) {\r\n            return {\r\n                preference: 0 /* TOP_RIGHT_CORNER */\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    // ----- React to state changes\r\n    FindWidget.prototype._onStateChanged = function (e) {\r\n        if (e.searchString) {\r\n            try {\r\n                this._ignoreChangeEvent = true;\r\n                this._findInput.setValue(this._state.searchString);\r\n            }\r\n            finally {\r\n                this._ignoreChangeEvent = false;\r\n            }\r\n            this._updateButtons();\r\n        }\r\n        if (e.replaceString) {\r\n            this._replaceInput.inputBox.value = this._state.replaceString;\r\n        }\r\n        if (e.isRevealed) {\r\n            if (this._state.isRevealed) {\r\n                this._reveal();\r\n            }\r\n            else {\r\n                this._hide(true);\r\n            }\r\n        }\r\n        if (e.isReplaceRevealed) {\r\n            if (this._state.isReplaceRevealed) {\r\n                if (!this._codeEditor.getOption(68 /* readOnly */) && !this._isReplaceVisible) {\r\n                    this._isReplaceVisible = true;\r\n                    this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\r\n                    this._updateButtons();\r\n                    this._replaceInput.inputBox.layout();\r\n                }\r\n            }\r\n            else {\r\n                if (this._isReplaceVisible) {\r\n                    this._isReplaceVisible = false;\r\n                    this._updateButtons();\r\n                }\r\n            }\r\n        }\r\n        if ((e.isRevealed || e.isReplaceRevealed) && (this._state.isRevealed || this._state.isReplaceRevealed)) {\r\n            if (this._tryUpdateHeight()) {\r\n                this._showViewZone();\r\n            }\r\n        }\r\n        if (e.isRegex) {\r\n            this._findInput.setRegex(this._state.isRegex);\r\n        }\r\n        if (e.wholeWord) {\r\n            this._findInput.setWholeWords(this._state.wholeWord);\r\n        }\r\n        if (e.matchCase) {\r\n            this._findInput.setCaseSensitive(this._state.matchCase);\r\n        }\r\n        if (e.searchScope) {\r\n            if (this._state.searchScope) {\r\n                this._toggleSelectionFind.checked = true;\r\n            }\r\n            else {\r\n                this._toggleSelectionFind.checked = false;\r\n            }\r\n            this._updateToggleSelectionFindButton();\r\n        }\r\n        if (e.searchString || e.matchesCount || e.matchesPosition) {\r\n            var showRedOutline = (this._state.searchString.length > 0 && this._state.matchesCount === 0);\r\n            dom.toggleClass(this._domNode, 'no-results', showRedOutline);\r\n            this._updateMatchesCount();\r\n            this._updateButtons();\r\n        }\r\n        if (e.searchString || e.currentMatch) {\r\n            this._layoutViewZone();\r\n        }\r\n        if (e.updateHistory) {\r\n            this._delayedUpdateHistory();\r\n        }\r\n    };\r\n    FindWidget.prototype._delayedUpdateHistory = function () {\r\n        this._updateHistoryDelayer.trigger(this._updateHistory.bind(this));\r\n    };\r\n    FindWidget.prototype._updateHistory = function () {\r\n        if (this._state.searchString) {\r\n            this._findInput.inputBox.addToHistory();\r\n        }\r\n        if (this._state.replaceString) {\r\n            this._replaceInput.inputBox.addToHistory();\r\n        }\r\n    };\r\n    FindWidget.prototype._updateMatchesCount = function () {\r\n        this._matchesCount.style.minWidth = MAX_MATCHES_COUNT_WIDTH + 'px';\r\n        if (this._state.matchesCount >= MATCHES_LIMIT) {\r\n            this._matchesCount.title = NLS_MATCHES_COUNT_LIMIT_TITLE;\r\n        }\r\n        else {\r\n            this._matchesCount.title = '';\r\n        }\r\n        // remove previous content\r\n        if (this._matchesCount.firstChild) {\r\n            this._matchesCount.removeChild(this._matchesCount.firstChild);\r\n        }\r\n        var label;\r\n        if (this._state.matchesCount > 0) {\r\n            var matchesCount = String(this._state.matchesCount);\r\n            if (this._state.matchesCount >= MATCHES_LIMIT) {\r\n                matchesCount += '+';\r\n            }\r\n            var matchesPosition = String(this._state.matchesPosition);\r\n            if (matchesPosition === '0') {\r\n                matchesPosition = '?';\r\n            }\r\n            label = strings.format(NLS_MATCHES_LOCATION, matchesPosition, matchesCount);\r\n        }\r\n        else {\r\n            label = NLS_NO_RESULTS;\r\n        }\r\n        this._matchesCount.appendChild(document.createTextNode(label));\r\n        alertFn(this._getAriaLabel(label, this._state.currentMatch, this._state.searchString), true);\r\n        MAX_MATCHES_COUNT_WIDTH = Math.max(MAX_MATCHES_COUNT_WIDTH, this._matchesCount.clientWidth);\r\n    };\r\n    // ----- actions\r\n    FindWidget.prototype._getAriaLabel = function (label, currentMatch, searchString) {\r\n        if (label === NLS_NO_RESULTS) {\r\n            return searchString === ''\r\n                ? nls.localize('ariaSearchNoResultEmpty', \"{0} found\", label)\r\n                : nls.localize('ariaSearchNoResult', \"{0} found for {1}\", label, searchString);\r\n        }\r\n        return currentMatch\r\n            ? nls.localize('ariaSearchNoResultWithLineNum', \"{0} found for {1} at {2}\", label, searchString, currentMatch.startLineNumber + ':' + currentMatch.startColumn)\r\n            : nls.localize('ariaSearchNoResultWithLineNumNoCurrentMatch', \"{0} found for {1}\", label, searchString);\r\n    };\r\n    /**\r\n     * If 'selection find' is ON we should not disable the button (its function is to cancel 'selection find').\r\n     * If 'selection find' is OFF we enable the button only if there is a selection.\r\n     */\r\n    FindWidget.prototype._updateToggleSelectionFindButton = function () {\r\n        var selection = this._codeEditor.getSelection();\r\n        var isSelection = selection ? (selection.startLineNumber !== selection.endLineNumber || selection.startColumn !== selection.endColumn) : false;\r\n        var isChecked = this._toggleSelectionFind.checked;\r\n        if (this._isVisible && (isChecked || isSelection)) {\r\n            this._toggleSelectionFind.enable();\r\n        }\r\n        else {\r\n            this._toggleSelectionFind.disable();\r\n        }\r\n    };\r\n    FindWidget.prototype._updateButtons = function () {\r\n        this._findInput.setEnabled(this._isVisible);\r\n        this._replaceInput.setEnabled(this._isVisible && this._isReplaceVisible);\r\n        this._updateToggleSelectionFindButton();\r\n        this._closeBtn.setEnabled(this._isVisible);\r\n        var findInputIsNonEmpty = (this._state.searchString.length > 0);\r\n        var matchesCount = this._state.matchesCount ? true : false;\r\n        this._prevBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount);\r\n        this._nextBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount);\r\n        this._replaceBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);\r\n        this._replaceAllBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);\r\n        dom.toggleClass(this._domNode, 'replaceToggled', this._isReplaceVisible);\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-right', !this._isReplaceVisible);\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-down', this._isReplaceVisible);\r\n        this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);\r\n        var canReplace = !this._codeEditor.getOption(68 /* readOnly */);\r\n        this._toggleReplaceBtn.setEnabled(this._isVisible && canReplace);\r\n    };\r\n    FindWidget.prototype._reveal = function () {\r\n        var _this = this;\r\n        if (!this._isVisible) {\r\n            this._isVisible = true;\r\n            var selection = this._codeEditor.getSelection();\r\n            switch (this._codeEditor.getOption(28 /* find */).autoFindInSelection) {\r\n                case 'always':\r\n                    this._toggleSelectionFind.checked = true;\r\n                    break;\r\n                case 'never':\r\n                    this._toggleSelectionFind.checked = false;\r\n                    break;\r\n                case 'multiline':\r\n                    var isSelectionMultipleLine = !!selection && selection.startLineNumber !== selection.endLineNumber;\r\n                    this._toggleSelectionFind.checked = isSelectionMultipleLine;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            this._tryUpdateWidgetWidth();\r\n            this._updateButtons();\r\n            setTimeout(function () {\r\n                dom.addClass(_this._domNode, 'visible');\r\n                _this._domNode.setAttribute('aria-hidden', 'false');\r\n            }, 0);\r\n            // validate query again as it's being dismissed when we hide the find widget.\r\n            setTimeout(function () {\r\n                _this._findInput.validate();\r\n            }, 200);\r\n            this._codeEditor.layoutOverlayWidget(this);\r\n            var adjustEditorScrollTop = true;\r\n            if (this._codeEditor.getOption(28 /* find */).seedSearchStringFromSelection && selection) {\r\n                var domNode = this._codeEditor.getDomNode();\r\n                if (domNode) {\r\n                    var editorCoords = dom.getDomNodePagePosition(domNode);\r\n                    var startCoords = this._codeEditor.getScrolledVisiblePosition(selection.getStartPosition());\r\n                    var startLeft = editorCoords.left + (startCoords ? startCoords.left : 0);\r\n                    var startTop = startCoords ? startCoords.top : 0;\r\n                    if (this._viewZone && startTop < this._viewZone.heightInPx) {\r\n                        if (selection.endLineNumber > selection.startLineNumber) {\r\n                            adjustEditorScrollTop = false;\r\n                        }\r\n                        var leftOfFindWidget = dom.getTopLeftOffset(this._domNode).left;\r\n                        if (startLeft > leftOfFindWidget) {\r\n                            adjustEditorScrollTop = false;\r\n                        }\r\n                        var endCoords = this._codeEditor.getScrolledVisiblePosition(selection.getEndPosition());\r\n                        var endLeft = editorCoords.left + (endCoords ? endCoords.left : 0);\r\n                        if (endLeft > leftOfFindWidget) {\r\n                            adjustEditorScrollTop = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            this._showViewZone(adjustEditorScrollTop);\r\n        }\r\n    };\r\n    FindWidget.prototype._hide = function (focusTheEditor) {\r\n        if (this._isVisible) {\r\n            this._isVisible = false;\r\n            this._updateButtons();\r\n            dom.removeClass(this._domNode, 'visible');\r\n            this._domNode.setAttribute('aria-hidden', 'true');\r\n            this._findInput.clearMessage();\r\n            if (focusTheEditor) {\r\n                this._codeEditor.focus();\r\n            }\r\n            this._codeEditor.layoutOverlayWidget(this);\r\n            this._removeViewZone();\r\n        }\r\n    };\r\n    FindWidget.prototype._layoutViewZone = function () {\r\n        var _this = this;\r\n        var addExtraSpaceOnTop = this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop;\r\n        if (!addExtraSpaceOnTop) {\r\n            this._removeViewZone();\r\n            return;\r\n        }\r\n        if (!this._isVisible) {\r\n            return;\r\n        }\r\n        var viewZone = this._viewZone;\r\n        if (this._viewZoneId !== undefined || !viewZone) {\r\n            return;\r\n        }\r\n        this._codeEditor.changeViewZones(function (accessor) {\r\n            viewZone.heightInPx = _this._getHeight();\r\n            _this._viewZoneId = accessor.addZone(viewZone);\r\n            // scroll top adjust to make sure the editor doesn't scroll when adding viewzone at the beginning.\r\n            _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + viewZone.heightInPx);\r\n        });\r\n    };\r\n    FindWidget.prototype._showViewZone = function (adjustScroll) {\r\n        var _this = this;\r\n        if (adjustScroll === void 0) { adjustScroll = true; }\r\n        if (!this._isVisible) {\r\n            return;\r\n        }\r\n        var addExtraSpaceOnTop = this._codeEditor.getOption(28 /* find */).addExtraSpaceOnTop;\r\n        if (!addExtraSpaceOnTop) {\r\n            return;\r\n        }\r\n        if (this._viewZone === undefined) {\r\n            this._viewZone = new FindWidgetViewZone(0);\r\n        }\r\n        var viewZone = this._viewZone;\r\n        this._codeEditor.changeViewZones(function (accessor) {\r\n            if (_this._viewZoneId !== undefined) {\r\n                // the view zone already exists, we need to update the height\r\n                var newHeight = _this._getHeight();\r\n                if (newHeight === viewZone.heightInPx) {\r\n                    return;\r\n                }\r\n                var scrollAdjustment = newHeight - viewZone.heightInPx;\r\n                viewZone.heightInPx = newHeight;\r\n                accessor.layoutZone(_this._viewZoneId);\r\n                if (adjustScroll) {\r\n                    _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + scrollAdjustment);\r\n                }\r\n                return;\r\n            }\r\n            else {\r\n                var scrollAdjustment = _this._getHeight();\r\n                viewZone.heightInPx = scrollAdjustment;\r\n                _this._viewZoneId = accessor.addZone(viewZone);\r\n                if (adjustScroll) {\r\n                    _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() + scrollAdjustment);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    FindWidget.prototype._removeViewZone = function () {\r\n        var _this = this;\r\n        this._codeEditor.changeViewZones(function (accessor) {\r\n            if (_this._viewZoneId !== undefined) {\r\n                accessor.removeZone(_this._viewZoneId);\r\n                _this._viewZoneId = undefined;\r\n                if (_this._viewZone) {\r\n                    _this._codeEditor.setScrollTop(_this._codeEditor.getScrollTop() - _this._viewZone.heightInPx);\r\n                    _this._viewZone = undefined;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    FindWidget.prototype._applyTheme = function (theme) {\r\n        var inputStyles = {\r\n            inputActiveOptionBorder: theme.getColor(inputActiveOptionBorder),\r\n            inputActiveOptionBackground: theme.getColor(inputActiveOptionBackground),\r\n            inputBackground: theme.getColor(inputBackground),\r\n            inputForeground: theme.getColor(inputForeground),\r\n            inputBorder: theme.getColor(inputBorder),\r\n            inputValidationInfoBackground: theme.getColor(inputValidationInfoBackground),\r\n            inputValidationInfoForeground: theme.getColor(inputValidationInfoForeground),\r\n            inputValidationInfoBorder: theme.getColor(inputValidationInfoBorder),\r\n            inputValidationWarningBackground: theme.getColor(inputValidationWarningBackground),\r\n            inputValidationWarningForeground: theme.getColor(inputValidationWarningForeground),\r\n            inputValidationWarningBorder: theme.getColor(inputValidationWarningBorder),\r\n            inputValidationErrorBackground: theme.getColor(inputValidationErrorBackground),\r\n            inputValidationErrorForeground: theme.getColor(inputValidationErrorForeground),\r\n            inputValidationErrorBorder: theme.getColor(inputValidationErrorBorder),\r\n        };\r\n        this._findInput.style(inputStyles);\r\n        this._replaceInput.style(inputStyles);\r\n        this._toggleSelectionFind.style(inputStyles);\r\n    };\r\n    FindWidget.prototype._tryUpdateWidgetWidth = function () {\r\n        if (!this._isVisible) {\r\n            return;\r\n        }\r\n        if (!dom.isInDOM(this._domNode)) {\r\n            // the widget is not in the DOM\r\n            return;\r\n        }\r\n        var layoutInfo = this._codeEditor.getLayoutInfo();\r\n        var editorContentWidth = layoutInfo.contentWidth;\r\n        if (editorContentWidth <= 0) {\r\n            // for example, diff view original editor\r\n            dom.addClass(this._domNode, 'hiddenEditor');\r\n            return;\r\n        }\r\n        else if (dom.hasClass(this._domNode, 'hiddenEditor')) {\r\n            dom.removeClass(this._domNode, 'hiddenEditor');\r\n        }\r\n        var editorWidth = layoutInfo.width;\r\n        var minimapWidth = layoutInfo.minimapWidth;\r\n        var collapsedFindWidget = false;\r\n        var reducedFindWidget = false;\r\n        var narrowFindWidget = false;\r\n        if (this._resized) {\r\n            var widgetWidth = dom.getTotalWidth(this._domNode);\r\n            if (widgetWidth > FIND_WIDGET_INITIAL_WIDTH) {\r\n                // as the widget is resized by users, we may need to change the max width of the widget as the editor width changes.\r\n                this._domNode.style.maxWidth = editorWidth - 28 - minimapWidth - 15 + \"px\";\r\n                this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\r\n                return;\r\n            }\r\n        }\r\n        if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth >= editorWidth) {\r\n            reducedFindWidget = true;\r\n        }\r\n        if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - MAX_MATCHES_COUNT_WIDTH >= editorWidth) {\r\n            narrowFindWidget = true;\r\n        }\r\n        if (FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - MAX_MATCHES_COUNT_WIDTH >= editorWidth + 50) {\r\n            collapsedFindWidget = true;\r\n        }\r\n        dom.toggleClass(this._domNode, 'collapsed-find-widget', collapsedFindWidget);\r\n        dom.toggleClass(this._domNode, 'narrow-find-widget', narrowFindWidget);\r\n        dom.toggleClass(this._domNode, 'reduced-find-widget', reducedFindWidget);\r\n        if (!narrowFindWidget && !collapsedFindWidget) {\r\n            // the minimal left offset of findwidget is 15px.\r\n            this._domNode.style.maxWidth = editorWidth - 28 - minimapWidth - 15 + \"px\";\r\n        }\r\n        if (this._resized) {\r\n            this._findInput.inputBox.layout();\r\n            var findInputWidth = this._findInput.inputBox.element.clientWidth;\r\n            if (findInputWidth > 0) {\r\n                this._replaceInput.width = findInputWidth;\r\n            }\r\n        }\r\n        else if (this._isReplaceVisible) {\r\n            this._replaceInput.width = dom.getTotalWidth(this._findInput.domNode);\r\n        }\r\n    };\r\n    FindWidget.prototype._getHeight = function () {\r\n        var totalheight = 0;\r\n        // find input margin top\r\n        totalheight += 4;\r\n        // find input height\r\n        totalheight += this._findInput.inputBox.height + 2 /** input box border */;\r\n        if (this._isReplaceVisible) {\r\n            // replace input margin\r\n            totalheight += 4;\r\n            totalheight += this._replaceInput.inputBox.height + 2 /** input box border */;\r\n        }\r\n        // margin bottom\r\n        totalheight += 4;\r\n        return totalheight;\r\n    };\r\n    FindWidget.prototype._tryUpdateHeight = function () {\r\n        var totalHeight = this._getHeight();\r\n        if (this._cachedHeight !== null && this._cachedHeight === totalHeight) {\r\n            return false;\r\n        }\r\n        this._cachedHeight = totalHeight;\r\n        this._domNode.style.height = totalHeight + \"px\";\r\n        return true;\r\n    };\r\n    // ----- Public\r\n    FindWidget.prototype.focusFindInput = function () {\r\n        this._findInput.select();\r\n        // Edge browser requires focus() in addition to select()\r\n        this._findInput.focus();\r\n    };\r\n    FindWidget.prototype.focusReplaceInput = function () {\r\n        this._replaceInput.select();\r\n        // Edge browser requires focus() in addition to select()\r\n        this._replaceInput.focus();\r\n    };\r\n    FindWidget.prototype.highlightFindOptions = function () {\r\n        this._findInput.highlightFindOptions();\r\n    };\r\n    FindWidget.prototype._updateSearchScope = function () {\r\n        if (!this._codeEditor.hasModel()) {\r\n            return;\r\n        }\r\n        if (this._toggleSelectionFind.checked) {\r\n            var selection = this._codeEditor.getSelection();\r\n            if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) {\r\n                selection = selection.setEndPosition(selection.endLineNumber - 1, this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));\r\n            }\r\n            var currentMatch = this._state.currentMatch;\r\n            if (selection.startLineNumber !== selection.endLineNumber) {\r\n                if (!Range.equalsRange(selection, currentMatch)) {\r\n                    // Reseed find scope\r\n                    this._state.change({ searchScope: selection }, true);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    FindWidget.prototype._onFindInputMouseDown = function (e) {\r\n        // on linux, middle key does pasting.\r\n        if (e.middleButton) {\r\n            e.stopPropagation();\r\n        }\r\n    };\r\n    FindWidget.prototype._onFindInputKeyDown = function (e) {\r\n        if (e.equals(ctrlKeyMod | 3 /* Enter */)) {\r\n            this._findInput.inputBox.insertAtCursor('\\n');\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2 /* Tab */)) {\r\n            if (this._isReplaceVisible) {\r\n                this._replaceInput.focus();\r\n            }\r\n            else {\r\n                this._findInput.focusOnCaseSensitive();\r\n            }\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2048 /* CtrlCmd */ | 18 /* DownArrow */)) {\r\n            this._codeEditor.focus();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(16 /* UpArrow */)) {\r\n            return stopPropagationForMultiLineUpwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));\r\n        }\r\n        if (e.equals(18 /* DownArrow */)) {\r\n            return stopPropagationForMultiLineDownwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));\r\n        }\r\n    };\r\n    FindWidget.prototype._onReplaceInputKeyDown = function (e) {\r\n        if (e.equals(ctrlKeyMod | 3 /* Enter */)) {\r\n            if (platform.isWindows && platform.isNative && !this._ctrlEnterReplaceAllWarningPrompted) {\r\n                // this is the first time when users press Ctrl + Enter to replace all\r\n                this._notificationService.info(nls.localize('ctrlEnter.keybindingChanged', 'Ctrl+Enter now inserts line break instead of replacing all. You can modify the keybinding for editor.action.replaceAll to override this behavior.'));\r\n                this._ctrlEnterReplaceAllWarningPrompted = true;\r\n                this._storageService.store(ctrlEnterReplaceAllWarningPromptedKey, true, 0 /* GLOBAL */);\r\n            }\r\n            this._replaceInput.inputBox.insertAtCursor('\\n');\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2 /* Tab */)) {\r\n            this._findInput.focusOnCaseSensitive();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(1024 /* Shift */ | 2 /* Tab */)) {\r\n            this._findInput.focus();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(2048 /* CtrlCmd */ | 18 /* DownArrow */)) {\r\n            this._codeEditor.focus();\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n        if (e.equals(16 /* UpArrow */)) {\r\n            return stopPropagationForMultiLineUpwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));\r\n        }\r\n        if (e.equals(18 /* DownArrow */)) {\r\n            return stopPropagationForMultiLineDownwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));\r\n        }\r\n    };\r\n    // ----- sash\r\n    FindWidget.prototype.getHorizontalSashTop = function (_sash) {\r\n        return 0;\r\n    };\r\n    FindWidget.prototype.getHorizontalSashLeft = function (_sash) {\r\n        return 0;\r\n    };\r\n    FindWidget.prototype.getHorizontalSashWidth = function (_sash) {\r\n        return 500;\r\n    };\r\n    // ----- initialization\r\n    FindWidget.prototype._keybindingLabelFor = function (actionId) {\r\n        var kb = this._keybindingService.lookupKeybinding(actionId);\r\n        if (!kb) {\r\n            return '';\r\n        }\r\n        return \" (\" + kb.getLabel() + \")\";\r\n    };\r\n    FindWidget.prototype._buildDomNode = function () {\r\n        var _this = this;\r\n        var flexibleHeight = true;\r\n        var flexibleWidth = true;\r\n        // Find input\r\n        this._findInput = this._register(new ContextScopedFindInput(null, this._contextViewProvider, {\r\n            width: FIND_INPUT_AREA_WIDTH,\r\n            label: NLS_FIND_INPUT_LABEL,\r\n            placeholder: NLS_FIND_INPUT_PLACEHOLDER,\r\n            appendCaseSensitiveLabel: this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),\r\n            appendWholeWordsLabel: this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),\r\n            appendRegexLabel: this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),\r\n            validation: function (value) {\r\n                if (value.length === 0 || !_this._findInput.getRegex()) {\r\n                    return null;\r\n                }\r\n                try {\r\n                    new RegExp(value);\r\n                    return null;\r\n                }\r\n                catch (e) {\r\n                    return { content: e.message };\r\n                }\r\n            },\r\n            flexibleHeight: flexibleHeight,\r\n            flexibleWidth: flexibleWidth,\r\n            flexibleMaxHeight: 118\r\n        }, this._contextKeyService, true));\r\n        this._findInput.setRegex(!!this._state.isRegex);\r\n        this._findInput.setCaseSensitive(!!this._state.matchCase);\r\n        this._findInput.setWholeWords(!!this._state.wholeWord);\r\n        this._register(this._findInput.onKeyDown(function (e) { return _this._onFindInputKeyDown(e); }));\r\n        this._register(this._findInput.inputBox.onDidChange(function () {\r\n            if (_this._ignoreChangeEvent) {\r\n                return;\r\n            }\r\n            _this._state.change({ searchString: _this._findInput.getValue() }, true);\r\n        }));\r\n        this._register(this._findInput.onDidOptionChange(function () {\r\n            _this._state.change({\r\n                isRegex: _this._findInput.getRegex(),\r\n                wholeWord: _this._findInput.getWholeWords(),\r\n                matchCase: _this._findInput.getCaseSensitive()\r\n            }, true);\r\n        }));\r\n        this._register(this._findInput.onCaseSensitiveKeyDown(function (e) {\r\n            if (e.equals(1024 /* Shift */ | 2 /* Tab */)) {\r\n                if (_this._isReplaceVisible) {\r\n                    _this._replaceInput.focus();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }));\r\n        this._register(this._findInput.onRegexKeyDown(function (e) {\r\n            if (e.equals(2 /* Tab */)) {\r\n                if (_this._isReplaceVisible) {\r\n                    _this._replaceInput.focusOnPreserve();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }));\r\n        this._register(this._findInput.inputBox.onDidHeightChange(function (e) {\r\n            if (_this._tryUpdateHeight()) {\r\n                _this._showViewZone();\r\n            }\r\n        }));\r\n        if (platform.isLinux) {\r\n            this._register(this._findInput.onMouseDown(function (e) { return _this._onFindInputMouseDown(e); }));\r\n        }\r\n        this._matchesCount = document.createElement('div');\r\n        this._matchesCount.className = 'matchesCount';\r\n        this._updateMatchesCount();\r\n        // Previous button\r\n        this._prevBtn = this._register(new SimpleButton({\r\n            label: NLS_PREVIOUS_MATCH_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.PreviousMatchFindAction),\r\n            className: 'codicon codicon-arrow-up',\r\n            onTrigger: function () {\r\n                _this._codeEditor.getAction(FIND_IDS.PreviousMatchFindAction).run().then(undefined, onUnexpectedError);\r\n            }\r\n        }));\r\n        // Next button\r\n        this._nextBtn = this._register(new SimpleButton({\r\n            label: NLS_NEXT_MATCH_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.NextMatchFindAction),\r\n            className: 'codicon codicon-arrow-down',\r\n            onTrigger: function () {\r\n                _this._codeEditor.getAction(FIND_IDS.NextMatchFindAction).run().then(undefined, onUnexpectedError);\r\n            }\r\n        }));\r\n        var findPart = document.createElement('div');\r\n        findPart.className = 'find-part';\r\n        findPart.appendChild(this._findInput.domNode);\r\n        var actionsContainer = document.createElement('div');\r\n        actionsContainer.className = 'find-actions';\r\n        findPart.appendChild(actionsContainer);\r\n        actionsContainer.appendChild(this._matchesCount);\r\n        actionsContainer.appendChild(this._prevBtn.domNode);\r\n        actionsContainer.appendChild(this._nextBtn.domNode);\r\n        // Toggle selection button\r\n        this._toggleSelectionFind = this._register(new Checkbox({\r\n            actionClassName: 'codicon codicon-selection',\r\n            title: NLS_TOGGLE_SELECTION_FIND_TITLE + this._keybindingLabelFor(FIND_IDS.ToggleSearchScopeCommand),\r\n            isChecked: false\r\n        }));\r\n        this._register(this._toggleSelectionFind.onChange(function () {\r\n            if (_this._toggleSelectionFind.checked) {\r\n                if (_this._codeEditor.hasModel()) {\r\n                    var selection = _this._codeEditor.getSelection();\r\n                    if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) {\r\n                        selection = selection.setEndPosition(selection.endLineNumber - 1, _this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));\r\n                    }\r\n                    if (!selection.isEmpty()) {\r\n                        _this._state.change({ searchScope: selection }, true);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                _this._state.change({ searchScope: null }, true);\r\n            }\r\n        }));\r\n        actionsContainer.appendChild(this._toggleSelectionFind.domNode);\r\n        // Close button\r\n        this._closeBtn = this._register(new SimpleButton({\r\n            label: NLS_CLOSE_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.CloseFindWidgetCommand),\r\n            className: 'codicon codicon-close',\r\n            onTrigger: function () {\r\n                _this._state.change({ isRevealed: false, searchScope: null }, false);\r\n            },\r\n            onKeyDown: function (e) {\r\n                if (e.equals(2 /* Tab */)) {\r\n                    if (_this._isReplaceVisible) {\r\n                        if (_this._replaceBtn.isEnabled()) {\r\n                            _this._replaceBtn.focus();\r\n                        }\r\n                        else {\r\n                            _this._codeEditor.focus();\r\n                        }\r\n                        e.preventDefault();\r\n                    }\r\n                }\r\n            }\r\n        }));\r\n        actionsContainer.appendChild(this._closeBtn.domNode);\r\n        // Replace input\r\n        this._replaceInput = this._register(new ContextScopedReplaceInput(null, undefined, {\r\n            label: NLS_REPLACE_INPUT_LABEL,\r\n            placeholder: NLS_REPLACE_INPUT_PLACEHOLDER,\r\n            history: [],\r\n            flexibleHeight: flexibleHeight,\r\n            flexibleWidth: flexibleWidth,\r\n            flexibleMaxHeight: 118\r\n        }, this._contextKeyService, true));\r\n        this._replaceInput.setPreserveCase(!!this._state.preserveCase);\r\n        this._register(this._replaceInput.onKeyDown(function (e) { return _this._onReplaceInputKeyDown(e); }));\r\n        this._register(this._replaceInput.inputBox.onDidChange(function () {\r\n            _this._state.change({ replaceString: _this._replaceInput.inputBox.value }, false);\r\n        }));\r\n        this._register(this._replaceInput.inputBox.onDidHeightChange(function (e) {\r\n            if (_this._isReplaceVisible && _this._tryUpdateHeight()) {\r\n                _this._showViewZone();\r\n            }\r\n        }));\r\n        this._register(this._replaceInput.onDidOptionChange(function () {\r\n            _this._state.change({\r\n                preserveCase: _this._replaceInput.getPreserveCase()\r\n            }, true);\r\n        }));\r\n        this._register(this._replaceInput.onPreserveCaseKeyDown(function (e) {\r\n            if (e.equals(2 /* Tab */)) {\r\n                if (_this._prevBtn.isEnabled()) {\r\n                    _this._prevBtn.focus();\r\n                }\r\n                else if (_this._nextBtn.isEnabled()) {\r\n                    _this._nextBtn.focus();\r\n                }\r\n                else if (_this._toggleSelectionFind.enabled) {\r\n                    _this._toggleSelectionFind.focus();\r\n                }\r\n                else if (_this._closeBtn.isEnabled()) {\r\n                    _this._closeBtn.focus();\r\n                }\r\n                e.preventDefault();\r\n            }\r\n        }));\r\n        // Replace one button\r\n        this._replaceBtn = this._register(new SimpleButton({\r\n            label: NLS_REPLACE_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.ReplaceOneAction),\r\n            className: 'codicon codicon-replace',\r\n            onTrigger: function () {\r\n                _this._controller.replace();\r\n            },\r\n            onKeyDown: function (e) {\r\n                if (e.equals(1024 /* Shift */ | 2 /* Tab */)) {\r\n                    _this._closeBtn.focus();\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }));\r\n        // Replace all button\r\n        this._replaceAllBtn = this._register(new SimpleButton({\r\n            label: NLS_REPLACE_ALL_BTN_LABEL + this._keybindingLabelFor(FIND_IDS.ReplaceAllAction),\r\n            className: 'codicon codicon-replace-all',\r\n            onTrigger: function () {\r\n                _this._controller.replaceAll();\r\n            }\r\n        }));\r\n        var replacePart = document.createElement('div');\r\n        replacePart.className = 'replace-part';\r\n        replacePart.appendChild(this._replaceInput.domNode);\r\n        var replaceActionsContainer = document.createElement('div');\r\n        replaceActionsContainer.className = 'replace-actions';\r\n        replacePart.appendChild(replaceActionsContainer);\r\n        replaceActionsContainer.appendChild(this._replaceBtn.domNode);\r\n        replaceActionsContainer.appendChild(this._replaceAllBtn.domNode);\r\n        // Toggle replace button\r\n        this._toggleReplaceBtn = this._register(new SimpleButton({\r\n            label: NLS_TOGGLE_REPLACE_MODE_BTN_LABEL,\r\n            className: 'codicon toggle left',\r\n            onTrigger: function () {\r\n                _this._state.change({ isReplaceRevealed: !_this._isReplaceVisible }, false);\r\n                if (_this._isReplaceVisible) {\r\n                    _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\r\n                    _this._replaceInput.inputBox.layout();\r\n                }\r\n                _this._showViewZone();\r\n            }\r\n        }));\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-down', this._isReplaceVisible);\r\n        this._toggleReplaceBtn.toggleClass('codicon-chevron-right', !this._isReplaceVisible);\r\n        this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);\r\n        // Widget\r\n        this._domNode = document.createElement('div');\r\n        this._domNode.className = 'editor-widget find-widget';\r\n        this._domNode.setAttribute('aria-hidden', 'true');\r\n        // We need to set this explicitly, otherwise on IE11, the width inheritence of flex doesn't work.\r\n        this._domNode.style.width = FIND_WIDGET_INITIAL_WIDTH + \"px\";\r\n        this._domNode.appendChild(this._toggleReplaceBtn.domNode);\r\n        this._domNode.appendChild(findPart);\r\n        this._domNode.appendChild(replacePart);\r\n        this._resizeSash = new Sash(this._domNode, this, { orientation: 0 /* VERTICAL */ });\r\n        this._resized = false;\r\n        var originalWidth = FIND_WIDGET_INITIAL_WIDTH;\r\n        this._register(this._resizeSash.onDidStart(function () {\r\n            originalWidth = dom.getTotalWidth(_this._domNode);\r\n        }));\r\n        this._register(this._resizeSash.onDidChange(function (evt) {\r\n            _this._resized = true;\r\n            var width = originalWidth + evt.startX - evt.currentX;\r\n            if (width < FIND_WIDGET_INITIAL_WIDTH) {\r\n                // narrow down the find widget should be handled by CSS.\r\n                return;\r\n            }\r\n            var maxWidth = parseFloat(dom.getComputedStyle(_this._domNode).maxWidth) || 0;\r\n            if (width > maxWidth) {\r\n                return;\r\n            }\r\n            _this._domNode.style.width = width + \"px\";\r\n            if (_this._isReplaceVisible) {\r\n                _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\r\n            }\r\n            _this._findInput.inputBox.layout();\r\n            _this._tryUpdateHeight();\r\n        }));\r\n        this._register(this._resizeSash.onDidReset(function () {\r\n            // users double click on the sash\r\n            var currentWidth = dom.getTotalWidth(_this._domNode);\r\n            if (currentWidth < FIND_WIDGET_INITIAL_WIDTH) {\r\n                // The editor is narrow and the width of the find widget is controlled fully by CSS.\r\n                return;\r\n            }\r\n            var width = FIND_WIDGET_INITIAL_WIDTH;\r\n            if (!_this._resized || currentWidth === FIND_WIDGET_INITIAL_WIDTH) {\r\n                // 1. never resized before, double click should maximizes it\r\n                // 2. users resized it already but its width is the same as default\r\n                var layoutInfo = _this._codeEditor.getLayoutInfo();\r\n                width = layoutInfo.width - 28 - layoutInfo.minimapWidth - 15;\r\n                _this._resized = true;\r\n            }\r\n            else {\r\n                /**\r\n                 * no op, the find widget should be shrinked to its default size.\r\n                 */\r\n            }\r\n            _this._domNode.style.width = width + \"px\";\r\n            if (_this._isReplaceVisible) {\r\n                _this._replaceInput.width = dom.getTotalWidth(_this._findInput.domNode);\r\n            }\r\n            _this._findInput.inputBox.layout();\r\n        }));\r\n    };\r\n    FindWidget.prototype.updateAccessibilitySupport = function () {\r\n        var value = this._codeEditor.getOption(2 /* accessibilitySupport */);\r\n        this._findInput.setFocusInputOnOptionClick(value !== 2 /* Enabled */);\r\n    };\r\n    FindWidget.ID = 'editor.contrib.findWidget';\r\n    return FindWidget;\r\n}(Widget));\r\nexport { FindWidget };\r\nvar SimpleButton = /** @class */ (function (_super) {\r\n    __extends(SimpleButton, _super);\r\n    function SimpleButton(opts) {\r\n        var _this = _super.call(this) || this;\r\n        _this._opts = opts;\r\n        _this._domNode = document.createElement('div');\r\n        _this._domNode.title = _this._opts.label;\r\n        _this._domNode.tabIndex = 0;\r\n        _this._domNode.className = 'button ' + _this._opts.className;\r\n        _this._domNode.setAttribute('role', 'button');\r\n        _this._domNode.setAttribute('aria-label', _this._opts.label);\r\n        _this.onclick(_this._domNode, function (e) {\r\n            _this._opts.onTrigger();\r\n            e.preventDefault();\r\n        });\r\n        _this.onkeydown(_this._domNode, function (e) {\r\n            if (e.equals(10 /* Space */) || e.equals(3 /* Enter */)) {\r\n                _this._opts.onTrigger();\r\n                e.preventDefault();\r\n                return;\r\n            }\r\n            if (_this._opts.onKeyDown) {\r\n                _this._opts.onKeyDown(e);\r\n            }\r\n        });\r\n        return _this;\r\n    }\r\n    Object.defineProperty(SimpleButton.prototype, \"domNode\", {\r\n        get: function () {\r\n            return this._domNode;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SimpleButton.prototype.isEnabled = function () {\r\n        return (this._domNode.tabIndex >= 0);\r\n    };\r\n    SimpleButton.prototype.focus = function () {\r\n        this._domNode.focus();\r\n    };\r\n    SimpleButton.prototype.setEnabled = function (enabled) {\r\n        dom.toggleClass(this._domNode, 'disabled', !enabled);\r\n        this._domNode.setAttribute('aria-disabled', String(!enabled));\r\n        this._domNode.tabIndex = enabled ? 0 : -1;\r\n    };\r\n    SimpleButton.prototype.setExpanded = function (expanded) {\r\n        this._domNode.setAttribute('aria-expanded', String(!!expanded));\r\n    };\r\n    SimpleButton.prototype.toggleClass = function (className, shouldHaveIt) {\r\n        dom.toggleClass(this._domNode, className, shouldHaveIt);\r\n    };\r\n    return SimpleButton;\r\n}(Widget));\r\nexport { SimpleButton };\r\n// theming\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var addBackgroundColorRule = function (selector, color) {\r\n        if (color) {\r\n            collector.addRule(\".monaco-editor \" + selector + \" { background-color: \" + color + \"; }\");\r\n        }\r\n    };\r\n    addBackgroundColorRule('.findMatch', theme.getColor(editorFindMatchHighlight));\r\n    addBackgroundColorRule('.currentFindMatch', theme.getColor(editorFindMatch));\r\n    addBackgroundColorRule('.findScope', theme.getColor(editorFindRangeHighlight));\r\n    var widgetBackground = theme.getColor(editorWidgetBackground);\r\n    addBackgroundColorRule('.find-widget', widgetBackground);\r\n    var widgetShadowColor = theme.getColor(widgetShadow);\r\n    if (widgetShadowColor) {\r\n        collector.addRule(\".monaco-editor .find-widget { box-shadow: 0 2px 8px \" + widgetShadowColor + \"; }\");\r\n    }\r\n    var findMatchHighlightBorder = theme.getColor(editorFindMatchHighlightBorder);\r\n    if (findMatchHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .findMatch { border: 1px \" + (theme.type === 'hc' ? 'dotted' : 'solid') + \" \" + findMatchHighlightBorder + \"; box-sizing: border-box; }\");\r\n    }\r\n    var findMatchBorder = theme.getColor(editorFindMatchBorder);\r\n    if (findMatchBorder) {\r\n        collector.addRule(\".monaco-editor .currentFindMatch { border: 2px solid \" + findMatchBorder + \"; padding: 1px; box-sizing: border-box; }\");\r\n    }\r\n    var findRangeHighlightBorder = theme.getColor(editorFindRangeHighlightBorder);\r\n    if (findRangeHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .findScope { border: 1px \" + (theme.type === 'hc' ? 'dashed' : 'solid') + \" \" + findRangeHighlightBorder + \"; }\");\r\n    }\r\n    var hcBorder = theme.getColor(contrastBorder);\r\n    if (hcBorder) {\r\n        collector.addRule(\".monaco-editor .find-widget { border: 1px solid \" + hcBorder + \"; }\");\r\n    }\r\n    var foreground = theme.getColor(editorWidgetForeground);\r\n    if (foreground) {\r\n        collector.addRule(\".monaco-editor .find-widget { color: \" + foreground + \"; }\");\r\n    }\r\n    var error = theme.getColor(errorForeground);\r\n    if (error) {\r\n        collector.addRule(\".monaco-editor .find-widget.no-results .matchesCount { color: \" + error + \"; }\");\r\n    }\r\n    var resizeBorderBackground = theme.getColor(editorWidgetResizeBorder);\r\n    if (resizeBorderBackground) {\r\n        collector.addRule(\".monaco-editor .find-widget .monaco-sash { background-color: \" + resizeBorderBackground + \"; width: 3px !important; margin-left: -4px;}\");\r\n    }\r\n    else {\r\n        var border = theme.getColor(editorWidgetBorder);\r\n        if (border) {\r\n            collector.addRule(\".monaco-editor .find-widget .monaco-sash { background-color: \" + border + \"; width: 3px !important; margin-left: -4px;}\");\r\n        }\r\n    }\r\n    // This rule is used to override the outline color for synthetic-focus find input.\r\n    var focusOutline = theme.getColor(focusBorder);\r\n    if (focusOutline) {\r\n        collector.addRule(\".monaco-editor .find-widget .monaco-inputbox.synthetic-focus { outline-color: \" + focusOutline + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}