{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport './contextview.css';\nimport * as DOM from '../../dom.js';\nimport * as platform from '../../../common/platform.js';\nimport { toDisposable, Disposable, DisposableStore } from '../../../common/lifecycle.js';\nimport { Range } from '../../../common/range.js';\nimport { BrowserFeatures } from '../../canIUse.js';\n/**\r\n * Lays out a one dimensional view next to an anchor in a viewport.\r\n *\r\n * @returns The view offset within the viewport.\r\n */\n\nexport function layout(viewportSize, viewSize, anchor) {\n  var anchorEnd = anchor.offset + anchor.size;\n\n  if (anchor.position === 0\n  /* Before */\n  ) {\n      if (viewSize <= viewportSize - anchorEnd) {\n        return anchorEnd; // happy case, lay it out after the anchor\n      }\n\n      if (viewSize <= anchor.offset) {\n        return anchor.offset - viewSize; // ok case, lay it out before the anchor\n      }\n\n      return Math.max(viewportSize - viewSize, 0); // sad case, lay it over the anchor\n    } else {\n    if (viewSize <= anchor.offset) {\n      return anchor.offset - viewSize; // happy case, lay it out before the anchor\n    }\n\n    if (viewSize <= viewportSize - anchorEnd) {\n      return anchorEnd; // ok case, lay it out after the anchor\n    }\n\n    return 0; // sad case, lay it over the anchor\n  }\n}\n\nvar ContextView =\n/** @class */\nfunction (_super) {\n  __extends(ContextView, _super);\n\n  function ContextView(container) {\n    var _this = _super.call(this) || this;\n\n    _this.container = null;\n    _this.delegate = null;\n    _this.toDisposeOnClean = Disposable.None;\n    _this.toDisposeOnSetContainer = Disposable.None;\n    _this.view = DOM.$('.context-view');\n    DOM.hide(_this.view);\n\n    _this.setContainer(container);\n\n    _this._register(toDisposable(function () {\n      return _this.setContainer(null);\n    }));\n\n    return _this;\n  }\n\n  ContextView.prototype.setContainer = function (container) {\n    var _this = this;\n\n    if (this.container) {\n      this.toDisposeOnSetContainer.dispose();\n      this.container.removeChild(this.view);\n      this.container = null;\n    }\n\n    if (container) {\n      this.container = container;\n      this.container.appendChild(this.view);\n      var toDisposeOnSetContainer_1 = new DisposableStore();\n      ContextView.BUBBLE_UP_EVENTS.forEach(function (event) {\n        toDisposeOnSetContainer_1.add(DOM.addStandardDisposableListener(_this.container, event, function (e) {\n          _this.onDOMEvent(e, false);\n        }));\n      });\n      ContextView.BUBBLE_DOWN_EVENTS.forEach(function (event) {\n        toDisposeOnSetContainer_1.add(DOM.addStandardDisposableListener(_this.container, event, function (e) {\n          _this.onDOMEvent(e, true);\n        }, true));\n      });\n      this.toDisposeOnSetContainer = toDisposeOnSetContainer_1;\n    }\n  };\n\n  ContextView.prototype.show = function (delegate) {\n    if (this.isVisible()) {\n      this.hide();\n    } // Show static box\n\n\n    DOM.clearNode(this.view);\n    this.view.className = 'context-view';\n    this.view.style.top = '0px';\n    this.view.style.left = '0px';\n    DOM.show(this.view); // Render content\n\n    this.toDisposeOnClean = delegate.render(this.view) || Disposable.None; // Set active delegate\n\n    this.delegate = delegate; // Layout\n\n    this.doLayout(); // Focus\n\n    if (this.delegate.focus) {\n      this.delegate.focus();\n    }\n  };\n\n  ContextView.prototype.layout = function () {\n    if (!this.isVisible()) {\n      return;\n    }\n\n    if (this.delegate.canRelayout === false && !(platform.isIOS && BrowserFeatures.pointerEvents)) {\n      this.hide();\n      return;\n    }\n\n    if (this.delegate.layout) {\n      this.delegate.layout();\n    }\n\n    this.doLayout();\n  };\n\n  ContextView.prototype.doLayout = function () {\n    // Check that we still have a delegate - this.delegate.layout may have hidden\n    if (!this.isVisible()) {\n      return;\n    } // Get anchor\n\n\n    var anchor = this.delegate.getAnchor(); // Compute around\n\n    var around; // Get the element's position and size (to anchor the view)\n\n    if (DOM.isHTMLElement(anchor)) {\n      var elementPosition = DOM.getDomNodePagePosition(anchor);\n      around = {\n        top: elementPosition.top,\n        left: elementPosition.left,\n        width: elementPosition.width,\n        height: elementPosition.height\n      };\n    } else {\n      around = {\n        top: anchor.y,\n        left: anchor.x,\n        width: anchor.width || 1,\n        height: anchor.height || 2\n      };\n    }\n\n    var viewSizeWidth = DOM.getTotalWidth(this.view);\n    var viewSizeHeight = DOM.getTotalHeight(this.view);\n    var anchorPosition = this.delegate.anchorPosition || 0\n    /* BELOW */\n    ;\n    var anchorAlignment = this.delegate.anchorAlignment || 0\n    /* LEFT */\n    ;\n    var verticalAnchor = {\n      offset: around.top - window.pageYOffset,\n      size: around.height,\n      position: anchorPosition === 0\n      /* BELOW */\n      ? 0\n      /* Before */\n      : 1\n      /* After */\n\n    };\n    var horizontalAnchor;\n\n    if (anchorAlignment === 0\n    /* LEFT */\n    ) {\n        horizontalAnchor = {\n          offset: around.left,\n          size: 0,\n          position: 0\n          /* Before */\n\n        };\n      } else {\n      horizontalAnchor = {\n        offset: around.left + around.width,\n        size: 0,\n        position: 1\n        /* After */\n\n      };\n    }\n\n    var top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset; // if view intersects vertically with anchor, shift it horizontally\n\n    if (Range.intersects({\n      start: top,\n      end: top + viewSizeHeight\n    }, {\n      start: verticalAnchor.offset,\n      end: verticalAnchor.offset + verticalAnchor.size\n    })) {\n      horizontalAnchor.size = around.width;\n\n      if (anchorAlignment === 1\n      /* RIGHT */\n      ) {\n          horizontalAnchor.offset = around.left;\n        }\n    }\n\n    var left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\n    DOM.removeClasses(this.view, 'top', 'bottom', 'left', 'right');\n    DOM.addClass(this.view, anchorPosition === 0\n    /* BELOW */\n    ? 'bottom' : 'top');\n    DOM.addClass(this.view, anchorAlignment === 0\n    /* LEFT */\n    ? 'left' : 'right');\n    var containerPosition = DOM.getDomNodePagePosition(this.container);\n    this.view.style.top = top - containerPosition.top + \"px\";\n    this.view.style.left = left - containerPosition.left + \"px\";\n    this.view.style.width = 'initial';\n  };\n\n  ContextView.prototype.hide = function (data) {\n    var delegate = this.delegate;\n    this.delegate = null;\n\n    if (delegate === null || delegate === void 0 ? void 0 : delegate.onHide) {\n      delegate.onHide(data);\n    }\n\n    this.toDisposeOnClean.dispose();\n    DOM.hide(this.view);\n  };\n\n  ContextView.prototype.isVisible = function () {\n    return !!this.delegate;\n  };\n\n  ContextView.prototype.onDOMEvent = function (e, onCapture) {\n    if (this.delegate) {\n      if (this.delegate.onDOMEvent) {\n        this.delegate.onDOMEvent(e, document.activeElement);\n      } else if (onCapture && !DOM.isAncestor(e.target, this.container)) {\n        this.hide();\n      }\n    }\n  };\n\n  ContextView.prototype.dispose = function () {\n    this.hide();\n\n    _super.prototype.dispose.call(this);\n  };\n\n  ContextView.BUBBLE_UP_EVENTS = ['click', 'keydown', 'focus', 'blur'];\n  ContextView.BUBBLE_DOWN_EVENTS = ['click'];\n  return ContextView;\n}(Disposable);\n\nexport { ContextView };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/ui/contextview/contextview.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","DOM","platform","toDisposable","Disposable","DisposableStore","Range","BrowserFeatures","layout","viewportSize","viewSize","anchor","anchorEnd","offset","size","position","Math","max","ContextView","_super","container","_this","call","delegate","toDisposeOnClean","None","toDisposeOnSetContainer","view","$","hide","setContainer","_register","dispose","removeChild","appendChild","toDisposeOnSetContainer_1","BUBBLE_UP_EVENTS","forEach","event","add","addStandardDisposableListener","e","onDOMEvent","BUBBLE_DOWN_EVENTS","show","isVisible","clearNode","className","style","top","left","render","doLayout","focus","canRelayout","isIOS","pointerEvents","getAnchor","around","isHTMLElement","elementPosition","getDomNodePagePosition","width","height","y","x","viewSizeWidth","getTotalWidth","viewSizeHeight","getTotalHeight","anchorPosition","anchorAlignment","verticalAnchor","window","pageYOffset","horizontalAnchor","innerHeight","intersects","start","end","innerWidth","removeClasses","addClass","containerPosition","data","onHide","onCapture","document","activeElement","isAncestor","target"],"mappings":"AAAA;;;;AAIA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,OAAO,mBAAP;AACA,OAAO,KAAKI,GAAZ,MAAqB,cAArB;AACA,OAAO,KAAKC,QAAZ,MAA0B,6BAA1B;AACA,SAASC,YAAT,EAAuBC,UAAvB,EAAmCC,eAAnC,QAA0D,8BAA1D;AACA,SAASC,KAAT,QAAsB,0BAAtB;AACA,SAASC,eAAT,QAAgC,kBAAhC;AACA;;;;;;AAKA,OAAO,SAASC,MAAT,CAAgBC,YAAhB,EAA8BC,QAA9B,EAAwCC,MAAxC,EAAgD;AACnD,MAAIC,SAAS,GAAGD,MAAM,CAACE,MAAP,GAAgBF,MAAM,CAACG,IAAvC;;AACA,MAAIH,MAAM,CAACI,QAAP,KAAoB;AAAE;AAA1B,IAAwC;AACpC,UAAIL,QAAQ,IAAID,YAAY,GAAGG,SAA/B,EAA0C;AACtC,eAAOA,SAAP,CADsC,CACpB;AACrB;;AACD,UAAIF,QAAQ,IAAIC,MAAM,CAACE,MAAvB,EAA+B;AAC3B,eAAOF,MAAM,CAACE,MAAP,GAAgBH,QAAvB,CAD2B,CACM;AACpC;;AACD,aAAOM,IAAI,CAACC,GAAL,CAASR,YAAY,GAAGC,QAAxB,EAAkC,CAAlC,CAAP,CAPoC,CAOS;AAChD,KARD,MASK;AACD,QAAIA,QAAQ,IAAIC,MAAM,CAACE,MAAvB,EAA+B;AAC3B,aAAOF,MAAM,CAACE,MAAP,GAAgBH,QAAvB,CAD2B,CACM;AACpC;;AACD,QAAIA,QAAQ,IAAID,YAAY,GAAGG,SAA/B,EAA0C;AACtC,aAAOA,SAAP,CADsC,CACpB;AACrB;;AACD,WAAO,CAAP,CAPC,CAOS;AACb;AACJ;;AACD,IAAIM,WAAW;AAAG;AAAe,UAAUC,MAAV,EAAkB;AAC/ChC,EAAAA,SAAS,CAAC+B,WAAD,EAAcC,MAAd,CAAT;;AACA,WAASD,WAAT,CAAqBE,SAArB,EAAgC;AAC5B,QAAIC,KAAK,GAAGF,MAAM,CAACG,IAAP,CAAY,IAAZ,KAAqB,IAAjC;;AACAD,IAAAA,KAAK,CAACD,SAAN,GAAkB,IAAlB;AACAC,IAAAA,KAAK,CAACE,QAAN,GAAiB,IAAjB;AACAF,IAAAA,KAAK,CAACG,gBAAN,GAAyBpB,UAAU,CAACqB,IAApC;AACAJ,IAAAA,KAAK,CAACK,uBAAN,GAAgCtB,UAAU,CAACqB,IAA3C;AACAJ,IAAAA,KAAK,CAACM,IAAN,GAAa1B,GAAG,CAAC2B,CAAJ,CAAM,eAAN,CAAb;AACA3B,IAAAA,GAAG,CAAC4B,IAAJ,CAASR,KAAK,CAACM,IAAf;;AACAN,IAAAA,KAAK,CAACS,YAAN,CAAmBV,SAAnB;;AACAC,IAAAA,KAAK,CAACU,SAAN,CAAgB5B,YAAY,CAAC,YAAY;AAAE,aAAOkB,KAAK,CAACS,YAAN,CAAmB,IAAnB,CAAP;AAAkC,KAAjD,CAA5B;;AACA,WAAOT,KAAP;AACH;;AACDH,EAAAA,WAAW,CAACnB,SAAZ,CAAsB+B,YAAtB,GAAqC,UAAUV,SAAV,EAAqB;AACtD,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAI,KAAKD,SAAT,EAAoB;AAChB,WAAKM,uBAAL,CAA6BM,OAA7B;AACA,WAAKZ,SAAL,CAAea,WAAf,CAA2B,KAAKN,IAAhC;AACA,WAAKP,SAAL,GAAiB,IAAjB;AACH;;AACD,QAAIA,SAAJ,EAAe;AACX,WAAKA,SAAL,GAAiBA,SAAjB;AACA,WAAKA,SAAL,CAAec,WAAf,CAA2B,KAAKP,IAAhC;AACA,UAAIQ,yBAAyB,GAAG,IAAI9B,eAAJ,EAAhC;AACAa,MAAAA,WAAW,CAACkB,gBAAZ,CAA6BC,OAA7B,CAAqC,UAAUC,KAAV,EAAiB;AAClDH,QAAAA,yBAAyB,CAACI,GAA1B,CAA8BtC,GAAG,CAACuC,6BAAJ,CAAkCnB,KAAK,CAACD,SAAxC,EAAmDkB,KAAnD,EAA0D,UAAUG,CAAV,EAAa;AACjGpB,UAAAA,KAAK,CAACqB,UAAN,CAAiBD,CAAjB,EAAoB,KAApB;AACH,SAF6B,CAA9B;AAGH,OAJD;AAKAvB,MAAAA,WAAW,CAACyB,kBAAZ,CAA+BN,OAA/B,CAAuC,UAAUC,KAAV,EAAiB;AACpDH,QAAAA,yBAAyB,CAACI,GAA1B,CAA8BtC,GAAG,CAACuC,6BAAJ,CAAkCnB,KAAK,CAACD,SAAxC,EAAmDkB,KAAnD,EAA0D,UAAUG,CAAV,EAAa;AACjGpB,UAAAA,KAAK,CAACqB,UAAN,CAAiBD,CAAjB,EAAoB,IAApB;AACH,SAF6B,EAE3B,IAF2B,CAA9B;AAGH,OAJD;AAKA,WAAKf,uBAAL,GAA+BS,yBAA/B;AACH;AACJ,GAvBD;;AAwBAjB,EAAAA,WAAW,CAACnB,SAAZ,CAAsB6C,IAAtB,GAA6B,UAAUrB,QAAV,EAAoB;AAC7C,QAAI,KAAKsB,SAAL,EAAJ,EAAsB;AAClB,WAAKhB,IAAL;AACH,KAH4C,CAI7C;;;AACA5B,IAAAA,GAAG,CAAC6C,SAAJ,CAAc,KAAKnB,IAAnB;AACA,SAAKA,IAAL,CAAUoB,SAAV,GAAsB,cAAtB;AACA,SAAKpB,IAAL,CAAUqB,KAAV,CAAgBC,GAAhB,GAAsB,KAAtB;AACA,SAAKtB,IAAL,CAAUqB,KAAV,CAAgBE,IAAhB,GAAuB,KAAvB;AACAjD,IAAAA,GAAG,CAAC2C,IAAJ,CAAS,KAAKjB,IAAd,EAT6C,CAU7C;;AACA,SAAKH,gBAAL,GAAwBD,QAAQ,CAAC4B,MAAT,CAAgB,KAAKxB,IAArB,KAA8BvB,UAAU,CAACqB,IAAjE,CAX6C,CAY7C;;AACA,SAAKF,QAAL,GAAgBA,QAAhB,CAb6C,CAc7C;;AACA,SAAK6B,QAAL,GAf6C,CAgB7C;;AACA,QAAI,KAAK7B,QAAL,CAAc8B,KAAlB,EAAyB;AACrB,WAAK9B,QAAL,CAAc8B,KAAd;AACH;AACJ,GApBD;;AAqBAnC,EAAAA,WAAW,CAACnB,SAAZ,CAAsBS,MAAtB,GAA+B,YAAY;AACvC,QAAI,CAAC,KAAKqC,SAAL,EAAL,EAAuB;AACnB;AACH;;AACD,QAAI,KAAKtB,QAAL,CAAc+B,WAAd,KAA8B,KAA9B,IAAuC,EAAEpD,QAAQ,CAACqD,KAAT,IAAkBhD,eAAe,CAACiD,aAApC,CAA3C,EAA+F;AAC3F,WAAK3B,IAAL;AACA;AACH;;AACD,QAAI,KAAKN,QAAL,CAAcf,MAAlB,EAA0B;AACtB,WAAKe,QAAL,CAAcf,MAAd;AACH;;AACD,SAAK4C,QAAL;AACH,GAZD;;AAaAlC,EAAAA,WAAW,CAACnB,SAAZ,CAAsBqD,QAAtB,GAAiC,YAAY;AACzC;AACA,QAAI,CAAC,KAAKP,SAAL,EAAL,EAAuB;AACnB;AACH,KAJwC,CAKzC;;;AACA,QAAIlC,MAAM,GAAG,KAAKY,QAAL,CAAckC,SAAd,EAAb,CANyC,CAOzC;;AACA,QAAIC,MAAJ,CARyC,CASzC;;AACA,QAAIzD,GAAG,CAAC0D,aAAJ,CAAkBhD,MAAlB,CAAJ,EAA+B;AAC3B,UAAIiD,eAAe,GAAG3D,GAAG,CAAC4D,sBAAJ,CAA2BlD,MAA3B,CAAtB;AACA+C,MAAAA,MAAM,GAAG;AACLT,QAAAA,GAAG,EAAEW,eAAe,CAACX,GADhB;AAELC,QAAAA,IAAI,EAAEU,eAAe,CAACV,IAFjB;AAGLY,QAAAA,KAAK,EAAEF,eAAe,CAACE,KAHlB;AAILC,QAAAA,MAAM,EAAEH,eAAe,CAACG;AAJnB,OAAT;AAMH,KARD,MASK;AACDL,MAAAA,MAAM,GAAG;AACLT,QAAAA,GAAG,EAAEtC,MAAM,CAACqD,CADP;AAELd,QAAAA,IAAI,EAAEvC,MAAM,CAACsD,CAFR;AAGLH,QAAAA,KAAK,EAAEnD,MAAM,CAACmD,KAAP,IAAgB,CAHlB;AAILC,QAAAA,MAAM,EAAEpD,MAAM,CAACoD,MAAP,IAAiB;AAJpB,OAAT;AAMH;;AACD,QAAIG,aAAa,GAAGjE,GAAG,CAACkE,aAAJ,CAAkB,KAAKxC,IAAvB,CAApB;AACA,QAAIyC,cAAc,GAAGnE,GAAG,CAACoE,cAAJ,CAAmB,KAAK1C,IAAxB,CAArB;AACA,QAAI2C,cAAc,GAAG,KAAK/C,QAAL,CAAc+C,cAAd,IAAgC;AAAE;AAAvD;AACA,QAAIC,eAAe,GAAG,KAAKhD,QAAL,CAAcgD,eAAd,IAAiC;AAAE;AAAzD;AACA,QAAIC,cAAc,GAAG;AAAE3D,MAAAA,MAAM,EAAE6C,MAAM,CAACT,GAAP,GAAawB,MAAM,CAACC,WAA9B;AAA2C5D,MAAAA,IAAI,EAAE4C,MAAM,CAACK,MAAxD;AAAgEhD,MAAAA,QAAQ,EAAEuD,cAAc,KAAK;AAAE;AAArB,QAAmC;AAAE;AAArC,QAAoD;AAAE;;AAAhI,KAArB;AACA,QAAIK,gBAAJ;;AACA,QAAIJ,eAAe,KAAK;AAAE;AAA1B,MAAsC;AAClCI,QAAAA,gBAAgB,GAAG;AAAE9D,UAAAA,MAAM,EAAE6C,MAAM,CAACR,IAAjB;AAAuBpC,UAAAA,IAAI,EAAE,CAA7B;AAAgCC,UAAAA,QAAQ,EAAE;AAAE;;AAA5C,SAAnB;AACH,OAFD,MAGK;AACD4D,MAAAA,gBAAgB,GAAG;AAAE9D,QAAAA,MAAM,EAAE6C,MAAM,CAACR,IAAP,GAAcQ,MAAM,CAACI,KAA/B;AAAsChD,QAAAA,IAAI,EAAE,CAA5C;AAA+CC,QAAAA,QAAQ,EAAE;AAAE;;AAA3D,OAAnB;AACH;;AACD,QAAIkC,GAAG,GAAGzC,MAAM,CAACiE,MAAM,CAACG,WAAR,EAAqBR,cAArB,EAAqCI,cAArC,CAAN,GAA6DC,MAAM,CAACC,WAA9E,CAvCyC,CAwCzC;;AACA,QAAIpE,KAAK,CAACuE,UAAN,CAAiB;AAAEC,MAAAA,KAAK,EAAE7B,GAAT;AAAc8B,MAAAA,GAAG,EAAE9B,GAAG,GAAGmB;AAAzB,KAAjB,EAA4D;AAAEU,MAAAA,KAAK,EAAEN,cAAc,CAAC3D,MAAxB;AAAgCkE,MAAAA,GAAG,EAAEP,cAAc,CAAC3D,MAAf,GAAwB2D,cAAc,CAAC1D;AAA5E,KAA5D,CAAJ,EAAqJ;AACjJ6D,MAAAA,gBAAgB,CAAC7D,IAAjB,GAAwB4C,MAAM,CAACI,KAA/B;;AACA,UAAIS,eAAe,KAAK;AAAE;AAA1B,QAAuC;AACnCI,UAAAA,gBAAgB,CAAC9D,MAAjB,GAA0B6C,MAAM,CAACR,IAAjC;AACH;AACJ;;AACD,QAAIA,IAAI,GAAG1C,MAAM,CAACiE,MAAM,CAACO,UAAR,EAAoBd,aAApB,EAAmCS,gBAAnC,CAAjB;AACA1E,IAAAA,GAAG,CAACgF,aAAJ,CAAkB,KAAKtD,IAAvB,EAA6B,KAA7B,EAAoC,QAApC,EAA8C,MAA9C,EAAsD,OAAtD;AACA1B,IAAAA,GAAG,CAACiF,QAAJ,CAAa,KAAKvD,IAAlB,EAAwB2C,cAAc,KAAK;AAAE;AAArB,MAAmC,QAAnC,GAA8C,KAAtE;AACArE,IAAAA,GAAG,CAACiF,QAAJ,CAAa,KAAKvD,IAAlB,EAAwB4C,eAAe,KAAK;AAAE;AAAtB,MAAmC,MAAnC,GAA4C,OAApE;AACA,QAAIY,iBAAiB,GAAGlF,GAAG,CAAC4D,sBAAJ,CAA2B,KAAKzC,SAAhC,CAAxB;AACA,SAAKO,IAAL,CAAUqB,KAAV,CAAgBC,GAAhB,GAAsBA,GAAG,GAAGkC,iBAAiB,CAAClC,GAAxB,GAA8B,IAApD;AACA,SAAKtB,IAAL,CAAUqB,KAAV,CAAgBE,IAAhB,GAAuBA,IAAI,GAAGiC,iBAAiB,CAACjC,IAAzB,GAAgC,IAAvD;AACA,SAAKvB,IAAL,CAAUqB,KAAV,CAAgBc,KAAhB,GAAwB,SAAxB;AACH,GAvDD;;AAwDA5C,EAAAA,WAAW,CAACnB,SAAZ,CAAsB8B,IAAtB,GAA6B,UAAUuD,IAAV,EAAgB;AACzC,QAAI7D,QAAQ,GAAG,KAAKA,QAApB;AACA,SAAKA,QAAL,GAAgB,IAAhB;;AACA,QAAIA,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAK,KAAK,CAAvC,GAA2C,KAAK,CAAhD,GAAoDA,QAAQ,CAAC8D,MAAjE,EAAyE;AACrE9D,MAAAA,QAAQ,CAAC8D,MAAT,CAAgBD,IAAhB;AACH;;AACD,SAAK5D,gBAAL,CAAsBQ,OAAtB;AACA/B,IAAAA,GAAG,CAAC4B,IAAJ,CAAS,KAAKF,IAAd;AACH,GARD;;AASAT,EAAAA,WAAW,CAACnB,SAAZ,CAAsB8C,SAAtB,GAAkC,YAAY;AAC1C,WAAO,CAAC,CAAC,KAAKtB,QAAd;AACH,GAFD;;AAGAL,EAAAA,WAAW,CAACnB,SAAZ,CAAsB2C,UAAtB,GAAmC,UAAUD,CAAV,EAAa6C,SAAb,EAAwB;AACvD,QAAI,KAAK/D,QAAT,EAAmB;AACf,UAAI,KAAKA,QAAL,CAAcmB,UAAlB,EAA8B;AAC1B,aAAKnB,QAAL,CAAcmB,UAAd,CAAyBD,CAAzB,EAA4B8C,QAAQ,CAACC,aAArC;AACH,OAFD,MAGK,IAAIF,SAAS,IAAI,CAACrF,GAAG,CAACwF,UAAJ,CAAehD,CAAC,CAACiD,MAAjB,EAAyB,KAAKtE,SAA9B,CAAlB,EAA4D;AAC7D,aAAKS,IAAL;AACH;AACJ;AACJ,GATD;;AAUAX,EAAAA,WAAW,CAACnB,SAAZ,CAAsBiC,OAAtB,GAAgC,YAAY;AACxC,SAAKH,IAAL;;AACAV,IAAAA,MAAM,CAACpB,SAAP,CAAiBiC,OAAjB,CAAyBV,IAAzB,CAA8B,IAA9B;AACH,GAHD;;AAIAJ,EAAAA,WAAW,CAACkB,gBAAZ,GAA+B,CAAC,OAAD,EAAU,SAAV,EAAqB,OAArB,EAA8B,MAA9B,CAA/B;AACAlB,EAAAA,WAAW,CAACyB,kBAAZ,GAAiC,CAAC,OAAD,CAAjC;AACA,SAAOzB,WAAP;AACH,CA7JgC,CA6J/Bd,UA7J+B,CAAjC;;AA8JA,SAASc,WAAT","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './contextview.css';\r\nimport * as DOM from '../../dom.js';\r\nimport * as platform from '../../../common/platform.js';\r\nimport { toDisposable, Disposable, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { Range } from '../../../common/range.js';\r\nimport { BrowserFeatures } from '../../canIUse.js';\r\n/**\r\n * Lays out a one dimensional view next to an anchor in a viewport.\r\n *\r\n * @returns The view offset within the viewport.\r\n */\r\nexport function layout(viewportSize, viewSize, anchor) {\r\n    var anchorEnd = anchor.offset + anchor.size;\r\n    if (anchor.position === 0 /* Before */) {\r\n        if (viewSize <= viewportSize - anchorEnd) {\r\n            return anchorEnd; // happy case, lay it out after the anchor\r\n        }\r\n        if (viewSize <= anchor.offset) {\r\n            return anchor.offset - viewSize; // ok case, lay it out before the anchor\r\n        }\r\n        return Math.max(viewportSize - viewSize, 0); // sad case, lay it over the anchor\r\n    }\r\n    else {\r\n        if (viewSize <= anchor.offset) {\r\n            return anchor.offset - viewSize; // happy case, lay it out before the anchor\r\n        }\r\n        if (viewSize <= viewportSize - anchorEnd) {\r\n            return anchorEnd; // ok case, lay it out after the anchor\r\n        }\r\n        return 0; // sad case, lay it over the anchor\r\n    }\r\n}\r\nvar ContextView = /** @class */ (function (_super) {\r\n    __extends(ContextView, _super);\r\n    function ContextView(container) {\r\n        var _this = _super.call(this) || this;\r\n        _this.container = null;\r\n        _this.delegate = null;\r\n        _this.toDisposeOnClean = Disposable.None;\r\n        _this.toDisposeOnSetContainer = Disposable.None;\r\n        _this.view = DOM.$('.context-view');\r\n        DOM.hide(_this.view);\r\n        _this.setContainer(container);\r\n        _this._register(toDisposable(function () { return _this.setContainer(null); }));\r\n        return _this;\r\n    }\r\n    ContextView.prototype.setContainer = function (container) {\r\n        var _this = this;\r\n        if (this.container) {\r\n            this.toDisposeOnSetContainer.dispose();\r\n            this.container.removeChild(this.view);\r\n            this.container = null;\r\n        }\r\n        if (container) {\r\n            this.container = container;\r\n            this.container.appendChild(this.view);\r\n            var toDisposeOnSetContainer_1 = new DisposableStore();\r\n            ContextView.BUBBLE_UP_EVENTS.forEach(function (event) {\r\n                toDisposeOnSetContainer_1.add(DOM.addStandardDisposableListener(_this.container, event, function (e) {\r\n                    _this.onDOMEvent(e, false);\r\n                }));\r\n            });\r\n            ContextView.BUBBLE_DOWN_EVENTS.forEach(function (event) {\r\n                toDisposeOnSetContainer_1.add(DOM.addStandardDisposableListener(_this.container, event, function (e) {\r\n                    _this.onDOMEvent(e, true);\r\n                }, true));\r\n            });\r\n            this.toDisposeOnSetContainer = toDisposeOnSetContainer_1;\r\n        }\r\n    };\r\n    ContextView.prototype.show = function (delegate) {\r\n        if (this.isVisible()) {\r\n            this.hide();\r\n        }\r\n        // Show static box\r\n        DOM.clearNode(this.view);\r\n        this.view.className = 'context-view';\r\n        this.view.style.top = '0px';\r\n        this.view.style.left = '0px';\r\n        DOM.show(this.view);\r\n        // Render content\r\n        this.toDisposeOnClean = delegate.render(this.view) || Disposable.None;\r\n        // Set active delegate\r\n        this.delegate = delegate;\r\n        // Layout\r\n        this.doLayout();\r\n        // Focus\r\n        if (this.delegate.focus) {\r\n            this.delegate.focus();\r\n        }\r\n    };\r\n    ContextView.prototype.layout = function () {\r\n        if (!this.isVisible()) {\r\n            return;\r\n        }\r\n        if (this.delegate.canRelayout === false && !(platform.isIOS && BrowserFeatures.pointerEvents)) {\r\n            this.hide();\r\n            return;\r\n        }\r\n        if (this.delegate.layout) {\r\n            this.delegate.layout();\r\n        }\r\n        this.doLayout();\r\n    };\r\n    ContextView.prototype.doLayout = function () {\r\n        // Check that we still have a delegate - this.delegate.layout may have hidden\r\n        if (!this.isVisible()) {\r\n            return;\r\n        }\r\n        // Get anchor\r\n        var anchor = this.delegate.getAnchor();\r\n        // Compute around\r\n        var around;\r\n        // Get the element's position and size (to anchor the view)\r\n        if (DOM.isHTMLElement(anchor)) {\r\n            var elementPosition = DOM.getDomNodePagePosition(anchor);\r\n            around = {\r\n                top: elementPosition.top,\r\n                left: elementPosition.left,\r\n                width: elementPosition.width,\r\n                height: elementPosition.height\r\n            };\r\n        }\r\n        else {\r\n            around = {\r\n                top: anchor.y,\r\n                left: anchor.x,\r\n                width: anchor.width || 1,\r\n                height: anchor.height || 2\r\n            };\r\n        }\r\n        var viewSizeWidth = DOM.getTotalWidth(this.view);\r\n        var viewSizeHeight = DOM.getTotalHeight(this.view);\r\n        var anchorPosition = this.delegate.anchorPosition || 0 /* BELOW */;\r\n        var anchorAlignment = this.delegate.anchorAlignment || 0 /* LEFT */;\r\n        var verticalAnchor = { offset: around.top - window.pageYOffset, size: around.height, position: anchorPosition === 0 /* BELOW */ ? 0 /* Before */ : 1 /* After */ };\r\n        var horizontalAnchor;\r\n        if (anchorAlignment === 0 /* LEFT */) {\r\n            horizontalAnchor = { offset: around.left, size: 0, position: 0 /* Before */ };\r\n        }\r\n        else {\r\n            horizontalAnchor = { offset: around.left + around.width, size: 0, position: 1 /* After */ };\r\n        }\r\n        var top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset;\r\n        // if view intersects vertically with anchor, shift it horizontally\r\n        if (Range.intersects({ start: top, end: top + viewSizeHeight }, { start: verticalAnchor.offset, end: verticalAnchor.offset + verticalAnchor.size })) {\r\n            horizontalAnchor.size = around.width;\r\n            if (anchorAlignment === 1 /* RIGHT */) {\r\n                horizontalAnchor.offset = around.left;\r\n            }\r\n        }\r\n        var left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\r\n        DOM.removeClasses(this.view, 'top', 'bottom', 'left', 'right');\r\n        DOM.addClass(this.view, anchorPosition === 0 /* BELOW */ ? 'bottom' : 'top');\r\n        DOM.addClass(this.view, anchorAlignment === 0 /* LEFT */ ? 'left' : 'right');\r\n        var containerPosition = DOM.getDomNodePagePosition(this.container);\r\n        this.view.style.top = top - containerPosition.top + \"px\";\r\n        this.view.style.left = left - containerPosition.left + \"px\";\r\n        this.view.style.width = 'initial';\r\n    };\r\n    ContextView.prototype.hide = function (data) {\r\n        var delegate = this.delegate;\r\n        this.delegate = null;\r\n        if (delegate === null || delegate === void 0 ? void 0 : delegate.onHide) {\r\n            delegate.onHide(data);\r\n        }\r\n        this.toDisposeOnClean.dispose();\r\n        DOM.hide(this.view);\r\n    };\r\n    ContextView.prototype.isVisible = function () {\r\n        return !!this.delegate;\r\n    };\r\n    ContextView.prototype.onDOMEvent = function (e, onCapture) {\r\n        if (this.delegate) {\r\n            if (this.delegate.onDOMEvent) {\r\n                this.delegate.onDOMEvent(e, document.activeElement);\r\n            }\r\n            else if (onCapture && !DOM.isAncestor(e.target, this.container)) {\r\n                this.hide();\r\n            }\r\n        }\r\n    };\r\n    ContextView.prototype.dispose = function () {\r\n        this.hide();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ContextView.BUBBLE_UP_EVENTS = ['click', 'keydown', 'focus', 'blur'];\r\n    ContextView.BUBBLE_DOWN_EVENTS = ['click'];\r\n    return ContextView;\r\n}(Disposable));\r\nexport { ContextView };\r\n"]},"metadata":{},"sourceType":"module"}