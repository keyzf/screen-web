{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport './folding.css';\nimport * as nls from '../../../nls.js';\nimport * as types from '../../../base/common/types.js';\nimport { escapeRegExpCharacters } from '../../../base/common/strings.js';\nimport { RunOnceScheduler, Delayer, createCancelablePromise } from '../../../base/common/async.js';\nimport { KeyChord } from '../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { registerEditorAction, registerEditorContribution, EditorAction, registerInstantiatedEditorAction } from '../../browser/editorExtensions.js';\nimport { FoldingModel, setCollapseStateAtLevel, setCollapseStateLevelsDown, setCollapseStateLevelsUp, setCollapseStateForMatchingLines, setCollapseStateForType, toggleCollapseState, setCollapseStateUp } from './foldingModel.js';\nimport { FoldingDecorationProvider } from './foldingDecorations.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { HiddenRangeModel } from './hiddenRangeModel.js';\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\nimport { IndentRangeProvider } from './indentRangeProvider.js';\nimport { FoldingRangeProviderRegistry, FoldingRangeKind } from '../../common/modes.js';\nimport { SyntaxRangeProvider, ID_SYNTAX_PROVIDER } from './syntaxRangeProvider.js';\nimport { InitializingRangeProvider, ID_INIT_PROVIDER } from './intializingRangeProvider.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { RawContextKey, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { registerColor, editorSelectionBackground, transparent } from '../../../platform/theme/common/colorRegistry.js';\nvar CONTEXT_FOLDING_ENABLED = new RawContextKey('foldingEnabled', false);\n\nvar FoldingController =\n/** @class */\nfunction (_super) {\n  __extends(FoldingController, _super);\n\n  function FoldingController(editor, contextKeyService) {\n    var _this = _super.call(this) || this;\n\n    _this.contextKeyService = contextKeyService;\n    _this.localToDispose = _this._register(new DisposableStore());\n    _this.editor = editor;\n\n    var options = _this.editor.getOptions();\n\n    _this._isEnabled = options.get(30\n    /* folding */\n    );\n    _this._useFoldingProviders = options.get(31\n    /* foldingStrategy */\n    ) !== 'indentation';\n    _this.foldingModel = null;\n    _this.hiddenRangeModel = null;\n    _this.rangeProvider = null;\n    _this.foldingRegionPromise = null;\n    _this.foldingStateMemento = null;\n    _this.foldingModelPromise = null;\n    _this.updateScheduler = null;\n    _this.cursorChangedScheduler = null;\n    _this.mouseDownInfo = null;\n    _this.foldingDecorationProvider = new FoldingDecorationProvider(editor);\n    _this.foldingDecorationProvider.autoHideFoldingControls = options.get(84\n    /* showFoldingControls */\n    ) === 'mouseover';\n    _this.foldingDecorationProvider.showFoldingHighlights = options.get(32\n    /* foldingHighlight */\n    );\n    _this.foldingEnabled = CONTEXT_FOLDING_ENABLED.bindTo(_this.contextKeyService);\n\n    _this.foldingEnabled.set(_this._isEnabled);\n\n    _this._register(_this.editor.onDidChangeModel(function () {\n      return _this.onModelChanged();\n    }));\n\n    _this._register(_this.editor.onDidChangeConfiguration(function (e) {\n      if (e.hasChanged(30\n      /* folding */\n      )) {\n        var options_1 = _this.editor.getOptions();\n\n        _this._isEnabled = options_1.get(30\n        /* folding */\n        );\n\n        _this.foldingEnabled.set(_this._isEnabled);\n\n        _this.onModelChanged();\n      }\n\n      if (e.hasChanged(84\n      /* showFoldingControls */\n      ) || e.hasChanged(32\n      /* foldingHighlight */\n      )) {\n        var options_2 = _this.editor.getOptions();\n\n        _this.foldingDecorationProvider.autoHideFoldingControls = options_2.get(84\n        /* showFoldingControls */\n        ) === 'mouseover';\n        _this.foldingDecorationProvider.showFoldingHighlights = options_2.get(32\n        /* foldingHighlight */\n        );\n\n        _this.onModelContentChanged();\n      }\n\n      if (e.hasChanged(31\n      /* foldingStrategy */\n      )) {\n        var options_3 = _this.editor.getOptions();\n\n        _this._useFoldingProviders = options_3.get(31\n        /* foldingStrategy */\n        ) !== 'indentation';\n\n        _this.onFoldingStrategyChanged();\n      }\n    }));\n\n    _this.onModelChanged();\n\n    return _this;\n  }\n\n  FoldingController.get = function (editor) {\n    return editor.getContribution(FoldingController.ID);\n  };\n  /**\r\n   * Store view state.\r\n   */\n\n\n  FoldingController.prototype.saveViewState = function () {\n    var model = this.editor.getModel();\n\n    if (!model || !this._isEnabled || model.isTooLargeForTokenization()) {\n      return {};\n    }\n\n    if (this.foldingModel) {\n      // disposed ?\n      var collapsedRegions = this.foldingModel.isInitialized ? this.foldingModel.getMemento() : this.hiddenRangeModel.getMemento();\n      var provider = this.rangeProvider ? this.rangeProvider.id : undefined;\n      return {\n        collapsedRegions: collapsedRegions,\n        lineCount: model.getLineCount(),\n        provider: provider\n      };\n    }\n\n    return undefined;\n  };\n  /**\r\n   * Restore view state.\r\n   */\n\n\n  FoldingController.prototype.restoreViewState = function (state) {\n    var model = this.editor.getModel();\n\n    if (!model || !this._isEnabled || model.isTooLargeForTokenization() || !this.hiddenRangeModel) {\n      return;\n    }\n\n    if (!state || !state.collapsedRegions || state.lineCount !== model.getLineCount()) {\n      return;\n    }\n\n    if (state.provider === ID_SYNTAX_PROVIDER || state.provider === ID_INIT_PROVIDER) {\n      this.foldingStateMemento = state;\n    }\n\n    var collapsedRegions = state.collapsedRegions; // set the hidden ranges right away, before waiting for the folding model.\n\n    if (this.hiddenRangeModel.applyMemento(collapsedRegions)) {\n      var foldingModel = this.getFoldingModel();\n\n      if (foldingModel) {\n        foldingModel.then(function (foldingModel) {\n          if (foldingModel) {\n            foldingModel.applyMemento(collapsedRegions);\n          }\n        }).then(undefined, onUnexpectedError);\n      }\n    }\n  };\n\n  FoldingController.prototype.onModelChanged = function () {\n    var _this = this;\n\n    this.localToDispose.clear();\n    var model = this.editor.getModel();\n\n    if (!this._isEnabled || !model || model.isTooLargeForTokenization()) {\n      // huge files get no view model, so they cannot support hidden areas\n      return;\n    }\n\n    this.foldingModel = new FoldingModel(model, this.foldingDecorationProvider);\n    this.localToDispose.add(this.foldingModel);\n    this.hiddenRangeModel = new HiddenRangeModel(this.foldingModel);\n    this.localToDispose.add(this.hiddenRangeModel);\n    this.localToDispose.add(this.hiddenRangeModel.onDidChange(function (hr) {\n      return _this.onHiddenRangesChanges(hr);\n    }));\n    this.updateScheduler = new Delayer(200);\n    this.cursorChangedScheduler = new RunOnceScheduler(function () {\n      return _this.revealCursor();\n    }, 200);\n    this.localToDispose.add(this.cursorChangedScheduler);\n    this.localToDispose.add(FoldingRangeProviderRegistry.onDidChange(function () {\n      return _this.onFoldingStrategyChanged();\n    }));\n    this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(function () {\n      return _this.onFoldingStrategyChanged();\n    })); // covers model language changes as well\n\n    this.localToDispose.add(this.editor.onDidChangeModelContent(function () {\n      return _this.onModelContentChanged();\n    }));\n    this.localToDispose.add(this.editor.onDidChangeCursorPosition(function () {\n      return _this.onCursorPositionChanged();\n    }));\n    this.localToDispose.add(this.editor.onMouseDown(function (e) {\n      return _this.onEditorMouseDown(e);\n    }));\n    this.localToDispose.add(this.editor.onMouseUp(function (e) {\n      return _this.onEditorMouseUp(e);\n    }));\n    this.localToDispose.add({\n      dispose: function () {\n        if (_this.foldingRegionPromise) {\n          _this.foldingRegionPromise.cancel();\n\n          _this.foldingRegionPromise = null;\n        }\n\n        if (_this.updateScheduler) {\n          _this.updateScheduler.cancel();\n        }\n\n        _this.updateScheduler = null;\n        _this.foldingModel = null;\n        _this.foldingModelPromise = null;\n        _this.hiddenRangeModel = null;\n        _this.cursorChangedScheduler = null;\n        _this.foldingStateMemento = null;\n\n        if (_this.rangeProvider) {\n          _this.rangeProvider.dispose();\n        }\n\n        _this.rangeProvider = null;\n      }\n    });\n    this.onModelContentChanged();\n  };\n\n  FoldingController.prototype.onFoldingStrategyChanged = function () {\n    if (this.rangeProvider) {\n      this.rangeProvider.dispose();\n    }\n\n    this.rangeProvider = null;\n    this.onModelContentChanged();\n  };\n\n  FoldingController.prototype.getRangeProvider = function (editorModel) {\n    var _this = this;\n\n    if (this.rangeProvider) {\n      return this.rangeProvider;\n    }\n\n    this.rangeProvider = new IndentRangeProvider(editorModel); // fallback\n\n    if (this._useFoldingProviders && this.foldingModel) {\n      var foldingProviders = FoldingRangeProviderRegistry.ordered(this.foldingModel.textModel);\n\n      if (foldingProviders.length === 0 && this.foldingStateMemento && this.foldingStateMemento.collapsedRegions) {\n        var rangeProvider = this.rangeProvider = new InitializingRangeProvider(editorModel, this.foldingStateMemento.collapsedRegions, function () {\n          // if after 30 the InitializingRangeProvider is still not replaced, force a refresh\n          _this.foldingStateMemento = null;\n\n          _this.onFoldingStrategyChanged();\n        }, 30000);\n        return rangeProvider; // keep memento in case there are still no foldingProviders on the next request.\n      } else if (foldingProviders.length > 0) {\n        this.rangeProvider = new SyntaxRangeProvider(editorModel, foldingProviders);\n      }\n    }\n\n    this.foldingStateMemento = null;\n    return this.rangeProvider;\n  };\n\n  FoldingController.prototype.getFoldingModel = function () {\n    return this.foldingModelPromise;\n  };\n\n  FoldingController.prototype.onModelContentChanged = function () {\n    var _this = this;\n\n    if (this.updateScheduler) {\n      if (this.foldingRegionPromise) {\n        this.foldingRegionPromise.cancel();\n        this.foldingRegionPromise = null;\n      }\n\n      this.foldingModelPromise = this.updateScheduler.trigger(function () {\n        var foldingModel = _this.foldingModel;\n\n        if (!foldingModel) {\n          // null if editor has been disposed, or folding turned off\n          return null;\n        }\n\n        var foldingRegionPromise = _this.foldingRegionPromise = createCancelablePromise(function (token) {\n          return _this.getRangeProvider(foldingModel.textModel).compute(token);\n        });\n        return foldingRegionPromise.then(function (foldingRanges) {\n          if (foldingRanges && foldingRegionPromise === _this.foldingRegionPromise) {\n            // new request or cancelled in the meantime?\n            // some cursors might have moved into hidden regions, make sure they are in expanded regions\n            var selections = _this.editor.getSelections();\n\n            var selectionLineNumbers = selections ? selections.map(function (s) {\n              return s.startLineNumber;\n            }) : [];\n            foldingModel.update(foldingRanges, selectionLineNumbers);\n          }\n\n          return foldingModel;\n        });\n      }).then(undefined, function (err) {\n        onUnexpectedError(err);\n        return null;\n      });\n    }\n  };\n\n  FoldingController.prototype.onHiddenRangesChanges = function (hiddenRanges) {\n    if (this.hiddenRangeModel && hiddenRanges.length) {\n      var selections = this.editor.getSelections();\n\n      if (selections) {\n        if (this.hiddenRangeModel.adjustSelections(selections)) {\n          this.editor.setSelections(selections);\n        }\n      }\n    }\n\n    this.editor.setHiddenAreas(hiddenRanges);\n  };\n\n  FoldingController.prototype.onCursorPositionChanged = function () {\n    if (this.hiddenRangeModel && this.hiddenRangeModel.hasRanges()) {\n      this.cursorChangedScheduler.schedule();\n    }\n  };\n\n  FoldingController.prototype.revealCursor = function () {\n    var _this = this;\n\n    var foldingModel = this.getFoldingModel();\n\n    if (!foldingModel) {\n      return;\n    }\n\n    foldingModel.then(function (foldingModel) {\n      if (foldingModel) {\n        var selections = _this.editor.getSelections();\n\n        if (selections && selections.length > 0) {\n          var toToggle = [];\n\n          var _loop_1 = function (selection) {\n            var lineNumber = selection.selectionStartLineNumber;\n\n            if (_this.hiddenRangeModel && _this.hiddenRangeModel.isHidden(lineNumber)) {\n              toToggle.push.apply(toToggle, foldingModel.getAllRegionsAtLine(lineNumber, function (r) {\n                return r.isCollapsed && lineNumber > r.startLineNumber;\n              }));\n            }\n          };\n\n          for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\n            var selection = selections_1[_i];\n\n            _loop_1(selection);\n          }\n\n          if (toToggle.length) {\n            foldingModel.toggleCollapseState(toToggle);\n\n            _this.reveal(selections[0].getPosition());\n          }\n        }\n      }\n    }).then(undefined, onUnexpectedError);\n  };\n\n  FoldingController.prototype.onEditorMouseDown = function (e) {\n    this.mouseDownInfo = null;\n\n    if (!this.hiddenRangeModel || !e.target || !e.target.range) {\n      return;\n    }\n\n    if (!e.event.leftButton && !e.event.middleButton) {\n      return;\n    }\n\n    var range = e.target.range;\n    var iconClicked = false;\n\n    switch (e.target.type) {\n      case 4\n      /* GUTTER_LINE_DECORATIONS */\n      :\n        var data = e.target.detail;\n        var offsetLeftInGutter = e.target.element.offsetLeft;\n        var gutterOffsetX = data.offsetX - offsetLeftInGutter; // const gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\n        // TODO@joao TODO@alex TODO@martin this is such that we don't collide with dirty diff\n\n        if (gutterOffsetX < 5) {\n          // the whitespace between the border and the real folding icon border is 5px\n          return;\n        }\n\n        iconClicked = true;\n        break;\n\n      case 6\n      /* CONTENT_TEXT */\n      :\n        {\n          if (this.hiddenRangeModel.hasRanges()) {\n            var model = this.editor.getModel();\n\n            if (model && range.startColumn === model.getLineMaxColumn(range.startLineNumber)) {\n              break;\n            }\n          }\n\n          return;\n        }\n\n      default:\n        return;\n    }\n\n    this.mouseDownInfo = {\n      lineNumber: range.startLineNumber,\n      iconClicked: iconClicked\n    };\n  };\n\n  FoldingController.prototype.onEditorMouseUp = function (e) {\n    var _this = this;\n\n    var foldingModel = this.getFoldingModel();\n\n    if (!foldingModel || !this.mouseDownInfo || !e.target) {\n      return;\n    }\n\n    var lineNumber = this.mouseDownInfo.lineNumber;\n    var iconClicked = this.mouseDownInfo.iconClicked;\n    var range = e.target.range;\n\n    if (!range || range.startLineNumber !== lineNumber) {\n      return;\n    }\n\n    if (iconClicked) {\n      if (e.target.type !== 4\n      /* GUTTER_LINE_DECORATIONS */\n      ) {\n          return;\n        }\n    } else {\n      var model = this.editor.getModel();\n\n      if (!model || range.startColumn !== model.getLineMaxColumn(lineNumber)) {\n        return;\n      }\n    }\n\n    foldingModel.then(function (foldingModel) {\n      if (foldingModel) {\n        var region = foldingModel.getRegionAtLine(lineNumber);\n\n        if (region && region.startLineNumber === lineNumber) {\n          var isCollapsed = region.isCollapsed;\n\n          if (iconClicked || isCollapsed) {\n            var toToggle = [];\n            var recursive = e.event.middleButton || e.event.shiftKey;\n\n            if (recursive) {\n              for (var _i = 0, _a = foldingModel.getRegionsInside(region); _i < _a.length; _i++) {\n                var r = _a[_i];\n\n                if (r.isCollapsed === isCollapsed) {\n                  toToggle.push(r);\n                }\n              }\n            } // when recursive, first only collapse all children. If all are already folded or there are no children, also fold parent.\n\n\n            if (isCollapsed || !recursive || toToggle.length === 0) {\n              toToggle.push(region);\n            }\n\n            foldingModel.toggleCollapseState(toToggle);\n\n            _this.reveal({\n              lineNumber: lineNumber,\n              column: 1\n            });\n          }\n        }\n      }\n    }).then(undefined, onUnexpectedError);\n  };\n\n  FoldingController.prototype.reveal = function (position) {\n    this.editor.revealPositionInCenterIfOutsideViewport(position, 0\n    /* Smooth */\n    );\n  };\n\n  FoldingController.ID = 'editor.contrib.folding';\n  FoldingController = __decorate([__param(1, IContextKeyService)], FoldingController);\n  return FoldingController;\n}(Disposable);\n\nexport { FoldingController };\n\nvar FoldingAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldingAction, _super);\n\n  function FoldingAction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FoldingAction.prototype.runEditorCommand = function (accessor, editor, args) {\n    var _this = this;\n\n    var foldingController = FoldingController.get(editor);\n\n    if (!foldingController) {\n      return;\n    }\n\n    var foldingModelPromise = foldingController.getFoldingModel();\n\n    if (foldingModelPromise) {\n      this.reportTelemetry(accessor, editor);\n      return foldingModelPromise.then(function (foldingModel) {\n        if (foldingModel) {\n          _this.invoke(foldingController, foldingModel, editor, args);\n\n          var selection = editor.getSelection();\n\n          if (selection) {\n            foldingController.reveal(selection.getStartPosition());\n          }\n        }\n      });\n    }\n  };\n\n  FoldingAction.prototype.getSelectedLines = function (editor) {\n    var selections = editor.getSelections();\n    return selections ? selections.map(function (s) {\n      return s.startLineNumber;\n    }) : [];\n  };\n\n  FoldingAction.prototype.getLineNumbers = function (args, editor) {\n    if (args && args.selectionLines) {\n      return args.selectionLines.map(function (l) {\n        return l + 1;\n      }); // to 0-bases line numbers\n    }\n\n    return this.getSelectedLines(editor);\n  };\n\n  FoldingAction.prototype.run = function (_accessor, _editor) {};\n\n  return FoldingAction;\n}(EditorAction);\n\nfunction foldingArgumentsConstraint(args) {\n  if (!types.isUndefined(args)) {\n    if (!types.isObject(args)) {\n      return false;\n    }\n\n    var foldingArgs = args;\n\n    if (!types.isUndefined(foldingArgs.levels) && !types.isNumber(foldingArgs.levels)) {\n      return false;\n    }\n\n    if (!types.isUndefined(foldingArgs.direction) && !types.isString(foldingArgs.direction)) {\n      return false;\n    }\n\n    if (!types.isUndefined(foldingArgs.selectionLines) && (!types.isArray(foldingArgs.selectionLines) || !foldingArgs.selectionLines.every(types.isNumber))) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nvar UnfoldAction =\n/** @class */\nfunction (_super) {\n  __extends(UnfoldAction, _super);\n\n  function UnfoldAction() {\n    return _super.call(this, {\n      id: 'editor.unfold',\n      label: nls.localize('unfoldAction.label', \"Unfold\"),\n      alias: 'Unfold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 89\n        /* US_CLOSE_SQUARE_BRACKET */\n        ,\n        mac: {\n          primary: 2048\n          /* CtrlCmd */\n          | 512\n          /* Alt */\n          | 89\n          /* US_CLOSE_SQUARE_BRACKET */\n\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      description: {\n        description: 'Unfold the content in the editor',\n        args: [{\n          name: 'Unfold editor argument',\n          description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t\\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\\n\\t\\t\\t\\t\\t\\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\\n\\t\\t\\t\\t\\t\\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\\n\\t\\t\\t\\t\\t\\t\",\n          constraint: foldingArgumentsConstraint,\n          schema: {\n            'type': 'object',\n            'properties': {\n              'levels': {\n                'type': 'number',\n                'default': 1\n              },\n              'direction': {\n                'type': 'string',\n                'enum': ['up', 'down'],\n                'default': 'down'\n              },\n              'selectionLines': {\n                'type': 'array',\n                'items': {\n                  'type': 'number'\n                }\n              }\n            }\n          }\n        }]\n      }\n    }) || this;\n  }\n\n  UnfoldAction.prototype.invoke = function (_foldingController, foldingModel, editor, args) {\n    var levels = args && args.levels || 1;\n    var lineNumbers = this.getLineNumbers(args, editor);\n\n    if (args && args.direction === 'up') {\n      setCollapseStateLevelsUp(foldingModel, false, levels, lineNumbers);\n    } else {\n      setCollapseStateLevelsDown(foldingModel, false, levels, lineNumbers);\n    }\n  };\n\n  return UnfoldAction;\n}(FoldingAction);\n\nvar UnFoldRecursivelyAction =\n/** @class */\nfunction (_super) {\n  __extends(UnFoldRecursivelyAction, _super);\n\n  function UnFoldRecursivelyAction() {\n    return _super.call(this, {\n      id: 'editor.unfoldRecursively',\n      label: nls.localize('unFoldRecursivelyAction.label', \"Unfold Recursively\"),\n      alias: 'Unfold Recursively',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 89\n        /* US_CLOSE_SQUARE_BRACKET */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  UnFoldRecursivelyAction.prototype.invoke = function (_foldingController, foldingModel, editor, _args) {\n    setCollapseStateLevelsDown(foldingModel, false, Number.MAX_VALUE, this.getSelectedLines(editor));\n  };\n\n  return UnFoldRecursivelyAction;\n}(FoldingAction);\n\nvar FoldAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldAction, _super);\n\n  function FoldAction() {\n    return _super.call(this, {\n      id: 'editor.fold',\n      label: nls.localize('foldAction.label', \"Fold\"),\n      alias: 'Fold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 87\n        /* US_OPEN_SQUARE_BRACKET */\n        ,\n        mac: {\n          primary: 2048\n          /* CtrlCmd */\n          | 512\n          /* Alt */\n          | 87\n          /* US_OPEN_SQUARE_BRACKET */\n\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      description: {\n        description: 'Fold the content in the editor',\n        args: [{\n          name: 'Fold editor argument',\n          description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t\\t\\t* 'levels': Number of levels to fold.\\n\\t\\t\\t\\t\\t\\t\\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\\n\\t\\t\\t\\t\\t\\t\\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\\n\\t\\t\\t\\t\\t\\t\\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\\n\\t\\t\\t\\t\\t\\t\",\n          constraint: foldingArgumentsConstraint,\n          schema: {\n            'type': 'object',\n            'properties': {\n              'levels': {\n                'type': 'number'\n              },\n              'direction': {\n                'type': 'string',\n                'enum': ['up', 'down']\n              },\n              'selectionLines': {\n                'type': 'array',\n                'items': {\n                  'type': 'number'\n                }\n              }\n            }\n          }\n        }]\n      }\n    }) || this;\n  }\n\n  FoldAction.prototype.invoke = function (_foldingController, foldingModel, editor, args) {\n    var lineNumbers = this.getLineNumbers(args, editor);\n    var levels = args && args.levels;\n    var direction = args && args.direction;\n\n    if (typeof levels !== 'number' && typeof direction !== 'string') {\n      // fold the region at the location or if already collapsed, the first uncollapsed parent instead.\n      setCollapseStateUp(foldingModel, true, lineNumbers);\n    } else {\n      if (direction === 'up') {\n        setCollapseStateLevelsUp(foldingModel, true, levels || 1, lineNumbers);\n      } else {\n        setCollapseStateLevelsDown(foldingModel, true, levels || 1, lineNumbers);\n      }\n    }\n  };\n\n  return FoldAction;\n}(FoldingAction);\n\nvar ToggleFoldAction =\n/** @class */\nfunction (_super) {\n  __extends(ToggleFoldAction, _super);\n\n  function ToggleFoldAction() {\n    return _super.call(this, {\n      id: 'editor.toggleFold',\n      label: nls.localize('toggleFoldAction.label', \"Toggle Fold\"),\n      alias: 'Toggle Fold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 42\n        /* KEY_L */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  ToggleFoldAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\n    var selectedLines = this.getSelectedLines(editor);\n    toggleCollapseState(foldingModel, 1, selectedLines);\n  };\n\n  return ToggleFoldAction;\n}(FoldingAction);\n\nvar FoldRecursivelyAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldRecursivelyAction, _super);\n\n  function FoldRecursivelyAction() {\n    return _super.call(this, {\n      id: 'editor.foldRecursively',\n      label: nls.localize('foldRecursivelyAction.label', \"Fold Recursively\"),\n      alias: 'Fold Recursively',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 87\n        /* US_OPEN_SQUARE_BRACKET */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  FoldRecursivelyAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\n    var selectedLines = this.getSelectedLines(editor);\n    setCollapseStateLevelsDown(foldingModel, true, Number.MAX_VALUE, selectedLines);\n  };\n\n  return FoldRecursivelyAction;\n}(FoldingAction);\n\nvar FoldAllBlockCommentsAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldAllBlockCommentsAction, _super);\n\n  function FoldAllBlockCommentsAction() {\n    return _super.call(this, {\n      id: 'editor.foldAllBlockComments',\n      label: nls.localize('foldAllBlockComments.label', \"Fold All Block Comments\"),\n      alias: 'Fold All Block Comments',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 85\n        /* US_SLASH */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  FoldAllBlockCommentsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\n    if (foldingModel.regions.hasTypes()) {\n      setCollapseStateForType(foldingModel, FoldingRangeKind.Comment.value, true);\n    } else {\n      var editorModel = editor.getModel();\n\n      if (!editorModel) {\n        return;\n      }\n\n      var comments = LanguageConfigurationRegistry.getComments(editorModel.getLanguageIdentifier().id);\n\n      if (comments && comments.blockCommentStartToken) {\n        var regExp = new RegExp('^\\\\s*' + escapeRegExpCharacters(comments.blockCommentStartToken));\n        setCollapseStateForMatchingLines(foldingModel, regExp, true);\n      }\n    }\n  };\n\n  return FoldAllBlockCommentsAction;\n}(FoldingAction);\n\nvar FoldAllRegionsAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldAllRegionsAction, _super);\n\n  function FoldAllRegionsAction() {\n    return _super.call(this, {\n      id: 'editor.foldAllMarkerRegions',\n      label: nls.localize('foldAllMarkerRegions.label', \"Fold All Regions\"),\n      alias: 'Fold All Regions',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 29\n        /* KEY_8 */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  FoldAllRegionsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\n    if (foldingModel.regions.hasTypes()) {\n      setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, true);\n    } else {\n      var editorModel = editor.getModel();\n\n      if (!editorModel) {\n        return;\n      }\n\n      var foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageIdentifier().id);\n\n      if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\n        var regExp = new RegExp(foldingRules.markers.start);\n        setCollapseStateForMatchingLines(foldingModel, regExp, true);\n      }\n    }\n  };\n\n  return FoldAllRegionsAction;\n}(FoldingAction);\n\nvar UnfoldAllRegionsAction =\n/** @class */\nfunction (_super) {\n  __extends(UnfoldAllRegionsAction, _super);\n\n  function UnfoldAllRegionsAction() {\n    return _super.call(this, {\n      id: 'editor.unfoldAllMarkerRegions',\n      label: nls.localize('unfoldAllMarkerRegions.label', \"Unfold All Regions\"),\n      alias: 'Unfold All Regions',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 30\n        /* KEY_9 */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  UnfoldAllRegionsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\n    if (foldingModel.regions.hasTypes()) {\n      setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, false);\n    } else {\n      var editorModel = editor.getModel();\n\n      if (!editorModel) {\n        return;\n      }\n\n      var foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageIdentifier().id);\n\n      if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\n        var regExp = new RegExp(foldingRules.markers.start);\n        setCollapseStateForMatchingLines(foldingModel, regExp, false);\n      }\n    }\n  };\n\n  return UnfoldAllRegionsAction;\n}(FoldingAction);\n\nvar FoldAllAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldAllAction, _super);\n\n  function FoldAllAction() {\n    return _super.call(this, {\n      id: 'editor.foldAll',\n      label: nls.localize('foldAllAction.label', \"Fold All\"),\n      alias: 'Fold All',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 21\n        /* KEY_0 */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  FoldAllAction.prototype.invoke = function (_foldingController, foldingModel, _editor) {\n    setCollapseStateLevelsDown(foldingModel, true);\n  };\n\n  return FoldAllAction;\n}(FoldingAction);\n\nvar UnfoldAllAction =\n/** @class */\nfunction (_super) {\n  __extends(UnfoldAllAction, _super);\n\n  function UnfoldAllAction() {\n    return _super.call(this, {\n      id: 'editor.unfoldAll',\n      label: nls.localize('unfoldAllAction.label', \"Unfold All\"),\n      alias: 'Unfold All',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 40\n        /* KEY_J */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  UnfoldAllAction.prototype.invoke = function (_foldingController, foldingModel, _editor) {\n    setCollapseStateLevelsDown(foldingModel, false);\n  };\n\n  return UnfoldAllAction;\n}(FoldingAction);\n\nvar FoldLevelAction =\n/** @class */\nfunction (_super) {\n  __extends(FoldLevelAction, _super);\n\n  function FoldLevelAction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FoldLevelAction.prototype.getFoldingLevel = function () {\n    return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length));\n  };\n\n  FoldLevelAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\n    setCollapseStateAtLevel(foldingModel, this.getFoldingLevel(), true, this.getSelectedLines(editor));\n  };\n\n  FoldLevelAction.ID_PREFIX = 'editor.foldLevel';\n\n  FoldLevelAction.ID = function (level) {\n    return FoldLevelAction.ID_PREFIX + level;\n  };\n\n  return FoldLevelAction;\n}(FoldingAction);\n\nregisterEditorContribution(FoldingController.ID, FoldingController);\nregisterEditorAction(UnfoldAction);\nregisterEditorAction(UnFoldRecursivelyAction);\nregisterEditorAction(FoldAction);\nregisterEditorAction(FoldRecursivelyAction);\nregisterEditorAction(FoldAllAction);\nregisterEditorAction(UnfoldAllAction);\nregisterEditorAction(FoldAllBlockCommentsAction);\nregisterEditorAction(FoldAllRegionsAction);\nregisterEditorAction(UnfoldAllRegionsAction);\nregisterEditorAction(ToggleFoldAction);\n\nfor (var i = 1; i <= 7; i++) {\n  registerInstantiatedEditorAction(new FoldLevelAction({\n    id: FoldLevelAction.ID(i),\n    label: nls.localize('foldLevelAction.label', \"Fold Level {0}\", i),\n    alias: \"Fold Level \" + i,\n    precondition: CONTEXT_FOLDING_ENABLED,\n    kbOpts: {\n      kbExpr: EditorContextKeys.editorTextFocus,\n      primary: KeyChord(2048\n      /* CtrlCmd */\n      | 41\n      /* KEY_K */\n      , 2048\n      /* CtrlCmd */\n      | 21\n      /* KEY_0 */\n      + i),\n      weight: 100\n      /* EditorContrib */\n\n    }\n  }));\n}\n\nexport var foldBackgroundBackground = registerColor('editor.foldBackground', {\n  light: transparent(editorSelectionBackground, 0.3),\n  dark: transparent(editorSelectionBackground, 0.3),\n  hc: null\n}, nls.localize('editorSelectionBackground', \"Color of the editor selection.\"));\nregisterThemingParticipant(function (theme, collector) {\n  var foldBackground = theme.getColor(foldBackgroundBackground);\n\n  if (foldBackground) {\n    collector.addRule(\".monaco-editor .folded-background { background-color: \" + foldBackground + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/folding/folding.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","nls","types","escapeRegExpCharacters","RunOnceScheduler","Delayer","createCancelablePromise","KeyChord","Disposable","DisposableStore","registerEditorAction","registerEditorContribution","EditorAction","registerInstantiatedEditorAction","FoldingModel","setCollapseStateAtLevel","setCollapseStateLevelsDown","setCollapseStateLevelsUp","setCollapseStateForMatchingLines","setCollapseStateForType","toggleCollapseState","setCollapseStateUp","FoldingDecorationProvider","EditorContextKeys","HiddenRangeModel","LanguageConfigurationRegistry","IndentRangeProvider","FoldingRangeProviderRegistry","FoldingRangeKind","SyntaxRangeProvider","ID_SYNTAX_PROVIDER","InitializingRangeProvider","ID_INIT_PROVIDER","onUnexpectedError","RawContextKey","IContextKeyService","registerThemingParticipant","registerColor","editorSelectionBackground","transparent","CONTEXT_FOLDING_ENABLED","FoldingController","_super","editor","contextKeyService","_this","call","localToDispose","_register","options","getOptions","_isEnabled","get","_useFoldingProviders","foldingModel","hiddenRangeModel","rangeProvider","foldingRegionPromise","foldingStateMemento","foldingModelPromise","updateScheduler","cursorChangedScheduler","mouseDownInfo","foldingDecorationProvider","autoHideFoldingControls","showFoldingHighlights","foldingEnabled","bindTo","set","onDidChangeModel","onModelChanged","onDidChangeConfiguration","e","hasChanged","options_1","options_2","onModelContentChanged","options_3","onFoldingStrategyChanged","getContribution","ID","saveViewState","model","getModel","isTooLargeForTokenization","collapsedRegions","isInitialized","getMemento","provider","id","undefined","lineCount","getLineCount","restoreViewState","state","applyMemento","getFoldingModel","then","clear","add","onDidChange","hr","onHiddenRangesChanges","revealCursor","onDidChangeModelLanguageConfiguration","onDidChangeModelContent","onDidChangeCursorPosition","onCursorPositionChanged","onMouseDown","onEditorMouseDown","onMouseUp","onEditorMouseUp","dispose","cancel","getRangeProvider","editorModel","foldingProviders","ordered","textModel","trigger","token","compute","foldingRanges","selections","getSelections","selectionLineNumbers","map","s","startLineNumber","update","err","hiddenRanges","adjustSelections","setSelections","setHiddenAreas","hasRanges","schedule","toToggle","_loop_1","selection","lineNumber","selectionStartLineNumber","isHidden","push","apply","getAllRegionsAtLine","isCollapsed","_i","selections_1","reveal","getPosition","range","event","leftButton","middleButton","iconClicked","type","data","detail","offsetLeftInGutter","element","offsetLeft","gutterOffsetX","offsetX","startColumn","getLineMaxColumn","region","getRegionAtLine","recursive","shiftKey","_a","getRegionsInside","column","position","revealPositionInCenterIfOutsideViewport","FoldingAction","runEditorCommand","accessor","args","foldingController","reportTelemetry","invoke","getSelection","getStartPosition","getSelectedLines","getLineNumbers","selectionLines","l","run","_accessor","_editor","foldingArgumentsConstraint","isUndefined","isObject","foldingArgs","levels","isNumber","direction","isString","isArray","every","UnfoldAction","label","localize","alias","precondition","kbOpts","kbExpr","editorTextFocus","primary","mac","weight","description","name","constraint","schema","_foldingController","lineNumbers","UnFoldRecursivelyAction","_args","Number","MAX_VALUE","FoldAction","ToggleFoldAction","selectedLines","FoldRecursivelyAction","FoldAllBlockCommentsAction","regions","hasTypes","Comment","value","comments","getComments","getLanguageIdentifier","blockCommentStartToken","regExp","RegExp","FoldAllRegionsAction","Region","foldingRules","getFoldingRules","markers","start","UnfoldAllRegionsAction","FoldAllAction","UnfoldAllAction","FoldLevelAction","getFoldingLevel","parseInt","substr","ID_PREFIX","level","foldBackgroundBackground","light","dark","hc","theme","collector","foldBackground","getColor","addRule"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport './folding.css';\r\nimport * as nls from '../../../nls.js';\r\nimport * as types from '../../../base/common/types.js';\r\nimport { escapeRegExpCharacters } from '../../../base/common/strings.js';\r\nimport { RunOnceScheduler, Delayer, createCancelablePromise } from '../../../base/common/async.js';\r\nimport { KeyChord } from '../../../base/common/keyCodes.js';\r\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { registerEditorAction, registerEditorContribution, EditorAction, registerInstantiatedEditorAction } from '../../browser/editorExtensions.js';\r\nimport { FoldingModel, setCollapseStateAtLevel, setCollapseStateLevelsDown, setCollapseStateLevelsUp, setCollapseStateForMatchingLines, setCollapseStateForType, toggleCollapseState, setCollapseStateUp } from './foldingModel.js';\r\nimport { FoldingDecorationProvider } from './foldingDecorations.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { HiddenRangeModel } from './hiddenRangeModel.js';\r\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\r\nimport { IndentRangeProvider } from './indentRangeProvider.js';\r\nimport { FoldingRangeProviderRegistry, FoldingRangeKind } from '../../common/modes.js';\r\nimport { SyntaxRangeProvider, ID_SYNTAX_PROVIDER } from './syntaxRangeProvider.js';\r\nimport { InitializingRangeProvider, ID_INIT_PROVIDER } from './intializingRangeProvider.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nimport { RawContextKey, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { registerColor, editorSelectionBackground, transparent } from '../../../platform/theme/common/colorRegistry.js';\r\nvar CONTEXT_FOLDING_ENABLED = new RawContextKey('foldingEnabled', false);\r\nvar FoldingController = /** @class */ (function (_super) {\r\n    __extends(FoldingController, _super);\r\n    function FoldingController(editor, contextKeyService) {\r\n        var _this = _super.call(this) || this;\r\n        _this.contextKeyService = contextKeyService;\r\n        _this.localToDispose = _this._register(new DisposableStore());\r\n        _this.editor = editor;\r\n        var options = _this.editor.getOptions();\r\n        _this._isEnabled = options.get(30 /* folding */);\r\n        _this._useFoldingProviders = options.get(31 /* foldingStrategy */) !== 'indentation';\r\n        _this.foldingModel = null;\r\n        _this.hiddenRangeModel = null;\r\n        _this.rangeProvider = null;\r\n        _this.foldingRegionPromise = null;\r\n        _this.foldingStateMemento = null;\r\n        _this.foldingModelPromise = null;\r\n        _this.updateScheduler = null;\r\n        _this.cursorChangedScheduler = null;\r\n        _this.mouseDownInfo = null;\r\n        _this.foldingDecorationProvider = new FoldingDecorationProvider(editor);\r\n        _this.foldingDecorationProvider.autoHideFoldingControls = options.get(84 /* showFoldingControls */) === 'mouseover';\r\n        _this.foldingDecorationProvider.showFoldingHighlights = options.get(32 /* foldingHighlight */);\r\n        _this.foldingEnabled = CONTEXT_FOLDING_ENABLED.bindTo(_this.contextKeyService);\r\n        _this.foldingEnabled.set(_this._isEnabled);\r\n        _this._register(_this.editor.onDidChangeModel(function () { return _this.onModelChanged(); }));\r\n        _this._register(_this.editor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(30 /* folding */)) {\r\n                var options_1 = _this.editor.getOptions();\r\n                _this._isEnabled = options_1.get(30 /* folding */);\r\n                _this.foldingEnabled.set(_this._isEnabled);\r\n                _this.onModelChanged();\r\n            }\r\n            if (e.hasChanged(84 /* showFoldingControls */) || e.hasChanged(32 /* foldingHighlight */)) {\r\n                var options_2 = _this.editor.getOptions();\r\n                _this.foldingDecorationProvider.autoHideFoldingControls = options_2.get(84 /* showFoldingControls */) === 'mouseover';\r\n                _this.foldingDecorationProvider.showFoldingHighlights = options_2.get(32 /* foldingHighlight */);\r\n                _this.onModelContentChanged();\r\n            }\r\n            if (e.hasChanged(31 /* foldingStrategy */)) {\r\n                var options_3 = _this.editor.getOptions();\r\n                _this._useFoldingProviders = options_3.get(31 /* foldingStrategy */) !== 'indentation';\r\n                _this.onFoldingStrategyChanged();\r\n            }\r\n        }));\r\n        _this.onModelChanged();\r\n        return _this;\r\n    }\r\n    FoldingController.get = function (editor) {\r\n        return editor.getContribution(FoldingController.ID);\r\n    };\r\n    /**\r\n     * Store view state.\r\n     */\r\n    FoldingController.prototype.saveViewState = function () {\r\n        var model = this.editor.getModel();\r\n        if (!model || !this._isEnabled || model.isTooLargeForTokenization()) {\r\n            return {};\r\n        }\r\n        if (this.foldingModel) { // disposed ?\r\n            var collapsedRegions = this.foldingModel.isInitialized ? this.foldingModel.getMemento() : this.hiddenRangeModel.getMemento();\r\n            var provider = this.rangeProvider ? this.rangeProvider.id : undefined;\r\n            return { collapsedRegions: collapsedRegions, lineCount: model.getLineCount(), provider: provider };\r\n        }\r\n        return undefined;\r\n    };\r\n    /**\r\n     * Restore view state.\r\n     */\r\n    FoldingController.prototype.restoreViewState = function (state) {\r\n        var model = this.editor.getModel();\r\n        if (!model || !this._isEnabled || model.isTooLargeForTokenization() || !this.hiddenRangeModel) {\r\n            return;\r\n        }\r\n        if (!state || !state.collapsedRegions || state.lineCount !== model.getLineCount()) {\r\n            return;\r\n        }\r\n        if (state.provider === ID_SYNTAX_PROVIDER || state.provider === ID_INIT_PROVIDER) {\r\n            this.foldingStateMemento = state;\r\n        }\r\n        var collapsedRegions = state.collapsedRegions;\r\n        // set the hidden ranges right away, before waiting for the folding model.\r\n        if (this.hiddenRangeModel.applyMemento(collapsedRegions)) {\r\n            var foldingModel = this.getFoldingModel();\r\n            if (foldingModel) {\r\n                foldingModel.then(function (foldingModel) {\r\n                    if (foldingModel) {\r\n                        foldingModel.applyMemento(collapsedRegions);\r\n                    }\r\n                }).then(undefined, onUnexpectedError);\r\n            }\r\n        }\r\n    };\r\n    FoldingController.prototype.onModelChanged = function () {\r\n        var _this = this;\r\n        this.localToDispose.clear();\r\n        var model = this.editor.getModel();\r\n        if (!this._isEnabled || !model || model.isTooLargeForTokenization()) {\r\n            // huge files get no view model, so they cannot support hidden areas\r\n            return;\r\n        }\r\n        this.foldingModel = new FoldingModel(model, this.foldingDecorationProvider);\r\n        this.localToDispose.add(this.foldingModel);\r\n        this.hiddenRangeModel = new HiddenRangeModel(this.foldingModel);\r\n        this.localToDispose.add(this.hiddenRangeModel);\r\n        this.localToDispose.add(this.hiddenRangeModel.onDidChange(function (hr) { return _this.onHiddenRangesChanges(hr); }));\r\n        this.updateScheduler = new Delayer(200);\r\n        this.cursorChangedScheduler = new RunOnceScheduler(function () { return _this.revealCursor(); }, 200);\r\n        this.localToDispose.add(this.cursorChangedScheduler);\r\n        this.localToDispose.add(FoldingRangeProviderRegistry.onDidChange(function () { return _this.onFoldingStrategyChanged(); }));\r\n        this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(function () { return _this.onFoldingStrategyChanged(); })); // covers model language changes as well\r\n        this.localToDispose.add(this.editor.onDidChangeModelContent(function () { return _this.onModelContentChanged(); }));\r\n        this.localToDispose.add(this.editor.onDidChangeCursorPosition(function () { return _this.onCursorPositionChanged(); }));\r\n        this.localToDispose.add(this.editor.onMouseDown(function (e) { return _this.onEditorMouseDown(e); }));\r\n        this.localToDispose.add(this.editor.onMouseUp(function (e) { return _this.onEditorMouseUp(e); }));\r\n        this.localToDispose.add({\r\n            dispose: function () {\r\n                if (_this.foldingRegionPromise) {\r\n                    _this.foldingRegionPromise.cancel();\r\n                    _this.foldingRegionPromise = null;\r\n                }\r\n                if (_this.updateScheduler) {\r\n                    _this.updateScheduler.cancel();\r\n                }\r\n                _this.updateScheduler = null;\r\n                _this.foldingModel = null;\r\n                _this.foldingModelPromise = null;\r\n                _this.hiddenRangeModel = null;\r\n                _this.cursorChangedScheduler = null;\r\n                _this.foldingStateMemento = null;\r\n                if (_this.rangeProvider) {\r\n                    _this.rangeProvider.dispose();\r\n                }\r\n                _this.rangeProvider = null;\r\n            }\r\n        });\r\n        this.onModelContentChanged();\r\n    };\r\n    FoldingController.prototype.onFoldingStrategyChanged = function () {\r\n        if (this.rangeProvider) {\r\n            this.rangeProvider.dispose();\r\n        }\r\n        this.rangeProvider = null;\r\n        this.onModelContentChanged();\r\n    };\r\n    FoldingController.prototype.getRangeProvider = function (editorModel) {\r\n        var _this = this;\r\n        if (this.rangeProvider) {\r\n            return this.rangeProvider;\r\n        }\r\n        this.rangeProvider = new IndentRangeProvider(editorModel); // fallback\r\n        if (this._useFoldingProviders && this.foldingModel) {\r\n            var foldingProviders = FoldingRangeProviderRegistry.ordered(this.foldingModel.textModel);\r\n            if (foldingProviders.length === 0 && this.foldingStateMemento && this.foldingStateMemento.collapsedRegions) {\r\n                var rangeProvider = this.rangeProvider = new InitializingRangeProvider(editorModel, this.foldingStateMemento.collapsedRegions, function () {\r\n                    // if after 30 the InitializingRangeProvider is still not replaced, force a refresh\r\n                    _this.foldingStateMemento = null;\r\n                    _this.onFoldingStrategyChanged();\r\n                }, 30000);\r\n                return rangeProvider; // keep memento in case there are still no foldingProviders on the next request.\r\n            }\r\n            else if (foldingProviders.length > 0) {\r\n                this.rangeProvider = new SyntaxRangeProvider(editorModel, foldingProviders);\r\n            }\r\n        }\r\n        this.foldingStateMemento = null;\r\n        return this.rangeProvider;\r\n    };\r\n    FoldingController.prototype.getFoldingModel = function () {\r\n        return this.foldingModelPromise;\r\n    };\r\n    FoldingController.prototype.onModelContentChanged = function () {\r\n        var _this = this;\r\n        if (this.updateScheduler) {\r\n            if (this.foldingRegionPromise) {\r\n                this.foldingRegionPromise.cancel();\r\n                this.foldingRegionPromise = null;\r\n            }\r\n            this.foldingModelPromise = this.updateScheduler.trigger(function () {\r\n                var foldingModel = _this.foldingModel;\r\n                if (!foldingModel) { // null if editor has been disposed, or folding turned off\r\n                    return null;\r\n                }\r\n                var foldingRegionPromise = _this.foldingRegionPromise = createCancelablePromise(function (token) { return _this.getRangeProvider(foldingModel.textModel).compute(token); });\r\n                return foldingRegionPromise.then(function (foldingRanges) {\r\n                    if (foldingRanges && foldingRegionPromise === _this.foldingRegionPromise) { // new request or cancelled in the meantime?\r\n                        // some cursors might have moved into hidden regions, make sure they are in expanded regions\r\n                        var selections = _this.editor.getSelections();\r\n                        var selectionLineNumbers = selections ? selections.map(function (s) { return s.startLineNumber; }) : [];\r\n                        foldingModel.update(foldingRanges, selectionLineNumbers);\r\n                    }\r\n                    return foldingModel;\r\n                });\r\n            }).then(undefined, function (err) {\r\n                onUnexpectedError(err);\r\n                return null;\r\n            });\r\n        }\r\n    };\r\n    FoldingController.prototype.onHiddenRangesChanges = function (hiddenRanges) {\r\n        if (this.hiddenRangeModel && hiddenRanges.length) {\r\n            var selections = this.editor.getSelections();\r\n            if (selections) {\r\n                if (this.hiddenRangeModel.adjustSelections(selections)) {\r\n                    this.editor.setSelections(selections);\r\n                }\r\n            }\r\n        }\r\n        this.editor.setHiddenAreas(hiddenRanges);\r\n    };\r\n    FoldingController.prototype.onCursorPositionChanged = function () {\r\n        if (this.hiddenRangeModel && this.hiddenRangeModel.hasRanges()) {\r\n            this.cursorChangedScheduler.schedule();\r\n        }\r\n    };\r\n    FoldingController.prototype.revealCursor = function () {\r\n        var _this = this;\r\n        var foldingModel = this.getFoldingModel();\r\n        if (!foldingModel) {\r\n            return;\r\n        }\r\n        foldingModel.then(function (foldingModel) {\r\n            if (foldingModel) {\r\n                var selections = _this.editor.getSelections();\r\n                if (selections && selections.length > 0) {\r\n                    var toToggle = [];\r\n                    var _loop_1 = function (selection) {\r\n                        var lineNumber = selection.selectionStartLineNumber;\r\n                        if (_this.hiddenRangeModel && _this.hiddenRangeModel.isHidden(lineNumber)) {\r\n                            toToggle.push.apply(toToggle, foldingModel.getAllRegionsAtLine(lineNumber, function (r) { return r.isCollapsed && lineNumber > r.startLineNumber; }));\r\n                        }\r\n                    };\r\n                    for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\r\n                        var selection = selections_1[_i];\r\n                        _loop_1(selection);\r\n                    }\r\n                    if (toToggle.length) {\r\n                        foldingModel.toggleCollapseState(toToggle);\r\n                        _this.reveal(selections[0].getPosition());\r\n                    }\r\n                }\r\n            }\r\n        }).then(undefined, onUnexpectedError);\r\n    };\r\n    FoldingController.prototype.onEditorMouseDown = function (e) {\r\n        this.mouseDownInfo = null;\r\n        if (!this.hiddenRangeModel || !e.target || !e.target.range) {\r\n            return;\r\n        }\r\n        if (!e.event.leftButton && !e.event.middleButton) {\r\n            return;\r\n        }\r\n        var range = e.target.range;\r\n        var iconClicked = false;\r\n        switch (e.target.type) {\r\n            case 4 /* GUTTER_LINE_DECORATIONS */:\r\n                var data = e.target.detail;\r\n                var offsetLeftInGutter = e.target.element.offsetLeft;\r\n                var gutterOffsetX = data.offsetX - offsetLeftInGutter;\r\n                // const gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\r\n                // TODO@joao TODO@alex TODO@martin this is such that we don't collide with dirty diff\r\n                if (gutterOffsetX < 5) { // the whitespace between the border and the real folding icon border is 5px\r\n                    return;\r\n                }\r\n                iconClicked = true;\r\n                break;\r\n            case 6 /* CONTENT_TEXT */: {\r\n                if (this.hiddenRangeModel.hasRanges()) {\r\n                    var model = this.editor.getModel();\r\n                    if (model && range.startColumn === model.getLineMaxColumn(range.startLineNumber)) {\r\n                        break;\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            default:\r\n                return;\r\n        }\r\n        this.mouseDownInfo = { lineNumber: range.startLineNumber, iconClicked: iconClicked };\r\n    };\r\n    FoldingController.prototype.onEditorMouseUp = function (e) {\r\n        var _this = this;\r\n        var foldingModel = this.getFoldingModel();\r\n        if (!foldingModel || !this.mouseDownInfo || !e.target) {\r\n            return;\r\n        }\r\n        var lineNumber = this.mouseDownInfo.lineNumber;\r\n        var iconClicked = this.mouseDownInfo.iconClicked;\r\n        var range = e.target.range;\r\n        if (!range || range.startLineNumber !== lineNumber) {\r\n            return;\r\n        }\r\n        if (iconClicked) {\r\n            if (e.target.type !== 4 /* GUTTER_LINE_DECORATIONS */) {\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            var model = this.editor.getModel();\r\n            if (!model || range.startColumn !== model.getLineMaxColumn(lineNumber)) {\r\n                return;\r\n            }\r\n        }\r\n        foldingModel.then(function (foldingModel) {\r\n            if (foldingModel) {\r\n                var region = foldingModel.getRegionAtLine(lineNumber);\r\n                if (region && region.startLineNumber === lineNumber) {\r\n                    var isCollapsed = region.isCollapsed;\r\n                    if (iconClicked || isCollapsed) {\r\n                        var toToggle = [];\r\n                        var recursive = e.event.middleButton || e.event.shiftKey;\r\n                        if (recursive) {\r\n                            for (var _i = 0, _a = foldingModel.getRegionsInside(region); _i < _a.length; _i++) {\r\n                                var r = _a[_i];\r\n                                if (r.isCollapsed === isCollapsed) {\r\n                                    toToggle.push(r);\r\n                                }\r\n                            }\r\n                        }\r\n                        // when recursive, first only collapse all children. If all are already folded or there are no children, also fold parent.\r\n                        if (isCollapsed || !recursive || toToggle.length === 0) {\r\n                            toToggle.push(region);\r\n                        }\r\n                        foldingModel.toggleCollapseState(toToggle);\r\n                        _this.reveal({ lineNumber: lineNumber, column: 1 });\r\n                    }\r\n                }\r\n            }\r\n        }).then(undefined, onUnexpectedError);\r\n    };\r\n    FoldingController.prototype.reveal = function (position) {\r\n        this.editor.revealPositionInCenterIfOutsideViewport(position, 0 /* Smooth */);\r\n    };\r\n    FoldingController.ID = 'editor.contrib.folding';\r\n    FoldingController = __decorate([\r\n        __param(1, IContextKeyService)\r\n    ], FoldingController);\r\n    return FoldingController;\r\n}(Disposable));\r\nexport { FoldingController };\r\nvar FoldingAction = /** @class */ (function (_super) {\r\n    __extends(FoldingAction, _super);\r\n    function FoldingAction() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FoldingAction.prototype.runEditorCommand = function (accessor, editor, args) {\r\n        var _this = this;\r\n        var foldingController = FoldingController.get(editor);\r\n        if (!foldingController) {\r\n            return;\r\n        }\r\n        var foldingModelPromise = foldingController.getFoldingModel();\r\n        if (foldingModelPromise) {\r\n            this.reportTelemetry(accessor, editor);\r\n            return foldingModelPromise.then(function (foldingModel) {\r\n                if (foldingModel) {\r\n                    _this.invoke(foldingController, foldingModel, editor, args);\r\n                    var selection = editor.getSelection();\r\n                    if (selection) {\r\n                        foldingController.reveal(selection.getStartPosition());\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    FoldingAction.prototype.getSelectedLines = function (editor) {\r\n        var selections = editor.getSelections();\r\n        return selections ? selections.map(function (s) { return s.startLineNumber; }) : [];\r\n    };\r\n    FoldingAction.prototype.getLineNumbers = function (args, editor) {\r\n        if (args && args.selectionLines) {\r\n            return args.selectionLines.map(function (l) { return l + 1; }); // to 0-bases line numbers\r\n        }\r\n        return this.getSelectedLines(editor);\r\n    };\r\n    FoldingAction.prototype.run = function (_accessor, _editor) {\r\n    };\r\n    return FoldingAction;\r\n}(EditorAction));\r\nfunction foldingArgumentsConstraint(args) {\r\n    if (!types.isUndefined(args)) {\r\n        if (!types.isObject(args)) {\r\n            return false;\r\n        }\r\n        var foldingArgs = args;\r\n        if (!types.isUndefined(foldingArgs.levels) && !types.isNumber(foldingArgs.levels)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(foldingArgs.direction) && !types.isString(foldingArgs.direction)) {\r\n            return false;\r\n        }\r\n        if (!types.isUndefined(foldingArgs.selectionLines) && (!types.isArray(foldingArgs.selectionLines) || !foldingArgs.selectionLines.every(types.isNumber))) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nvar UnfoldAction = /** @class */ (function (_super) {\r\n    __extends(UnfoldAction, _super);\r\n    function UnfoldAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfold',\r\n            label: nls.localize('unfoldAction.label', \"Unfold\"),\r\n            alias: 'Unfold',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 89 /* US_CLOSE_SQUARE_BRACKET */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 89 /* US_CLOSE_SQUARE_BRACKET */\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            description: {\r\n                description: 'Unfold the content in the editor',\r\n                args: [\r\n                    {\r\n                        name: 'Unfold editor argument',\r\n                        description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t\\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\\n\\t\\t\\t\\t\\t\\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\\n\\t\\t\\t\\t\\t\\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\\n\\t\\t\\t\\t\\t\\t\",\r\n                        constraint: foldingArgumentsConstraint,\r\n                        schema: {\r\n                            'type': 'object',\r\n                            'properties': {\r\n                                'levels': {\r\n                                    'type': 'number',\r\n                                    'default': 1\r\n                                },\r\n                                'direction': {\r\n                                    'type': 'string',\r\n                                    'enum': ['up', 'down'],\r\n                                    'default': 'down'\r\n                                },\r\n                                'selectionLines': {\r\n                                    'type': 'array',\r\n                                    'items': {\r\n                                        'type': 'number'\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        }) || this;\r\n    }\r\n    UnfoldAction.prototype.invoke = function (_foldingController, foldingModel, editor, args) {\r\n        var levels = args && args.levels || 1;\r\n        var lineNumbers = this.getLineNumbers(args, editor);\r\n        if (args && args.direction === 'up') {\r\n            setCollapseStateLevelsUp(foldingModel, false, levels, lineNumbers);\r\n        }\r\n        else {\r\n            setCollapseStateLevelsDown(foldingModel, false, levels, lineNumbers);\r\n        }\r\n    };\r\n    return UnfoldAction;\r\n}(FoldingAction));\r\nvar UnFoldRecursivelyAction = /** @class */ (function (_super) {\r\n    __extends(UnFoldRecursivelyAction, _super);\r\n    function UnFoldRecursivelyAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfoldRecursively',\r\n            label: nls.localize('unFoldRecursivelyAction.label', \"Unfold Recursively\"),\r\n            alias: 'Unfold Recursively',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 89 /* US_CLOSE_SQUARE_BRACKET */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    UnFoldRecursivelyAction.prototype.invoke = function (_foldingController, foldingModel, editor, _args) {\r\n        setCollapseStateLevelsDown(foldingModel, false, Number.MAX_VALUE, this.getSelectedLines(editor));\r\n    };\r\n    return UnFoldRecursivelyAction;\r\n}(FoldingAction));\r\nvar FoldAction = /** @class */ (function (_super) {\r\n    __extends(FoldAction, _super);\r\n    function FoldAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.fold',\r\n            label: nls.localize('foldAction.label', \"Fold\"),\r\n            alias: 'Fold',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 87 /* US_OPEN_SQUARE_BRACKET */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 87 /* US_OPEN_SQUARE_BRACKET */\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            description: {\r\n                description: 'Fold the content in the editor',\r\n                args: [\r\n                    {\r\n                        name: 'Fold editor argument',\r\n                        description: \"Property-value pairs that can be passed through this argument:\\n\\t\\t\\t\\t\\t\\t\\t* 'levels': Number of levels to fold.\\n\\t\\t\\t\\t\\t\\t\\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\\n\\t\\t\\t\\t\\t\\t\\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\\n\\t\\t\\t\\t\\t\\t\\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\\n\\t\\t\\t\\t\\t\\t\",\r\n                        constraint: foldingArgumentsConstraint,\r\n                        schema: {\r\n                            'type': 'object',\r\n                            'properties': {\r\n                                'levels': {\r\n                                    'type': 'number',\r\n                                },\r\n                                'direction': {\r\n                                    'type': 'string',\r\n                                    'enum': ['up', 'down'],\r\n                                },\r\n                                'selectionLines': {\r\n                                    'type': 'array',\r\n                                    'items': {\r\n                                        'type': 'number'\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAction.prototype.invoke = function (_foldingController, foldingModel, editor, args) {\r\n        var lineNumbers = this.getLineNumbers(args, editor);\r\n        var levels = args && args.levels;\r\n        var direction = args && args.direction;\r\n        if (typeof levels !== 'number' && typeof direction !== 'string') {\r\n            // fold the region at the location or if already collapsed, the first uncollapsed parent instead.\r\n            setCollapseStateUp(foldingModel, true, lineNumbers);\r\n        }\r\n        else {\r\n            if (direction === 'up') {\r\n                setCollapseStateLevelsUp(foldingModel, true, levels || 1, lineNumbers);\r\n            }\r\n            else {\r\n                setCollapseStateLevelsDown(foldingModel, true, levels || 1, lineNumbers);\r\n            }\r\n        }\r\n    };\r\n    return FoldAction;\r\n}(FoldingAction));\r\nvar ToggleFoldAction = /** @class */ (function (_super) {\r\n    __extends(ToggleFoldAction, _super);\r\n    function ToggleFoldAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.toggleFold',\r\n            label: nls.localize('toggleFoldAction.label', \"Toggle Fold\"),\r\n            alias: 'Toggle Fold',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 42 /* KEY_L */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    ToggleFoldAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        var selectedLines = this.getSelectedLines(editor);\r\n        toggleCollapseState(foldingModel, 1, selectedLines);\r\n    };\r\n    return ToggleFoldAction;\r\n}(FoldingAction));\r\nvar FoldRecursivelyAction = /** @class */ (function (_super) {\r\n    __extends(FoldRecursivelyAction, _super);\r\n    function FoldRecursivelyAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldRecursively',\r\n            label: nls.localize('foldRecursivelyAction.label', \"Fold Recursively\"),\r\n            alias: 'Fold Recursively',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 87 /* US_OPEN_SQUARE_BRACKET */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldRecursivelyAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        var selectedLines = this.getSelectedLines(editor);\r\n        setCollapseStateLevelsDown(foldingModel, true, Number.MAX_VALUE, selectedLines);\r\n    };\r\n    return FoldRecursivelyAction;\r\n}(FoldingAction));\r\nvar FoldAllBlockCommentsAction = /** @class */ (function (_super) {\r\n    __extends(FoldAllBlockCommentsAction, _super);\r\n    function FoldAllBlockCommentsAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldAllBlockComments',\r\n            label: nls.localize('foldAllBlockComments.label', \"Fold All Block Comments\"),\r\n            alias: 'Fold All Block Comments',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 85 /* US_SLASH */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAllBlockCommentsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        if (foldingModel.regions.hasTypes()) {\r\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Comment.value, true);\r\n        }\r\n        else {\r\n            var editorModel = editor.getModel();\r\n            if (!editorModel) {\r\n                return;\r\n            }\r\n            var comments = LanguageConfigurationRegistry.getComments(editorModel.getLanguageIdentifier().id);\r\n            if (comments && comments.blockCommentStartToken) {\r\n                var regExp = new RegExp('^\\\\s*' + escapeRegExpCharacters(comments.blockCommentStartToken));\r\n                setCollapseStateForMatchingLines(foldingModel, regExp, true);\r\n            }\r\n        }\r\n    };\r\n    return FoldAllBlockCommentsAction;\r\n}(FoldingAction));\r\nvar FoldAllRegionsAction = /** @class */ (function (_super) {\r\n    __extends(FoldAllRegionsAction, _super);\r\n    function FoldAllRegionsAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldAllMarkerRegions',\r\n            label: nls.localize('foldAllMarkerRegions.label', \"Fold All Regions\"),\r\n            alias: 'Fold All Regions',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 29 /* KEY_8 */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAllRegionsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        if (foldingModel.regions.hasTypes()) {\r\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, true);\r\n        }\r\n        else {\r\n            var editorModel = editor.getModel();\r\n            if (!editorModel) {\r\n                return;\r\n            }\r\n            var foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageIdentifier().id);\r\n            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\r\n                var regExp = new RegExp(foldingRules.markers.start);\r\n                setCollapseStateForMatchingLines(foldingModel, regExp, true);\r\n            }\r\n        }\r\n    };\r\n    return FoldAllRegionsAction;\r\n}(FoldingAction));\r\nvar UnfoldAllRegionsAction = /** @class */ (function (_super) {\r\n    __extends(UnfoldAllRegionsAction, _super);\r\n    function UnfoldAllRegionsAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfoldAllMarkerRegions',\r\n            label: nls.localize('unfoldAllMarkerRegions.label', \"Unfold All Regions\"),\r\n            alias: 'Unfold All Regions',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 30 /* KEY_9 */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    UnfoldAllRegionsAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        if (foldingModel.regions.hasTypes()) {\r\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, false);\r\n        }\r\n        else {\r\n            var editorModel = editor.getModel();\r\n            if (!editorModel) {\r\n                return;\r\n            }\r\n            var foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageIdentifier().id);\r\n            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\r\n                var regExp = new RegExp(foldingRules.markers.start);\r\n                setCollapseStateForMatchingLines(foldingModel, regExp, false);\r\n            }\r\n        }\r\n    };\r\n    return UnfoldAllRegionsAction;\r\n}(FoldingAction));\r\nvar FoldAllAction = /** @class */ (function (_super) {\r\n    __extends(FoldAllAction, _super);\r\n    function FoldAllAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.foldAll',\r\n            label: nls.localize('foldAllAction.label', \"Fold All\"),\r\n            alias: 'Fold All',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 21 /* KEY_0 */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    FoldAllAction.prototype.invoke = function (_foldingController, foldingModel, _editor) {\r\n        setCollapseStateLevelsDown(foldingModel, true);\r\n    };\r\n    return FoldAllAction;\r\n}(FoldingAction));\r\nvar UnfoldAllAction = /** @class */ (function (_super) {\r\n    __extends(UnfoldAllAction, _super);\r\n    function UnfoldAllAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.unfoldAll',\r\n            label: nls.localize('unfoldAllAction.label', \"Unfold All\"),\r\n            alias: 'Unfold All',\r\n            precondition: CONTEXT_FOLDING_ENABLED,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 40 /* KEY_J */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    UnfoldAllAction.prototype.invoke = function (_foldingController, foldingModel, _editor) {\r\n        setCollapseStateLevelsDown(foldingModel, false);\r\n    };\r\n    return UnfoldAllAction;\r\n}(FoldingAction));\r\nvar FoldLevelAction = /** @class */ (function (_super) {\r\n    __extends(FoldLevelAction, _super);\r\n    function FoldLevelAction() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FoldLevelAction.prototype.getFoldingLevel = function () {\r\n        return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length));\r\n    };\r\n    FoldLevelAction.prototype.invoke = function (_foldingController, foldingModel, editor) {\r\n        setCollapseStateAtLevel(foldingModel, this.getFoldingLevel(), true, this.getSelectedLines(editor));\r\n    };\r\n    FoldLevelAction.ID_PREFIX = 'editor.foldLevel';\r\n    FoldLevelAction.ID = function (level) { return FoldLevelAction.ID_PREFIX + level; };\r\n    return FoldLevelAction;\r\n}(FoldingAction));\r\nregisterEditorContribution(FoldingController.ID, FoldingController);\r\nregisterEditorAction(UnfoldAction);\r\nregisterEditorAction(UnFoldRecursivelyAction);\r\nregisterEditorAction(FoldAction);\r\nregisterEditorAction(FoldRecursivelyAction);\r\nregisterEditorAction(FoldAllAction);\r\nregisterEditorAction(UnfoldAllAction);\r\nregisterEditorAction(FoldAllBlockCommentsAction);\r\nregisterEditorAction(FoldAllRegionsAction);\r\nregisterEditorAction(UnfoldAllRegionsAction);\r\nregisterEditorAction(ToggleFoldAction);\r\nfor (var i = 1; i <= 7; i++) {\r\n    registerInstantiatedEditorAction(new FoldLevelAction({\r\n        id: FoldLevelAction.ID(i),\r\n        label: nls.localize('foldLevelAction.label', \"Fold Level {0}\", i),\r\n        alias: \"Fold Level \" + i,\r\n        precondition: CONTEXT_FOLDING_ENABLED,\r\n        kbOpts: {\r\n            kbExpr: EditorContextKeys.editorTextFocus,\r\n            primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | (21 /* KEY_0 */ + i)),\r\n            weight: 100 /* EditorContrib */\r\n        }\r\n    }));\r\n}\r\nexport var foldBackgroundBackground = registerColor('editor.foldBackground', { light: transparent(editorSelectionBackground, 0.3), dark: transparent(editorSelectionBackground, 0.3), hc: null }, nls.localize('editorSelectionBackground', \"Color of the editor selection.\"));\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var foldBackground = theme.getColor(foldBackgroundBackground);\r\n    if (foldBackground) {\r\n        collector.addRule(\".monaco-editor .folded-background { background-color: \" + foldBackground + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}