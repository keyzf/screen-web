{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport './selections.css';\nimport * as browser from '../../../../base/browser/browser.js';\nimport { DynamicViewOverlay } from '../../view/dynamicViewOverlay.js';\nimport { editorInactiveSelection, editorSelectionBackground, editorSelectionForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\n\nvar HorizontalRangeWithStyle =\n/** @class */\nfunction () {\n  function HorizontalRangeWithStyle(other) {\n    this.left = other.left;\n    this.width = other.width;\n    this.startStyle = null;\n    this.endStyle = null;\n  }\n\n  return HorizontalRangeWithStyle;\n}();\n\nvar LineVisibleRangesWithStyle =\n/** @class */\nfunction () {\n  function LineVisibleRangesWithStyle(lineNumber, ranges) {\n    this.lineNumber = lineNumber;\n    this.ranges = ranges;\n  }\n\n  return LineVisibleRangesWithStyle;\n}();\n\nfunction toStyledRange(item) {\n  return new HorizontalRangeWithStyle(item);\n}\n\nfunction toStyled(item) {\n  return new LineVisibleRangesWithStyle(item.lineNumber, item.ranges.map(toStyledRange));\n} // TODO@Alex: Remove this once IE11 fixes Bug #524217\n// The problem in IE11 is that it does some sort of auto-zooming to accomodate for displays with different pixel density.\n// Unfortunately, this auto-zooming is buggy around dealing with rounded borders\n\n\nvar isIEWithZoomingIssuesNearRoundedBorders = browser.isEdgeOrIE;\n\nvar SelectionsOverlay =\n/** @class */\nfunction (_super) {\n  __extends(SelectionsOverlay, _super);\n\n  function SelectionsOverlay(context) {\n    var _this = _super.call(this) || this;\n\n    _this._previousFrameVisibleRangesWithStyle = [];\n    _this._context = context;\n    var options = _this._context.configuration.options;\n    _this._lineHeight = options.get(49\n    /* lineHeight */\n    );\n    _this._roundedSelection = options.get(76\n    /* roundedSelection */\n    );\n    _this._typicalHalfwidthCharacterWidth = options.get(34\n    /* fontInfo */\n    ).typicalHalfwidthCharacterWidth;\n    _this._selections = [];\n    _this._renderResult = null;\n\n    _this._context.addEventHandler(_this);\n\n    return _this;\n  }\n\n  SelectionsOverlay.prototype.dispose = function () {\n    this._context.removeEventHandler(this);\n\n    this._renderResult = null;\n\n    _super.prototype.dispose.call(this);\n  }; // --- begin event handlers\n\n\n  SelectionsOverlay.prototype.onConfigurationChanged = function (e) {\n    var options = this._context.configuration.options;\n    this._lineHeight = options.get(49\n    /* lineHeight */\n    );\n    this._roundedSelection = options.get(76\n    /* roundedSelection */\n    );\n    this._typicalHalfwidthCharacterWidth = options.get(34\n    /* fontInfo */\n    ).typicalHalfwidthCharacterWidth;\n    return true;\n  };\n\n  SelectionsOverlay.prototype.onCursorStateChanged = function (e) {\n    this._selections = e.selections.slice(0);\n    return true;\n  };\n\n  SelectionsOverlay.prototype.onDecorationsChanged = function (e) {\n    // true for inline decorations that can end up relayouting text\n    return true; //e.inlineDecorationsChanged;\n  };\n\n  SelectionsOverlay.prototype.onFlushed = function (e) {\n    return true;\n  };\n\n  SelectionsOverlay.prototype.onLinesChanged = function (e) {\n    return true;\n  };\n\n  SelectionsOverlay.prototype.onLinesDeleted = function (e) {\n    return true;\n  };\n\n  SelectionsOverlay.prototype.onLinesInserted = function (e) {\n    return true;\n  };\n\n  SelectionsOverlay.prototype.onScrollChanged = function (e) {\n    return e.scrollTopChanged;\n  };\n\n  SelectionsOverlay.prototype.onZonesChanged = function (e) {\n    return true;\n  }; // --- end event handlers\n\n\n  SelectionsOverlay.prototype._visibleRangesHaveGaps = function (linesVisibleRanges) {\n    for (var i = 0, len = linesVisibleRanges.length; i < len; i++) {\n      var lineVisibleRanges = linesVisibleRanges[i];\n\n      if (lineVisibleRanges.ranges.length > 1) {\n        // There are two ranges on the same line\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  SelectionsOverlay.prototype._enrichVisibleRangesWithStyle = function (viewport, linesVisibleRanges, previousFrame) {\n    var epsilon = this._typicalHalfwidthCharacterWidth / 4;\n    var previousFrameTop = null;\n    var previousFrameBottom = null;\n\n    if (previousFrame && previousFrame.length > 0 && linesVisibleRanges.length > 0) {\n      var topLineNumber = linesVisibleRanges[0].lineNumber;\n\n      if (topLineNumber === viewport.startLineNumber) {\n        for (var i = 0; !previousFrameTop && i < previousFrame.length; i++) {\n          if (previousFrame[i].lineNumber === topLineNumber) {\n            previousFrameTop = previousFrame[i].ranges[0];\n          }\n        }\n      }\n\n      var bottomLineNumber = linesVisibleRanges[linesVisibleRanges.length - 1].lineNumber;\n\n      if (bottomLineNumber === viewport.endLineNumber) {\n        for (var i = previousFrame.length - 1; !previousFrameBottom && i >= 0; i--) {\n          if (previousFrame[i].lineNumber === bottomLineNumber) {\n            previousFrameBottom = previousFrame[i].ranges[0];\n          }\n        }\n      }\n\n      if (previousFrameTop && !previousFrameTop.startStyle) {\n        previousFrameTop = null;\n      }\n\n      if (previousFrameBottom && !previousFrameBottom.startStyle) {\n        previousFrameBottom = null;\n      }\n    }\n\n    for (var i = 0, len = linesVisibleRanges.length; i < len; i++) {\n      // We know for a fact that there is precisely one range on each line\n      var curLineRange = linesVisibleRanges[i].ranges[0];\n      var curLeft = curLineRange.left;\n      var curRight = curLineRange.left + curLineRange.width;\n      var startStyle = {\n        top: 0\n        /* EXTERN */\n        ,\n        bottom: 0\n        /* EXTERN */\n\n      };\n      var endStyle = {\n        top: 0\n        /* EXTERN */\n        ,\n        bottom: 0\n        /* EXTERN */\n\n      };\n\n      if (i > 0) {\n        // Look above\n        var prevLeft = linesVisibleRanges[i - 1].ranges[0].left;\n        var prevRight = linesVisibleRanges[i - 1].ranges[0].left + linesVisibleRanges[i - 1].ranges[0].width;\n\n        if (abs(curLeft - prevLeft) < epsilon) {\n          startStyle.top = 2\n          /* FLAT */\n          ;\n        } else if (curLeft > prevLeft) {\n          startStyle.top = 1\n          /* INTERN */\n          ;\n        }\n\n        if (abs(curRight - prevRight) < epsilon) {\n          endStyle.top = 2\n          /* FLAT */\n          ;\n        } else if (prevLeft < curRight && curRight < prevRight) {\n          endStyle.top = 1\n          /* INTERN */\n          ;\n        }\n      } else if (previousFrameTop) {\n        // Accept some hick-ups near the viewport edges to save on repaints\n        startStyle.top = previousFrameTop.startStyle.top;\n        endStyle.top = previousFrameTop.endStyle.top;\n      }\n\n      if (i + 1 < len) {\n        // Look below\n        var nextLeft = linesVisibleRanges[i + 1].ranges[0].left;\n        var nextRight = linesVisibleRanges[i + 1].ranges[0].left + linesVisibleRanges[i + 1].ranges[0].width;\n\n        if (abs(curLeft - nextLeft) < epsilon) {\n          startStyle.bottom = 2\n          /* FLAT */\n          ;\n        } else if (nextLeft < curLeft && curLeft < nextRight) {\n          startStyle.bottom = 1\n          /* INTERN */\n          ;\n        }\n\n        if (abs(curRight - nextRight) < epsilon) {\n          endStyle.bottom = 2\n          /* FLAT */\n          ;\n        } else if (curRight < nextRight) {\n          endStyle.bottom = 1\n          /* INTERN */\n          ;\n        }\n      } else if (previousFrameBottom) {\n        // Accept some hick-ups near the viewport edges to save on repaints\n        startStyle.bottom = previousFrameBottom.startStyle.bottom;\n        endStyle.bottom = previousFrameBottom.endStyle.bottom;\n      }\n\n      curLineRange.startStyle = startStyle;\n      curLineRange.endStyle = endStyle;\n    }\n  };\n\n  SelectionsOverlay.prototype._getVisibleRangesWithStyle = function (selection, ctx, previousFrame) {\n    var _linesVisibleRanges = ctx.linesVisibleRangesForRange(selection, true) || [];\n\n    var linesVisibleRanges = _linesVisibleRanges.map(toStyled);\n\n    var visibleRangesHaveGaps = this._visibleRangesHaveGaps(linesVisibleRanges);\n\n    if (!isIEWithZoomingIssuesNearRoundedBorders && !visibleRangesHaveGaps && this._roundedSelection) {\n      this._enrichVisibleRangesWithStyle(ctx.visibleRange, linesVisibleRanges, previousFrame);\n    } // The visible ranges are sorted TOP-BOTTOM and LEFT-RIGHT\n\n\n    return linesVisibleRanges;\n  };\n\n  SelectionsOverlay.prototype._createSelectionPiece = function (top, height, className, left, width) {\n    return '<div class=\"cslr ' + className + '\" style=\"top:' + top.toString() + 'px;left:' + left.toString() + 'px;width:' + width.toString() + 'px;height:' + height + 'px;\"></div>';\n  };\n\n  SelectionsOverlay.prototype._actualRenderOneSelection = function (output2, visibleStartLineNumber, hasMultipleSelections, visibleRanges) {\n    if (visibleRanges.length === 0) {\n      return;\n    }\n\n    var visibleRangesHaveStyle = !!visibleRanges[0].ranges[0].startStyle;\n\n    var fullLineHeight = this._lineHeight.toString();\n\n    var reducedLineHeight = (this._lineHeight - 1).toString();\n    var firstLineNumber = visibleRanges[0].lineNumber;\n    var lastLineNumber = visibleRanges[visibleRanges.length - 1].lineNumber;\n\n    for (var i = 0, len = visibleRanges.length; i < len; i++) {\n      var lineVisibleRanges = visibleRanges[i];\n      var lineNumber = lineVisibleRanges.lineNumber;\n      var lineIndex = lineNumber - visibleStartLineNumber;\n      var lineHeight = hasMultipleSelections ? lineNumber === lastLineNumber || lineNumber === firstLineNumber ? reducedLineHeight : fullLineHeight : fullLineHeight;\n      var top_1 = hasMultipleSelections ? lineNumber === firstLineNumber ? 1 : 0 : 0;\n      var innerCornerOutput = '';\n      var restOfSelectionOutput = '';\n\n      for (var j = 0, lenJ = lineVisibleRanges.ranges.length; j < lenJ; j++) {\n        var visibleRange = lineVisibleRanges.ranges[j];\n\n        if (visibleRangesHaveStyle) {\n          var startStyle = visibleRange.startStyle;\n          var endStyle = visibleRange.endStyle;\n\n          if (startStyle.top === 1\n          /* INTERN */\n          || startStyle.bottom === 1\n          /* INTERN */\n          ) {\n              // Reverse rounded corner to the left\n              // First comes the selection (blue layer)\n              innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, SelectionsOverlay.SELECTION_CLASS_NAME, visibleRange.left - SelectionsOverlay.ROUNDED_PIECE_WIDTH, SelectionsOverlay.ROUNDED_PIECE_WIDTH); // Second comes the background (white layer) with inverse border radius\n\n              var className_1 = SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME;\n\n              if (startStyle.top === 1\n              /* INTERN */\n              ) {\n                  className_1 += ' ' + SelectionsOverlay.SELECTION_TOP_RIGHT;\n                }\n\n              if (startStyle.bottom === 1\n              /* INTERN */\n              ) {\n                  className_1 += ' ' + SelectionsOverlay.SELECTION_BOTTOM_RIGHT;\n                }\n\n              innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, className_1, visibleRange.left - SelectionsOverlay.ROUNDED_PIECE_WIDTH, SelectionsOverlay.ROUNDED_PIECE_WIDTH);\n            }\n\n          if (endStyle.top === 1\n          /* INTERN */\n          || endStyle.bottom === 1\n          /* INTERN */\n          ) {\n              // Reverse rounded corner to the right\n              // First comes the selection (blue layer)\n              innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, SelectionsOverlay.SELECTION_CLASS_NAME, visibleRange.left + visibleRange.width, SelectionsOverlay.ROUNDED_PIECE_WIDTH); // Second comes the background (white layer) with inverse border radius\n\n              var className_2 = SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME;\n\n              if (endStyle.top === 1\n              /* INTERN */\n              ) {\n                  className_2 += ' ' + SelectionsOverlay.SELECTION_TOP_LEFT;\n                }\n\n              if (endStyle.bottom === 1\n              /* INTERN */\n              ) {\n                  className_2 += ' ' + SelectionsOverlay.SELECTION_BOTTOM_LEFT;\n                }\n\n              innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, className_2, visibleRange.left + visibleRange.width, SelectionsOverlay.ROUNDED_PIECE_WIDTH);\n            }\n        }\n\n        var className = SelectionsOverlay.SELECTION_CLASS_NAME;\n\n        if (visibleRangesHaveStyle) {\n          var startStyle = visibleRange.startStyle;\n          var endStyle = visibleRange.endStyle;\n\n          if (startStyle.top === 0\n          /* EXTERN */\n          ) {\n              className += ' ' + SelectionsOverlay.SELECTION_TOP_LEFT;\n            }\n\n          if (startStyle.bottom === 0\n          /* EXTERN */\n          ) {\n              className += ' ' + SelectionsOverlay.SELECTION_BOTTOM_LEFT;\n            }\n\n          if (endStyle.top === 0\n          /* EXTERN */\n          ) {\n              className += ' ' + SelectionsOverlay.SELECTION_TOP_RIGHT;\n            }\n\n          if (endStyle.bottom === 0\n          /* EXTERN */\n          ) {\n              className += ' ' + SelectionsOverlay.SELECTION_BOTTOM_RIGHT;\n            }\n        }\n\n        restOfSelectionOutput += this._createSelectionPiece(top_1, lineHeight, className, visibleRange.left, visibleRange.width);\n      }\n\n      output2[lineIndex][0] += innerCornerOutput;\n      output2[lineIndex][1] += restOfSelectionOutput;\n    }\n  };\n\n  SelectionsOverlay.prototype.prepareRender = function (ctx) {\n    // Build HTML for inner corners separate from HTML for the rest of selections,\n    // as the inner corner HTML can interfere with that of other selections.\n    // In final render, make sure to place the inner corner HTML before the rest of selection HTML. See issue #77777.\n    var output = [];\n    var visibleStartLineNumber = ctx.visibleRange.startLineNumber;\n    var visibleEndLineNumber = ctx.visibleRange.endLineNumber;\n\n    for (var lineNumber = visibleStartLineNumber; lineNumber <= visibleEndLineNumber; lineNumber++) {\n      var lineIndex = lineNumber - visibleStartLineNumber;\n      output[lineIndex] = ['', ''];\n    }\n\n    var thisFrameVisibleRangesWithStyle = [];\n\n    for (var i = 0, len = this._selections.length; i < len; i++) {\n      var selection = this._selections[i];\n\n      if (selection.isEmpty()) {\n        thisFrameVisibleRangesWithStyle[i] = null;\n        continue;\n      }\n\n      var visibleRangesWithStyle = this._getVisibleRangesWithStyle(selection, ctx, this._previousFrameVisibleRangesWithStyle[i]);\n\n      thisFrameVisibleRangesWithStyle[i] = visibleRangesWithStyle;\n\n      this._actualRenderOneSelection(output, visibleStartLineNumber, this._selections.length > 1, visibleRangesWithStyle);\n    }\n\n    this._previousFrameVisibleRangesWithStyle = thisFrameVisibleRangesWithStyle;\n    this._renderResult = output.map(function (_a) {\n      var internalCorners = _a[0],\n          restOfSelection = _a[1];\n      return internalCorners + restOfSelection;\n    });\n  };\n\n  SelectionsOverlay.prototype.render = function (startLineNumber, lineNumber) {\n    if (!this._renderResult) {\n      return '';\n    }\n\n    var lineIndex = lineNumber - startLineNumber;\n\n    if (lineIndex < 0 || lineIndex >= this._renderResult.length) {\n      return '';\n    }\n\n    return this._renderResult[lineIndex];\n  };\n\n  SelectionsOverlay.SELECTION_CLASS_NAME = 'selected-text';\n  SelectionsOverlay.SELECTION_TOP_LEFT = 'top-left-radius';\n  SelectionsOverlay.SELECTION_BOTTOM_LEFT = 'bottom-left-radius';\n  SelectionsOverlay.SELECTION_TOP_RIGHT = 'top-right-radius';\n  SelectionsOverlay.SELECTION_BOTTOM_RIGHT = 'bottom-right-radius';\n  SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME = 'monaco-editor-background';\n  SelectionsOverlay.ROUNDED_PIECE_WIDTH = 10;\n  return SelectionsOverlay;\n}(DynamicViewOverlay);\n\nexport { SelectionsOverlay };\nregisterThemingParticipant(function (theme, collector) {\n  var editorSelectionColor = theme.getColor(editorSelectionBackground);\n\n  if (editorSelectionColor) {\n    collector.addRule(\".monaco-editor .focused .selected-text { background-color: \" + editorSelectionColor + \"; }\");\n  }\n\n  var editorInactiveSelectionColor = theme.getColor(editorInactiveSelection);\n\n  if (editorInactiveSelectionColor) {\n    collector.addRule(\".monaco-editor .selected-text { background-color: \" + editorInactiveSelectionColor + \"; }\");\n  }\n\n  var editorSelectionForegroundColor = theme.getColor(editorSelectionForeground);\n\n  if (editorSelectionForegroundColor) {\n    collector.addRule(\".monaco-editor .view-line span.inline-selected-text { color: \" + editorSelectionForegroundColor + \"; }\");\n  }\n});\n\nfunction abs(n) {\n  return n < 0 ? -n : n;\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/browser/viewParts/selections/selections.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","browser","DynamicViewOverlay","editorInactiveSelection","editorSelectionBackground","editorSelectionForeground","registerThemingParticipant","HorizontalRangeWithStyle","other","left","width","startStyle","endStyle","LineVisibleRangesWithStyle","lineNumber","ranges","toStyledRange","item","toStyled","map","isIEWithZoomingIssuesNearRoundedBorders","isEdgeOrIE","SelectionsOverlay","_super","context","_this","call","_previousFrameVisibleRangesWithStyle","_context","options","configuration","_lineHeight","get","_roundedSelection","_typicalHalfwidthCharacterWidth","typicalHalfwidthCharacterWidth","_selections","_renderResult","addEventHandler","dispose","removeEventHandler","onConfigurationChanged","e","onCursorStateChanged","selections","slice","onDecorationsChanged","onFlushed","onLinesChanged","onLinesDeleted","onLinesInserted","onScrollChanged","scrollTopChanged","onZonesChanged","_visibleRangesHaveGaps","linesVisibleRanges","i","len","length","lineVisibleRanges","_enrichVisibleRangesWithStyle","viewport","previousFrame","epsilon","previousFrameTop","previousFrameBottom","topLineNumber","startLineNumber","bottomLineNumber","endLineNumber","curLineRange","curLeft","curRight","top","bottom","prevLeft","prevRight","abs","nextLeft","nextRight","_getVisibleRangesWithStyle","selection","ctx","_linesVisibleRanges","linesVisibleRangesForRange","visibleRangesHaveGaps","visibleRange","_createSelectionPiece","height","className","toString","_actualRenderOneSelection","output2","visibleStartLineNumber","hasMultipleSelections","visibleRanges","visibleRangesHaveStyle","fullLineHeight","reducedLineHeight","firstLineNumber","lastLineNumber","lineIndex","lineHeight","top_1","innerCornerOutput","restOfSelectionOutput","j","lenJ","SELECTION_CLASS_NAME","ROUNDED_PIECE_WIDTH","className_1","EDITOR_BACKGROUND_CLASS_NAME","SELECTION_TOP_RIGHT","SELECTION_BOTTOM_RIGHT","className_2","SELECTION_TOP_LEFT","SELECTION_BOTTOM_LEFT","prepareRender","output","visibleEndLineNumber","thisFrameVisibleRangesWithStyle","isEmpty","visibleRangesWithStyle","_a","internalCorners","restOfSelection","render","theme","collector","editorSelectionColor","getColor","addRule","editorInactiveSelectionColor","editorSelectionForegroundColor","n"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport './selections.css';\r\nimport * as browser from '../../../../base/browser/browser.js';\r\nimport { DynamicViewOverlay } from '../../view/dynamicViewOverlay.js';\r\nimport { editorInactiveSelection, editorSelectionBackground, editorSelectionForeground } from '../../../../platform/theme/common/colorRegistry.js';\r\nimport { registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\r\nvar HorizontalRangeWithStyle = /** @class */ (function () {\r\n    function HorizontalRangeWithStyle(other) {\r\n        this.left = other.left;\r\n        this.width = other.width;\r\n        this.startStyle = null;\r\n        this.endStyle = null;\r\n    }\r\n    return HorizontalRangeWithStyle;\r\n}());\r\nvar LineVisibleRangesWithStyle = /** @class */ (function () {\r\n    function LineVisibleRangesWithStyle(lineNumber, ranges) {\r\n        this.lineNumber = lineNumber;\r\n        this.ranges = ranges;\r\n    }\r\n    return LineVisibleRangesWithStyle;\r\n}());\r\nfunction toStyledRange(item) {\r\n    return new HorizontalRangeWithStyle(item);\r\n}\r\nfunction toStyled(item) {\r\n    return new LineVisibleRangesWithStyle(item.lineNumber, item.ranges.map(toStyledRange));\r\n}\r\n// TODO@Alex: Remove this once IE11 fixes Bug #524217\r\n// The problem in IE11 is that it does some sort of auto-zooming to accomodate for displays with different pixel density.\r\n// Unfortunately, this auto-zooming is buggy around dealing with rounded borders\r\nvar isIEWithZoomingIssuesNearRoundedBorders = browser.isEdgeOrIE;\r\nvar SelectionsOverlay = /** @class */ (function (_super) {\r\n    __extends(SelectionsOverlay, _super);\r\n    function SelectionsOverlay(context) {\r\n        var _this = _super.call(this) || this;\r\n        _this._previousFrameVisibleRangesWithStyle = [];\r\n        _this._context = context;\r\n        var options = _this._context.configuration.options;\r\n        _this._lineHeight = options.get(49 /* lineHeight */);\r\n        _this._roundedSelection = options.get(76 /* roundedSelection */);\r\n        _this._typicalHalfwidthCharacterWidth = options.get(34 /* fontInfo */).typicalHalfwidthCharacterWidth;\r\n        _this._selections = [];\r\n        _this._renderResult = null;\r\n        _this._context.addEventHandler(_this);\r\n        return _this;\r\n    }\r\n    SelectionsOverlay.prototype.dispose = function () {\r\n        this._context.removeEventHandler(this);\r\n        this._renderResult = null;\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    // --- begin event handlers\r\n    SelectionsOverlay.prototype.onConfigurationChanged = function (e) {\r\n        var options = this._context.configuration.options;\r\n        this._lineHeight = options.get(49 /* lineHeight */);\r\n        this._roundedSelection = options.get(76 /* roundedSelection */);\r\n        this._typicalHalfwidthCharacterWidth = options.get(34 /* fontInfo */).typicalHalfwidthCharacterWidth;\r\n        return true;\r\n    };\r\n    SelectionsOverlay.prototype.onCursorStateChanged = function (e) {\r\n        this._selections = e.selections.slice(0);\r\n        return true;\r\n    };\r\n    SelectionsOverlay.prototype.onDecorationsChanged = function (e) {\r\n        // true for inline decorations that can end up relayouting text\r\n        return true; //e.inlineDecorationsChanged;\r\n    };\r\n    SelectionsOverlay.prototype.onFlushed = function (e) {\r\n        return true;\r\n    };\r\n    SelectionsOverlay.prototype.onLinesChanged = function (e) {\r\n        return true;\r\n    };\r\n    SelectionsOverlay.prototype.onLinesDeleted = function (e) {\r\n        return true;\r\n    };\r\n    SelectionsOverlay.prototype.onLinesInserted = function (e) {\r\n        return true;\r\n    };\r\n    SelectionsOverlay.prototype.onScrollChanged = function (e) {\r\n        return e.scrollTopChanged;\r\n    };\r\n    SelectionsOverlay.prototype.onZonesChanged = function (e) {\r\n        return true;\r\n    };\r\n    // --- end event handlers\r\n    SelectionsOverlay.prototype._visibleRangesHaveGaps = function (linesVisibleRanges) {\r\n        for (var i = 0, len = linesVisibleRanges.length; i < len; i++) {\r\n            var lineVisibleRanges = linesVisibleRanges[i];\r\n            if (lineVisibleRanges.ranges.length > 1) {\r\n                // There are two ranges on the same line\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    SelectionsOverlay.prototype._enrichVisibleRangesWithStyle = function (viewport, linesVisibleRanges, previousFrame) {\r\n        var epsilon = this._typicalHalfwidthCharacterWidth / 4;\r\n        var previousFrameTop = null;\r\n        var previousFrameBottom = null;\r\n        if (previousFrame && previousFrame.length > 0 && linesVisibleRanges.length > 0) {\r\n            var topLineNumber = linesVisibleRanges[0].lineNumber;\r\n            if (topLineNumber === viewport.startLineNumber) {\r\n                for (var i = 0; !previousFrameTop && i < previousFrame.length; i++) {\r\n                    if (previousFrame[i].lineNumber === topLineNumber) {\r\n                        previousFrameTop = previousFrame[i].ranges[0];\r\n                    }\r\n                }\r\n            }\r\n            var bottomLineNumber = linesVisibleRanges[linesVisibleRanges.length - 1].lineNumber;\r\n            if (bottomLineNumber === viewport.endLineNumber) {\r\n                for (var i = previousFrame.length - 1; !previousFrameBottom && i >= 0; i--) {\r\n                    if (previousFrame[i].lineNumber === bottomLineNumber) {\r\n                        previousFrameBottom = previousFrame[i].ranges[0];\r\n                    }\r\n                }\r\n            }\r\n            if (previousFrameTop && !previousFrameTop.startStyle) {\r\n                previousFrameTop = null;\r\n            }\r\n            if (previousFrameBottom && !previousFrameBottom.startStyle) {\r\n                previousFrameBottom = null;\r\n            }\r\n        }\r\n        for (var i = 0, len = linesVisibleRanges.length; i < len; i++) {\r\n            // We know for a fact that there is precisely one range on each line\r\n            var curLineRange = linesVisibleRanges[i].ranges[0];\r\n            var curLeft = curLineRange.left;\r\n            var curRight = curLineRange.left + curLineRange.width;\r\n            var startStyle = {\r\n                top: 0 /* EXTERN */,\r\n                bottom: 0 /* EXTERN */\r\n            };\r\n            var endStyle = {\r\n                top: 0 /* EXTERN */,\r\n                bottom: 0 /* EXTERN */\r\n            };\r\n            if (i > 0) {\r\n                // Look above\r\n                var prevLeft = linesVisibleRanges[i - 1].ranges[0].left;\r\n                var prevRight = linesVisibleRanges[i - 1].ranges[0].left + linesVisibleRanges[i - 1].ranges[0].width;\r\n                if (abs(curLeft - prevLeft) < epsilon) {\r\n                    startStyle.top = 2 /* FLAT */;\r\n                }\r\n                else if (curLeft > prevLeft) {\r\n                    startStyle.top = 1 /* INTERN */;\r\n                }\r\n                if (abs(curRight - prevRight) < epsilon) {\r\n                    endStyle.top = 2 /* FLAT */;\r\n                }\r\n                else if (prevLeft < curRight && curRight < prevRight) {\r\n                    endStyle.top = 1 /* INTERN */;\r\n                }\r\n            }\r\n            else if (previousFrameTop) {\r\n                // Accept some hick-ups near the viewport edges to save on repaints\r\n                startStyle.top = previousFrameTop.startStyle.top;\r\n                endStyle.top = previousFrameTop.endStyle.top;\r\n            }\r\n            if (i + 1 < len) {\r\n                // Look below\r\n                var nextLeft = linesVisibleRanges[i + 1].ranges[0].left;\r\n                var nextRight = linesVisibleRanges[i + 1].ranges[0].left + linesVisibleRanges[i + 1].ranges[0].width;\r\n                if (abs(curLeft - nextLeft) < epsilon) {\r\n                    startStyle.bottom = 2 /* FLAT */;\r\n                }\r\n                else if (nextLeft < curLeft && curLeft < nextRight) {\r\n                    startStyle.bottom = 1 /* INTERN */;\r\n                }\r\n                if (abs(curRight - nextRight) < epsilon) {\r\n                    endStyle.bottom = 2 /* FLAT */;\r\n                }\r\n                else if (curRight < nextRight) {\r\n                    endStyle.bottom = 1 /* INTERN */;\r\n                }\r\n            }\r\n            else if (previousFrameBottom) {\r\n                // Accept some hick-ups near the viewport edges to save on repaints\r\n                startStyle.bottom = previousFrameBottom.startStyle.bottom;\r\n                endStyle.bottom = previousFrameBottom.endStyle.bottom;\r\n            }\r\n            curLineRange.startStyle = startStyle;\r\n            curLineRange.endStyle = endStyle;\r\n        }\r\n    };\r\n    SelectionsOverlay.prototype._getVisibleRangesWithStyle = function (selection, ctx, previousFrame) {\r\n        var _linesVisibleRanges = ctx.linesVisibleRangesForRange(selection, true) || [];\r\n        var linesVisibleRanges = _linesVisibleRanges.map(toStyled);\r\n        var visibleRangesHaveGaps = this._visibleRangesHaveGaps(linesVisibleRanges);\r\n        if (!isIEWithZoomingIssuesNearRoundedBorders && !visibleRangesHaveGaps && this._roundedSelection) {\r\n            this._enrichVisibleRangesWithStyle(ctx.visibleRange, linesVisibleRanges, previousFrame);\r\n        }\r\n        // The visible ranges are sorted TOP-BOTTOM and LEFT-RIGHT\r\n        return linesVisibleRanges;\r\n    };\r\n    SelectionsOverlay.prototype._createSelectionPiece = function (top, height, className, left, width) {\r\n        return ('<div class=\"cslr '\r\n            + className\r\n            + '\" style=\"top:'\r\n            + top.toString()\r\n            + 'px;left:'\r\n            + left.toString()\r\n            + 'px;width:'\r\n            + width.toString()\r\n            + 'px;height:'\r\n            + height\r\n            + 'px;\"></div>');\r\n    };\r\n    SelectionsOverlay.prototype._actualRenderOneSelection = function (output2, visibleStartLineNumber, hasMultipleSelections, visibleRanges) {\r\n        if (visibleRanges.length === 0) {\r\n            return;\r\n        }\r\n        var visibleRangesHaveStyle = !!visibleRanges[0].ranges[0].startStyle;\r\n        var fullLineHeight = (this._lineHeight).toString();\r\n        var reducedLineHeight = (this._lineHeight - 1).toString();\r\n        var firstLineNumber = visibleRanges[0].lineNumber;\r\n        var lastLineNumber = visibleRanges[visibleRanges.length - 1].lineNumber;\r\n        for (var i = 0, len = visibleRanges.length; i < len; i++) {\r\n            var lineVisibleRanges = visibleRanges[i];\r\n            var lineNumber = lineVisibleRanges.lineNumber;\r\n            var lineIndex = lineNumber - visibleStartLineNumber;\r\n            var lineHeight = hasMultipleSelections ? (lineNumber === lastLineNumber || lineNumber === firstLineNumber ? reducedLineHeight : fullLineHeight) : fullLineHeight;\r\n            var top_1 = hasMultipleSelections ? (lineNumber === firstLineNumber ? 1 : 0) : 0;\r\n            var innerCornerOutput = '';\r\n            var restOfSelectionOutput = '';\r\n            for (var j = 0, lenJ = lineVisibleRanges.ranges.length; j < lenJ; j++) {\r\n                var visibleRange = lineVisibleRanges.ranges[j];\r\n                if (visibleRangesHaveStyle) {\r\n                    var startStyle = visibleRange.startStyle;\r\n                    var endStyle = visibleRange.endStyle;\r\n                    if (startStyle.top === 1 /* INTERN */ || startStyle.bottom === 1 /* INTERN */) {\r\n                        // Reverse rounded corner to the left\r\n                        // First comes the selection (blue layer)\r\n                        innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, SelectionsOverlay.SELECTION_CLASS_NAME, visibleRange.left - SelectionsOverlay.ROUNDED_PIECE_WIDTH, SelectionsOverlay.ROUNDED_PIECE_WIDTH);\r\n                        // Second comes the background (white layer) with inverse border radius\r\n                        var className_1 = SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME;\r\n                        if (startStyle.top === 1 /* INTERN */) {\r\n                            className_1 += ' ' + SelectionsOverlay.SELECTION_TOP_RIGHT;\r\n                        }\r\n                        if (startStyle.bottom === 1 /* INTERN */) {\r\n                            className_1 += ' ' + SelectionsOverlay.SELECTION_BOTTOM_RIGHT;\r\n                        }\r\n                        innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, className_1, visibleRange.left - SelectionsOverlay.ROUNDED_PIECE_WIDTH, SelectionsOverlay.ROUNDED_PIECE_WIDTH);\r\n                    }\r\n                    if (endStyle.top === 1 /* INTERN */ || endStyle.bottom === 1 /* INTERN */) {\r\n                        // Reverse rounded corner to the right\r\n                        // First comes the selection (blue layer)\r\n                        innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, SelectionsOverlay.SELECTION_CLASS_NAME, visibleRange.left + visibleRange.width, SelectionsOverlay.ROUNDED_PIECE_WIDTH);\r\n                        // Second comes the background (white layer) with inverse border radius\r\n                        var className_2 = SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME;\r\n                        if (endStyle.top === 1 /* INTERN */) {\r\n                            className_2 += ' ' + SelectionsOverlay.SELECTION_TOP_LEFT;\r\n                        }\r\n                        if (endStyle.bottom === 1 /* INTERN */) {\r\n                            className_2 += ' ' + SelectionsOverlay.SELECTION_BOTTOM_LEFT;\r\n                        }\r\n                        innerCornerOutput += this._createSelectionPiece(top_1, lineHeight, className_2, visibleRange.left + visibleRange.width, SelectionsOverlay.ROUNDED_PIECE_WIDTH);\r\n                    }\r\n                }\r\n                var className = SelectionsOverlay.SELECTION_CLASS_NAME;\r\n                if (visibleRangesHaveStyle) {\r\n                    var startStyle = visibleRange.startStyle;\r\n                    var endStyle = visibleRange.endStyle;\r\n                    if (startStyle.top === 0 /* EXTERN */) {\r\n                        className += ' ' + SelectionsOverlay.SELECTION_TOP_LEFT;\r\n                    }\r\n                    if (startStyle.bottom === 0 /* EXTERN */) {\r\n                        className += ' ' + SelectionsOverlay.SELECTION_BOTTOM_LEFT;\r\n                    }\r\n                    if (endStyle.top === 0 /* EXTERN */) {\r\n                        className += ' ' + SelectionsOverlay.SELECTION_TOP_RIGHT;\r\n                    }\r\n                    if (endStyle.bottom === 0 /* EXTERN */) {\r\n                        className += ' ' + SelectionsOverlay.SELECTION_BOTTOM_RIGHT;\r\n                    }\r\n                }\r\n                restOfSelectionOutput += this._createSelectionPiece(top_1, lineHeight, className, visibleRange.left, visibleRange.width);\r\n            }\r\n            output2[lineIndex][0] += innerCornerOutput;\r\n            output2[lineIndex][1] += restOfSelectionOutput;\r\n        }\r\n    };\r\n    SelectionsOverlay.prototype.prepareRender = function (ctx) {\r\n        // Build HTML for inner corners separate from HTML for the rest of selections,\r\n        // as the inner corner HTML can interfere with that of other selections.\r\n        // In final render, make sure to place the inner corner HTML before the rest of selection HTML. See issue #77777.\r\n        var output = [];\r\n        var visibleStartLineNumber = ctx.visibleRange.startLineNumber;\r\n        var visibleEndLineNumber = ctx.visibleRange.endLineNumber;\r\n        for (var lineNumber = visibleStartLineNumber; lineNumber <= visibleEndLineNumber; lineNumber++) {\r\n            var lineIndex = lineNumber - visibleStartLineNumber;\r\n            output[lineIndex] = ['', ''];\r\n        }\r\n        var thisFrameVisibleRangesWithStyle = [];\r\n        for (var i = 0, len = this._selections.length; i < len; i++) {\r\n            var selection = this._selections[i];\r\n            if (selection.isEmpty()) {\r\n                thisFrameVisibleRangesWithStyle[i] = null;\r\n                continue;\r\n            }\r\n            var visibleRangesWithStyle = this._getVisibleRangesWithStyle(selection, ctx, this._previousFrameVisibleRangesWithStyle[i]);\r\n            thisFrameVisibleRangesWithStyle[i] = visibleRangesWithStyle;\r\n            this._actualRenderOneSelection(output, visibleStartLineNumber, this._selections.length > 1, visibleRangesWithStyle);\r\n        }\r\n        this._previousFrameVisibleRangesWithStyle = thisFrameVisibleRangesWithStyle;\r\n        this._renderResult = output.map(function (_a) {\r\n            var internalCorners = _a[0], restOfSelection = _a[1];\r\n            return internalCorners + restOfSelection;\r\n        });\r\n    };\r\n    SelectionsOverlay.prototype.render = function (startLineNumber, lineNumber) {\r\n        if (!this._renderResult) {\r\n            return '';\r\n        }\r\n        var lineIndex = lineNumber - startLineNumber;\r\n        if (lineIndex < 0 || lineIndex >= this._renderResult.length) {\r\n            return '';\r\n        }\r\n        return this._renderResult[lineIndex];\r\n    };\r\n    SelectionsOverlay.SELECTION_CLASS_NAME = 'selected-text';\r\n    SelectionsOverlay.SELECTION_TOP_LEFT = 'top-left-radius';\r\n    SelectionsOverlay.SELECTION_BOTTOM_LEFT = 'bottom-left-radius';\r\n    SelectionsOverlay.SELECTION_TOP_RIGHT = 'top-right-radius';\r\n    SelectionsOverlay.SELECTION_BOTTOM_RIGHT = 'bottom-right-radius';\r\n    SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME = 'monaco-editor-background';\r\n    SelectionsOverlay.ROUNDED_PIECE_WIDTH = 10;\r\n    return SelectionsOverlay;\r\n}(DynamicViewOverlay));\r\nexport { SelectionsOverlay };\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var editorSelectionColor = theme.getColor(editorSelectionBackground);\r\n    if (editorSelectionColor) {\r\n        collector.addRule(\".monaco-editor .focused .selected-text { background-color: \" + editorSelectionColor + \"; }\");\r\n    }\r\n    var editorInactiveSelectionColor = theme.getColor(editorInactiveSelection);\r\n    if (editorInactiveSelectionColor) {\r\n        collector.addRule(\".monaco-editor .selected-text { background-color: \" + editorInactiveSelectionColor + \"; }\");\r\n    }\r\n    var editorSelectionForegroundColor = theme.getColor(editorSelectionForeground);\r\n    if (editorSelectionForegroundColor) {\r\n        collector.addRule(\".monaco-editor .view-line span.inline-selected-text { color: \" + editorSelectionForegroundColor + \"; }\");\r\n    }\r\n});\r\nfunction abs(n) {\r\n    return n < 0 ? -n : n;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}