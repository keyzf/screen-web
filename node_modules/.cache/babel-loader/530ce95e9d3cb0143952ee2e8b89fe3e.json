{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar TreeNode =\n/** @class */\nfunction () {\n  function TreeNode(piece, color) {\n    this.piece = piece;\n    this.color = color;\n    this.size_left = 0;\n    this.lf_left = 0;\n    this.parent = this;\n    this.left = this;\n    this.right = this;\n  }\n\n  TreeNode.prototype.next = function () {\n    if (this.right !== SENTINEL) {\n      return leftest(this.right);\n    }\n\n    var node = this;\n\n    while (node.parent !== SENTINEL) {\n      if (node.parent.left === node) {\n        break;\n      }\n\n      node = node.parent;\n    }\n\n    if (node.parent === SENTINEL) {\n      return SENTINEL;\n    } else {\n      return node.parent;\n    }\n  };\n\n  TreeNode.prototype.prev = function () {\n    if (this.left !== SENTINEL) {\n      return righttest(this.left);\n    }\n\n    var node = this;\n\n    while (node.parent !== SENTINEL) {\n      if (node.parent.right === node) {\n        break;\n      }\n\n      node = node.parent;\n    }\n\n    if (node.parent === SENTINEL) {\n      return SENTINEL;\n    } else {\n      return node.parent;\n    }\n  };\n\n  TreeNode.prototype.detach = function () {\n    this.parent = null;\n    this.left = null;\n    this.right = null;\n  };\n\n  return TreeNode;\n}();\n\nexport { TreeNode };\nexport var SENTINEL = new TreeNode(null, 0\n/* Black */\n);\nSENTINEL.parent = SENTINEL;\nSENTINEL.left = SENTINEL;\nSENTINEL.right = SENTINEL;\nSENTINEL.color = 0\n/* Black */\n;\nexport function leftest(node) {\n  while (node.left !== SENTINEL) {\n    node = node.left;\n  }\n\n  return node;\n}\nexport function righttest(node) {\n  while (node.right !== SENTINEL) {\n    node = node.right;\n  }\n\n  return node;\n}\nexport function calculateSize(node) {\n  if (node === SENTINEL) {\n    return 0;\n  }\n\n  return node.size_left + node.piece.length + calculateSize(node.right);\n}\nexport function calculateLF(node) {\n  if (node === SENTINEL) {\n    return 0;\n  }\n\n  return node.lf_left + node.piece.lineFeedCnt + calculateLF(node.right);\n}\nexport function resetSentinel() {\n  SENTINEL.parent = SENTINEL;\n}\nexport function leftRotate(tree, x) {\n  var y = x.right; // fix size_left\n\n  y.size_left += x.size_left + (x.piece ? x.piece.length : 0);\n  y.lf_left += x.lf_left + (x.piece ? x.piece.lineFeedCnt : 0);\n  x.right = y.left;\n\n  if (y.left !== SENTINEL) {\n    y.left.parent = x;\n  }\n\n  y.parent = x.parent;\n\n  if (x.parent === SENTINEL) {\n    tree.root = y;\n  } else if (x.parent.left === x) {\n    x.parent.left = y;\n  } else {\n    x.parent.right = y;\n  }\n\n  y.left = x;\n  x.parent = y;\n}\nexport function rightRotate(tree, y) {\n  var x = y.left;\n  y.left = x.right;\n\n  if (x.right !== SENTINEL) {\n    x.right.parent = y;\n  }\n\n  x.parent = y.parent; // fix size_left\n\n  y.size_left -= x.size_left + (x.piece ? x.piece.length : 0);\n  y.lf_left -= x.lf_left + (x.piece ? x.piece.lineFeedCnt : 0);\n\n  if (y.parent === SENTINEL) {\n    tree.root = x;\n  } else if (y === y.parent.right) {\n    y.parent.right = x;\n  } else {\n    y.parent.left = x;\n  }\n\n  x.right = y;\n  y.parent = x;\n}\nexport function rbDelete(tree, z) {\n  var x;\n  var y;\n\n  if (z.left === SENTINEL) {\n    y = z;\n    x = y.right;\n  } else if (z.right === SENTINEL) {\n    y = z;\n    x = y.left;\n  } else {\n    y = leftest(z.right);\n    x = y.right;\n  }\n\n  if (y === tree.root) {\n    tree.root = x; // if x is null, we are removing the only node\n\n    x.color = 0\n    /* Black */\n    ;\n    z.detach();\n    resetSentinel();\n    tree.root.parent = SENTINEL;\n    return;\n  }\n\n  var yWasRed = y.color === 1\n  /* Red */\n  ;\n\n  if (y === y.parent.left) {\n    y.parent.left = x;\n  } else {\n    y.parent.right = x;\n  }\n\n  if (y === z) {\n    x.parent = y.parent;\n    recomputeTreeMetadata(tree, x);\n  } else {\n    if (y.parent === z) {\n      x.parent = y;\n    } else {\n      x.parent = y.parent;\n    } // as we make changes to x's hierarchy, update size_left of subtree first\n\n\n    recomputeTreeMetadata(tree, x);\n    y.left = z.left;\n    y.right = z.right;\n    y.parent = z.parent;\n    y.color = z.color;\n\n    if (z === tree.root) {\n      tree.root = y;\n    } else {\n      if (z === z.parent.left) {\n        z.parent.left = y;\n      } else {\n        z.parent.right = y;\n      }\n    }\n\n    if (y.left !== SENTINEL) {\n      y.left.parent = y;\n    }\n\n    if (y.right !== SENTINEL) {\n      y.right.parent = y;\n    } // update metadata\n    // we replace z with y, so in this sub tree, the length change is z.item.length\n\n\n    y.size_left = z.size_left;\n    y.lf_left = z.lf_left;\n    recomputeTreeMetadata(tree, y);\n  }\n\n  z.detach();\n\n  if (x.parent.left === x) {\n    var newSizeLeft = calculateSize(x);\n    var newLFLeft = calculateLF(x);\n\n    if (newSizeLeft !== x.parent.size_left || newLFLeft !== x.parent.lf_left) {\n      var delta = newSizeLeft - x.parent.size_left;\n      var lf_delta = newLFLeft - x.parent.lf_left;\n      x.parent.size_left = newSizeLeft;\n      x.parent.lf_left = newLFLeft;\n      updateTreeMetadata(tree, x.parent, delta, lf_delta);\n    }\n  }\n\n  recomputeTreeMetadata(tree, x.parent);\n\n  if (yWasRed) {\n    resetSentinel();\n    return;\n  } // RB-DELETE-FIXUP\n\n\n  var w;\n\n  while (x !== tree.root && x.color === 0\n  /* Black */\n  ) {\n    if (x === x.parent.left) {\n      w = x.parent.right;\n\n      if (w.color === 1\n      /* Red */\n      ) {\n          w.color = 0\n          /* Black */\n          ;\n          x.parent.color = 1\n          /* Red */\n          ;\n          leftRotate(tree, x.parent);\n          w = x.parent.right;\n        }\n\n      if (w.left.color === 0\n      /* Black */\n      && w.right.color === 0\n      /* Black */\n      ) {\n          w.color = 1\n          /* Red */\n          ;\n          x = x.parent;\n        } else {\n        if (w.right.color === 0\n        /* Black */\n        ) {\n            w.left.color = 0\n            /* Black */\n            ;\n            w.color = 1\n            /* Red */\n            ;\n            rightRotate(tree, w);\n            w = x.parent.right;\n          }\n\n        w.color = x.parent.color;\n        x.parent.color = 0\n        /* Black */\n        ;\n        w.right.color = 0\n        /* Black */\n        ;\n        leftRotate(tree, x.parent);\n        x = tree.root;\n      }\n    } else {\n      w = x.parent.left;\n\n      if (w.color === 1\n      /* Red */\n      ) {\n          w.color = 0\n          /* Black */\n          ;\n          x.parent.color = 1\n          /* Red */\n          ;\n          rightRotate(tree, x.parent);\n          w = x.parent.left;\n        }\n\n      if (w.left.color === 0\n      /* Black */\n      && w.right.color === 0\n      /* Black */\n      ) {\n          w.color = 1\n          /* Red */\n          ;\n          x = x.parent;\n        } else {\n        if (w.left.color === 0\n        /* Black */\n        ) {\n            w.right.color = 0\n            /* Black */\n            ;\n            w.color = 1\n            /* Red */\n            ;\n            leftRotate(tree, w);\n            w = x.parent.left;\n          }\n\n        w.color = x.parent.color;\n        x.parent.color = 0\n        /* Black */\n        ;\n        w.left.color = 0\n        /* Black */\n        ;\n        rightRotate(tree, x.parent);\n        x = tree.root;\n      }\n    }\n  }\n\n  x.color = 0\n  /* Black */\n  ;\n  resetSentinel();\n}\nexport function fixInsert(tree, x) {\n  recomputeTreeMetadata(tree, x);\n\n  while (x !== tree.root && x.parent.color === 1\n  /* Red */\n  ) {\n    if (x.parent === x.parent.parent.left) {\n      var y = x.parent.parent.right;\n\n      if (y.color === 1\n      /* Red */\n      ) {\n          x.parent.color = 0\n          /* Black */\n          ;\n          y.color = 0\n          /* Black */\n          ;\n          x.parent.parent.color = 1\n          /* Red */\n          ;\n          x = x.parent.parent;\n        } else {\n        if (x === x.parent.right) {\n          x = x.parent;\n          leftRotate(tree, x);\n        }\n\n        x.parent.color = 0\n        /* Black */\n        ;\n        x.parent.parent.color = 1\n        /* Red */\n        ;\n        rightRotate(tree, x.parent.parent);\n      }\n    } else {\n      var y = x.parent.parent.left;\n\n      if (y.color === 1\n      /* Red */\n      ) {\n          x.parent.color = 0\n          /* Black */\n          ;\n          y.color = 0\n          /* Black */\n          ;\n          x.parent.parent.color = 1\n          /* Red */\n          ;\n          x = x.parent.parent;\n        } else {\n        if (x === x.parent.left) {\n          x = x.parent;\n          rightRotate(tree, x);\n        }\n\n        x.parent.color = 0\n        /* Black */\n        ;\n        x.parent.parent.color = 1\n        /* Red */\n        ;\n        leftRotate(tree, x.parent.parent);\n      }\n    }\n  }\n\n  tree.root.color = 0\n  /* Black */\n  ;\n}\nexport function updateTreeMetadata(tree, x, delta, lineFeedCntDelta) {\n  // node length change or line feed count change\n  while (x !== tree.root && x !== SENTINEL) {\n    if (x.parent.left === x) {\n      x.parent.size_left += delta;\n      x.parent.lf_left += lineFeedCntDelta;\n    }\n\n    x = x.parent;\n  }\n}\nexport function recomputeTreeMetadata(tree, x) {\n  var delta = 0;\n  var lf_delta = 0;\n\n  if (x === tree.root) {\n    return;\n  }\n\n  if (delta === 0) {\n    // go upwards till the node whose left subtree is changed.\n    while (x !== tree.root && x === x.parent.right) {\n      x = x.parent;\n    }\n\n    if (x === tree.root) {\n      // well, it means we add a node to the end (inorder)\n      return;\n    } // x is the node whose right subtree is changed.\n\n\n    x = x.parent;\n    delta = calculateSize(x.left) - x.size_left;\n    lf_delta = calculateLF(x.left) - x.lf_left;\n    x.size_left += delta;\n    x.lf_left += lf_delta;\n  } // go upwards till root. O(logN)\n\n\n  while (x !== tree.root && (delta !== 0 || lf_delta !== 0)) {\n    if (x.parent.left === x) {\n      x.parent.size_left += delta;\n      x.parent.lf_left += lf_delta;\n    }\n\n    x = x.parent;\n  }\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/common/model/pieceTreeTextBuffer/rbTreeBase.js"],"names":["TreeNode","piece","color","size_left","lf_left","parent","left","right","prototype","next","SENTINEL","leftest","node","prev","righttest","detach","calculateSize","length","calculateLF","lineFeedCnt","resetSentinel","leftRotate","tree","x","y","root","rightRotate","rbDelete","z","yWasRed","recomputeTreeMetadata","newSizeLeft","newLFLeft","delta","lf_delta","updateTreeMetadata","w","fixInsert","lineFeedCntDelta"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar TreeNode = /** @class */ (function () {\r\n    function TreeNode(piece, color) {\r\n        this.piece = piece;\r\n        this.color = color;\r\n        this.size_left = 0;\r\n        this.lf_left = 0;\r\n        this.parent = this;\r\n        this.left = this;\r\n        this.right = this;\r\n    }\r\n    TreeNode.prototype.next = function () {\r\n        if (this.right !== SENTINEL) {\r\n            return leftest(this.right);\r\n        }\r\n        var node = this;\r\n        while (node.parent !== SENTINEL) {\r\n            if (node.parent.left === node) {\r\n                break;\r\n            }\r\n            node = node.parent;\r\n        }\r\n        if (node.parent === SENTINEL) {\r\n            return SENTINEL;\r\n        }\r\n        else {\r\n            return node.parent;\r\n        }\r\n    };\r\n    TreeNode.prototype.prev = function () {\r\n        if (this.left !== SENTINEL) {\r\n            return righttest(this.left);\r\n        }\r\n        var node = this;\r\n        while (node.parent !== SENTINEL) {\r\n            if (node.parent.right === node) {\r\n                break;\r\n            }\r\n            node = node.parent;\r\n        }\r\n        if (node.parent === SENTINEL) {\r\n            return SENTINEL;\r\n        }\r\n        else {\r\n            return node.parent;\r\n        }\r\n    };\r\n    TreeNode.prototype.detach = function () {\r\n        this.parent = null;\r\n        this.left = null;\r\n        this.right = null;\r\n    };\r\n    return TreeNode;\r\n}());\r\nexport { TreeNode };\r\nexport var SENTINEL = new TreeNode(null, 0 /* Black */);\r\nSENTINEL.parent = SENTINEL;\r\nSENTINEL.left = SENTINEL;\r\nSENTINEL.right = SENTINEL;\r\nSENTINEL.color = 0 /* Black */;\r\nexport function leftest(node) {\r\n    while (node.left !== SENTINEL) {\r\n        node = node.left;\r\n    }\r\n    return node;\r\n}\r\nexport function righttest(node) {\r\n    while (node.right !== SENTINEL) {\r\n        node = node.right;\r\n    }\r\n    return node;\r\n}\r\nexport function calculateSize(node) {\r\n    if (node === SENTINEL) {\r\n        return 0;\r\n    }\r\n    return node.size_left + node.piece.length + calculateSize(node.right);\r\n}\r\nexport function calculateLF(node) {\r\n    if (node === SENTINEL) {\r\n        return 0;\r\n    }\r\n    return node.lf_left + node.piece.lineFeedCnt + calculateLF(node.right);\r\n}\r\nexport function resetSentinel() {\r\n    SENTINEL.parent = SENTINEL;\r\n}\r\nexport function leftRotate(tree, x) {\r\n    var y = x.right;\r\n    // fix size_left\r\n    y.size_left += x.size_left + (x.piece ? x.piece.length : 0);\r\n    y.lf_left += x.lf_left + (x.piece ? x.piece.lineFeedCnt : 0);\r\n    x.right = y.left;\r\n    if (y.left !== SENTINEL) {\r\n        y.left.parent = x;\r\n    }\r\n    y.parent = x.parent;\r\n    if (x.parent === SENTINEL) {\r\n        tree.root = y;\r\n    }\r\n    else if (x.parent.left === x) {\r\n        x.parent.left = y;\r\n    }\r\n    else {\r\n        x.parent.right = y;\r\n    }\r\n    y.left = x;\r\n    x.parent = y;\r\n}\r\nexport function rightRotate(tree, y) {\r\n    var x = y.left;\r\n    y.left = x.right;\r\n    if (x.right !== SENTINEL) {\r\n        x.right.parent = y;\r\n    }\r\n    x.parent = y.parent;\r\n    // fix size_left\r\n    y.size_left -= x.size_left + (x.piece ? x.piece.length : 0);\r\n    y.lf_left -= x.lf_left + (x.piece ? x.piece.lineFeedCnt : 0);\r\n    if (y.parent === SENTINEL) {\r\n        tree.root = x;\r\n    }\r\n    else if (y === y.parent.right) {\r\n        y.parent.right = x;\r\n    }\r\n    else {\r\n        y.parent.left = x;\r\n    }\r\n    x.right = y;\r\n    y.parent = x;\r\n}\r\nexport function rbDelete(tree, z) {\r\n    var x;\r\n    var y;\r\n    if (z.left === SENTINEL) {\r\n        y = z;\r\n        x = y.right;\r\n    }\r\n    else if (z.right === SENTINEL) {\r\n        y = z;\r\n        x = y.left;\r\n    }\r\n    else {\r\n        y = leftest(z.right);\r\n        x = y.right;\r\n    }\r\n    if (y === tree.root) {\r\n        tree.root = x;\r\n        // if x is null, we are removing the only node\r\n        x.color = 0 /* Black */;\r\n        z.detach();\r\n        resetSentinel();\r\n        tree.root.parent = SENTINEL;\r\n        return;\r\n    }\r\n    var yWasRed = (y.color === 1 /* Red */);\r\n    if (y === y.parent.left) {\r\n        y.parent.left = x;\r\n    }\r\n    else {\r\n        y.parent.right = x;\r\n    }\r\n    if (y === z) {\r\n        x.parent = y.parent;\r\n        recomputeTreeMetadata(tree, x);\r\n    }\r\n    else {\r\n        if (y.parent === z) {\r\n            x.parent = y;\r\n        }\r\n        else {\r\n            x.parent = y.parent;\r\n        }\r\n        // as we make changes to x's hierarchy, update size_left of subtree first\r\n        recomputeTreeMetadata(tree, x);\r\n        y.left = z.left;\r\n        y.right = z.right;\r\n        y.parent = z.parent;\r\n        y.color = z.color;\r\n        if (z === tree.root) {\r\n            tree.root = y;\r\n        }\r\n        else {\r\n            if (z === z.parent.left) {\r\n                z.parent.left = y;\r\n            }\r\n            else {\r\n                z.parent.right = y;\r\n            }\r\n        }\r\n        if (y.left !== SENTINEL) {\r\n            y.left.parent = y;\r\n        }\r\n        if (y.right !== SENTINEL) {\r\n            y.right.parent = y;\r\n        }\r\n        // update metadata\r\n        // we replace z with y, so in this sub tree, the length change is z.item.length\r\n        y.size_left = z.size_left;\r\n        y.lf_left = z.lf_left;\r\n        recomputeTreeMetadata(tree, y);\r\n    }\r\n    z.detach();\r\n    if (x.parent.left === x) {\r\n        var newSizeLeft = calculateSize(x);\r\n        var newLFLeft = calculateLF(x);\r\n        if (newSizeLeft !== x.parent.size_left || newLFLeft !== x.parent.lf_left) {\r\n            var delta = newSizeLeft - x.parent.size_left;\r\n            var lf_delta = newLFLeft - x.parent.lf_left;\r\n            x.parent.size_left = newSizeLeft;\r\n            x.parent.lf_left = newLFLeft;\r\n            updateTreeMetadata(tree, x.parent, delta, lf_delta);\r\n        }\r\n    }\r\n    recomputeTreeMetadata(tree, x.parent);\r\n    if (yWasRed) {\r\n        resetSentinel();\r\n        return;\r\n    }\r\n    // RB-DELETE-FIXUP\r\n    var w;\r\n    while (x !== tree.root && x.color === 0 /* Black */) {\r\n        if (x === x.parent.left) {\r\n            w = x.parent.right;\r\n            if (w.color === 1 /* Red */) {\r\n                w.color = 0 /* Black */;\r\n                x.parent.color = 1 /* Red */;\r\n                leftRotate(tree, x.parent);\r\n                w = x.parent.right;\r\n            }\r\n            if (w.left.color === 0 /* Black */ && w.right.color === 0 /* Black */) {\r\n                w.color = 1 /* Red */;\r\n                x = x.parent;\r\n            }\r\n            else {\r\n                if (w.right.color === 0 /* Black */) {\r\n                    w.left.color = 0 /* Black */;\r\n                    w.color = 1 /* Red */;\r\n                    rightRotate(tree, w);\r\n                    w = x.parent.right;\r\n                }\r\n                w.color = x.parent.color;\r\n                x.parent.color = 0 /* Black */;\r\n                w.right.color = 0 /* Black */;\r\n                leftRotate(tree, x.parent);\r\n                x = tree.root;\r\n            }\r\n        }\r\n        else {\r\n            w = x.parent.left;\r\n            if (w.color === 1 /* Red */) {\r\n                w.color = 0 /* Black */;\r\n                x.parent.color = 1 /* Red */;\r\n                rightRotate(tree, x.parent);\r\n                w = x.parent.left;\r\n            }\r\n            if (w.left.color === 0 /* Black */ && w.right.color === 0 /* Black */) {\r\n                w.color = 1 /* Red */;\r\n                x = x.parent;\r\n            }\r\n            else {\r\n                if (w.left.color === 0 /* Black */) {\r\n                    w.right.color = 0 /* Black */;\r\n                    w.color = 1 /* Red */;\r\n                    leftRotate(tree, w);\r\n                    w = x.parent.left;\r\n                }\r\n                w.color = x.parent.color;\r\n                x.parent.color = 0 /* Black */;\r\n                w.left.color = 0 /* Black */;\r\n                rightRotate(tree, x.parent);\r\n                x = tree.root;\r\n            }\r\n        }\r\n    }\r\n    x.color = 0 /* Black */;\r\n    resetSentinel();\r\n}\r\nexport function fixInsert(tree, x) {\r\n    recomputeTreeMetadata(tree, x);\r\n    while (x !== tree.root && x.parent.color === 1 /* Red */) {\r\n        if (x.parent === x.parent.parent.left) {\r\n            var y = x.parent.parent.right;\r\n            if (y.color === 1 /* Red */) {\r\n                x.parent.color = 0 /* Black */;\r\n                y.color = 0 /* Black */;\r\n                x.parent.parent.color = 1 /* Red */;\r\n                x = x.parent.parent;\r\n            }\r\n            else {\r\n                if (x === x.parent.right) {\r\n                    x = x.parent;\r\n                    leftRotate(tree, x);\r\n                }\r\n                x.parent.color = 0 /* Black */;\r\n                x.parent.parent.color = 1 /* Red */;\r\n                rightRotate(tree, x.parent.parent);\r\n            }\r\n        }\r\n        else {\r\n            var y = x.parent.parent.left;\r\n            if (y.color === 1 /* Red */) {\r\n                x.parent.color = 0 /* Black */;\r\n                y.color = 0 /* Black */;\r\n                x.parent.parent.color = 1 /* Red */;\r\n                x = x.parent.parent;\r\n            }\r\n            else {\r\n                if (x === x.parent.left) {\r\n                    x = x.parent;\r\n                    rightRotate(tree, x);\r\n                }\r\n                x.parent.color = 0 /* Black */;\r\n                x.parent.parent.color = 1 /* Red */;\r\n                leftRotate(tree, x.parent.parent);\r\n            }\r\n        }\r\n    }\r\n    tree.root.color = 0 /* Black */;\r\n}\r\nexport function updateTreeMetadata(tree, x, delta, lineFeedCntDelta) {\r\n    // node length change or line feed count change\r\n    while (x !== tree.root && x !== SENTINEL) {\r\n        if (x.parent.left === x) {\r\n            x.parent.size_left += delta;\r\n            x.parent.lf_left += lineFeedCntDelta;\r\n        }\r\n        x = x.parent;\r\n    }\r\n}\r\nexport function recomputeTreeMetadata(tree, x) {\r\n    var delta = 0;\r\n    var lf_delta = 0;\r\n    if (x === tree.root) {\r\n        return;\r\n    }\r\n    if (delta === 0) {\r\n        // go upwards till the node whose left subtree is changed.\r\n        while (x !== tree.root && x === x.parent.right) {\r\n            x = x.parent;\r\n        }\r\n        if (x === tree.root) {\r\n            // well, it means we add a node to the end (inorder)\r\n            return;\r\n        }\r\n        // x is the node whose right subtree is changed.\r\n        x = x.parent;\r\n        delta = calculateSize(x.left) - x.size_left;\r\n        lf_delta = calculateLF(x.left) - x.lf_left;\r\n        x.size_left += delta;\r\n        x.lf_left += lf_delta;\r\n    }\r\n    // go upwards till root. O(logN)\r\n    while (x !== tree.root && (delta !== 0 || lf_delta !== 0)) {\r\n        if (x.parent.left === x) {\r\n            x.parent.size_left += delta;\r\n            x.parent.lf_left += lf_delta;\r\n        }\r\n        x = x.parent;\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}