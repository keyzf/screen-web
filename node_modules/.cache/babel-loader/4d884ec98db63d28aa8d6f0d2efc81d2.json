{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport { ComposedTreeDelegate } from './abstractTree.js';\nimport { ObjectTree, CompressibleObjectTree } from './objectTree.js';\nimport { TreeError, WeakMapper } from './tree.js';\nimport { dispose, DisposableStore } from '../../../common/lifecycle.js';\nimport { Emitter, Event } from '../../../common/event.js';\nimport { timeout, createCancelablePromise } from '../../../common/async.js';\nimport { Iterator } from '../../../common/iterator.js';\nimport { ElementsDragAndDropData } from '../list/listView.js';\nimport { isPromiseCanceledError, onUnexpectedError } from '../../../common/errors.js';\nimport { toggleClass } from '../../dom.js';\nimport { values } from '../../../common/map.js';\nimport { isFilterResult, getVisibleState } from './indexTreeModel.js';\n\nfunction createAsyncDataTreeNode(props) {\n  return __assign(__assign({}, props), {\n    children: [],\n    refreshPromise: undefined,\n    stale: true,\n    slow: false,\n    collapsedByDefault: undefined\n  });\n}\n\nfunction isAncestor(ancestor, descendant) {\n  if (!descendant.parent) {\n    return false;\n  } else if (descendant.parent === ancestor) {\n    return true;\n  } else {\n    return isAncestor(ancestor, descendant.parent);\n  }\n}\n\nfunction intersects(node, other) {\n  return node === other || isAncestor(node, other) || isAncestor(other, node);\n}\n\nvar AsyncDataTreeNodeWrapper =\n/** @class */\nfunction () {\n  function AsyncDataTreeNodeWrapper(node) {\n    this.node = node;\n  }\n\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"element\", {\n    get: function () {\n      return this.node.element.element;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"children\", {\n    get: function () {\n      return this.node.children.map(function (node) {\n        return new AsyncDataTreeNodeWrapper(node);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"depth\", {\n    get: function () {\n      return this.node.depth;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\n    get: function () {\n      return this.node.visibleChildrenCount;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visibleChildIndex\", {\n    get: function () {\n      return this.node.visibleChildIndex;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"collapsible\", {\n    get: function () {\n      return this.node.collapsible;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"collapsed\", {\n    get: function () {\n      return this.node.collapsed;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visible\", {\n    get: function () {\n      return this.node.visible;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"filterData\", {\n    get: function () {\n      return this.node.filterData;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return AsyncDataTreeNodeWrapper;\n}();\n\nvar AsyncDataTreeRenderer =\n/** @class */\nfunction () {\n  function AsyncDataTreeRenderer(renderer, nodeMapper, onDidChangeTwistieState) {\n    this.renderer = renderer;\n    this.nodeMapper = nodeMapper;\n    this.onDidChangeTwistieState = onDidChangeTwistieState;\n    this.renderedNodes = new Map();\n    this.templateId = renderer.templateId;\n  }\n\n  AsyncDataTreeRenderer.prototype.renderTemplate = function (container) {\n    var templateData = this.renderer.renderTemplate(container);\n    return {\n      templateData: templateData\n    };\n  };\n\n  AsyncDataTreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\n    this.renderer.renderElement(this.nodeMapper.map(node), index, templateData.templateData, height);\n  };\n\n  AsyncDataTreeRenderer.prototype.renderTwistie = function (element, twistieElement) {\n    toggleClass(twistieElement, 'codicon-loading', element.slow);\n    return false;\n  };\n\n  AsyncDataTreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\n    if (this.renderer.disposeElement) {\n      this.renderer.disposeElement(this.nodeMapper.map(node), index, templateData.templateData, height);\n    }\n  };\n\n  AsyncDataTreeRenderer.prototype.disposeTemplate = function (templateData) {\n    this.renderer.disposeTemplate(templateData.templateData);\n  };\n\n  AsyncDataTreeRenderer.prototype.dispose = function () {\n    this.renderedNodes.clear();\n  };\n\n  return AsyncDataTreeRenderer;\n}();\n\nfunction asTreeEvent(e) {\n  return {\n    browserEvent: e.browserEvent,\n    elements: e.elements.map(function (e) {\n      return e.element;\n    })\n  };\n}\n\nvar AsyncDataTreeElementsDragAndDropData =\n/** @class */\nfunction (_super) {\n  __extends(AsyncDataTreeElementsDragAndDropData, _super);\n\n  function AsyncDataTreeElementsDragAndDropData(data) {\n    var _this = _super.call(this, data.elements.map(function (node) {\n      return node.element;\n    })) || this;\n\n    _this.data = data;\n    return _this;\n  }\n\n  return AsyncDataTreeElementsDragAndDropData;\n}(ElementsDragAndDropData);\n\nfunction asAsyncDataTreeDragAndDropData(data) {\n  if (data instanceof ElementsDragAndDropData) {\n    return new AsyncDataTreeElementsDragAndDropData(data);\n  }\n\n  return data;\n}\n\nvar AsyncDataTreeNodeListDragAndDrop =\n/** @class */\nfunction () {\n  function AsyncDataTreeNodeListDragAndDrop(dnd) {\n    this.dnd = dnd;\n  }\n\n  AsyncDataTreeNodeListDragAndDrop.prototype.getDragURI = function (node) {\n    return this.dnd.getDragURI(node.element);\n  };\n\n  AsyncDataTreeNodeListDragAndDrop.prototype.getDragLabel = function (nodes, originalEvent) {\n    if (this.dnd.getDragLabel) {\n      return this.dnd.getDragLabel(nodes.map(function (node) {\n        return node.element;\n      }), originalEvent);\n    }\n\n    return undefined;\n  };\n\n  AsyncDataTreeNodeListDragAndDrop.prototype.onDragStart = function (data, originalEvent) {\n    if (this.dnd.onDragStart) {\n      this.dnd.onDragStart(asAsyncDataTreeDragAndDropData(data), originalEvent);\n    }\n  };\n\n  AsyncDataTreeNodeListDragAndDrop.prototype.onDragOver = function (data, targetNode, targetIndex, originalEvent, raw) {\n    if (raw === void 0) {\n      raw = true;\n    }\n\n    return this.dnd.onDragOver(asAsyncDataTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n  };\n\n  AsyncDataTreeNodeListDragAndDrop.prototype.drop = function (data, targetNode, targetIndex, originalEvent) {\n    this.dnd.drop(asAsyncDataTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n  };\n\n  AsyncDataTreeNodeListDragAndDrop.prototype.onDragEnd = function (originalEvent) {\n    if (this.dnd.onDragEnd) {\n      this.dnd.onDragEnd(originalEvent);\n    }\n  };\n\n  return AsyncDataTreeNodeListDragAndDrop;\n}();\n\nfunction asObjectTreeOptions(options) {\n  return options && __assign(__assign({}, options), {\n    collapseByDefault: true,\n    identityProvider: options.identityProvider && {\n      getId: function (el) {\n        return options.identityProvider.getId(el.element);\n      }\n    },\n    dnd: options.dnd && new AsyncDataTreeNodeListDragAndDrop(options.dnd),\n    multipleSelectionController: options.multipleSelectionController && {\n      isSelectionSingleChangeEvent: function (e) {\n        return options.multipleSelectionController.isSelectionSingleChangeEvent(__assign(__assign({}, e), {\n          element: e.element\n        }));\n      },\n      isSelectionRangeChangeEvent: function (e) {\n        return options.multipleSelectionController.isSelectionRangeChangeEvent(__assign(__assign({}, e), {\n          element: e.element\n        }));\n      }\n    },\n    accessibilityProvider: options.accessibilityProvider && __assign(__assign({}, options.accessibilityProvider), {\n      getAriaLabel: function (e) {\n        return options.accessibilityProvider.getAriaLabel(e.element);\n      },\n      getAriaLevel: options.accessibilityProvider.getAriaLevel && function (node) {\n        return options.accessibilityProvider.getAriaLevel(node.element);\n      },\n      getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && function (node) {\n        return options.accessibilityProvider.getActiveDescendantId(node.element);\n      }\n    }),\n    filter: options.filter && {\n      filter: function (e, parentVisibility) {\n        return options.filter.filter(e.element, parentVisibility);\n      }\n    },\n    keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && __assign(__assign({}, options.keyboardNavigationLabelProvider), {\n      getKeyboardNavigationLabel: function (e) {\n        return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e.element);\n      }\n    }),\n    sorter: undefined,\n    expandOnlyOnTwistieClick: typeof options.expandOnlyOnTwistieClick === 'undefined' ? undefined : typeof options.expandOnlyOnTwistieClick !== 'function' ? options.expandOnlyOnTwistieClick : function (e) {\n      return options.expandOnlyOnTwistieClick(e.element);\n    },\n    ariaProvider: options.ariaProvider && {\n      getPosInSet: function (el, index) {\n        return options.ariaProvider.getPosInSet(el.element, index);\n      },\n      getSetSize: function (el, index, listLength) {\n        return options.ariaProvider.getSetSize(el.element, index, listLength);\n      },\n      getRole: options.ariaProvider.getRole ? function (el) {\n        return options.ariaProvider.getRole(el.element);\n      } : undefined,\n      isChecked: options.ariaProvider.isChecked ? function (e) {\n        var _a;\n\n        return ((_a = options.ariaProvider) === null || _a === void 0 ? void 0 : _a.isChecked)(e.element);\n      } : undefined\n    },\n    additionalScrollHeight: options.additionalScrollHeight\n  });\n}\n\nfunction dfs(node, fn) {\n  fn(node);\n  node.children.forEach(function (child) {\n    return dfs(child, fn);\n  });\n}\n\nvar AsyncDataTree =\n/** @class */\nfunction () {\n  function AsyncDataTree(user, container, delegate, renderers, dataSource, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.user = user;\n    this.dataSource = dataSource;\n    this.nodes = new Map();\n    this.subTreeRefreshPromises = new Map();\n    this.refreshPromises = new Map();\n    this._onDidRender = new Emitter();\n    this._onDidChangeNodeSlowState = new Emitter();\n    this.nodeMapper = new WeakMapper(function (node) {\n      return new AsyncDataTreeNodeWrapper(node);\n    });\n    this.disposables = new DisposableStore();\n    this.identityProvider = options.identityProvider;\n    this.autoExpandSingleChildren = typeof options.autoExpandSingleChildren === 'undefined' ? false : options.autoExpandSingleChildren;\n    this.sorter = options.sorter;\n    this.collapseByDefault = options.collapseByDefault;\n    this.tree = this.createTree(user, container, delegate, renderers, options);\n    this.root = createAsyncDataTreeNode({\n      element: undefined,\n      parent: null,\n      hasChildren: true\n    });\n\n    if (this.identityProvider) {\n      this.root = __assign(__assign({}, this.root), {\n        id: null\n      });\n    }\n\n    this.nodes.set(null, this.root);\n    this.tree.onDidChangeCollapseState(this._onDidChangeCollapseState, this, this.disposables);\n  }\n\n  Object.defineProperty(AsyncDataTree.prototype, \"onDidChangeFocus\", {\n    get: function () {\n      return Event.map(this.tree.onDidChangeFocus, asTreeEvent);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTree.prototype, \"onDidChangeSelection\", {\n    get: function () {\n      return Event.map(this.tree.onDidChangeSelection, asTreeEvent);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTree.prototype, \"onDidOpen\", {\n    get: function () {\n      return Event.map(this.tree.onDidOpen, asTreeEvent);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTree.prototype, \"onDidFocus\", {\n    get: function () {\n      return this.tree.onDidFocus;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncDataTree.prototype, \"onDidDispose\", {\n    get: function () {\n      return this.tree.onDidDispose;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AsyncDataTree.prototype.createTree = function (user, container, delegate, renderers, options) {\n    var _this = this;\n\n    var objectTreeDelegate = new ComposedTreeDelegate(delegate);\n    var objectTreeRenderers = renderers.map(function (r) {\n      return new AsyncDataTreeRenderer(r, _this.nodeMapper, _this._onDidChangeNodeSlowState.event);\n    });\n    var objectTreeOptions = asObjectTreeOptions(options) || {};\n    return new ObjectTree(user, container, objectTreeDelegate, objectTreeRenderers, objectTreeOptions);\n  };\n\n  AsyncDataTree.prototype.updateOptions = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.tree.updateOptions(options);\n  }; // Widget\n\n\n  AsyncDataTree.prototype.getHTMLElement = function () {\n    return this.tree.getHTMLElement();\n  };\n\n  Object.defineProperty(AsyncDataTree.prototype, \"scrollTop\", {\n    get: function () {\n      return this.tree.scrollTop;\n    },\n    set: function (scrollTop) {\n      this.tree.scrollTop = scrollTop;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AsyncDataTree.prototype.domFocus = function () {\n    this.tree.domFocus();\n  };\n\n  AsyncDataTree.prototype.layout = function (height, width) {\n    this.tree.layout(height, width);\n  };\n\n  AsyncDataTree.prototype.style = function (styles) {\n    this.tree.style(styles);\n  }; // Model\n\n\n  AsyncDataTree.prototype.getInput = function () {\n    return this.root.element;\n  };\n\n  AsyncDataTree.prototype.setInput = function (input, viewState) {\n    return __awaiter(this, void 0, void 0, function () {\n      var viewStateContext;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.refreshPromises.forEach(function (promise) {\n              return promise.cancel();\n            });\n            this.refreshPromises.clear();\n            this.root.element = input;\n            viewStateContext = viewState && {\n              viewState: viewState,\n              focus: [],\n              selection: []\n            };\n            return [4\n            /*yield*/\n            , this._updateChildren(input, true, false, viewStateContext)];\n\n          case 1:\n            _a.sent();\n\n            if (viewStateContext) {\n              this.tree.setFocus(viewStateContext.focus);\n              this.tree.setSelection(viewStateContext.selection);\n            }\n\n            if (viewState && typeof viewState.scrollTop === 'number') {\n              this.scrollTop = viewState.scrollTop;\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AsyncDataTree.prototype._updateChildren = function (element, recursive, rerender, viewStateContext) {\n    if (element === void 0) {\n      element = this.root.element;\n    }\n\n    if (recursive === void 0) {\n      recursive = true;\n    }\n\n    if (rerender === void 0) {\n      rerender = false;\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var node;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (typeof this.root.element === 'undefined') {\n              throw new TreeError(this.user, 'Tree input not set');\n            }\n\n            if (!this.root.refreshPromise) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , this.root.refreshPromise];\n\n          case 1:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , Event.toPromise(this._onDidRender.event)];\n\n          case 2:\n            _a.sent();\n\n            _a.label = 3;\n\n          case 3:\n            node = this.getDataNode(element);\n            return [4\n            /*yield*/\n            , this.refreshAndRenderNode(node, recursive, viewStateContext)];\n\n          case 4:\n            _a.sent();\n\n            if (rerender) {\n              try {\n                this.tree.rerender(node);\n              } catch (_b) {// missing nodes are fine, this could've resulted from\n                // parallel refresh calls, removing `node` altogether\n              }\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }; // View\n\n\n  AsyncDataTree.prototype.rerender = function (element) {\n    if (element === undefined || element === this.root.element) {\n      this.tree.rerender();\n      return;\n    }\n\n    var node = this.getDataNode(element);\n    this.tree.rerender(node);\n  };\n\n  AsyncDataTree.prototype.collapse = function (element, recursive) {\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    var node = this.getDataNode(element);\n    return this.tree.collapse(node === this.root ? null : node, recursive);\n  };\n\n  AsyncDataTree.prototype.expand = function (element, recursive) {\n    if (recursive === void 0) {\n      recursive = false;\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var node, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (typeof this.root.element === 'undefined') {\n              throw new TreeError(this.user, 'Tree input not set');\n            }\n\n            if (!this.root.refreshPromise) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , this.root.refreshPromise];\n\n          case 1:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , Event.toPromise(this._onDidRender.event)];\n\n          case 2:\n            _a.sent();\n\n            _a.label = 3;\n\n          case 3:\n            node = this.getDataNode(element);\n\n            if (this.tree.hasElement(node) && !this.tree.isCollapsible(node)) {\n              return [2\n              /*return*/\n              , false];\n            }\n\n            if (!node.refreshPromise) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , this.root.refreshPromise];\n\n          case 4:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , Event.toPromise(this._onDidRender.event)];\n\n          case 5:\n            _a.sent();\n\n            _a.label = 6;\n\n          case 6:\n            if (node !== this.root && !node.refreshPromise && !this.tree.isCollapsed(node)) {\n              return [2\n              /*return*/\n              , false];\n            }\n\n            result = this.tree.expand(node === this.root ? null : node, recursive);\n            if (!node.refreshPromise) return [3\n            /*break*/\n            , 9];\n            return [4\n            /*yield*/\n            , this.root.refreshPromise];\n\n          case 7:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , Event.toPromise(this._onDidRender.event)];\n\n          case 8:\n            _a.sent();\n\n            _a.label = 9;\n\n          case 9:\n            return [2\n            /*return*/\n            , result];\n        }\n      });\n    });\n  };\n\n  AsyncDataTree.prototype.setSelection = function (elements, browserEvent) {\n    var _this = this;\n\n    var nodes = elements.map(function (e) {\n      return _this.getDataNode(e);\n    });\n    this.tree.setSelection(nodes, browserEvent);\n  };\n\n  AsyncDataTree.prototype.getSelection = function () {\n    var nodes = this.tree.getSelection();\n    return nodes.map(function (n) {\n      return n.element;\n    });\n  };\n\n  AsyncDataTree.prototype.setFocus = function (elements, browserEvent) {\n    var _this = this;\n\n    var nodes = elements.map(function (e) {\n      return _this.getDataNode(e);\n    });\n    this.tree.setFocus(nodes, browserEvent);\n  };\n\n  AsyncDataTree.prototype.getFocus = function () {\n    var nodes = this.tree.getFocus();\n    return nodes.map(function (n) {\n      return n.element;\n    });\n  };\n\n  AsyncDataTree.prototype.reveal = function (element, relativeTop) {\n    this.tree.reveal(this.getDataNode(element), relativeTop);\n  }; // Implementation\n\n\n  AsyncDataTree.prototype.getDataNode = function (element) {\n    var node = this.nodes.get(element === this.root.element ? null : element);\n\n    if (!node) {\n      throw new TreeError(this.user, \"Data tree node not found: \" + element);\n    }\n\n    return node;\n  };\n\n  AsyncDataTree.prototype.refreshAndRenderNode = function (node, recursive, viewStateContext) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.refreshNode(node, recursive, viewStateContext)];\n\n          case 1:\n            _a.sent();\n\n            this.render(node, viewStateContext);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AsyncDataTree.prototype.refreshNode = function (node, recursive, viewStateContext) {\n    return __awaiter(this, void 0, void 0, function () {\n      var result;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        this.subTreeRefreshPromises.forEach(function (refreshPromise, refreshNode) {\n          if (!result && intersects(refreshNode, node)) {\n            result = refreshPromise.then(function () {\n              return _this.refreshNode(node, recursive, viewStateContext);\n            });\n          }\n        });\n\n        if (result) {\n          return [2\n          /*return*/\n          , result];\n        }\n\n        return [2\n        /*return*/\n        , this.doRefreshSubTree(node, recursive, viewStateContext)];\n      });\n    });\n  };\n\n  AsyncDataTree.prototype.doRefreshSubTree = function (node, recursive, viewStateContext) {\n    return __awaiter(this, void 0, void 0, function () {\n      var done, childrenToRefresh;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            node.refreshPromise = new Promise(function (c) {\n              return done = c;\n            });\n            this.subTreeRefreshPromises.set(node, node.refreshPromise);\n            node.refreshPromise.finally(function () {\n              node.refreshPromise = undefined;\n\n              _this.subTreeRefreshPromises.delete(node);\n            });\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1,, 4, 5]);\n\n            return [4\n            /*yield*/\n            , this.doRefreshNode(node, recursive, viewStateContext)];\n\n          case 2:\n            childrenToRefresh = _a.sent();\n            node.stale = false;\n            return [4\n            /*yield*/\n            , Promise.all(childrenToRefresh.map(function (child) {\n              return _this.doRefreshSubTree(child, recursive, viewStateContext);\n            }))];\n\n          case 3:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            done();\n            return [7\n            /*endfinally*/\n            ];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AsyncDataTree.prototype.doRefreshNode = function (node, recursive, viewStateContext) {\n    return __awaiter(this, void 0, void 0, function () {\n      var childrenPromise, slowTimeout_1, children, err_1;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            node.hasChildren = !!this.dataSource.hasChildren(node.element);\n\n            if (!node.hasChildren) {\n              childrenPromise = Promise.resolve([]);\n            } else {\n              slowTimeout_1 = timeout(800);\n              slowTimeout_1.then(function () {\n                node.slow = true;\n\n                _this._onDidChangeNodeSlowState.fire(node);\n              }, function (_) {\n                return null;\n              });\n              childrenPromise = this.doGetChildren(node).finally(function () {\n                return slowTimeout_1.cancel();\n              });\n            }\n\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 3, 4, 5]);\n\n            return [4\n            /*yield*/\n            , childrenPromise];\n\n          case 2:\n            children = _a.sent();\n            return [2\n            /*return*/\n            , this.setChildren(node, children, recursive, viewStateContext)];\n\n          case 3:\n            err_1 = _a.sent();\n\n            if (node !== this.root) {\n              this.tree.collapse(node === this.root ? null : node);\n            }\n\n            if (isPromiseCanceledError(err_1)) {\n              return [2\n              /*return*/\n              , []];\n            }\n\n            throw err_1;\n\n          case 4:\n            if (node.slow) {\n              node.slow = false;\n\n              this._onDidChangeNodeSlowState.fire(node);\n            }\n\n            return [7\n            /*endfinally*/\n            ];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AsyncDataTree.prototype.doGetChildren = function (node) {\n    var _this = this;\n\n    var result = this.refreshPromises.get(node);\n\n    if (result) {\n      return result;\n    }\n\n    result = createCancelablePromise(function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var children;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , this.dataSource.getChildren(node.element)];\n\n            case 1:\n              children = _a.sent();\n              return [2\n              /*return*/\n              , this.processChildren(children)];\n          }\n        });\n      });\n    });\n    this.refreshPromises.set(node, result);\n    return result.finally(function () {\n      return _this.refreshPromises.delete(node);\n    });\n  };\n\n  AsyncDataTree.prototype._onDidChangeCollapseState = function (_a) {\n    var node = _a.node,\n        deep = _a.deep;\n\n    if (!node.collapsed && node.element.stale) {\n      if (deep) {\n        this.collapse(node.element.element);\n      } else {\n        this.refreshAndRenderNode(node.element, false).catch(onUnexpectedError);\n      }\n    }\n  };\n\n  AsyncDataTree.prototype.setChildren = function (node, childrenElements, recursive, viewStateContext) {\n    var _a;\n\n    var _this = this; // perf: if the node was and still is a leaf, avoid all this hassle\n\n\n    if (node.children.length === 0 && childrenElements.length === 0) {\n      return [];\n    }\n\n    var nodesToForget = new Map();\n    var childrenTreeNodesById = new Map();\n\n    for (var _i = 0, _b = node.children; _i < _b.length; _i++) {\n      var child = _b[_i];\n      nodesToForget.set(child.element, child);\n\n      if (this.identityProvider) {\n        var collapsed = this.tree.isCollapsed(child);\n        childrenTreeNodesById.set(child.id, {\n          node: child,\n          collapsed: collapsed\n        });\n      }\n    }\n\n    var childrenToRefresh = [];\n    var children = childrenElements.map(function (element) {\n      var hasChildren = !!_this.dataSource.hasChildren(element);\n\n      if (!_this.identityProvider) {\n        var asyncDataTreeNode = createAsyncDataTreeNode({\n          element: element,\n          parent: node,\n          hasChildren: hasChildren\n        });\n\n        if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\n          asyncDataTreeNode.collapsedByDefault = false;\n          childrenToRefresh.push(asyncDataTreeNode);\n        }\n\n        return asyncDataTreeNode;\n      }\n\n      var id = _this.identityProvider.getId(element).toString();\n\n      var result = childrenTreeNodesById.get(id);\n\n      if (result) {\n        var asyncDataTreeNode = result.node;\n        nodesToForget.delete(asyncDataTreeNode.element);\n\n        _this.nodes.delete(asyncDataTreeNode.element);\n\n        _this.nodes.set(element, asyncDataTreeNode);\n\n        asyncDataTreeNode.element = element;\n        asyncDataTreeNode.hasChildren = hasChildren;\n\n        if (recursive) {\n          if (result.collapsed) {\n            asyncDataTreeNode.children.forEach(function (node) {\n              return dfs(node, function (node) {\n                return _this.nodes.delete(node.element);\n              });\n            });\n            asyncDataTreeNode.children.splice(0, asyncDataTreeNode.children.length);\n            asyncDataTreeNode.stale = true;\n          } else {\n            childrenToRefresh.push(asyncDataTreeNode);\n          }\n        } else if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\n          asyncDataTreeNode.collapsedByDefault = false;\n          childrenToRefresh.push(asyncDataTreeNode);\n        }\n\n        return asyncDataTreeNode;\n      }\n\n      var childAsyncDataTreeNode = createAsyncDataTreeNode({\n        element: element,\n        parent: node,\n        id: id,\n        hasChildren: hasChildren\n      });\n\n      if (viewStateContext && viewStateContext.viewState.focus && viewStateContext.viewState.focus.indexOf(id) > -1) {\n        viewStateContext.focus.push(childAsyncDataTreeNode);\n      }\n\n      if (viewStateContext && viewStateContext.viewState.selection && viewStateContext.viewState.selection.indexOf(id) > -1) {\n        viewStateContext.selection.push(childAsyncDataTreeNode);\n      }\n\n      if (viewStateContext && viewStateContext.viewState.expanded && viewStateContext.viewState.expanded.indexOf(id) > -1) {\n        childrenToRefresh.push(childAsyncDataTreeNode);\n      } else if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\n        childAsyncDataTreeNode.collapsedByDefault = false;\n        childrenToRefresh.push(childAsyncDataTreeNode);\n      }\n\n      return childAsyncDataTreeNode;\n    });\n\n    for (var _c = 0, _d = values(nodesToForget); _c < _d.length; _c++) {\n      var node_1 = _d[_c];\n      dfs(node_1, function (node) {\n        return _this.nodes.delete(node.element);\n      });\n    }\n\n    for (var _e = 0, children_1 = children; _e < children_1.length; _e++) {\n      var child = children_1[_e];\n      this.nodes.set(child.element, child);\n    }\n\n    (_a = node.children).splice.apply(_a, __spreadArrays([0, node.children.length], children)); // TODO@joao this doesn't take filter into account\n\n\n    if (node !== this.root && this.autoExpandSingleChildren && children.length === 1 && childrenToRefresh.length === 0) {\n      children[0].collapsedByDefault = false;\n      childrenToRefresh.push(children[0]);\n    }\n\n    return childrenToRefresh;\n  };\n\n  AsyncDataTree.prototype.render = function (node, viewStateContext) {\n    var _this = this;\n\n    var children = node.children.map(function (node) {\n      return _this.asTreeElement(node, viewStateContext);\n    });\n    this.tree.setChildren(node === this.root ? null : node, children);\n\n    if (node !== this.root) {\n      this.tree.setCollapsible(node, node.hasChildren);\n    }\n\n    this._onDidRender.fire();\n  };\n\n  AsyncDataTree.prototype.asTreeElement = function (node, viewStateContext) {\n    var _this = this;\n\n    if (node.stale) {\n      return {\n        element: node,\n        collapsible: node.hasChildren,\n        collapsed: true\n      };\n    }\n\n    var collapsed;\n\n    if (viewStateContext && viewStateContext.viewState.expanded && node.id && viewStateContext.viewState.expanded.indexOf(node.id) > -1) {\n      collapsed = false;\n    } else {\n      collapsed = node.collapsedByDefault;\n    }\n\n    node.collapsedByDefault = undefined;\n    return {\n      element: node,\n      children: node.hasChildren ? Iterator.map(Iterator.fromArray(node.children), function (child) {\n        return _this.asTreeElement(child, viewStateContext);\n      }) : [],\n      collapsible: node.hasChildren,\n      collapsed: collapsed\n    };\n  };\n\n  AsyncDataTree.prototype.processChildren = function (children) {\n    if (this.sorter) {\n      children.sort(this.sorter.compare.bind(this.sorter));\n    }\n\n    return children;\n  };\n\n  AsyncDataTree.prototype.dispose = function () {\n    this.disposables.dispose();\n  };\n\n  return AsyncDataTree;\n}();\n\nexport { AsyncDataTree };\n\nvar CompressibleAsyncDataTreeNodeWrapper =\n/** @class */\nfunction () {\n  function CompressibleAsyncDataTreeNodeWrapper(node) {\n    this.node = node;\n  }\n\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"element\", {\n    get: function () {\n      return {\n        elements: this.node.element.elements.map(function (e) {\n          return e.element;\n        }),\n        incompressible: this.node.element.incompressible\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"children\", {\n    get: function () {\n      return this.node.children.map(function (node) {\n        return new CompressibleAsyncDataTreeNodeWrapper(node);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"depth\", {\n    get: function () {\n      return this.node.depth;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\n    get: function () {\n      return this.node.visibleChildrenCount;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visibleChildIndex\", {\n    get: function () {\n      return this.node.visibleChildIndex;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"collapsible\", {\n    get: function () {\n      return this.node.collapsible;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"collapsed\", {\n    get: function () {\n      return this.node.collapsed;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visible\", {\n    get: function () {\n      return this.node.visible;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"filterData\", {\n    get: function () {\n      return this.node.filterData;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return CompressibleAsyncDataTreeNodeWrapper;\n}();\n\nvar CompressibleAsyncDataTreeRenderer =\n/** @class */\nfunction () {\n  function CompressibleAsyncDataTreeRenderer(renderer, nodeMapper, compressibleNodeMapperProvider, onDidChangeTwistieState) {\n    this.renderer = renderer;\n    this.nodeMapper = nodeMapper;\n    this.compressibleNodeMapperProvider = compressibleNodeMapperProvider;\n    this.onDidChangeTwistieState = onDidChangeTwistieState;\n    this.renderedNodes = new Map();\n    this.disposables = [];\n    this.templateId = renderer.templateId;\n  }\n\n  CompressibleAsyncDataTreeRenderer.prototype.renderTemplate = function (container) {\n    var templateData = this.renderer.renderTemplate(container);\n    return {\n      templateData: templateData\n    };\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\n    this.renderer.renderElement(this.nodeMapper.map(node), index, templateData.templateData, height);\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.renderCompressedElements = function (node, index, templateData, height) {\n    this.renderer.renderCompressedElements(this.compressibleNodeMapperProvider().map(node), index, templateData.templateData, height);\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.renderTwistie = function (element, twistieElement) {\n    toggleClass(twistieElement, 'codicon-loading', element.slow);\n    return false;\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\n    if (this.renderer.disposeElement) {\n      this.renderer.disposeElement(this.nodeMapper.map(node), index, templateData.templateData, height);\n    }\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.disposeCompressedElements = function (node, index, templateData, height) {\n    if (this.renderer.disposeCompressedElements) {\n      this.renderer.disposeCompressedElements(this.compressibleNodeMapperProvider().map(node), index, templateData.templateData, height);\n    }\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.disposeTemplate = function (templateData) {\n    this.renderer.disposeTemplate(templateData.templateData);\n  };\n\n  CompressibleAsyncDataTreeRenderer.prototype.dispose = function () {\n    this.renderedNodes.clear();\n    this.disposables = dispose(this.disposables);\n  };\n\n  return CompressibleAsyncDataTreeRenderer;\n}();\n\nfunction asCompressibleObjectTreeOptions(options) {\n  var objectTreeOptions = options && asObjectTreeOptions(options);\n  return objectTreeOptions && __assign(__assign({}, objectTreeOptions), {\n    keyboardNavigationLabelProvider: objectTreeOptions.keyboardNavigationLabelProvider && __assign(__assign({}, objectTreeOptions.keyboardNavigationLabelProvider), {\n      getCompressedNodeKeyboardNavigationLabel: function (els) {\n        return options.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(els.map(function (e) {\n          return e.element;\n        }));\n      }\n    })\n  });\n}\n\nvar CompressibleAsyncDataTree =\n/** @class */\nfunction (_super) {\n  __extends(CompressibleAsyncDataTree, _super);\n\n  function CompressibleAsyncDataTree(user, container, virtualDelegate, compressionDelegate, renderers, dataSource, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _this = _super.call(this, user, container, virtualDelegate, renderers, dataSource, options) || this;\n\n    _this.compressionDelegate = compressionDelegate;\n    _this.compressibleNodeMapper = new WeakMapper(function (node) {\n      return new CompressibleAsyncDataTreeNodeWrapper(node);\n    });\n    _this.filter = options.filter;\n    return _this;\n  }\n\n  CompressibleAsyncDataTree.prototype.createTree = function (user, container, delegate, renderers, options) {\n    var _this = this;\n\n    var objectTreeDelegate = new ComposedTreeDelegate(delegate);\n    var objectTreeRenderers = renderers.map(function (r) {\n      return new CompressibleAsyncDataTreeRenderer(r, _this.nodeMapper, function () {\n        return _this.compressibleNodeMapper;\n      }, _this._onDidChangeNodeSlowState.event);\n    });\n    var objectTreeOptions = asCompressibleObjectTreeOptions(options) || {};\n    return new CompressibleObjectTree(user, container, objectTreeDelegate, objectTreeRenderers, objectTreeOptions);\n  };\n\n  CompressibleAsyncDataTree.prototype.asTreeElement = function (node, viewStateContext) {\n    return __assign({\n      incompressible: this.compressionDelegate.isIncompressible(node.element)\n    }, _super.prototype.asTreeElement.call(this, node, viewStateContext));\n  };\n\n  CompressibleAsyncDataTree.prototype.updateOptions = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.tree.updateOptions(options);\n  };\n\n  CompressibleAsyncDataTree.prototype.render = function (node, viewStateContext) {\n    var _this = this;\n\n    if (!this.identityProvider) {\n      return _super.prototype.render.call(this, node, viewStateContext);\n    } // Preserve traits across compressions. Hacky but does the trick.\n    // This is hard to fix properly since it requires rewriting the traits\n    // across trees and lists. Let's just keep it this way for now.\n\n\n    var getId = function (element) {\n      return _this.identityProvider.getId(element).toString();\n    };\n\n    var getUncompressedIds = function (nodes) {\n      var result = new Set();\n\n      for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n        var node_2 = nodes_1[_i];\n\n        var compressedNode = _this.tree.getCompressedTreeNode(node_2 === _this.root ? null : node_2);\n\n        if (!compressedNode.element) {\n          continue;\n        }\n\n        for (var _a = 0, _b = compressedNode.element.elements; _a < _b.length; _a++) {\n          var node_3 = _b[_a];\n          result.add(getId(node_3.element));\n        }\n      }\n\n      return result;\n    };\n\n    var oldSelection = getUncompressedIds(this.tree.getSelection());\n    var oldFocus = getUncompressedIds(this.tree.getFocus());\n\n    _super.prototype.render.call(this, node, viewStateContext);\n\n    var selection = this.getSelection();\n    var didChangeSelection = false;\n    var focus = this.getFocus();\n    var didChangeFocus = false;\n\n    var visit = function (node) {\n      var compressedNode = node.element;\n\n      if (compressedNode) {\n        for (var i = 0; i < compressedNode.elements.length; i++) {\n          var id = getId(compressedNode.elements[i].element);\n          var element = compressedNode.elements[compressedNode.elements.length - 1].element; // github.com/microsoft/vscode/issues/85938\n\n          if (oldSelection.has(id) && selection.indexOf(element) === -1) {\n            selection.push(element);\n            didChangeSelection = true;\n          }\n\n          if (oldFocus.has(id) && focus.indexOf(element) === -1) {\n            focus.push(element);\n            didChangeFocus = true;\n          }\n        }\n      }\n\n      node.children.forEach(visit);\n    };\n\n    visit(this.tree.getCompressedTreeNode(node === this.root ? null : node));\n\n    if (didChangeSelection) {\n      this.setSelection(selection);\n    }\n\n    if (didChangeFocus) {\n      this.setFocus(focus);\n    }\n  }; // For compressed async data trees, `TreeVisibility.Recurse` doesn't currently work\n  // and we have to filter everything beforehand\n  // Related to #85193 and #85835\n\n\n  CompressibleAsyncDataTree.prototype.processChildren = function (children) {\n    var _this = this;\n\n    if (this.filter) {\n      children = children.filter(function (e) {\n        var result = _this.filter.filter(e, 1\n        /* Visible */\n        );\n\n        var visibility = getVisibility(result);\n\n        if (visibility === 2\n        /* Recurse */\n        ) {\n            throw new Error('Recursive tree visibility not supported in async data compressed trees');\n          }\n\n        return visibility === 1\n        /* Visible */\n        ;\n      });\n    }\n\n    return _super.prototype.processChildren.call(this, children);\n  };\n\n  return CompressibleAsyncDataTree;\n}(AsyncDataTree);\n\nexport { CompressibleAsyncDataTree };\n\nfunction getVisibility(filterResult) {\n  if (typeof filterResult === 'boolean') {\n    return filterResult ? 1\n    /* Visible */\n    : 0\n    /* Hidden */\n    ;\n  } else if (isFilterResult(filterResult)) {\n    return getVisibleState(filterResult.visibility);\n  } else {\n    return getVisibleState(filterResult);\n  }\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/ui/tree/asyncDataTree.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","ComposedTreeDelegate","ObjectTree","CompressibleObjectTree","TreeError","WeakMapper","dispose","DisposableStore","Emitter","Event","timeout","createCancelablePromise","Iterator","ElementsDragAndDropData","isPromiseCanceledError","onUnexpectedError","toggleClass","values","isFilterResult","getVisibleState","createAsyncDataTreeNode","props","children","refreshPromise","undefined","stale","slow","collapsedByDefault","isAncestor","ancestor","descendant","parent","intersects","node","other","AsyncDataTreeNodeWrapper","defineProperty","get","element","enumerable","configurable","map","depth","visibleChildrenCount","visibleChildIndex","collapsible","collapsed","visible","filterData","AsyncDataTreeRenderer","renderer","nodeMapper","onDidChangeTwistieState","renderedNodes","Map","templateId","renderTemplate","container","templateData","renderElement","index","height","renderTwistie","twistieElement","disposeElement","disposeTemplate","clear","asTreeEvent","browserEvent","elements","AsyncDataTreeElementsDragAndDropData","_super","data","_this","asAsyncDataTreeDragAndDropData","AsyncDataTreeNodeListDragAndDrop","dnd","getDragURI","getDragLabel","nodes","originalEvent","onDragStart","onDragOver","targetNode","targetIndex","raw","drop","onDragEnd","asObjectTreeOptions","options","collapseByDefault","identityProvider","getId","el","multipleSelectionController","isSelectionSingleChangeEvent","isSelectionRangeChangeEvent","accessibilityProvider","getAriaLabel","getAriaLevel","getActiveDescendantId","filter","parentVisibility","keyboardNavigationLabelProvider","getKeyboardNavigationLabel","sorter","expandOnlyOnTwistieClick","ariaProvider","getPosInSet","getSetSize","listLength","getRole","isChecked","_a","additionalScrollHeight","dfs","fn","forEach","child","AsyncDataTree","user","delegate","renderers","dataSource","subTreeRefreshPromises","refreshPromises","_onDidRender","_onDidChangeNodeSlowState","disposables","autoExpandSingleChildren","tree","createTree","root","hasChildren","id","set","onDidChangeCollapseState","_onDidChangeCollapseState","onDidChangeFocus","onDidChangeSelection","onDidOpen","onDidFocus","onDidDispose","objectTreeDelegate","objectTreeRenderers","event","objectTreeOptions","updateOptions","getHTMLElement","scrollTop","domFocus","layout","width","style","styles","getInput","setInput","input","viewState","viewStateContext","promise","cancel","focus","selection","_updateChildren","setFocus","setSelection","recursive","rerender","toPromise","getDataNode","refreshAndRenderNode","_b","collapse","expand","hasElement","isCollapsible","isCollapsed","getSelection","getFocus","reveal","relativeTop","refreshNode","render","doRefreshSubTree","childrenToRefresh","c","finally","delete","doRefreshNode","all","childrenPromise","slowTimeout_1","err_1","fire","doGetChildren","setChildren","getChildren","processChildren","deep","catch","childrenElements","nodesToForget","childrenTreeNodesById","_i","asyncDataTreeNode","toString","splice","childAsyncDataTreeNode","indexOf","expanded","_c","_d","node_1","_e","children_1","asTreeElement","setCollapsible","fromArray","sort","compare","bind","CompressibleAsyncDataTreeNodeWrapper","incompressible","CompressibleAsyncDataTreeRenderer","compressibleNodeMapperProvider","renderCompressedElements","disposeCompressedElements","asCompressibleObjectTreeOptions","getCompressedNodeKeyboardNavigationLabel","els","CompressibleAsyncDataTree","virtualDelegate","compressionDelegate","compressibleNodeMapper","isIncompressible","getUncompressedIds","Set","nodes_1","node_2","compressedNode","getCompressedTreeNode","node_3","add","oldSelection","oldFocus","didChangeSelection","didChangeFocus","visit","has","visibility","getVisibility","Error","filterResult"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { ComposedTreeDelegate } from './abstractTree.js';\r\nimport { ObjectTree, CompressibleObjectTree } from './objectTree.js';\r\nimport { TreeError, WeakMapper } from './tree.js';\r\nimport { dispose, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { Emitter, Event } from '../../../common/event.js';\r\nimport { timeout, createCancelablePromise } from '../../../common/async.js';\r\nimport { Iterator } from '../../../common/iterator.js';\r\nimport { ElementsDragAndDropData } from '../list/listView.js';\r\nimport { isPromiseCanceledError, onUnexpectedError } from '../../../common/errors.js';\r\nimport { toggleClass } from '../../dom.js';\r\nimport { values } from '../../../common/map.js';\r\nimport { isFilterResult, getVisibleState } from './indexTreeModel.js';\r\nfunction createAsyncDataTreeNode(props) {\r\n    return __assign(__assign({}, props), { children: [], refreshPromise: undefined, stale: true, slow: false, collapsedByDefault: undefined });\r\n}\r\nfunction isAncestor(ancestor, descendant) {\r\n    if (!descendant.parent) {\r\n        return false;\r\n    }\r\n    else if (descendant.parent === ancestor) {\r\n        return true;\r\n    }\r\n    else {\r\n        return isAncestor(ancestor, descendant.parent);\r\n    }\r\n}\r\nfunction intersects(node, other) {\r\n    return node === other || isAncestor(node, other) || isAncestor(other, node);\r\n}\r\nvar AsyncDataTreeNodeWrapper = /** @class */ (function () {\r\n    function AsyncDataTreeNodeWrapper(node) {\r\n        this.node = node;\r\n    }\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"element\", {\r\n        get: function () { return this.node.element.element; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"children\", {\r\n        get: function () { return this.node.children.map(function (node) { return new AsyncDataTreeNodeWrapper(node); }); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"depth\", {\r\n        get: function () { return this.node.depth; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\r\n        get: function () { return this.node.visibleChildrenCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visibleChildIndex\", {\r\n        get: function () { return this.node.visibleChildIndex; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"collapsible\", {\r\n        get: function () { return this.node.collapsible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"collapsed\", {\r\n        get: function () { return this.node.collapsed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"visible\", {\r\n        get: function () { return this.node.visible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTreeNodeWrapper.prototype, \"filterData\", {\r\n        get: function () { return this.node.filterData; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return AsyncDataTreeNodeWrapper;\r\n}());\r\nvar AsyncDataTreeRenderer = /** @class */ (function () {\r\n    function AsyncDataTreeRenderer(renderer, nodeMapper, onDidChangeTwistieState) {\r\n        this.renderer = renderer;\r\n        this.nodeMapper = nodeMapper;\r\n        this.onDidChangeTwistieState = onDidChangeTwistieState;\r\n        this.renderedNodes = new Map();\r\n        this.templateId = renderer.templateId;\r\n    }\r\n    AsyncDataTreeRenderer.prototype.renderTemplate = function (container) {\r\n        var templateData = this.renderer.renderTemplate(container);\r\n        return { templateData: templateData };\r\n    };\r\n    AsyncDataTreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        this.renderer.renderElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n    };\r\n    AsyncDataTreeRenderer.prototype.renderTwistie = function (element, twistieElement) {\r\n        toggleClass(twistieElement, 'codicon-loading', element.slow);\r\n        return false;\r\n    };\r\n    AsyncDataTreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        if (this.renderer.disposeElement) {\r\n            this.renderer.disposeElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n        }\r\n    };\r\n    AsyncDataTreeRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.templateData);\r\n    };\r\n    AsyncDataTreeRenderer.prototype.dispose = function () {\r\n        this.renderedNodes.clear();\r\n    };\r\n    return AsyncDataTreeRenderer;\r\n}());\r\nfunction asTreeEvent(e) {\r\n    return {\r\n        browserEvent: e.browserEvent,\r\n        elements: e.elements.map(function (e) { return e.element; })\r\n    };\r\n}\r\nvar AsyncDataTreeElementsDragAndDropData = /** @class */ (function (_super) {\r\n    __extends(AsyncDataTreeElementsDragAndDropData, _super);\r\n    function AsyncDataTreeElementsDragAndDropData(data) {\r\n        var _this = _super.call(this, data.elements.map(function (node) { return node.element; })) || this;\r\n        _this.data = data;\r\n        return _this;\r\n    }\r\n    return AsyncDataTreeElementsDragAndDropData;\r\n}(ElementsDragAndDropData));\r\nfunction asAsyncDataTreeDragAndDropData(data) {\r\n    if (data instanceof ElementsDragAndDropData) {\r\n        return new AsyncDataTreeElementsDragAndDropData(data);\r\n    }\r\n    return data;\r\n}\r\nvar AsyncDataTreeNodeListDragAndDrop = /** @class */ (function () {\r\n    function AsyncDataTreeNodeListDragAndDrop(dnd) {\r\n        this.dnd = dnd;\r\n    }\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.getDragURI = function (node) {\r\n        return this.dnd.getDragURI(node.element);\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.getDragLabel = function (nodes, originalEvent) {\r\n        if (this.dnd.getDragLabel) {\r\n            return this.dnd.getDragLabel(nodes.map(function (node) { return node.element; }), originalEvent);\r\n        }\r\n        return undefined;\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.onDragStart = function (data, originalEvent) {\r\n        if (this.dnd.onDragStart) {\r\n            this.dnd.onDragStart(asAsyncDataTreeDragAndDropData(data), originalEvent);\r\n        }\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.onDragOver = function (data, targetNode, targetIndex, originalEvent, raw) {\r\n        if (raw === void 0) { raw = true; }\r\n        return this.dnd.onDragOver(asAsyncDataTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.drop = function (data, targetNode, targetIndex, originalEvent) {\r\n        this.dnd.drop(asAsyncDataTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\r\n    };\r\n    AsyncDataTreeNodeListDragAndDrop.prototype.onDragEnd = function (originalEvent) {\r\n        if (this.dnd.onDragEnd) {\r\n            this.dnd.onDragEnd(originalEvent);\r\n        }\r\n    };\r\n    return AsyncDataTreeNodeListDragAndDrop;\r\n}());\r\nfunction asObjectTreeOptions(options) {\r\n    return options && __assign(__assign({}, options), { collapseByDefault: true, identityProvider: options.identityProvider && {\r\n            getId: function (el) {\r\n                return options.identityProvider.getId(el.element);\r\n            }\r\n        }, dnd: options.dnd && new AsyncDataTreeNodeListDragAndDrop(options.dnd), multipleSelectionController: options.multipleSelectionController && {\r\n            isSelectionSingleChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionSingleChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            },\r\n            isSelectionRangeChangeEvent: function (e) {\r\n                return options.multipleSelectionController.isSelectionRangeChangeEvent(__assign(__assign({}, e), { element: e.element }));\r\n            }\r\n        }, accessibilityProvider: options.accessibilityProvider && __assign(__assign({}, options.accessibilityProvider), { getAriaLabel: function (e) {\r\n                return options.accessibilityProvider.getAriaLabel(e.element);\r\n            }, getAriaLevel: options.accessibilityProvider.getAriaLevel && (function (node) {\r\n                return options.accessibilityProvider.getAriaLevel(node.element);\r\n            }), getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && (function (node) {\r\n                return options.accessibilityProvider.getActiveDescendantId(node.element);\r\n            }) }), filter: options.filter && {\r\n            filter: function (e, parentVisibility) {\r\n                return options.filter.filter(e.element, parentVisibility);\r\n            }\r\n        }, keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && __assign(__assign({}, options.keyboardNavigationLabelProvider), { getKeyboardNavigationLabel: function (e) {\r\n                return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e.element);\r\n            } }), sorter: undefined, expandOnlyOnTwistieClick: typeof options.expandOnlyOnTwistieClick === 'undefined' ? undefined : (typeof options.expandOnlyOnTwistieClick !== 'function' ? options.expandOnlyOnTwistieClick : (function (e) { return options.expandOnlyOnTwistieClick(e.element); })), ariaProvider: options.ariaProvider && {\r\n            getPosInSet: function (el, index) {\r\n                return options.ariaProvider.getPosInSet(el.element, index);\r\n            },\r\n            getSetSize: function (el, index, listLength) {\r\n                return options.ariaProvider.getSetSize(el.element, index, listLength);\r\n            },\r\n            getRole: options.ariaProvider.getRole ? function (el) {\r\n                return options.ariaProvider.getRole(el.element);\r\n            } : undefined,\r\n            isChecked: options.ariaProvider.isChecked ? function (e) {\r\n                var _a;\r\n                return ((_a = options.ariaProvider) === null || _a === void 0 ? void 0 : _a.isChecked)(e.element);\r\n            } : undefined\r\n        }, additionalScrollHeight: options.additionalScrollHeight });\r\n}\r\nfunction dfs(node, fn) {\r\n    fn(node);\r\n    node.children.forEach(function (child) { return dfs(child, fn); });\r\n}\r\nvar AsyncDataTree = /** @class */ (function () {\r\n    function AsyncDataTree(user, container, delegate, renderers, dataSource, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.user = user;\r\n        this.dataSource = dataSource;\r\n        this.nodes = new Map();\r\n        this.subTreeRefreshPromises = new Map();\r\n        this.refreshPromises = new Map();\r\n        this._onDidRender = new Emitter();\r\n        this._onDidChangeNodeSlowState = new Emitter();\r\n        this.nodeMapper = new WeakMapper(function (node) { return new AsyncDataTreeNodeWrapper(node); });\r\n        this.disposables = new DisposableStore();\r\n        this.identityProvider = options.identityProvider;\r\n        this.autoExpandSingleChildren = typeof options.autoExpandSingleChildren === 'undefined' ? false : options.autoExpandSingleChildren;\r\n        this.sorter = options.sorter;\r\n        this.collapseByDefault = options.collapseByDefault;\r\n        this.tree = this.createTree(user, container, delegate, renderers, options);\r\n        this.root = createAsyncDataTreeNode({\r\n            element: undefined,\r\n            parent: null,\r\n            hasChildren: true\r\n        });\r\n        if (this.identityProvider) {\r\n            this.root = __assign(__assign({}, this.root), { id: null });\r\n        }\r\n        this.nodes.set(null, this.root);\r\n        this.tree.onDidChangeCollapseState(this._onDidChangeCollapseState, this, this.disposables);\r\n    }\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidChangeFocus\", {\r\n        get: function () { return Event.map(this.tree.onDidChangeFocus, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidChangeSelection\", {\r\n        get: function () { return Event.map(this.tree.onDidChangeSelection, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidOpen\", {\r\n        get: function () { return Event.map(this.tree.onDidOpen, asTreeEvent); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidFocus\", {\r\n        get: function () { return this.tree.onDidFocus; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncDataTree.prototype, \"onDidDispose\", {\r\n        get: function () { return this.tree.onDidDispose; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AsyncDataTree.prototype.createTree = function (user, container, delegate, renderers, options) {\r\n        var _this = this;\r\n        var objectTreeDelegate = new ComposedTreeDelegate(delegate);\r\n        var objectTreeRenderers = renderers.map(function (r) { return new AsyncDataTreeRenderer(r, _this.nodeMapper, _this._onDidChangeNodeSlowState.event); });\r\n        var objectTreeOptions = asObjectTreeOptions(options) || {};\r\n        return new ObjectTree(user, container, objectTreeDelegate, objectTreeRenderers, objectTreeOptions);\r\n    };\r\n    AsyncDataTree.prototype.updateOptions = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.tree.updateOptions(options);\r\n    };\r\n    // Widget\r\n    AsyncDataTree.prototype.getHTMLElement = function () {\r\n        return this.tree.getHTMLElement();\r\n    };\r\n    Object.defineProperty(AsyncDataTree.prototype, \"scrollTop\", {\r\n        get: function () {\r\n            return this.tree.scrollTop;\r\n        },\r\n        set: function (scrollTop) {\r\n            this.tree.scrollTop = scrollTop;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AsyncDataTree.prototype.domFocus = function () {\r\n        this.tree.domFocus();\r\n    };\r\n    AsyncDataTree.prototype.layout = function (height, width) {\r\n        this.tree.layout(height, width);\r\n    };\r\n    AsyncDataTree.prototype.style = function (styles) {\r\n        this.tree.style(styles);\r\n    };\r\n    // Model\r\n    AsyncDataTree.prototype.getInput = function () {\r\n        return this.root.element;\r\n    };\r\n    AsyncDataTree.prototype.setInput = function (input, viewState) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var viewStateContext;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.refreshPromises.forEach(function (promise) { return promise.cancel(); });\r\n                        this.refreshPromises.clear();\r\n                        this.root.element = input;\r\n                        viewStateContext = viewState && { viewState: viewState, focus: [], selection: [] };\r\n                        return [4 /*yield*/, this._updateChildren(input, true, false, viewStateContext)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (viewStateContext) {\r\n                            this.tree.setFocus(viewStateContext.focus);\r\n                            this.tree.setSelection(viewStateContext.selection);\r\n                        }\r\n                        if (viewState && typeof viewState.scrollTop === 'number') {\r\n                            this.scrollTop = viewState.scrollTop;\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype._updateChildren = function (element, recursive, rerender, viewStateContext) {\r\n        if (element === void 0) { element = this.root.element; }\r\n        if (recursive === void 0) { recursive = true; }\r\n        if (rerender === void 0) { rerender = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var node;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof this.root.element === 'undefined') {\r\n                            throw new TreeError(this.user, 'Tree input not set');\r\n                        }\r\n                        if (!this.root.refreshPromise) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        node = this.getDataNode(element);\r\n                        return [4 /*yield*/, this.refreshAndRenderNode(node, recursive, viewStateContext)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        if (rerender) {\r\n                            try {\r\n                                this.tree.rerender(node);\r\n                            }\r\n                            catch (_b) {\r\n                                // missing nodes are fine, this could've resulted from\r\n                                // parallel refresh calls, removing `node` altogether\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // View\r\n    AsyncDataTree.prototype.rerender = function (element) {\r\n        if (element === undefined || element === this.root.element) {\r\n            this.tree.rerender();\r\n            return;\r\n        }\r\n        var node = this.getDataNode(element);\r\n        this.tree.rerender(node);\r\n    };\r\n    AsyncDataTree.prototype.collapse = function (element, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        var node = this.getDataNode(element);\r\n        return this.tree.collapse(node === this.root ? null : node, recursive);\r\n    };\r\n    AsyncDataTree.prototype.expand = function (element, recursive) {\r\n        if (recursive === void 0) { recursive = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var node, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof this.root.element === 'undefined') {\r\n                            throw new TreeError(this.user, 'Tree input not set');\r\n                        }\r\n                        if (!this.root.refreshPromise) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        node = this.getDataNode(element);\r\n                        if (this.tree.hasElement(node) && !this.tree.isCollapsible(node)) {\r\n                            return [2 /*return*/, false];\r\n                        }\r\n                        if (!node.refreshPromise) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 5:\r\n                        _a.sent();\r\n                        _a.label = 6;\r\n                    case 6:\r\n                        if (node !== this.root && !node.refreshPromise && !this.tree.isCollapsed(node)) {\r\n                            return [2 /*return*/, false];\r\n                        }\r\n                        result = this.tree.expand(node === this.root ? null : node, recursive);\r\n                        if (!node.refreshPromise) return [3 /*break*/, 9];\r\n                        return [4 /*yield*/, this.root.refreshPromise];\r\n                    case 7:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, Event.toPromise(this._onDidRender.event)];\r\n                    case 8:\r\n                        _a.sent();\r\n                        _a.label = 9;\r\n                    case 9: return [2 /*return*/, result];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.setSelection = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.getDataNode(e); });\r\n        this.tree.setSelection(nodes, browserEvent);\r\n    };\r\n    AsyncDataTree.prototype.getSelection = function () {\r\n        var nodes = this.tree.getSelection();\r\n        return nodes.map(function (n) { return n.element; });\r\n    };\r\n    AsyncDataTree.prototype.setFocus = function (elements, browserEvent) {\r\n        var _this = this;\r\n        var nodes = elements.map(function (e) { return _this.getDataNode(e); });\r\n        this.tree.setFocus(nodes, browserEvent);\r\n    };\r\n    AsyncDataTree.prototype.getFocus = function () {\r\n        var nodes = this.tree.getFocus();\r\n        return nodes.map(function (n) { return n.element; });\r\n    };\r\n    AsyncDataTree.prototype.reveal = function (element, relativeTop) {\r\n        this.tree.reveal(this.getDataNode(element), relativeTop);\r\n    };\r\n    // Implementation\r\n    AsyncDataTree.prototype.getDataNode = function (element) {\r\n        var node = this.nodes.get((element === this.root.element ? null : element));\r\n        if (!node) {\r\n            throw new TreeError(this.user, \"Data tree node not found: \" + element);\r\n        }\r\n        return node;\r\n    };\r\n    AsyncDataTree.prototype.refreshAndRenderNode = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.refreshNode(node, recursive, viewStateContext)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.render(node, viewStateContext);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.refreshNode = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                this.subTreeRefreshPromises.forEach(function (refreshPromise, refreshNode) {\r\n                    if (!result && intersects(refreshNode, node)) {\r\n                        result = refreshPromise.then(function () { return _this.refreshNode(node, recursive, viewStateContext); });\r\n                    }\r\n                });\r\n                if (result) {\r\n                    return [2 /*return*/, result];\r\n                }\r\n                return [2 /*return*/, this.doRefreshSubTree(node, recursive, viewStateContext)];\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.doRefreshSubTree = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var done, childrenToRefresh;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        node.refreshPromise = new Promise(function (c) { return done = c; });\r\n                        this.subTreeRefreshPromises.set(node, node.refreshPromise);\r\n                        node.refreshPromise.finally(function () {\r\n                            node.refreshPromise = undefined;\r\n                            _this.subTreeRefreshPromises.delete(node);\r\n                        });\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, , 4, 5]);\r\n                        return [4 /*yield*/, this.doRefreshNode(node, recursive, viewStateContext)];\r\n                    case 2:\r\n                        childrenToRefresh = _a.sent();\r\n                        node.stale = false;\r\n                        return [4 /*yield*/, Promise.all(childrenToRefresh.map(function (child) { return _this.doRefreshSubTree(child, recursive, viewStateContext); }))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        done();\r\n                        return [7 /*endfinally*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.doRefreshNode = function (node, recursive, viewStateContext) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var childrenPromise, slowTimeout_1, children, err_1;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        node.hasChildren = !!this.dataSource.hasChildren(node.element);\r\n                        if (!node.hasChildren) {\r\n                            childrenPromise = Promise.resolve([]);\r\n                        }\r\n                        else {\r\n                            slowTimeout_1 = timeout(800);\r\n                            slowTimeout_1.then(function () {\r\n                                node.slow = true;\r\n                                _this._onDidChangeNodeSlowState.fire(node);\r\n                            }, function (_) { return null; });\r\n                            childrenPromise = this.doGetChildren(node)\r\n                                .finally(function () { return slowTimeout_1.cancel(); });\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, 4, 5]);\r\n                        return [4 /*yield*/, childrenPromise];\r\n                    case 2:\r\n                        children = _a.sent();\r\n                        return [2 /*return*/, this.setChildren(node, children, recursive, viewStateContext)];\r\n                    case 3:\r\n                        err_1 = _a.sent();\r\n                        if (node !== this.root) {\r\n                            this.tree.collapse(node === this.root ? null : node);\r\n                        }\r\n                        if (isPromiseCanceledError(err_1)) {\r\n                            return [2 /*return*/, []];\r\n                        }\r\n                        throw err_1;\r\n                    case 4:\r\n                        if (node.slow) {\r\n                            node.slow = false;\r\n                            this._onDidChangeNodeSlowState.fire(node);\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AsyncDataTree.prototype.doGetChildren = function (node) {\r\n        var _this = this;\r\n        var result = this.refreshPromises.get(node);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        result = createCancelablePromise(function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var children;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.dataSource.getChildren(node.element)];\r\n                    case 1:\r\n                        children = _a.sent();\r\n                        return [2 /*return*/, this.processChildren(children)];\r\n                }\r\n            });\r\n        }); });\r\n        this.refreshPromises.set(node, result);\r\n        return result.finally(function () { return _this.refreshPromises.delete(node); });\r\n    };\r\n    AsyncDataTree.prototype._onDidChangeCollapseState = function (_a) {\r\n        var node = _a.node, deep = _a.deep;\r\n        if (!node.collapsed && node.element.stale) {\r\n            if (deep) {\r\n                this.collapse(node.element.element);\r\n            }\r\n            else {\r\n                this.refreshAndRenderNode(node.element, false)\r\n                    .catch(onUnexpectedError);\r\n            }\r\n        }\r\n    };\r\n    AsyncDataTree.prototype.setChildren = function (node, childrenElements, recursive, viewStateContext) {\r\n        var _a;\r\n        var _this = this;\r\n        // perf: if the node was and still is a leaf, avoid all this hassle\r\n        if (node.children.length === 0 && childrenElements.length === 0) {\r\n            return [];\r\n        }\r\n        var nodesToForget = new Map();\r\n        var childrenTreeNodesById = new Map();\r\n        for (var _i = 0, _b = node.children; _i < _b.length; _i++) {\r\n            var child = _b[_i];\r\n            nodesToForget.set(child.element, child);\r\n            if (this.identityProvider) {\r\n                var collapsed = this.tree.isCollapsed(child);\r\n                childrenTreeNodesById.set(child.id, { node: child, collapsed: collapsed });\r\n            }\r\n        }\r\n        var childrenToRefresh = [];\r\n        var children = childrenElements.map(function (element) {\r\n            var hasChildren = !!_this.dataSource.hasChildren(element);\r\n            if (!_this.identityProvider) {\r\n                var asyncDataTreeNode = createAsyncDataTreeNode({ element: element, parent: node, hasChildren: hasChildren });\r\n                if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\r\n                    asyncDataTreeNode.collapsedByDefault = false;\r\n                    childrenToRefresh.push(asyncDataTreeNode);\r\n                }\r\n                return asyncDataTreeNode;\r\n            }\r\n            var id = _this.identityProvider.getId(element).toString();\r\n            var result = childrenTreeNodesById.get(id);\r\n            if (result) {\r\n                var asyncDataTreeNode = result.node;\r\n                nodesToForget.delete(asyncDataTreeNode.element);\r\n                _this.nodes.delete(asyncDataTreeNode.element);\r\n                _this.nodes.set(element, asyncDataTreeNode);\r\n                asyncDataTreeNode.element = element;\r\n                asyncDataTreeNode.hasChildren = hasChildren;\r\n                if (recursive) {\r\n                    if (result.collapsed) {\r\n                        asyncDataTreeNode.children.forEach(function (node) { return dfs(node, function (node) { return _this.nodes.delete(node.element); }); });\r\n                        asyncDataTreeNode.children.splice(0, asyncDataTreeNode.children.length);\r\n                        asyncDataTreeNode.stale = true;\r\n                    }\r\n                    else {\r\n                        childrenToRefresh.push(asyncDataTreeNode);\r\n                    }\r\n                }\r\n                else if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\r\n                    asyncDataTreeNode.collapsedByDefault = false;\r\n                    childrenToRefresh.push(asyncDataTreeNode);\r\n                }\r\n                return asyncDataTreeNode;\r\n            }\r\n            var childAsyncDataTreeNode = createAsyncDataTreeNode({ element: element, parent: node, id: id, hasChildren: hasChildren });\r\n            if (viewStateContext && viewStateContext.viewState.focus && viewStateContext.viewState.focus.indexOf(id) > -1) {\r\n                viewStateContext.focus.push(childAsyncDataTreeNode);\r\n            }\r\n            if (viewStateContext && viewStateContext.viewState.selection && viewStateContext.viewState.selection.indexOf(id) > -1) {\r\n                viewStateContext.selection.push(childAsyncDataTreeNode);\r\n            }\r\n            if (viewStateContext && viewStateContext.viewState.expanded && viewStateContext.viewState.expanded.indexOf(id) > -1) {\r\n                childrenToRefresh.push(childAsyncDataTreeNode);\r\n            }\r\n            else if (hasChildren && _this.collapseByDefault && !_this.collapseByDefault(element)) {\r\n                childAsyncDataTreeNode.collapsedByDefault = false;\r\n                childrenToRefresh.push(childAsyncDataTreeNode);\r\n            }\r\n            return childAsyncDataTreeNode;\r\n        });\r\n        for (var _c = 0, _d = values(nodesToForget); _c < _d.length; _c++) {\r\n            var node_1 = _d[_c];\r\n            dfs(node_1, function (node) { return _this.nodes.delete(node.element); });\r\n        }\r\n        for (var _e = 0, children_1 = children; _e < children_1.length; _e++) {\r\n            var child = children_1[_e];\r\n            this.nodes.set(child.element, child);\r\n        }\r\n        (_a = node.children).splice.apply(_a, __spreadArrays([0, node.children.length], children));\r\n        // TODO@joao this doesn't take filter into account\r\n        if (node !== this.root && this.autoExpandSingleChildren && children.length === 1 && childrenToRefresh.length === 0) {\r\n            children[0].collapsedByDefault = false;\r\n            childrenToRefresh.push(children[0]);\r\n        }\r\n        return childrenToRefresh;\r\n    };\r\n    AsyncDataTree.prototype.render = function (node, viewStateContext) {\r\n        var _this = this;\r\n        var children = node.children.map(function (node) { return _this.asTreeElement(node, viewStateContext); });\r\n        this.tree.setChildren(node === this.root ? null : node, children);\r\n        if (node !== this.root) {\r\n            this.tree.setCollapsible(node, node.hasChildren);\r\n        }\r\n        this._onDidRender.fire();\r\n    };\r\n    AsyncDataTree.prototype.asTreeElement = function (node, viewStateContext) {\r\n        var _this = this;\r\n        if (node.stale) {\r\n            return {\r\n                element: node,\r\n                collapsible: node.hasChildren,\r\n                collapsed: true\r\n            };\r\n        }\r\n        var collapsed;\r\n        if (viewStateContext && viewStateContext.viewState.expanded && node.id && viewStateContext.viewState.expanded.indexOf(node.id) > -1) {\r\n            collapsed = false;\r\n        }\r\n        else {\r\n            collapsed = node.collapsedByDefault;\r\n        }\r\n        node.collapsedByDefault = undefined;\r\n        return {\r\n            element: node,\r\n            children: node.hasChildren ? Iterator.map(Iterator.fromArray(node.children), function (child) { return _this.asTreeElement(child, viewStateContext); }) : [],\r\n            collapsible: node.hasChildren,\r\n            collapsed: collapsed\r\n        };\r\n    };\r\n    AsyncDataTree.prototype.processChildren = function (children) {\r\n        if (this.sorter) {\r\n            children.sort(this.sorter.compare.bind(this.sorter));\r\n        }\r\n        return children;\r\n    };\r\n    AsyncDataTree.prototype.dispose = function () {\r\n        this.disposables.dispose();\r\n    };\r\n    return AsyncDataTree;\r\n}());\r\nexport { AsyncDataTree };\r\nvar CompressibleAsyncDataTreeNodeWrapper = /** @class */ (function () {\r\n    function CompressibleAsyncDataTreeNodeWrapper(node) {\r\n        this.node = node;\r\n    }\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"element\", {\r\n        get: function () {\r\n            return {\r\n                elements: this.node.element.elements.map(function (e) { return e.element; }),\r\n                incompressible: this.node.element.incompressible\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"children\", {\r\n        get: function () { return this.node.children.map(function (node) { return new CompressibleAsyncDataTreeNodeWrapper(node); }); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"depth\", {\r\n        get: function () { return this.node.depth; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visibleChildrenCount\", {\r\n        get: function () { return this.node.visibleChildrenCount; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visibleChildIndex\", {\r\n        get: function () { return this.node.visibleChildIndex; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"collapsible\", {\r\n        get: function () { return this.node.collapsible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"collapsed\", {\r\n        get: function () { return this.node.collapsed; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"visible\", {\r\n        get: function () { return this.node.visible; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CompressibleAsyncDataTreeNodeWrapper.prototype, \"filterData\", {\r\n        get: function () { return this.node.filterData; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return CompressibleAsyncDataTreeNodeWrapper;\r\n}());\r\nvar CompressibleAsyncDataTreeRenderer = /** @class */ (function () {\r\n    function CompressibleAsyncDataTreeRenderer(renderer, nodeMapper, compressibleNodeMapperProvider, onDidChangeTwistieState) {\r\n        this.renderer = renderer;\r\n        this.nodeMapper = nodeMapper;\r\n        this.compressibleNodeMapperProvider = compressibleNodeMapperProvider;\r\n        this.onDidChangeTwistieState = onDidChangeTwistieState;\r\n        this.renderedNodes = new Map();\r\n        this.disposables = [];\r\n        this.templateId = renderer.templateId;\r\n    }\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderTemplate = function (container) {\r\n        var templateData = this.renderer.renderTemplate(container);\r\n        return { templateData: templateData };\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderElement = function (node, index, templateData, height) {\r\n        this.renderer.renderElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderCompressedElements = function (node, index, templateData, height) {\r\n        this.renderer.renderCompressedElements(this.compressibleNodeMapperProvider().map(node), index, templateData.templateData, height);\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.renderTwistie = function (element, twistieElement) {\r\n        toggleClass(twistieElement, 'codicon-loading', element.slow);\r\n        return false;\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.disposeElement = function (node, index, templateData, height) {\r\n        if (this.renderer.disposeElement) {\r\n            this.renderer.disposeElement(this.nodeMapper.map(node), index, templateData.templateData, height);\r\n        }\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.disposeCompressedElements = function (node, index, templateData, height) {\r\n        if (this.renderer.disposeCompressedElements) {\r\n            this.renderer.disposeCompressedElements(this.compressibleNodeMapperProvider().map(node), index, templateData.templateData, height);\r\n        }\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.disposeTemplate = function (templateData) {\r\n        this.renderer.disposeTemplate(templateData.templateData);\r\n    };\r\n    CompressibleAsyncDataTreeRenderer.prototype.dispose = function () {\r\n        this.renderedNodes.clear();\r\n        this.disposables = dispose(this.disposables);\r\n    };\r\n    return CompressibleAsyncDataTreeRenderer;\r\n}());\r\nfunction asCompressibleObjectTreeOptions(options) {\r\n    var objectTreeOptions = options && asObjectTreeOptions(options);\r\n    return objectTreeOptions && __assign(__assign({}, objectTreeOptions), { keyboardNavigationLabelProvider: objectTreeOptions.keyboardNavigationLabelProvider && __assign(__assign({}, objectTreeOptions.keyboardNavigationLabelProvider), { getCompressedNodeKeyboardNavigationLabel: function (els) {\r\n                return options.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(els.map(function (e) { return e.element; }));\r\n            } }) });\r\n}\r\nvar CompressibleAsyncDataTree = /** @class */ (function (_super) {\r\n    __extends(CompressibleAsyncDataTree, _super);\r\n    function CompressibleAsyncDataTree(user, container, virtualDelegate, compressionDelegate, renderers, dataSource, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = _super.call(this, user, container, virtualDelegate, renderers, dataSource, options) || this;\r\n        _this.compressionDelegate = compressionDelegate;\r\n        _this.compressibleNodeMapper = new WeakMapper(function (node) { return new CompressibleAsyncDataTreeNodeWrapper(node); });\r\n        _this.filter = options.filter;\r\n        return _this;\r\n    }\r\n    CompressibleAsyncDataTree.prototype.createTree = function (user, container, delegate, renderers, options) {\r\n        var _this = this;\r\n        var objectTreeDelegate = new ComposedTreeDelegate(delegate);\r\n        var objectTreeRenderers = renderers.map(function (r) { return new CompressibleAsyncDataTreeRenderer(r, _this.nodeMapper, function () { return _this.compressibleNodeMapper; }, _this._onDidChangeNodeSlowState.event); });\r\n        var objectTreeOptions = asCompressibleObjectTreeOptions(options) || {};\r\n        return new CompressibleObjectTree(user, container, objectTreeDelegate, objectTreeRenderers, objectTreeOptions);\r\n    };\r\n    CompressibleAsyncDataTree.prototype.asTreeElement = function (node, viewStateContext) {\r\n        return __assign({ incompressible: this.compressionDelegate.isIncompressible(node.element) }, _super.prototype.asTreeElement.call(this, node, viewStateContext));\r\n    };\r\n    CompressibleAsyncDataTree.prototype.updateOptions = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.tree.updateOptions(options);\r\n    };\r\n    CompressibleAsyncDataTree.prototype.render = function (node, viewStateContext) {\r\n        var _this = this;\r\n        if (!this.identityProvider) {\r\n            return _super.prototype.render.call(this, node, viewStateContext);\r\n        }\r\n        // Preserve traits across compressions. Hacky but does the trick.\r\n        // This is hard to fix properly since it requires rewriting the traits\r\n        // across trees and lists. Let's just keep it this way for now.\r\n        var getId = function (element) { return _this.identityProvider.getId(element).toString(); };\r\n        var getUncompressedIds = function (nodes) {\r\n            var result = new Set();\r\n            for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\r\n                var node_2 = nodes_1[_i];\r\n                var compressedNode = _this.tree.getCompressedTreeNode(node_2 === _this.root ? null : node_2);\r\n                if (!compressedNode.element) {\r\n                    continue;\r\n                }\r\n                for (var _a = 0, _b = compressedNode.element.elements; _a < _b.length; _a++) {\r\n                    var node_3 = _b[_a];\r\n                    result.add(getId(node_3.element));\r\n                }\r\n            }\r\n            return result;\r\n        };\r\n        var oldSelection = getUncompressedIds(this.tree.getSelection());\r\n        var oldFocus = getUncompressedIds(this.tree.getFocus());\r\n        _super.prototype.render.call(this, node, viewStateContext);\r\n        var selection = this.getSelection();\r\n        var didChangeSelection = false;\r\n        var focus = this.getFocus();\r\n        var didChangeFocus = false;\r\n        var visit = function (node) {\r\n            var compressedNode = node.element;\r\n            if (compressedNode) {\r\n                for (var i = 0; i < compressedNode.elements.length; i++) {\r\n                    var id = getId(compressedNode.elements[i].element);\r\n                    var element = compressedNode.elements[compressedNode.elements.length - 1].element;\r\n                    // github.com/microsoft/vscode/issues/85938\r\n                    if (oldSelection.has(id) && selection.indexOf(element) === -1) {\r\n                        selection.push(element);\r\n                        didChangeSelection = true;\r\n                    }\r\n                    if (oldFocus.has(id) && focus.indexOf(element) === -1) {\r\n                        focus.push(element);\r\n                        didChangeFocus = true;\r\n                    }\r\n                }\r\n            }\r\n            node.children.forEach(visit);\r\n        };\r\n        visit(this.tree.getCompressedTreeNode(node === this.root ? null : node));\r\n        if (didChangeSelection) {\r\n            this.setSelection(selection);\r\n        }\r\n        if (didChangeFocus) {\r\n            this.setFocus(focus);\r\n        }\r\n    };\r\n    // For compressed async data trees, `TreeVisibility.Recurse` doesn't currently work\r\n    // and we have to filter everything beforehand\r\n    // Related to #85193 and #85835\r\n    CompressibleAsyncDataTree.prototype.processChildren = function (children) {\r\n        var _this = this;\r\n        if (this.filter) {\r\n            children = children.filter(function (e) {\r\n                var result = _this.filter.filter(e, 1 /* Visible */);\r\n                var visibility = getVisibility(result);\r\n                if (visibility === 2 /* Recurse */) {\r\n                    throw new Error('Recursive tree visibility not supported in async data compressed trees');\r\n                }\r\n                return visibility === 1 /* Visible */;\r\n            });\r\n        }\r\n        return _super.prototype.processChildren.call(this, children);\r\n    };\r\n    return CompressibleAsyncDataTree;\r\n}(AsyncDataTree));\r\nexport { CompressibleAsyncDataTree };\r\nfunction getVisibility(filterResult) {\r\n    if (typeof filterResult === 'boolean') {\r\n        return filterResult ? 1 /* Visible */ : 0 /* Hidden */;\r\n    }\r\n    else if (isFilterResult(filterResult)) {\r\n        return getVisibleState(filterResult.visibility);\r\n    }\r\n    else {\r\n        return getVisibleState(filterResult);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}