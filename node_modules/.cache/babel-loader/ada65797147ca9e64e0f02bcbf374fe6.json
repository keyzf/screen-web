{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { KeyChord } from '../../../base/common/keyCodes.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { CharacterSet } from '../../common/core/characterClassifier.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { DocumentRangeFormattingEditProviderRegistry, OnTypeFormattingEditProviderRegistry } from '../../common/modes.js';\nimport { IEditorWorkerService } from '../../common/services/editorWorkerService.js';\nimport { getOnTypeFormattingEdits, alertFormattingEdits, formatDocumentRangeWithSelectedProvider, formatDocumentWithSelectedProvider } from './format.js';\nimport { FormattingEdit } from './formattingEdit.js';\nimport * as nls from '../../../nls.js';\nimport { CommandsRegistry, ICommandService } from '../../../platform/commands/common/commands.js';\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\n\nvar FormatOnType =\n/** @class */\nfunction () {\n  function FormatOnType(editor, _workerService) {\n    var _this = this;\n\n    this._workerService = _workerService;\n    this._callOnDispose = new DisposableStore();\n    this._callOnModel = new DisposableStore();\n    this._editor = editor;\n\n    this._callOnDispose.add(editor.onDidChangeConfiguration(function () {\n      return _this._update();\n    }));\n\n    this._callOnDispose.add(editor.onDidChangeModel(function () {\n      return _this._update();\n    }));\n\n    this._callOnDispose.add(editor.onDidChangeModelLanguage(function () {\n      return _this._update();\n    }));\n\n    this._callOnDispose.add(OnTypeFormattingEditProviderRegistry.onDidChange(this._update, this));\n  }\n\n  FormatOnType.prototype.dispose = function () {\n    this._callOnDispose.dispose();\n\n    this._callOnModel.dispose();\n  };\n\n  FormatOnType.prototype._update = function () {\n    var _this = this; // clean up\n\n\n    this._callOnModel.clear(); // we are disabled\n\n\n    if (!this._editor.getOption(39\n    /* formatOnType */\n    )) {\n      return;\n    } // no model\n\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    var model = this._editor.getModel(); // no support\n\n\n    var support = OnTypeFormattingEditProviderRegistry.ordered(model)[0];\n\n    if (!support || !support.autoFormatTriggerCharacters) {\n      return;\n    } // register typing listeners that will trigger the format\n\n\n    var triggerChars = new CharacterSet();\n\n    for (var _i = 0, _a = support.autoFormatTriggerCharacters; _i < _a.length; _i++) {\n      var ch = _a[_i];\n      triggerChars.add(ch.charCodeAt(0));\n    }\n\n    this._callOnModel.add(this._editor.onDidType(function (text) {\n      var lastCharCode = text.charCodeAt(text.length - 1);\n\n      if (triggerChars.has(lastCharCode)) {\n        _this._trigger(String.fromCharCode(lastCharCode));\n      }\n    }));\n  };\n\n  FormatOnType.prototype._trigger = function (ch) {\n    var _this = this;\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    if (this._editor.getSelections().length > 1) {\n      return;\n    }\n\n    var model = this._editor.getModel();\n\n    var position = this._editor.getPosition();\n\n    var canceled = false; // install a listener that checks if edits happens before the\n    // position on which we format right now. If so, we won't\n    // apply the format edits\n\n    var unbind = this._editor.onDidChangeModelContent(function (e) {\n      if (e.isFlush) {\n        // a model.setValue() was called\n        // cancel only once\n        canceled = true;\n        unbind.dispose();\n        return;\n      }\n\n      for (var i = 0, len = e.changes.length; i < len; i++) {\n        var change = e.changes[i];\n\n        if (change.range.endLineNumber <= position.lineNumber) {\n          // cancel only once\n          canceled = true;\n          unbind.dispose();\n          return;\n        }\n      }\n    });\n\n    getOnTypeFormattingEdits(this._workerService, model, position, ch, model.getFormattingOptions()).then(function (edits) {\n      unbind.dispose();\n\n      if (canceled) {\n        return;\n      }\n\n      if (isNonEmptyArray(edits)) {\n        FormattingEdit.execute(_this._editor, edits);\n        alertFormattingEdits(edits);\n      }\n    }, function (err) {\n      unbind.dispose();\n      throw err;\n    });\n  };\n\n  FormatOnType.ID = 'editor.contrib.autoFormat';\n  FormatOnType = __decorate([__param(1, IEditorWorkerService)], FormatOnType);\n  return FormatOnType;\n}();\n\nvar FormatOnPaste =\n/** @class */\nfunction () {\n  function FormatOnPaste(editor, _instantiationService) {\n    var _this = this;\n\n    this.editor = editor;\n    this._instantiationService = _instantiationService;\n    this._callOnDispose = new DisposableStore();\n    this._callOnModel = new DisposableStore();\n\n    this._callOnDispose.add(editor.onDidChangeConfiguration(function () {\n      return _this._update();\n    }));\n\n    this._callOnDispose.add(editor.onDidChangeModel(function () {\n      return _this._update();\n    }));\n\n    this._callOnDispose.add(editor.onDidChangeModelLanguage(function () {\n      return _this._update();\n    }));\n\n    this._callOnDispose.add(DocumentRangeFormattingEditProviderRegistry.onDidChange(this._update, this));\n  }\n\n  FormatOnPaste.prototype.dispose = function () {\n    this._callOnDispose.dispose();\n\n    this._callOnModel.dispose();\n  };\n\n  FormatOnPaste.prototype._update = function () {\n    var _this = this; // clean up\n\n\n    this._callOnModel.clear(); // we are disabled\n\n\n    if (!this.editor.getOption(38\n    /* formatOnPaste */\n    )) {\n      return;\n    } // no model\n\n\n    if (!this.editor.hasModel()) {\n      return;\n    } // no formatter\n\n\n    if (!DocumentRangeFormattingEditProviderRegistry.has(this.editor.getModel())) {\n      return;\n    }\n\n    this._callOnModel.add(this.editor.onDidPaste(function (_a) {\n      var range = _a.range;\n      return _this._trigger(range);\n    }));\n  };\n\n  FormatOnPaste.prototype._trigger = function (range) {\n    if (!this.editor.hasModel()) {\n      return;\n    }\n\n    if (this.editor.getSelections().length > 1) {\n      return;\n    }\n\n    this._instantiationService.invokeFunction(formatDocumentRangeWithSelectedProvider, this.editor, range, 2\n    /* Silent */\n    , CancellationToken.None).catch(onUnexpectedError);\n  };\n\n  FormatOnPaste.ID = 'editor.contrib.formatOnPaste';\n  FormatOnPaste = __decorate([__param(1, IInstantiationService)], FormatOnPaste);\n  return FormatOnPaste;\n}();\n\nvar FormatDocumentAction =\n/** @class */\nfunction (_super) {\n  __extends(FormatDocumentAction, _super);\n\n  function FormatDocumentAction() {\n    return _super.call(this, {\n      id: 'editor.action.formatDocument',\n      label: nls.localize('formatDocument.label', \"Format Document\"),\n      alias: 'Format Document',\n      precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasDocumentFormattingProvider),\n      kbOpts: {\n        kbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus, EditorContextKeys.hasDocumentFormattingProvider),\n        primary: 1024\n        /* Shift */\n        | 512\n        /* Alt */\n        | 36\n        /* KEY_F */\n        ,\n        linux: {\n          primary: 2048\n          /* CtrlCmd */\n          | 1024\n          /* Shift */\n          | 39\n          /* KEY_I */\n\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      contextMenuOpts: {\n        when: EditorContextKeys.hasDocumentFormattingProvider,\n        group: '1_modification',\n        order: 1.3\n      }\n    }) || this;\n  }\n\n  FormatDocumentAction.prototype.run = function (accessor, editor) {\n    return __awaiter(this, void 0, void 0, function () {\n      var instaService;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!editor.hasModel()) return [3\n            /*break*/\n            , 2];\n            instaService = accessor.get(IInstantiationService);\n            return [4\n            /*yield*/\n            , instaService.invokeFunction(formatDocumentWithSelectedProvider, editor, 1\n            /* Explicit */\n            , CancellationToken.None)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return FormatDocumentAction;\n}(EditorAction);\n\nvar FormatSelectionAction =\n/** @class */\nfunction (_super) {\n  __extends(FormatSelectionAction, _super);\n\n  function FormatSelectionAction() {\n    return _super.call(this, {\n      id: 'editor.action.formatSelection',\n      label: nls.localize('formatSelection.label', \"Format Selection\"),\n      alias: 'Format Selection',\n      precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasDocumentSelectionFormattingProvider),\n      kbOpts: {\n        kbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus, EditorContextKeys.hasDocumentSelectionFormattingProvider),\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 36\n        /* KEY_F */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      },\n      contextMenuOpts: {\n        when: ContextKeyExpr.and(EditorContextKeys.hasDocumentSelectionFormattingProvider, EditorContextKeys.hasNonEmptySelection),\n        group: '1_modification',\n        order: 1.31\n      }\n    }) || this;\n  }\n\n  FormatSelectionAction.prototype.run = function (accessor, editor) {\n    return __awaiter(this, void 0, void 0, function () {\n      var instaService, model, range;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!editor.hasModel()) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            instaService = accessor.get(IInstantiationService);\n            model = editor.getModel();\n            range = editor.getSelection();\n\n            if (range.isEmpty()) {\n              range = new Range(range.startLineNumber, 1, range.startLineNumber, model.getLineMaxColumn(range.startLineNumber));\n            }\n\n            return [4\n            /*yield*/\n            , instaService.invokeFunction(formatDocumentRangeWithSelectedProvider, editor, range, 1\n            /* Explicit */\n            , CancellationToken.None)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return FormatSelectionAction;\n}(EditorAction);\n\nregisterEditorContribution(FormatOnType.ID, FormatOnType);\nregisterEditorContribution(FormatOnPaste.ID, FormatOnPaste);\nregisterEditorAction(FormatDocumentAction);\nregisterEditorAction(FormatSelectionAction); // this is the old format action that does both (format document OR format selection)\n// and we keep it here such that existing keybinding configurations etc will still work\n\nCommandsRegistry.registerCommand('editor.action.format', function (accessor) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var editor, commandService;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          editor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\n          if (!editor || !editor.hasModel()) {\n            return [2\n            /*return*/\n            ];\n          }\n\n          commandService = accessor.get(ICommandService);\n          if (!editor.getSelection().isEmpty()) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , commandService.executeCommand('editor.action.formatDocument')];\n\n        case 1:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 4];\n\n        case 2:\n          return [4\n          /*yield*/\n          , commandService.executeCommand('editor.action.formatSelection')];\n\n        case 3:\n          _a.sent();\n\n          _a.label = 4;\n\n        case 4:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/format/formatActions.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","push","isNonEmptyArray","CancellationToken","KeyChord","DisposableStore","EditorAction","registerEditorAction","registerEditorContribution","ICodeEditorService","CharacterSet","Range","EditorContextKeys","DocumentRangeFormattingEditProviderRegistry","OnTypeFormattingEditProviderRegistry","IEditorWorkerService","getOnTypeFormattingEdits","alertFormattingEdits","formatDocumentRangeWithSelectedProvider","formatDocumentWithSelectedProvider","FormattingEdit","nls","CommandsRegistry","ICommandService","ContextKeyExpr","IInstantiationService","onUnexpectedError","FormatOnType","editor","_workerService","_this","_callOnDispose","_callOnModel","_editor","add","onDidChangeConfiguration","_update","onDidChangeModel","onDidChangeModelLanguage","onDidChange","dispose","clear","getOption","hasModel","model","getModel","support","ordered","autoFormatTriggerCharacters","triggerChars","_i","_a","ch","charCodeAt","onDidType","text","lastCharCode","has","_trigger","String","fromCharCode","getSelections","position","getPosition","canceled","unbind","onDidChangeModelContent","isFlush","len","changes","change","range","endLineNumber","lineNumber","getFormattingOptions","edits","execute","err","ID","FormatOnPaste","_instantiationService","onDidPaste","invokeFunction","None","catch","FormatDocumentAction","_super","id","localize","alias","precondition","and","writable","hasDocumentFormattingProvider","kbOpts","kbExpr","editorTextFocus","primary","linux","weight","contextMenuOpts","when","group","order","run","accessor","instaService","get","FormatSelectionAction","hasDocumentSelectionFormattingProvider","hasNonEmptySelection","getSelection","isEmpty","startLineNumber","getLineMaxColumn","registerCommand","commandService","getFocusedCodeEditor","executeCommand"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { KeyChord } from '../../../base/common/keyCodes.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\r\nimport { CharacterSet } from '../../common/core/characterClassifier.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { DocumentRangeFormattingEditProviderRegistry, OnTypeFormattingEditProviderRegistry } from '../../common/modes.js';\r\nimport { IEditorWorkerService } from '../../common/services/editorWorkerService.js';\r\nimport { getOnTypeFormattingEdits, alertFormattingEdits, formatDocumentRangeWithSelectedProvider, formatDocumentWithSelectedProvider } from './format.js';\r\nimport { FormattingEdit } from './formattingEdit.js';\r\nimport * as nls from '../../../nls.js';\r\nimport { CommandsRegistry, ICommandService } from '../../../platform/commands/common/commands.js';\r\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { onUnexpectedError } from '../../../base/common/errors.js';\r\nvar FormatOnType = /** @class */ (function () {\r\n    function FormatOnType(editor, _workerService) {\r\n        var _this = this;\r\n        this._workerService = _workerService;\r\n        this._callOnDispose = new DisposableStore();\r\n        this._callOnModel = new DisposableStore();\r\n        this._editor = editor;\r\n        this._callOnDispose.add(editor.onDidChangeConfiguration(function () { return _this._update(); }));\r\n        this._callOnDispose.add(editor.onDidChangeModel(function () { return _this._update(); }));\r\n        this._callOnDispose.add(editor.onDidChangeModelLanguage(function () { return _this._update(); }));\r\n        this._callOnDispose.add(OnTypeFormattingEditProviderRegistry.onDidChange(this._update, this));\r\n    }\r\n    FormatOnType.prototype.dispose = function () {\r\n        this._callOnDispose.dispose();\r\n        this._callOnModel.dispose();\r\n    };\r\n    FormatOnType.prototype._update = function () {\r\n        var _this = this;\r\n        // clean up\r\n        this._callOnModel.clear();\r\n        // we are disabled\r\n        if (!this._editor.getOption(39 /* formatOnType */)) {\r\n            return;\r\n        }\r\n        // no model\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        // no support\r\n        var support = OnTypeFormattingEditProviderRegistry.ordered(model)[0];\r\n        if (!support || !support.autoFormatTriggerCharacters) {\r\n            return;\r\n        }\r\n        // register typing listeners that will trigger the format\r\n        var triggerChars = new CharacterSet();\r\n        for (var _i = 0, _a = support.autoFormatTriggerCharacters; _i < _a.length; _i++) {\r\n            var ch = _a[_i];\r\n            triggerChars.add(ch.charCodeAt(0));\r\n        }\r\n        this._callOnModel.add(this._editor.onDidType(function (text) {\r\n            var lastCharCode = text.charCodeAt(text.length - 1);\r\n            if (triggerChars.has(lastCharCode)) {\r\n                _this._trigger(String.fromCharCode(lastCharCode));\r\n            }\r\n        }));\r\n    };\r\n    FormatOnType.prototype._trigger = function (ch) {\r\n        var _this = this;\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        if (this._editor.getSelections().length > 1) {\r\n            return;\r\n        }\r\n        var model = this._editor.getModel();\r\n        var position = this._editor.getPosition();\r\n        var canceled = false;\r\n        // install a listener that checks if edits happens before the\r\n        // position on which we format right now. If so, we won't\r\n        // apply the format edits\r\n        var unbind = this._editor.onDidChangeModelContent(function (e) {\r\n            if (e.isFlush) {\r\n                // a model.setValue() was called\r\n                // cancel only once\r\n                canceled = true;\r\n                unbind.dispose();\r\n                return;\r\n            }\r\n            for (var i = 0, len = e.changes.length; i < len; i++) {\r\n                var change = e.changes[i];\r\n                if (change.range.endLineNumber <= position.lineNumber) {\r\n                    // cancel only once\r\n                    canceled = true;\r\n                    unbind.dispose();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n        getOnTypeFormattingEdits(this._workerService, model, position, ch, model.getFormattingOptions()).then(function (edits) {\r\n            unbind.dispose();\r\n            if (canceled) {\r\n                return;\r\n            }\r\n            if (isNonEmptyArray(edits)) {\r\n                FormattingEdit.execute(_this._editor, edits);\r\n                alertFormattingEdits(edits);\r\n            }\r\n        }, function (err) {\r\n            unbind.dispose();\r\n            throw err;\r\n        });\r\n    };\r\n    FormatOnType.ID = 'editor.contrib.autoFormat';\r\n    FormatOnType = __decorate([\r\n        __param(1, IEditorWorkerService)\r\n    ], FormatOnType);\r\n    return FormatOnType;\r\n}());\r\nvar FormatOnPaste = /** @class */ (function () {\r\n    function FormatOnPaste(editor, _instantiationService) {\r\n        var _this = this;\r\n        this.editor = editor;\r\n        this._instantiationService = _instantiationService;\r\n        this._callOnDispose = new DisposableStore();\r\n        this._callOnModel = new DisposableStore();\r\n        this._callOnDispose.add(editor.onDidChangeConfiguration(function () { return _this._update(); }));\r\n        this._callOnDispose.add(editor.onDidChangeModel(function () { return _this._update(); }));\r\n        this._callOnDispose.add(editor.onDidChangeModelLanguage(function () { return _this._update(); }));\r\n        this._callOnDispose.add(DocumentRangeFormattingEditProviderRegistry.onDidChange(this._update, this));\r\n    }\r\n    FormatOnPaste.prototype.dispose = function () {\r\n        this._callOnDispose.dispose();\r\n        this._callOnModel.dispose();\r\n    };\r\n    FormatOnPaste.prototype._update = function () {\r\n        var _this = this;\r\n        // clean up\r\n        this._callOnModel.clear();\r\n        // we are disabled\r\n        if (!this.editor.getOption(38 /* formatOnPaste */)) {\r\n            return;\r\n        }\r\n        // no model\r\n        if (!this.editor.hasModel()) {\r\n            return;\r\n        }\r\n        // no formatter\r\n        if (!DocumentRangeFormattingEditProviderRegistry.has(this.editor.getModel())) {\r\n            return;\r\n        }\r\n        this._callOnModel.add(this.editor.onDidPaste(function (_a) {\r\n            var range = _a.range;\r\n            return _this._trigger(range);\r\n        }));\r\n    };\r\n    FormatOnPaste.prototype._trigger = function (range) {\r\n        if (!this.editor.hasModel()) {\r\n            return;\r\n        }\r\n        if (this.editor.getSelections().length > 1) {\r\n            return;\r\n        }\r\n        this._instantiationService.invokeFunction(formatDocumentRangeWithSelectedProvider, this.editor, range, 2 /* Silent */, CancellationToken.None).catch(onUnexpectedError);\r\n    };\r\n    FormatOnPaste.ID = 'editor.contrib.formatOnPaste';\r\n    FormatOnPaste = __decorate([\r\n        __param(1, IInstantiationService)\r\n    ], FormatOnPaste);\r\n    return FormatOnPaste;\r\n}());\r\nvar FormatDocumentAction = /** @class */ (function (_super) {\r\n    __extends(FormatDocumentAction, _super);\r\n    function FormatDocumentAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.formatDocument',\r\n            label: nls.localize('formatDocument.label', \"Format Document\"),\r\n            alias: 'Format Document',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasDocumentFormattingProvider),\r\n            kbOpts: {\r\n                kbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus, EditorContextKeys.hasDocumentFormattingProvider),\r\n                primary: 1024 /* Shift */ | 512 /* Alt */ | 36 /* KEY_F */,\r\n                linux: { primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 39 /* KEY_I */ },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            contextMenuOpts: {\r\n                when: EditorContextKeys.hasDocumentFormattingProvider,\r\n                group: '1_modification',\r\n                order: 1.3\r\n            }\r\n        }) || this;\r\n    }\r\n    FormatDocumentAction.prototype.run = function (accessor, editor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var instaService;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!editor.hasModel()) return [3 /*break*/, 2];\r\n                        instaService = accessor.get(IInstantiationService);\r\n                        return [4 /*yield*/, instaService.invokeFunction(formatDocumentWithSelectedProvider, editor, 1 /* Explicit */, CancellationToken.None)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return FormatDocumentAction;\r\n}(EditorAction));\r\nvar FormatSelectionAction = /** @class */ (function (_super) {\r\n    __extends(FormatSelectionAction, _super);\r\n    function FormatSelectionAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.formatSelection',\r\n            label: nls.localize('formatSelection.label', \"Format Selection\"),\r\n            alias: 'Format Selection',\r\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasDocumentSelectionFormattingProvider),\r\n            kbOpts: {\r\n                kbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus, EditorContextKeys.hasDocumentSelectionFormattingProvider),\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 36 /* KEY_F */),\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            contextMenuOpts: {\r\n                when: ContextKeyExpr.and(EditorContextKeys.hasDocumentSelectionFormattingProvider, EditorContextKeys.hasNonEmptySelection),\r\n                group: '1_modification',\r\n                order: 1.31\r\n            }\r\n        }) || this;\r\n    }\r\n    FormatSelectionAction.prototype.run = function (accessor, editor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var instaService, model, range;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!editor.hasModel()) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        instaService = accessor.get(IInstantiationService);\r\n                        model = editor.getModel();\r\n                        range = editor.getSelection();\r\n                        if (range.isEmpty()) {\r\n                            range = new Range(range.startLineNumber, 1, range.startLineNumber, model.getLineMaxColumn(range.startLineNumber));\r\n                        }\r\n                        return [4 /*yield*/, instaService.invokeFunction(formatDocumentRangeWithSelectedProvider, editor, range, 1 /* Explicit */, CancellationToken.None)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return FormatSelectionAction;\r\n}(EditorAction));\r\nregisterEditorContribution(FormatOnType.ID, FormatOnType);\r\nregisterEditorContribution(FormatOnPaste.ID, FormatOnPaste);\r\nregisterEditorAction(FormatDocumentAction);\r\nregisterEditorAction(FormatSelectionAction);\r\n// this is the old format action that does both (format document OR format selection)\r\n// and we keep it here such that existing keybinding configurations etc will still work\r\nCommandsRegistry.registerCommand('editor.action.format', function (accessor) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var editor, commandService;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                editor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\r\n                if (!editor || !editor.hasModel()) {\r\n                    return [2 /*return*/];\r\n                }\r\n                commandService = accessor.get(ICommandService);\r\n                if (!editor.getSelection().isEmpty()) return [3 /*break*/, 2];\r\n                return [4 /*yield*/, commandService.executeCommand('editor.action.formatDocument')];\r\n            case 1:\r\n                _a.sent();\r\n                return [3 /*break*/, 4];\r\n            case 2: return [4 /*yield*/, commandService.executeCommand('editor.action.formatSelection')];\r\n            case 3:\r\n                _a.sent();\r\n                _a.label = 4;\r\n            case 4: return [2 /*return*/];\r\n        }\r\n    });\r\n}); });\r\n"]},"metadata":{},"sourceType":"module"}