{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { RawContextKey, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\nimport { KeybindingsRegistry } from '../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { registerEditorCommand, EditorCommand } from '../../browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { Range } from '../../common/core/range.js';\nimport { dispose, combinedDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { localize } from '../../../nls.js';\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { isEqual } from '../../../base/common/resources.js';\nexport var ctxHasSymbols = new RawContextKey('hasSymbols', false);\nexport var ISymbolNavigationService = createDecorator('ISymbolNavigationService');\n\nvar SymbolNavigationService =\n/** @class */\nfunction () {\n  function SymbolNavigationService(contextKeyService, _editorService, _notificationService, _keybindingService) {\n    this._editorService = _editorService;\n    this._notificationService = _notificationService;\n    this._keybindingService = _keybindingService;\n    this._currentModel = undefined;\n    this._currentIdx = -1;\n    this._ignoreEditorChange = false;\n    this._ctxHasSymbols = ctxHasSymbols.bindTo(contextKeyService);\n  }\n\n  SymbolNavigationService.prototype.reset = function () {\n    this._ctxHasSymbols.reset();\n\n    dispose(this._currentState);\n    dispose(this._currentMessage);\n    this._currentModel = undefined;\n    this._currentIdx = -1;\n  };\n\n  SymbolNavigationService.prototype.put = function (anchor) {\n    var _this = this;\n\n    var refModel = anchor.parent.parent;\n\n    if (refModel.references.length <= 1) {\n      this.reset();\n      return;\n    }\n\n    this._currentModel = refModel;\n    this._currentIdx = refModel.references.indexOf(anchor);\n\n    this._ctxHasSymbols.set(true);\n\n    this._showMessage();\n\n    var editorState = new EditorState(this._editorService);\n    var listener = editorState.onDidChange(function (_) {\n      if (_this._ignoreEditorChange) {\n        return;\n      }\n\n      var editor = _this._editorService.getActiveCodeEditor();\n\n      if (!editor) {\n        return;\n      }\n\n      var model = editor.getModel();\n      var position = editor.getPosition();\n\n      if (!model || !position) {\n        return;\n      }\n\n      var seenUri = false;\n      var seenPosition = false;\n\n      for (var _i = 0, _a = refModel.references; _i < _a.length; _i++) {\n        var reference = _a[_i];\n\n        if (isEqual(reference.uri, model.uri)) {\n          seenUri = true;\n          seenPosition = seenPosition || Range.containsPosition(reference.range, position);\n        } else if (seenUri) {\n          break;\n        }\n      }\n\n      if (!seenUri || !seenPosition) {\n        _this.reset();\n      }\n    });\n    this._currentState = combinedDisposable(editorState, listener);\n  };\n\n  SymbolNavigationService.prototype.revealNext = function (source) {\n    var _this = this;\n\n    if (!this._currentModel) {\n      return Promise.resolve();\n    } // get next result and advance\n\n\n    this._currentIdx += 1;\n    this._currentIdx %= this._currentModel.references.length;\n    var reference = this._currentModel.references[this._currentIdx]; // status\n\n    this._showMessage(); // open editor, ignore events while that happens\n\n\n    this._ignoreEditorChange = true;\n    return this._editorService.openCodeEditor({\n      resource: reference.uri,\n      options: {\n        selection: Range.collapseToStart(reference.range),\n        revealInCenterIfOutsideViewport: true\n      }\n    }, source).finally(function () {\n      _this._ignoreEditorChange = false;\n    });\n  };\n\n  SymbolNavigationService.prototype._showMessage = function () {\n    dispose(this._currentMessage);\n\n    var kb = this._keybindingService.lookupKeybinding('editor.gotoNextSymbolFromResult');\n\n    var message = kb ? localize('location.kb', \"Symbol {0} of {1}, {2} for next\", this._currentIdx + 1, this._currentModel.references.length, kb.getLabel()) : localize('location', \"Symbol {0} of {1}\", this._currentIdx + 1, this._currentModel.references.length);\n    this._currentMessage = this._notificationService.status(message);\n  };\n\n  SymbolNavigationService = __decorate([__param(0, IContextKeyService), __param(1, ICodeEditorService), __param(2, INotificationService), __param(3, IKeybindingService)], SymbolNavigationService);\n  return SymbolNavigationService;\n}();\n\nregisterSingleton(ISymbolNavigationService, SymbolNavigationService, true);\nregisterEditorCommand(new (\n/** @class */\nfunction (_super) {\n  __extends(class_1, _super);\n\n  function class_1() {\n    return _super.call(this, {\n      id: 'editor.gotoNextSymbolFromResult',\n      precondition: ctxHasSymbols,\n      kbOpts: {\n        weight: 100\n        /* EditorContrib */\n        ,\n        primary: 70\n        /* F12 */\n\n      }\n    }) || this;\n  }\n\n  class_1.prototype.runEditorCommand = function (accessor, editor) {\n    return accessor.get(ISymbolNavigationService).revealNext(editor);\n  };\n\n  return class_1;\n}(EditorCommand))());\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n  id: 'editor.gotoNextSymbolFromResult.cancel',\n  weight: 100\n  /* EditorContrib */\n  ,\n  when: ctxHasSymbols,\n  primary: 9\n  /* Escape */\n  ,\n  handler: function (accessor) {\n    accessor.get(ISymbolNavigationService).reset();\n  }\n}); //\n\nvar EditorState =\n/** @class */\nfunction () {\n  function EditorState(editorService) {\n    this._listener = new Map();\n    this._disposables = new DisposableStore();\n    this._onDidChange = new Emitter();\n    this.onDidChange = this._onDidChange.event;\n\n    this._disposables.add(editorService.onCodeEditorRemove(this._onDidRemoveEditor, this));\n\n    this._disposables.add(editorService.onCodeEditorAdd(this._onDidAddEditor, this));\n\n    editorService.listCodeEditors().forEach(this._onDidAddEditor, this);\n  }\n\n  EditorState.prototype.dispose = function () {\n    this._disposables.dispose();\n\n    this._onDidChange.dispose();\n\n    this._listener.forEach(dispose);\n  };\n\n  EditorState.prototype._onDidAddEditor = function (editor) {\n    var _this = this;\n\n    this._listener.set(editor, combinedDisposable(editor.onDidChangeCursorPosition(function (_) {\n      return _this._onDidChange.fire({\n        editor: editor\n      });\n    }), editor.onDidChangeModelContent(function (_) {\n      return _this._onDidChange.fire({\n        editor: editor\n      });\n    })));\n  };\n\n  EditorState.prototype._onDidRemoveEditor = function (editor) {\n    dispose(this._listener.get(editor));\n\n    this._listener.delete(editor);\n  };\n\n  EditorState = __decorate([__param(0, ICodeEditorService)], EditorState);\n  return EditorState;\n}();","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/gotoSymbol/symbolNavigation.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","RawContextKey","IContextKeyService","createDecorator","registerSingleton","KeybindingsRegistry","registerEditorCommand","EditorCommand","ICodeEditorService","Range","dispose","combinedDisposable","DisposableStore","Emitter","localize","IKeybindingService","INotificationService","isEqual","ctxHasSymbols","ISymbolNavigationService","SymbolNavigationService","contextKeyService","_editorService","_notificationService","_keybindingService","_currentModel","undefined","_currentIdx","_ignoreEditorChange","_ctxHasSymbols","bindTo","reset","_currentState","_currentMessage","put","anchor","_this","refModel","parent","references","indexOf","set","_showMessage","editorState","EditorState","listener","onDidChange","_","editor","getActiveCodeEditor","model","getModel","position","getPosition","seenUri","seenPosition","_i","_a","reference","uri","containsPosition","range","revealNext","source","Promise","resolve","openCodeEditor","resource","options","selection","collapseToStart","revealInCenterIfOutsideViewport","finally","kb","lookupKeybinding","message","getLabel","status","_super","class_1","call","id","precondition","kbOpts","weight","primary","runEditorCommand","accessor","get","registerCommandAndKeybindingRule","when","handler","editorService","_listener","Map","_disposables","_onDidChange","event","add","onCodeEditorRemove","_onDidRemoveEditor","onCodeEditorAdd","_onDidAddEditor","listCodeEditors","forEach","onDidChangeCursorPosition","fire","onDidChangeModelContent","delete"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { RawContextKey, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\r\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\r\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\r\nimport { KeybindingsRegistry } from '../../../platform/keybinding/common/keybindingsRegistry.js';\r\nimport { registerEditorCommand, EditorCommand } from '../../browser/editorExtensions.js';\r\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { dispose, combinedDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { localize } from '../../../nls.js';\r\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\r\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\r\nimport { isEqual } from '../../../base/common/resources.js';\r\nexport var ctxHasSymbols = new RawContextKey('hasSymbols', false);\r\nexport var ISymbolNavigationService = createDecorator('ISymbolNavigationService');\r\nvar SymbolNavigationService = /** @class */ (function () {\r\n    function SymbolNavigationService(contextKeyService, _editorService, _notificationService, _keybindingService) {\r\n        this._editorService = _editorService;\r\n        this._notificationService = _notificationService;\r\n        this._keybindingService = _keybindingService;\r\n        this._currentModel = undefined;\r\n        this._currentIdx = -1;\r\n        this._ignoreEditorChange = false;\r\n        this._ctxHasSymbols = ctxHasSymbols.bindTo(contextKeyService);\r\n    }\r\n    SymbolNavigationService.prototype.reset = function () {\r\n        this._ctxHasSymbols.reset();\r\n        dispose(this._currentState);\r\n        dispose(this._currentMessage);\r\n        this._currentModel = undefined;\r\n        this._currentIdx = -1;\r\n    };\r\n    SymbolNavigationService.prototype.put = function (anchor) {\r\n        var _this = this;\r\n        var refModel = anchor.parent.parent;\r\n        if (refModel.references.length <= 1) {\r\n            this.reset();\r\n            return;\r\n        }\r\n        this._currentModel = refModel;\r\n        this._currentIdx = refModel.references.indexOf(anchor);\r\n        this._ctxHasSymbols.set(true);\r\n        this._showMessage();\r\n        var editorState = new EditorState(this._editorService);\r\n        var listener = editorState.onDidChange(function (_) {\r\n            if (_this._ignoreEditorChange) {\r\n                return;\r\n            }\r\n            var editor = _this._editorService.getActiveCodeEditor();\r\n            if (!editor) {\r\n                return;\r\n            }\r\n            var model = editor.getModel();\r\n            var position = editor.getPosition();\r\n            if (!model || !position) {\r\n                return;\r\n            }\r\n            var seenUri = false;\r\n            var seenPosition = false;\r\n            for (var _i = 0, _a = refModel.references; _i < _a.length; _i++) {\r\n                var reference = _a[_i];\r\n                if (isEqual(reference.uri, model.uri)) {\r\n                    seenUri = true;\r\n                    seenPosition = seenPosition || Range.containsPosition(reference.range, position);\r\n                }\r\n                else if (seenUri) {\r\n                    break;\r\n                }\r\n            }\r\n            if (!seenUri || !seenPosition) {\r\n                _this.reset();\r\n            }\r\n        });\r\n        this._currentState = combinedDisposable(editorState, listener);\r\n    };\r\n    SymbolNavigationService.prototype.revealNext = function (source) {\r\n        var _this = this;\r\n        if (!this._currentModel) {\r\n            return Promise.resolve();\r\n        }\r\n        // get next result and advance\r\n        this._currentIdx += 1;\r\n        this._currentIdx %= this._currentModel.references.length;\r\n        var reference = this._currentModel.references[this._currentIdx];\r\n        // status\r\n        this._showMessage();\r\n        // open editor, ignore events while that happens\r\n        this._ignoreEditorChange = true;\r\n        return this._editorService.openCodeEditor({\r\n            resource: reference.uri,\r\n            options: {\r\n                selection: Range.collapseToStart(reference.range),\r\n                revealInCenterIfOutsideViewport: true\r\n            }\r\n        }, source).finally(function () {\r\n            _this._ignoreEditorChange = false;\r\n        });\r\n    };\r\n    SymbolNavigationService.prototype._showMessage = function () {\r\n        dispose(this._currentMessage);\r\n        var kb = this._keybindingService.lookupKeybinding('editor.gotoNextSymbolFromResult');\r\n        var message = kb\r\n            ? localize('location.kb', \"Symbol {0} of {1}, {2} for next\", this._currentIdx + 1, this._currentModel.references.length, kb.getLabel())\r\n            : localize('location', \"Symbol {0} of {1}\", this._currentIdx + 1, this._currentModel.references.length);\r\n        this._currentMessage = this._notificationService.status(message);\r\n    };\r\n    SymbolNavigationService = __decorate([\r\n        __param(0, IContextKeyService),\r\n        __param(1, ICodeEditorService),\r\n        __param(2, INotificationService),\r\n        __param(3, IKeybindingService)\r\n    ], SymbolNavigationService);\r\n    return SymbolNavigationService;\r\n}());\r\nregisterSingleton(ISymbolNavigationService, SymbolNavigationService, true);\r\nregisterEditorCommand(new /** @class */ (function (_super) {\r\n    __extends(class_1, _super);\r\n    function class_1() {\r\n        return _super.call(this, {\r\n            id: 'editor.gotoNextSymbolFromResult',\r\n            precondition: ctxHasSymbols,\r\n            kbOpts: {\r\n                weight: 100 /* EditorContrib */,\r\n                primary: 70 /* F12 */\r\n            }\r\n        }) || this;\r\n    }\r\n    class_1.prototype.runEditorCommand = function (accessor, editor) {\r\n        return accessor.get(ISymbolNavigationService).revealNext(editor);\r\n    };\r\n    return class_1;\r\n}(EditorCommand)));\r\nKeybindingsRegistry.registerCommandAndKeybindingRule({\r\n    id: 'editor.gotoNextSymbolFromResult.cancel',\r\n    weight: 100 /* EditorContrib */,\r\n    when: ctxHasSymbols,\r\n    primary: 9 /* Escape */,\r\n    handler: function (accessor) {\r\n        accessor.get(ISymbolNavigationService).reset();\r\n    }\r\n});\r\n//\r\nvar EditorState = /** @class */ (function () {\r\n    function EditorState(editorService) {\r\n        this._listener = new Map();\r\n        this._disposables = new DisposableStore();\r\n        this._onDidChange = new Emitter();\r\n        this.onDidChange = this._onDidChange.event;\r\n        this._disposables.add(editorService.onCodeEditorRemove(this._onDidRemoveEditor, this));\r\n        this._disposables.add(editorService.onCodeEditorAdd(this._onDidAddEditor, this));\r\n        editorService.listCodeEditors().forEach(this._onDidAddEditor, this);\r\n    }\r\n    EditorState.prototype.dispose = function () {\r\n        this._disposables.dispose();\r\n        this._onDidChange.dispose();\r\n        this._listener.forEach(dispose);\r\n    };\r\n    EditorState.prototype._onDidAddEditor = function (editor) {\r\n        var _this = this;\r\n        this._listener.set(editor, combinedDisposable(editor.onDidChangeCursorPosition(function (_) { return _this._onDidChange.fire({ editor: editor }); }), editor.onDidChangeModelContent(function (_) { return _this._onDidChange.fire({ editor: editor }); })));\r\n    };\r\n    EditorState.prototype._onDidRemoveEditor = function (editor) {\r\n        dispose(this._listener.get(editor));\r\n        this._listener.delete(editor);\r\n    };\r\n    EditorState = __decorate([\r\n        __param(0, ICodeEditorService)\r\n    ], EditorState);\r\n    return EditorState;\r\n}());\r\n"]},"metadata":{},"sourceType":"module"}