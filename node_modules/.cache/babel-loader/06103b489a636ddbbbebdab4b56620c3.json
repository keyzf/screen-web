{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport { mergeSort } from '../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { illegalArgument, onUnexpectedExternalError } from '../../../base/common/errors.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\nimport { CodeLensProviderRegistry } from '../../common/modes.js';\nimport { IModelService } from '../../common/services/modelService.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\n\nvar CodeLensModel =\n/** @class */\nfunction () {\n  function CodeLensModel() {\n    this.lenses = [];\n    this._disposables = new DisposableStore();\n  }\n\n  CodeLensModel.prototype.dispose = function () {\n    this._disposables.dispose();\n  };\n\n  CodeLensModel.prototype.add = function (list, provider) {\n    this._disposables.add(list);\n\n    for (var _i = 0, _a = list.lenses; _i < _a.length; _i++) {\n      var symbol = _a[_i];\n      this.lenses.push({\n        symbol: symbol,\n        provider: provider\n      });\n    }\n  };\n\n  return CodeLensModel;\n}();\n\nexport { CodeLensModel };\nexport function getCodeLensData(model, token) {\n  var provider = CodeLensProviderRegistry.ordered(model);\n  var providerRanks = new Map();\n  var result = new CodeLensModel();\n  var promises = provider.map(function (provider, i) {\n    providerRanks.set(provider, i);\n    return Promise.resolve(provider.provideCodeLenses(model, token)).then(function (list) {\n      return list && result.add(list, provider);\n    }).catch(onUnexpectedExternalError);\n  });\n  return Promise.all(promises).then(function () {\n    result.lenses = mergeSort(result.lenses, function (a, b) {\n      // sort by lineNumber, provider-rank, and column\n      if (a.symbol.range.startLineNumber < b.symbol.range.startLineNumber) {\n        return -1;\n      } else if (a.symbol.range.startLineNumber > b.symbol.range.startLineNumber) {\n        return 1;\n      } else if (providerRanks.get(a.provider) < providerRanks.get(b.provider)) {\n        return -1;\n      } else if (providerRanks.get(a.provider) > providerRanks.get(b.provider)) {\n        return 1;\n      } else if (a.symbol.range.startColumn < b.symbol.range.startColumn) {\n        return -1;\n      } else if (a.symbol.range.startColumn > b.symbol.range.startColumn) {\n        return 1;\n      } else {\n        return 0;\n      }\n    });\n    return result;\n  });\n}\nregisterLanguageCommand('_executeCodeLensProvider', function (accessor, args) {\n  var resource = args.resource,\n      itemResolveCount = args.itemResolveCount;\n\n  if (!(resource instanceof URI)) {\n    throw illegalArgument();\n  }\n\n  var model = accessor.get(IModelService).getModel(resource);\n\n  if (!model) {\n    throw illegalArgument();\n  }\n\n  var result = [];\n  var disposables = new DisposableStore();\n  return getCodeLensData(model, CancellationToken.None).then(function (value) {\n    disposables.add(value);\n    var resolve = [];\n\n    var _loop_1 = function (item) {\n      if (typeof itemResolveCount === 'undefined' || Boolean(item.symbol.command)) {\n        result.push(item.symbol);\n      } else if (itemResolveCount-- > 0 && item.provider.resolveCodeLens) {\n        resolve.push(Promise.resolve(item.provider.resolveCodeLens(model, item.symbol, CancellationToken.None)).then(function (symbol) {\n          return result.push(symbol || item.symbol);\n        }));\n      }\n    };\n\n    for (var _i = 0, _a = value.lenses; _i < _a.length; _i++) {\n      var item = _a[_i];\n\n      _loop_1(item);\n    }\n\n    return Promise.all(resolve);\n  }).then(function () {\n    return result;\n  }).finally(function () {\n    // make sure to return results, then (on next tick)\n    // dispose the results\n    setTimeout(function () {\n      return disposables.dispose();\n    }, 100);\n  });\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/codelens/codelens.js"],"names":["mergeSort","CancellationToken","illegalArgument","onUnexpectedExternalError","URI","registerLanguageCommand","CodeLensProviderRegistry","IModelService","DisposableStore","CodeLensModel","lenses","_disposables","prototype","dispose","add","list","provider","_i","_a","length","symbol","push","getCodeLensData","model","token","ordered","providerRanks","Map","result","promises","map","i","set","Promise","resolve","provideCodeLenses","then","catch","all","a","b","range","startLineNumber","get","startColumn","accessor","args","resource","itemResolveCount","getModel","disposables","None","value","_loop_1","item","Boolean","command","resolveCodeLens","finally","setTimeout"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { mergeSort } from '../../../base/common/arrays.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { illegalArgument, onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nimport { URI } from '../../../base/common/uri.js';\r\nimport { registerLanguageCommand } from '../../browser/editorExtensions.js';\r\nimport { CodeLensProviderRegistry } from '../../common/modes.js';\r\nimport { IModelService } from '../../common/services/modelService.js';\r\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\r\nvar CodeLensModel = /** @class */ (function () {\r\n    function CodeLensModel() {\r\n        this.lenses = [];\r\n        this._disposables = new DisposableStore();\r\n    }\r\n    CodeLensModel.prototype.dispose = function () {\r\n        this._disposables.dispose();\r\n    };\r\n    CodeLensModel.prototype.add = function (list, provider) {\r\n        this._disposables.add(list);\r\n        for (var _i = 0, _a = list.lenses; _i < _a.length; _i++) {\r\n            var symbol = _a[_i];\r\n            this.lenses.push({ symbol: symbol, provider: provider });\r\n        }\r\n    };\r\n    return CodeLensModel;\r\n}());\r\nexport { CodeLensModel };\r\nexport function getCodeLensData(model, token) {\r\n    var provider = CodeLensProviderRegistry.ordered(model);\r\n    var providerRanks = new Map();\r\n    var result = new CodeLensModel();\r\n    var promises = provider.map(function (provider, i) {\r\n        providerRanks.set(provider, i);\r\n        return Promise.resolve(provider.provideCodeLenses(model, token))\r\n            .then(function (list) { return list && result.add(list, provider); })\r\n            .catch(onUnexpectedExternalError);\r\n    });\r\n    return Promise.all(promises).then(function () {\r\n        result.lenses = mergeSort(result.lenses, function (a, b) {\r\n            // sort by lineNumber, provider-rank, and column\r\n            if (a.symbol.range.startLineNumber < b.symbol.range.startLineNumber) {\r\n                return -1;\r\n            }\r\n            else if (a.symbol.range.startLineNumber > b.symbol.range.startLineNumber) {\r\n                return 1;\r\n            }\r\n            else if (providerRanks.get(a.provider) < providerRanks.get(b.provider)) {\r\n                return -1;\r\n            }\r\n            else if (providerRanks.get(a.provider) > providerRanks.get(b.provider)) {\r\n                return 1;\r\n            }\r\n            else if (a.symbol.range.startColumn < b.symbol.range.startColumn) {\r\n                return -1;\r\n            }\r\n            else if (a.symbol.range.startColumn > b.symbol.range.startColumn) {\r\n                return 1;\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        });\r\n        return result;\r\n    });\r\n}\r\nregisterLanguageCommand('_executeCodeLensProvider', function (accessor, args) {\r\n    var resource = args.resource, itemResolveCount = args.itemResolveCount;\r\n    if (!(resource instanceof URI)) {\r\n        throw illegalArgument();\r\n    }\r\n    var model = accessor.get(IModelService).getModel(resource);\r\n    if (!model) {\r\n        throw illegalArgument();\r\n    }\r\n    var result = [];\r\n    var disposables = new DisposableStore();\r\n    return getCodeLensData(model, CancellationToken.None).then(function (value) {\r\n        disposables.add(value);\r\n        var resolve = [];\r\n        var _loop_1 = function (item) {\r\n            if (typeof itemResolveCount === 'undefined' || Boolean(item.symbol.command)) {\r\n                result.push(item.symbol);\r\n            }\r\n            else if (itemResolveCount-- > 0 && item.provider.resolveCodeLens) {\r\n                resolve.push(Promise.resolve(item.provider.resolveCodeLens(model, item.symbol, CancellationToken.None)).then(function (symbol) { return result.push(symbol || item.symbol); }));\r\n            }\r\n        };\r\n        for (var _i = 0, _a = value.lenses; _i < _a.length; _i++) {\r\n            var item = _a[_i];\r\n            _loop_1(item);\r\n        }\r\n        return Promise.all(resolve);\r\n    }).then(function () {\r\n        return result;\r\n    }).finally(function () {\r\n        // make sure to return results, then (on next tick)\r\n        // dispose the results\r\n        setTimeout(function () { return disposables.dispose(); }, 100);\r\n    });\r\n});\r\n"]},"metadata":{},"sourceType":"module"}