{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport * as arrays from '../common/arrays.js';\nimport { Disposable } from '../common/lifecycle.js';\nimport * as DomUtils from './dom.js';\nimport { memoize } from '../common/decorators.js';\nexport var EventType;\n\n(function (EventType) {\n  EventType.Tap = '-monaco-gesturetap';\n  EventType.Change = '-monaco-gesturechange';\n  EventType.Start = '-monaco-gesturestart';\n  EventType.End = '-monaco-gesturesend';\n  EventType.Contextmenu = '-monaco-gesturecontextmenu';\n})(EventType || (EventType = {}));\n\nvar Gesture =\n/** @class */\nfunction (_super) {\n  __extends(Gesture, _super);\n\n  function Gesture() {\n    var _this = _super.call(this) || this;\n\n    _this.dispatched = false;\n    _this.activeTouches = {};\n    _this.handle = null;\n    _this.targets = [];\n    _this.ignoreTargets = [];\n    _this._lastSetTapCountTime = 0;\n\n    _this._register(DomUtils.addDisposableListener(document, 'touchstart', function (e) {\n      return _this.onTouchStart(e);\n    }));\n\n    _this._register(DomUtils.addDisposableListener(document, 'touchend', function (e) {\n      return _this.onTouchEnd(e);\n    }));\n\n    _this._register(DomUtils.addDisposableListener(document, 'touchmove', function (e) {\n      return _this.onTouchMove(e);\n    }));\n\n    return _this;\n  }\n\n  Gesture.addTarget = function (element) {\n    if (!Gesture.isTouchDevice()) {\n      return Disposable.None;\n    }\n\n    if (!Gesture.INSTANCE) {\n      Gesture.INSTANCE = new Gesture();\n    }\n\n    Gesture.INSTANCE.targets.push(element);\n    return {\n      dispose: function () {\n        Gesture.INSTANCE.targets = Gesture.INSTANCE.targets.filter(function (t) {\n          return t !== element;\n        });\n      }\n    };\n  };\n\n  Gesture.ignoreTarget = function (element) {\n    if (!Gesture.isTouchDevice()) {\n      return Disposable.None;\n    }\n\n    if (!Gesture.INSTANCE) {\n      Gesture.INSTANCE = new Gesture();\n    }\n\n    Gesture.INSTANCE.ignoreTargets.push(element);\n    return {\n      dispose: function () {\n        Gesture.INSTANCE.ignoreTargets = Gesture.INSTANCE.ignoreTargets.filter(function (t) {\n          return t !== element;\n        });\n      }\n    };\n  };\n\n  Gesture.isTouchDevice = function () {\n    return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0;\n  };\n\n  Gesture.prototype.dispose = function () {\n    if (this.handle) {\n      this.handle.dispose();\n      this.handle = null;\n    }\n\n    _super.prototype.dispose.call(this);\n  };\n\n  Gesture.prototype.onTouchStart = function (e) {\n    var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\n\n    if (this.handle) {\n      this.handle.dispose();\n      this.handle = null;\n    }\n\n    for (var i = 0, len = e.targetTouches.length; i < len; i++) {\n      var touch = e.targetTouches.item(i);\n      this.activeTouches[touch.identifier] = {\n        id: touch.identifier,\n        initialTarget: touch.target,\n        initialTimeStamp: timestamp,\n        initialPageX: touch.pageX,\n        initialPageY: touch.pageY,\n        rollingTimestamps: [timestamp],\n        rollingPageX: [touch.pageX],\n        rollingPageY: [touch.pageY]\n      };\n      var evt = this.newGestureEvent(EventType.Start, touch.target);\n      evt.pageX = touch.pageX;\n      evt.pageY = touch.pageY;\n      this.dispatchEvent(evt);\n    }\n\n    if (this.dispatched) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.dispatched = false;\n    }\n  };\n\n  Gesture.prototype.onTouchEnd = function (e) {\n    var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\n\n    var activeTouchCount = Object.keys(this.activeTouches).length;\n\n    var _loop_1 = function (i, len) {\n      var touch = e.changedTouches.item(i);\n\n      if (!this_1.activeTouches.hasOwnProperty(String(touch.identifier))) {\n        console.warn('move of an UNKNOWN touch', touch);\n        return \"continue\";\n      }\n\n      var data = this_1.activeTouches[touch.identifier],\n          holdTime = Date.now() - data.initialTimeStamp;\n\n      if (holdTime < Gesture.HOLD_DELAY && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30 && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\n        var evt = this_1.newGestureEvent(EventType.Tap, data.initialTarget);\n        evt.pageX = arrays.tail(data.rollingPageX);\n        evt.pageY = arrays.tail(data.rollingPageY);\n        this_1.dispatchEvent(evt);\n      } else if (holdTime >= Gesture.HOLD_DELAY && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30 && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\n        var evt = this_1.newGestureEvent(EventType.Contextmenu, data.initialTarget);\n        evt.pageX = arrays.tail(data.rollingPageX);\n        evt.pageY = arrays.tail(data.rollingPageY);\n        this_1.dispatchEvent(evt);\n      } else if (activeTouchCount === 1) {\n        var finalX = arrays.tail(data.rollingPageX);\n        var finalY = arrays.tail(data.rollingPageY);\n        var deltaT = arrays.tail(data.rollingTimestamps) - data.rollingTimestamps[0];\n        var deltaX = finalX - data.rollingPageX[0];\n        var deltaY = finalY - data.rollingPageY[0]; // We need to get all the dispatch targets on the start of the inertia event\n\n        var dispatchTo = this_1.targets.filter(function (t) {\n          return data.initialTarget instanceof Node && t.contains(data.initialTarget);\n        });\n        this_1.inertia(dispatchTo, timestamp, // time now\n        Math.abs(deltaX) / deltaT, // speed\n        deltaX > 0 ? 1 : -1, // x direction\n        finalX, // x now\n        Math.abs(deltaY) / deltaT, // y speed\n        deltaY > 0 ? 1 : -1, // y direction\n        finalY // y now\n        );\n      }\n\n      this_1.dispatchEvent(this_1.newGestureEvent(EventType.End, data.initialTarget)); // forget about this touch\n\n      delete this_1.activeTouches[touch.identifier];\n    };\n\n    var this_1 = this;\n\n    for (var i = 0, len = e.changedTouches.length; i < len; i++) {\n      _loop_1(i, len);\n    }\n\n    if (this.dispatched) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.dispatched = false;\n    }\n  };\n\n  Gesture.prototype.newGestureEvent = function (type, initialTarget) {\n    var event = document.createEvent('CustomEvent');\n    event.initEvent(type, false, true);\n    event.initialTarget = initialTarget;\n    event.tapCount = 0;\n    return event;\n  };\n\n  Gesture.prototype.dispatchEvent = function (event) {\n    var _this = this;\n\n    if (event.type === EventType.Tap) {\n      var currentTime = new Date().getTime();\n      var setTapCount = 0;\n\n      if (currentTime - this._lastSetTapCountTime > Gesture.CLEAR_TAP_COUNT_TIME) {\n        setTapCount = 1;\n      } else {\n        setTapCount = 2;\n      }\n\n      this._lastSetTapCountTime = currentTime;\n      event.tapCount = setTapCount;\n    } else if (event.type === EventType.Change || event.type === EventType.Contextmenu) {\n      // tap is canceled by scrolling or context menu\n      this._lastSetTapCountTime = 0;\n    }\n\n    for (var i = 0; i < this.ignoreTargets.length; i++) {\n      if (event.initialTarget instanceof Node && this.ignoreTargets[i].contains(event.initialTarget)) {\n        return;\n      }\n    }\n\n    this.targets.forEach(function (target) {\n      if (event.initialTarget instanceof Node && target.contains(event.initialTarget)) {\n        target.dispatchEvent(event);\n        _this.dispatched = true;\n      }\n    });\n  };\n\n  Gesture.prototype.inertia = function (dispatchTo, t1, vX, dirX, x, vY, dirY, y) {\n    var _this = this;\n\n    this.handle = DomUtils.scheduleAtNextAnimationFrame(function () {\n      var now = Date.now(); // velocity: old speed + accel_over_time\n\n      var deltaT = now - t1,\n          delta_pos_x = 0,\n          delta_pos_y = 0,\n          stopped = true;\n      vX += Gesture.SCROLL_FRICTION * deltaT;\n      vY += Gesture.SCROLL_FRICTION * deltaT;\n\n      if (vX > 0) {\n        stopped = false;\n        delta_pos_x = dirX * vX * deltaT;\n      }\n\n      if (vY > 0) {\n        stopped = false;\n        delta_pos_y = dirY * vY * deltaT;\n      } // dispatch translation event\n\n\n      var evt = _this.newGestureEvent(EventType.Change);\n\n      evt.translationX = delta_pos_x;\n      evt.translationY = delta_pos_y;\n      dispatchTo.forEach(function (d) {\n        return d.dispatchEvent(evt);\n      });\n\n      if (!stopped) {\n        _this.inertia(dispatchTo, now, vX, dirX, x + delta_pos_x, vY, dirY, y + delta_pos_y);\n      }\n    });\n  };\n\n  Gesture.prototype.onTouchMove = function (e) {\n    var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\n\n    for (var i = 0, len = e.changedTouches.length; i < len; i++) {\n      var touch = e.changedTouches.item(i);\n\n      if (!this.activeTouches.hasOwnProperty(String(touch.identifier))) {\n        console.warn('end of an UNKNOWN touch', touch);\n        continue;\n      }\n\n      var data = this.activeTouches[touch.identifier];\n      var evt = this.newGestureEvent(EventType.Change, data.initialTarget);\n      evt.translationX = touch.pageX - arrays.tail(data.rollingPageX);\n      evt.translationY = touch.pageY - arrays.tail(data.rollingPageY);\n      evt.pageX = touch.pageX;\n      evt.pageY = touch.pageY;\n      this.dispatchEvent(evt); // only keep a few data points, to average the final speed\n\n      if (data.rollingPageX.length > 3) {\n        data.rollingPageX.shift();\n        data.rollingPageY.shift();\n        data.rollingTimestamps.shift();\n      }\n\n      data.rollingPageX.push(touch.pageX);\n      data.rollingPageY.push(touch.pageY);\n      data.rollingTimestamps.push(timestamp);\n    }\n\n    if (this.dispatched) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.dispatched = false;\n    }\n  };\n\n  Gesture.SCROLL_FRICTION = -0.005;\n  Gesture.HOLD_DELAY = 700;\n  Gesture.CLEAR_TAP_COUNT_TIME = 400; // ms\n\n  __decorate([memoize], Gesture, \"isTouchDevice\", null);\n\n  return Gesture;\n}(Disposable);\n\nexport { Gesture };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/touch.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","arrays","Disposable","DomUtils","memoize","EventType","Tap","Change","Start","End","Contextmenu","Gesture","_super","_this","call","dispatched","activeTouches","handle","targets","ignoreTargets","_lastSetTapCountTime","_register","addDisposableListener","document","e","onTouchStart","onTouchEnd","onTouchMove","addTarget","element","isTouchDevice","None","INSTANCE","push","dispose","filter","t","ignoreTarget","window","navigator","maxTouchPoints","msMaxTouchPoints","timestamp","Date","now","len","targetTouches","touch","item","identifier","id","initialTarget","initialTimeStamp","initialPageX","pageX","initialPageY","pageY","rollingTimestamps","rollingPageX","rollingPageY","evt","newGestureEvent","dispatchEvent","preventDefault","stopPropagation","activeTouchCount","keys","_loop_1","changedTouches","this_1","String","console","warn","data","holdTime","HOLD_DELAY","Math","abs","tail","finalX","finalY","deltaT","deltaX","deltaY","dispatchTo","Node","contains","inertia","type","event","createEvent","initEvent","tapCount","currentTime","getTime","setTapCount","CLEAR_TAP_COUNT_TIME","forEach","t1","vX","dirX","x","vY","dirY","y","scheduleAtNextAnimationFrame","delta_pos_x","delta_pos_y","stopped","SCROLL_FRICTION","translationX","translationY","shift"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport * as arrays from '../common/arrays.js';\r\nimport { Disposable } from '../common/lifecycle.js';\r\nimport * as DomUtils from './dom.js';\r\nimport { memoize } from '../common/decorators.js';\r\nexport var EventType;\r\n(function (EventType) {\r\n    EventType.Tap = '-monaco-gesturetap';\r\n    EventType.Change = '-monaco-gesturechange';\r\n    EventType.Start = '-monaco-gesturestart';\r\n    EventType.End = '-monaco-gesturesend';\r\n    EventType.Contextmenu = '-monaco-gesturecontextmenu';\r\n})(EventType || (EventType = {}));\r\nvar Gesture = /** @class */ (function (_super) {\r\n    __extends(Gesture, _super);\r\n    function Gesture() {\r\n        var _this = _super.call(this) || this;\r\n        _this.dispatched = false;\r\n        _this.activeTouches = {};\r\n        _this.handle = null;\r\n        _this.targets = [];\r\n        _this.ignoreTargets = [];\r\n        _this._lastSetTapCountTime = 0;\r\n        _this._register(DomUtils.addDisposableListener(document, 'touchstart', function (e) { return _this.onTouchStart(e); }));\r\n        _this._register(DomUtils.addDisposableListener(document, 'touchend', function (e) { return _this.onTouchEnd(e); }));\r\n        _this._register(DomUtils.addDisposableListener(document, 'touchmove', function (e) { return _this.onTouchMove(e); }));\r\n        return _this;\r\n    }\r\n    Gesture.addTarget = function (element) {\r\n        if (!Gesture.isTouchDevice()) {\r\n            return Disposable.None;\r\n        }\r\n        if (!Gesture.INSTANCE) {\r\n            Gesture.INSTANCE = new Gesture();\r\n        }\r\n        Gesture.INSTANCE.targets.push(element);\r\n        return {\r\n            dispose: function () {\r\n                Gesture.INSTANCE.targets = Gesture.INSTANCE.targets.filter(function (t) { return t !== element; });\r\n            }\r\n        };\r\n    };\r\n    Gesture.ignoreTarget = function (element) {\r\n        if (!Gesture.isTouchDevice()) {\r\n            return Disposable.None;\r\n        }\r\n        if (!Gesture.INSTANCE) {\r\n            Gesture.INSTANCE = new Gesture();\r\n        }\r\n        Gesture.INSTANCE.ignoreTargets.push(element);\r\n        return {\r\n            dispose: function () {\r\n                Gesture.INSTANCE.ignoreTargets = Gesture.INSTANCE.ignoreTargets.filter(function (t) { return t !== element; });\r\n            }\r\n        };\r\n    };\r\n    Gesture.isTouchDevice = function () {\r\n        return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0;\r\n    };\r\n    Gesture.prototype.dispose = function () {\r\n        if (this.handle) {\r\n            this.handle.dispose();\r\n            this.handle = null;\r\n        }\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    Gesture.prototype.onTouchStart = function (e) {\r\n        var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        if (this.handle) {\r\n            this.handle.dispose();\r\n            this.handle = null;\r\n        }\r\n        for (var i = 0, len = e.targetTouches.length; i < len; i++) {\r\n            var touch = e.targetTouches.item(i);\r\n            this.activeTouches[touch.identifier] = {\r\n                id: touch.identifier,\r\n                initialTarget: touch.target,\r\n                initialTimeStamp: timestamp,\r\n                initialPageX: touch.pageX,\r\n                initialPageY: touch.pageY,\r\n                rollingTimestamps: [timestamp],\r\n                rollingPageX: [touch.pageX],\r\n                rollingPageY: [touch.pageY]\r\n            };\r\n            var evt = this.newGestureEvent(EventType.Start, touch.target);\r\n            evt.pageX = touch.pageX;\r\n            evt.pageY = touch.pageY;\r\n            this.dispatchEvent(evt);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    };\r\n    Gesture.prototype.onTouchEnd = function (e) {\r\n        var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        var activeTouchCount = Object.keys(this.activeTouches).length;\r\n        var _loop_1 = function (i, len) {\r\n            var touch = e.changedTouches.item(i);\r\n            if (!this_1.activeTouches.hasOwnProperty(String(touch.identifier))) {\r\n                console.warn('move of an UNKNOWN touch', touch);\r\n                return \"continue\";\r\n            }\r\n            var data = this_1.activeTouches[touch.identifier], holdTime = Date.now() - data.initialTimeStamp;\r\n            if (holdTime < Gesture.HOLD_DELAY\r\n                && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30\r\n                && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\r\n                var evt = this_1.newGestureEvent(EventType.Tap, data.initialTarget);\r\n                evt.pageX = arrays.tail(data.rollingPageX);\r\n                evt.pageY = arrays.tail(data.rollingPageY);\r\n                this_1.dispatchEvent(evt);\r\n            }\r\n            else if (holdTime >= Gesture.HOLD_DELAY\r\n                && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30\r\n                && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\r\n                var evt = this_1.newGestureEvent(EventType.Contextmenu, data.initialTarget);\r\n                evt.pageX = arrays.tail(data.rollingPageX);\r\n                evt.pageY = arrays.tail(data.rollingPageY);\r\n                this_1.dispatchEvent(evt);\r\n            }\r\n            else if (activeTouchCount === 1) {\r\n                var finalX = arrays.tail(data.rollingPageX);\r\n                var finalY = arrays.tail(data.rollingPageY);\r\n                var deltaT = arrays.tail(data.rollingTimestamps) - data.rollingTimestamps[0];\r\n                var deltaX = finalX - data.rollingPageX[0];\r\n                var deltaY = finalY - data.rollingPageY[0];\r\n                // We need to get all the dispatch targets on the start of the inertia event\r\n                var dispatchTo = this_1.targets.filter(function (t) { return data.initialTarget instanceof Node && t.contains(data.initialTarget); });\r\n                this_1.inertia(dispatchTo, timestamp, // time now\r\n                Math.abs(deltaX) / deltaT, // speed\r\n                deltaX > 0 ? 1 : -1, // x direction\r\n                finalX, // x now\r\n                Math.abs(deltaY) / deltaT, // y speed\r\n                deltaY > 0 ? 1 : -1, // y direction\r\n                finalY // y now\r\n                );\r\n            }\r\n            this_1.dispatchEvent(this_1.newGestureEvent(EventType.End, data.initialTarget));\r\n            // forget about this touch\r\n            delete this_1.activeTouches[touch.identifier];\r\n        };\r\n        var this_1 = this;\r\n        for (var i = 0, len = e.changedTouches.length; i < len; i++) {\r\n            _loop_1(i, len);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    };\r\n    Gesture.prototype.newGestureEvent = function (type, initialTarget) {\r\n        var event = document.createEvent('CustomEvent');\r\n        event.initEvent(type, false, true);\r\n        event.initialTarget = initialTarget;\r\n        event.tapCount = 0;\r\n        return event;\r\n    };\r\n    Gesture.prototype.dispatchEvent = function (event) {\r\n        var _this = this;\r\n        if (event.type === EventType.Tap) {\r\n            var currentTime = (new Date()).getTime();\r\n            var setTapCount = 0;\r\n            if (currentTime - this._lastSetTapCountTime > Gesture.CLEAR_TAP_COUNT_TIME) {\r\n                setTapCount = 1;\r\n            }\r\n            else {\r\n                setTapCount = 2;\r\n            }\r\n            this._lastSetTapCountTime = currentTime;\r\n            event.tapCount = setTapCount;\r\n        }\r\n        else if (event.type === EventType.Change || event.type === EventType.Contextmenu) {\r\n            // tap is canceled by scrolling or context menu\r\n            this._lastSetTapCountTime = 0;\r\n        }\r\n        for (var i = 0; i < this.ignoreTargets.length; i++) {\r\n            if (event.initialTarget instanceof Node && this.ignoreTargets[i].contains(event.initialTarget)) {\r\n                return;\r\n            }\r\n        }\r\n        this.targets.forEach(function (target) {\r\n            if (event.initialTarget instanceof Node && target.contains(event.initialTarget)) {\r\n                target.dispatchEvent(event);\r\n                _this.dispatched = true;\r\n            }\r\n        });\r\n    };\r\n    Gesture.prototype.inertia = function (dispatchTo, t1, vX, dirX, x, vY, dirY, y) {\r\n        var _this = this;\r\n        this.handle = DomUtils.scheduleAtNextAnimationFrame(function () {\r\n            var now = Date.now();\r\n            // velocity: old speed + accel_over_time\r\n            var deltaT = now - t1, delta_pos_x = 0, delta_pos_y = 0, stopped = true;\r\n            vX += Gesture.SCROLL_FRICTION * deltaT;\r\n            vY += Gesture.SCROLL_FRICTION * deltaT;\r\n            if (vX > 0) {\r\n                stopped = false;\r\n                delta_pos_x = dirX * vX * deltaT;\r\n            }\r\n            if (vY > 0) {\r\n                stopped = false;\r\n                delta_pos_y = dirY * vY * deltaT;\r\n            }\r\n            // dispatch translation event\r\n            var evt = _this.newGestureEvent(EventType.Change);\r\n            evt.translationX = delta_pos_x;\r\n            evt.translationY = delta_pos_y;\r\n            dispatchTo.forEach(function (d) { return d.dispatchEvent(evt); });\r\n            if (!stopped) {\r\n                _this.inertia(dispatchTo, now, vX, dirX, x + delta_pos_x, vY, dirY, y + delta_pos_y);\r\n            }\r\n        });\r\n    };\r\n    Gesture.prototype.onTouchMove = function (e) {\r\n        var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        for (var i = 0, len = e.changedTouches.length; i < len; i++) {\r\n            var touch = e.changedTouches.item(i);\r\n            if (!this.activeTouches.hasOwnProperty(String(touch.identifier))) {\r\n                console.warn('end of an UNKNOWN touch', touch);\r\n                continue;\r\n            }\r\n            var data = this.activeTouches[touch.identifier];\r\n            var evt = this.newGestureEvent(EventType.Change, data.initialTarget);\r\n            evt.translationX = touch.pageX - arrays.tail(data.rollingPageX);\r\n            evt.translationY = touch.pageY - arrays.tail(data.rollingPageY);\r\n            evt.pageX = touch.pageX;\r\n            evt.pageY = touch.pageY;\r\n            this.dispatchEvent(evt);\r\n            // only keep a few data points, to average the final speed\r\n            if (data.rollingPageX.length > 3) {\r\n                data.rollingPageX.shift();\r\n                data.rollingPageY.shift();\r\n                data.rollingTimestamps.shift();\r\n            }\r\n            data.rollingPageX.push(touch.pageX);\r\n            data.rollingPageY.push(touch.pageY);\r\n            data.rollingTimestamps.push(timestamp);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    };\r\n    Gesture.SCROLL_FRICTION = -0.005;\r\n    Gesture.HOLD_DELAY = 700;\r\n    Gesture.CLEAR_TAP_COUNT_TIME = 400; // ms\r\n    __decorate([\r\n        memoize\r\n    ], Gesture, \"isTouchDevice\", null);\r\n    return Gesture;\r\n}(Disposable));\r\nexport { Gesture };\r\n"]},"metadata":{},"sourceType":"module"}