{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport { getOrDefault } from '../../../common/objects.js';\nimport { dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\nimport { Gesture, EventType as TouchEventType } from '../../touch.js';\nimport * as DOM from '../../dom.js';\nimport { Event, Emitter } from '../../../common/event.js';\nimport { domEvent } from '../../event.js';\nimport { ScrollableElement } from '../scrollbar/scrollableElement.js';\nimport { RangeMap, shift } from './rangeMap.js';\nimport { RowCache } from './rowCache.js';\nimport { memoize } from '../../../common/decorators.js';\nimport { Range } from '../../../common/range.js';\nimport { equals, distinct } from '../../../common/arrays.js';\nimport { DataTransfers, StaticDND } from '../../dnd.js';\nimport { disposableTimeout, Delayer } from '../../../common/async.js';\nimport { isFirefox } from '../../browser.js';\nvar DefaultOptions = {\n  useShadows: true,\n  verticalScrollMode: 1\n  /* Auto */\n  ,\n  setRowLineHeight: true,\n  supportDynamicHeights: false,\n  dnd: {\n    getDragElements: function (e) {\n      return [e];\n    },\n    getDragURI: function () {\n      return null;\n    },\n    onDragStart: function () {},\n    onDragOver: function () {\n      return false;\n    },\n    drop: function () {}\n  },\n  horizontalScrolling: false\n};\n\nvar ElementsDragAndDropData =\n/** @class */\nfunction () {\n  function ElementsDragAndDropData(elements) {\n    this.elements = elements;\n  }\n\n  ElementsDragAndDropData.prototype.update = function () {};\n\n  ElementsDragAndDropData.prototype.getData = function () {\n    return this.elements;\n  };\n\n  return ElementsDragAndDropData;\n}();\n\nexport { ElementsDragAndDropData };\n\nvar ExternalElementsDragAndDropData =\n/** @class */\nfunction () {\n  function ExternalElementsDragAndDropData(elements) {\n    this.elements = elements;\n  }\n\n  ExternalElementsDragAndDropData.prototype.update = function () {};\n\n  ExternalElementsDragAndDropData.prototype.getData = function () {\n    return this.elements;\n  };\n\n  return ExternalElementsDragAndDropData;\n}();\n\nexport { ExternalElementsDragAndDropData };\n\nvar DesktopDragAndDropData =\n/** @class */\nfunction () {\n  function DesktopDragAndDropData() {\n    this.types = [];\n    this.files = [];\n  }\n\n  DesktopDragAndDropData.prototype.update = function (dataTransfer) {\n    var _a;\n\n    if (dataTransfer.types) {\n      (_a = this.types).splice.apply(_a, __spreadArrays([0, this.types.length], dataTransfer.types));\n    }\n\n    if (dataTransfer.files) {\n      this.files.splice(0, this.files.length);\n\n      for (var i = 0; i < dataTransfer.files.length; i++) {\n        var file = dataTransfer.files.item(i);\n\n        if (file && (file.size || file.type)) {\n          this.files.push(file);\n        }\n      }\n    }\n  };\n\n  DesktopDragAndDropData.prototype.getData = function () {\n    return {\n      types: this.types,\n      files: this.files\n    };\n  };\n\n  return DesktopDragAndDropData;\n}();\n\nexport { DesktopDragAndDropData };\n\nfunction equalsDragFeedback(f1, f2) {\n  if (Array.isArray(f1) && Array.isArray(f2)) {\n    return equals(f1, f2);\n  }\n\n  return f1 === f2;\n}\n\nvar ListView =\n/** @class */\nfunction () {\n  function ListView(container, virtualDelegate, renderers, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = DefaultOptions;\n    }\n\n    this.virtualDelegate = virtualDelegate;\n    this.domId = \"list_id_\" + ++ListView.InstanceCount;\n    this.renderers = new Map();\n    this.renderWidth = 0;\n    this._scrollHeight = 0;\n    this.scrollableElementUpdateDisposable = null;\n    this.scrollableElementWidthDelayer = new Delayer(50);\n    this.splicing = false;\n    this.dragOverAnimationStopDisposable = Disposable.None;\n    this.dragOverMouseY = 0;\n    this.canDrop = false;\n    this.currentDragFeedbackDisposable = Disposable.None;\n    this.onDragLeaveTimeout = Disposable.None;\n    this.disposables = new DisposableStore();\n    this._onDidChangeContentHeight = new Emitter();\n\n    if (options.horizontalScrolling && options.supportDynamicHeights) {\n      throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\n    }\n\n    this.items = [];\n    this.itemId = 0;\n    this.rangeMap = new RangeMap();\n\n    for (var _i = 0, renderers_1 = renderers; _i < renderers_1.length; _i++) {\n      var renderer = renderers_1[_i];\n      this.renderers.set(renderer.templateId, renderer);\n    }\n\n    this.cache = this.disposables.add(new RowCache(this.renderers));\n    this.lastRenderTop = 0;\n    this.lastRenderHeight = 0;\n    this.domNode = document.createElement('div');\n    this.domNode.className = 'monaco-list';\n    DOM.addClass(this.domNode, this.domId);\n    this.domNode.tabIndex = 0;\n    DOM.toggleClass(this.domNode, 'mouse-support', typeof options.mouseSupport === 'boolean' ? options.mouseSupport : true);\n    this.horizontalScrolling = getOrDefault(options, function (o) {\n      return o.horizontalScrolling;\n    }, DefaultOptions.horizontalScrolling);\n    DOM.toggleClass(this.domNode, 'horizontal-scrolling', this.horizontalScrolling);\n    this.additionalScrollHeight = typeof options.additionalScrollHeight === 'undefined' ? 0 : options.additionalScrollHeight;\n    this.ariaProvider = options.ariaProvider || {\n      getSetSize: function (e, i, length) {\n        return length;\n      },\n      getPosInSet: function (_, index) {\n        return index + 1;\n      }\n    };\n    this.rowsContainer = document.createElement('div');\n    this.rowsContainer.className = 'monaco-list-rows';\n    this.rowsContainer.style.transform = 'translate3d(0px, 0px, 0px)';\n    this.disposables.add(Gesture.addTarget(this.rowsContainer));\n    this.scrollableElement = this.disposables.add(new ScrollableElement(this.rowsContainer, {\n      alwaysConsumeMouseWheel: true,\n      horizontal: this.horizontalScrolling ? 1\n      /* Auto */\n      : 2\n      /* Hidden */\n      ,\n      vertical: getOrDefault(options, function (o) {\n        return o.verticalScrollMode;\n      }, DefaultOptions.verticalScrollMode),\n      useShadows: getOrDefault(options, function (o) {\n        return o.useShadows;\n      }, DefaultOptions.useShadows)\n    }));\n    this.domNode.appendChild(this.scrollableElement.getDomNode());\n    container.appendChild(this.domNode);\n    this.scrollableElement.onScroll(this.onScroll, this, this.disposables);\n    domEvent(this.rowsContainer, TouchEventType.Change)(this.onTouchChange, this, this.disposables); // Prevent the monaco-scrollable-element from scrolling\n    // https://github.com/Microsoft/vscode/issues/44181\n\n    domEvent(this.scrollableElement.getDomNode(), 'scroll')(function (e) {\n      return e.target.scrollTop = 0;\n    }, null, this.disposables);\n    Event.map(domEvent(this.domNode, 'dragover'), function (e) {\n      return _this.toDragEvent(e);\n    })(this.onDragOver, this, this.disposables);\n    Event.map(domEvent(this.domNode, 'drop'), function (e) {\n      return _this.toDragEvent(e);\n    })(this.onDrop, this, this.disposables);\n    domEvent(this.domNode, 'dragleave')(this.onDragLeave, this, this.disposables);\n    domEvent(window, 'dragend')(this.onDragEnd, this, this.disposables);\n    this.setRowLineHeight = getOrDefault(options, function (o) {\n      return o.setRowLineHeight;\n    }, DefaultOptions.setRowLineHeight);\n    this.supportDynamicHeights = getOrDefault(options, function (o) {\n      return o.supportDynamicHeights;\n    }, DefaultOptions.supportDynamicHeights);\n    this.dnd = getOrDefault(options, function (o) {\n      return o.dnd;\n    }, DefaultOptions.dnd);\n    this.layout();\n  }\n\n  Object.defineProperty(ListView.prototype, \"contentHeight\", {\n    get: function () {\n      return this.rangeMap.size;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ListView.prototype.splice = function (start, deleteCount, elements) {\n    if (elements === void 0) {\n      elements = [];\n    }\n\n    if (this.splicing) {\n      throw new Error('Can\\'t run recursive splices.');\n    }\n\n    this.splicing = true;\n\n    try {\n      return this._splice(start, deleteCount, elements);\n    } finally {\n      this.splicing = false;\n\n      this._onDidChangeContentHeight.fire(this.contentHeight);\n    }\n  };\n\n  ListView.prototype._splice = function (start, deleteCount, elements) {\n    var _a;\n\n    var _this = this;\n\n    if (elements === void 0) {\n      elements = [];\n    }\n\n    var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n    var deleteRange = {\n      start: start,\n      end: start + deleteCount\n    };\n    var removeRange = Range.intersect(previousRenderRange, deleteRange);\n\n    for (var i = removeRange.start; i < removeRange.end; i++) {\n      this.removeItemFromDOM(i);\n    }\n\n    var previousRestRange = {\n      start: start + deleteCount,\n      end: this.items.length\n    };\n    var previousRenderedRestRange = Range.intersect(previousRestRange, previousRenderRange);\n    var previousUnrenderedRestRanges = Range.relativeComplement(previousRestRange, previousRenderRange);\n    var inserted = elements.map(function (element) {\n      return {\n        id: String(_this.itemId++),\n        element: element,\n        templateId: _this.virtualDelegate.getTemplateId(element),\n        size: _this.virtualDelegate.getHeight(element),\n        width: undefined,\n        hasDynamicHeight: !!_this.virtualDelegate.hasDynamicHeight && _this.virtualDelegate.hasDynamicHeight(element),\n        lastDynamicHeightWidth: undefined,\n        row: null,\n        uri: undefined,\n        dropTarget: false,\n        dragStartDisposable: Disposable.None\n      };\n    });\n    var deleted; // TODO@joao: improve this optimization to catch even more cases\n\n    if (start === 0 && deleteCount >= this.items.length) {\n      this.rangeMap = new RangeMap();\n      this.rangeMap.splice(0, 0, inserted);\n      this.items = inserted;\n      deleted = [];\n    } else {\n      this.rangeMap.splice(start, deleteCount, inserted);\n      deleted = (_a = this.items).splice.apply(_a, __spreadArrays([start, deleteCount], inserted));\n    }\n\n    var delta = elements.length - deleteCount;\n    var renderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n    var renderedRestRange = shift(previousRenderedRestRange, delta);\n    var updateRange = Range.intersect(renderRange, renderedRestRange);\n\n    for (var i = updateRange.start; i < updateRange.end; i++) {\n      this.updateItemInDOM(this.items[i], i);\n    }\n\n    var removeRanges = Range.relativeComplement(renderedRestRange, renderRange);\n\n    for (var _i = 0, removeRanges_1 = removeRanges; _i < removeRanges_1.length; _i++) {\n      var range = removeRanges_1[_i];\n\n      for (var i = range.start; i < range.end; i++) {\n        this.removeItemFromDOM(i);\n      }\n    }\n\n    var unrenderedRestRanges = previousUnrenderedRestRanges.map(function (r) {\n      return shift(r, delta);\n    });\n    var elementsRange = {\n      start: start,\n      end: start + elements.length\n    };\n\n    var insertRanges = __spreadArrays([elementsRange], unrenderedRestRanges).map(function (r) {\n      return Range.intersect(renderRange, r);\n    });\n\n    var beforeElement = this.getNextToLastElement(insertRanges);\n\n    for (var _b = 0, insertRanges_1 = insertRanges; _b < insertRanges_1.length; _b++) {\n      var range = insertRanges_1[_b];\n\n      for (var i = range.start; i < range.end; i++) {\n        this.insertItemInDOM(i, beforeElement);\n      }\n    }\n\n    this.eventuallyUpdateScrollDimensions();\n\n    if (this.supportDynamicHeights) {\n      this._rerender(this.scrollTop, this.renderHeight);\n    }\n\n    return deleted.map(function (i) {\n      return i.element;\n    });\n  };\n\n  ListView.prototype.eventuallyUpdateScrollDimensions = function () {\n    var _this = this;\n\n    this._scrollHeight = this.contentHeight;\n    this.rowsContainer.style.height = this._scrollHeight + \"px\";\n\n    if (!this.scrollableElementUpdateDisposable) {\n      this.scrollableElementUpdateDisposable = DOM.scheduleAtNextAnimationFrame(function () {\n        _this.scrollableElement.setScrollDimensions({\n          scrollHeight: _this.scrollHeight\n        });\n\n        _this.updateScrollWidth();\n\n        _this.scrollableElementUpdateDisposable = null;\n      });\n    }\n  };\n\n  ListView.prototype.eventuallyUpdateScrollWidth = function () {\n    var _this = this;\n\n    if (!this.horizontalScrolling) {\n      return;\n    }\n\n    this.scrollableElementWidthDelayer.trigger(function () {\n      return _this.updateScrollWidth();\n    });\n  };\n\n  ListView.prototype.updateScrollWidth = function () {\n    if (!this.horizontalScrolling) {\n      return;\n    }\n\n    if (this.items.length === 0) {\n      this.scrollableElement.setScrollDimensions({\n        scrollWidth: 0\n      });\n    }\n\n    var scrollWidth = 0;\n\n    for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\n      var item = _a[_i];\n\n      if (typeof item.width !== 'undefined') {\n        scrollWidth = Math.max(scrollWidth, item.width);\n      }\n    }\n\n    this.scrollWidth = scrollWidth;\n    this.scrollableElement.setScrollDimensions({\n      scrollWidth: scrollWidth + 10\n    });\n  };\n\n  ListView.prototype.rerender = function () {\n    if (!this.supportDynamicHeights) {\n      return;\n    }\n\n    for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\n      var item = _a[_i];\n      item.lastDynamicHeightWidth = undefined;\n    }\n\n    this._rerender(this.lastRenderTop, this.lastRenderHeight);\n  };\n\n  Object.defineProperty(ListView.prototype, \"length\", {\n    get: function () {\n      return this.items.length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"renderHeight\", {\n    get: function () {\n      var scrollDimensions = this.scrollableElement.getScrollDimensions();\n      return scrollDimensions.height;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ListView.prototype.element = function (index) {\n    return this.items[index].element;\n  };\n\n  ListView.prototype.domElement = function (index) {\n    var row = this.items[index].row;\n    return row && row.domNode;\n  };\n\n  ListView.prototype.elementHeight = function (index) {\n    return this.items[index].size;\n  };\n\n  ListView.prototype.elementTop = function (index) {\n    return this.rangeMap.positionAt(index);\n  };\n\n  ListView.prototype.indexAt = function (position) {\n    return this.rangeMap.indexAt(position);\n  };\n\n  ListView.prototype.indexAfter = function (position) {\n    return this.rangeMap.indexAfter(position);\n  };\n\n  ListView.prototype.layout = function (height, width) {\n    var scrollDimensions = {\n      height: typeof height === 'number' ? height : DOM.getContentHeight(this.domNode)\n    };\n\n    if (this.scrollableElementUpdateDisposable) {\n      this.scrollableElementUpdateDisposable.dispose();\n      this.scrollableElementUpdateDisposable = null;\n      scrollDimensions.scrollHeight = this.scrollHeight;\n    }\n\n    this.scrollableElement.setScrollDimensions(scrollDimensions);\n\n    if (typeof width !== 'undefined') {\n      this.renderWidth = width;\n\n      if (this.supportDynamicHeights) {\n        this._rerender(this.scrollTop, this.renderHeight);\n      }\n\n      if (this.horizontalScrolling) {\n        this.scrollableElement.setScrollDimensions({\n          width: typeof width === 'number' ? width : DOM.getContentWidth(this.domNode)\n        });\n      }\n    }\n  }; // Render\n\n\n  ListView.prototype.render = function (renderTop, renderHeight, renderLeft, scrollWidth) {\n    var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n    var renderRange = this.getRenderRange(renderTop, renderHeight);\n    var rangesToInsert = Range.relativeComplement(renderRange, previousRenderRange);\n    var rangesToRemove = Range.relativeComplement(previousRenderRange, renderRange);\n    var beforeElement = this.getNextToLastElement(rangesToInsert);\n\n    for (var _i = 0, rangesToInsert_1 = rangesToInsert; _i < rangesToInsert_1.length; _i++) {\n      var range = rangesToInsert_1[_i];\n\n      for (var i = range.start; i < range.end; i++) {\n        this.insertItemInDOM(i, beforeElement);\n      }\n    }\n\n    for (var _a = 0, rangesToRemove_1 = rangesToRemove; _a < rangesToRemove_1.length; _a++) {\n      var range = rangesToRemove_1[_a];\n\n      for (var i = range.start; i < range.end; i++) {\n        this.removeItemFromDOM(i);\n      }\n    }\n\n    this.rowsContainer.style.left = \"-\" + renderLeft + \"px\";\n    this.rowsContainer.style.top = \"-\" + renderTop + \"px\";\n\n    if (this.horizontalScrolling) {\n      this.rowsContainer.style.width = Math.max(scrollWidth, this.renderWidth) + \"px\";\n    }\n\n    this.lastRenderTop = renderTop;\n    this.lastRenderHeight = renderHeight;\n  }; // DOM operations\n\n\n  ListView.prototype.insertItemInDOM = function (index, beforeElement) {\n    var _this = this;\n\n    var item = this.items[index];\n\n    if (!item.row) {\n      item.row = this.cache.alloc(item.templateId);\n      var role = this.ariaProvider.getRole ? this.ariaProvider.getRole(item.element) : 'treeitem';\n      item.row.domNode.setAttribute('role', role);\n      var checked = this.ariaProvider.isChecked ? this.ariaProvider.isChecked(item.element) : undefined;\n\n      if (typeof checked !== 'undefined') {\n        item.row.domNode.setAttribute('aria-checked', String(checked));\n      }\n    }\n\n    if (!item.row.domNode.parentElement) {\n      if (beforeElement) {\n        this.rowsContainer.insertBefore(item.row.domNode, beforeElement);\n      } else {\n        this.rowsContainer.appendChild(item.row.domNode);\n      }\n    }\n\n    this.updateItemInDOM(item, index);\n    var renderer = this.renderers.get(item.templateId);\n\n    if (!renderer) {\n      throw new Error(\"No renderer found for template id \" + item.templateId);\n    }\n\n    if (renderer) {\n      renderer.renderElement(item.element, index, item.row.templateData, item.size);\n    }\n\n    var uri = this.dnd.getDragURI(item.element);\n    item.dragStartDisposable.dispose();\n    item.row.domNode.draggable = !!uri;\n\n    if (uri) {\n      var onDragStart = domEvent(item.row.domNode, 'dragstart');\n      item.dragStartDisposable = onDragStart(function (event) {\n        return _this.onDragStart(item.element, uri, event);\n      });\n    }\n\n    if (this.horizontalScrolling) {\n      this.measureItemWidth(item);\n      this.eventuallyUpdateScrollWidth();\n    }\n  };\n\n  ListView.prototype.measureItemWidth = function (item) {\n    if (!item.row || !item.row.domNode) {\n      return;\n    }\n\n    item.row.domNode.style.width = isFirefox ? '-moz-fit-content' : 'fit-content';\n    item.width = DOM.getContentWidth(item.row.domNode);\n    var style = window.getComputedStyle(item.row.domNode);\n\n    if (style.paddingLeft) {\n      item.width += parseFloat(style.paddingLeft);\n    }\n\n    if (style.paddingRight) {\n      item.width += parseFloat(style.paddingRight);\n    }\n\n    item.row.domNode.style.width = '';\n  };\n\n  ListView.prototype.updateItemInDOM = function (item, index) {\n    item.row.domNode.style.top = this.elementTop(index) + \"px\";\n    item.row.domNode.style.height = item.size + \"px\";\n\n    if (this.setRowLineHeight) {\n      item.row.domNode.style.lineHeight = item.size + \"px\";\n    }\n\n    item.row.domNode.setAttribute('data-index', \"\" + index);\n    item.row.domNode.setAttribute('data-last-element', index === this.length - 1 ? 'true' : 'false');\n    item.row.domNode.setAttribute('aria-setsize', String(this.ariaProvider.getSetSize(item.element, index, this.length)));\n    item.row.domNode.setAttribute('aria-posinset', String(this.ariaProvider.getPosInSet(item.element, index)));\n    item.row.domNode.setAttribute('id', this.getElementDomId(index));\n    DOM.toggleClass(item.row.domNode, 'drop-target', item.dropTarget);\n  };\n\n  ListView.prototype.removeItemFromDOM = function (index) {\n    var item = this.items[index];\n    item.dragStartDisposable.dispose();\n    var renderer = this.renderers.get(item.templateId);\n\n    if (renderer && renderer.disposeElement) {\n      renderer.disposeElement(item.element, index, item.row.templateData, item.size);\n    }\n\n    this.cache.release(item.row);\n    item.row = null;\n\n    if (this.horizontalScrolling) {\n      this.eventuallyUpdateScrollWidth();\n    }\n  };\n\n  ListView.prototype.getScrollTop = function () {\n    var scrollPosition = this.scrollableElement.getScrollPosition();\n    return scrollPosition.scrollTop;\n  };\n\n  ListView.prototype.setScrollTop = function (scrollTop) {\n    if (this.scrollableElementUpdateDisposable) {\n      this.scrollableElementUpdateDisposable.dispose();\n      this.scrollableElementUpdateDisposable = null;\n      this.scrollableElement.setScrollDimensions({\n        scrollHeight: this.scrollHeight\n      });\n    }\n\n    this.scrollableElement.setScrollPosition({\n      scrollTop: scrollTop\n    });\n  };\n\n  Object.defineProperty(ListView.prototype, \"scrollTop\", {\n    get: function () {\n      return this.getScrollTop();\n    },\n    set: function (scrollTop) {\n      this.setScrollTop(scrollTop);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"scrollHeight\", {\n    get: function () {\n      return this._scrollHeight + (this.horizontalScrolling ? 10 : 0) + this.additionalScrollHeight;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onMouseClick\", {\n    // Events\n    get: function () {\n      var _this = this;\n\n      return Event.map(domEvent(this.domNode, 'click'), function (e) {\n        return _this.toMouseEvent(e);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onMouseDblClick\", {\n    get: function () {\n      var _this = this;\n\n      return Event.map(domEvent(this.domNode, 'dblclick'), function (e) {\n        return _this.toMouseEvent(e);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onMouseMiddleClick\", {\n    get: function () {\n      var _this = this;\n\n      return Event.filter(Event.map(domEvent(this.domNode, 'auxclick'), function (e) {\n        return _this.toMouseEvent(e);\n      }), function (e) {\n        return e.browserEvent.button === 1;\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onMouseDown\", {\n    get: function () {\n      var _this = this;\n\n      return Event.map(domEvent(this.domNode, 'mousedown'), function (e) {\n        return _this.toMouseEvent(e);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onContextMenu\", {\n    get: function () {\n      var _this = this;\n\n      return Event.map(domEvent(this.domNode, 'contextmenu'), function (e) {\n        return _this.toMouseEvent(e);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onTouchStart\", {\n    get: function () {\n      var _this = this;\n\n      return Event.map(domEvent(this.domNode, 'touchstart'), function (e) {\n        return _this.toTouchEvent(e);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ListView.prototype, \"onTap\", {\n    get: function () {\n      var _this = this;\n\n      return Event.map(domEvent(this.rowsContainer, TouchEventType.Tap), function (e) {\n        return _this.toGestureEvent(e);\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ListView.prototype.toMouseEvent = function (browserEvent) {\n    var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n    var item = typeof index === 'undefined' ? undefined : this.items[index];\n    var element = item && item.element;\n    return {\n      browserEvent: browserEvent,\n      index: index,\n      element: element\n    };\n  };\n\n  ListView.prototype.toTouchEvent = function (browserEvent) {\n    var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n    var item = typeof index === 'undefined' ? undefined : this.items[index];\n    var element = item && item.element;\n    return {\n      browserEvent: browserEvent,\n      index: index,\n      element: element\n    };\n  };\n\n  ListView.prototype.toGestureEvent = function (browserEvent) {\n    var index = this.getItemIndexFromEventTarget(browserEvent.initialTarget || null);\n    var item = typeof index === 'undefined' ? undefined : this.items[index];\n    var element = item && item.element;\n    return {\n      browserEvent: browserEvent,\n      index: index,\n      element: element\n    };\n  };\n\n  ListView.prototype.toDragEvent = function (browserEvent) {\n    var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n    var item = typeof index === 'undefined' ? undefined : this.items[index];\n    var element = item && item.element;\n    return {\n      browserEvent: browserEvent,\n      index: index,\n      element: element\n    };\n  };\n\n  ListView.prototype.onScroll = function (e) {\n    try {\n      this.render(e.scrollTop, e.height, e.scrollLeft, e.scrollWidth);\n\n      if (this.supportDynamicHeights) {\n        this._rerender(e.scrollTop, e.height);\n      }\n    } catch (err) {\n      console.error('Got bad scroll event:', e);\n      throw err;\n    }\n  };\n\n  ListView.prototype.onTouchChange = function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    this.scrollTop -= event.translationY;\n  }; // DND\n\n\n  ListView.prototype.onDragStart = function (element, uri, event) {\n    if (!event.dataTransfer) {\n      return;\n    }\n\n    var elements = this.dnd.getDragElements(element);\n    event.dataTransfer.effectAllowed = 'copyMove';\n    event.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([uri]));\n\n    if (event.dataTransfer.setDragImage) {\n      var label = void 0;\n\n      if (this.dnd.getDragLabel) {\n        label = this.dnd.getDragLabel(elements, event);\n      }\n\n      if (typeof label === 'undefined') {\n        label = String(elements.length);\n      }\n\n      var dragImage_1 = DOM.$('.monaco-drag-image');\n      dragImage_1.textContent = label;\n      document.body.appendChild(dragImage_1);\n      event.dataTransfer.setDragImage(dragImage_1, -10, -10);\n      setTimeout(function () {\n        return document.body.removeChild(dragImage_1);\n      }, 0);\n    }\n\n    this.currentDragData = new ElementsDragAndDropData(elements);\n    StaticDND.CurrentDragAndDropData = new ExternalElementsDragAndDropData(elements);\n\n    if (this.dnd.onDragStart) {\n      this.dnd.onDragStart(this.currentDragData, event);\n    }\n  };\n\n  ListView.prototype.onDragOver = function (event) {\n    var _this = this;\n\n    event.browserEvent.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n    this.onDragLeaveTimeout.dispose();\n\n    if (StaticDND.CurrentDragAndDropData && StaticDND.CurrentDragAndDropData.getData() === 'vscode-ui') {\n      return false;\n    }\n\n    this.setupDragAndDropScrollTopAnimation(event.browserEvent);\n\n    if (!event.browserEvent.dataTransfer) {\n      return false;\n    } // Drag over from outside\n\n\n    if (!this.currentDragData) {\n      if (StaticDND.CurrentDragAndDropData) {\n        // Drag over from another list\n        this.currentDragData = StaticDND.CurrentDragAndDropData;\n      } else {\n        // Drag over from the desktop\n        if (!event.browserEvent.dataTransfer.types) {\n          return false;\n        }\n\n        this.currentDragData = new DesktopDragAndDropData();\n      }\n    }\n\n    var result = this.dnd.onDragOver(this.currentDragData, event.element, event.index, event.browserEvent);\n    this.canDrop = typeof result === 'boolean' ? result : result.accept;\n\n    if (!this.canDrop) {\n      this.currentDragFeedback = undefined;\n      this.currentDragFeedbackDisposable.dispose();\n      return false;\n    }\n\n    event.browserEvent.dataTransfer.dropEffect = typeof result !== 'boolean' && result.effect === 0\n    /* Copy */\n    ? 'copy' : 'move';\n    var feedback;\n\n    if (typeof result !== 'boolean' && result.feedback) {\n      feedback = result.feedback;\n    } else {\n      if (typeof event.index === 'undefined') {\n        feedback = [-1];\n      } else {\n        feedback = [event.index];\n      }\n    } // sanitize feedback list\n\n\n    feedback = distinct(feedback).filter(function (i) {\n      return i >= -1 && i < _this.length;\n    }).sort(function (a, b) {\n      return a - b;\n    });\n    feedback = feedback[0] === -1 ? [-1] : feedback;\n\n    if (equalsDragFeedback(this.currentDragFeedback, feedback)) {\n      return true;\n    }\n\n    this.currentDragFeedback = feedback;\n    this.currentDragFeedbackDisposable.dispose();\n\n    if (feedback[0] === -1) {\n      // entire list feedback\n      DOM.addClass(this.domNode, 'drop-target');\n      DOM.addClass(this.rowsContainer, 'drop-target');\n      this.currentDragFeedbackDisposable = toDisposable(function () {\n        DOM.removeClass(_this.domNode, 'drop-target');\n        DOM.removeClass(_this.rowsContainer, 'drop-target');\n      });\n    } else {\n      for (var _i = 0, feedback_1 = feedback; _i < feedback_1.length; _i++) {\n        var index = feedback_1[_i];\n        var item = this.items[index];\n        item.dropTarget = true;\n\n        if (item.row && item.row.domNode) {\n          DOM.addClass(item.row.domNode, 'drop-target');\n        }\n      }\n\n      this.currentDragFeedbackDisposable = toDisposable(function () {\n        for (var _i = 0, feedback_2 = feedback; _i < feedback_2.length; _i++) {\n          var index = feedback_2[_i];\n          var item = _this.items[index];\n          item.dropTarget = false;\n\n          if (item.row && item.row.domNode) {\n            DOM.removeClass(item.row.domNode, 'drop-target');\n          }\n        }\n      });\n    }\n\n    return true;\n  };\n\n  ListView.prototype.onDragLeave = function () {\n    var _this = this;\n\n    this.onDragLeaveTimeout.dispose();\n    this.onDragLeaveTimeout = disposableTimeout(function () {\n      return _this.clearDragOverFeedback();\n    }, 100);\n  };\n\n  ListView.prototype.onDrop = function (event) {\n    if (!this.canDrop) {\n      return;\n    }\n\n    var dragData = this.currentDragData;\n    this.teardownDragAndDropScrollTopAnimation();\n    this.clearDragOverFeedback();\n    this.currentDragData = undefined;\n    StaticDND.CurrentDragAndDropData = undefined;\n\n    if (!dragData || !event.browserEvent.dataTransfer) {\n      return;\n    }\n\n    event.browserEvent.preventDefault();\n    dragData.update(event.browserEvent.dataTransfer);\n    this.dnd.drop(dragData, event.element, event.index, event.browserEvent);\n  };\n\n  ListView.prototype.onDragEnd = function (event) {\n    this.canDrop = false;\n    this.teardownDragAndDropScrollTopAnimation();\n    this.clearDragOverFeedback();\n    this.currentDragData = undefined;\n    StaticDND.CurrentDragAndDropData = undefined;\n\n    if (this.dnd.onDragEnd) {\n      this.dnd.onDragEnd(event);\n    }\n  };\n\n  ListView.prototype.clearDragOverFeedback = function () {\n    this.currentDragFeedback = undefined;\n    this.currentDragFeedbackDisposable.dispose();\n    this.currentDragFeedbackDisposable = Disposable.None;\n  }; // DND scroll top animation\n\n\n  ListView.prototype.setupDragAndDropScrollTopAnimation = function (event) {\n    var _this = this;\n\n    if (!this.dragOverAnimationDisposable) {\n      var viewTop = DOM.getTopLeftOffset(this.domNode).top;\n      this.dragOverAnimationDisposable = DOM.animate(this.animateDragAndDropScrollTop.bind(this, viewTop));\n    }\n\n    this.dragOverAnimationStopDisposable.dispose();\n    this.dragOverAnimationStopDisposable = disposableTimeout(function () {\n      if (_this.dragOverAnimationDisposable) {\n        _this.dragOverAnimationDisposable.dispose();\n\n        _this.dragOverAnimationDisposable = undefined;\n      }\n    }, 1000);\n    this.dragOverMouseY = event.pageY;\n  };\n\n  ListView.prototype.animateDragAndDropScrollTop = function (viewTop) {\n    if (this.dragOverMouseY === undefined) {\n      return;\n    }\n\n    var diff = this.dragOverMouseY - viewTop;\n    var upperLimit = this.renderHeight - 35;\n\n    if (diff < 35) {\n      this.scrollTop += Math.max(-14, Math.floor(0.3 * (diff - 35)));\n    } else if (diff > upperLimit) {\n      this.scrollTop += Math.min(14, Math.floor(0.3 * (diff - upperLimit)));\n    }\n  };\n\n  ListView.prototype.teardownDragAndDropScrollTopAnimation = function () {\n    this.dragOverAnimationStopDisposable.dispose();\n\n    if (this.dragOverAnimationDisposable) {\n      this.dragOverAnimationDisposable.dispose();\n      this.dragOverAnimationDisposable = undefined;\n    }\n  }; // Util\n\n\n  ListView.prototype.getItemIndexFromEventTarget = function (target) {\n    var element = target;\n\n    while (element instanceof HTMLElement && element !== this.rowsContainer) {\n      var rawIndex = element.getAttribute('data-index');\n\n      if (rawIndex) {\n        var index = Number(rawIndex);\n\n        if (!isNaN(index)) {\n          return index;\n        }\n      }\n\n      element = element.parentElement;\n    }\n\n    return undefined;\n  };\n\n  ListView.prototype.getRenderRange = function (renderTop, renderHeight) {\n    return {\n      start: this.rangeMap.indexAt(renderTop),\n      end: this.rangeMap.indexAfter(renderTop + renderHeight - 1)\n    };\n  };\n  /**\r\n   * Given a stable rendered state, checks every rendered element whether it needs\r\n   * to be probed for dynamic height. Adjusts scroll height and top if necessary.\r\n   */\n\n\n  ListView.prototype._rerender = function (renderTop, renderHeight) {\n    var previousRenderRange = this.getRenderRange(renderTop, renderHeight); // Let's remember the second element's position, this helps in scrolling up\n    // and preserving a linear upwards scroll movement\n\n    var anchorElementIndex;\n    var anchorElementTopDelta;\n\n    if (renderTop === this.elementTop(previousRenderRange.start)) {\n      anchorElementIndex = previousRenderRange.start;\n      anchorElementTopDelta = 0;\n    } else if (previousRenderRange.end - previousRenderRange.start > 1) {\n      anchorElementIndex = previousRenderRange.start + 1;\n      anchorElementTopDelta = this.elementTop(anchorElementIndex) - renderTop;\n    }\n\n    var heightDiff = 0;\n\n    while (true) {\n      var renderRange = this.getRenderRange(renderTop, renderHeight);\n      var didChange = false;\n\n      for (var i = renderRange.start; i < renderRange.end; i++) {\n        var diff = this.probeDynamicHeight(i);\n\n        if (diff !== 0) {\n          this.rangeMap.splice(i, 1, [this.items[i]]);\n        }\n\n        heightDiff += diff;\n        didChange = didChange || diff !== 0;\n      }\n\n      if (!didChange) {\n        if (heightDiff !== 0) {\n          this.eventuallyUpdateScrollDimensions();\n        }\n\n        var unrenderRanges = Range.relativeComplement(previousRenderRange, renderRange);\n\n        for (var _i = 0, unrenderRanges_1 = unrenderRanges; _i < unrenderRanges_1.length; _i++) {\n          var range = unrenderRanges_1[_i];\n\n          for (var i = range.start; i < range.end; i++) {\n            if (this.items[i].row) {\n              this.removeItemFromDOM(i);\n            }\n          }\n        }\n\n        var renderRanges = Range.relativeComplement(renderRange, previousRenderRange);\n\n        for (var _a = 0, renderRanges_1 = renderRanges; _a < renderRanges_1.length; _a++) {\n          var range = renderRanges_1[_a];\n\n          for (var i = range.start; i < range.end; i++) {\n            var afterIndex = i + 1;\n            var beforeRow = afterIndex < this.items.length ? this.items[afterIndex].row : null;\n            var beforeElement = beforeRow ? beforeRow.domNode : null;\n            this.insertItemInDOM(i, beforeElement);\n          }\n        }\n\n        for (var i = renderRange.start; i < renderRange.end; i++) {\n          if (this.items[i].row) {\n            this.updateItemInDOM(this.items[i], i);\n          }\n        }\n\n        if (typeof anchorElementIndex === 'number') {\n          this.scrollTop = this.elementTop(anchorElementIndex) - anchorElementTopDelta;\n        }\n\n        this._onDidChangeContentHeight.fire(this.contentHeight);\n\n        return;\n      }\n    }\n  };\n\n  ListView.prototype.probeDynamicHeight = function (index) {\n    var item = this.items[index];\n\n    if (!item.hasDynamicHeight || item.lastDynamicHeightWidth === this.renderWidth) {\n      return 0;\n    }\n\n    var size = item.size;\n    var row = this.cache.alloc(item.templateId);\n    row.domNode.style.height = '';\n    this.rowsContainer.appendChild(row.domNode);\n    var renderer = this.renderers.get(item.templateId);\n\n    if (renderer) {\n      renderer.renderElement(item.element, index, row.templateData, undefined);\n\n      if (renderer.disposeElement) {\n        renderer.disposeElement(item.element, index, row.templateData, undefined);\n      }\n    }\n\n    item.size = row.domNode.offsetHeight;\n\n    if (this.virtualDelegate.setDynamicHeight) {\n      this.virtualDelegate.setDynamicHeight(item.element, item.size);\n    }\n\n    item.lastDynamicHeightWidth = this.renderWidth;\n    this.rowsContainer.removeChild(row.domNode);\n    this.cache.release(row);\n    return item.size - size;\n  };\n\n  ListView.prototype.getNextToLastElement = function (ranges) {\n    var lastRange = ranges[ranges.length - 1];\n\n    if (!lastRange) {\n      return null;\n    }\n\n    var nextToLastItem = this.items[lastRange.end];\n\n    if (!nextToLastItem) {\n      return null;\n    }\n\n    if (!nextToLastItem.row) {\n      return null;\n    }\n\n    return nextToLastItem.row.domNode;\n  };\n\n  ListView.prototype.getElementDomId = function (index) {\n    return this.domId + \"_\" + index;\n  }; // Dispose\n\n\n  ListView.prototype.dispose = function () {\n    if (this.items) {\n      for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\n        var item = _a[_i];\n\n        if (item.row) {\n          var renderer = this.renderers.get(item.row.templateId);\n\n          if (renderer) {\n            renderer.disposeTemplate(item.row.templateData);\n          }\n        }\n      }\n\n      this.items = [];\n    }\n\n    if (this.domNode && this.domNode.parentNode) {\n      this.domNode.parentNode.removeChild(this.domNode);\n    }\n\n    dispose(this.disposables);\n  };\n\n  ListView.InstanceCount = 0;\n\n  __decorate([memoize], ListView.prototype, \"onMouseClick\", null);\n\n  __decorate([memoize], ListView.prototype, \"onMouseDblClick\", null);\n\n  __decorate([memoize], ListView.prototype, \"onMouseMiddleClick\", null);\n\n  __decorate([memoize], ListView.prototype, \"onMouseDown\", null);\n\n  __decorate([memoize], ListView.prototype, \"onContextMenu\", null);\n\n  __decorate([memoize], ListView.prototype, \"onTouchStart\", null);\n\n  __decorate([memoize], ListView.prototype, \"onTap\", null);\n\n  return ListView;\n}();\n\nexport { ListView };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/ui/list/listView.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__spreadArrays","s","il","Array","k","a","j","jl","getOrDefault","dispose","Disposable","toDisposable","DisposableStore","Gesture","EventType","TouchEventType","DOM","Event","Emitter","domEvent","ScrollableElement","RangeMap","shift","RowCache","memoize","Range","equals","distinct","DataTransfers","StaticDND","disposableTimeout","Delayer","isFirefox","DefaultOptions","useShadows","verticalScrollMode","setRowLineHeight","supportDynamicHeights","dnd","getDragElements","e","getDragURI","onDragStart","onDragOver","drop","horizontalScrolling","ElementsDragAndDropData","elements","prototype","update","getData","ExternalElementsDragAndDropData","DesktopDragAndDropData","types","files","dataTransfer","_a","splice","apply","file","item","size","type","push","equalsDragFeedback","f1","f2","isArray","ListView","container","virtualDelegate","renderers","options","_this","domId","InstanceCount","Map","renderWidth","_scrollHeight","scrollableElementUpdateDisposable","scrollableElementWidthDelayer","splicing","dragOverAnimationStopDisposable","None","dragOverMouseY","canDrop","currentDragFeedbackDisposable","onDragLeaveTimeout","disposables","_onDidChangeContentHeight","Error","items","itemId","rangeMap","_i","renderers_1","renderer","set","templateId","cache","add","lastRenderTop","lastRenderHeight","domNode","document","createElement","className","addClass","tabIndex","toggleClass","mouseSupport","o","additionalScrollHeight","ariaProvider","getSetSize","getPosInSet","_","index","rowsContainer","style","transform","addTarget","scrollableElement","alwaysConsumeMouseWheel","horizontal","vertical","appendChild","getDomNode","onScroll","Change","onTouchChange","scrollTop","map","toDragEvent","onDrop","onDragLeave","window","onDragEnd","layout","get","enumerable","configurable","start","deleteCount","_splice","fire","contentHeight","previousRenderRange","getRenderRange","deleteRange","end","removeRange","intersect","removeItemFromDOM","previousRestRange","previousRenderedRestRange","previousUnrenderedRestRanges","relativeComplement","inserted","element","id","String","getTemplateId","getHeight","width","undefined","hasDynamicHeight","lastDynamicHeightWidth","row","uri","dropTarget","dragStartDisposable","deleted","delta","renderRange","renderedRestRange","updateRange","updateItemInDOM","removeRanges","removeRanges_1","range","unrenderedRestRanges","elementsRange","insertRanges","beforeElement","getNextToLastElement","_b","insertRanges_1","insertItemInDOM","eventuallyUpdateScrollDimensions","_rerender","renderHeight","height","scheduleAtNextAnimationFrame","setScrollDimensions","scrollHeight","updateScrollWidth","eventuallyUpdateScrollWidth","trigger","scrollWidth","Math","max","rerender","scrollDimensions","getScrollDimensions","domElement","elementHeight","elementTop","positionAt","indexAt","position","indexAfter","getContentHeight","getContentWidth","render","renderTop","renderLeft","rangesToInsert","rangesToRemove","rangesToInsert_1","rangesToRemove_1","left","top","alloc","role","getRole","setAttribute","checked","isChecked","parentElement","insertBefore","renderElement","templateData","draggable","event","measureItemWidth","getComputedStyle","paddingLeft","parseFloat","paddingRight","lineHeight","getElementDomId","disposeElement","release","getScrollTop","scrollPosition","getScrollPosition","setScrollTop","setScrollPosition","toMouseEvent","filter","browserEvent","button","toTouchEvent","Tap","toGestureEvent","getItemIndexFromEventTarget","initialTarget","scrollLeft","err","console","error","preventDefault","stopPropagation","translationY","effectAllowed","setData","RESOURCES","JSON","stringify","setDragImage","label","getDragLabel","dragImage_1","$","textContent","body","setTimeout","removeChild","currentDragData","CurrentDragAndDropData","setupDragAndDropScrollTopAnimation","result","accept","currentDragFeedback","dropEffect","effect","feedback","sort","b","removeClass","feedback_1","feedback_2","clearDragOverFeedback","dragData","teardownDragAndDropScrollTopAnimation","dragOverAnimationDisposable","viewTop","getTopLeftOffset","animate","animateDragAndDropScrollTop","bind","pageY","diff","upperLimit","floor","min","HTMLElement","rawIndex","getAttribute","Number","isNaN","anchorElementIndex","anchorElementTopDelta","heightDiff","didChange","probeDynamicHeight","unrenderRanges","unrenderRanges_1","renderRanges","renderRanges_1","afterIndex","beforeRow","offsetHeight","setDynamicHeight","ranges","lastRange","nextToLastItem","disposeTemplate","parentNode"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { getOrDefault } from '../../../common/objects.js';\r\nimport { dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { Gesture, EventType as TouchEventType } from '../../touch.js';\r\nimport * as DOM from '../../dom.js';\r\nimport { Event, Emitter } from '../../../common/event.js';\r\nimport { domEvent } from '../../event.js';\r\nimport { ScrollableElement } from '../scrollbar/scrollableElement.js';\r\nimport { RangeMap, shift } from './rangeMap.js';\r\nimport { RowCache } from './rowCache.js';\r\nimport { memoize } from '../../../common/decorators.js';\r\nimport { Range } from '../../../common/range.js';\r\nimport { equals, distinct } from '../../../common/arrays.js';\r\nimport { DataTransfers, StaticDND } from '../../dnd.js';\r\nimport { disposableTimeout, Delayer } from '../../../common/async.js';\r\nimport { isFirefox } from '../../browser.js';\r\nvar DefaultOptions = {\r\n    useShadows: true,\r\n    verticalScrollMode: 1 /* Auto */,\r\n    setRowLineHeight: true,\r\n    supportDynamicHeights: false,\r\n    dnd: {\r\n        getDragElements: function (e) { return [e]; },\r\n        getDragURI: function () { return null; },\r\n        onDragStart: function () { },\r\n        onDragOver: function () { return false; },\r\n        drop: function () { }\r\n    },\r\n    horizontalScrolling: false\r\n};\r\nvar ElementsDragAndDropData = /** @class */ (function () {\r\n    function ElementsDragAndDropData(elements) {\r\n        this.elements = elements;\r\n    }\r\n    ElementsDragAndDropData.prototype.update = function () { };\r\n    ElementsDragAndDropData.prototype.getData = function () {\r\n        return this.elements;\r\n    };\r\n    return ElementsDragAndDropData;\r\n}());\r\nexport { ElementsDragAndDropData };\r\nvar ExternalElementsDragAndDropData = /** @class */ (function () {\r\n    function ExternalElementsDragAndDropData(elements) {\r\n        this.elements = elements;\r\n    }\r\n    ExternalElementsDragAndDropData.prototype.update = function () { };\r\n    ExternalElementsDragAndDropData.prototype.getData = function () {\r\n        return this.elements;\r\n    };\r\n    return ExternalElementsDragAndDropData;\r\n}());\r\nexport { ExternalElementsDragAndDropData };\r\nvar DesktopDragAndDropData = /** @class */ (function () {\r\n    function DesktopDragAndDropData() {\r\n        this.types = [];\r\n        this.files = [];\r\n    }\r\n    DesktopDragAndDropData.prototype.update = function (dataTransfer) {\r\n        var _a;\r\n        if (dataTransfer.types) {\r\n            (_a = this.types).splice.apply(_a, __spreadArrays([0, this.types.length], dataTransfer.types));\r\n        }\r\n        if (dataTransfer.files) {\r\n            this.files.splice(0, this.files.length);\r\n            for (var i = 0; i < dataTransfer.files.length; i++) {\r\n                var file = dataTransfer.files.item(i);\r\n                if (file && (file.size || file.type)) {\r\n                    this.files.push(file);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    DesktopDragAndDropData.prototype.getData = function () {\r\n        return {\r\n            types: this.types,\r\n            files: this.files\r\n        };\r\n    };\r\n    return DesktopDragAndDropData;\r\n}());\r\nexport { DesktopDragAndDropData };\r\nfunction equalsDragFeedback(f1, f2) {\r\n    if (Array.isArray(f1) && Array.isArray(f2)) {\r\n        return equals(f1, f2);\r\n    }\r\n    return f1 === f2;\r\n}\r\nvar ListView = /** @class */ (function () {\r\n    function ListView(container, virtualDelegate, renderers, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = DefaultOptions; }\r\n        this.virtualDelegate = virtualDelegate;\r\n        this.domId = \"list_id_\" + ++ListView.InstanceCount;\r\n        this.renderers = new Map();\r\n        this.renderWidth = 0;\r\n        this._scrollHeight = 0;\r\n        this.scrollableElementUpdateDisposable = null;\r\n        this.scrollableElementWidthDelayer = new Delayer(50);\r\n        this.splicing = false;\r\n        this.dragOverAnimationStopDisposable = Disposable.None;\r\n        this.dragOverMouseY = 0;\r\n        this.canDrop = false;\r\n        this.currentDragFeedbackDisposable = Disposable.None;\r\n        this.onDragLeaveTimeout = Disposable.None;\r\n        this.disposables = new DisposableStore();\r\n        this._onDidChangeContentHeight = new Emitter();\r\n        if (options.horizontalScrolling && options.supportDynamicHeights) {\r\n            throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\r\n        }\r\n        this.items = [];\r\n        this.itemId = 0;\r\n        this.rangeMap = new RangeMap();\r\n        for (var _i = 0, renderers_1 = renderers; _i < renderers_1.length; _i++) {\r\n            var renderer = renderers_1[_i];\r\n            this.renderers.set(renderer.templateId, renderer);\r\n        }\r\n        this.cache = this.disposables.add(new RowCache(this.renderers));\r\n        this.lastRenderTop = 0;\r\n        this.lastRenderHeight = 0;\r\n        this.domNode = document.createElement('div');\r\n        this.domNode.className = 'monaco-list';\r\n        DOM.addClass(this.domNode, this.domId);\r\n        this.domNode.tabIndex = 0;\r\n        DOM.toggleClass(this.domNode, 'mouse-support', typeof options.mouseSupport === 'boolean' ? options.mouseSupport : true);\r\n        this.horizontalScrolling = getOrDefault(options, function (o) { return o.horizontalScrolling; }, DefaultOptions.horizontalScrolling);\r\n        DOM.toggleClass(this.domNode, 'horizontal-scrolling', this.horizontalScrolling);\r\n        this.additionalScrollHeight = typeof options.additionalScrollHeight === 'undefined' ? 0 : options.additionalScrollHeight;\r\n        this.ariaProvider = options.ariaProvider || { getSetSize: function (e, i, length) { return length; }, getPosInSet: function (_, index) { return index + 1; } };\r\n        this.rowsContainer = document.createElement('div');\r\n        this.rowsContainer.className = 'monaco-list-rows';\r\n        this.rowsContainer.style.transform = 'translate3d(0px, 0px, 0px)';\r\n        this.disposables.add(Gesture.addTarget(this.rowsContainer));\r\n        this.scrollableElement = this.disposables.add(new ScrollableElement(this.rowsContainer, {\r\n            alwaysConsumeMouseWheel: true,\r\n            horizontal: this.horizontalScrolling ? 1 /* Auto */ : 2 /* Hidden */,\r\n            vertical: getOrDefault(options, function (o) { return o.verticalScrollMode; }, DefaultOptions.verticalScrollMode),\r\n            useShadows: getOrDefault(options, function (o) { return o.useShadows; }, DefaultOptions.useShadows)\r\n        }));\r\n        this.domNode.appendChild(this.scrollableElement.getDomNode());\r\n        container.appendChild(this.domNode);\r\n        this.scrollableElement.onScroll(this.onScroll, this, this.disposables);\r\n        domEvent(this.rowsContainer, TouchEventType.Change)(this.onTouchChange, this, this.disposables);\r\n        // Prevent the monaco-scrollable-element from scrolling\r\n        // https://github.com/Microsoft/vscode/issues/44181\r\n        domEvent(this.scrollableElement.getDomNode(), 'scroll')(function (e) { return e.target.scrollTop = 0; }, null, this.disposables);\r\n        Event.map(domEvent(this.domNode, 'dragover'), function (e) { return _this.toDragEvent(e); })(this.onDragOver, this, this.disposables);\r\n        Event.map(domEvent(this.domNode, 'drop'), function (e) { return _this.toDragEvent(e); })(this.onDrop, this, this.disposables);\r\n        domEvent(this.domNode, 'dragleave')(this.onDragLeave, this, this.disposables);\r\n        domEvent(window, 'dragend')(this.onDragEnd, this, this.disposables);\r\n        this.setRowLineHeight = getOrDefault(options, function (o) { return o.setRowLineHeight; }, DefaultOptions.setRowLineHeight);\r\n        this.supportDynamicHeights = getOrDefault(options, function (o) { return o.supportDynamicHeights; }, DefaultOptions.supportDynamicHeights);\r\n        this.dnd = getOrDefault(options, function (o) { return o.dnd; }, DefaultOptions.dnd);\r\n        this.layout();\r\n    }\r\n    Object.defineProperty(ListView.prototype, \"contentHeight\", {\r\n        get: function () { return this.rangeMap.size; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ListView.prototype.splice = function (start, deleteCount, elements) {\r\n        if (elements === void 0) { elements = []; }\r\n        if (this.splicing) {\r\n            throw new Error('Can\\'t run recursive splices.');\r\n        }\r\n        this.splicing = true;\r\n        try {\r\n            return this._splice(start, deleteCount, elements);\r\n        }\r\n        finally {\r\n            this.splicing = false;\r\n            this._onDidChangeContentHeight.fire(this.contentHeight);\r\n        }\r\n    };\r\n    ListView.prototype._splice = function (start, deleteCount, elements) {\r\n        var _a;\r\n        var _this = this;\r\n        if (elements === void 0) { elements = []; }\r\n        var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\r\n        var deleteRange = { start: start, end: start + deleteCount };\r\n        var removeRange = Range.intersect(previousRenderRange, deleteRange);\r\n        for (var i = removeRange.start; i < removeRange.end; i++) {\r\n            this.removeItemFromDOM(i);\r\n        }\r\n        var previousRestRange = { start: start + deleteCount, end: this.items.length };\r\n        var previousRenderedRestRange = Range.intersect(previousRestRange, previousRenderRange);\r\n        var previousUnrenderedRestRanges = Range.relativeComplement(previousRestRange, previousRenderRange);\r\n        var inserted = elements.map(function (element) { return ({\r\n            id: String(_this.itemId++),\r\n            element: element,\r\n            templateId: _this.virtualDelegate.getTemplateId(element),\r\n            size: _this.virtualDelegate.getHeight(element),\r\n            width: undefined,\r\n            hasDynamicHeight: !!_this.virtualDelegate.hasDynamicHeight && _this.virtualDelegate.hasDynamicHeight(element),\r\n            lastDynamicHeightWidth: undefined,\r\n            row: null,\r\n            uri: undefined,\r\n            dropTarget: false,\r\n            dragStartDisposable: Disposable.None\r\n        }); });\r\n        var deleted;\r\n        // TODO@joao: improve this optimization to catch even more cases\r\n        if (start === 0 && deleteCount >= this.items.length) {\r\n            this.rangeMap = new RangeMap();\r\n            this.rangeMap.splice(0, 0, inserted);\r\n            this.items = inserted;\r\n            deleted = [];\r\n        }\r\n        else {\r\n            this.rangeMap.splice(start, deleteCount, inserted);\r\n            deleted = (_a = this.items).splice.apply(_a, __spreadArrays([start, deleteCount], inserted));\r\n        }\r\n        var delta = elements.length - deleteCount;\r\n        var renderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\r\n        var renderedRestRange = shift(previousRenderedRestRange, delta);\r\n        var updateRange = Range.intersect(renderRange, renderedRestRange);\r\n        for (var i = updateRange.start; i < updateRange.end; i++) {\r\n            this.updateItemInDOM(this.items[i], i);\r\n        }\r\n        var removeRanges = Range.relativeComplement(renderedRestRange, renderRange);\r\n        for (var _i = 0, removeRanges_1 = removeRanges; _i < removeRanges_1.length; _i++) {\r\n            var range = removeRanges_1[_i];\r\n            for (var i = range.start; i < range.end; i++) {\r\n                this.removeItemFromDOM(i);\r\n            }\r\n        }\r\n        var unrenderedRestRanges = previousUnrenderedRestRanges.map(function (r) { return shift(r, delta); });\r\n        var elementsRange = { start: start, end: start + elements.length };\r\n        var insertRanges = __spreadArrays([elementsRange], unrenderedRestRanges).map(function (r) { return Range.intersect(renderRange, r); });\r\n        var beforeElement = this.getNextToLastElement(insertRanges);\r\n        for (var _b = 0, insertRanges_1 = insertRanges; _b < insertRanges_1.length; _b++) {\r\n            var range = insertRanges_1[_b];\r\n            for (var i = range.start; i < range.end; i++) {\r\n                this.insertItemInDOM(i, beforeElement);\r\n            }\r\n        }\r\n        this.eventuallyUpdateScrollDimensions();\r\n        if (this.supportDynamicHeights) {\r\n            this._rerender(this.scrollTop, this.renderHeight);\r\n        }\r\n        return deleted.map(function (i) { return i.element; });\r\n    };\r\n    ListView.prototype.eventuallyUpdateScrollDimensions = function () {\r\n        var _this = this;\r\n        this._scrollHeight = this.contentHeight;\r\n        this.rowsContainer.style.height = this._scrollHeight + \"px\";\r\n        if (!this.scrollableElementUpdateDisposable) {\r\n            this.scrollableElementUpdateDisposable = DOM.scheduleAtNextAnimationFrame(function () {\r\n                _this.scrollableElement.setScrollDimensions({ scrollHeight: _this.scrollHeight });\r\n                _this.updateScrollWidth();\r\n                _this.scrollableElementUpdateDisposable = null;\r\n            });\r\n        }\r\n    };\r\n    ListView.prototype.eventuallyUpdateScrollWidth = function () {\r\n        var _this = this;\r\n        if (!this.horizontalScrolling) {\r\n            return;\r\n        }\r\n        this.scrollableElementWidthDelayer.trigger(function () { return _this.updateScrollWidth(); });\r\n    };\r\n    ListView.prototype.updateScrollWidth = function () {\r\n        if (!this.horizontalScrolling) {\r\n            return;\r\n        }\r\n        if (this.items.length === 0) {\r\n            this.scrollableElement.setScrollDimensions({ scrollWidth: 0 });\r\n        }\r\n        var scrollWidth = 0;\r\n        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\r\n            var item = _a[_i];\r\n            if (typeof item.width !== 'undefined') {\r\n                scrollWidth = Math.max(scrollWidth, item.width);\r\n            }\r\n        }\r\n        this.scrollWidth = scrollWidth;\r\n        this.scrollableElement.setScrollDimensions({ scrollWidth: scrollWidth + 10 });\r\n    };\r\n    ListView.prototype.rerender = function () {\r\n        if (!this.supportDynamicHeights) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\r\n            var item = _a[_i];\r\n            item.lastDynamicHeightWidth = undefined;\r\n        }\r\n        this._rerender(this.lastRenderTop, this.lastRenderHeight);\r\n    };\r\n    Object.defineProperty(ListView.prototype, \"length\", {\r\n        get: function () {\r\n            return this.items.length;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"renderHeight\", {\r\n        get: function () {\r\n            var scrollDimensions = this.scrollableElement.getScrollDimensions();\r\n            return scrollDimensions.height;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ListView.prototype.element = function (index) {\r\n        return this.items[index].element;\r\n    };\r\n    ListView.prototype.domElement = function (index) {\r\n        var row = this.items[index].row;\r\n        return row && row.domNode;\r\n    };\r\n    ListView.prototype.elementHeight = function (index) {\r\n        return this.items[index].size;\r\n    };\r\n    ListView.prototype.elementTop = function (index) {\r\n        return this.rangeMap.positionAt(index);\r\n    };\r\n    ListView.prototype.indexAt = function (position) {\r\n        return this.rangeMap.indexAt(position);\r\n    };\r\n    ListView.prototype.indexAfter = function (position) {\r\n        return this.rangeMap.indexAfter(position);\r\n    };\r\n    ListView.prototype.layout = function (height, width) {\r\n        var scrollDimensions = {\r\n            height: typeof height === 'number' ? height : DOM.getContentHeight(this.domNode)\r\n        };\r\n        if (this.scrollableElementUpdateDisposable) {\r\n            this.scrollableElementUpdateDisposable.dispose();\r\n            this.scrollableElementUpdateDisposable = null;\r\n            scrollDimensions.scrollHeight = this.scrollHeight;\r\n        }\r\n        this.scrollableElement.setScrollDimensions(scrollDimensions);\r\n        if (typeof width !== 'undefined') {\r\n            this.renderWidth = width;\r\n            if (this.supportDynamicHeights) {\r\n                this._rerender(this.scrollTop, this.renderHeight);\r\n            }\r\n            if (this.horizontalScrolling) {\r\n                this.scrollableElement.setScrollDimensions({\r\n                    width: typeof width === 'number' ? width : DOM.getContentWidth(this.domNode)\r\n                });\r\n            }\r\n        }\r\n    };\r\n    // Render\r\n    ListView.prototype.render = function (renderTop, renderHeight, renderLeft, scrollWidth) {\r\n        var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\r\n        var renderRange = this.getRenderRange(renderTop, renderHeight);\r\n        var rangesToInsert = Range.relativeComplement(renderRange, previousRenderRange);\r\n        var rangesToRemove = Range.relativeComplement(previousRenderRange, renderRange);\r\n        var beforeElement = this.getNextToLastElement(rangesToInsert);\r\n        for (var _i = 0, rangesToInsert_1 = rangesToInsert; _i < rangesToInsert_1.length; _i++) {\r\n            var range = rangesToInsert_1[_i];\r\n            for (var i = range.start; i < range.end; i++) {\r\n                this.insertItemInDOM(i, beforeElement);\r\n            }\r\n        }\r\n        for (var _a = 0, rangesToRemove_1 = rangesToRemove; _a < rangesToRemove_1.length; _a++) {\r\n            var range = rangesToRemove_1[_a];\r\n            for (var i = range.start; i < range.end; i++) {\r\n                this.removeItemFromDOM(i);\r\n            }\r\n        }\r\n        this.rowsContainer.style.left = \"-\" + renderLeft + \"px\";\r\n        this.rowsContainer.style.top = \"-\" + renderTop + \"px\";\r\n        if (this.horizontalScrolling) {\r\n            this.rowsContainer.style.width = Math.max(scrollWidth, this.renderWidth) + \"px\";\r\n        }\r\n        this.lastRenderTop = renderTop;\r\n        this.lastRenderHeight = renderHeight;\r\n    };\r\n    // DOM operations\r\n    ListView.prototype.insertItemInDOM = function (index, beforeElement) {\r\n        var _this = this;\r\n        var item = this.items[index];\r\n        if (!item.row) {\r\n            item.row = this.cache.alloc(item.templateId);\r\n            var role = this.ariaProvider.getRole ? this.ariaProvider.getRole(item.element) : 'treeitem';\r\n            item.row.domNode.setAttribute('role', role);\r\n            var checked = this.ariaProvider.isChecked ? this.ariaProvider.isChecked(item.element) : undefined;\r\n            if (typeof checked !== 'undefined') {\r\n                item.row.domNode.setAttribute('aria-checked', String(checked));\r\n            }\r\n        }\r\n        if (!item.row.domNode.parentElement) {\r\n            if (beforeElement) {\r\n                this.rowsContainer.insertBefore(item.row.domNode, beforeElement);\r\n            }\r\n            else {\r\n                this.rowsContainer.appendChild(item.row.domNode);\r\n            }\r\n        }\r\n        this.updateItemInDOM(item, index);\r\n        var renderer = this.renderers.get(item.templateId);\r\n        if (!renderer) {\r\n            throw new Error(\"No renderer found for template id \" + item.templateId);\r\n        }\r\n        if (renderer) {\r\n            renderer.renderElement(item.element, index, item.row.templateData, item.size);\r\n        }\r\n        var uri = this.dnd.getDragURI(item.element);\r\n        item.dragStartDisposable.dispose();\r\n        item.row.domNode.draggable = !!uri;\r\n        if (uri) {\r\n            var onDragStart = domEvent(item.row.domNode, 'dragstart');\r\n            item.dragStartDisposable = onDragStart(function (event) { return _this.onDragStart(item.element, uri, event); });\r\n        }\r\n        if (this.horizontalScrolling) {\r\n            this.measureItemWidth(item);\r\n            this.eventuallyUpdateScrollWidth();\r\n        }\r\n    };\r\n    ListView.prototype.measureItemWidth = function (item) {\r\n        if (!item.row || !item.row.domNode) {\r\n            return;\r\n        }\r\n        item.row.domNode.style.width = isFirefox ? '-moz-fit-content' : 'fit-content';\r\n        item.width = DOM.getContentWidth(item.row.domNode);\r\n        var style = window.getComputedStyle(item.row.domNode);\r\n        if (style.paddingLeft) {\r\n            item.width += parseFloat(style.paddingLeft);\r\n        }\r\n        if (style.paddingRight) {\r\n            item.width += parseFloat(style.paddingRight);\r\n        }\r\n        item.row.domNode.style.width = '';\r\n    };\r\n    ListView.prototype.updateItemInDOM = function (item, index) {\r\n        item.row.domNode.style.top = this.elementTop(index) + \"px\";\r\n        item.row.domNode.style.height = item.size + \"px\";\r\n        if (this.setRowLineHeight) {\r\n            item.row.domNode.style.lineHeight = item.size + \"px\";\r\n        }\r\n        item.row.domNode.setAttribute('data-index', \"\" + index);\r\n        item.row.domNode.setAttribute('data-last-element', index === this.length - 1 ? 'true' : 'false');\r\n        item.row.domNode.setAttribute('aria-setsize', String(this.ariaProvider.getSetSize(item.element, index, this.length)));\r\n        item.row.domNode.setAttribute('aria-posinset', String(this.ariaProvider.getPosInSet(item.element, index)));\r\n        item.row.domNode.setAttribute('id', this.getElementDomId(index));\r\n        DOM.toggleClass(item.row.domNode, 'drop-target', item.dropTarget);\r\n    };\r\n    ListView.prototype.removeItemFromDOM = function (index) {\r\n        var item = this.items[index];\r\n        item.dragStartDisposable.dispose();\r\n        var renderer = this.renderers.get(item.templateId);\r\n        if (renderer && renderer.disposeElement) {\r\n            renderer.disposeElement(item.element, index, item.row.templateData, item.size);\r\n        }\r\n        this.cache.release(item.row);\r\n        item.row = null;\r\n        if (this.horizontalScrolling) {\r\n            this.eventuallyUpdateScrollWidth();\r\n        }\r\n    };\r\n    ListView.prototype.getScrollTop = function () {\r\n        var scrollPosition = this.scrollableElement.getScrollPosition();\r\n        return scrollPosition.scrollTop;\r\n    };\r\n    ListView.prototype.setScrollTop = function (scrollTop) {\r\n        if (this.scrollableElementUpdateDisposable) {\r\n            this.scrollableElementUpdateDisposable.dispose();\r\n            this.scrollableElementUpdateDisposable = null;\r\n            this.scrollableElement.setScrollDimensions({ scrollHeight: this.scrollHeight });\r\n        }\r\n        this.scrollableElement.setScrollPosition({ scrollTop: scrollTop });\r\n    };\r\n    Object.defineProperty(ListView.prototype, \"scrollTop\", {\r\n        get: function () {\r\n            return this.getScrollTop();\r\n        },\r\n        set: function (scrollTop) {\r\n            this.setScrollTop(scrollTop);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"scrollHeight\", {\r\n        get: function () {\r\n            return this._scrollHeight + (this.horizontalScrolling ? 10 : 0) + this.additionalScrollHeight;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onMouseClick\", {\r\n        // Events\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(domEvent(this.domNode, 'click'), function (e) { return _this.toMouseEvent(e); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onMouseDblClick\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(domEvent(this.domNode, 'dblclick'), function (e) { return _this.toMouseEvent(e); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onMouseMiddleClick\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.filter(Event.map(domEvent(this.domNode, 'auxclick'), function (e) { return _this.toMouseEvent(e); }), function (e) { return e.browserEvent.button === 1; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onMouseDown\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(domEvent(this.domNode, 'mousedown'), function (e) { return _this.toMouseEvent(e); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onContextMenu\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(domEvent(this.domNode, 'contextmenu'), function (e) { return _this.toMouseEvent(e); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onTouchStart\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(domEvent(this.domNode, 'touchstart'), function (e) { return _this.toTouchEvent(e); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ListView.prototype, \"onTap\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return Event.map(domEvent(this.rowsContainer, TouchEventType.Tap), function (e) { return _this.toGestureEvent(e); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ListView.prototype.toMouseEvent = function (browserEvent) {\r\n        var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\r\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        var element = item && item.element;\r\n        return { browserEvent: browserEvent, index: index, element: element };\r\n    };\r\n    ListView.prototype.toTouchEvent = function (browserEvent) {\r\n        var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\r\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        var element = item && item.element;\r\n        return { browserEvent: browserEvent, index: index, element: element };\r\n    };\r\n    ListView.prototype.toGestureEvent = function (browserEvent) {\r\n        var index = this.getItemIndexFromEventTarget(browserEvent.initialTarget || null);\r\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        var element = item && item.element;\r\n        return { browserEvent: browserEvent, index: index, element: element };\r\n    };\r\n    ListView.prototype.toDragEvent = function (browserEvent) {\r\n        var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\r\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        var element = item && item.element;\r\n        return { browserEvent: browserEvent, index: index, element: element };\r\n    };\r\n    ListView.prototype.onScroll = function (e) {\r\n        try {\r\n            this.render(e.scrollTop, e.height, e.scrollLeft, e.scrollWidth);\r\n            if (this.supportDynamicHeights) {\r\n                this._rerender(e.scrollTop, e.height);\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.error('Got bad scroll event:', e);\r\n            throw err;\r\n        }\r\n    };\r\n    ListView.prototype.onTouchChange = function (event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        this.scrollTop -= event.translationY;\r\n    };\r\n    // DND\r\n    ListView.prototype.onDragStart = function (element, uri, event) {\r\n        if (!event.dataTransfer) {\r\n            return;\r\n        }\r\n        var elements = this.dnd.getDragElements(element);\r\n        event.dataTransfer.effectAllowed = 'copyMove';\r\n        event.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([uri]));\r\n        if (event.dataTransfer.setDragImage) {\r\n            var label = void 0;\r\n            if (this.dnd.getDragLabel) {\r\n                label = this.dnd.getDragLabel(elements, event);\r\n            }\r\n            if (typeof label === 'undefined') {\r\n                label = String(elements.length);\r\n            }\r\n            var dragImage_1 = DOM.$('.monaco-drag-image');\r\n            dragImage_1.textContent = label;\r\n            document.body.appendChild(dragImage_1);\r\n            event.dataTransfer.setDragImage(dragImage_1, -10, -10);\r\n            setTimeout(function () { return document.body.removeChild(dragImage_1); }, 0);\r\n        }\r\n        this.currentDragData = new ElementsDragAndDropData(elements);\r\n        StaticDND.CurrentDragAndDropData = new ExternalElementsDragAndDropData(elements);\r\n        if (this.dnd.onDragStart) {\r\n            this.dnd.onDragStart(this.currentDragData, event);\r\n        }\r\n    };\r\n    ListView.prototype.onDragOver = function (event) {\r\n        var _this = this;\r\n        event.browserEvent.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\r\n        this.onDragLeaveTimeout.dispose();\r\n        if (StaticDND.CurrentDragAndDropData && StaticDND.CurrentDragAndDropData.getData() === 'vscode-ui') {\r\n            return false;\r\n        }\r\n        this.setupDragAndDropScrollTopAnimation(event.browserEvent);\r\n        if (!event.browserEvent.dataTransfer) {\r\n            return false;\r\n        }\r\n        // Drag over from outside\r\n        if (!this.currentDragData) {\r\n            if (StaticDND.CurrentDragAndDropData) {\r\n                // Drag over from another list\r\n                this.currentDragData = StaticDND.CurrentDragAndDropData;\r\n            }\r\n            else {\r\n                // Drag over from the desktop\r\n                if (!event.browserEvent.dataTransfer.types) {\r\n                    return false;\r\n                }\r\n                this.currentDragData = new DesktopDragAndDropData();\r\n            }\r\n        }\r\n        var result = this.dnd.onDragOver(this.currentDragData, event.element, event.index, event.browserEvent);\r\n        this.canDrop = typeof result === 'boolean' ? result : result.accept;\r\n        if (!this.canDrop) {\r\n            this.currentDragFeedback = undefined;\r\n            this.currentDragFeedbackDisposable.dispose();\r\n            return false;\r\n        }\r\n        event.browserEvent.dataTransfer.dropEffect = (typeof result !== 'boolean' && result.effect === 0 /* Copy */) ? 'copy' : 'move';\r\n        var feedback;\r\n        if (typeof result !== 'boolean' && result.feedback) {\r\n            feedback = result.feedback;\r\n        }\r\n        else {\r\n            if (typeof event.index === 'undefined') {\r\n                feedback = [-1];\r\n            }\r\n            else {\r\n                feedback = [event.index];\r\n            }\r\n        }\r\n        // sanitize feedback list\r\n        feedback = distinct(feedback).filter(function (i) { return i >= -1 && i < _this.length; }).sort(function (a, b) { return a - b; });\r\n        feedback = feedback[0] === -1 ? [-1] : feedback;\r\n        if (equalsDragFeedback(this.currentDragFeedback, feedback)) {\r\n            return true;\r\n        }\r\n        this.currentDragFeedback = feedback;\r\n        this.currentDragFeedbackDisposable.dispose();\r\n        if (feedback[0] === -1) { // entire list feedback\r\n            DOM.addClass(this.domNode, 'drop-target');\r\n            DOM.addClass(this.rowsContainer, 'drop-target');\r\n            this.currentDragFeedbackDisposable = toDisposable(function () {\r\n                DOM.removeClass(_this.domNode, 'drop-target');\r\n                DOM.removeClass(_this.rowsContainer, 'drop-target');\r\n            });\r\n        }\r\n        else {\r\n            for (var _i = 0, feedback_1 = feedback; _i < feedback_1.length; _i++) {\r\n                var index = feedback_1[_i];\r\n                var item = this.items[index];\r\n                item.dropTarget = true;\r\n                if (item.row && item.row.domNode) {\r\n                    DOM.addClass(item.row.domNode, 'drop-target');\r\n                }\r\n            }\r\n            this.currentDragFeedbackDisposable = toDisposable(function () {\r\n                for (var _i = 0, feedback_2 = feedback; _i < feedback_2.length; _i++) {\r\n                    var index = feedback_2[_i];\r\n                    var item = _this.items[index];\r\n                    item.dropTarget = false;\r\n                    if (item.row && item.row.domNode) {\r\n                        DOM.removeClass(item.row.domNode, 'drop-target');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        return true;\r\n    };\r\n    ListView.prototype.onDragLeave = function () {\r\n        var _this = this;\r\n        this.onDragLeaveTimeout.dispose();\r\n        this.onDragLeaveTimeout = disposableTimeout(function () { return _this.clearDragOverFeedback(); }, 100);\r\n    };\r\n    ListView.prototype.onDrop = function (event) {\r\n        if (!this.canDrop) {\r\n            return;\r\n        }\r\n        var dragData = this.currentDragData;\r\n        this.teardownDragAndDropScrollTopAnimation();\r\n        this.clearDragOverFeedback();\r\n        this.currentDragData = undefined;\r\n        StaticDND.CurrentDragAndDropData = undefined;\r\n        if (!dragData || !event.browserEvent.dataTransfer) {\r\n            return;\r\n        }\r\n        event.browserEvent.preventDefault();\r\n        dragData.update(event.browserEvent.dataTransfer);\r\n        this.dnd.drop(dragData, event.element, event.index, event.browserEvent);\r\n    };\r\n    ListView.prototype.onDragEnd = function (event) {\r\n        this.canDrop = false;\r\n        this.teardownDragAndDropScrollTopAnimation();\r\n        this.clearDragOverFeedback();\r\n        this.currentDragData = undefined;\r\n        StaticDND.CurrentDragAndDropData = undefined;\r\n        if (this.dnd.onDragEnd) {\r\n            this.dnd.onDragEnd(event);\r\n        }\r\n    };\r\n    ListView.prototype.clearDragOverFeedback = function () {\r\n        this.currentDragFeedback = undefined;\r\n        this.currentDragFeedbackDisposable.dispose();\r\n        this.currentDragFeedbackDisposable = Disposable.None;\r\n    };\r\n    // DND scroll top animation\r\n    ListView.prototype.setupDragAndDropScrollTopAnimation = function (event) {\r\n        var _this = this;\r\n        if (!this.dragOverAnimationDisposable) {\r\n            var viewTop = DOM.getTopLeftOffset(this.domNode).top;\r\n            this.dragOverAnimationDisposable = DOM.animate(this.animateDragAndDropScrollTop.bind(this, viewTop));\r\n        }\r\n        this.dragOverAnimationStopDisposable.dispose();\r\n        this.dragOverAnimationStopDisposable = disposableTimeout(function () {\r\n            if (_this.dragOverAnimationDisposable) {\r\n                _this.dragOverAnimationDisposable.dispose();\r\n                _this.dragOverAnimationDisposable = undefined;\r\n            }\r\n        }, 1000);\r\n        this.dragOverMouseY = event.pageY;\r\n    };\r\n    ListView.prototype.animateDragAndDropScrollTop = function (viewTop) {\r\n        if (this.dragOverMouseY === undefined) {\r\n            return;\r\n        }\r\n        var diff = this.dragOverMouseY - viewTop;\r\n        var upperLimit = this.renderHeight - 35;\r\n        if (diff < 35) {\r\n            this.scrollTop += Math.max(-14, Math.floor(0.3 * (diff - 35)));\r\n        }\r\n        else if (diff > upperLimit) {\r\n            this.scrollTop += Math.min(14, Math.floor(0.3 * (diff - upperLimit)));\r\n        }\r\n    };\r\n    ListView.prototype.teardownDragAndDropScrollTopAnimation = function () {\r\n        this.dragOverAnimationStopDisposable.dispose();\r\n        if (this.dragOverAnimationDisposable) {\r\n            this.dragOverAnimationDisposable.dispose();\r\n            this.dragOverAnimationDisposable = undefined;\r\n        }\r\n    };\r\n    // Util\r\n    ListView.prototype.getItemIndexFromEventTarget = function (target) {\r\n        var element = target;\r\n        while (element instanceof HTMLElement && element !== this.rowsContainer) {\r\n            var rawIndex = element.getAttribute('data-index');\r\n            if (rawIndex) {\r\n                var index = Number(rawIndex);\r\n                if (!isNaN(index)) {\r\n                    return index;\r\n                }\r\n            }\r\n            element = element.parentElement;\r\n        }\r\n        return undefined;\r\n    };\r\n    ListView.prototype.getRenderRange = function (renderTop, renderHeight) {\r\n        return {\r\n            start: this.rangeMap.indexAt(renderTop),\r\n            end: this.rangeMap.indexAfter(renderTop + renderHeight - 1)\r\n        };\r\n    };\r\n    /**\r\n     * Given a stable rendered state, checks every rendered element whether it needs\r\n     * to be probed for dynamic height. Adjusts scroll height and top if necessary.\r\n     */\r\n    ListView.prototype._rerender = function (renderTop, renderHeight) {\r\n        var previousRenderRange = this.getRenderRange(renderTop, renderHeight);\r\n        // Let's remember the second element's position, this helps in scrolling up\r\n        // and preserving a linear upwards scroll movement\r\n        var anchorElementIndex;\r\n        var anchorElementTopDelta;\r\n        if (renderTop === this.elementTop(previousRenderRange.start)) {\r\n            anchorElementIndex = previousRenderRange.start;\r\n            anchorElementTopDelta = 0;\r\n        }\r\n        else if (previousRenderRange.end - previousRenderRange.start > 1) {\r\n            anchorElementIndex = previousRenderRange.start + 1;\r\n            anchorElementTopDelta = this.elementTop(anchorElementIndex) - renderTop;\r\n        }\r\n        var heightDiff = 0;\r\n        while (true) {\r\n            var renderRange = this.getRenderRange(renderTop, renderHeight);\r\n            var didChange = false;\r\n            for (var i = renderRange.start; i < renderRange.end; i++) {\r\n                var diff = this.probeDynamicHeight(i);\r\n                if (diff !== 0) {\r\n                    this.rangeMap.splice(i, 1, [this.items[i]]);\r\n                }\r\n                heightDiff += diff;\r\n                didChange = didChange || diff !== 0;\r\n            }\r\n            if (!didChange) {\r\n                if (heightDiff !== 0) {\r\n                    this.eventuallyUpdateScrollDimensions();\r\n                }\r\n                var unrenderRanges = Range.relativeComplement(previousRenderRange, renderRange);\r\n                for (var _i = 0, unrenderRanges_1 = unrenderRanges; _i < unrenderRanges_1.length; _i++) {\r\n                    var range = unrenderRanges_1[_i];\r\n                    for (var i = range.start; i < range.end; i++) {\r\n                        if (this.items[i].row) {\r\n                            this.removeItemFromDOM(i);\r\n                        }\r\n                    }\r\n                }\r\n                var renderRanges = Range.relativeComplement(renderRange, previousRenderRange);\r\n                for (var _a = 0, renderRanges_1 = renderRanges; _a < renderRanges_1.length; _a++) {\r\n                    var range = renderRanges_1[_a];\r\n                    for (var i = range.start; i < range.end; i++) {\r\n                        var afterIndex = i + 1;\r\n                        var beforeRow = afterIndex < this.items.length ? this.items[afterIndex].row : null;\r\n                        var beforeElement = beforeRow ? beforeRow.domNode : null;\r\n                        this.insertItemInDOM(i, beforeElement);\r\n                    }\r\n                }\r\n                for (var i = renderRange.start; i < renderRange.end; i++) {\r\n                    if (this.items[i].row) {\r\n                        this.updateItemInDOM(this.items[i], i);\r\n                    }\r\n                }\r\n                if (typeof anchorElementIndex === 'number') {\r\n                    this.scrollTop = this.elementTop(anchorElementIndex) - anchorElementTopDelta;\r\n                }\r\n                this._onDidChangeContentHeight.fire(this.contentHeight);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n    ListView.prototype.probeDynamicHeight = function (index) {\r\n        var item = this.items[index];\r\n        if (!item.hasDynamicHeight || item.lastDynamicHeightWidth === this.renderWidth) {\r\n            return 0;\r\n        }\r\n        var size = item.size;\r\n        var row = this.cache.alloc(item.templateId);\r\n        row.domNode.style.height = '';\r\n        this.rowsContainer.appendChild(row.domNode);\r\n        var renderer = this.renderers.get(item.templateId);\r\n        if (renderer) {\r\n            renderer.renderElement(item.element, index, row.templateData, undefined);\r\n            if (renderer.disposeElement) {\r\n                renderer.disposeElement(item.element, index, row.templateData, undefined);\r\n            }\r\n        }\r\n        item.size = row.domNode.offsetHeight;\r\n        if (this.virtualDelegate.setDynamicHeight) {\r\n            this.virtualDelegate.setDynamicHeight(item.element, item.size);\r\n        }\r\n        item.lastDynamicHeightWidth = this.renderWidth;\r\n        this.rowsContainer.removeChild(row.domNode);\r\n        this.cache.release(row);\r\n        return item.size - size;\r\n    };\r\n    ListView.prototype.getNextToLastElement = function (ranges) {\r\n        var lastRange = ranges[ranges.length - 1];\r\n        if (!lastRange) {\r\n            return null;\r\n        }\r\n        var nextToLastItem = this.items[lastRange.end];\r\n        if (!nextToLastItem) {\r\n            return null;\r\n        }\r\n        if (!nextToLastItem.row) {\r\n            return null;\r\n        }\r\n        return nextToLastItem.row.domNode;\r\n    };\r\n    ListView.prototype.getElementDomId = function (index) {\r\n        return this.domId + \"_\" + index;\r\n    };\r\n    // Dispose\r\n    ListView.prototype.dispose = function () {\r\n        if (this.items) {\r\n            for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\r\n                var item = _a[_i];\r\n                if (item.row) {\r\n                    var renderer = this.renderers.get(item.row.templateId);\r\n                    if (renderer) {\r\n                        renderer.disposeTemplate(item.row.templateData);\r\n                    }\r\n                }\r\n            }\r\n            this.items = [];\r\n        }\r\n        if (this.domNode && this.domNode.parentNode) {\r\n            this.domNode.parentNode.removeChild(this.domNode);\r\n        }\r\n        dispose(this.disposables);\r\n    };\r\n    ListView.InstanceCount = 0;\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onMouseClick\", null);\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onMouseDblClick\", null);\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onMouseMiddleClick\", null);\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onMouseDown\", null);\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onContextMenu\", null);\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onTouchStart\", null);\r\n    __decorate([\r\n        memoize\r\n    ], ListView.prototype, \"onTap\", null);\r\n    return ListView;\r\n}());\r\nexport { ListView };\r\n"]},"metadata":{},"sourceType":"module"}