{"ast":null,"code":"var _jsxFileName = \"/Users/ifudata/eclipse-workspace/screen-web/src/components/Editor/CanvasPanel/index.js\";\nimport React, { Component } from 'react';\nimport classnames from 'classnames';\nimport { connect } from 'react-redux';\nimport ReactEcharts from 'echarts-for-react';\nimport { Slider, InputNumber } from 'antd';\nimport { Rnd } from 'react-rnd';\nimport { changeItem } from '../../../store/actions/screen-actions';\n\nclass CanvasPanel extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      editorSize: 100\n    };\n\n    this.editorSizeChange = value => {\n      this.setState({\n        editorSize: value\n      });\n    };\n\n    this.onWheel = event => {\n      // console.log(event)\n      // console.log(event.nativeEvent)\n      if (event.ctrlKey) {\n        // event.deltaY 正值向上滚动，负值为向下滚动\n        // event.clientX 鼠标距离浏览器可视区左侧距离\n        // event.screenX 鼠标距离显示器左侧的距离\n        // event.pageX 鼠标距离document左侧的距离\n        var editorSize = this.state.editorSize + event.deltaY;\n\n        if (editorSize < this.props.min) {\n          editorSize = this.props.min;\n        } else if (editorSize > this.props.max) {\n          editorSize = this.props.max;\n        }\n\n        this.setState({\n          editorSize\n        });\n      }\n    };\n\n    this.getStatusData = () => {\n      // console.log(this.editorWrap)\n      if (!this.editorWrap) {\n        return {\n          editorScale: 1,\n          editorInnerWidth: 1920,\n          editorInnerHeight: 1080,\n          editorInnerPaddingVertical: 50,\n          editorInnerPaddingHorizontal: 50\n        };\n      }\n\n      ;\n      let editorWrapWidth = this.editorWrap.offsetWidth;\n      let editorWrapHeight = this.editorWrap.offsetHeight;\n      let editorScale;\n      let editorInnerWidth;\n      let editorInnerHeight;\n      let editorInnerPaddingVertical;\n      let editorInnerPaddingHorizontal;\n      const {\n        editorWidth,\n        editorHeight\n      } = this.props;\n      editorScale = (this.state.editorSize / 100).toFixed(1);\n      editorInnerWidth = Math.round(editorWidth * editorScale);\n      editorInnerHeight = Math.round(editorHeight * editorScale);\n\n      if (editorInnerHeight + 100 < editorWrapHeight) {\n        editorInnerPaddingVertical = Math.floor((editorWrapHeight - editorInnerHeight) / 2);\n      } else {\n        editorInnerPaddingVertical = 50;\n      }\n\n      if (editorInnerWidth + 100 < editorWrapWidth) {\n        editorInnerPaddingHorizontal = Math.floor((editorWrapWidth - editorInnerHeight) / 2);\n      } else {\n        editorInnerPaddingHorizontal = 50;\n      }\n\n      return {\n        editorScale,\n        editorInnerWidth,\n        editorInnerHeight,\n        editorInnerPaddingVertical,\n        editorInnerPaddingHorizontal\n      };\n    };\n\n    this.itemDragStop = (id, e, d) => {\n      // console.log(e)\n      // console.log(d)\n      this.props.changeItem({\n        id,\n        data: {\n          style: {\n            x: d.x,\n            y: d.y\n          }\n        }\n      });\n    };\n\n    this.itemResizeStop = (id, e, direction, ref, delta, position) => {\n      // console.log(ref.style)\n      // console.log(\"direction\",direction)\n      // console.log(\"delta\",delta)\n      // console.log(\"position\",position)\n      this.props.changeItem({\n        id,\n        data: {\n          style: {\n            width: ref.style.width,\n            height: ref.style.height,\n            ...position\n          }\n        }\n      });\n    };\n  }\n\n  componentDidMount() {\n    const {\n      editorWidth\n    } = this.props;\n    const editorWrapWidth = this.editorWrap.offsetWidth; // console.log(editorWrapWidth)\n\n    const editorSize = Math.round((editorWrapWidth - 100) / editorWidth * 100);\n    this.setState({\n      editorSize: editorSize\n    });\n  }\n\n  render() {\n    const {\n      editorWidth,\n      editorHeight\n    } = this.props;\n    const {\n      editorScale,\n      editorInnerWidth,\n      editorInnerHeight,\n      editorInnerPaddingVertical,\n      editorInnerPaddingHorizontal\n    } = this.getStatusData();\n    return React.createElement(\"div\", {\n      className: classnames(\"canvas-panel\", this.props.status),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"canvas-editor-wrap\",\n      ref: dom => {\n        this.editorWrap = dom;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"canvas-editor-inner\",\n      style: {\n        width: editorInnerWidth,\n        height: editorInnerHeight,\n        paddingTop: editorInnerPaddingVertical,\n        paddingBottom: editorInnerPaddingVertical,\n        paddingLeft: editorInnerPaddingHorizontal,\n        paddingRight: editorInnerPaddingHorizontal\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"canvas-editor\",\n      onWheel: this.onWheel,\n      style: {\n        width: editorWidth,\n        height: editorHeight,\n        transform: `scale(${editorScale})`,\n        transformOrigin: \"left top 0px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, this.props.modules.toJS().map((item, index) => {\n      return React.createElement(Rnd, {\n        key: item.id,\n        size: {\n          width: item.style.width,\n          height: item.style.height\n        },\n        position: {\n          x: item.style.x,\n          y: item.style.y\n        },\n        scale: editorScale,\n        onDragStop: this.itemDragStop.bind(this, item.id),\n        onResizeStop: this.itemResizeStop.bind(this, item.id),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"modules-wrap\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(ReactEcharts, {\n        option: item.options,\n        style: {\n          width: item.style.width,\n          height: item.style.height\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      })));\n    })))), React.createElement(\"div\", {\n      className: \"canvas-status\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"status-bar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }, React.createElement(InputNumber, {\n      min: this.props.min,\n      max: this.props.max,\n      size: \"small\",\n      style: {\n        width: 70,\n        float: \"right\",\n        marginTop: 3,\n        marginRight: 5\n      },\n      value: this.state.editorSize,\n      formatter: value => `${value}%`,\n      onChange: this.editorSizeChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }), React.createElement(Slider, {\n      min: this.props.min,\n      max: this.props.max,\n      tooltipVisible: false,\n      style: {\n        width: 100,\n        float: \"right\",\n        marginRight: 10\n      },\n      onChange: this.editorSizeChange,\n      value: this.state.editorSize,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nCanvasPanel.defaultProps = {\n  min: 10,\n  max: 400\n};\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    editorHeight: state.screenState.getIn([\"screen\", \"height\"]),\n    editorWidth: state.screenState.getIn([\"screen\", \"width\"]),\n    modules: state.screenState.get(\"modules\")\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    changeItem(data) {\n      const action = changeItem(data);\n      dispatch(action);\n    }\n\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CanvasPanel);","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/src/components/Editor/CanvasPanel/index.js"],"names":["React","Component","classnames","connect","ReactEcharts","Slider","InputNumber","Rnd","changeItem","CanvasPanel","state","editorSize","editorSizeChange","value","setState","onWheel","event","ctrlKey","deltaY","props","min","max","getStatusData","editorWrap","editorScale","editorInnerWidth","editorInnerHeight","editorInnerPaddingVertical","editorInnerPaddingHorizontal","editorWrapWidth","offsetWidth","editorWrapHeight","offsetHeight","editorWidth","editorHeight","toFixed","Math","round","floor","itemDragStop","id","e","d","data","style","x","y","itemResizeStop","direction","ref","delta","position","width","height","componentDidMount","render","status","dom","paddingTop","paddingBottom","paddingLeft","paddingRight","transform","transformOrigin","modules","toJS","map","item","index","bind","options","float","marginTop","marginRight","defaultProps","mapStateToProps","ownProps","screenState","getIn","get","mapDispatchToProps","dispatch","action"],"mappings":"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","sourcesContent":["import React,{ Component } from 'react'\nimport classnames from 'classnames'\nimport { connect } from 'react-redux'\nimport ReactEcharts from 'echarts-for-react';\nimport { Slider, InputNumber } from 'antd'\nimport { Rnd } from 'react-rnd';\nimport { changeItem } from '../../../store/actions/screen-actions'\n\nclass CanvasPanel extends Component{\n    state = {\n        editorSize:100\n    }\n\n    static defaultProps = {\n        min:10,\n        max:400\n    }\n\n    editorSizeChange = (value)=>{\n        this.setState({\n            editorSize:value\n        })\n    }\n    onWheel = (event)=>{\n        // console.log(event)\n        // console.log(event.nativeEvent)\n        if(event.ctrlKey){\n            // event.deltaY 正值向上滚动，负值为向下滚动\n            // event.clientX 鼠标距离浏览器可视区左侧距离\n            // event.screenX 鼠标距离显示器左侧的距离\n            // event.pageX 鼠标距离document左侧的距离\n            var editorSize = this.state.editorSize+event.deltaY\n            if(editorSize<this.props.min){\n                editorSize = this.props.min\n            }else if(editorSize>this.props.max){\n                editorSize = this.props.max\n            }\n            this.setState({ editorSize })\n        }\n    }\n    getStatusData = ()=>{\n        // console.log(this.editorWrap)\n        if(!this.editorWrap){\n            return {\n                editorScale:1,\n                editorInnerWidth:1920,\n                editorInnerHeight:1080,\n                editorInnerPaddingVertical:50,\n                editorInnerPaddingHorizontal:50\n            }\n        };\n        let editorWrapWidth = this.editorWrap.offsetWidth\n        let editorWrapHeight = this.editorWrap.offsetHeight\n        let editorScale\n        let editorInnerWidth\n        let editorInnerHeight\n        let editorInnerPaddingVertical\n        let editorInnerPaddingHorizontal\n        const { editorWidth,editorHeight } = this.props\n        editorScale = (this.state.editorSize/100).toFixed(1)\n        editorInnerWidth = Math.round(editorWidth*editorScale)\n        editorInnerHeight = Math.round(editorHeight*editorScale)\n        if(editorInnerHeight+100<editorWrapHeight){\n            editorInnerPaddingVertical=Math.floor((editorWrapHeight-editorInnerHeight)/2)\n        }else{\n            editorInnerPaddingVertical = 50\n        }\n\n        if(editorInnerWidth+100<editorWrapWidth){\n            editorInnerPaddingHorizontal=Math.floor((editorWrapWidth-editorInnerHeight)/2)\n        }else{\n            editorInnerPaddingHorizontal = 50\n        }\n        return {\n            editorScale,\n            editorInnerWidth,\n            editorInnerHeight,\n            editorInnerPaddingVertical,\n            editorInnerPaddingHorizontal\n        }\n    }\n    itemDragStop = (id,e,d)=>{\n        // console.log(e)\n        // console.log(d)\n        this.props.changeItem({\n            id,\n            data:{\n                style:{\n                    x:d.x,\n                    y:d.y\n                }\n            }\n        })\n    }\n    itemResizeStop = (id,e,direction,ref,delta,position)=>{\n        // console.log(ref.style)\n        // console.log(\"direction\",direction)\n        // console.log(\"delta\",delta)\n        // console.log(\"position\",position)\n        this.props.changeItem({\n            id,\n            data:{\n                style:{\n                    width:ref.style.width,\n                    height:ref.style.height,\n                    ...position\n                }\n            }\n        })\n    }\n    componentDidMount(){\n        const { editorWidth } = this.props\n        const editorWrapWidth = this.editorWrap.offsetWidth\n        // console.log(editorWrapWidth)\n        const editorSize = Math.round((editorWrapWidth-100)/editorWidth*100)\n        \n        this.setState({\n            editorSize:editorSize\n        })\n    }\n    render(){\n        const { editorWidth,editorHeight } = this.props\n        const { \n            editorScale,\n            editorInnerWidth,\n            editorInnerHeight,\n            editorInnerPaddingVertical,\n            editorInnerPaddingHorizontal \n        } = this.getStatusData()\n        return(\n            <div className={classnames(\"canvas-panel\",this.props.status)}>\n                <div \n                    className=\"canvas-editor-wrap\"\n                    ref={dom=>{this.editorWrap=dom}}\n                >\n                    <div \n                        className=\"canvas-editor-inner\"\n                        style={{\n                            width:editorInnerWidth,\n                            height:editorInnerHeight,\n                            paddingTop:editorInnerPaddingVertical,\n                            paddingBottom:editorInnerPaddingVertical,\n                            paddingLeft:editorInnerPaddingHorizontal,\n                            paddingRight:editorInnerPaddingHorizontal\n                        }}\n                    >\n                        <div \n                            className=\"canvas-editor\"\n                            onWheel={this.onWheel}\n                            style={{\n                                width:editorWidth,\n                                height:editorHeight,\n                                transform:`scale(${editorScale})`,\n                                transformOrigin:\"left top 0px\"\n                            }}\n                        >\n                            \n                            {\n                                this.props.modules.toJS().map((item,index)=>{\n                                    return <Rnd\n                                        key={item.id}\n                                        size={{\n                                            width:item.style.width,\n                                            height:item.style.height\n                                        }}\n                                        position={{\n                                            x:item.style.x,\n                                            y:item.style.y\n                                        }}\n                                        scale={editorScale}\n                                        onDragStop={this.itemDragStop.bind(this,item.id)}\n                                        onResizeStop={this.itemResizeStop.bind(this,item.id)}\n                                    >\n                                        <div className=\"modules-wrap\">\n                                            <ReactEcharts\n                                                option={item.options}\n                                                style={{\n                                                    width:item.style.width,\n                                                    height:item.style.height\n                                                }}\n                                            />\n                                        </div>\n                                    </Rnd>\n                                })\n                            }\n                        </div>\n                    </div>\n                </div>\n                <div className=\"canvas-status\">\n                    <div className=\"status-bar\">\n                        <InputNumber\n                            min={this.props.min}\n                            max={this.props.max}\n                            size=\"small\"\n                            style={{width:70,float:\"right\",marginTop:3,marginRight:5}}\n                            value={this.state.editorSize}\n                            formatter={value=>`${value}%`}\n                            onChange={this.editorSizeChange}\n                        />\n                        <Slider\n                            min={this.props.min}\n                            max={this.props.max}\n                            tooltipVisible={false}\n                            style={{width:100,float:\"right\",marginRight:10}}\n                            onChange={this.editorSizeChange}\n                            value={this.state.editorSize}\n                        />\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\nconst mapStateToProps = (state,ownProps)=>{\n    return {\n        editorHeight:state.screenState.getIn([\"screen\",\"height\"]),\n        editorWidth:state.screenState.getIn([\"screen\",\"width\"]),\n        modules:state.screenState.get(\"modules\")\n    }\n}\nconst mapDispatchToProps = dispatch=>{\n    return {\n        changeItem(data){\n            const action = changeItem(data)\n            dispatch(action)\n        }\n    }\n}\nexport default connect(mapStateToProps,mapDispatchToProps)(CanvasPanel);"]},"metadata":{},"sourceType":"module"}