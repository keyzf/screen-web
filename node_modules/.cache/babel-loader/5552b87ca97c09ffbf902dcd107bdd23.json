{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { toDisposable } from '../../../base/common/lifecycle.js';\nimport { score } from './languageSelector.js';\nimport { shouldSynchronizeModel } from '../services/modelService.js';\n\nfunction isExclusive(selector) {\n  if (typeof selector === 'string') {\n    return false;\n  } else if (Array.isArray(selector)) {\n    return selector.every(isExclusive);\n  } else {\n    return !!selector.exclusive;\n  }\n}\n\nvar LanguageFeatureRegistry =\n/** @class */\nfunction () {\n  function LanguageFeatureRegistry() {\n    this._clock = 0;\n    this._entries = [];\n    this._onDidChange = new Emitter();\n  }\n\n  Object.defineProperty(LanguageFeatureRegistry.prototype, \"onDidChange\", {\n    get: function () {\n      return this._onDidChange.event;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  LanguageFeatureRegistry.prototype.register = function (selector, provider) {\n    var _this = this;\n\n    var entry = {\n      selector: selector,\n      provider: provider,\n      _score: -1,\n      _time: this._clock++\n    };\n\n    this._entries.push(entry);\n\n    this._lastCandidate = undefined;\n\n    this._onDidChange.fire(this._entries.length);\n\n    return toDisposable(function () {\n      if (entry) {\n        var idx = _this._entries.indexOf(entry);\n\n        if (idx >= 0) {\n          _this._entries.splice(idx, 1);\n\n          _this._lastCandidate = undefined;\n\n          _this._onDidChange.fire(_this._entries.length);\n\n          entry = undefined;\n        }\n      }\n    });\n  };\n\n  LanguageFeatureRegistry.prototype.has = function (model) {\n    return this.all(model).length > 0;\n  };\n\n  LanguageFeatureRegistry.prototype.all = function (model) {\n    if (!model) {\n      return [];\n    }\n\n    this._updateScores(model);\n\n    var result = []; // from registry\n\n    for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\n      var entry = _a[_i];\n\n      if (entry._score > 0) {\n        result.push(entry.provider);\n      }\n    }\n\n    return result;\n  };\n\n  LanguageFeatureRegistry.prototype.ordered = function (model) {\n    var result = [];\n\n    this._orderedForEach(model, function (entry) {\n      return result.push(entry.provider);\n    });\n\n    return result;\n  };\n\n  LanguageFeatureRegistry.prototype.orderedGroups = function (model) {\n    var result = [];\n    var lastBucket;\n    var lastBucketScore;\n\n    this._orderedForEach(model, function (entry) {\n      if (lastBucket && lastBucketScore === entry._score) {\n        lastBucket.push(entry.provider);\n      } else {\n        lastBucketScore = entry._score;\n        lastBucket = [entry.provider];\n        result.push(lastBucket);\n      }\n    });\n\n    return result;\n  };\n\n  LanguageFeatureRegistry.prototype._orderedForEach = function (model, callback) {\n    if (!model) {\n      return;\n    }\n\n    this._updateScores(model);\n\n    for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\n      var entry = _a[_i];\n\n      if (entry._score > 0) {\n        callback(entry);\n      }\n    }\n  };\n\n  LanguageFeatureRegistry.prototype._updateScores = function (model) {\n    var candidate = {\n      uri: model.uri.toString(),\n      language: model.getLanguageIdentifier().language\n    };\n\n    if (this._lastCandidate && this._lastCandidate.language === candidate.language && this._lastCandidate.uri === candidate.uri) {\n      // nothing has changed\n      return;\n    }\n\n    this._lastCandidate = candidate;\n\n    for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\n      var entry = _a[_i];\n      entry._score = score(entry.selector, model.uri, model.getLanguageIdentifier().language, shouldSynchronizeModel(model));\n\n      if (isExclusive(entry.selector) && entry._score > 0) {\n        // support for one exclusive selector that overwrites\n        // any other selector\n        for (var _b = 0, _c = this._entries; _b < _c.length; _b++) {\n          var entry_1 = _c[_b];\n          entry_1._score = 0;\n        }\n\n        entry._score = 1000;\n        break;\n      }\n    } // needs sorting\n\n\n    this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\n  };\n\n  LanguageFeatureRegistry._compareByScoreAndTime = function (a, b) {\n    if (a._score < b._score) {\n      return 1;\n    } else if (a._score > b._score) {\n      return -1;\n    } else if (a._time < b._time) {\n      return 1;\n    } else if (a._time > b._time) {\n      return -1;\n    } else {\n      return 0;\n    }\n  };\n\n  return LanguageFeatureRegistry;\n}();\n\nexport { LanguageFeatureRegistry };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/common/modes/languageFeatureRegistry.js"],"names":["Emitter","toDisposable","score","shouldSynchronizeModel","isExclusive","selector","Array","isArray","every","exclusive","LanguageFeatureRegistry","_clock","_entries","_onDidChange","Object","defineProperty","prototype","get","event","enumerable","configurable","register","provider","_this","entry","_score","_time","push","_lastCandidate","undefined","fire","length","idx","indexOf","splice","has","model","all","_updateScores","result","_i","_a","ordered","_orderedForEach","orderedGroups","lastBucket","lastBucketScore","callback","candidate","uri","toString","language","getLanguageIdentifier","_b","_c","entry_1","sort","_compareByScoreAndTime","a","b"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { toDisposable } from '../../../base/common/lifecycle.js';\r\nimport { score } from './languageSelector.js';\r\nimport { shouldSynchronizeModel } from '../services/modelService.js';\r\nfunction isExclusive(selector) {\r\n    if (typeof selector === 'string') {\r\n        return false;\r\n    }\r\n    else if (Array.isArray(selector)) {\r\n        return selector.every(isExclusive);\r\n    }\r\n    else {\r\n        return !!selector.exclusive;\r\n    }\r\n}\r\nvar LanguageFeatureRegistry = /** @class */ (function () {\r\n    function LanguageFeatureRegistry() {\r\n        this._clock = 0;\r\n        this._entries = [];\r\n        this._onDidChange = new Emitter();\r\n    }\r\n    Object.defineProperty(LanguageFeatureRegistry.prototype, \"onDidChange\", {\r\n        get: function () {\r\n            return this._onDidChange.event;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LanguageFeatureRegistry.prototype.register = function (selector, provider) {\r\n        var _this = this;\r\n        var entry = {\r\n            selector: selector,\r\n            provider: provider,\r\n            _score: -1,\r\n            _time: this._clock++\r\n        };\r\n        this._entries.push(entry);\r\n        this._lastCandidate = undefined;\r\n        this._onDidChange.fire(this._entries.length);\r\n        return toDisposable(function () {\r\n            if (entry) {\r\n                var idx = _this._entries.indexOf(entry);\r\n                if (idx >= 0) {\r\n                    _this._entries.splice(idx, 1);\r\n                    _this._lastCandidate = undefined;\r\n                    _this._onDidChange.fire(_this._entries.length);\r\n                    entry = undefined;\r\n                }\r\n            }\r\n        });\r\n    };\r\n    LanguageFeatureRegistry.prototype.has = function (model) {\r\n        return this.all(model).length > 0;\r\n    };\r\n    LanguageFeatureRegistry.prototype.all = function (model) {\r\n        if (!model) {\r\n            return [];\r\n        }\r\n        this._updateScores(model);\r\n        var result = [];\r\n        // from registry\r\n        for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\r\n            var entry = _a[_i];\r\n            if (entry._score > 0) {\r\n                result.push(entry.provider);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    LanguageFeatureRegistry.prototype.ordered = function (model) {\r\n        var result = [];\r\n        this._orderedForEach(model, function (entry) { return result.push(entry.provider); });\r\n        return result;\r\n    };\r\n    LanguageFeatureRegistry.prototype.orderedGroups = function (model) {\r\n        var result = [];\r\n        var lastBucket;\r\n        var lastBucketScore;\r\n        this._orderedForEach(model, function (entry) {\r\n            if (lastBucket && lastBucketScore === entry._score) {\r\n                lastBucket.push(entry.provider);\r\n            }\r\n            else {\r\n                lastBucketScore = entry._score;\r\n                lastBucket = [entry.provider];\r\n                result.push(lastBucket);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    LanguageFeatureRegistry.prototype._orderedForEach = function (model, callback) {\r\n        if (!model) {\r\n            return;\r\n        }\r\n        this._updateScores(model);\r\n        for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\r\n            var entry = _a[_i];\r\n            if (entry._score > 0) {\r\n                callback(entry);\r\n            }\r\n        }\r\n    };\r\n    LanguageFeatureRegistry.prototype._updateScores = function (model) {\r\n        var candidate = {\r\n            uri: model.uri.toString(),\r\n            language: model.getLanguageIdentifier().language\r\n        };\r\n        if (this._lastCandidate\r\n            && this._lastCandidate.language === candidate.language\r\n            && this._lastCandidate.uri === candidate.uri) {\r\n            // nothing has changed\r\n            return;\r\n        }\r\n        this._lastCandidate = candidate;\r\n        for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\r\n            var entry = _a[_i];\r\n            entry._score = score(entry.selector, model.uri, model.getLanguageIdentifier().language, shouldSynchronizeModel(model));\r\n            if (isExclusive(entry.selector) && entry._score > 0) {\r\n                // support for one exclusive selector that overwrites\r\n                // any other selector\r\n                for (var _b = 0, _c = this._entries; _b < _c.length; _b++) {\r\n                    var entry_1 = _c[_b];\r\n                    entry_1._score = 0;\r\n                }\r\n                entry._score = 1000;\r\n                break;\r\n            }\r\n        }\r\n        // needs sorting\r\n        this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\r\n    };\r\n    LanguageFeatureRegistry._compareByScoreAndTime = function (a, b) {\r\n        if (a._score < b._score) {\r\n            return 1;\r\n        }\r\n        else if (a._score > b._score) {\r\n            return -1;\r\n        }\r\n        else if (a._time < b._time) {\r\n            return 1;\r\n        }\r\n        else if (a._time > b._time) {\r\n            return -1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    };\r\n    return LanguageFeatureRegistry;\r\n}());\r\nexport { LanguageFeatureRegistry };\r\n"]},"metadata":{},"sourceType":"module"}