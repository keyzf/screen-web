{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as Platform from '../../../common/platform.js';\nimport * as Browser from '../../../browser/browser.js';\nimport * as Lifecycle from '../../../common/lifecycle.js';\nimport * as DOM from '../../../browser/dom.js';\nimport * as Diff from '../../../common/diff/diff.js';\nimport * as Touch from '../../../browser/touch.js';\nimport * as strings from '../../../common/strings.js';\nimport * as Mouse from '../../../browser/mouseEvent.js';\nimport * as Keyboard from '../../../browser/keyboardEvent.js';\nimport * as dnd from './treeDnd.js';\nimport { ArrayIterator, MappedIterator } from '../../../common/iterator.js';\nimport { ScrollableElement } from '../../../browser/ui/scrollbar/scrollableElement.js';\nimport { HeightMap } from './treeViewModel.js';\nimport * as _ from './tree.js';\nimport { Emitter } from '../../../common/event.js';\nimport { DataTransfers, StaticDND } from '../../../browser/dnd.js';\nimport { DefaultTreestyler } from './treeDefaults.js';\nimport { Delayer, timeout } from '../../../common/async.js';\n\nfunction removeFromParent(element) {\n  try {\n    element.parentElement.removeChild(element);\n  } catch (e) {// this will throw if this happens due to a blur event, nasty business\n  }\n}\n\nvar RowCache =\n/** @class */\nfunction () {\n  function RowCache(context) {\n    this.context = context;\n    this._cache = {\n      '': []\n    };\n  }\n\n  RowCache.prototype.alloc = function (templateId) {\n    var result = this.cache(templateId).pop();\n\n    if (!result) {\n      var content = document.createElement('div');\n      content.className = 'content';\n      var row = document.createElement('div');\n      row.appendChild(content);\n      var templateData = null;\n\n      try {\n        templateData = this.context.renderer.renderTemplate(this.context.tree, templateId, content);\n      } catch (err) {\n        console.error('Tree usage error: exception while rendering template');\n        console.error(err);\n      }\n\n      result = {\n        element: row,\n        templateId: templateId,\n        templateData: templateData\n      };\n    }\n\n    return result;\n  };\n\n  RowCache.prototype.release = function (templateId, row) {\n    removeFromParent(row.element);\n    this.cache(templateId).push(row);\n  };\n\n  RowCache.prototype.cache = function (templateId) {\n    return this._cache[templateId] || (this._cache[templateId] = []);\n  };\n\n  RowCache.prototype.garbageCollect = function () {\n    var _this = this;\n\n    if (this._cache) {\n      Object.keys(this._cache).forEach(function (templateId) {\n        _this._cache[templateId].forEach(function (cachedRow) {\n          _this.context.renderer.disposeTemplate(_this.context.tree, templateId, cachedRow.templateData);\n\n          cachedRow.element = null;\n          cachedRow.templateData = null;\n        });\n\n        delete _this._cache[templateId];\n      });\n    }\n  };\n\n  RowCache.prototype.dispose = function () {\n    this.garbageCollect();\n    this._cache = null;\n  };\n\n  return RowCache;\n}();\n\nexport { RowCache };\n\nvar ViewItem =\n/** @class */\nfunction () {\n  function ViewItem(context, model) {\n    var _this = this;\n\n    this.width = 0;\n    this.needsRender = false;\n    this.uri = null;\n    this.unbindDragStart = Lifecycle.Disposable.None;\n    this._draggable = false;\n    this.context = context;\n    this.model = model;\n    this.id = this.model.id;\n    this.row = null;\n    this.top = 0;\n    this.height = model.getHeight();\n    this._styles = {};\n    model.getAllTraits().forEach(function (t) {\n      return _this._styles[t] = true;\n    });\n\n    if (model.isExpanded()) {\n      this.addClass('expanded');\n    }\n  }\n\n  Object.defineProperty(ViewItem.prototype, \"expanded\", {\n    set: function (value) {\n      value ? this.addClass('expanded') : this.removeClass('expanded');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ViewItem.prototype, \"loading\", {\n    set: function (value) {\n      value ? this.addClass('codicon-loading') : this.removeClass('codicon-loading');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ViewItem.prototype, \"draggable\", {\n    get: function () {\n      return this._draggable;\n    },\n    set: function (value) {\n      this._draggable = value;\n      this.render(true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ViewItem.prototype, \"dropTarget\", {\n    set: function (value) {\n      value ? this.addClass('drop-target') : this.removeClass('drop-target');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ViewItem.prototype, \"element\", {\n    get: function () {\n      return this.row && this.row.element;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ViewItem.prototype, \"templateId\", {\n    get: function () {\n      return this._templateId || (this._templateId = this.context.renderer.getTemplateId && this.context.renderer.getTemplateId(this.context.tree, this.model.getElement()));\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ViewItem.prototype.addClass = function (name) {\n    this._styles[name] = true;\n    this.render(true);\n  };\n\n  ViewItem.prototype.removeClass = function (name) {\n    delete this._styles[name]; // is this slow?\n\n    this.render(true);\n  };\n\n  ViewItem.prototype.render = function (skipUserRender) {\n    var _this = this;\n\n    if (skipUserRender === void 0) {\n      skipUserRender = false;\n    }\n\n    if (!this.model || !this.element) {\n      return;\n    }\n\n    var classes = ['monaco-tree-row'];\n    classes.push.apply(classes, Object.keys(this._styles));\n\n    if (this.model.hasChildren()) {\n      classes.push('has-children');\n    }\n\n    this.element.className = classes.join(' ');\n    this.element.draggable = this.draggable;\n    this.element.style.height = this.height + 'px'; // ARIA\n\n    this.element.setAttribute('role', 'treeitem');\n    var accessibility = this.context.accessibilityProvider;\n    var ariaLabel = accessibility.getAriaLabel(this.context.tree, this.model.getElement());\n\n    if (ariaLabel) {\n      this.element.setAttribute('aria-label', ariaLabel);\n    }\n\n    if (accessibility.getPosInSet && accessibility.getSetSize) {\n      this.element.setAttribute('aria-setsize', accessibility.getSetSize());\n      this.element.setAttribute('aria-posinset', accessibility.getPosInSet(this.context.tree, this.model.getElement()));\n    }\n\n    if (this.model.hasTrait('focused')) {\n      var base64Id = strings.safeBtoa(this.model.id);\n      this.element.setAttribute('aria-selected', 'true');\n      this.element.setAttribute('id', base64Id);\n    } else {\n      this.element.setAttribute('aria-selected', 'false');\n      this.element.removeAttribute('id');\n    }\n\n    if (this.model.hasChildren()) {\n      this.element.setAttribute('aria-expanded', String(!!this._styles['expanded']));\n    } else {\n      this.element.removeAttribute('aria-expanded');\n    }\n\n    this.element.setAttribute('aria-level', String(this.model.getDepth()));\n\n    if (this.context.options.paddingOnRow) {\n      this.element.style.paddingLeft = this.context.options.twistiePixels + (this.model.getDepth() - 1) * this.context.options.indentPixels + 'px';\n    } else {\n      this.element.style.paddingLeft = (this.model.getDepth() - 1) * this.context.options.indentPixels + 'px';\n      this.row.element.firstElementChild.style.paddingLeft = this.context.options.twistiePixels + 'px';\n    }\n\n    var uri = this.context.dnd.getDragURI(this.context.tree, this.model.getElement());\n\n    if (uri !== this.uri) {\n      if (this.unbindDragStart) {\n        this.unbindDragStart.dispose();\n      }\n\n      if (uri) {\n        this.uri = uri;\n        this.draggable = true;\n        this.unbindDragStart = DOM.addDisposableListener(this.element, 'dragstart', function (e) {\n          _this.onDragStart(e);\n        });\n      } else {\n        this.uri = null;\n      }\n    }\n\n    if (!skipUserRender && this.element) {\n      var paddingLeft = 0;\n\n      if (this.context.horizontalScrolling) {\n        var style = window.getComputedStyle(this.element);\n        paddingLeft = parseFloat(style.paddingLeft);\n      }\n\n      if (this.context.horizontalScrolling) {\n        this.element.style.width = Browser.isFirefox ? '-moz-fit-content' : 'fit-content';\n      }\n\n      try {\n        this.context.renderer.renderElement(this.context.tree, this.model.getElement(), this.templateId, this.row.templateData);\n      } catch (err) {\n        console.error('Tree usage error: exception while rendering element');\n        console.error(err);\n      }\n\n      if (this.context.horizontalScrolling) {\n        this.width = DOM.getContentWidth(this.element) + paddingLeft;\n        this.element.style.width = '';\n      }\n    }\n  };\n\n  ViewItem.prototype.insertInDOM = function (container, afterElement) {\n    if (!this.row) {\n      this.row = this.context.cache.alloc(this.templateId); // used in reverse lookup from HTMLElement to Item\n\n      this.element[TreeView.BINDING] = this;\n    }\n\n    if (this.element.parentElement) {\n      return;\n    }\n\n    if (afterElement === null) {\n      container.appendChild(this.element);\n    } else {\n      try {\n        container.insertBefore(this.element, afterElement);\n      } catch (e) {\n        console.warn('Failed to locate previous tree element');\n        container.appendChild(this.element);\n      }\n    }\n\n    this.render();\n  };\n\n  ViewItem.prototype.removeFromDOM = function () {\n    if (!this.row) {\n      return;\n    }\n\n    this.unbindDragStart.dispose();\n    this.uri = null;\n    this.element[TreeView.BINDING] = null;\n    this.context.cache.release(this.templateId, this.row);\n    this.row = null;\n  };\n\n  ViewItem.prototype.dispose = function () {\n    this.row = null;\n  };\n\n  return ViewItem;\n}();\n\nexport { ViewItem };\n\nvar RootViewItem =\n/** @class */\nfunction (_super) {\n  __extends(RootViewItem, _super);\n\n  function RootViewItem(context, model, wrapper) {\n    var _this = _super.call(this, context, model) || this;\n\n    _this.row = {\n      element: wrapper,\n      templateData: null,\n      templateId: null\n    };\n    return _this;\n  }\n\n  RootViewItem.prototype.render = function () {\n    if (!this.model || !this.element) {\n      return;\n    }\n\n    var classes = ['monaco-tree-wrapper'];\n    classes.push.apply(classes, Object.keys(this._styles));\n\n    if (this.model.hasChildren()) {\n      classes.push('has-children');\n    }\n\n    this.element.className = classes.join(' ');\n  };\n\n  RootViewItem.prototype.insertInDOM = function (container, afterElement) {// noop\n  };\n\n  RootViewItem.prototype.removeFromDOM = function () {// noop\n  };\n\n  return RootViewItem;\n}(ViewItem);\n\nfunction reactionEquals(one, other) {\n  if (!one && !other) {\n    return true;\n  } else if (!one || !other) {\n    return false;\n  } else if (one.accept !== other.accept) {\n    return false;\n  } else if (one.bubble !== other.bubble) {\n    return false;\n  } else if (one.effect !== other.effect) {\n    return false;\n  } else {\n    return true;\n  }\n}\n\nvar TreeView =\n/** @class */\nfunction (_super) {\n  __extends(TreeView, _super);\n\n  function TreeView(context, container) {\n    var _this = _super.call(this) || this;\n\n    _this.model = null;\n    _this.lastPointerType = '';\n    _this.lastClickTimeStamp = 0;\n    _this.contentWidthUpdateDelayer = new Delayer(50);\n    _this.isRefreshing = false;\n    _this.refreshingPreviousChildrenIds = {};\n    _this.currentDragAndDropData = null;\n    _this.currentDropTarget = null;\n    _this.currentDropTargets = null;\n    _this.currentDropDisposable = Lifecycle.Disposable.None;\n    _this.gestureDisposable = Lifecycle.Disposable.None;\n    _this.dragAndDropScrollInterval = null;\n    _this.dragAndDropScrollTimeout = null;\n    _this.dragAndDropMouseY = null;\n    _this.highlightedItemWasDraggable = false;\n    _this.onHiddenScrollTop = null;\n    _this._onDOMFocus = new Emitter();\n    _this.onDOMFocus = _this._onDOMFocus.event;\n    _this._onDOMBlur = new Emitter();\n    _this._onDidScroll = new Emitter();\n    TreeView.counter++;\n    _this.instance = TreeView.counter;\n    var horizontalScrollMode = typeof context.options.horizontalScrollMode === 'undefined' ? 2\n    /* Hidden */\n    : context.options.horizontalScrollMode;\n    _this.horizontalScrolling = horizontalScrollMode !== 2\n    /* Hidden */\n    ;\n    _this.context = {\n      dataSource: context.dataSource,\n      renderer: context.renderer,\n      controller: context.controller,\n      dnd: context.dnd,\n      filter: context.filter,\n      sorter: context.sorter,\n      tree: context.tree,\n      accessibilityProvider: context.accessibilityProvider,\n      options: context.options,\n      cache: new RowCache(context),\n      horizontalScrolling: _this.horizontalScrolling\n    };\n    _this.modelListeners = [];\n    _this.viewListeners = [];\n    _this.items = {};\n    _this.domNode = document.createElement('div');\n    _this.domNode.className = \"monaco-tree no-focused-item monaco-tree-instance-\" + _this.instance; // to allow direct tabbing into the tree instead of first focusing the tree\n\n    _this.domNode.tabIndex = context.options.preventRootFocus ? -1 : 0;\n    _this.styleElement = DOM.createStyleSheet(_this.domNode);\n    _this.treeStyler = context.styler || new DefaultTreestyler(_this.styleElement, \"monaco-tree-instance-\" + _this.instance); // ARIA\n\n    _this.domNode.setAttribute('role', 'tree');\n\n    if (_this.context.options.ariaLabel) {\n      _this.domNode.setAttribute('aria-label', _this.context.options.ariaLabel);\n    }\n\n    if (_this.context.options.alwaysFocused) {\n      DOM.addClass(_this.domNode, 'focused');\n    }\n\n    if (!_this.context.options.paddingOnRow) {\n      DOM.addClass(_this.domNode, 'no-row-padding');\n    }\n\n    _this.wrapper = document.createElement('div');\n    _this.wrapper.className = 'monaco-tree-wrapper';\n    _this.scrollableElement = new ScrollableElement(_this.wrapper, {\n      alwaysConsumeMouseWheel: true,\n      horizontal: horizontalScrollMode,\n      vertical: typeof context.options.verticalScrollMode !== 'undefined' ? context.options.verticalScrollMode : 1\n      /* Auto */\n      ,\n      useShadows: context.options.useShadows\n    });\n\n    _this.scrollableElement.onScroll(function (e) {\n      _this.render(e.scrollTop, e.height, e.scrollLeft, e.width, e.scrollWidth);\n\n      _this._onDidScroll.fire();\n    });\n\n    if (Browser.isIE) {\n      _this.wrapper.style.msTouchAction = 'none';\n      _this.wrapper.style.msContentZooming = 'none';\n    } else {\n      _this.gestureDisposable = Touch.Gesture.addTarget(_this.wrapper);\n    }\n\n    _this.rowsContainer = document.createElement('div');\n    _this.rowsContainer.className = 'monaco-tree-rows';\n\n    if (context.options.showTwistie) {\n      _this.rowsContainer.className += ' show-twisties';\n    }\n\n    var focusTracker = DOM.trackFocus(_this.domNode);\n\n    _this.viewListeners.push(focusTracker.onDidFocus(function () {\n      return _this.onFocus();\n    }));\n\n    _this.viewListeners.push(focusTracker.onDidBlur(function () {\n      return _this.onBlur();\n    }));\n\n    _this.viewListeners.push(focusTracker);\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'keydown', function (e) {\n      return _this.onKeyDown(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'keyup', function (e) {\n      return _this.onKeyUp(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'mousedown', function (e) {\n      return _this.onMouseDown(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'mouseup', function (e) {\n      return _this.onMouseUp(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'auxclick', function (e) {\n      if (e && e.button === 1) {\n        _this.onMouseMiddleClick(e);\n      }\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'click', function (e) {\n      return _this.onClick(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'contextmenu', function (e) {\n      return _this.onContextMenu(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, Touch.EventType.Tap, function (e) {\n      return _this.onTap(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, Touch.EventType.Change, function (e) {\n      return _this.onTouchChange(e);\n    }));\n\n    if (Browser.isIE) {\n      _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'MSPointerDown', function (e) {\n        return _this.onMsPointerDown(e);\n      }));\n\n      _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'MSGestureTap', function (e) {\n        return _this.onMsGestureTap(e);\n      })); // these events come too fast, we throttle them\n\n\n      _this.viewListeners.push(DOM.addDisposableThrottledListener(_this.wrapper, 'MSGestureChange', function (e) {\n        return _this.onThrottledMsGestureChange(e);\n      }, function (lastEvent, event) {\n        event.stopPropagation();\n        event.preventDefault();\n        var result = {\n          translationY: event.translationY,\n          translationX: event.translationX\n        };\n\n        if (lastEvent) {\n          result.translationY += lastEvent.translationY;\n          result.translationX += lastEvent.translationX;\n        }\n\n        return result;\n      }));\n    }\n\n    _this.viewListeners.push(DOM.addDisposableListener(window, 'dragover', function (e) {\n      return _this.onDragOver(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'drop', function (e) {\n      return _this.onDrop(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(window, 'dragend', function (e) {\n      return _this.onDragEnd(e);\n    }));\n\n    _this.viewListeners.push(DOM.addDisposableListener(window, 'dragleave', function (e) {\n      return _this.onDragOver(e);\n    }));\n\n    _this.wrapper.appendChild(_this.rowsContainer);\n\n    _this.domNode.appendChild(_this.scrollableElement.getDomNode());\n\n    container.appendChild(_this.domNode);\n    _this.lastRenderTop = 0;\n    _this.lastRenderHeight = 0;\n    _this.didJustPressContextMenuKey = false;\n    _this.currentDropTarget = null;\n    _this.currentDropTargets = [];\n    _this.shouldInvalidateDropReaction = false;\n    _this.dragAndDropScrollInterval = null;\n    _this.dragAndDropScrollTimeout = null;\n\n    _this.onRowsChanged();\n\n    _this.layout();\n\n    _this.setupMSGesture();\n\n    _this.applyStyles(context.options);\n\n    return _this;\n  }\n\n  TreeView.prototype.applyStyles = function (styles) {\n    this.treeStyler.style(styles);\n  };\n\n  TreeView.prototype.createViewItem = function (item) {\n    return new ViewItem(this.context, item);\n  };\n\n  TreeView.prototype.getHTMLElement = function () {\n    return this.domNode;\n  };\n\n  TreeView.prototype.focus = function () {\n    this.domNode.focus();\n  };\n\n  TreeView.prototype.isFocused = function () {\n    return document.activeElement === this.domNode;\n  };\n\n  TreeView.prototype.blur = function () {\n    this.domNode.blur();\n  };\n\n  TreeView.prototype.setupMSGesture = function () {\n    var _this = this;\n\n    if (window.MSGesture) {\n      this.msGesture = new MSGesture();\n      setTimeout(function () {\n        return _this.msGesture.target = _this.wrapper;\n      }, 100); // TODO@joh, TODO@IETeam\n    }\n  };\n\n  TreeView.prototype.isTreeVisible = function () {\n    return this.onHiddenScrollTop === null;\n  };\n\n  TreeView.prototype.layout = function (height, width) {\n    if (!this.isTreeVisible()) {\n      return;\n    }\n\n    this.viewHeight = height || DOM.getContentHeight(this.wrapper); // render\n\n    this.scrollHeight = this.getContentHeight();\n\n    if (this.horizontalScrolling) {\n      this.viewWidth = width || DOM.getContentWidth(this.wrapper);\n    }\n  };\n\n  TreeView.prototype.render = function (scrollTop, viewHeight, scrollLeft, viewWidth, scrollWidth) {\n    var i;\n    var stop;\n    var renderTop = scrollTop;\n    var renderBottom = scrollTop + viewHeight;\n    var thisRenderBottom = this.lastRenderTop + this.lastRenderHeight; // when view scrolls down, start rendering from the renderBottom\n\n    for (i = this.indexAfter(renderBottom) - 1, stop = this.indexAt(Math.max(thisRenderBottom, renderTop)); i >= stop; i--) {\n      this.insertItemInDOM(this.itemAtIndex(i));\n    } // when view scrolls up, start rendering from either this.renderTop or renderBottom\n\n\n    for (i = Math.min(this.indexAt(this.lastRenderTop), this.indexAfter(renderBottom)) - 1, stop = this.indexAt(renderTop); i >= stop; i--) {\n      this.insertItemInDOM(this.itemAtIndex(i));\n    } // when view scrolls down, start unrendering from renderTop\n\n\n    for (i = this.indexAt(this.lastRenderTop), stop = Math.min(this.indexAt(renderTop), this.indexAfter(thisRenderBottom)); i < stop; i++) {\n      this.removeItemFromDOM(this.itemAtIndex(i));\n    } // when view scrolls up, start unrendering from either renderBottom this.renderTop\n\n\n    for (i = Math.max(this.indexAfter(renderBottom), this.indexAt(this.lastRenderTop)), stop = this.indexAfter(thisRenderBottom); i < stop; i++) {\n      this.removeItemFromDOM(this.itemAtIndex(i));\n    }\n\n    var topItem = this.itemAtIndex(this.indexAt(renderTop));\n\n    if (topItem) {\n      this.rowsContainer.style.top = topItem.top - renderTop + 'px';\n    }\n\n    if (this.horizontalScrolling) {\n      this.rowsContainer.style.left = -scrollLeft + 'px';\n      this.rowsContainer.style.width = Math.max(scrollWidth, viewWidth) + \"px\";\n    }\n\n    this.lastRenderTop = renderTop;\n    this.lastRenderHeight = renderBottom - renderTop;\n  };\n\n  TreeView.prototype.setModel = function (newModel) {\n    this.releaseModel();\n    this.model = newModel;\n    this.model.onRefresh(this.onRefreshing, this, this.modelListeners);\n    this.model.onDidRefresh(this.onRefreshed, this, this.modelListeners);\n    this.model.onSetInput(this.onClearingInput, this, this.modelListeners);\n    this.model.onDidSetInput(this.onSetInput, this, this.modelListeners);\n    this.model.onDidFocus(this.onModelFocusChange, this, this.modelListeners);\n    this.model.onRefreshItemChildren(this.onItemChildrenRefreshing, this, this.modelListeners);\n    this.model.onDidRefreshItemChildren(this.onItemChildrenRefreshed, this, this.modelListeners);\n    this.model.onDidRefreshItem(this.onItemRefresh, this, this.modelListeners);\n    this.model.onExpandItem(this.onItemExpanding, this, this.modelListeners);\n    this.model.onDidExpandItem(this.onItemExpanded, this, this.modelListeners);\n    this.model.onCollapseItem(this.onItemCollapsing, this, this.modelListeners);\n    this.model.onDidRevealItem(this.onItemReveal, this, this.modelListeners);\n    this.model.onDidAddTraitItem(this.onItemAddTrait, this, this.modelListeners);\n    this.model.onDidRemoveTraitItem(this.onItemRemoveTrait, this, this.modelListeners);\n  };\n\n  TreeView.prototype.onRefreshing = function () {\n    this.isRefreshing = true;\n  };\n\n  TreeView.prototype.onRefreshed = function () {\n    this.isRefreshing = false;\n    this.onRowsChanged();\n  };\n\n  TreeView.prototype.onRowsChanged = function (scrollTop) {\n    if (scrollTop === void 0) {\n      scrollTop = this.scrollTop;\n    }\n\n    if (this.isRefreshing) {\n      return;\n    }\n\n    this.scrollTop = scrollTop;\n    this.updateScrollWidth();\n  };\n\n  TreeView.prototype.updateScrollWidth = function () {\n    var _this = this;\n\n    if (!this.horizontalScrolling) {\n      return;\n    }\n\n    this.contentWidthUpdateDelayer.trigger(function () {\n      var keys = Object.keys(_this.items);\n      var scrollWidth = 0;\n\n      for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var key = keys_1[_i];\n        scrollWidth = Math.max(scrollWidth, _this.items[key].width);\n      }\n\n      _this.scrollWidth = scrollWidth + 10\n      /* scrollbar */\n      ;\n    });\n  };\n\n  TreeView.prototype.focusNextPage = function (eventPayload) {\n    var _this = this;\n\n    var lastPageIndex = this.indexAt(this.scrollTop + this.viewHeight);\n    lastPageIndex = lastPageIndex === 0 ? 0 : lastPageIndex - 1;\n    var lastPageElement = this.itemAtIndex(lastPageIndex).model.getElement();\n    var currentlyFocusedElement = this.model.getFocus();\n\n    if (currentlyFocusedElement !== lastPageElement) {\n      this.model.setFocus(lastPageElement, eventPayload);\n    } else {\n      var previousScrollTop = this.scrollTop;\n      this.scrollTop += this.viewHeight;\n\n      if (this.scrollTop !== previousScrollTop) {\n        // Let the scroll event listener run\n        setTimeout(function () {\n          _this.focusNextPage(eventPayload);\n        }, 0);\n      }\n    }\n  };\n\n  TreeView.prototype.focusPreviousPage = function (eventPayload) {\n    var _this = this;\n\n    var firstPageIndex;\n\n    if (this.scrollTop === 0) {\n      firstPageIndex = this.indexAt(this.scrollTop);\n    } else {\n      firstPageIndex = this.indexAfter(this.scrollTop - 1);\n    }\n\n    var firstPageElement = this.itemAtIndex(firstPageIndex).model.getElement();\n    var currentlyFocusedElement = this.model.getFocus();\n\n    if (currentlyFocusedElement !== firstPageElement) {\n      this.model.setFocus(firstPageElement, eventPayload);\n    } else {\n      var previousScrollTop = this.scrollTop;\n      this.scrollTop -= this.viewHeight;\n\n      if (this.scrollTop !== previousScrollTop) {\n        // Let the scroll event listener run\n        setTimeout(function () {\n          _this.focusPreviousPage(eventPayload);\n        }, 0);\n      }\n    }\n  };\n\n  Object.defineProperty(TreeView.prototype, \"viewHeight\", {\n    get: function () {\n      var scrollDimensions = this.scrollableElement.getScrollDimensions();\n      return scrollDimensions.height;\n    },\n    set: function (height) {\n      this.scrollableElement.setScrollDimensions({\n        height: height\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TreeView.prototype, \"scrollHeight\", {\n    set: function (scrollHeight) {\n      scrollHeight = scrollHeight + (this.horizontalScrolling ? 10 : 0);\n      this.scrollableElement.setScrollDimensions({\n        scrollHeight: scrollHeight\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TreeView.prototype, \"viewWidth\", {\n    get: function () {\n      var scrollDimensions = this.scrollableElement.getScrollDimensions();\n      return scrollDimensions.width;\n    },\n    set: function (viewWidth) {\n      this.scrollableElement.setScrollDimensions({\n        width: viewWidth\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TreeView.prototype, \"scrollWidth\", {\n    set: function (scrollWidth) {\n      this.scrollableElement.setScrollDimensions({\n        scrollWidth: scrollWidth\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TreeView.prototype, \"scrollTop\", {\n    get: function () {\n      var scrollPosition = this.scrollableElement.getScrollPosition();\n      return scrollPosition.scrollTop;\n    },\n    set: function (scrollTop) {\n      var scrollHeight = this.getContentHeight() + (this.horizontalScrolling ? 10 : 0);\n      this.scrollableElement.setScrollDimensions({\n        scrollHeight: scrollHeight\n      });\n      this.scrollableElement.setScrollPosition({\n        scrollTop: scrollTop\n      });\n    },\n    enumerable: true,\n    configurable: true\n  }); // Events\n\n  TreeView.prototype.onClearingInput = function (e) {\n    var item = e.item;\n\n    if (item) {\n      this.onRemoveItems(new MappedIterator(item.getNavigator(), function (item) {\n        return item && item.id;\n      }));\n      this.onRowsChanged();\n    }\n  };\n\n  TreeView.prototype.onSetInput = function (e) {\n    this.context.cache.garbageCollect();\n    this.inputItem = new RootViewItem(this.context, e.item, this.wrapper);\n  };\n\n  TreeView.prototype.onItemChildrenRefreshing = function (e) {\n    var item = e.item;\n    var viewItem = this.items[item.id];\n\n    if (viewItem && this.context.options.showLoading) {\n      viewItem.loadingTimer = setTimeout(function () {\n        viewItem.loadingTimer = 0;\n        viewItem.loading = true;\n      }, TreeView.LOADING_DECORATION_DELAY);\n    }\n\n    if (!e.isNested) {\n      var childrenIds = [];\n      var navigator_1 = item.getNavigator();\n      var childItem = void 0;\n\n      while (childItem = navigator_1.next()) {\n        childrenIds.push(childItem.id);\n      }\n\n      this.refreshingPreviousChildrenIds[item.id] = childrenIds;\n    }\n  };\n\n  TreeView.prototype.onItemChildrenRefreshed = function (e) {\n    var _this = this;\n\n    var item = e.item;\n    var viewItem = this.items[item.id];\n\n    if (viewItem) {\n      if (viewItem.loadingTimer) {\n        clearTimeout(viewItem.loadingTimer);\n        viewItem.loadingTimer = 0;\n      }\n\n      viewItem.loading = false;\n    }\n\n    if (!e.isNested) {\n      var previousChildrenIds_1 = this.refreshingPreviousChildrenIds[item.id];\n      var afterModelItems_1 = [];\n      var navigator_2 = item.getNavigator();\n      var childItem = void 0;\n\n      while (childItem = navigator_2.next()) {\n        afterModelItems_1.push(childItem);\n      }\n\n      var skipDiff = Math.abs(previousChildrenIds_1.length - afterModelItems_1.length) > 1000;\n      var diff = [];\n      var doToInsertItemsAlreadyExist = false;\n\n      if (!skipDiff) {\n        var lcs = new Diff.LcsDiff({\n          getElements: function () {\n            return previousChildrenIds_1;\n          }\n        }, {\n          getElements: function () {\n            return afterModelItems_1.map(function (item) {\n              return item.id;\n            });\n          }\n        }, null);\n        diff = lcs.ComputeDiff(false).changes; // this means that the result of the diff algorithm would result\n        // in inserting items that were already registered. this can only\n        // happen if the data provider returns bad ids OR if the sorting\n        // of the elements has changed\n\n        doToInsertItemsAlreadyExist = diff.some(function (d) {\n          if (d.modifiedLength > 0) {\n            for (var i = d.modifiedStart, len = d.modifiedStart + d.modifiedLength; i < len; i++) {\n              if (_this.items.hasOwnProperty(afterModelItems_1[i].id)) {\n                return true;\n              }\n            }\n          }\n\n          return false;\n        });\n      } // 50 is an optimization number, at some point we're better off\n      // just replacing everything\n\n\n      if (!skipDiff && !doToInsertItemsAlreadyExist && diff.length < 50) {\n        for (var _i = 0, diff_1 = diff; _i < diff_1.length; _i++) {\n          var diffChange = diff_1[_i];\n\n          if (diffChange.originalLength > 0) {\n            this.onRemoveItems(new ArrayIterator(previousChildrenIds_1, diffChange.originalStart, diffChange.originalStart + diffChange.originalLength));\n          }\n\n          if (diffChange.modifiedLength > 0) {\n            var beforeItem = afterModelItems_1[diffChange.modifiedStart - 1] || item;\n            beforeItem = beforeItem.getDepth() > 0 ? beforeItem : null;\n            this.onInsertItems(new ArrayIterator(afterModelItems_1, diffChange.modifiedStart, diffChange.modifiedStart + diffChange.modifiedLength), beforeItem ? beforeItem.id : null);\n          }\n        }\n      } else if (skipDiff || diff.length) {\n        this.onRemoveItems(new ArrayIterator(previousChildrenIds_1));\n        this.onInsertItems(new ArrayIterator(afterModelItems_1), item.getDepth() > 0 ? item.id : null);\n      }\n\n      if (skipDiff || diff.length) {\n        this.onRowsChanged();\n      }\n    }\n  };\n\n  TreeView.prototype.onItemRefresh = function (item) {\n    this.onItemsRefresh([item]);\n  };\n\n  TreeView.prototype.onItemsRefresh = function (items) {\n    var _this = this;\n\n    this.onRefreshItemSet(items.filter(function (item) {\n      return _this.items.hasOwnProperty(item.id);\n    }));\n    this.onRowsChanged();\n  };\n\n  TreeView.prototype.onItemExpanding = function (e) {\n    var viewItem = this.items[e.item.id];\n\n    if (viewItem) {\n      viewItem.expanded = true;\n    }\n  };\n\n  TreeView.prototype.onItemExpanded = function (e) {\n    var item = e.item;\n    var viewItem = this.items[item.id];\n\n    if (viewItem) {\n      viewItem.expanded = true;\n      var height = this.onInsertItems(item.getNavigator(), item.id) || 0;\n      var scrollTop = this.scrollTop;\n\n      if (viewItem.top + viewItem.height <= this.scrollTop) {\n        scrollTop += height;\n      }\n\n      this.onRowsChanged(scrollTop);\n    }\n  };\n\n  TreeView.prototype.onItemCollapsing = function (e) {\n    var item = e.item;\n    var viewItem = this.items[item.id];\n\n    if (viewItem) {\n      viewItem.expanded = false;\n      this.onRemoveItems(new MappedIterator(item.getNavigator(), function (item) {\n        return item && item.id;\n      }));\n      this.onRowsChanged();\n    }\n  };\n\n  TreeView.prototype.onItemReveal = function (e) {\n    var item = e.item;\n    var relativeTop = e.relativeTop;\n    var viewItem = this.items[item.id];\n\n    if (viewItem) {\n      if (relativeTop !== null) {\n        relativeTop = relativeTop < 0 ? 0 : relativeTop;\n        relativeTop = relativeTop > 1 ? 1 : relativeTop; // y = mx + b\n\n        var m = viewItem.height - this.viewHeight;\n        this.scrollTop = m * relativeTop + viewItem.top;\n      } else {\n        var viewItemBottom = viewItem.top + viewItem.height;\n        var wrapperBottom = this.scrollTop + this.viewHeight;\n\n        if (viewItem.top < this.scrollTop) {\n          this.scrollTop = viewItem.top;\n        } else if (viewItemBottom >= wrapperBottom) {\n          this.scrollTop = viewItemBottom - this.viewHeight;\n        }\n      }\n    }\n  };\n\n  TreeView.prototype.onItemAddTrait = function (e) {\n    var item = e.item;\n    var trait = e.trait;\n    var viewItem = this.items[item.id];\n\n    if (viewItem) {\n      viewItem.addClass(trait);\n    }\n\n    if (trait === 'highlighted') {\n      DOM.addClass(this.domNode, trait); // Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\n\n      if (viewItem) {\n        this.highlightedItemWasDraggable = !!viewItem.draggable;\n\n        if (viewItem.draggable) {\n          viewItem.draggable = false;\n        }\n      }\n    }\n  };\n\n  TreeView.prototype.onItemRemoveTrait = function (e) {\n    var item = e.item;\n    var trait = e.trait;\n    var viewItem = this.items[item.id];\n\n    if (viewItem) {\n      viewItem.removeClass(trait);\n    }\n\n    if (trait === 'highlighted') {\n      DOM.removeClass(this.domNode, trait); // Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\n\n      if (this.highlightedItemWasDraggable) {\n        viewItem.draggable = true;\n      }\n\n      this.highlightedItemWasDraggable = false;\n    }\n  };\n\n  TreeView.prototype.onModelFocusChange = function () {\n    var focus = this.model && this.model.getFocus();\n    DOM.toggleClass(this.domNode, 'no-focused-item', !focus); // ARIA\n\n    if (focus) {\n      this.domNode.setAttribute('aria-activedescendant', strings.safeBtoa(this.context.dataSource.getId(this.context.tree, focus)));\n    } else {\n      this.domNode.removeAttribute('aria-activedescendant');\n    }\n  }; // HeightMap \"events\"\n\n\n  TreeView.prototype.onInsertItem = function (item) {\n    var _this = this;\n\n    item.onDragStart = function (e) {\n      _this.onDragStart(item, e);\n    };\n\n    item.needsRender = true;\n    this.refreshViewItem(item);\n    this.items[item.id] = item;\n  };\n\n  TreeView.prototype.onRefreshItem = function (item, needsRender) {\n    if (needsRender === void 0) {\n      needsRender = false;\n    }\n\n    item.needsRender = item.needsRender || needsRender;\n    this.refreshViewItem(item);\n  };\n\n  TreeView.prototype.onRemoveItem = function (item) {\n    this.removeItemFromDOM(item);\n    item.dispose();\n    delete this.items[item.id];\n  }; // ViewItem refresh\n\n\n  TreeView.prototype.refreshViewItem = function (item) {\n    item.render();\n\n    if (this.shouldBeRendered(item)) {\n      this.insertItemInDOM(item);\n    } else {\n      this.removeItemFromDOM(item);\n    }\n  }; // DOM Events\n\n\n  TreeView.prototype.onClick = function (e) {\n    if (this.lastPointerType && this.lastPointerType !== 'mouse') {\n      return;\n    }\n\n    var event = new Mouse.StandardMouseEvent(e);\n    var item = this.getItemAround(event.target);\n\n    if (!item) {\n      return;\n    }\n\n    if (Browser.isIE && Date.now() - this.lastClickTimeStamp < 300) {\n      // IE10+ doesn't set the detail property correctly. While IE10 simply\n      // counts the number of clicks, IE11 reports always 1. To align with\n      // other browser, we set the value to 2 if clicks events come in a 300ms\n      // sequence.\n      event.detail = 2;\n    }\n\n    this.lastClickTimeStamp = Date.now();\n    this.context.controller.onClick(this.context.tree, item.model.getElement(), event);\n  };\n\n  TreeView.prototype.onMouseMiddleClick = function (e) {\n    if (!this.context.controller.onMouseMiddleClick) {\n      return;\n    }\n\n    var event = new Mouse.StandardMouseEvent(e);\n    var item = this.getItemAround(event.target);\n\n    if (!item) {\n      return;\n    }\n\n    this.context.controller.onMouseMiddleClick(this.context.tree, item.model.getElement(), event);\n  };\n\n  TreeView.prototype.onMouseDown = function (e) {\n    this.didJustPressContextMenuKey = false;\n\n    if (!this.context.controller.onMouseDown) {\n      return;\n    }\n\n    if (this.lastPointerType && this.lastPointerType !== 'mouse') {\n      return;\n    }\n\n    var event = new Mouse.StandardMouseEvent(e);\n\n    if (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\n      return;\n    }\n\n    var item = this.getItemAround(event.target);\n\n    if (!item) {\n      return;\n    }\n\n    this.context.controller.onMouseDown(this.context.tree, item.model.getElement(), event);\n  };\n\n  TreeView.prototype.onMouseUp = function (e) {\n    if (!this.context.controller.onMouseUp) {\n      return;\n    }\n\n    if (this.lastPointerType && this.lastPointerType !== 'mouse') {\n      return;\n    }\n\n    var event = new Mouse.StandardMouseEvent(e);\n\n    if (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\n      return;\n    }\n\n    var item = this.getItemAround(event.target);\n\n    if (!item) {\n      return;\n    }\n\n    this.context.controller.onMouseUp(this.context.tree, item.model.getElement(), event);\n  };\n\n  TreeView.prototype.onTap = function (e) {\n    var item = this.getItemAround(e.initialTarget);\n\n    if (!item) {\n      return;\n    }\n\n    this.context.controller.onTap(this.context.tree, item.model.getElement(), e);\n  };\n\n  TreeView.prototype.onTouchChange = function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    this.scrollTop -= event.translationY;\n  };\n\n  TreeView.prototype.onContextMenu = function (event) {\n    var resultEvent;\n    var element;\n\n    if (event instanceof KeyboardEvent || this.didJustPressContextMenuKey) {\n      this.didJustPressContextMenuKey = false;\n      var keyboardEvent = new Keyboard.StandardKeyboardEvent(event);\n      element = this.model.getFocus();\n      var position = void 0;\n\n      if (!element) {\n        element = this.model.getInput();\n        position = DOM.getDomNodePagePosition(this.inputItem.element);\n      } else {\n        var id = this.context.dataSource.getId(this.context.tree, element);\n        var viewItem = this.items[id];\n        position = DOM.getDomNodePagePosition(viewItem.element);\n      }\n\n      resultEvent = new _.KeyboardContextMenuEvent(position.left + position.width, position.top, keyboardEvent);\n    } else {\n      var mouseEvent = new Mouse.StandardMouseEvent(event);\n      var item = this.getItemAround(mouseEvent.target);\n\n      if (!item) {\n        return;\n      }\n\n      element = item.model.getElement();\n      resultEvent = new _.MouseContextMenuEvent(mouseEvent);\n    }\n\n    this.context.controller.onContextMenu(this.context.tree, element, resultEvent);\n  };\n\n  TreeView.prototype.onKeyDown = function (e) {\n    var event = new Keyboard.StandardKeyboardEvent(e);\n    this.didJustPressContextMenuKey = event.keyCode === 58\n    /* ContextMenu */\n    || event.shiftKey && event.keyCode === 68\n    /* F10 */\n    ;\n\n    if (event.target && event.target.tagName && event.target.tagName.toLowerCase() === 'input') {\n      return; // Ignore event if target is a form input field (avoids browser specific issues)\n    }\n\n    if (this.didJustPressContextMenuKey) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    this.context.controller.onKeyDown(this.context.tree, event);\n  };\n\n  TreeView.prototype.onKeyUp = function (e) {\n    if (this.didJustPressContextMenuKey) {\n      this.onContextMenu(e);\n    }\n\n    this.didJustPressContextMenuKey = false;\n    this.context.controller.onKeyUp(this.context.tree, new Keyboard.StandardKeyboardEvent(e));\n  };\n\n  TreeView.prototype.onDragStart = function (item, e) {\n    if (this.model.getHighlight()) {\n      return;\n    }\n\n    var element = item.model.getElement();\n    var selection = this.model.getSelection();\n    var elements;\n\n    if (selection.indexOf(element) > -1) {\n      elements = selection;\n    } else {\n      elements = [element];\n    }\n\n    e.dataTransfer.effectAllowed = 'copyMove';\n    e.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([item.uri]));\n\n    if (e.dataTransfer.setDragImage) {\n      var label = void 0;\n\n      if (this.context.dnd.getDragLabel) {\n        label = this.context.dnd.getDragLabel(this.context.tree, elements);\n      } else {\n        label = String(elements.length);\n      }\n\n      var dragImage_1 = document.createElement('div');\n      dragImage_1.className = 'monaco-tree-drag-image';\n      dragImage_1.textContent = label;\n      document.body.appendChild(dragImage_1);\n      e.dataTransfer.setDragImage(dragImage_1, -10, -10);\n      setTimeout(function () {\n        return document.body.removeChild(dragImage_1);\n      }, 0);\n    }\n\n    this.currentDragAndDropData = new dnd.ElementsDragAndDropData(elements);\n    StaticDND.CurrentDragAndDropData = new dnd.ExternalElementsDragAndDropData(elements);\n    this.context.dnd.onDragStart(this.context.tree, this.currentDragAndDropData, new Mouse.DragMouseEvent(e));\n  };\n\n  TreeView.prototype.setupDragAndDropScrollInterval = function () {\n    var _this = this;\n\n    var viewTop = DOM.getTopLeftOffset(this.wrapper).top;\n\n    if (!this.dragAndDropScrollInterval) {\n      this.dragAndDropScrollInterval = window.setInterval(function () {\n        if (_this.dragAndDropMouseY === null) {\n          return;\n        }\n\n        var diff = _this.dragAndDropMouseY - viewTop;\n        var scrollDiff = 0;\n        var upperLimit = _this.viewHeight - 35;\n\n        if (diff < 35) {\n          scrollDiff = Math.max(-14, 0.2 * (diff - 35));\n        } else if (diff > upperLimit) {\n          scrollDiff = Math.min(14, 0.2 * (diff - upperLimit));\n        }\n\n        _this.scrollTop += scrollDiff;\n      }, 10);\n      this.cancelDragAndDropScrollTimeout();\n      this.dragAndDropScrollTimeout = window.setTimeout(function () {\n        _this.cancelDragAndDropScrollInterval();\n\n        _this.dragAndDropScrollTimeout = null;\n      }, 1000);\n    }\n  };\n\n  TreeView.prototype.cancelDragAndDropScrollInterval = function () {\n    if (this.dragAndDropScrollInterval) {\n      window.clearInterval(this.dragAndDropScrollInterval);\n      this.dragAndDropScrollInterval = null;\n    }\n\n    this.cancelDragAndDropScrollTimeout();\n  };\n\n  TreeView.prototype.cancelDragAndDropScrollTimeout = function () {\n    if (this.dragAndDropScrollTimeout) {\n      window.clearTimeout(this.dragAndDropScrollTimeout);\n      this.dragAndDropScrollTimeout = null;\n    }\n  };\n\n  TreeView.prototype.onDragOver = function (e) {\n    var _this = this;\n\n    e.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n    var event = new Mouse.DragMouseEvent(e);\n    var viewItem = this.getItemAround(event.target);\n\n    if (!viewItem || event.posx === 0 && event.posy === 0 && event.browserEvent.type === DOM.EventType.DRAG_LEAVE) {\n      // dragging outside of tree\n      if (this.currentDropTarget) {\n        // clear previously hovered element feedback\n        this.currentDropTargets.forEach(function (i) {\n          return i.dropTarget = false;\n        });\n        this.currentDropTargets = [];\n        this.currentDropDisposable.dispose();\n      }\n\n      this.cancelDragAndDropScrollInterval();\n      this.currentDropTarget = null;\n      this.currentDropElement = null;\n      this.dragAndDropMouseY = null;\n      return false;\n    } // dragging inside the tree\n\n\n    this.setupDragAndDropScrollInterval();\n    this.dragAndDropMouseY = event.posy;\n\n    if (!this.currentDragAndDropData) {\n      // just started dragging\n      if (StaticDND.CurrentDragAndDropData) {\n        this.currentDragAndDropData = StaticDND.CurrentDragAndDropData;\n      } else {\n        if (!event.dataTransfer.types) {\n          return false;\n        }\n\n        this.currentDragAndDropData = new dnd.DesktopDragAndDropData();\n      }\n    }\n\n    this.currentDragAndDropData.update(event.browserEvent.dataTransfer);\n    var element;\n    var item = viewItem.model;\n    var reaction; // check the bubble up behavior\n\n    do {\n      element = item ? item.getElement() : this.model.getInput();\n      reaction = this.context.dnd.onDragOver(this.context.tree, this.currentDragAndDropData, element, event);\n\n      if (!reaction || reaction.bubble !== 1\n      /* BUBBLE_UP */\n      ) {\n          break;\n        }\n\n      item = item && item.parent;\n    } while (item);\n\n    if (!item) {\n      this.currentDropElement = null;\n      return false;\n    }\n\n    var canDrop = reaction && reaction.accept;\n\n    if (canDrop) {\n      this.currentDropElement = item.getElement();\n      event.preventDefault();\n      event.dataTransfer.dropEffect = reaction.effect === 0\n      /* COPY */\n      ? 'copy' : 'move';\n    } else {\n      this.currentDropElement = null;\n    } // item is the model item where drop() should be called\n    // can be null\n\n\n    var currentDropTarget = item.id === this.inputItem.id ? this.inputItem : this.items[item.id];\n\n    if (this.shouldInvalidateDropReaction || this.currentDropTarget !== currentDropTarget || !reactionEquals(this.currentDropElementReaction, reaction)) {\n      this.shouldInvalidateDropReaction = false;\n\n      if (this.currentDropTarget) {\n        this.currentDropTargets.forEach(function (i) {\n          return i.dropTarget = false;\n        });\n        this.currentDropTargets = [];\n        this.currentDropDisposable.dispose();\n      }\n\n      this.currentDropTarget = currentDropTarget;\n      this.currentDropElementReaction = reaction;\n\n      if (canDrop) {\n        // setup hover feedback for drop target\n        if (this.currentDropTarget) {\n          this.currentDropTarget.dropTarget = true;\n          this.currentDropTargets.push(this.currentDropTarget);\n        }\n\n        if (reaction.bubble === 0\n        /* BUBBLE_DOWN */\n        ) {\n            var nav = item.getNavigator();\n            var child = void 0;\n\n            while (child = nav.next()) {\n              viewItem = this.items[child.id];\n\n              if (viewItem) {\n                viewItem.dropTarget = true;\n                this.currentDropTargets.push(viewItem);\n              }\n            }\n          }\n\n        if (reaction.autoExpand) {\n          var timeoutPromise_1 = timeout(500);\n          this.currentDropDisposable = Lifecycle.toDisposable(function () {\n            return timeoutPromise_1.cancel();\n          });\n          timeoutPromise_1.then(function () {\n            return _this.context.tree.expand(_this.currentDropElement);\n          }).then(function () {\n            return _this.shouldInvalidateDropReaction = true;\n          });\n        }\n      }\n    }\n\n    return true;\n  };\n\n  TreeView.prototype.onDrop = function (e) {\n    if (this.currentDropElement) {\n      var event_1 = new Mouse.DragMouseEvent(e);\n      event_1.preventDefault();\n      this.currentDragAndDropData.update(event_1.browserEvent.dataTransfer);\n      this.context.dnd.drop(this.context.tree, this.currentDragAndDropData, this.currentDropElement, event_1);\n      this.onDragEnd(e);\n    }\n\n    this.cancelDragAndDropScrollInterval();\n  };\n\n  TreeView.prototype.onDragEnd = function (e) {\n    if (this.currentDropTarget) {\n      this.currentDropTargets.forEach(function (i) {\n        return i.dropTarget = false;\n      });\n      this.currentDropTargets = [];\n    }\n\n    this.currentDropDisposable.dispose();\n    this.cancelDragAndDropScrollInterval();\n    this.currentDragAndDropData = null;\n    StaticDND.CurrentDragAndDropData = undefined;\n    this.currentDropElement = null;\n    this.currentDropTarget = null;\n    this.dragAndDropMouseY = null;\n  };\n\n  TreeView.prototype.onFocus = function () {\n    if (!this.context.options.alwaysFocused) {\n      DOM.addClass(this.domNode, 'focused');\n    }\n\n    this._onDOMFocus.fire();\n  };\n\n  TreeView.prototype.onBlur = function () {\n    if (!this.context.options.alwaysFocused) {\n      DOM.removeClass(this.domNode, 'focused');\n    }\n\n    this.domNode.removeAttribute('aria-activedescendant'); // ARIA\n\n    this._onDOMBlur.fire();\n  }; // MS specific DOM Events\n\n\n  TreeView.prototype.onMsPointerDown = function (event) {\n    if (!this.msGesture) {\n      return;\n    } // Circumvent IE11 breaking change in e.pointerType & TypeScript's stale definitions\n\n\n    var pointerType = event.pointerType;\n\n    if (pointerType === (event.MSPOINTER_TYPE_MOUSE || 'mouse')) {\n      this.lastPointerType = 'mouse';\n      return;\n    } else if (pointerType === (event.MSPOINTER_TYPE_TOUCH || 'touch')) {\n      this.lastPointerType = 'touch';\n    } else {\n      return;\n    }\n\n    event.stopPropagation();\n    event.preventDefault();\n    this.msGesture.addPointer(event.pointerId);\n  };\n\n  TreeView.prototype.onThrottledMsGestureChange = function (event) {\n    this.scrollTop -= event.translationY;\n  };\n\n  TreeView.prototype.onMsGestureTap = function (event) {\n    event.initialTarget = document.elementFromPoint(event.clientX, event.clientY);\n    this.onTap(event);\n  }; // DOM changes\n\n\n  TreeView.prototype.insertItemInDOM = function (item) {\n    var elementAfter = null;\n    var itemAfter = this.itemAfter(item);\n\n    if (itemAfter && itemAfter.element) {\n      elementAfter = itemAfter.element;\n    }\n\n    item.insertInDOM(this.rowsContainer, elementAfter);\n  };\n\n  TreeView.prototype.removeItemFromDOM = function (item) {\n    if (!item) {\n      return;\n    }\n\n    item.removeFromDOM();\n  }; // Helpers\n\n\n  TreeView.prototype.shouldBeRendered = function (item) {\n    return item.top < this.lastRenderTop + this.lastRenderHeight && item.top + item.height > this.lastRenderTop;\n  };\n\n  TreeView.prototype.getItemAround = function (element) {\n    var candidate = this.inputItem;\n    var el = element;\n\n    do {\n      if (el[TreeView.BINDING]) {\n        candidate = el[TreeView.BINDING];\n      }\n\n      if (el === this.wrapper || el === this.domNode) {\n        return candidate;\n      }\n\n      if (el === this.scrollableElement.getDomNode() || el === document.body) {\n        return undefined;\n      }\n    } while (el = el.parentElement);\n\n    return undefined;\n  }; // Cleanup\n\n\n  TreeView.prototype.releaseModel = function () {\n    if (this.model) {\n      this.modelListeners = Lifecycle.dispose(this.modelListeners);\n      this.model = null;\n    }\n  };\n\n  TreeView.prototype.dispose = function () {\n    var _this = this; // TODO@joao: improve\n\n\n    this.scrollableElement.dispose();\n    this.releaseModel();\n    this.viewListeners = Lifecycle.dispose(this.viewListeners);\n\n    this._onDOMFocus.dispose();\n\n    this._onDOMBlur.dispose();\n\n    if (this.domNode.parentNode) {\n      this.domNode.parentNode.removeChild(this.domNode);\n    }\n\n    if (this.items) {\n      Object.keys(this.items).forEach(function (key) {\n        return _this.items[key].removeFromDOM();\n      });\n    }\n\n    if (this.context.cache) {\n      this.context.cache.dispose();\n    }\n\n    this.gestureDisposable.dispose();\n\n    _super.prototype.dispose.call(this);\n  };\n\n  TreeView.BINDING = 'monaco-tree-row';\n  TreeView.LOADING_DECORATION_DELAY = 800;\n  TreeView.counter = 0;\n  return TreeView;\n}(HeightMap);\n\nexport { TreeView };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/parts/tree/browser/treeView.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Platform","Browser","Lifecycle","DOM","Diff","Touch","strings","Mouse","Keyboard","dnd","ArrayIterator","MappedIterator","ScrollableElement","HeightMap","_","Emitter","DataTransfers","StaticDND","DefaultTreestyler","Delayer","timeout","removeFromParent","element","parentElement","removeChild","e","RowCache","context","_cache","alloc","templateId","result","cache","pop","content","document","createElement","className","row","appendChild","templateData","renderer","renderTemplate","tree","err","console","error","release","push","garbageCollect","_this","keys","forEach","cachedRow","disposeTemplate","dispose","ViewItem","model","width","needsRender","uri","unbindDragStart","Disposable","None","_draggable","id","top","height","getHeight","_styles","getAllTraits","t","isExpanded","addClass","defineProperty","set","value","removeClass","enumerable","configurable","get","render","_templateId","getTemplateId","getElement","name","skipUserRender","classes","apply","hasChildren","join","draggable","style","setAttribute","accessibility","accessibilityProvider","ariaLabel","getAriaLabel","getPosInSet","getSetSize","hasTrait","base64Id","safeBtoa","removeAttribute","String","getDepth","options","paddingOnRow","paddingLeft","twistiePixels","indentPixels","firstElementChild","getDragURI","addDisposableListener","onDragStart","horizontalScrolling","window","getComputedStyle","parseFloat","isFirefox","renderElement","getContentWidth","insertInDOM","container","afterElement","TreeView","BINDING","insertBefore","warn","removeFromDOM","RootViewItem","_super","wrapper","call","reactionEquals","one","other","accept","bubble","effect","lastPointerType","lastClickTimeStamp","contentWidthUpdateDelayer","isRefreshing","refreshingPreviousChildrenIds","currentDragAndDropData","currentDropTarget","currentDropTargets","currentDropDisposable","gestureDisposable","dragAndDropScrollInterval","dragAndDropScrollTimeout","dragAndDropMouseY","highlightedItemWasDraggable","onHiddenScrollTop","_onDOMFocus","onDOMFocus","event","_onDOMBlur","_onDidScroll","counter","instance","horizontalScrollMode","dataSource","controller","filter","sorter","modelListeners","viewListeners","items","domNode","tabIndex","preventRootFocus","styleElement","createStyleSheet","treeStyler","styler","alwaysFocused","scrollableElement","alwaysConsumeMouseWheel","horizontal","vertical","verticalScrollMode","useShadows","onScroll","scrollTop","scrollLeft","scrollWidth","fire","isIE","msTouchAction","msContentZooming","Gesture","addTarget","rowsContainer","showTwistie","focusTracker","trackFocus","onDidFocus","onFocus","onDidBlur","onBlur","onKeyDown","onKeyUp","onMouseDown","onMouseUp","button","onMouseMiddleClick","onClick","onContextMenu","EventType","Tap","onTap","Change","onTouchChange","onMsPointerDown","onMsGestureTap","addDisposableThrottledListener","onThrottledMsGestureChange","lastEvent","stopPropagation","preventDefault","translationY","translationX","onDragOver","onDrop","onDragEnd","getDomNode","lastRenderTop","lastRenderHeight","didJustPressContextMenuKey","shouldInvalidateDropReaction","onRowsChanged","layout","setupMSGesture","applyStyles","styles","createViewItem","item","getHTMLElement","focus","isFocused","activeElement","blur","MSGesture","msGesture","setTimeout","target","isTreeVisible","viewHeight","getContentHeight","scrollHeight","viewWidth","i","stop","renderTop","renderBottom","thisRenderBottom","indexAfter","indexAt","Math","max","insertItemInDOM","itemAtIndex","min","removeItemFromDOM","topItem","left","setModel","newModel","releaseModel","onRefresh","onRefreshing","onDidRefresh","onRefreshed","onSetInput","onClearingInput","onDidSetInput","onModelFocusChange","onRefreshItemChildren","onItemChildrenRefreshing","onDidRefreshItemChildren","onItemChildrenRefreshed","onDidRefreshItem","onItemRefresh","onExpandItem","onItemExpanding","onDidExpandItem","onItemExpanded","onCollapseItem","onItemCollapsing","onDidRevealItem","onItemReveal","onDidAddTraitItem","onItemAddTrait","onDidRemoveTraitItem","onItemRemoveTrait","updateScrollWidth","trigger","_i","keys_1","length","key","focusNextPage","eventPayload","lastPageIndex","lastPageElement","currentlyFocusedElement","getFocus","setFocus","previousScrollTop","focusPreviousPage","firstPageIndex","firstPageElement","scrollDimensions","getScrollDimensions","setScrollDimensions","scrollPosition","getScrollPosition","setScrollPosition","onRemoveItems","getNavigator","inputItem","viewItem","showLoading","loadingTimer","loading","LOADING_DECORATION_DELAY","isNested","childrenIds","navigator_1","childItem","next","clearTimeout","previousChildrenIds_1","afterModelItems_1","navigator_2","skipDiff","abs","diff","doToInsertItemsAlreadyExist","lcs","LcsDiff","getElements","map","ComputeDiff","changes","some","modifiedLength","modifiedStart","len","diff_1","diffChange","originalLength","originalStart","beforeItem","onInsertItems","onItemsRefresh","onRefreshItemSet","expanded","relativeTop","m","viewItemBottom","wrapperBottom","trait","toggleClass","getId","onInsertItem","refreshViewItem","onRefreshItem","onRemoveItem","shouldBeRendered","StandardMouseEvent","getItemAround","Date","now","detail","ctrlKey","isNative","isMacintosh","initialTarget","resultEvent","KeyboardEvent","keyboardEvent","StandardKeyboardEvent","position","getInput","getDomNodePagePosition","KeyboardContextMenuEvent","mouseEvent","MouseContextMenuEvent","keyCode","shiftKey","tagName","toLowerCase","getHighlight","selection","getSelection","elements","indexOf","dataTransfer","effectAllowed","setData","RESOURCES","JSON","stringify","setDragImage","label","getDragLabel","dragImage_1","textContent","body","ElementsDragAndDropData","CurrentDragAndDropData","ExternalElementsDragAndDropData","DragMouseEvent","setupDragAndDropScrollInterval","viewTop","getTopLeftOffset","setInterval","scrollDiff","upperLimit","cancelDragAndDropScrollTimeout","cancelDragAndDropScrollInterval","clearInterval","posx","posy","browserEvent","type","DRAG_LEAVE","dropTarget","currentDropElement","types","DesktopDragAndDropData","update","reaction","parent","canDrop","dropEffect","currentDropElementReaction","nav","child","autoExpand","timeoutPromise_1","toDisposable","cancel","then","expand","event_1","drop","undefined","pointerType","MSPOINTER_TYPE_MOUSE","MSPOINTER_TYPE_TOUCH","addPointer","pointerId","elementFromPoint","clientX","clientY","elementAfter","itemAfter","candidate","el","parentNode"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as Platform from '../../../common/platform.js';\r\nimport * as Browser from '../../../browser/browser.js';\r\nimport * as Lifecycle from '../../../common/lifecycle.js';\r\nimport * as DOM from '../../../browser/dom.js';\r\nimport * as Diff from '../../../common/diff/diff.js';\r\nimport * as Touch from '../../../browser/touch.js';\r\nimport * as strings from '../../../common/strings.js';\r\nimport * as Mouse from '../../../browser/mouseEvent.js';\r\nimport * as Keyboard from '../../../browser/keyboardEvent.js';\r\nimport * as dnd from './treeDnd.js';\r\nimport { ArrayIterator, MappedIterator } from '../../../common/iterator.js';\r\nimport { ScrollableElement } from '../../../browser/ui/scrollbar/scrollableElement.js';\r\nimport { HeightMap } from './treeViewModel.js';\r\nimport * as _ from './tree.js';\r\nimport { Emitter } from '../../../common/event.js';\r\nimport { DataTransfers, StaticDND } from '../../../browser/dnd.js';\r\nimport { DefaultTreestyler } from './treeDefaults.js';\r\nimport { Delayer, timeout } from '../../../common/async.js';\r\nfunction removeFromParent(element) {\r\n    try {\r\n        element.parentElement.removeChild(element);\r\n    }\r\n    catch (e) {\r\n        // this will throw if this happens due to a blur event, nasty business\r\n    }\r\n}\r\nvar RowCache = /** @class */ (function () {\r\n    function RowCache(context) {\r\n        this.context = context;\r\n        this._cache = { '': [] };\r\n    }\r\n    RowCache.prototype.alloc = function (templateId) {\r\n        var result = this.cache(templateId).pop();\r\n        if (!result) {\r\n            var content = document.createElement('div');\r\n            content.className = 'content';\r\n            var row = document.createElement('div');\r\n            row.appendChild(content);\r\n            var templateData = null;\r\n            try {\r\n                templateData = this.context.renderer.renderTemplate(this.context.tree, templateId, content);\r\n            }\r\n            catch (err) {\r\n                console.error('Tree usage error: exception while rendering template');\r\n                console.error(err);\r\n            }\r\n            result = {\r\n                element: row,\r\n                templateId: templateId,\r\n                templateData: templateData\r\n            };\r\n        }\r\n        return result;\r\n    };\r\n    RowCache.prototype.release = function (templateId, row) {\r\n        removeFromParent(row.element);\r\n        this.cache(templateId).push(row);\r\n    };\r\n    RowCache.prototype.cache = function (templateId) {\r\n        return this._cache[templateId] || (this._cache[templateId] = []);\r\n    };\r\n    RowCache.prototype.garbageCollect = function () {\r\n        var _this = this;\r\n        if (this._cache) {\r\n            Object.keys(this._cache).forEach(function (templateId) {\r\n                _this._cache[templateId].forEach(function (cachedRow) {\r\n                    _this.context.renderer.disposeTemplate(_this.context.tree, templateId, cachedRow.templateData);\r\n                    cachedRow.element = null;\r\n                    cachedRow.templateData = null;\r\n                });\r\n                delete _this._cache[templateId];\r\n            });\r\n        }\r\n    };\r\n    RowCache.prototype.dispose = function () {\r\n        this.garbageCollect();\r\n        this._cache = null;\r\n    };\r\n    return RowCache;\r\n}());\r\nexport { RowCache };\r\nvar ViewItem = /** @class */ (function () {\r\n    function ViewItem(context, model) {\r\n        var _this = this;\r\n        this.width = 0;\r\n        this.needsRender = false;\r\n        this.uri = null;\r\n        this.unbindDragStart = Lifecycle.Disposable.None;\r\n        this._draggable = false;\r\n        this.context = context;\r\n        this.model = model;\r\n        this.id = this.model.id;\r\n        this.row = null;\r\n        this.top = 0;\r\n        this.height = model.getHeight();\r\n        this._styles = {};\r\n        model.getAllTraits().forEach(function (t) { return _this._styles[t] = true; });\r\n        if (model.isExpanded()) {\r\n            this.addClass('expanded');\r\n        }\r\n    }\r\n    Object.defineProperty(ViewItem.prototype, \"expanded\", {\r\n        set: function (value) {\r\n            value ? this.addClass('expanded') : this.removeClass('expanded');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ViewItem.prototype, \"loading\", {\r\n        set: function (value) {\r\n            value ? this.addClass('codicon-loading') : this.removeClass('codicon-loading');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ViewItem.prototype, \"draggable\", {\r\n        get: function () {\r\n            return this._draggable;\r\n        },\r\n        set: function (value) {\r\n            this._draggable = value;\r\n            this.render(true);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ViewItem.prototype, \"dropTarget\", {\r\n        set: function (value) {\r\n            value ? this.addClass('drop-target') : this.removeClass('drop-target');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ViewItem.prototype, \"element\", {\r\n        get: function () {\r\n            return (this.row && this.row.element);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ViewItem.prototype, \"templateId\", {\r\n        get: function () {\r\n            return this._templateId || (this._templateId = (this.context.renderer.getTemplateId && this.context.renderer.getTemplateId(this.context.tree, this.model.getElement())));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ViewItem.prototype.addClass = function (name) {\r\n        this._styles[name] = true;\r\n        this.render(true);\r\n    };\r\n    ViewItem.prototype.removeClass = function (name) {\r\n        delete this._styles[name]; // is this slow?\r\n        this.render(true);\r\n    };\r\n    ViewItem.prototype.render = function (skipUserRender) {\r\n        var _this = this;\r\n        if (skipUserRender === void 0) { skipUserRender = false; }\r\n        if (!this.model || !this.element) {\r\n            return;\r\n        }\r\n        var classes = ['monaco-tree-row'];\r\n        classes.push.apply(classes, Object.keys(this._styles));\r\n        if (this.model.hasChildren()) {\r\n            classes.push('has-children');\r\n        }\r\n        this.element.className = classes.join(' ');\r\n        this.element.draggable = this.draggable;\r\n        this.element.style.height = this.height + 'px';\r\n        // ARIA\r\n        this.element.setAttribute('role', 'treeitem');\r\n        var accessibility = this.context.accessibilityProvider;\r\n        var ariaLabel = accessibility.getAriaLabel(this.context.tree, this.model.getElement());\r\n        if (ariaLabel) {\r\n            this.element.setAttribute('aria-label', ariaLabel);\r\n        }\r\n        if (accessibility.getPosInSet && accessibility.getSetSize) {\r\n            this.element.setAttribute('aria-setsize', accessibility.getSetSize());\r\n            this.element.setAttribute('aria-posinset', accessibility.getPosInSet(this.context.tree, this.model.getElement()));\r\n        }\r\n        if (this.model.hasTrait('focused')) {\r\n            var base64Id = strings.safeBtoa(this.model.id);\r\n            this.element.setAttribute('aria-selected', 'true');\r\n            this.element.setAttribute('id', base64Id);\r\n        }\r\n        else {\r\n            this.element.setAttribute('aria-selected', 'false');\r\n            this.element.removeAttribute('id');\r\n        }\r\n        if (this.model.hasChildren()) {\r\n            this.element.setAttribute('aria-expanded', String(!!this._styles['expanded']));\r\n        }\r\n        else {\r\n            this.element.removeAttribute('aria-expanded');\r\n        }\r\n        this.element.setAttribute('aria-level', String(this.model.getDepth()));\r\n        if (this.context.options.paddingOnRow) {\r\n            this.element.style.paddingLeft = this.context.options.twistiePixels + ((this.model.getDepth() - 1) * this.context.options.indentPixels) + 'px';\r\n        }\r\n        else {\r\n            this.element.style.paddingLeft = ((this.model.getDepth() - 1) * this.context.options.indentPixels) + 'px';\r\n            this.row.element.firstElementChild.style.paddingLeft = this.context.options.twistiePixels + 'px';\r\n        }\r\n        var uri = this.context.dnd.getDragURI(this.context.tree, this.model.getElement());\r\n        if (uri !== this.uri) {\r\n            if (this.unbindDragStart) {\r\n                this.unbindDragStart.dispose();\r\n            }\r\n            if (uri) {\r\n                this.uri = uri;\r\n                this.draggable = true;\r\n                this.unbindDragStart = DOM.addDisposableListener(this.element, 'dragstart', function (e) {\r\n                    _this.onDragStart(e);\r\n                });\r\n            }\r\n            else {\r\n                this.uri = null;\r\n            }\r\n        }\r\n        if (!skipUserRender && this.element) {\r\n            var paddingLeft = 0;\r\n            if (this.context.horizontalScrolling) {\r\n                var style = window.getComputedStyle(this.element);\r\n                paddingLeft = parseFloat(style.paddingLeft);\r\n            }\r\n            if (this.context.horizontalScrolling) {\r\n                this.element.style.width = Browser.isFirefox ? '-moz-fit-content' : 'fit-content';\r\n            }\r\n            try {\r\n                this.context.renderer.renderElement(this.context.tree, this.model.getElement(), this.templateId, this.row.templateData);\r\n            }\r\n            catch (err) {\r\n                console.error('Tree usage error: exception while rendering element');\r\n                console.error(err);\r\n            }\r\n            if (this.context.horizontalScrolling) {\r\n                this.width = DOM.getContentWidth(this.element) + paddingLeft;\r\n                this.element.style.width = '';\r\n            }\r\n        }\r\n    };\r\n    ViewItem.prototype.insertInDOM = function (container, afterElement) {\r\n        if (!this.row) {\r\n            this.row = this.context.cache.alloc(this.templateId);\r\n            // used in reverse lookup from HTMLElement to Item\r\n            this.element[TreeView.BINDING] = this;\r\n        }\r\n        if (this.element.parentElement) {\r\n            return;\r\n        }\r\n        if (afterElement === null) {\r\n            container.appendChild(this.element);\r\n        }\r\n        else {\r\n            try {\r\n                container.insertBefore(this.element, afterElement);\r\n            }\r\n            catch (e) {\r\n                console.warn('Failed to locate previous tree element');\r\n                container.appendChild(this.element);\r\n            }\r\n        }\r\n        this.render();\r\n    };\r\n    ViewItem.prototype.removeFromDOM = function () {\r\n        if (!this.row) {\r\n            return;\r\n        }\r\n        this.unbindDragStart.dispose();\r\n        this.uri = null;\r\n        this.element[TreeView.BINDING] = null;\r\n        this.context.cache.release(this.templateId, this.row);\r\n        this.row = null;\r\n    };\r\n    ViewItem.prototype.dispose = function () {\r\n        this.row = null;\r\n    };\r\n    return ViewItem;\r\n}());\r\nexport { ViewItem };\r\nvar RootViewItem = /** @class */ (function (_super) {\r\n    __extends(RootViewItem, _super);\r\n    function RootViewItem(context, model, wrapper) {\r\n        var _this = _super.call(this, context, model) || this;\r\n        _this.row = {\r\n            element: wrapper,\r\n            templateData: null,\r\n            templateId: null\r\n        };\r\n        return _this;\r\n    }\r\n    RootViewItem.prototype.render = function () {\r\n        if (!this.model || !this.element) {\r\n            return;\r\n        }\r\n        var classes = ['monaco-tree-wrapper'];\r\n        classes.push.apply(classes, Object.keys(this._styles));\r\n        if (this.model.hasChildren()) {\r\n            classes.push('has-children');\r\n        }\r\n        this.element.className = classes.join(' ');\r\n    };\r\n    RootViewItem.prototype.insertInDOM = function (container, afterElement) {\r\n        // noop\r\n    };\r\n    RootViewItem.prototype.removeFromDOM = function () {\r\n        // noop\r\n    };\r\n    return RootViewItem;\r\n}(ViewItem));\r\nfunction reactionEquals(one, other) {\r\n    if (!one && !other) {\r\n        return true;\r\n    }\r\n    else if (!one || !other) {\r\n        return false;\r\n    }\r\n    else if (one.accept !== other.accept) {\r\n        return false;\r\n    }\r\n    else if (one.bubble !== other.bubble) {\r\n        return false;\r\n    }\r\n    else if (one.effect !== other.effect) {\r\n        return false;\r\n    }\r\n    else {\r\n        return true;\r\n    }\r\n}\r\nvar TreeView = /** @class */ (function (_super) {\r\n    __extends(TreeView, _super);\r\n    function TreeView(context, container) {\r\n        var _this = _super.call(this) || this;\r\n        _this.model = null;\r\n        _this.lastPointerType = '';\r\n        _this.lastClickTimeStamp = 0;\r\n        _this.contentWidthUpdateDelayer = new Delayer(50);\r\n        _this.isRefreshing = false;\r\n        _this.refreshingPreviousChildrenIds = {};\r\n        _this.currentDragAndDropData = null;\r\n        _this.currentDropTarget = null;\r\n        _this.currentDropTargets = null;\r\n        _this.currentDropDisposable = Lifecycle.Disposable.None;\r\n        _this.gestureDisposable = Lifecycle.Disposable.None;\r\n        _this.dragAndDropScrollInterval = null;\r\n        _this.dragAndDropScrollTimeout = null;\r\n        _this.dragAndDropMouseY = null;\r\n        _this.highlightedItemWasDraggable = false;\r\n        _this.onHiddenScrollTop = null;\r\n        _this._onDOMFocus = new Emitter();\r\n        _this.onDOMFocus = _this._onDOMFocus.event;\r\n        _this._onDOMBlur = new Emitter();\r\n        _this._onDidScroll = new Emitter();\r\n        TreeView.counter++;\r\n        _this.instance = TreeView.counter;\r\n        var horizontalScrollMode = typeof context.options.horizontalScrollMode === 'undefined' ? 2 /* Hidden */ : context.options.horizontalScrollMode;\r\n        _this.horizontalScrolling = horizontalScrollMode !== 2 /* Hidden */;\r\n        _this.context = {\r\n            dataSource: context.dataSource,\r\n            renderer: context.renderer,\r\n            controller: context.controller,\r\n            dnd: context.dnd,\r\n            filter: context.filter,\r\n            sorter: context.sorter,\r\n            tree: context.tree,\r\n            accessibilityProvider: context.accessibilityProvider,\r\n            options: context.options,\r\n            cache: new RowCache(context),\r\n            horizontalScrolling: _this.horizontalScrolling\r\n        };\r\n        _this.modelListeners = [];\r\n        _this.viewListeners = [];\r\n        _this.items = {};\r\n        _this.domNode = document.createElement('div');\r\n        _this.domNode.className = \"monaco-tree no-focused-item monaco-tree-instance-\" + _this.instance;\r\n        // to allow direct tabbing into the tree instead of first focusing the tree\r\n        _this.domNode.tabIndex = context.options.preventRootFocus ? -1 : 0;\r\n        _this.styleElement = DOM.createStyleSheet(_this.domNode);\r\n        _this.treeStyler = context.styler || new DefaultTreestyler(_this.styleElement, \"monaco-tree-instance-\" + _this.instance);\r\n        // ARIA\r\n        _this.domNode.setAttribute('role', 'tree');\r\n        if (_this.context.options.ariaLabel) {\r\n            _this.domNode.setAttribute('aria-label', _this.context.options.ariaLabel);\r\n        }\r\n        if (_this.context.options.alwaysFocused) {\r\n            DOM.addClass(_this.domNode, 'focused');\r\n        }\r\n        if (!_this.context.options.paddingOnRow) {\r\n            DOM.addClass(_this.domNode, 'no-row-padding');\r\n        }\r\n        _this.wrapper = document.createElement('div');\r\n        _this.wrapper.className = 'monaco-tree-wrapper';\r\n        _this.scrollableElement = new ScrollableElement(_this.wrapper, {\r\n            alwaysConsumeMouseWheel: true,\r\n            horizontal: horizontalScrollMode,\r\n            vertical: (typeof context.options.verticalScrollMode !== 'undefined' ? context.options.verticalScrollMode : 1 /* Auto */),\r\n            useShadows: context.options.useShadows\r\n        });\r\n        _this.scrollableElement.onScroll(function (e) {\r\n            _this.render(e.scrollTop, e.height, e.scrollLeft, e.width, e.scrollWidth);\r\n            _this._onDidScroll.fire();\r\n        });\r\n        if (Browser.isIE) {\r\n            _this.wrapper.style.msTouchAction = 'none';\r\n            _this.wrapper.style.msContentZooming = 'none';\r\n        }\r\n        else {\r\n            _this.gestureDisposable = Touch.Gesture.addTarget(_this.wrapper);\r\n        }\r\n        _this.rowsContainer = document.createElement('div');\r\n        _this.rowsContainer.className = 'monaco-tree-rows';\r\n        if (context.options.showTwistie) {\r\n            _this.rowsContainer.className += ' show-twisties';\r\n        }\r\n        var focusTracker = DOM.trackFocus(_this.domNode);\r\n        _this.viewListeners.push(focusTracker.onDidFocus(function () { return _this.onFocus(); }));\r\n        _this.viewListeners.push(focusTracker.onDidBlur(function () { return _this.onBlur(); }));\r\n        _this.viewListeners.push(focusTracker);\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'keydown', function (e) { return _this.onKeyDown(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'keyup', function (e) { return _this.onKeyUp(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'mousedown', function (e) { return _this.onMouseDown(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'mouseup', function (e) { return _this.onMouseUp(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'auxclick', function (e) {\r\n            if (e && e.button === 1) {\r\n                _this.onMouseMiddleClick(e);\r\n            }\r\n        }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'click', function (e) { return _this.onClick(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'contextmenu', function (e) { return _this.onContextMenu(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, Touch.EventType.Tap, function (e) { return _this.onTap(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, Touch.EventType.Change, function (e) { return _this.onTouchChange(e); }));\r\n        if (Browser.isIE) {\r\n            _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'MSPointerDown', function (e) { return _this.onMsPointerDown(e); }));\r\n            _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'MSGestureTap', function (e) { return _this.onMsGestureTap(e); }));\r\n            // these events come too fast, we throttle them\r\n            _this.viewListeners.push(DOM.addDisposableThrottledListener(_this.wrapper, 'MSGestureChange', function (e) { return _this.onThrottledMsGestureChange(e); }, function (lastEvent, event) {\r\n                event.stopPropagation();\r\n                event.preventDefault();\r\n                var result = { translationY: event.translationY, translationX: event.translationX };\r\n                if (lastEvent) {\r\n                    result.translationY += lastEvent.translationY;\r\n                    result.translationX += lastEvent.translationX;\r\n                }\r\n                return result;\r\n            }));\r\n        }\r\n        _this.viewListeners.push(DOM.addDisposableListener(window, 'dragover', function (e) { return _this.onDragOver(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'drop', function (e) { return _this.onDrop(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(window, 'dragend', function (e) { return _this.onDragEnd(e); }));\r\n        _this.viewListeners.push(DOM.addDisposableListener(window, 'dragleave', function (e) { return _this.onDragOver(e); }));\r\n        _this.wrapper.appendChild(_this.rowsContainer);\r\n        _this.domNode.appendChild(_this.scrollableElement.getDomNode());\r\n        container.appendChild(_this.domNode);\r\n        _this.lastRenderTop = 0;\r\n        _this.lastRenderHeight = 0;\r\n        _this.didJustPressContextMenuKey = false;\r\n        _this.currentDropTarget = null;\r\n        _this.currentDropTargets = [];\r\n        _this.shouldInvalidateDropReaction = false;\r\n        _this.dragAndDropScrollInterval = null;\r\n        _this.dragAndDropScrollTimeout = null;\r\n        _this.onRowsChanged();\r\n        _this.layout();\r\n        _this.setupMSGesture();\r\n        _this.applyStyles(context.options);\r\n        return _this;\r\n    }\r\n    TreeView.prototype.applyStyles = function (styles) {\r\n        this.treeStyler.style(styles);\r\n    };\r\n    TreeView.prototype.createViewItem = function (item) {\r\n        return new ViewItem(this.context, item);\r\n    };\r\n    TreeView.prototype.getHTMLElement = function () {\r\n        return this.domNode;\r\n    };\r\n    TreeView.prototype.focus = function () {\r\n        this.domNode.focus();\r\n    };\r\n    TreeView.prototype.isFocused = function () {\r\n        return document.activeElement === this.domNode;\r\n    };\r\n    TreeView.prototype.blur = function () {\r\n        this.domNode.blur();\r\n    };\r\n    TreeView.prototype.setupMSGesture = function () {\r\n        var _this = this;\r\n        if (window.MSGesture) {\r\n            this.msGesture = new MSGesture();\r\n            setTimeout(function () { return _this.msGesture.target = _this.wrapper; }, 100); // TODO@joh, TODO@IETeam\r\n        }\r\n    };\r\n    TreeView.prototype.isTreeVisible = function () {\r\n        return this.onHiddenScrollTop === null;\r\n    };\r\n    TreeView.prototype.layout = function (height, width) {\r\n        if (!this.isTreeVisible()) {\r\n            return;\r\n        }\r\n        this.viewHeight = height || DOM.getContentHeight(this.wrapper); // render\r\n        this.scrollHeight = this.getContentHeight();\r\n        if (this.horizontalScrolling) {\r\n            this.viewWidth = width || DOM.getContentWidth(this.wrapper);\r\n        }\r\n    };\r\n    TreeView.prototype.render = function (scrollTop, viewHeight, scrollLeft, viewWidth, scrollWidth) {\r\n        var i;\r\n        var stop;\r\n        var renderTop = scrollTop;\r\n        var renderBottom = scrollTop + viewHeight;\r\n        var thisRenderBottom = this.lastRenderTop + this.lastRenderHeight;\r\n        // when view scrolls down, start rendering from the renderBottom\r\n        for (i = this.indexAfter(renderBottom) - 1, stop = this.indexAt(Math.max(thisRenderBottom, renderTop)); i >= stop; i--) {\r\n            this.insertItemInDOM(this.itemAtIndex(i));\r\n        }\r\n        // when view scrolls up, start rendering from either this.renderTop or renderBottom\r\n        for (i = Math.min(this.indexAt(this.lastRenderTop), this.indexAfter(renderBottom)) - 1, stop = this.indexAt(renderTop); i >= stop; i--) {\r\n            this.insertItemInDOM(this.itemAtIndex(i));\r\n        }\r\n        // when view scrolls down, start unrendering from renderTop\r\n        for (i = this.indexAt(this.lastRenderTop), stop = Math.min(this.indexAt(renderTop), this.indexAfter(thisRenderBottom)); i < stop; i++) {\r\n            this.removeItemFromDOM(this.itemAtIndex(i));\r\n        }\r\n        // when view scrolls up, start unrendering from either renderBottom this.renderTop\r\n        for (i = Math.max(this.indexAfter(renderBottom), this.indexAt(this.lastRenderTop)), stop = this.indexAfter(thisRenderBottom); i < stop; i++) {\r\n            this.removeItemFromDOM(this.itemAtIndex(i));\r\n        }\r\n        var topItem = this.itemAtIndex(this.indexAt(renderTop));\r\n        if (topItem) {\r\n            this.rowsContainer.style.top = (topItem.top - renderTop) + 'px';\r\n        }\r\n        if (this.horizontalScrolling) {\r\n            this.rowsContainer.style.left = -scrollLeft + 'px';\r\n            this.rowsContainer.style.width = Math.max(scrollWidth, viewWidth) + \"px\";\r\n        }\r\n        this.lastRenderTop = renderTop;\r\n        this.lastRenderHeight = renderBottom - renderTop;\r\n    };\r\n    TreeView.prototype.setModel = function (newModel) {\r\n        this.releaseModel();\r\n        this.model = newModel;\r\n        this.model.onRefresh(this.onRefreshing, this, this.modelListeners);\r\n        this.model.onDidRefresh(this.onRefreshed, this, this.modelListeners);\r\n        this.model.onSetInput(this.onClearingInput, this, this.modelListeners);\r\n        this.model.onDidSetInput(this.onSetInput, this, this.modelListeners);\r\n        this.model.onDidFocus(this.onModelFocusChange, this, this.modelListeners);\r\n        this.model.onRefreshItemChildren(this.onItemChildrenRefreshing, this, this.modelListeners);\r\n        this.model.onDidRefreshItemChildren(this.onItemChildrenRefreshed, this, this.modelListeners);\r\n        this.model.onDidRefreshItem(this.onItemRefresh, this, this.modelListeners);\r\n        this.model.onExpandItem(this.onItemExpanding, this, this.modelListeners);\r\n        this.model.onDidExpandItem(this.onItemExpanded, this, this.modelListeners);\r\n        this.model.onCollapseItem(this.onItemCollapsing, this, this.modelListeners);\r\n        this.model.onDidRevealItem(this.onItemReveal, this, this.modelListeners);\r\n        this.model.onDidAddTraitItem(this.onItemAddTrait, this, this.modelListeners);\r\n        this.model.onDidRemoveTraitItem(this.onItemRemoveTrait, this, this.modelListeners);\r\n    };\r\n    TreeView.prototype.onRefreshing = function () {\r\n        this.isRefreshing = true;\r\n    };\r\n    TreeView.prototype.onRefreshed = function () {\r\n        this.isRefreshing = false;\r\n        this.onRowsChanged();\r\n    };\r\n    TreeView.prototype.onRowsChanged = function (scrollTop) {\r\n        if (scrollTop === void 0) { scrollTop = this.scrollTop; }\r\n        if (this.isRefreshing) {\r\n            return;\r\n        }\r\n        this.scrollTop = scrollTop;\r\n        this.updateScrollWidth();\r\n    };\r\n    TreeView.prototype.updateScrollWidth = function () {\r\n        var _this = this;\r\n        if (!this.horizontalScrolling) {\r\n            return;\r\n        }\r\n        this.contentWidthUpdateDelayer.trigger(function () {\r\n            var keys = Object.keys(_this.items);\r\n            var scrollWidth = 0;\r\n            for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n                var key = keys_1[_i];\r\n                scrollWidth = Math.max(scrollWidth, _this.items[key].width);\r\n            }\r\n            _this.scrollWidth = scrollWidth + 10 /* scrollbar */;\r\n        });\r\n    };\r\n    TreeView.prototype.focusNextPage = function (eventPayload) {\r\n        var _this = this;\r\n        var lastPageIndex = this.indexAt(this.scrollTop + this.viewHeight);\r\n        lastPageIndex = lastPageIndex === 0 ? 0 : lastPageIndex - 1;\r\n        var lastPageElement = this.itemAtIndex(lastPageIndex).model.getElement();\r\n        var currentlyFocusedElement = this.model.getFocus();\r\n        if (currentlyFocusedElement !== lastPageElement) {\r\n            this.model.setFocus(lastPageElement, eventPayload);\r\n        }\r\n        else {\r\n            var previousScrollTop = this.scrollTop;\r\n            this.scrollTop += this.viewHeight;\r\n            if (this.scrollTop !== previousScrollTop) {\r\n                // Let the scroll event listener run\r\n                setTimeout(function () {\r\n                    _this.focusNextPage(eventPayload);\r\n                }, 0);\r\n            }\r\n        }\r\n    };\r\n    TreeView.prototype.focusPreviousPage = function (eventPayload) {\r\n        var _this = this;\r\n        var firstPageIndex;\r\n        if (this.scrollTop === 0) {\r\n            firstPageIndex = this.indexAt(this.scrollTop);\r\n        }\r\n        else {\r\n            firstPageIndex = this.indexAfter(this.scrollTop - 1);\r\n        }\r\n        var firstPageElement = this.itemAtIndex(firstPageIndex).model.getElement();\r\n        var currentlyFocusedElement = this.model.getFocus();\r\n        if (currentlyFocusedElement !== firstPageElement) {\r\n            this.model.setFocus(firstPageElement, eventPayload);\r\n        }\r\n        else {\r\n            var previousScrollTop = this.scrollTop;\r\n            this.scrollTop -= this.viewHeight;\r\n            if (this.scrollTop !== previousScrollTop) {\r\n                // Let the scroll event listener run\r\n                setTimeout(function () {\r\n                    _this.focusPreviousPage(eventPayload);\r\n                }, 0);\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(TreeView.prototype, \"viewHeight\", {\r\n        get: function () {\r\n            var scrollDimensions = this.scrollableElement.getScrollDimensions();\r\n            return scrollDimensions.height;\r\n        },\r\n        set: function (height) {\r\n            this.scrollableElement.setScrollDimensions({ height: height });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TreeView.prototype, \"scrollHeight\", {\r\n        set: function (scrollHeight) {\r\n            scrollHeight = scrollHeight + (this.horizontalScrolling ? 10 : 0);\r\n            this.scrollableElement.setScrollDimensions({ scrollHeight: scrollHeight });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TreeView.prototype, \"viewWidth\", {\r\n        get: function () {\r\n            var scrollDimensions = this.scrollableElement.getScrollDimensions();\r\n            return scrollDimensions.width;\r\n        },\r\n        set: function (viewWidth) {\r\n            this.scrollableElement.setScrollDimensions({ width: viewWidth });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TreeView.prototype, \"scrollWidth\", {\r\n        set: function (scrollWidth) {\r\n            this.scrollableElement.setScrollDimensions({ scrollWidth: scrollWidth });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TreeView.prototype, \"scrollTop\", {\r\n        get: function () {\r\n            var scrollPosition = this.scrollableElement.getScrollPosition();\r\n            return scrollPosition.scrollTop;\r\n        },\r\n        set: function (scrollTop) {\r\n            var scrollHeight = this.getContentHeight() + (this.horizontalScrolling ? 10 : 0);\r\n            this.scrollableElement.setScrollDimensions({ scrollHeight: scrollHeight });\r\n            this.scrollableElement.setScrollPosition({ scrollTop: scrollTop });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    // Events\r\n    TreeView.prototype.onClearingInput = function (e) {\r\n        var item = e.item;\r\n        if (item) {\r\n            this.onRemoveItems(new MappedIterator(item.getNavigator(), function (item) { return item && item.id; }));\r\n            this.onRowsChanged();\r\n        }\r\n    };\r\n    TreeView.prototype.onSetInput = function (e) {\r\n        this.context.cache.garbageCollect();\r\n        this.inputItem = new RootViewItem(this.context, e.item, this.wrapper);\r\n    };\r\n    TreeView.prototype.onItemChildrenRefreshing = function (e) {\r\n        var item = e.item;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem && this.context.options.showLoading) {\r\n            viewItem.loadingTimer = setTimeout(function () {\r\n                viewItem.loadingTimer = 0;\r\n                viewItem.loading = true;\r\n            }, TreeView.LOADING_DECORATION_DELAY);\r\n        }\r\n        if (!e.isNested) {\r\n            var childrenIds = [];\r\n            var navigator_1 = item.getNavigator();\r\n            var childItem = void 0;\r\n            while (childItem = navigator_1.next()) {\r\n                childrenIds.push(childItem.id);\r\n            }\r\n            this.refreshingPreviousChildrenIds[item.id] = childrenIds;\r\n        }\r\n    };\r\n    TreeView.prototype.onItemChildrenRefreshed = function (e) {\r\n        var _this = this;\r\n        var item = e.item;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem) {\r\n            if (viewItem.loadingTimer) {\r\n                clearTimeout(viewItem.loadingTimer);\r\n                viewItem.loadingTimer = 0;\r\n            }\r\n            viewItem.loading = false;\r\n        }\r\n        if (!e.isNested) {\r\n            var previousChildrenIds_1 = this.refreshingPreviousChildrenIds[item.id];\r\n            var afterModelItems_1 = [];\r\n            var navigator_2 = item.getNavigator();\r\n            var childItem = void 0;\r\n            while (childItem = navigator_2.next()) {\r\n                afterModelItems_1.push(childItem);\r\n            }\r\n            var skipDiff = Math.abs(previousChildrenIds_1.length - afterModelItems_1.length) > 1000;\r\n            var diff = [];\r\n            var doToInsertItemsAlreadyExist = false;\r\n            if (!skipDiff) {\r\n                var lcs = new Diff.LcsDiff({\r\n                    getElements: function () { return previousChildrenIds_1; }\r\n                }, {\r\n                    getElements: function () { return afterModelItems_1.map(function (item) { return item.id; }); }\r\n                }, null);\r\n                diff = lcs.ComputeDiff(false).changes;\r\n                // this means that the result of the diff algorithm would result\r\n                // in inserting items that were already registered. this can only\r\n                // happen if the data provider returns bad ids OR if the sorting\r\n                // of the elements has changed\r\n                doToInsertItemsAlreadyExist = diff.some(function (d) {\r\n                    if (d.modifiedLength > 0) {\r\n                        for (var i = d.modifiedStart, len = d.modifiedStart + d.modifiedLength; i < len; i++) {\r\n                            if (_this.items.hasOwnProperty(afterModelItems_1[i].id)) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }\r\n                    return false;\r\n                });\r\n            }\r\n            // 50 is an optimization number, at some point we're better off\r\n            // just replacing everything\r\n            if (!skipDiff && !doToInsertItemsAlreadyExist && diff.length < 50) {\r\n                for (var _i = 0, diff_1 = diff; _i < diff_1.length; _i++) {\r\n                    var diffChange = diff_1[_i];\r\n                    if (diffChange.originalLength > 0) {\r\n                        this.onRemoveItems(new ArrayIterator(previousChildrenIds_1, diffChange.originalStart, diffChange.originalStart + diffChange.originalLength));\r\n                    }\r\n                    if (diffChange.modifiedLength > 0) {\r\n                        var beforeItem = afterModelItems_1[diffChange.modifiedStart - 1] || item;\r\n                        beforeItem = beforeItem.getDepth() > 0 ? beforeItem : null;\r\n                        this.onInsertItems(new ArrayIterator(afterModelItems_1, diffChange.modifiedStart, diffChange.modifiedStart + diffChange.modifiedLength), beforeItem ? beforeItem.id : null);\r\n                    }\r\n                }\r\n            }\r\n            else if (skipDiff || diff.length) {\r\n                this.onRemoveItems(new ArrayIterator(previousChildrenIds_1));\r\n                this.onInsertItems(new ArrayIterator(afterModelItems_1), item.getDepth() > 0 ? item.id : null);\r\n            }\r\n            if (skipDiff || diff.length) {\r\n                this.onRowsChanged();\r\n            }\r\n        }\r\n    };\r\n    TreeView.prototype.onItemRefresh = function (item) {\r\n        this.onItemsRefresh([item]);\r\n    };\r\n    TreeView.prototype.onItemsRefresh = function (items) {\r\n        var _this = this;\r\n        this.onRefreshItemSet(items.filter(function (item) { return _this.items.hasOwnProperty(item.id); }));\r\n        this.onRowsChanged();\r\n    };\r\n    TreeView.prototype.onItemExpanding = function (e) {\r\n        var viewItem = this.items[e.item.id];\r\n        if (viewItem) {\r\n            viewItem.expanded = true;\r\n        }\r\n    };\r\n    TreeView.prototype.onItemExpanded = function (e) {\r\n        var item = e.item;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem) {\r\n            viewItem.expanded = true;\r\n            var height = this.onInsertItems(item.getNavigator(), item.id) || 0;\r\n            var scrollTop = this.scrollTop;\r\n            if (viewItem.top + viewItem.height <= this.scrollTop) {\r\n                scrollTop += height;\r\n            }\r\n            this.onRowsChanged(scrollTop);\r\n        }\r\n    };\r\n    TreeView.prototype.onItemCollapsing = function (e) {\r\n        var item = e.item;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem) {\r\n            viewItem.expanded = false;\r\n            this.onRemoveItems(new MappedIterator(item.getNavigator(), function (item) { return item && item.id; }));\r\n            this.onRowsChanged();\r\n        }\r\n    };\r\n    TreeView.prototype.onItemReveal = function (e) {\r\n        var item = e.item;\r\n        var relativeTop = e.relativeTop;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem) {\r\n            if (relativeTop !== null) {\r\n                relativeTop = relativeTop < 0 ? 0 : relativeTop;\r\n                relativeTop = relativeTop > 1 ? 1 : relativeTop;\r\n                // y = mx + b\r\n                var m = viewItem.height - this.viewHeight;\r\n                this.scrollTop = m * relativeTop + viewItem.top;\r\n            }\r\n            else {\r\n                var viewItemBottom = viewItem.top + viewItem.height;\r\n                var wrapperBottom = this.scrollTop + this.viewHeight;\r\n                if (viewItem.top < this.scrollTop) {\r\n                    this.scrollTop = viewItem.top;\r\n                }\r\n                else if (viewItemBottom >= wrapperBottom) {\r\n                    this.scrollTop = viewItemBottom - this.viewHeight;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    TreeView.prototype.onItemAddTrait = function (e) {\r\n        var item = e.item;\r\n        var trait = e.trait;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem) {\r\n            viewItem.addClass(trait);\r\n        }\r\n        if (trait === 'highlighted') {\r\n            DOM.addClass(this.domNode, trait);\r\n            // Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\r\n            if (viewItem) {\r\n                this.highlightedItemWasDraggable = !!viewItem.draggable;\r\n                if (viewItem.draggable) {\r\n                    viewItem.draggable = false;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    TreeView.prototype.onItemRemoveTrait = function (e) {\r\n        var item = e.item;\r\n        var trait = e.trait;\r\n        var viewItem = this.items[item.id];\r\n        if (viewItem) {\r\n            viewItem.removeClass(trait);\r\n        }\r\n        if (trait === 'highlighted') {\r\n            DOM.removeClass(this.domNode, trait);\r\n            // Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\r\n            if (this.highlightedItemWasDraggable) {\r\n                viewItem.draggable = true;\r\n            }\r\n            this.highlightedItemWasDraggable = false;\r\n        }\r\n    };\r\n    TreeView.prototype.onModelFocusChange = function () {\r\n        var focus = this.model && this.model.getFocus();\r\n        DOM.toggleClass(this.domNode, 'no-focused-item', !focus);\r\n        // ARIA\r\n        if (focus) {\r\n            this.domNode.setAttribute('aria-activedescendant', strings.safeBtoa(this.context.dataSource.getId(this.context.tree, focus)));\r\n        }\r\n        else {\r\n            this.domNode.removeAttribute('aria-activedescendant');\r\n        }\r\n    };\r\n    // HeightMap \"events\"\r\n    TreeView.prototype.onInsertItem = function (item) {\r\n        var _this = this;\r\n        item.onDragStart = function (e) { _this.onDragStart(item, e); };\r\n        item.needsRender = true;\r\n        this.refreshViewItem(item);\r\n        this.items[item.id] = item;\r\n    };\r\n    TreeView.prototype.onRefreshItem = function (item, needsRender) {\r\n        if (needsRender === void 0) { needsRender = false; }\r\n        item.needsRender = item.needsRender || needsRender;\r\n        this.refreshViewItem(item);\r\n    };\r\n    TreeView.prototype.onRemoveItem = function (item) {\r\n        this.removeItemFromDOM(item);\r\n        item.dispose();\r\n        delete this.items[item.id];\r\n    };\r\n    // ViewItem refresh\r\n    TreeView.prototype.refreshViewItem = function (item) {\r\n        item.render();\r\n        if (this.shouldBeRendered(item)) {\r\n            this.insertItemInDOM(item);\r\n        }\r\n        else {\r\n            this.removeItemFromDOM(item);\r\n        }\r\n    };\r\n    // DOM Events\r\n    TreeView.prototype.onClick = function (e) {\r\n        if (this.lastPointerType && this.lastPointerType !== 'mouse') {\r\n            return;\r\n        }\r\n        var event = new Mouse.StandardMouseEvent(e);\r\n        var item = this.getItemAround(event.target);\r\n        if (!item) {\r\n            return;\r\n        }\r\n        if (Browser.isIE && Date.now() - this.lastClickTimeStamp < 300) {\r\n            // IE10+ doesn't set the detail property correctly. While IE10 simply\r\n            // counts the number of clicks, IE11 reports always 1. To align with\r\n            // other browser, we set the value to 2 if clicks events come in a 300ms\r\n            // sequence.\r\n            event.detail = 2;\r\n        }\r\n        this.lastClickTimeStamp = Date.now();\r\n        this.context.controller.onClick(this.context.tree, item.model.getElement(), event);\r\n    };\r\n    TreeView.prototype.onMouseMiddleClick = function (e) {\r\n        if (!this.context.controller.onMouseMiddleClick) {\r\n            return;\r\n        }\r\n        var event = new Mouse.StandardMouseEvent(e);\r\n        var item = this.getItemAround(event.target);\r\n        if (!item) {\r\n            return;\r\n        }\r\n        this.context.controller.onMouseMiddleClick(this.context.tree, item.model.getElement(), event);\r\n    };\r\n    TreeView.prototype.onMouseDown = function (e) {\r\n        this.didJustPressContextMenuKey = false;\r\n        if (!this.context.controller.onMouseDown) {\r\n            return;\r\n        }\r\n        if (this.lastPointerType && this.lastPointerType !== 'mouse') {\r\n            return;\r\n        }\r\n        var event = new Mouse.StandardMouseEvent(e);\r\n        if (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\r\n            return;\r\n        }\r\n        var item = this.getItemAround(event.target);\r\n        if (!item) {\r\n            return;\r\n        }\r\n        this.context.controller.onMouseDown(this.context.tree, item.model.getElement(), event);\r\n    };\r\n    TreeView.prototype.onMouseUp = function (e) {\r\n        if (!this.context.controller.onMouseUp) {\r\n            return;\r\n        }\r\n        if (this.lastPointerType && this.lastPointerType !== 'mouse') {\r\n            return;\r\n        }\r\n        var event = new Mouse.StandardMouseEvent(e);\r\n        if (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\r\n            return;\r\n        }\r\n        var item = this.getItemAround(event.target);\r\n        if (!item) {\r\n            return;\r\n        }\r\n        this.context.controller.onMouseUp(this.context.tree, item.model.getElement(), event);\r\n    };\r\n    TreeView.prototype.onTap = function (e) {\r\n        var item = this.getItemAround(e.initialTarget);\r\n        if (!item) {\r\n            return;\r\n        }\r\n        this.context.controller.onTap(this.context.tree, item.model.getElement(), e);\r\n    };\r\n    TreeView.prototype.onTouchChange = function (event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        this.scrollTop -= event.translationY;\r\n    };\r\n    TreeView.prototype.onContextMenu = function (event) {\r\n        var resultEvent;\r\n        var element;\r\n        if (event instanceof KeyboardEvent || this.didJustPressContextMenuKey) {\r\n            this.didJustPressContextMenuKey = false;\r\n            var keyboardEvent = new Keyboard.StandardKeyboardEvent(event);\r\n            element = this.model.getFocus();\r\n            var position = void 0;\r\n            if (!element) {\r\n                element = this.model.getInput();\r\n                position = DOM.getDomNodePagePosition(this.inputItem.element);\r\n            }\r\n            else {\r\n                var id = this.context.dataSource.getId(this.context.tree, element);\r\n                var viewItem = this.items[id];\r\n                position = DOM.getDomNodePagePosition(viewItem.element);\r\n            }\r\n            resultEvent = new _.KeyboardContextMenuEvent(position.left + position.width, position.top, keyboardEvent);\r\n        }\r\n        else {\r\n            var mouseEvent = new Mouse.StandardMouseEvent(event);\r\n            var item = this.getItemAround(mouseEvent.target);\r\n            if (!item) {\r\n                return;\r\n            }\r\n            element = item.model.getElement();\r\n            resultEvent = new _.MouseContextMenuEvent(mouseEvent);\r\n        }\r\n        this.context.controller.onContextMenu(this.context.tree, element, resultEvent);\r\n    };\r\n    TreeView.prototype.onKeyDown = function (e) {\r\n        var event = new Keyboard.StandardKeyboardEvent(e);\r\n        this.didJustPressContextMenuKey = event.keyCode === 58 /* ContextMenu */ || (event.shiftKey && event.keyCode === 68 /* F10 */);\r\n        if (event.target && event.target.tagName && event.target.tagName.toLowerCase() === 'input') {\r\n            return; // Ignore event if target is a form input field (avoids browser specific issues)\r\n        }\r\n        if (this.didJustPressContextMenuKey) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        }\r\n        this.context.controller.onKeyDown(this.context.tree, event);\r\n    };\r\n    TreeView.prototype.onKeyUp = function (e) {\r\n        if (this.didJustPressContextMenuKey) {\r\n            this.onContextMenu(e);\r\n        }\r\n        this.didJustPressContextMenuKey = false;\r\n        this.context.controller.onKeyUp(this.context.tree, new Keyboard.StandardKeyboardEvent(e));\r\n    };\r\n    TreeView.prototype.onDragStart = function (item, e) {\r\n        if (this.model.getHighlight()) {\r\n            return;\r\n        }\r\n        var element = item.model.getElement();\r\n        var selection = this.model.getSelection();\r\n        var elements;\r\n        if (selection.indexOf(element) > -1) {\r\n            elements = selection;\r\n        }\r\n        else {\r\n            elements = [element];\r\n        }\r\n        e.dataTransfer.effectAllowed = 'copyMove';\r\n        e.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([item.uri]));\r\n        if (e.dataTransfer.setDragImage) {\r\n            var label = void 0;\r\n            if (this.context.dnd.getDragLabel) {\r\n                label = this.context.dnd.getDragLabel(this.context.tree, elements);\r\n            }\r\n            else {\r\n                label = String(elements.length);\r\n            }\r\n            var dragImage_1 = document.createElement('div');\r\n            dragImage_1.className = 'monaco-tree-drag-image';\r\n            dragImage_1.textContent = label;\r\n            document.body.appendChild(dragImage_1);\r\n            e.dataTransfer.setDragImage(dragImage_1, -10, -10);\r\n            setTimeout(function () { return document.body.removeChild(dragImage_1); }, 0);\r\n        }\r\n        this.currentDragAndDropData = new dnd.ElementsDragAndDropData(elements);\r\n        StaticDND.CurrentDragAndDropData = new dnd.ExternalElementsDragAndDropData(elements);\r\n        this.context.dnd.onDragStart(this.context.tree, this.currentDragAndDropData, new Mouse.DragMouseEvent(e));\r\n    };\r\n    TreeView.prototype.setupDragAndDropScrollInterval = function () {\r\n        var _this = this;\r\n        var viewTop = DOM.getTopLeftOffset(this.wrapper).top;\r\n        if (!this.dragAndDropScrollInterval) {\r\n            this.dragAndDropScrollInterval = window.setInterval(function () {\r\n                if (_this.dragAndDropMouseY === null) {\r\n                    return;\r\n                }\r\n                var diff = _this.dragAndDropMouseY - viewTop;\r\n                var scrollDiff = 0;\r\n                var upperLimit = _this.viewHeight - 35;\r\n                if (diff < 35) {\r\n                    scrollDiff = Math.max(-14, 0.2 * (diff - 35));\r\n                }\r\n                else if (diff > upperLimit) {\r\n                    scrollDiff = Math.min(14, 0.2 * (diff - upperLimit));\r\n                }\r\n                _this.scrollTop += scrollDiff;\r\n            }, 10);\r\n            this.cancelDragAndDropScrollTimeout();\r\n            this.dragAndDropScrollTimeout = window.setTimeout(function () {\r\n                _this.cancelDragAndDropScrollInterval();\r\n                _this.dragAndDropScrollTimeout = null;\r\n            }, 1000);\r\n        }\r\n    };\r\n    TreeView.prototype.cancelDragAndDropScrollInterval = function () {\r\n        if (this.dragAndDropScrollInterval) {\r\n            window.clearInterval(this.dragAndDropScrollInterval);\r\n            this.dragAndDropScrollInterval = null;\r\n        }\r\n        this.cancelDragAndDropScrollTimeout();\r\n    };\r\n    TreeView.prototype.cancelDragAndDropScrollTimeout = function () {\r\n        if (this.dragAndDropScrollTimeout) {\r\n            window.clearTimeout(this.dragAndDropScrollTimeout);\r\n            this.dragAndDropScrollTimeout = null;\r\n        }\r\n    };\r\n    TreeView.prototype.onDragOver = function (e) {\r\n        var _this = this;\r\n        e.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\r\n        var event = new Mouse.DragMouseEvent(e);\r\n        var viewItem = this.getItemAround(event.target);\r\n        if (!viewItem || (event.posx === 0 && event.posy === 0 && event.browserEvent.type === DOM.EventType.DRAG_LEAVE)) {\r\n            // dragging outside of tree\r\n            if (this.currentDropTarget) {\r\n                // clear previously hovered element feedback\r\n                this.currentDropTargets.forEach(function (i) { return i.dropTarget = false; });\r\n                this.currentDropTargets = [];\r\n                this.currentDropDisposable.dispose();\r\n            }\r\n            this.cancelDragAndDropScrollInterval();\r\n            this.currentDropTarget = null;\r\n            this.currentDropElement = null;\r\n            this.dragAndDropMouseY = null;\r\n            return false;\r\n        }\r\n        // dragging inside the tree\r\n        this.setupDragAndDropScrollInterval();\r\n        this.dragAndDropMouseY = event.posy;\r\n        if (!this.currentDragAndDropData) {\r\n            // just started dragging\r\n            if (StaticDND.CurrentDragAndDropData) {\r\n                this.currentDragAndDropData = StaticDND.CurrentDragAndDropData;\r\n            }\r\n            else {\r\n                if (!event.dataTransfer.types) {\r\n                    return false;\r\n                }\r\n                this.currentDragAndDropData = new dnd.DesktopDragAndDropData();\r\n            }\r\n        }\r\n        this.currentDragAndDropData.update(event.browserEvent.dataTransfer);\r\n        var element;\r\n        var item = viewItem.model;\r\n        var reaction;\r\n        // check the bubble up behavior\r\n        do {\r\n            element = item ? item.getElement() : this.model.getInput();\r\n            reaction = this.context.dnd.onDragOver(this.context.tree, this.currentDragAndDropData, element, event);\r\n            if (!reaction || reaction.bubble !== 1 /* BUBBLE_UP */) {\r\n                break;\r\n            }\r\n            item = item && item.parent;\r\n        } while (item);\r\n        if (!item) {\r\n            this.currentDropElement = null;\r\n            return false;\r\n        }\r\n        var canDrop = reaction && reaction.accept;\r\n        if (canDrop) {\r\n            this.currentDropElement = item.getElement();\r\n            event.preventDefault();\r\n            event.dataTransfer.dropEffect = reaction.effect === 0 /* COPY */ ? 'copy' : 'move';\r\n        }\r\n        else {\r\n            this.currentDropElement = null;\r\n        }\r\n        // item is the model item where drop() should be called\r\n        // can be null\r\n        var currentDropTarget = item.id === this.inputItem.id ? this.inputItem : this.items[item.id];\r\n        if (this.shouldInvalidateDropReaction || this.currentDropTarget !== currentDropTarget || !reactionEquals(this.currentDropElementReaction, reaction)) {\r\n            this.shouldInvalidateDropReaction = false;\r\n            if (this.currentDropTarget) {\r\n                this.currentDropTargets.forEach(function (i) { return i.dropTarget = false; });\r\n                this.currentDropTargets = [];\r\n                this.currentDropDisposable.dispose();\r\n            }\r\n            this.currentDropTarget = currentDropTarget;\r\n            this.currentDropElementReaction = reaction;\r\n            if (canDrop) {\r\n                // setup hover feedback for drop target\r\n                if (this.currentDropTarget) {\r\n                    this.currentDropTarget.dropTarget = true;\r\n                    this.currentDropTargets.push(this.currentDropTarget);\r\n                }\r\n                if (reaction.bubble === 0 /* BUBBLE_DOWN */) {\r\n                    var nav = item.getNavigator();\r\n                    var child = void 0;\r\n                    while (child = nav.next()) {\r\n                        viewItem = this.items[child.id];\r\n                        if (viewItem) {\r\n                            viewItem.dropTarget = true;\r\n                            this.currentDropTargets.push(viewItem);\r\n                        }\r\n                    }\r\n                }\r\n                if (reaction.autoExpand) {\r\n                    var timeoutPromise_1 = timeout(500);\r\n                    this.currentDropDisposable = Lifecycle.toDisposable(function () { return timeoutPromise_1.cancel(); });\r\n                    timeoutPromise_1\r\n                        .then(function () { return _this.context.tree.expand(_this.currentDropElement); })\r\n                        .then(function () { return _this.shouldInvalidateDropReaction = true; });\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    TreeView.prototype.onDrop = function (e) {\r\n        if (this.currentDropElement) {\r\n            var event_1 = new Mouse.DragMouseEvent(e);\r\n            event_1.preventDefault();\r\n            this.currentDragAndDropData.update(event_1.browserEvent.dataTransfer);\r\n            this.context.dnd.drop(this.context.tree, this.currentDragAndDropData, this.currentDropElement, event_1);\r\n            this.onDragEnd(e);\r\n        }\r\n        this.cancelDragAndDropScrollInterval();\r\n    };\r\n    TreeView.prototype.onDragEnd = function (e) {\r\n        if (this.currentDropTarget) {\r\n            this.currentDropTargets.forEach(function (i) { return i.dropTarget = false; });\r\n            this.currentDropTargets = [];\r\n        }\r\n        this.currentDropDisposable.dispose();\r\n        this.cancelDragAndDropScrollInterval();\r\n        this.currentDragAndDropData = null;\r\n        StaticDND.CurrentDragAndDropData = undefined;\r\n        this.currentDropElement = null;\r\n        this.currentDropTarget = null;\r\n        this.dragAndDropMouseY = null;\r\n    };\r\n    TreeView.prototype.onFocus = function () {\r\n        if (!this.context.options.alwaysFocused) {\r\n            DOM.addClass(this.domNode, 'focused');\r\n        }\r\n        this._onDOMFocus.fire();\r\n    };\r\n    TreeView.prototype.onBlur = function () {\r\n        if (!this.context.options.alwaysFocused) {\r\n            DOM.removeClass(this.domNode, 'focused');\r\n        }\r\n        this.domNode.removeAttribute('aria-activedescendant'); // ARIA\r\n        this._onDOMBlur.fire();\r\n    };\r\n    // MS specific DOM Events\r\n    TreeView.prototype.onMsPointerDown = function (event) {\r\n        if (!this.msGesture) {\r\n            return;\r\n        }\r\n        // Circumvent IE11 breaking change in e.pointerType & TypeScript's stale definitions\r\n        var pointerType = event.pointerType;\r\n        if (pointerType === (event.MSPOINTER_TYPE_MOUSE || 'mouse')) {\r\n            this.lastPointerType = 'mouse';\r\n            return;\r\n        }\r\n        else if (pointerType === (event.MSPOINTER_TYPE_TOUCH || 'touch')) {\r\n            this.lastPointerType = 'touch';\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        this.msGesture.addPointer(event.pointerId);\r\n    };\r\n    TreeView.prototype.onThrottledMsGestureChange = function (event) {\r\n        this.scrollTop -= event.translationY;\r\n    };\r\n    TreeView.prototype.onMsGestureTap = function (event) {\r\n        event.initialTarget = document.elementFromPoint(event.clientX, event.clientY);\r\n        this.onTap(event);\r\n    };\r\n    // DOM changes\r\n    TreeView.prototype.insertItemInDOM = function (item) {\r\n        var elementAfter = null;\r\n        var itemAfter = this.itemAfter(item);\r\n        if (itemAfter && itemAfter.element) {\r\n            elementAfter = itemAfter.element;\r\n        }\r\n        item.insertInDOM(this.rowsContainer, elementAfter);\r\n    };\r\n    TreeView.prototype.removeItemFromDOM = function (item) {\r\n        if (!item) {\r\n            return;\r\n        }\r\n        item.removeFromDOM();\r\n    };\r\n    // Helpers\r\n    TreeView.prototype.shouldBeRendered = function (item) {\r\n        return item.top < this.lastRenderTop + this.lastRenderHeight && item.top + item.height > this.lastRenderTop;\r\n    };\r\n    TreeView.prototype.getItemAround = function (element) {\r\n        var candidate = this.inputItem;\r\n        var el = element;\r\n        do {\r\n            if (el[TreeView.BINDING]) {\r\n                candidate = el[TreeView.BINDING];\r\n            }\r\n            if (el === this.wrapper || el === this.domNode) {\r\n                return candidate;\r\n            }\r\n            if (el === this.scrollableElement.getDomNode() || el === document.body) {\r\n                return undefined;\r\n            }\r\n        } while (el = el.parentElement);\r\n        return undefined;\r\n    };\r\n    // Cleanup\r\n    TreeView.prototype.releaseModel = function () {\r\n        if (this.model) {\r\n            this.modelListeners = Lifecycle.dispose(this.modelListeners);\r\n            this.model = null;\r\n        }\r\n    };\r\n    TreeView.prototype.dispose = function () {\r\n        var _this = this;\r\n        // TODO@joao: improve\r\n        this.scrollableElement.dispose();\r\n        this.releaseModel();\r\n        this.viewListeners = Lifecycle.dispose(this.viewListeners);\r\n        this._onDOMFocus.dispose();\r\n        this._onDOMBlur.dispose();\r\n        if (this.domNode.parentNode) {\r\n            this.domNode.parentNode.removeChild(this.domNode);\r\n        }\r\n        if (this.items) {\r\n            Object.keys(this.items).forEach(function (key) { return _this.items[key].removeFromDOM(); });\r\n        }\r\n        if (this.context.cache) {\r\n            this.context.cache.dispose();\r\n        }\r\n        this.gestureDisposable.dispose();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    TreeView.BINDING = 'monaco-tree-row';\r\n    TreeView.LOADING_DECORATION_DELAY = 800;\r\n    TreeView.counter = 0;\r\n    return TreeView;\r\n}(HeightMap));\r\nexport { TreeView };\r\n"]},"metadata":{},"sourceType":"module"}