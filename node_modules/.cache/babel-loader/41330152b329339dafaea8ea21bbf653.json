{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from './dom.js';\nimport * as platform from '../common/platform.js';\nimport * as browser from './browser.js';\nimport { IframeUtils } from './iframe.js';\nimport { StandardMouseEvent } from './mouseEvent.js';\nimport { DisposableStore } from '../common/lifecycle.js';\nimport { BrowserFeatures } from './canIUse.js';\nexport function standardMouseMoveMerger(lastEvent, currentEvent) {\n  var ev = new StandardMouseEvent(currentEvent);\n  ev.preventDefault();\n  return {\n    leftButton: ev.leftButton,\n    buttons: ev.buttons,\n    posx: ev.posx,\n    posy: ev.posy\n  };\n}\n\nvar GlobalMouseMoveMonitor =\n/** @class */\nfunction () {\n  function GlobalMouseMoveMonitor() {\n    this._hooks = new DisposableStore();\n    this._mouseMoveEventMerger = null;\n    this._mouseMoveCallback = null;\n    this._onStopCallback = null;\n  }\n\n  GlobalMouseMoveMonitor.prototype.dispose = function () {\n    this.stopMonitoring(false);\n\n    this._hooks.dispose();\n  };\n\n  GlobalMouseMoveMonitor.prototype.stopMonitoring = function (invokeStopCallback) {\n    if (!this.isMonitoring()) {\n      // Not monitoring\n      return;\n    } // Unhook\n\n\n    this._hooks.clear();\n\n    this._mouseMoveEventMerger = null;\n    this._mouseMoveCallback = null;\n    var onStopCallback = this._onStopCallback;\n    this._onStopCallback = null;\n\n    if (invokeStopCallback && onStopCallback) {\n      onStopCallback();\n    }\n  };\n\n  GlobalMouseMoveMonitor.prototype.isMonitoring = function () {\n    return !!this._mouseMoveEventMerger;\n  };\n\n  GlobalMouseMoveMonitor.prototype.startMonitoring = function (initialElement, initialButtons, mouseMoveEventMerger, mouseMoveCallback, onStopCallback) {\n    var _this = this;\n\n    if (this.isMonitoring()) {\n      // I am already hooked\n      return;\n    }\n\n    this._mouseMoveEventMerger = mouseMoveEventMerger;\n    this._mouseMoveCallback = mouseMoveCallback;\n    this._onStopCallback = onStopCallback;\n    var windowChain = IframeUtils.getSameOriginWindowChain();\n    var mouseMove = platform.isIOS && BrowserFeatures.pointerEvents ? 'pointermove' : 'mousemove';\n    var mouseUp = platform.isIOS && BrowserFeatures.pointerEvents ? 'pointerup' : 'mouseup';\n    var listenTo = windowChain.map(function (element) {\n      return element.window.document;\n    });\n    var shadowRoot = dom.getShadowRoot(initialElement);\n\n    if (shadowRoot) {\n      listenTo.unshift(shadowRoot);\n    }\n\n    for (var _i = 0, listenTo_1 = listenTo; _i < listenTo_1.length; _i++) {\n      var element = listenTo_1[_i];\n\n      this._hooks.add(dom.addDisposableThrottledListener(element, mouseMove, function (data) {\n        if (!browser.isIE && data.buttons !== initialButtons) {\n          // Buttons state has changed in the meantime\n          _this.stopMonitoring(true);\n\n          return;\n        }\n\n        _this._mouseMoveCallback(data);\n      }, function (lastEvent, currentEvent) {\n        return _this._mouseMoveEventMerger(lastEvent, currentEvent);\n      }));\n\n      this._hooks.add(dom.addDisposableListener(element, mouseUp, function (e) {\n        return _this.stopMonitoring(true);\n      }));\n    }\n\n    if (IframeUtils.hasDifferentOriginAncestor()) {\n      var lastSameOriginAncestor = windowChain[windowChain.length - 1]; // We might miss a mouse up if it happens outside the iframe\n      // This one is for Chrome\n\n      this._hooks.add(dom.addDisposableListener(lastSameOriginAncestor.window.document, 'mouseout', function (browserEvent) {\n        var e = new StandardMouseEvent(browserEvent);\n\n        if (e.target.tagName.toLowerCase() === 'html') {\n          _this.stopMonitoring(true);\n        }\n      })); // This one is for FF\n\n\n      this._hooks.add(dom.addDisposableListener(lastSameOriginAncestor.window.document, 'mouseover', function (browserEvent) {\n        var e = new StandardMouseEvent(browserEvent);\n\n        if (e.target.tagName.toLowerCase() === 'html') {\n          _this.stopMonitoring(true);\n        }\n      })); // This one is for IE\n\n\n      this._hooks.add(dom.addDisposableListener(lastSameOriginAncestor.window.document.body, 'mouseleave', function (browserEvent) {\n        _this.stopMonitoring(true);\n      }));\n    }\n  };\n\n  return GlobalMouseMoveMonitor;\n}();\n\nexport { GlobalMouseMoveMonitor };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/globalMouseMoveMonitor.js"],"names":["dom","platform","browser","IframeUtils","StandardMouseEvent","DisposableStore","BrowserFeatures","standardMouseMoveMerger","lastEvent","currentEvent","ev","preventDefault","leftButton","buttons","posx","posy","GlobalMouseMoveMonitor","_hooks","_mouseMoveEventMerger","_mouseMoveCallback","_onStopCallback","prototype","dispose","stopMonitoring","invokeStopCallback","isMonitoring","clear","onStopCallback","startMonitoring","initialElement","initialButtons","mouseMoveEventMerger","mouseMoveCallback","_this","windowChain","getSameOriginWindowChain","mouseMove","isIOS","pointerEvents","mouseUp","listenTo","map","element","window","document","shadowRoot","getShadowRoot","unshift","_i","listenTo_1","length","add","addDisposableThrottledListener","data","isIE","addDisposableListener","e","hasDifferentOriginAncestor","lastSameOriginAncestor","browserEvent","target","tagName","toLowerCase","body"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as dom from './dom.js';\r\nimport * as platform from '../common/platform.js';\r\nimport * as browser from './browser.js';\r\nimport { IframeUtils } from './iframe.js';\r\nimport { StandardMouseEvent } from './mouseEvent.js';\r\nimport { DisposableStore } from '../common/lifecycle.js';\r\nimport { BrowserFeatures } from './canIUse.js';\r\nexport function standardMouseMoveMerger(lastEvent, currentEvent) {\r\n    var ev = new StandardMouseEvent(currentEvent);\r\n    ev.preventDefault();\r\n    return {\r\n        leftButton: ev.leftButton,\r\n        buttons: ev.buttons,\r\n        posx: ev.posx,\r\n        posy: ev.posy\r\n    };\r\n}\r\nvar GlobalMouseMoveMonitor = /** @class */ (function () {\r\n    function GlobalMouseMoveMonitor() {\r\n        this._hooks = new DisposableStore();\r\n        this._mouseMoveEventMerger = null;\r\n        this._mouseMoveCallback = null;\r\n        this._onStopCallback = null;\r\n    }\r\n    GlobalMouseMoveMonitor.prototype.dispose = function () {\r\n        this.stopMonitoring(false);\r\n        this._hooks.dispose();\r\n    };\r\n    GlobalMouseMoveMonitor.prototype.stopMonitoring = function (invokeStopCallback) {\r\n        if (!this.isMonitoring()) {\r\n            // Not monitoring\r\n            return;\r\n        }\r\n        // Unhook\r\n        this._hooks.clear();\r\n        this._mouseMoveEventMerger = null;\r\n        this._mouseMoveCallback = null;\r\n        var onStopCallback = this._onStopCallback;\r\n        this._onStopCallback = null;\r\n        if (invokeStopCallback && onStopCallback) {\r\n            onStopCallback();\r\n        }\r\n    };\r\n    GlobalMouseMoveMonitor.prototype.isMonitoring = function () {\r\n        return !!this._mouseMoveEventMerger;\r\n    };\r\n    GlobalMouseMoveMonitor.prototype.startMonitoring = function (initialElement, initialButtons, mouseMoveEventMerger, mouseMoveCallback, onStopCallback) {\r\n        var _this = this;\r\n        if (this.isMonitoring()) {\r\n            // I am already hooked\r\n            return;\r\n        }\r\n        this._mouseMoveEventMerger = mouseMoveEventMerger;\r\n        this._mouseMoveCallback = mouseMoveCallback;\r\n        this._onStopCallback = onStopCallback;\r\n        var windowChain = IframeUtils.getSameOriginWindowChain();\r\n        var mouseMove = platform.isIOS && BrowserFeatures.pointerEvents ? 'pointermove' : 'mousemove';\r\n        var mouseUp = platform.isIOS && BrowserFeatures.pointerEvents ? 'pointerup' : 'mouseup';\r\n        var listenTo = windowChain.map(function (element) { return element.window.document; });\r\n        var shadowRoot = dom.getShadowRoot(initialElement);\r\n        if (shadowRoot) {\r\n            listenTo.unshift(shadowRoot);\r\n        }\r\n        for (var _i = 0, listenTo_1 = listenTo; _i < listenTo_1.length; _i++) {\r\n            var element = listenTo_1[_i];\r\n            this._hooks.add(dom.addDisposableThrottledListener(element, mouseMove, function (data) {\r\n                if (!browser.isIE && data.buttons !== initialButtons) {\r\n                    // Buttons state has changed in the meantime\r\n                    _this.stopMonitoring(true);\r\n                    return;\r\n                }\r\n                _this._mouseMoveCallback(data);\r\n            }, function (lastEvent, currentEvent) { return _this._mouseMoveEventMerger(lastEvent, currentEvent); }));\r\n            this._hooks.add(dom.addDisposableListener(element, mouseUp, function (e) { return _this.stopMonitoring(true); }));\r\n        }\r\n        if (IframeUtils.hasDifferentOriginAncestor()) {\r\n            var lastSameOriginAncestor = windowChain[windowChain.length - 1];\r\n            // We might miss a mouse up if it happens outside the iframe\r\n            // This one is for Chrome\r\n            this._hooks.add(dom.addDisposableListener(lastSameOriginAncestor.window.document, 'mouseout', function (browserEvent) {\r\n                var e = new StandardMouseEvent(browserEvent);\r\n                if (e.target.tagName.toLowerCase() === 'html') {\r\n                    _this.stopMonitoring(true);\r\n                }\r\n            }));\r\n            // This one is for FF\r\n            this._hooks.add(dom.addDisposableListener(lastSameOriginAncestor.window.document, 'mouseover', function (browserEvent) {\r\n                var e = new StandardMouseEvent(browserEvent);\r\n                if (e.target.tagName.toLowerCase() === 'html') {\r\n                    _this.stopMonitoring(true);\r\n                }\r\n            }));\r\n            // This one is for IE\r\n            this._hooks.add(dom.addDisposableListener(lastSameOriginAncestor.window.document.body, 'mouseleave', function (browserEvent) {\r\n                _this.stopMonitoring(true);\r\n            }));\r\n        }\r\n    };\r\n    return GlobalMouseMoveMonitor;\r\n}());\r\nexport { GlobalMouseMoveMonitor };\r\n"]},"metadata":{},"sourceType":"module"}