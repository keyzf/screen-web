{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport * as arrays from '../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerModelCommand } from '../../browser/editorExtensions.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport * as modes from '../../common/modes.js';\nimport * as nls from '../../../nls.js';\nimport { dispose } from '../../../base/common/lifecycle.js';\nimport { WordSelectionRangeProvider } from './wordSelections.js';\nimport { BracketSelectionRangeProvider } from './bracketSelections.js';\nimport { CommandsRegistry } from '../../../platform/commands/common/commands.js';\nimport { onUnexpectedExternalError } from '../../../base/common/errors.js';\n\nvar SelectionRanges =\n/** @class */\nfunction () {\n  function SelectionRanges(index, ranges) {\n    this.index = index;\n    this.ranges = ranges;\n  }\n\n  SelectionRanges.prototype.mov = function (fwd) {\n    var index = this.index + (fwd ? 1 : -1);\n\n    if (index < 0 || index >= this.ranges.length) {\n      return this;\n    }\n\n    var res = new SelectionRanges(index, this.ranges);\n\n    if (res.ranges[index].equalsRange(this.ranges[this.index])) {\n      // next range equals this range, retry with next-next\n      return res.mov(fwd);\n    }\n\n    return res;\n  };\n\n  return SelectionRanges;\n}();\n\nvar SmartSelectController =\n/** @class */\nfunction () {\n  function SmartSelectController(editor) {\n    this._ignoreSelection = false;\n    this._editor = editor;\n  }\n\n  SmartSelectController.get = function (editor) {\n    return editor.getContribution(SmartSelectController.ID);\n  };\n\n  SmartSelectController.prototype.dispose = function () {\n    dispose(this._selectionListener);\n  };\n\n  SmartSelectController.prototype.run = function (forward) {\n    var _this = this;\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    var selections = this._editor.getSelections();\n\n    var model = this._editor.getModel();\n\n    if (!modes.SelectionRangeRegistry.has(model)) {\n      return;\n    }\n\n    var promise = Promise.resolve(undefined);\n\n    if (!this._state) {\n      promise = provideSelectionRanges(model, selections.map(function (s) {\n        return s.getPosition();\n      }), CancellationToken.None).then(function (ranges) {\n        if (!arrays.isNonEmptyArray(ranges) || ranges.length !== selections.length) {\n          // invalid result\n          return;\n        }\n\n        if (!_this._editor.hasModel() || !arrays.equals(_this._editor.getSelections(), selections, function (a, b) {\n          return a.equalsSelection(b);\n        })) {\n          // invalid editor state\n          return;\n        }\n\n        var _loop_1 = function (i) {\n          ranges[i] = ranges[i].filter(function (range) {\n            // filter ranges inside the selection\n            return range.containsPosition(selections[i].getStartPosition()) && range.containsPosition(selections[i].getEndPosition());\n          }); // prepend current selection\n\n          ranges[i].unshift(selections[i]);\n        };\n\n        for (var i = 0; i < ranges.length; i++) {\n          _loop_1(i);\n        }\n\n        _this._state = ranges.map(function (ranges) {\n          return new SelectionRanges(0, ranges);\n        }); // listen to caret move and forget about state\n\n        dispose(_this._selectionListener);\n        _this._selectionListener = _this._editor.onDidChangeCursorPosition(function () {\n          if (!_this._ignoreSelection) {\n            dispose(_this._selectionListener);\n            _this._state = undefined;\n          }\n        });\n      });\n    }\n\n    return promise.then(function () {\n      if (!_this._state) {\n        // no state\n        return;\n      }\n\n      _this._state = _this._state.map(function (state) {\n        return state.mov(forward);\n      });\n\n      var selections = _this._state.map(function (state) {\n        return Selection.fromPositions(state.ranges[state.index].getStartPosition(), state.ranges[state.index].getEndPosition());\n      });\n\n      _this._ignoreSelection = true;\n\n      try {\n        _this._editor.setSelections(selections);\n      } finally {\n        _this._ignoreSelection = false;\n      }\n    });\n  };\n\n  SmartSelectController.ID = 'editor.contrib.smartSelectController';\n  return SmartSelectController;\n}();\n\nvar AbstractSmartSelect =\n/** @class */\nfunction (_super) {\n  __extends(AbstractSmartSelect, _super);\n\n  function AbstractSmartSelect(forward, opts) {\n    var _this = _super.call(this, opts) || this;\n\n    _this._forward = forward;\n    return _this;\n  }\n\n  AbstractSmartSelect.prototype.run = function (_accessor, editor) {\n    return __awaiter(this, void 0, void 0, function () {\n      var controller;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            controller = SmartSelectController.get(editor);\n            if (!controller) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , controller.run(this._forward)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return AbstractSmartSelect;\n}(EditorAction);\n\nvar GrowSelectionAction =\n/** @class */\nfunction (_super) {\n  __extends(GrowSelectionAction, _super);\n\n  function GrowSelectionAction() {\n    return _super.call(this, true, {\n      id: 'editor.action.smartSelect.expand',\n      label: nls.localize('smartSelect.expand', \"Expand Selection\"),\n      alias: 'Expand Selection',\n      precondition: undefined,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 1024\n        /* Shift */\n        | 512\n        /* Alt */\n        | 17\n        /* RightArrow */\n        ,\n        mac: {\n          primary: 2048\n          /* CtrlCmd */\n          | 256\n          /* WinCtrl */\n          | 1024\n          /* Shift */\n          | 17\n          /* RightArrow */\n          ,\n          secondary: [256\n          /* WinCtrl */\n          | 1024\n          /* Shift */\n          | 17\n          /* RightArrow */\n          ]\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      menuOpts: {\n        menuId: 25\n        /* MenubarSelectionMenu */\n        ,\n        group: '1_basic',\n        title: nls.localize({\n          key: 'miSmartSelectGrow',\n          comment: ['&& denotes a mnemonic']\n        }, \"&&Expand Selection\"),\n        order: 2\n      }\n    }) || this;\n  }\n\n  return GrowSelectionAction;\n}(AbstractSmartSelect); // renamed command id\n\n\nCommandsRegistry.registerCommandAlias('editor.action.smartSelect.grow', 'editor.action.smartSelect.expand');\n\nvar ShrinkSelectionAction =\n/** @class */\nfunction (_super) {\n  __extends(ShrinkSelectionAction, _super);\n\n  function ShrinkSelectionAction() {\n    return _super.call(this, false, {\n      id: 'editor.action.smartSelect.shrink',\n      label: nls.localize('smartSelect.shrink', \"Shrink Selection\"),\n      alias: 'Shrink Selection',\n      precondition: undefined,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 1024\n        /* Shift */\n        | 512\n        /* Alt */\n        | 15\n        /* LeftArrow */\n        ,\n        mac: {\n          primary: 2048\n          /* CtrlCmd */\n          | 256\n          /* WinCtrl */\n          | 1024\n          /* Shift */\n          | 15\n          /* LeftArrow */\n          ,\n          secondary: [256\n          /* WinCtrl */\n          | 1024\n          /* Shift */\n          | 15\n          /* LeftArrow */\n          ]\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      menuOpts: {\n        menuId: 25\n        /* MenubarSelectionMenu */\n        ,\n        group: '1_basic',\n        title: nls.localize({\n          key: 'miSmartSelectShrink',\n          comment: ['&& denotes a mnemonic']\n        }, \"&&Shrink Selection\"),\n        order: 3\n      }\n    }) || this;\n  }\n\n  return ShrinkSelectionAction;\n}(AbstractSmartSelect);\n\nregisterEditorContribution(SmartSelectController.ID, SmartSelectController);\nregisterEditorAction(GrowSelectionAction);\nregisterEditorAction(ShrinkSelectionAction); // word selection\n\nmodes.SelectionRangeRegistry.register('*', new WordSelectionRangeProvider());\nexport function provideSelectionRanges(model, positions, token) {\n  var providers = modes.SelectionRangeRegistry.all(model);\n\n  if (providers.length === 1) {\n    // add word selection and bracket selection when no provider exists\n    providers.unshift(new BracketSelectionRangeProvider());\n  }\n\n  var work = [];\n  var allRawRanges = [];\n\n  for (var _i = 0, providers_1 = providers; _i < providers_1.length; _i++) {\n    var provider = providers_1[_i];\n    work.push(Promise.resolve(provider.provideSelectionRanges(model, positions, token)).then(function (allProviderRanges) {\n      if (arrays.isNonEmptyArray(allProviderRanges) && allProviderRanges.length === positions.length) {\n        for (var i = 0; i < positions.length; i++) {\n          if (!allRawRanges[i]) {\n            allRawRanges[i] = [];\n          }\n\n          for (var _i = 0, _a = allProviderRanges[i]; _i < _a.length; _i++) {\n            var oneProviderRanges = _a[_i];\n\n            if (Range.isIRange(oneProviderRanges.range) && Range.containsPosition(oneProviderRanges.range, positions[i])) {\n              allRawRanges[i].push(Range.lift(oneProviderRanges.range));\n            }\n          }\n        }\n      }\n    }, onUnexpectedExternalError));\n  }\n\n  return Promise.all(work).then(function () {\n    return allRawRanges.map(function (oneRawRanges) {\n      if (oneRawRanges.length === 0) {\n        return [];\n      } // sort all by start/end position\n\n\n      oneRawRanges.sort(function (a, b) {\n        if (Position.isBefore(a.getStartPosition(), b.getStartPosition())) {\n          return 1;\n        } else if (Position.isBefore(b.getStartPosition(), a.getStartPosition())) {\n          return -1;\n        } else if (Position.isBefore(a.getEndPosition(), b.getEndPosition())) {\n          return -1;\n        } else if (Position.isBefore(b.getEndPosition(), a.getEndPosition())) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }); // remove ranges that don't contain the former range or that are equal to the\n      // former range\n\n      var oneRanges = [];\n      var last;\n\n      for (var _i = 0, oneRawRanges_1 = oneRawRanges; _i < oneRawRanges_1.length; _i++) {\n        var range = oneRawRanges_1[_i];\n\n        if (!last || Range.containsRange(range, last) && !Range.equalsRange(range, last)) {\n          oneRanges.push(range);\n          last = range;\n        }\n      } // add ranges that expand trivia at line starts and ends whenever a range\n      // wraps onto the a new line\n\n\n      var oneRangesWithTrivia = [oneRanges[0]];\n\n      for (var i = 1; i < oneRanges.length; i++) {\n        var prev = oneRanges[i - 1];\n        var cur = oneRanges[i];\n\n        if (cur.startLineNumber !== prev.startLineNumber || cur.endLineNumber !== prev.endLineNumber) {\n          // add line/block range without leading/failing whitespace\n          var rangeNoWhitespace = new Range(prev.startLineNumber, model.getLineFirstNonWhitespaceColumn(prev.startLineNumber), prev.endLineNumber, model.getLineLastNonWhitespaceColumn(prev.endLineNumber));\n\n          if (rangeNoWhitespace.containsRange(prev) && !rangeNoWhitespace.equalsRange(prev) && cur.containsRange(rangeNoWhitespace) && !cur.equalsRange(rangeNoWhitespace)) {\n            oneRangesWithTrivia.push(rangeNoWhitespace);\n          } // add line/block range\n\n\n          var rangeFull = new Range(prev.startLineNumber, 1, prev.endLineNumber, model.getLineMaxColumn(prev.endLineNumber));\n\n          if (rangeFull.containsRange(prev) && !rangeFull.equalsRange(rangeNoWhitespace) && cur.containsRange(rangeFull) && !cur.equalsRange(rangeFull)) {\n            oneRangesWithTrivia.push(rangeFull);\n          }\n        }\n\n        oneRangesWithTrivia.push(cur);\n      }\n\n      return oneRangesWithTrivia;\n    });\n  });\n}\nregisterModelCommand('_executeSelectionRangeProvider', function (model) {\n  var args = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    args[_i - 1] = arguments[_i];\n  }\n\n  var positions = args[0];\n  return provideSelectionRanges(model, positions, CancellationToken.None);\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/smartSelect/smartSelect.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","arrays","CancellationToken","EditorAction","registerEditorAction","registerEditorContribution","registerModelCommand","Position","Range","Selection","EditorContextKeys","modes","nls","dispose","WordSelectionRangeProvider","BracketSelectionRangeProvider","CommandsRegistry","onUnexpectedExternalError","SelectionRanges","index","ranges","mov","fwd","res","equalsRange","SmartSelectController","editor","_ignoreSelection","_editor","get","getContribution","ID","_selectionListener","run","forward","_this","hasModel","selections","getSelections","model","getModel","SelectionRangeRegistry","has","promise","undefined","_state","provideSelectionRanges","map","s","getPosition","None","isNonEmptyArray","equals","a","equalsSelection","_loop_1","i","filter","range","containsPosition","getStartPosition","getEndPosition","unshift","onDidChangeCursorPosition","state","fromPositions","setSelections","AbstractSmartSelect","_super","opts","_forward","_accessor","controller","_a","GrowSelectionAction","id","localize","alias","precondition","kbOpts","kbExpr","editorTextFocus","primary","mac","secondary","weight","menuOpts","menuId","group","title","key","comment","order","registerCommandAlias","ShrinkSelectionAction","register","positions","token","providers","all","work","allRawRanges","_i","providers_1","provider","allProviderRanges","oneProviderRanges","isIRange","lift","oneRawRanges","sort","isBefore","oneRanges","last","oneRawRanges_1","containsRange","oneRangesWithTrivia","prev","cur","startLineNumber","endLineNumber","rangeNoWhitespace","getLineFirstNonWhitespaceColumn","getLineLastNonWhitespaceColumn","rangeFull","getLineMaxColumn","args","arguments"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport * as arrays from '../../../base/common/arrays.js';\r\nimport { CancellationToken } from '../../../base/common/cancellation.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerModelCommand } from '../../browser/editorExtensions.js';\r\nimport { Position } from '../../common/core/position.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { Selection } from '../../common/core/selection.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport * as modes from '../../common/modes.js';\r\nimport * as nls from '../../../nls.js';\r\nimport { dispose } from '../../../base/common/lifecycle.js';\r\nimport { WordSelectionRangeProvider } from './wordSelections.js';\r\nimport { BracketSelectionRangeProvider } from './bracketSelections.js';\r\nimport { CommandsRegistry } from '../../../platform/commands/common/commands.js';\r\nimport { onUnexpectedExternalError } from '../../../base/common/errors.js';\r\nvar SelectionRanges = /** @class */ (function () {\r\n    function SelectionRanges(index, ranges) {\r\n        this.index = index;\r\n        this.ranges = ranges;\r\n    }\r\n    SelectionRanges.prototype.mov = function (fwd) {\r\n        var index = this.index + (fwd ? 1 : -1);\r\n        if (index < 0 || index >= this.ranges.length) {\r\n            return this;\r\n        }\r\n        var res = new SelectionRanges(index, this.ranges);\r\n        if (res.ranges[index].equalsRange(this.ranges[this.index])) {\r\n            // next range equals this range, retry with next-next\r\n            return res.mov(fwd);\r\n        }\r\n        return res;\r\n    };\r\n    return SelectionRanges;\r\n}());\r\nvar SmartSelectController = /** @class */ (function () {\r\n    function SmartSelectController(editor) {\r\n        this._ignoreSelection = false;\r\n        this._editor = editor;\r\n    }\r\n    SmartSelectController.get = function (editor) {\r\n        return editor.getContribution(SmartSelectController.ID);\r\n    };\r\n    SmartSelectController.prototype.dispose = function () {\r\n        dispose(this._selectionListener);\r\n    };\r\n    SmartSelectController.prototype.run = function (forward) {\r\n        var _this = this;\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        var selections = this._editor.getSelections();\r\n        var model = this._editor.getModel();\r\n        if (!modes.SelectionRangeRegistry.has(model)) {\r\n            return;\r\n        }\r\n        var promise = Promise.resolve(undefined);\r\n        if (!this._state) {\r\n            promise = provideSelectionRanges(model, selections.map(function (s) { return s.getPosition(); }), CancellationToken.None).then(function (ranges) {\r\n                if (!arrays.isNonEmptyArray(ranges) || ranges.length !== selections.length) {\r\n                    // invalid result\r\n                    return;\r\n                }\r\n                if (!_this._editor.hasModel() || !arrays.equals(_this._editor.getSelections(), selections, function (a, b) { return a.equalsSelection(b); })) {\r\n                    // invalid editor state\r\n                    return;\r\n                }\r\n                var _loop_1 = function (i) {\r\n                    ranges[i] = ranges[i].filter(function (range) {\r\n                        // filter ranges inside the selection\r\n                        return range.containsPosition(selections[i].getStartPosition()) && range.containsPosition(selections[i].getEndPosition());\r\n                    });\r\n                    // prepend current selection\r\n                    ranges[i].unshift(selections[i]);\r\n                };\r\n                for (var i = 0; i < ranges.length; i++) {\r\n                    _loop_1(i);\r\n                }\r\n                _this._state = ranges.map(function (ranges) { return new SelectionRanges(0, ranges); });\r\n                // listen to caret move and forget about state\r\n                dispose(_this._selectionListener);\r\n                _this._selectionListener = _this._editor.onDidChangeCursorPosition(function () {\r\n                    if (!_this._ignoreSelection) {\r\n                        dispose(_this._selectionListener);\r\n                        _this._state = undefined;\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        return promise.then(function () {\r\n            if (!_this._state) {\r\n                // no state\r\n                return;\r\n            }\r\n            _this._state = _this._state.map(function (state) { return state.mov(forward); });\r\n            var selections = _this._state.map(function (state) { return Selection.fromPositions(state.ranges[state.index].getStartPosition(), state.ranges[state.index].getEndPosition()); });\r\n            _this._ignoreSelection = true;\r\n            try {\r\n                _this._editor.setSelections(selections);\r\n            }\r\n            finally {\r\n                _this._ignoreSelection = false;\r\n            }\r\n        });\r\n    };\r\n    SmartSelectController.ID = 'editor.contrib.smartSelectController';\r\n    return SmartSelectController;\r\n}());\r\nvar AbstractSmartSelect = /** @class */ (function (_super) {\r\n    __extends(AbstractSmartSelect, _super);\r\n    function AbstractSmartSelect(forward, opts) {\r\n        var _this = _super.call(this, opts) || this;\r\n        _this._forward = forward;\r\n        return _this;\r\n    }\r\n    AbstractSmartSelect.prototype.run = function (_accessor, editor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var controller;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        controller = SmartSelectController.get(editor);\r\n                        if (!controller) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, controller.run(this._forward)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return AbstractSmartSelect;\r\n}(EditorAction));\r\nvar GrowSelectionAction = /** @class */ (function (_super) {\r\n    __extends(GrowSelectionAction, _super);\r\n    function GrowSelectionAction() {\r\n        return _super.call(this, true, {\r\n            id: 'editor.action.smartSelect.expand',\r\n            label: nls.localize('smartSelect.expand', \"Expand Selection\"),\r\n            alias: 'Expand Selection',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 1024 /* Shift */ | 512 /* Alt */ | 17 /* RightArrow */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 256 /* WinCtrl */ | 1024 /* Shift */ | 17 /* RightArrow */,\r\n                    secondary: [256 /* WinCtrl */ | 1024 /* Shift */ | 17 /* RightArrow */],\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            menuOpts: {\r\n                menuId: 25 /* MenubarSelectionMenu */,\r\n                group: '1_basic',\r\n                title: nls.localize({ key: 'miSmartSelectGrow', comment: ['&& denotes a mnemonic'] }, \"&&Expand Selection\"),\r\n                order: 2\r\n            }\r\n        }) || this;\r\n    }\r\n    return GrowSelectionAction;\r\n}(AbstractSmartSelect));\r\n// renamed command id\r\nCommandsRegistry.registerCommandAlias('editor.action.smartSelect.grow', 'editor.action.smartSelect.expand');\r\nvar ShrinkSelectionAction = /** @class */ (function (_super) {\r\n    __extends(ShrinkSelectionAction, _super);\r\n    function ShrinkSelectionAction() {\r\n        return _super.call(this, false, {\r\n            id: 'editor.action.smartSelect.shrink',\r\n            label: nls.localize('smartSelect.shrink', \"Shrink Selection\"),\r\n            alias: 'Shrink Selection',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: 1024 /* Shift */ | 512 /* Alt */ | 15 /* LeftArrow */,\r\n                mac: {\r\n                    primary: 2048 /* CtrlCmd */ | 256 /* WinCtrl */ | 1024 /* Shift */ | 15 /* LeftArrow */,\r\n                    secondary: [256 /* WinCtrl */ | 1024 /* Shift */ | 15 /* LeftArrow */],\r\n                },\r\n                weight: 100 /* EditorContrib */\r\n            },\r\n            menuOpts: {\r\n                menuId: 25 /* MenubarSelectionMenu */,\r\n                group: '1_basic',\r\n                title: nls.localize({ key: 'miSmartSelectShrink', comment: ['&& denotes a mnemonic'] }, \"&&Shrink Selection\"),\r\n                order: 3\r\n            }\r\n        }) || this;\r\n    }\r\n    return ShrinkSelectionAction;\r\n}(AbstractSmartSelect));\r\nregisterEditorContribution(SmartSelectController.ID, SmartSelectController);\r\nregisterEditorAction(GrowSelectionAction);\r\nregisterEditorAction(ShrinkSelectionAction);\r\n// word selection\r\nmodes.SelectionRangeRegistry.register('*', new WordSelectionRangeProvider());\r\nexport function provideSelectionRanges(model, positions, token) {\r\n    var providers = modes.SelectionRangeRegistry.all(model);\r\n    if (providers.length === 1) {\r\n        // add word selection and bracket selection when no provider exists\r\n        providers.unshift(new BracketSelectionRangeProvider());\r\n    }\r\n    var work = [];\r\n    var allRawRanges = [];\r\n    for (var _i = 0, providers_1 = providers; _i < providers_1.length; _i++) {\r\n        var provider = providers_1[_i];\r\n        work.push(Promise.resolve(provider.provideSelectionRanges(model, positions, token)).then(function (allProviderRanges) {\r\n            if (arrays.isNonEmptyArray(allProviderRanges) && allProviderRanges.length === positions.length) {\r\n                for (var i = 0; i < positions.length; i++) {\r\n                    if (!allRawRanges[i]) {\r\n                        allRawRanges[i] = [];\r\n                    }\r\n                    for (var _i = 0, _a = allProviderRanges[i]; _i < _a.length; _i++) {\r\n                        var oneProviderRanges = _a[_i];\r\n                        if (Range.isIRange(oneProviderRanges.range) && Range.containsPosition(oneProviderRanges.range, positions[i])) {\r\n                            allRawRanges[i].push(Range.lift(oneProviderRanges.range));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }, onUnexpectedExternalError));\r\n    }\r\n    return Promise.all(work).then(function () {\r\n        return allRawRanges.map(function (oneRawRanges) {\r\n            if (oneRawRanges.length === 0) {\r\n                return [];\r\n            }\r\n            // sort all by start/end position\r\n            oneRawRanges.sort(function (a, b) {\r\n                if (Position.isBefore(a.getStartPosition(), b.getStartPosition())) {\r\n                    return 1;\r\n                }\r\n                else if (Position.isBefore(b.getStartPosition(), a.getStartPosition())) {\r\n                    return -1;\r\n                }\r\n                else if (Position.isBefore(a.getEndPosition(), b.getEndPosition())) {\r\n                    return -1;\r\n                }\r\n                else if (Position.isBefore(b.getEndPosition(), a.getEndPosition())) {\r\n                    return 1;\r\n                }\r\n                else {\r\n                    return 0;\r\n                }\r\n            });\r\n            // remove ranges that don't contain the former range or that are equal to the\r\n            // former range\r\n            var oneRanges = [];\r\n            var last;\r\n            for (var _i = 0, oneRawRanges_1 = oneRawRanges; _i < oneRawRanges_1.length; _i++) {\r\n                var range = oneRawRanges_1[_i];\r\n                if (!last || (Range.containsRange(range, last) && !Range.equalsRange(range, last))) {\r\n                    oneRanges.push(range);\r\n                    last = range;\r\n                }\r\n            }\r\n            // add ranges that expand trivia at line starts and ends whenever a range\r\n            // wraps onto the a new line\r\n            var oneRangesWithTrivia = [oneRanges[0]];\r\n            for (var i = 1; i < oneRanges.length; i++) {\r\n                var prev = oneRanges[i - 1];\r\n                var cur = oneRanges[i];\r\n                if (cur.startLineNumber !== prev.startLineNumber || cur.endLineNumber !== prev.endLineNumber) {\r\n                    // add line/block range without leading/failing whitespace\r\n                    var rangeNoWhitespace = new Range(prev.startLineNumber, model.getLineFirstNonWhitespaceColumn(prev.startLineNumber), prev.endLineNumber, model.getLineLastNonWhitespaceColumn(prev.endLineNumber));\r\n                    if (rangeNoWhitespace.containsRange(prev) && !rangeNoWhitespace.equalsRange(prev) && cur.containsRange(rangeNoWhitespace) && !cur.equalsRange(rangeNoWhitespace)) {\r\n                        oneRangesWithTrivia.push(rangeNoWhitespace);\r\n                    }\r\n                    // add line/block range\r\n                    var rangeFull = new Range(prev.startLineNumber, 1, prev.endLineNumber, model.getLineMaxColumn(prev.endLineNumber));\r\n                    if (rangeFull.containsRange(prev) && !rangeFull.equalsRange(rangeNoWhitespace) && cur.containsRange(rangeFull) && !cur.equalsRange(rangeFull)) {\r\n                        oneRangesWithTrivia.push(rangeFull);\r\n                    }\r\n                }\r\n                oneRangesWithTrivia.push(cur);\r\n            }\r\n            return oneRangesWithTrivia;\r\n        });\r\n    });\r\n}\r\nregisterModelCommand('_executeSelectionRangeProvider', function (model) {\r\n    var args = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        args[_i - 1] = arguments[_i];\r\n    }\r\n    var positions = args[0];\r\n    return provideSelectionRanges(model, positions, CancellationToken.None);\r\n});\r\n"]},"metadata":{},"sourceType":"module"}