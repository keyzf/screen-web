{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as Parser from '../parser/jsonParser.js';\nimport { Range } from '../jsonLanguageTypes.js';\n\nvar JSONHover =\n/** @class */\nfunction () {\n  function JSONHover(schemaService, contributions, promiseConstructor) {\n    if (contributions === void 0) {\n      contributions = [];\n    }\n\n    this.schemaService = schemaService;\n    this.contributions = contributions;\n    this.promise = promiseConstructor || Promise;\n  }\n\n  JSONHover.prototype.doHover = function (document, position, doc) {\n    var offset = document.offsetAt(position);\n    var node = doc.getNodeFromOffset(offset);\n\n    if (!node || (node.type === 'object' || node.type === 'array') && offset > node.offset + 1 && offset < node.offset + node.length - 1) {\n      return this.promise.resolve(null);\n    }\n\n    var hoverRangeNode = node; // use the property description when hovering over an object key\n\n    if (node.type === 'string') {\n      var parent = node.parent;\n\n      if (parent && parent.type === 'property' && parent.keyNode === node) {\n        node = parent.valueNode;\n\n        if (!node) {\n          return this.promise.resolve(null);\n        }\n      }\n    }\n\n    var hoverRange = Range.create(document.positionAt(hoverRangeNode.offset), document.positionAt(hoverRangeNode.offset + hoverRangeNode.length));\n\n    var createHover = function (contents) {\n      var result = {\n        contents: contents,\n        range: hoverRange\n      };\n      return result;\n    };\n\n    var location = Parser.getNodePath(node);\n\n    for (var i = this.contributions.length - 1; i >= 0; i--) {\n      var contribution = this.contributions[i];\n      var promise = contribution.getInfoContribution(document.uri, location);\n\n      if (promise) {\n        return promise.then(function (htmlContent) {\n          return createHover(htmlContent);\n        });\n      }\n    }\n\n    return this.schemaService.getSchemaForResource(document.uri, doc).then(function (schema) {\n      if (schema) {\n        var matchingSchemas = doc.getMatchingSchemas(schema.schema, node.offset);\n        var title_1 = null;\n        var markdownDescription_1 = null;\n        var markdownEnumValueDescription_1 = null,\n            enumValue_1 = null;\n        matchingSchemas.every(function (s) {\n          if (s.node === node && !s.inverted && s.schema) {\n            title_1 = title_1 || s.schema.title;\n            markdownDescription_1 = markdownDescription_1 || s.schema.markdownDescription || toMarkdown(s.schema.description);\n\n            if (s.schema.enum) {\n              var idx = s.schema.enum.indexOf(Parser.getNodeValue(node));\n\n              if (s.schema.markdownEnumDescriptions) {\n                markdownEnumValueDescription_1 = s.schema.markdownEnumDescriptions[idx];\n              } else if (s.schema.enumDescriptions) {\n                markdownEnumValueDescription_1 = toMarkdown(s.schema.enumDescriptions[idx]);\n              }\n\n              if (markdownEnumValueDescription_1) {\n                enumValue_1 = s.schema.enum[idx];\n\n                if (typeof enumValue_1 !== 'string') {\n                  enumValue_1 = JSON.stringify(enumValue_1);\n                }\n              }\n            }\n          }\n\n          return true;\n        });\n        var result = '';\n\n        if (title_1) {\n          result = toMarkdown(title_1);\n        }\n\n        if (markdownDescription_1) {\n          if (result.length > 0) {\n            result += \"\\n\\n\";\n          }\n\n          result += markdownDescription_1;\n        }\n\n        if (markdownEnumValueDescription_1) {\n          if (result.length > 0) {\n            result += \"\\n\\n\";\n          }\n\n          result += \"`\" + toMarkdownCodeBlock(enumValue_1) + \"`: \" + markdownEnumValueDescription_1;\n        }\n\n        return createHover([result]);\n      }\n\n      return null;\n    });\n  };\n\n  return JSONHover;\n}();\n\nexport { JSONHover };\n\nfunction toMarkdown(plain) {\n  if (plain) {\n    var res = plain.replace(/([^\\n\\r])(\\r?\\n)([^\\n\\r])/gm, '$1\\n\\n$3'); // single new lines to \\n\\n (Markdown paragraph)\n\n    return res.replace(/[\\\\`*_{}[\\]()#+\\-.!]/g, \"\\\\$&\"); // escape markdown syntax tokens: http://daringfireball.net/projects/markdown/syntax#backslash\n  }\n\n  return void 0;\n}\n\nfunction toMarkdownCodeBlock(content) {\n  // see https://daringfireball.net/projects/markdown/syntax#precode\n  if (content.indexOf('`') !== -1) {\n    return '`` ' + content + ' ``';\n  }\n\n  return content;\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/language/json/_deps/vscode-json-languageservice/services/jsonHover.js"],"names":["Parser","Range","JSONHover","schemaService","contributions","promiseConstructor","promise","Promise","prototype","doHover","document","position","doc","offset","offsetAt","node","getNodeFromOffset","type","length","resolve","hoverRangeNode","parent","keyNode","valueNode","hoverRange","create","positionAt","createHover","contents","result","range","location","getNodePath","i","contribution","getInfoContribution","uri","then","htmlContent","getSchemaForResource","schema","matchingSchemas","getMatchingSchemas","title_1","markdownDescription_1","markdownEnumValueDescription_1","enumValue_1","every","s","inverted","title","markdownDescription","toMarkdown","description","enum","idx","indexOf","getNodeValue","markdownEnumDescriptions","enumDescriptions","JSON","stringify","toMarkdownCodeBlock","plain","res","replace","content"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as Parser from '../parser/jsonParser.js';\nimport { Range } from '../jsonLanguageTypes.js';\nvar JSONHover = /** @class */ (function () {\n    function JSONHover(schemaService, contributions, promiseConstructor) {\n        if (contributions === void 0) { contributions = []; }\n        this.schemaService = schemaService;\n        this.contributions = contributions;\n        this.promise = promiseConstructor || Promise;\n    }\n    JSONHover.prototype.doHover = function (document, position, doc) {\n        var offset = document.offsetAt(position);\n        var node = doc.getNodeFromOffset(offset);\n        if (!node || (node.type === 'object' || node.type === 'array') && offset > node.offset + 1 && offset < node.offset + node.length - 1) {\n            return this.promise.resolve(null);\n        }\n        var hoverRangeNode = node;\n        // use the property description when hovering over an object key\n        if (node.type === 'string') {\n            var parent = node.parent;\n            if (parent && parent.type === 'property' && parent.keyNode === node) {\n                node = parent.valueNode;\n                if (!node) {\n                    return this.promise.resolve(null);\n                }\n            }\n        }\n        var hoverRange = Range.create(document.positionAt(hoverRangeNode.offset), document.positionAt(hoverRangeNode.offset + hoverRangeNode.length));\n        var createHover = function (contents) {\n            var result = {\n                contents: contents,\n                range: hoverRange\n            };\n            return result;\n        };\n        var location = Parser.getNodePath(node);\n        for (var i = this.contributions.length - 1; i >= 0; i--) {\n            var contribution = this.contributions[i];\n            var promise = contribution.getInfoContribution(document.uri, location);\n            if (promise) {\n                return promise.then(function (htmlContent) { return createHover(htmlContent); });\n            }\n        }\n        return this.schemaService.getSchemaForResource(document.uri, doc).then(function (schema) {\n            if (schema) {\n                var matchingSchemas = doc.getMatchingSchemas(schema.schema, node.offset);\n                var title_1 = null;\n                var markdownDescription_1 = null;\n                var markdownEnumValueDescription_1 = null, enumValue_1 = null;\n                matchingSchemas.every(function (s) {\n                    if (s.node === node && !s.inverted && s.schema) {\n                        title_1 = title_1 || s.schema.title;\n                        markdownDescription_1 = markdownDescription_1 || s.schema.markdownDescription || toMarkdown(s.schema.description);\n                        if (s.schema.enum) {\n                            var idx = s.schema.enum.indexOf(Parser.getNodeValue(node));\n                            if (s.schema.markdownEnumDescriptions) {\n                                markdownEnumValueDescription_1 = s.schema.markdownEnumDescriptions[idx];\n                            }\n                            else if (s.schema.enumDescriptions) {\n                                markdownEnumValueDescription_1 = toMarkdown(s.schema.enumDescriptions[idx]);\n                            }\n                            if (markdownEnumValueDescription_1) {\n                                enumValue_1 = s.schema.enum[idx];\n                                if (typeof enumValue_1 !== 'string') {\n                                    enumValue_1 = JSON.stringify(enumValue_1);\n                                }\n                            }\n                        }\n                    }\n                    return true;\n                });\n                var result = '';\n                if (title_1) {\n                    result = toMarkdown(title_1);\n                }\n                if (markdownDescription_1) {\n                    if (result.length > 0) {\n                        result += \"\\n\\n\";\n                    }\n                    result += markdownDescription_1;\n                }\n                if (markdownEnumValueDescription_1) {\n                    if (result.length > 0) {\n                        result += \"\\n\\n\";\n                    }\n                    result += \"`\" + toMarkdownCodeBlock(enumValue_1) + \"`: \" + markdownEnumValueDescription_1;\n                }\n                return createHover([result]);\n            }\n            return null;\n        });\n    };\n    return JSONHover;\n}());\nexport { JSONHover };\nfunction toMarkdown(plain) {\n    if (plain) {\n        var res = plain.replace(/([^\\n\\r])(\\r?\\n)([^\\n\\r])/gm, '$1\\n\\n$3'); // single new lines to \\n\\n (Markdown paragraph)\n        return res.replace(/[\\\\`*_{}[\\]()#+\\-.!]/g, \"\\\\$&\"); // escape markdown syntax tokens: http://daringfireball.net/projects/markdown/syntax#backslash\n    }\n    return void 0;\n}\nfunction toMarkdownCodeBlock(content) {\n    // see https://daringfireball.net/projects/markdown/syntax#precode\n    if (content.indexOf('`') !== -1) {\n        return '`` ' + content + ' ``';\n    }\n    return content;\n}\n"]},"metadata":{},"sourceType":"module"}