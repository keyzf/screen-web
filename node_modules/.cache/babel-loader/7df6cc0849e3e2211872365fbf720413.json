{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport * as dom from '../../dom.js';\nimport { createFastDomNode } from '../../fastDomNode.js';\nimport { GlobalMouseMoveMonitor, standardMouseMoveMerger } from '../../globalMouseMoveMonitor.js';\nimport { ScrollbarArrow } from './scrollbarArrow.js';\nimport { ScrollbarVisibilityController } from './scrollbarVisibilityController.js';\nimport { Widget } from '../widget.js';\nimport * as platform from '../../../common/platform.js';\n/**\r\n * The orthogonal distance to the slider at which dragging \"resets\". This implements \"snapping\"\r\n */\n\nvar MOUSE_DRAG_RESET_DISTANCE = 140;\n\nvar AbstractScrollbar =\n/** @class */\nfunction (_super) {\n  __extends(AbstractScrollbar, _super);\n\n  function AbstractScrollbar(opts) {\n    var _this = _super.call(this) || this;\n\n    _this._lazyRender = opts.lazyRender;\n    _this._host = opts.host;\n    _this._scrollable = opts.scrollable;\n    _this._scrollbarState = opts.scrollbarState;\n    _this._visibilityController = _this._register(new ScrollbarVisibilityController(opts.visibility, 'visible scrollbar ' + opts.extraScrollbarClassName, 'invisible scrollbar ' + opts.extraScrollbarClassName));\n\n    _this._visibilityController.setIsNeeded(_this._scrollbarState.isNeeded());\n\n    _this._mouseMoveMonitor = _this._register(new GlobalMouseMoveMonitor());\n    _this._shouldRender = true;\n    _this.domNode = createFastDomNode(document.createElement('div'));\n\n    _this.domNode.setAttribute('role', 'presentation');\n\n    _this.domNode.setAttribute('aria-hidden', 'true');\n\n    _this._visibilityController.setDomNode(_this.domNode);\n\n    _this.domNode.setPosition('absolute');\n\n    _this.onmousedown(_this.domNode.domNode, function (e) {\n      return _this._domNodeMouseDown(e);\n    });\n\n    return _this;\n  } // ----------------- creation\n\n  /**\r\n   * Creates the dom node for an arrow & adds it to the container\r\n   */\n\n\n  AbstractScrollbar.prototype._createArrow = function (opts) {\n    var arrow = this._register(new ScrollbarArrow(opts));\n\n    this.domNode.domNode.appendChild(arrow.bgDomNode);\n    this.domNode.domNode.appendChild(arrow.domNode);\n  };\n  /**\r\n   * Creates the slider dom node, adds it to the container & hooks up the events\r\n   */\n\n\n  AbstractScrollbar.prototype._createSlider = function (top, left, width, height) {\n    var _this = this;\n\n    this.slider = createFastDomNode(document.createElement('div'));\n    this.slider.setClassName('slider');\n    this.slider.setPosition('absolute');\n    this.slider.setTop(top);\n    this.slider.setLeft(left);\n\n    if (typeof width === 'number') {\n      this.slider.setWidth(width);\n    }\n\n    if (typeof height === 'number') {\n      this.slider.setHeight(height);\n    }\n\n    this.slider.setLayerHinting(true);\n    this.slider.setContain('strict');\n    this.domNode.domNode.appendChild(this.slider.domNode);\n    this.onmousedown(this.slider.domNode, function (e) {\n      if (e.leftButton) {\n        e.preventDefault();\n\n        _this._sliderMouseDown(e, function () {});\n      }\n    });\n    this.onclick(this.slider.domNode, function (e) {\n      if (e.leftButton) {\n        e.stopPropagation();\n      }\n    });\n  }; // ----------------- Update state\n\n\n  AbstractScrollbar.prototype._onElementSize = function (visibleSize) {\n    if (this._scrollbarState.setVisibleSize(visibleSize)) {\n      this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded());\n\n      this._shouldRender = true;\n\n      if (!this._lazyRender) {\n        this.render();\n      }\n    }\n\n    return this._shouldRender;\n  };\n\n  AbstractScrollbar.prototype._onElementScrollSize = function (elementScrollSize) {\n    if (this._scrollbarState.setScrollSize(elementScrollSize)) {\n      this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded());\n\n      this._shouldRender = true;\n\n      if (!this._lazyRender) {\n        this.render();\n      }\n    }\n\n    return this._shouldRender;\n  };\n\n  AbstractScrollbar.prototype._onElementScrollPosition = function (elementScrollPosition) {\n    if (this._scrollbarState.setScrollPosition(elementScrollPosition)) {\n      this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded());\n\n      this._shouldRender = true;\n\n      if (!this._lazyRender) {\n        this.render();\n      }\n    }\n\n    return this._shouldRender;\n  }; // ----------------- rendering\n\n\n  AbstractScrollbar.prototype.beginReveal = function () {\n    this._visibilityController.setShouldBeVisible(true);\n  };\n\n  AbstractScrollbar.prototype.beginHide = function () {\n    this._visibilityController.setShouldBeVisible(false);\n  };\n\n  AbstractScrollbar.prototype.render = function () {\n    if (!this._shouldRender) {\n      return;\n    }\n\n    this._shouldRender = false;\n\n    this._renderDomNode(this._scrollbarState.getRectangleLargeSize(), this._scrollbarState.getRectangleSmallSize());\n\n    this._updateSlider(this._scrollbarState.getSliderSize(), this._scrollbarState.getArrowSize() + this._scrollbarState.getSliderPosition());\n  }; // ----------------- DOM events\n\n\n  AbstractScrollbar.prototype._domNodeMouseDown = function (e) {\n    if (e.target !== this.domNode.domNode) {\n      return;\n    }\n\n    this._onMouseDown(e);\n  };\n\n  AbstractScrollbar.prototype.delegateMouseDown = function (e) {\n    var domTop = this.domNode.domNode.getClientRects()[0].top;\n\n    var sliderStart = domTop + this._scrollbarState.getSliderPosition();\n\n    var sliderStop = domTop + this._scrollbarState.getSliderPosition() + this._scrollbarState.getSliderSize();\n\n    var mousePos = this._sliderMousePosition(e);\n\n    if (sliderStart <= mousePos && mousePos <= sliderStop) {\n      // Act as if it was a mouse down on the slider\n      if (e.leftButton) {\n        e.preventDefault();\n\n        this._sliderMouseDown(e, function () {});\n      }\n    } else {\n      // Act as if it was a mouse down on the scrollbar\n      this._onMouseDown(e);\n    }\n  };\n\n  AbstractScrollbar.prototype._onMouseDown = function (e) {\n    var offsetX;\n    var offsetY;\n\n    if (e.target === this.domNode.domNode && typeof e.browserEvent.offsetX === 'number' && typeof e.browserEvent.offsetY === 'number') {\n      offsetX = e.browserEvent.offsetX;\n      offsetY = e.browserEvent.offsetY;\n    } else {\n      var domNodePosition = dom.getDomNodePagePosition(this.domNode.domNode);\n      offsetX = e.posx - domNodePosition.left;\n      offsetY = e.posy - domNodePosition.top;\n    }\n\n    this._setDesiredScrollPositionNow(this._scrollbarState.getDesiredScrollPositionFromOffset(this._mouseDownRelativePosition(offsetX, offsetY)));\n\n    if (e.leftButton) {\n      e.preventDefault();\n\n      this._sliderMouseDown(e, function () {});\n    }\n  };\n\n  AbstractScrollbar.prototype._sliderMouseDown = function (e, onDragFinished) {\n    var _this = this;\n\n    var initialMousePosition = this._sliderMousePosition(e);\n\n    var initialMouseOrthogonalPosition = this._sliderOrthogonalMousePosition(e);\n\n    var initialScrollbarState = this._scrollbarState.clone();\n\n    this.slider.toggleClassName('active', true);\n\n    this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, function (mouseMoveData) {\n      var mouseOrthogonalPosition = _this._sliderOrthogonalMousePosition(mouseMoveData);\n\n      var mouseOrthogonalDelta = Math.abs(mouseOrthogonalPosition - initialMouseOrthogonalPosition);\n\n      if (platform.isWindows && mouseOrthogonalDelta > MOUSE_DRAG_RESET_DISTANCE) {\n        // The mouse has wondered away from the scrollbar => reset dragging\n        _this._setDesiredScrollPositionNow(initialScrollbarState.getScrollPosition());\n\n        return;\n      }\n\n      var mousePosition = _this._sliderMousePosition(mouseMoveData);\n\n      var mouseDelta = mousePosition - initialMousePosition;\n\n      _this._setDesiredScrollPositionNow(initialScrollbarState.getDesiredScrollPositionFromDelta(mouseDelta));\n    }, function () {\n      _this.slider.toggleClassName('active', false);\n\n      _this._host.onDragEnd();\n\n      onDragFinished();\n    });\n\n    this._host.onDragStart();\n  };\n\n  AbstractScrollbar.prototype._setDesiredScrollPositionNow = function (_desiredScrollPosition) {\n    var desiredScrollPosition = {};\n    this.writeScrollPosition(desiredScrollPosition, _desiredScrollPosition);\n\n    this._scrollable.setScrollPositionNow(desiredScrollPosition);\n  };\n\n  return AbstractScrollbar;\n}(Widget);\n\nexport { AbstractScrollbar };","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/ui/scrollbar/abstractScrollbar.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","dom","createFastDomNode","GlobalMouseMoveMonitor","standardMouseMoveMerger","ScrollbarArrow","ScrollbarVisibilityController","Widget","platform","MOUSE_DRAG_RESET_DISTANCE","AbstractScrollbar","_super","opts","_this","call","_lazyRender","lazyRender","_host","host","_scrollable","scrollable","_scrollbarState","scrollbarState","_visibilityController","_register","visibility","extraScrollbarClassName","setIsNeeded","isNeeded","_mouseMoveMonitor","_shouldRender","domNode","document","createElement","setAttribute","setDomNode","setPosition","onmousedown","e","_domNodeMouseDown","_createArrow","arrow","appendChild","bgDomNode","_createSlider","top","left","width","height","slider","setClassName","setTop","setLeft","setWidth","setHeight","setLayerHinting","setContain","leftButton","preventDefault","_sliderMouseDown","onclick","stopPropagation","_onElementSize","visibleSize","setVisibleSize","render","_onElementScrollSize","elementScrollSize","setScrollSize","_onElementScrollPosition","elementScrollPosition","setScrollPosition","beginReveal","setShouldBeVisible","beginHide","_renderDomNode","getRectangleLargeSize","getRectangleSmallSize","_updateSlider","getSliderSize","getArrowSize","getSliderPosition","target","_onMouseDown","delegateMouseDown","domTop","getClientRects","sliderStart","sliderStop","mousePos","_sliderMousePosition","offsetX","offsetY","browserEvent","domNodePosition","getDomNodePagePosition","posx","posy","_setDesiredScrollPositionNow","getDesiredScrollPositionFromOffset","_mouseDownRelativePosition","onDragFinished","initialMousePosition","initialMouseOrthogonalPosition","_sliderOrthogonalMousePosition","initialScrollbarState","clone","toggleClassName","startMonitoring","buttons","mouseMoveData","mouseOrthogonalPosition","mouseOrthogonalDelta","Math","abs","isWindows","getScrollPosition","mousePosition","mouseDelta","getDesiredScrollPositionFromDelta","onDragEnd","onDragStart","_desiredScrollPosition","desiredScrollPosition","writeScrollPosition","setScrollPositionNow"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport * as dom from '../../dom.js';\r\nimport { createFastDomNode } from '../../fastDomNode.js';\r\nimport { GlobalMouseMoveMonitor, standardMouseMoveMerger } from '../../globalMouseMoveMonitor.js';\r\nimport { ScrollbarArrow } from './scrollbarArrow.js';\r\nimport { ScrollbarVisibilityController } from './scrollbarVisibilityController.js';\r\nimport { Widget } from '../widget.js';\r\nimport * as platform from '../../../common/platform.js';\r\n/**\r\n * The orthogonal distance to the slider at which dragging \"resets\". This implements \"snapping\"\r\n */\r\nvar MOUSE_DRAG_RESET_DISTANCE = 140;\r\nvar AbstractScrollbar = /** @class */ (function (_super) {\r\n    __extends(AbstractScrollbar, _super);\r\n    function AbstractScrollbar(opts) {\r\n        var _this = _super.call(this) || this;\r\n        _this._lazyRender = opts.lazyRender;\r\n        _this._host = opts.host;\r\n        _this._scrollable = opts.scrollable;\r\n        _this._scrollbarState = opts.scrollbarState;\r\n        _this._visibilityController = _this._register(new ScrollbarVisibilityController(opts.visibility, 'visible scrollbar ' + opts.extraScrollbarClassName, 'invisible scrollbar ' + opts.extraScrollbarClassName));\r\n        _this._visibilityController.setIsNeeded(_this._scrollbarState.isNeeded());\r\n        _this._mouseMoveMonitor = _this._register(new GlobalMouseMoveMonitor());\r\n        _this._shouldRender = true;\r\n        _this.domNode = createFastDomNode(document.createElement('div'));\r\n        _this.domNode.setAttribute('role', 'presentation');\r\n        _this.domNode.setAttribute('aria-hidden', 'true');\r\n        _this._visibilityController.setDomNode(_this.domNode);\r\n        _this.domNode.setPosition('absolute');\r\n        _this.onmousedown(_this.domNode.domNode, function (e) { return _this._domNodeMouseDown(e); });\r\n        return _this;\r\n    }\r\n    // ----------------- creation\r\n    /**\r\n     * Creates the dom node for an arrow & adds it to the container\r\n     */\r\n    AbstractScrollbar.prototype._createArrow = function (opts) {\r\n        var arrow = this._register(new ScrollbarArrow(opts));\r\n        this.domNode.domNode.appendChild(arrow.bgDomNode);\r\n        this.domNode.domNode.appendChild(arrow.domNode);\r\n    };\r\n    /**\r\n     * Creates the slider dom node, adds it to the container & hooks up the events\r\n     */\r\n    AbstractScrollbar.prototype._createSlider = function (top, left, width, height) {\r\n        var _this = this;\r\n        this.slider = createFastDomNode(document.createElement('div'));\r\n        this.slider.setClassName('slider');\r\n        this.slider.setPosition('absolute');\r\n        this.slider.setTop(top);\r\n        this.slider.setLeft(left);\r\n        if (typeof width === 'number') {\r\n            this.slider.setWidth(width);\r\n        }\r\n        if (typeof height === 'number') {\r\n            this.slider.setHeight(height);\r\n        }\r\n        this.slider.setLayerHinting(true);\r\n        this.slider.setContain('strict');\r\n        this.domNode.domNode.appendChild(this.slider.domNode);\r\n        this.onmousedown(this.slider.domNode, function (e) {\r\n            if (e.leftButton) {\r\n                e.preventDefault();\r\n                _this._sliderMouseDown(e, function () { });\r\n            }\r\n        });\r\n        this.onclick(this.slider.domNode, function (e) {\r\n            if (e.leftButton) {\r\n                e.stopPropagation();\r\n            }\r\n        });\r\n    };\r\n    // ----------------- Update state\r\n    AbstractScrollbar.prototype._onElementSize = function (visibleSize) {\r\n        if (this._scrollbarState.setVisibleSize(visibleSize)) {\r\n            this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded());\r\n            this._shouldRender = true;\r\n            if (!this._lazyRender) {\r\n                this.render();\r\n            }\r\n        }\r\n        return this._shouldRender;\r\n    };\r\n    AbstractScrollbar.prototype._onElementScrollSize = function (elementScrollSize) {\r\n        if (this._scrollbarState.setScrollSize(elementScrollSize)) {\r\n            this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded());\r\n            this._shouldRender = true;\r\n            if (!this._lazyRender) {\r\n                this.render();\r\n            }\r\n        }\r\n        return this._shouldRender;\r\n    };\r\n    AbstractScrollbar.prototype._onElementScrollPosition = function (elementScrollPosition) {\r\n        if (this._scrollbarState.setScrollPosition(elementScrollPosition)) {\r\n            this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded());\r\n            this._shouldRender = true;\r\n            if (!this._lazyRender) {\r\n                this.render();\r\n            }\r\n        }\r\n        return this._shouldRender;\r\n    };\r\n    // ----------------- rendering\r\n    AbstractScrollbar.prototype.beginReveal = function () {\r\n        this._visibilityController.setShouldBeVisible(true);\r\n    };\r\n    AbstractScrollbar.prototype.beginHide = function () {\r\n        this._visibilityController.setShouldBeVisible(false);\r\n    };\r\n    AbstractScrollbar.prototype.render = function () {\r\n        if (!this._shouldRender) {\r\n            return;\r\n        }\r\n        this._shouldRender = false;\r\n        this._renderDomNode(this._scrollbarState.getRectangleLargeSize(), this._scrollbarState.getRectangleSmallSize());\r\n        this._updateSlider(this._scrollbarState.getSliderSize(), this._scrollbarState.getArrowSize() + this._scrollbarState.getSliderPosition());\r\n    };\r\n    // ----------------- DOM events\r\n    AbstractScrollbar.prototype._domNodeMouseDown = function (e) {\r\n        if (e.target !== this.domNode.domNode) {\r\n            return;\r\n        }\r\n        this._onMouseDown(e);\r\n    };\r\n    AbstractScrollbar.prototype.delegateMouseDown = function (e) {\r\n        var domTop = this.domNode.domNode.getClientRects()[0].top;\r\n        var sliderStart = domTop + this._scrollbarState.getSliderPosition();\r\n        var sliderStop = domTop + this._scrollbarState.getSliderPosition() + this._scrollbarState.getSliderSize();\r\n        var mousePos = this._sliderMousePosition(e);\r\n        if (sliderStart <= mousePos && mousePos <= sliderStop) {\r\n            // Act as if it was a mouse down on the slider\r\n            if (e.leftButton) {\r\n                e.preventDefault();\r\n                this._sliderMouseDown(e, function () { });\r\n            }\r\n        }\r\n        else {\r\n            // Act as if it was a mouse down on the scrollbar\r\n            this._onMouseDown(e);\r\n        }\r\n    };\r\n    AbstractScrollbar.prototype._onMouseDown = function (e) {\r\n        var offsetX;\r\n        var offsetY;\r\n        if (e.target === this.domNode.domNode && typeof e.browserEvent.offsetX === 'number' && typeof e.browserEvent.offsetY === 'number') {\r\n            offsetX = e.browserEvent.offsetX;\r\n            offsetY = e.browserEvent.offsetY;\r\n        }\r\n        else {\r\n            var domNodePosition = dom.getDomNodePagePosition(this.domNode.domNode);\r\n            offsetX = e.posx - domNodePosition.left;\r\n            offsetY = e.posy - domNodePosition.top;\r\n        }\r\n        this._setDesiredScrollPositionNow(this._scrollbarState.getDesiredScrollPositionFromOffset(this._mouseDownRelativePosition(offsetX, offsetY)));\r\n        if (e.leftButton) {\r\n            e.preventDefault();\r\n            this._sliderMouseDown(e, function () { });\r\n        }\r\n    };\r\n    AbstractScrollbar.prototype._sliderMouseDown = function (e, onDragFinished) {\r\n        var _this = this;\r\n        var initialMousePosition = this._sliderMousePosition(e);\r\n        var initialMouseOrthogonalPosition = this._sliderOrthogonalMousePosition(e);\r\n        var initialScrollbarState = this._scrollbarState.clone();\r\n        this.slider.toggleClassName('active', true);\r\n        this._mouseMoveMonitor.startMonitoring(e.target, e.buttons, standardMouseMoveMerger, function (mouseMoveData) {\r\n            var mouseOrthogonalPosition = _this._sliderOrthogonalMousePosition(mouseMoveData);\r\n            var mouseOrthogonalDelta = Math.abs(mouseOrthogonalPosition - initialMouseOrthogonalPosition);\r\n            if (platform.isWindows && mouseOrthogonalDelta > MOUSE_DRAG_RESET_DISTANCE) {\r\n                // The mouse has wondered away from the scrollbar => reset dragging\r\n                _this._setDesiredScrollPositionNow(initialScrollbarState.getScrollPosition());\r\n                return;\r\n            }\r\n            var mousePosition = _this._sliderMousePosition(mouseMoveData);\r\n            var mouseDelta = mousePosition - initialMousePosition;\r\n            _this._setDesiredScrollPositionNow(initialScrollbarState.getDesiredScrollPositionFromDelta(mouseDelta));\r\n        }, function () {\r\n            _this.slider.toggleClassName('active', false);\r\n            _this._host.onDragEnd();\r\n            onDragFinished();\r\n        });\r\n        this._host.onDragStart();\r\n    };\r\n    AbstractScrollbar.prototype._setDesiredScrollPositionNow = function (_desiredScrollPosition) {\r\n        var desiredScrollPosition = {};\r\n        this.writeScrollPosition(desiredScrollPosition, _desiredScrollPosition);\r\n        this._scrollable.setScrollPositionNow(desiredScrollPosition);\r\n    };\r\n    return AbstractScrollbar;\r\n}(Widget));\r\nexport { AbstractScrollbar };\r\n"]},"metadata":{},"sourceType":"module"}