{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport './menu.css';\nimport * as nls from '../../../../nls.js';\nimport * as strings from '../../../common/strings.js';\nimport { Action } from '../../../common/actions.js';\nimport { ActionBar, Separator, ActionViewItem, BaseActionViewItem } from '../actionbar/actionbar.js';\nimport { addClass, EventType, EventHelper, removeTabIndexAndUpdateFocus, isAncestor, hasClass, addDisposableListener, removeClass, append, $, addClasses, removeClasses } from '../../dom.js';\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\nimport { RunOnceScheduler } from '../../../common/async.js';\nimport { DisposableStore } from '../../../common/lifecycle.js';\nimport { DomScrollableElement } from '../scrollbar/scrollableElement.js';\nimport { isLinux, isMacintosh } from '../../../common/platform.js';\nexport var MENU_MNEMONIC_REGEX = /\\(&([^\\s&])\\)|(^|[^&])&([^\\s&])/;\nexport var MENU_ESCAPED_MNEMONIC_REGEX = /(&amp;)?(&amp;)([^\\s&])/g;\nexport var Direction;\n\n(function (Direction) {\n  Direction[Direction[\"Right\"] = 0] = \"Right\";\n  Direction[Direction[\"Left\"] = 1] = \"Left\";\n})(Direction || (Direction = {}));\n\nvar SubmenuAction =\n/** @class */\nfunction (_super) {\n  __extends(SubmenuAction, _super);\n\n  function SubmenuAction(label, entries, cssClass) {\n    var _this = _super.call(this, !!cssClass ? cssClass : 'submenu', label, '', true) || this;\n\n    _this.entries = entries;\n    return _this;\n  }\n\n  return SubmenuAction;\n}(Action);\n\nexport { SubmenuAction };\n\nvar Menu =\n/** @class */\nfunction (_super) {\n  __extends(Menu, _super);\n\n  function Menu(container, actions, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _this = this;\n\n    addClass(container, 'monaco-menu-container');\n    container.setAttribute('role', 'presentation');\n    var menuElement = document.createElement('div');\n    addClass(menuElement, 'monaco-menu');\n    menuElement.setAttribute('role', 'presentation');\n    _this = _super.call(this, menuElement, {\n      orientation: 2\n      /* VERTICAL */\n      ,\n      actionViewItemProvider: function (action) {\n        return _this.doGetActionViewItem(action, options, parentData);\n      },\n      context: options.context,\n      actionRunner: options.actionRunner,\n      ariaLabel: options.ariaLabel,\n      triggerKeys: {\n        keys: __spreadArrays([3\n        /* Enter */\n        ], isMacintosh ? [10\n        /* Space */\n        ] : []),\n        keyDown: true\n      }\n    }) || this;\n    _this.menuElement = menuElement;\n\n    _this.actionsList.setAttribute('role', 'menu');\n\n    _this.actionsList.tabIndex = 0;\n    _this.menuDisposables = _this._register(new DisposableStore());\n    addDisposableListener(menuElement, EventType.KEY_DOWN, function (e) {\n      var event = new StandardKeyboardEvent(e); // Stop tab navigation of menus\n\n      if (event.equals(2\n      /* Tab */\n      )) {\n        e.preventDefault();\n      }\n    });\n\n    if (options.enableMnemonics) {\n      _this.menuDisposables.add(addDisposableListener(menuElement, EventType.KEY_DOWN, function (e) {\n        var key = e.key.toLocaleLowerCase();\n\n        if (_this.mnemonics.has(key)) {\n          EventHelper.stop(e, true);\n\n          var actions_1 = _this.mnemonics.get(key);\n\n          if (actions_1.length === 1) {\n            if (actions_1[0] instanceof SubmenuMenuActionViewItem && actions_1[0].container) {\n              _this.focusItemByElement(actions_1[0].container);\n            }\n\n            actions_1[0].onClick(e);\n          }\n\n          if (actions_1.length > 1) {\n            var action = actions_1.shift();\n\n            if (action && action.container) {\n              _this.focusItemByElement(action.container);\n\n              actions_1.push(action);\n            }\n\n            _this.mnemonics.set(key, actions_1);\n          }\n        }\n      }));\n    }\n\n    if (isLinux) {\n      _this._register(addDisposableListener(menuElement, EventType.KEY_DOWN, function (e) {\n        var event = new StandardKeyboardEvent(e);\n\n        if (event.equals(14\n        /* Home */\n        ) || event.equals(11\n        /* PageUp */\n        )) {\n          _this.focusedItem = _this.viewItems.length - 1;\n\n          _this.focusNext();\n\n          EventHelper.stop(e, true);\n        } else if (event.equals(13\n        /* End */\n        ) || event.equals(12\n        /* PageDown */\n        )) {\n          _this.focusedItem = 0;\n\n          _this.focusPrevious();\n\n          EventHelper.stop(e, true);\n        }\n      }));\n    }\n\n    _this._register(addDisposableListener(_this.domNode, EventType.MOUSE_OUT, function (e) {\n      var relatedTarget = e.relatedTarget;\n\n      if (!isAncestor(relatedTarget, _this.domNode)) {\n        _this.focusedItem = undefined;\n\n        _this.updateFocus();\n\n        e.stopPropagation();\n      }\n    }));\n\n    _this._register(addDisposableListener(_this.actionsList, EventType.MOUSE_OVER, function (e) {\n      var target = e.target;\n\n      if (!target || !isAncestor(target, _this.actionsList) || target === _this.actionsList) {\n        return;\n      }\n\n      while (target.parentElement !== _this.actionsList && target.parentElement !== null) {\n        target = target.parentElement;\n      }\n\n      if (hasClass(target, 'action-item')) {\n        var lastFocusedItem = _this.focusedItem;\n\n        _this.setFocusedItem(target);\n\n        if (lastFocusedItem !== _this.focusedItem) {\n          _this.updateFocus();\n        }\n      }\n    }));\n\n    var parentData = {\n      parent: _this\n    };\n    _this.mnemonics = new Map(); // Scroll Logic\n\n    _this.scrollableElement = _this._register(new DomScrollableElement(menuElement, {\n      alwaysConsumeMouseWheel: true,\n      horizontal: 2\n      /* Hidden */\n      ,\n      vertical: 3\n      /* Visible */\n      ,\n      verticalScrollbarSize: 7,\n      handleMouseWheel: true,\n      useShadows: true\n    }));\n\n    var scrollElement = _this.scrollableElement.getDomNode();\n\n    scrollElement.style.position = '';\n\n    _this._register(addDisposableListener(scrollElement, EventType.MOUSE_UP, function (e) {\n      // Absorb clicks in menu dead space https://github.com/Microsoft/vscode/issues/63575\n      // We do this on the scroll element so the scroll bar doesn't dismiss the menu either\n      e.preventDefault();\n    }));\n\n    menuElement.style.maxHeight = Math.max(10, window.innerHeight - container.getBoundingClientRect().top - 30) + \"px\";\n\n    _this.push(actions, {\n      icon: true,\n      label: true,\n      isMenu: true\n    });\n\n    container.appendChild(_this.scrollableElement.getDomNode());\n\n    _this.scrollableElement.scanDomNode();\n\n    _this.viewItems.filter(function (item) {\n      return !(item instanceof MenuSeparatorActionViewItem);\n    }).forEach(function (item, index, array) {\n      item.updatePositionInSet(index + 1, array.length);\n    });\n\n    return _this;\n  }\n\n  Menu.prototype.style = function (style) {\n    var container = this.getContainer();\n    var fgColor = style.foregroundColor ? \"\" + style.foregroundColor : '';\n    var bgColor = style.backgroundColor ? \"\" + style.backgroundColor : '';\n    var border = style.borderColor ? \"1px solid \" + style.borderColor : '';\n    var shadow = style.shadowColor ? \"0 2px 4px \" + style.shadowColor : '';\n    container.style.border = border;\n    this.domNode.style.color = fgColor;\n    this.domNode.style.backgroundColor = bgColor;\n    container.style.boxShadow = shadow;\n\n    if (this.viewItems) {\n      this.viewItems.forEach(function (item) {\n        if (item instanceof BaseMenuActionViewItem || item instanceof MenuSeparatorActionViewItem) {\n          item.style(style);\n        }\n      });\n    }\n  };\n\n  Menu.prototype.getContainer = function () {\n    return this.scrollableElement.getDomNode();\n  };\n\n  Object.defineProperty(Menu.prototype, \"onScroll\", {\n    get: function () {\n      return this.scrollableElement.onScroll;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Menu.prototype, \"scrollOffset\", {\n    get: function () {\n      return this.menuElement.scrollTop;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Menu.prototype.focusItemByElement = function (element) {\n    var lastFocusedItem = this.focusedItem;\n    this.setFocusedItem(element);\n\n    if (lastFocusedItem !== this.focusedItem) {\n      this.updateFocus();\n    }\n  };\n\n  Menu.prototype.setFocusedItem = function (element) {\n    for (var i = 0; i < this.actionsList.children.length; i++) {\n      var elem = this.actionsList.children[i];\n\n      if (element === elem) {\n        this.focusedItem = i;\n        break;\n      }\n    }\n  };\n\n  Menu.prototype.updateFocus = function (fromRight) {\n    _super.prototype.updateFocus.call(this, fromRight, true);\n\n    if (typeof this.focusedItem !== 'undefined') {\n      // Workaround for #80047 caused by an issue in chromium\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=414283\n      // When that's fixed, just call this.scrollableElement.scanDomNode()\n      this.scrollableElement.setScrollPosition({\n        scrollTop: Math.round(this.menuElement.scrollTop)\n      });\n    }\n  };\n\n  Menu.prototype.doGetActionViewItem = function (action, options, parentData) {\n    if (action instanceof Separator) {\n      return new MenuSeparatorActionViewItem(options.context, action, {\n        icon: true\n      });\n    } else if (action instanceof SubmenuAction) {\n      var menuActionViewItem = new SubmenuMenuActionViewItem(action, action.entries, parentData, options);\n\n      if (options.enableMnemonics) {\n        var mnemonic = menuActionViewItem.getMnemonic();\n\n        if (mnemonic && menuActionViewItem.isEnabled()) {\n          var actionViewItems = [];\n\n          if (this.mnemonics.has(mnemonic)) {\n            actionViewItems = this.mnemonics.get(mnemonic);\n          }\n\n          actionViewItems.push(menuActionViewItem);\n          this.mnemonics.set(mnemonic, actionViewItems);\n        }\n      }\n\n      return menuActionViewItem;\n    } else {\n      var menuItemOptions = {\n        enableMnemonics: options.enableMnemonics\n      };\n\n      if (options.getKeyBinding) {\n        var keybinding = options.getKeyBinding(action);\n\n        if (keybinding) {\n          var keybindingLabel = keybinding.getLabel();\n\n          if (keybindingLabel) {\n            menuItemOptions.keybinding = keybindingLabel;\n          }\n        }\n      }\n\n      var menuActionViewItem = new BaseMenuActionViewItem(options.context, action, menuItemOptions);\n\n      if (options.enableMnemonics) {\n        var mnemonic = menuActionViewItem.getMnemonic();\n\n        if (mnemonic && menuActionViewItem.isEnabled()) {\n          var actionViewItems = [];\n\n          if (this.mnemonics.has(mnemonic)) {\n            actionViewItems = this.mnemonics.get(mnemonic);\n          }\n\n          actionViewItems.push(menuActionViewItem);\n          this.mnemonics.set(mnemonic, actionViewItems);\n        }\n      }\n\n      return menuActionViewItem;\n    }\n  };\n\n  return Menu;\n}(ActionBar);\n\nexport { Menu };\n\nvar BaseMenuActionViewItem =\n/** @class */\nfunction (_super) {\n  __extends(BaseMenuActionViewItem, _super);\n\n  function BaseMenuActionViewItem(ctx, action, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _this = this;\n\n    options.isMenu = true;\n    _this = _super.call(this, action, action, options) || this;\n    _this.options = options;\n    _this.options.icon = options.icon !== undefined ? options.icon : false;\n    _this.options.label = options.label !== undefined ? options.label : true;\n    _this.cssClass = ''; // Set mnemonic\n\n    if (_this.options.label && options.enableMnemonics) {\n      var label = _this.getAction().label;\n\n      if (label) {\n        var matches = MENU_MNEMONIC_REGEX.exec(label);\n\n        if (matches) {\n          _this.mnemonic = (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase();\n        }\n      }\n    } // Add mouse up listener later to avoid accidental clicks\n\n\n    _this.runOnceToEnableMouseUp = new RunOnceScheduler(function () {\n      if (!_this.element) {\n        return;\n      }\n\n      _this._register(addDisposableListener(_this.element, EventType.MOUSE_UP, function (e) {\n        if (e.defaultPrevented) {\n          return;\n        }\n\n        EventHelper.stop(e, true);\n\n        _this.onClick(e);\n      }));\n    }, 100);\n\n    _this._register(_this.runOnceToEnableMouseUp);\n\n    return _this;\n  }\n\n  BaseMenuActionViewItem.prototype.render = function (container) {\n    _super.prototype.render.call(this, container);\n\n    if (!this.element) {\n      return;\n    }\n\n    this.container = container;\n    this.item = append(this.element, $('a.action-menu-item'));\n\n    if (this._action.id === Separator.ID) {\n      // A separator is a presentation item\n      this.item.setAttribute('role', 'presentation');\n    } else {\n      this.item.setAttribute('role', 'menuitem');\n\n      if (this.mnemonic) {\n        this.item.setAttribute('aria-keyshortcuts', \"\" + this.mnemonic);\n      }\n    }\n\n    this.check = append(this.item, $('span.menu-item-check.codicon.codicon-check'));\n    this.check.setAttribute('role', 'none');\n    this.label = append(this.item, $('span.action-label'));\n\n    if (this.options.label && this.options.keybinding) {\n      append(this.item, $('span.keybinding')).textContent = this.options.keybinding;\n    } // Adds mouse up listener to actually run the action\n\n\n    this.runOnceToEnableMouseUp.schedule();\n    this.updateClass();\n    this.updateLabel();\n    this.updateTooltip();\n    this.updateEnabled();\n    this.updateChecked();\n  };\n\n  BaseMenuActionViewItem.prototype.blur = function () {\n    _super.prototype.blur.call(this);\n\n    this.applyStyle();\n  };\n\n  BaseMenuActionViewItem.prototype.focus = function () {\n    _super.prototype.focus.call(this);\n\n    if (this.item) {\n      this.item.focus();\n    }\n\n    this.applyStyle();\n  };\n\n  BaseMenuActionViewItem.prototype.updatePositionInSet = function (pos, setSize) {\n    if (this.item) {\n      this.item.setAttribute('aria-posinset', \"\" + pos);\n      this.item.setAttribute('aria-setsize', \"\" + setSize);\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.updateLabel = function () {\n    if (this.options.label) {\n      var label = this.getAction().label;\n\n      if (label) {\n        var cleanLabel = cleanMnemonic(label);\n\n        if (!this.options.enableMnemonics) {\n          label = cleanLabel;\n        }\n\n        if (this.label) {\n          this.label.setAttribute('aria-label', cleanLabel.replace(/&&/g, '&'));\n        }\n\n        var matches = MENU_MNEMONIC_REGEX.exec(label);\n\n        if (matches) {\n          label = strings.escape(label); // This is global, reset it\n\n          MENU_ESCAPED_MNEMONIC_REGEX.lastIndex = 0;\n          var escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label); // We can't use negative lookbehind so if we match our negative and skip\n\n          while (escMatch && escMatch[1]) {\n            escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\n          }\n\n          if (escMatch) {\n            label = label.substr(0, escMatch.index) + \"<u aria-hidden=\\\"true\\\">\" + escMatch[3] + \"</u>\" + label.substr(escMatch.index + escMatch[0].length);\n          }\n\n          label = label.replace(/&amp;&amp;/g, '&amp;');\n\n          if (this.item) {\n            this.item.setAttribute('aria-keyshortcuts', (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase());\n          }\n        } else {\n          label = label.replace(/&&/g, '&');\n        }\n      }\n\n      if (this.label) {\n        this.label.innerHTML = label.trim();\n      }\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.updateTooltip = function () {\n    var title = null;\n\n    if (this.getAction().tooltip) {\n      title = this.getAction().tooltip;\n    } else if (!this.options.label && this.getAction().label && this.options.icon) {\n      title = this.getAction().label;\n\n      if (this.options.keybinding) {\n        title = nls.localize({\n          key: 'titleLabel',\n          comment: ['action title', 'action keybinding']\n        }, \"{0} ({1})\", title, this.options.keybinding);\n      }\n    }\n\n    if (title && this.item) {\n      this.item.title = title;\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.updateClass = function () {\n    if (this.cssClass && this.item) {\n      removeClasses(this.item, this.cssClass);\n    }\n\n    if (this.options.icon && this.label) {\n      this.cssClass = this.getAction().class || '';\n      addClass(this.label, 'icon');\n\n      if (this.cssClass) {\n        addClasses(this.label, this.cssClass);\n      }\n\n      this.updateEnabled();\n    } else if (this.label) {\n      removeClass(this.label, 'icon');\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.updateEnabled = function () {\n    if (this.getAction().enabled) {\n      if (this.element) {\n        removeClass(this.element, 'disabled');\n      }\n\n      if (this.item) {\n        removeClass(this.item, 'disabled');\n        this.item.tabIndex = 0;\n      }\n    } else {\n      if (this.element) {\n        addClass(this.element, 'disabled');\n      }\n\n      if (this.item) {\n        addClass(this.item, 'disabled');\n        removeTabIndexAndUpdateFocus(this.item);\n      }\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.updateChecked = function () {\n    if (!this.item) {\n      return;\n    }\n\n    if (this.getAction().checked) {\n      addClass(this.item, 'checked');\n      this.item.setAttribute('role', 'menuitemcheckbox');\n      this.item.setAttribute('aria-checked', 'true');\n    } else {\n      removeClass(this.item, 'checked');\n      this.item.setAttribute('role', 'menuitem');\n      this.item.setAttribute('aria-checked', 'false');\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.getMnemonic = function () {\n    return this.mnemonic;\n  };\n\n  BaseMenuActionViewItem.prototype.applyStyle = function () {\n    if (!this.menuStyle) {\n      return;\n    }\n\n    var isSelected = this.element && hasClass(this.element, 'focused');\n    var fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\n    var bgColor = isSelected && this.menuStyle.selectionBackgroundColor ? this.menuStyle.selectionBackgroundColor : undefined;\n    var border = isSelected && this.menuStyle.selectionBorderColor ? \"thin solid \" + this.menuStyle.selectionBorderColor : '';\n\n    if (this.item) {\n      this.item.style.color = fgColor ? fgColor.toString() : '';\n      this.item.style.backgroundColor = bgColor ? bgColor.toString() : '';\n    }\n\n    if (this.check) {\n      this.check.style.color = fgColor ? fgColor.toString() : '';\n    }\n\n    if (this.container) {\n      this.container.style.border = border;\n    }\n  };\n\n  BaseMenuActionViewItem.prototype.style = function (style) {\n    this.menuStyle = style;\n    this.applyStyle();\n  };\n\n  return BaseMenuActionViewItem;\n}(BaseActionViewItem);\n\nvar SubmenuMenuActionViewItem =\n/** @class */\nfunction (_super) {\n  __extends(SubmenuMenuActionViewItem, _super);\n\n  function SubmenuMenuActionViewItem(action, submenuActions, parentData, submenuOptions) {\n    var _this = _super.call(this, action, action, submenuOptions) || this;\n\n    _this.submenuActions = submenuActions;\n    _this.parentData = parentData;\n    _this.submenuOptions = submenuOptions;\n    _this.mysubmenu = null;\n    _this.submenuDisposables = _this._register(new DisposableStore());\n    _this.mouseOver = false;\n    _this.expandDirection = submenuOptions && submenuOptions.expandDirection !== undefined ? submenuOptions.expandDirection : Direction.Right;\n    _this.showScheduler = new RunOnceScheduler(function () {\n      if (_this.mouseOver) {\n        _this.cleanupExistingSubmenu(false);\n\n        _this.createSubmenu(false);\n      }\n    }, 250);\n    _this.hideScheduler = new RunOnceScheduler(function () {\n      if (_this.element && !isAncestor(document.activeElement, _this.element) && _this.parentData.submenu === _this.mysubmenu) {\n        _this.parentData.parent.focus(false);\n\n        _this.cleanupExistingSubmenu(true);\n      }\n    }, 750);\n    return _this;\n  }\n\n  SubmenuMenuActionViewItem.prototype.render = function (container) {\n    var _this = this;\n\n    _super.prototype.render.call(this, container);\n\n    if (!this.element) {\n      return;\n    }\n\n    if (this.item) {\n      addClass(this.item, 'monaco-submenu-item');\n      this.item.setAttribute('aria-haspopup', 'true');\n      this.updateAriaExpanded('false');\n      this.submenuIndicator = append(this.item, $('span.submenu-indicator.codicon.codicon-chevron-right'));\n      this.submenuIndicator.setAttribute('aria-hidden', 'true');\n    }\n\n    this._register(addDisposableListener(this.element, EventType.KEY_UP, function (e) {\n      var event = new StandardKeyboardEvent(e);\n\n      if (event.equals(17\n      /* RightArrow */\n      ) || event.equals(3\n      /* Enter */\n      )) {\n        EventHelper.stop(e, true);\n\n        _this.createSubmenu(true);\n      }\n    }));\n\n    this._register(addDisposableListener(this.element, EventType.KEY_DOWN, function (e) {\n      var event = new StandardKeyboardEvent(e);\n\n      if (document.activeElement === _this.item) {\n        if (event.equals(17\n        /* RightArrow */\n        ) || event.equals(3\n        /* Enter */\n        )) {\n          EventHelper.stop(e, true);\n        }\n      }\n    }));\n\n    this._register(addDisposableListener(this.element, EventType.MOUSE_OVER, function (e) {\n      if (!_this.mouseOver) {\n        _this.mouseOver = true;\n\n        _this.showScheduler.schedule();\n      }\n    }));\n\n    this._register(addDisposableListener(this.element, EventType.MOUSE_LEAVE, function (e) {\n      _this.mouseOver = false;\n    }));\n\n    this._register(addDisposableListener(this.element, EventType.FOCUS_OUT, function (e) {\n      if (_this.element && !isAncestor(document.activeElement, _this.element)) {\n        _this.hideScheduler.schedule();\n      }\n    }));\n\n    this._register(this.parentData.parent.onScroll(function () {\n      _this.parentData.parent.focus(false);\n\n      _this.cleanupExistingSubmenu(false);\n    }));\n  };\n\n  SubmenuMenuActionViewItem.prototype.onClick = function (e) {\n    // stop clicking from trying to run an action\n    EventHelper.stop(e, true);\n    this.cleanupExistingSubmenu(false);\n    this.createSubmenu(true);\n  };\n\n  SubmenuMenuActionViewItem.prototype.cleanupExistingSubmenu = function (force) {\n    if (this.parentData.submenu && (force || this.parentData.submenu !== this.mysubmenu)) {\n      this.parentData.submenu.dispose();\n      this.parentData.submenu = undefined;\n      this.updateAriaExpanded('false');\n\n      if (this.submenuContainer) {\n        this.submenuDisposables.clear();\n        this.submenuContainer = undefined;\n      }\n    }\n  };\n\n  SubmenuMenuActionViewItem.prototype.createSubmenu = function (selectFirstItem) {\n    var _this = this;\n\n    if (selectFirstItem === void 0) {\n      selectFirstItem = true;\n    }\n\n    if (!this.element) {\n      return;\n    }\n\n    if (!this.parentData.submenu) {\n      this.updateAriaExpanded('true');\n      this.submenuContainer = append(this.element, $('div.monaco-submenu'));\n      addClasses(this.submenuContainer, 'menubar-menu-items-holder', 'context-view'); // Set the top value of the menu container before construction\n      // This allows the menu constructor to calculate the proper max height\n\n      var computedStyles = getComputedStyle(this.parentData.parent.domNode);\n      var paddingTop = parseFloat(computedStyles.paddingTop || '0') || 0;\n      this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop + \"px\";\n      this.parentData.submenu = new Menu(this.submenuContainer, this.submenuActions, this.submenuOptions);\n\n      if (this.menuStyle) {\n        this.parentData.submenu.style(this.menuStyle);\n      }\n\n      var boundingRect = this.element.getBoundingClientRect();\n      var childBoundingRect = this.submenuContainer.getBoundingClientRect();\n\n      if (this.expandDirection === Direction.Right) {\n        if (window.innerWidth <= boundingRect.right + childBoundingRect.width) {\n          this.submenuContainer.style.left = '10px';\n          this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset + boundingRect.height + \"px\";\n        } else {\n          this.submenuContainer.style.left = this.element.offsetWidth + \"px\";\n          this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop + \"px\";\n        }\n      } else if (this.expandDirection === Direction.Left) {\n        this.submenuContainer.style.right = this.element.offsetWidth + \"px\";\n        this.submenuContainer.style.left = 'auto';\n        this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop + \"px\";\n      }\n\n      this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_UP, function (e) {\n        var event = new StandardKeyboardEvent(e);\n\n        if (event.equals(15\n        /* LeftArrow */\n        )) {\n          EventHelper.stop(e, true);\n\n          _this.parentData.parent.focus();\n\n          _this.cleanupExistingSubmenu(true);\n        }\n      }));\n      this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_DOWN, function (e) {\n        var event = new StandardKeyboardEvent(e);\n\n        if (event.equals(15\n        /* LeftArrow */\n        )) {\n          EventHelper.stop(e, true);\n        }\n      }));\n      this.submenuDisposables.add(this.parentData.submenu.onDidCancel(function () {\n        _this.parentData.parent.focus();\n\n        _this.cleanupExistingSubmenu(true);\n      }));\n      this.parentData.submenu.focus(selectFirstItem);\n      this.mysubmenu = this.parentData.submenu;\n    } else {\n      this.parentData.submenu.focus(false);\n    }\n  };\n\n  SubmenuMenuActionViewItem.prototype.updateAriaExpanded = function (value) {\n    var _a;\n\n    if (this.item) {\n      (_a = this.item) === null || _a === void 0 ? void 0 : _a.setAttribute('aria-expanded', value);\n    }\n  };\n\n  SubmenuMenuActionViewItem.prototype.applyStyle = function () {\n    _super.prototype.applyStyle.call(this);\n\n    if (!this.menuStyle) {\n      return;\n    }\n\n    var isSelected = this.element && hasClass(this.element, 'focused');\n    var fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\n\n    if (this.submenuIndicator) {\n      this.submenuIndicator.style.color = fgColor ? \"\" + fgColor : '';\n    }\n\n    if (this.parentData.submenu) {\n      this.parentData.submenu.style(this.menuStyle);\n    }\n  };\n\n  SubmenuMenuActionViewItem.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this.hideScheduler.dispose();\n\n    if (this.mysubmenu) {\n      this.mysubmenu.dispose();\n      this.mysubmenu = null;\n    }\n\n    if (this.submenuContainer) {\n      this.submenuContainer = undefined;\n    }\n  };\n\n  return SubmenuMenuActionViewItem;\n}(BaseMenuActionViewItem);\n\nvar MenuSeparatorActionViewItem =\n/** @class */\nfunction (_super) {\n  __extends(MenuSeparatorActionViewItem, _super);\n\n  function MenuSeparatorActionViewItem() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  MenuSeparatorActionViewItem.prototype.style = function (style) {\n    if (this.label) {\n      this.label.style.borderBottomColor = style.separatorColor ? \"\" + style.separatorColor : '';\n    }\n  };\n\n  return MenuSeparatorActionViewItem;\n}(ActionViewItem);\n\nexport function cleanMnemonic(label) {\n  var regex = MENU_MNEMONIC_REGEX;\n  var matches = regex.exec(label);\n\n  if (!matches) {\n    return label;\n  }\n\n  var mnemonicInText = !matches[1];\n  return label.replace(regex, mnemonicInText ? '$2$3' : '').trim();\n}","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/base/browser/ui/menu/menu.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","nls","strings","Action","ActionBar","Separator","ActionViewItem","BaseActionViewItem","addClass","EventType","EventHelper","removeTabIndexAndUpdateFocus","isAncestor","hasClass","addDisposableListener","removeClass","append","$","addClasses","removeClasses","StandardKeyboardEvent","RunOnceScheduler","DisposableStore","DomScrollableElement","isLinux","isMacintosh","MENU_MNEMONIC_REGEX","MENU_ESCAPED_MNEMONIC_REGEX","Direction","SubmenuAction","_super","label","entries","cssClass","_this","call","Menu","container","actions","options","setAttribute","menuElement","document","createElement","orientation","actionViewItemProvider","action","doGetActionViewItem","parentData","context","actionRunner","ariaLabel","triggerKeys","keys","keyDown","actionsList","tabIndex","menuDisposables","_register","KEY_DOWN","e","event","equals","preventDefault","enableMnemonics","add","key","toLocaleLowerCase","mnemonics","has","stop","actions_1","get","SubmenuMenuActionViewItem","focusItemByElement","onClick","shift","push","set","focusedItem","viewItems","focusNext","focusPrevious","domNode","MOUSE_OUT","relatedTarget","undefined","updateFocus","stopPropagation","MOUSE_OVER","target","parentElement","lastFocusedItem","setFocusedItem","parent","Map","scrollableElement","alwaysConsumeMouseWheel","horizontal","vertical","verticalScrollbarSize","handleMouseWheel","useShadows","scrollElement","getDomNode","style","position","MOUSE_UP","maxHeight","Math","max","window","innerHeight","getBoundingClientRect","top","icon","isMenu","appendChild","scanDomNode","filter","item","MenuSeparatorActionViewItem","forEach","index","array","updatePositionInSet","getContainer","fgColor","foregroundColor","bgColor","backgroundColor","border","borderColor","shadow","shadowColor","color","boxShadow","BaseMenuActionViewItem","defineProperty","onScroll","enumerable","configurable","scrollTop","element","children","elem","fromRight","setScrollPosition","round","menuActionViewItem","mnemonic","getMnemonic","isEnabled","actionViewItems","menuItemOptions","getKeyBinding","keybinding","keybindingLabel","getLabel","ctx","getAction","matches","exec","runOnceToEnableMouseUp","defaultPrevented","render","_action","id","ID","check","textContent","schedule","updateClass","updateLabel","updateTooltip","updateEnabled","updateChecked","blur","applyStyle","focus","pos","setSize","cleanLabel","cleanMnemonic","replace","escape","lastIndex","escMatch","substr","innerHTML","trim","title","tooltip","localize","comment","class","enabled","checked","menuStyle","isSelected","selectionForegroundColor","selectionBackgroundColor","selectionBorderColor","toString","submenuActions","submenuOptions","mysubmenu","submenuDisposables","mouseOver","expandDirection","Right","showScheduler","cleanupExistingSubmenu","createSubmenu","hideScheduler","activeElement","submenu","updateAriaExpanded","submenuIndicator","KEY_UP","MOUSE_LEAVE","FOCUS_OUT","force","dispose","submenuContainer","clear","selectFirstItem","computedStyles","getComputedStyle","paddingTop","parseFloat","offsetTop","scrollOffset","boundingRect","childBoundingRect","innerWidth","right","width","left","height","offsetWidth","Left","onDidCancel","value","_a","apply","borderBottomColor","separatorColor","regex","mnemonicInText"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport './menu.css';\r\nimport * as nls from '../../../../nls.js';\r\nimport * as strings from '../../../common/strings.js';\r\nimport { Action } from '../../../common/actions.js';\r\nimport { ActionBar, Separator, ActionViewItem, BaseActionViewItem } from '../actionbar/actionbar.js';\r\nimport { addClass, EventType, EventHelper, removeTabIndexAndUpdateFocus, isAncestor, hasClass, addDisposableListener, removeClass, append, $, addClasses, removeClasses } from '../../dom.js';\r\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\r\nimport { RunOnceScheduler } from '../../../common/async.js';\r\nimport { DisposableStore } from '../../../common/lifecycle.js';\r\nimport { DomScrollableElement } from '../scrollbar/scrollableElement.js';\r\nimport { isLinux, isMacintosh } from '../../../common/platform.js';\r\nexport var MENU_MNEMONIC_REGEX = /\\(&([^\\s&])\\)|(^|[^&])&([^\\s&])/;\r\nexport var MENU_ESCAPED_MNEMONIC_REGEX = /(&amp;)?(&amp;)([^\\s&])/g;\r\nexport var Direction;\r\n(function (Direction) {\r\n    Direction[Direction[\"Right\"] = 0] = \"Right\";\r\n    Direction[Direction[\"Left\"] = 1] = \"Left\";\r\n})(Direction || (Direction = {}));\r\nvar SubmenuAction = /** @class */ (function (_super) {\r\n    __extends(SubmenuAction, _super);\r\n    function SubmenuAction(label, entries, cssClass) {\r\n        var _this = _super.call(this, !!cssClass ? cssClass : 'submenu', label, '', true) || this;\r\n        _this.entries = entries;\r\n        return _this;\r\n    }\r\n    return SubmenuAction;\r\n}(Action));\r\nexport { SubmenuAction };\r\nvar Menu = /** @class */ (function (_super) {\r\n    __extends(Menu, _super);\r\n    function Menu(container, actions, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = this;\r\n        addClass(container, 'monaco-menu-container');\r\n        container.setAttribute('role', 'presentation');\r\n        var menuElement = document.createElement('div');\r\n        addClass(menuElement, 'monaco-menu');\r\n        menuElement.setAttribute('role', 'presentation');\r\n        _this = _super.call(this, menuElement, {\r\n            orientation: 2 /* VERTICAL */,\r\n            actionViewItemProvider: function (action) { return _this.doGetActionViewItem(action, options, parentData); },\r\n            context: options.context,\r\n            actionRunner: options.actionRunner,\r\n            ariaLabel: options.ariaLabel,\r\n            triggerKeys: { keys: __spreadArrays([3 /* Enter */], (isMacintosh ? [10 /* Space */] : [])), keyDown: true }\r\n        }) || this;\r\n        _this.menuElement = menuElement;\r\n        _this.actionsList.setAttribute('role', 'menu');\r\n        _this.actionsList.tabIndex = 0;\r\n        _this.menuDisposables = _this._register(new DisposableStore());\r\n        addDisposableListener(menuElement, EventType.KEY_DOWN, function (e) {\r\n            var event = new StandardKeyboardEvent(e);\r\n            // Stop tab navigation of menus\r\n            if (event.equals(2 /* Tab */)) {\r\n                e.preventDefault();\r\n            }\r\n        });\r\n        if (options.enableMnemonics) {\r\n            _this.menuDisposables.add(addDisposableListener(menuElement, EventType.KEY_DOWN, function (e) {\r\n                var key = e.key.toLocaleLowerCase();\r\n                if (_this.mnemonics.has(key)) {\r\n                    EventHelper.stop(e, true);\r\n                    var actions_1 = _this.mnemonics.get(key);\r\n                    if (actions_1.length === 1) {\r\n                        if (actions_1[0] instanceof SubmenuMenuActionViewItem && actions_1[0].container) {\r\n                            _this.focusItemByElement(actions_1[0].container);\r\n                        }\r\n                        actions_1[0].onClick(e);\r\n                    }\r\n                    if (actions_1.length > 1) {\r\n                        var action = actions_1.shift();\r\n                        if (action && action.container) {\r\n                            _this.focusItemByElement(action.container);\r\n                            actions_1.push(action);\r\n                        }\r\n                        _this.mnemonics.set(key, actions_1);\r\n                    }\r\n                }\r\n            }));\r\n        }\r\n        if (isLinux) {\r\n            _this._register(addDisposableListener(menuElement, EventType.KEY_DOWN, function (e) {\r\n                var event = new StandardKeyboardEvent(e);\r\n                if (event.equals(14 /* Home */) || event.equals(11 /* PageUp */)) {\r\n                    _this.focusedItem = _this.viewItems.length - 1;\r\n                    _this.focusNext();\r\n                    EventHelper.stop(e, true);\r\n                }\r\n                else if (event.equals(13 /* End */) || event.equals(12 /* PageDown */)) {\r\n                    _this.focusedItem = 0;\r\n                    _this.focusPrevious();\r\n                    EventHelper.stop(e, true);\r\n                }\r\n            }));\r\n        }\r\n        _this._register(addDisposableListener(_this.domNode, EventType.MOUSE_OUT, function (e) {\r\n            var relatedTarget = e.relatedTarget;\r\n            if (!isAncestor(relatedTarget, _this.domNode)) {\r\n                _this.focusedItem = undefined;\r\n                _this.updateFocus();\r\n                e.stopPropagation();\r\n            }\r\n        }));\r\n        _this._register(addDisposableListener(_this.actionsList, EventType.MOUSE_OVER, function (e) {\r\n            var target = e.target;\r\n            if (!target || !isAncestor(target, _this.actionsList) || target === _this.actionsList) {\r\n                return;\r\n            }\r\n            while (target.parentElement !== _this.actionsList && target.parentElement !== null) {\r\n                target = target.parentElement;\r\n            }\r\n            if (hasClass(target, 'action-item')) {\r\n                var lastFocusedItem = _this.focusedItem;\r\n                _this.setFocusedItem(target);\r\n                if (lastFocusedItem !== _this.focusedItem) {\r\n                    _this.updateFocus();\r\n                }\r\n            }\r\n        }));\r\n        var parentData = {\r\n            parent: _this\r\n        };\r\n        _this.mnemonics = new Map();\r\n        // Scroll Logic\r\n        _this.scrollableElement = _this._register(new DomScrollableElement(menuElement, {\r\n            alwaysConsumeMouseWheel: true,\r\n            horizontal: 2 /* Hidden */,\r\n            vertical: 3 /* Visible */,\r\n            verticalScrollbarSize: 7,\r\n            handleMouseWheel: true,\r\n            useShadows: true\r\n        }));\r\n        var scrollElement = _this.scrollableElement.getDomNode();\r\n        scrollElement.style.position = '';\r\n        _this._register(addDisposableListener(scrollElement, EventType.MOUSE_UP, function (e) {\r\n            // Absorb clicks in menu dead space https://github.com/Microsoft/vscode/issues/63575\r\n            // We do this on the scroll element so the scroll bar doesn't dismiss the menu either\r\n            e.preventDefault();\r\n        }));\r\n        menuElement.style.maxHeight = Math.max(10, window.innerHeight - container.getBoundingClientRect().top - 30) + \"px\";\r\n        _this.push(actions, { icon: true, label: true, isMenu: true });\r\n        container.appendChild(_this.scrollableElement.getDomNode());\r\n        _this.scrollableElement.scanDomNode();\r\n        _this.viewItems.filter(function (item) { return !(item instanceof MenuSeparatorActionViewItem); }).forEach(function (item, index, array) {\r\n            item.updatePositionInSet(index + 1, array.length);\r\n        });\r\n        return _this;\r\n    }\r\n    Menu.prototype.style = function (style) {\r\n        var container = this.getContainer();\r\n        var fgColor = style.foregroundColor ? \"\" + style.foregroundColor : '';\r\n        var bgColor = style.backgroundColor ? \"\" + style.backgroundColor : '';\r\n        var border = style.borderColor ? \"1px solid \" + style.borderColor : '';\r\n        var shadow = style.shadowColor ? \"0 2px 4px \" + style.shadowColor : '';\r\n        container.style.border = border;\r\n        this.domNode.style.color = fgColor;\r\n        this.domNode.style.backgroundColor = bgColor;\r\n        container.style.boxShadow = shadow;\r\n        if (this.viewItems) {\r\n            this.viewItems.forEach(function (item) {\r\n                if (item instanceof BaseMenuActionViewItem || item instanceof MenuSeparatorActionViewItem) {\r\n                    item.style(style);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Menu.prototype.getContainer = function () {\r\n        return this.scrollableElement.getDomNode();\r\n    };\r\n    Object.defineProperty(Menu.prototype, \"onScroll\", {\r\n        get: function () {\r\n            return this.scrollableElement.onScroll;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Menu.prototype, \"scrollOffset\", {\r\n        get: function () {\r\n            return this.menuElement.scrollTop;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Menu.prototype.focusItemByElement = function (element) {\r\n        var lastFocusedItem = this.focusedItem;\r\n        this.setFocusedItem(element);\r\n        if (lastFocusedItem !== this.focusedItem) {\r\n            this.updateFocus();\r\n        }\r\n    };\r\n    Menu.prototype.setFocusedItem = function (element) {\r\n        for (var i = 0; i < this.actionsList.children.length; i++) {\r\n            var elem = this.actionsList.children[i];\r\n            if (element === elem) {\r\n                this.focusedItem = i;\r\n                break;\r\n            }\r\n        }\r\n    };\r\n    Menu.prototype.updateFocus = function (fromRight) {\r\n        _super.prototype.updateFocus.call(this, fromRight, true);\r\n        if (typeof this.focusedItem !== 'undefined') {\r\n            // Workaround for #80047 caused by an issue in chromium\r\n            // https://bugs.chromium.org/p/chromium/issues/detail?id=414283\r\n            // When that's fixed, just call this.scrollableElement.scanDomNode()\r\n            this.scrollableElement.setScrollPosition({\r\n                scrollTop: Math.round(this.menuElement.scrollTop)\r\n            });\r\n        }\r\n    };\r\n    Menu.prototype.doGetActionViewItem = function (action, options, parentData) {\r\n        if (action instanceof Separator) {\r\n            return new MenuSeparatorActionViewItem(options.context, action, { icon: true });\r\n        }\r\n        else if (action instanceof SubmenuAction) {\r\n            var menuActionViewItem = new SubmenuMenuActionViewItem(action, action.entries, parentData, options);\r\n            if (options.enableMnemonics) {\r\n                var mnemonic = menuActionViewItem.getMnemonic();\r\n                if (mnemonic && menuActionViewItem.isEnabled()) {\r\n                    var actionViewItems = [];\r\n                    if (this.mnemonics.has(mnemonic)) {\r\n                        actionViewItems = this.mnemonics.get(mnemonic);\r\n                    }\r\n                    actionViewItems.push(menuActionViewItem);\r\n                    this.mnemonics.set(mnemonic, actionViewItems);\r\n                }\r\n            }\r\n            return menuActionViewItem;\r\n        }\r\n        else {\r\n            var menuItemOptions = { enableMnemonics: options.enableMnemonics };\r\n            if (options.getKeyBinding) {\r\n                var keybinding = options.getKeyBinding(action);\r\n                if (keybinding) {\r\n                    var keybindingLabel = keybinding.getLabel();\r\n                    if (keybindingLabel) {\r\n                        menuItemOptions.keybinding = keybindingLabel;\r\n                    }\r\n                }\r\n            }\r\n            var menuActionViewItem = new BaseMenuActionViewItem(options.context, action, menuItemOptions);\r\n            if (options.enableMnemonics) {\r\n                var mnemonic = menuActionViewItem.getMnemonic();\r\n                if (mnemonic && menuActionViewItem.isEnabled()) {\r\n                    var actionViewItems = [];\r\n                    if (this.mnemonics.has(mnemonic)) {\r\n                        actionViewItems = this.mnemonics.get(mnemonic);\r\n                    }\r\n                    actionViewItems.push(menuActionViewItem);\r\n                    this.mnemonics.set(mnemonic, actionViewItems);\r\n                }\r\n            }\r\n            return menuActionViewItem;\r\n        }\r\n    };\r\n    return Menu;\r\n}(ActionBar));\r\nexport { Menu };\r\nvar BaseMenuActionViewItem = /** @class */ (function (_super) {\r\n    __extends(BaseMenuActionViewItem, _super);\r\n    function BaseMenuActionViewItem(ctx, action, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = this;\r\n        options.isMenu = true;\r\n        _this = _super.call(this, action, action, options) || this;\r\n        _this.options = options;\r\n        _this.options.icon = options.icon !== undefined ? options.icon : false;\r\n        _this.options.label = options.label !== undefined ? options.label : true;\r\n        _this.cssClass = '';\r\n        // Set mnemonic\r\n        if (_this.options.label && options.enableMnemonics) {\r\n            var label = _this.getAction().label;\r\n            if (label) {\r\n                var matches = MENU_MNEMONIC_REGEX.exec(label);\r\n                if (matches) {\r\n                    _this.mnemonic = (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase();\r\n                }\r\n            }\r\n        }\r\n        // Add mouse up listener later to avoid accidental clicks\r\n        _this.runOnceToEnableMouseUp = new RunOnceScheduler(function () {\r\n            if (!_this.element) {\r\n                return;\r\n            }\r\n            _this._register(addDisposableListener(_this.element, EventType.MOUSE_UP, function (e) {\r\n                if (e.defaultPrevented) {\r\n                    return;\r\n                }\r\n                EventHelper.stop(e, true);\r\n                _this.onClick(e);\r\n            }));\r\n        }, 100);\r\n        _this._register(_this.runOnceToEnableMouseUp);\r\n        return _this;\r\n    }\r\n    BaseMenuActionViewItem.prototype.render = function (container) {\r\n        _super.prototype.render.call(this, container);\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        this.container = container;\r\n        this.item = append(this.element, $('a.action-menu-item'));\r\n        if (this._action.id === Separator.ID) {\r\n            // A separator is a presentation item\r\n            this.item.setAttribute('role', 'presentation');\r\n        }\r\n        else {\r\n            this.item.setAttribute('role', 'menuitem');\r\n            if (this.mnemonic) {\r\n                this.item.setAttribute('aria-keyshortcuts', \"\" + this.mnemonic);\r\n            }\r\n        }\r\n        this.check = append(this.item, $('span.menu-item-check.codicon.codicon-check'));\r\n        this.check.setAttribute('role', 'none');\r\n        this.label = append(this.item, $('span.action-label'));\r\n        if (this.options.label && this.options.keybinding) {\r\n            append(this.item, $('span.keybinding')).textContent = this.options.keybinding;\r\n        }\r\n        // Adds mouse up listener to actually run the action\r\n        this.runOnceToEnableMouseUp.schedule();\r\n        this.updateClass();\r\n        this.updateLabel();\r\n        this.updateTooltip();\r\n        this.updateEnabled();\r\n        this.updateChecked();\r\n    };\r\n    BaseMenuActionViewItem.prototype.blur = function () {\r\n        _super.prototype.blur.call(this);\r\n        this.applyStyle();\r\n    };\r\n    BaseMenuActionViewItem.prototype.focus = function () {\r\n        _super.prototype.focus.call(this);\r\n        if (this.item) {\r\n            this.item.focus();\r\n        }\r\n        this.applyStyle();\r\n    };\r\n    BaseMenuActionViewItem.prototype.updatePositionInSet = function (pos, setSize) {\r\n        if (this.item) {\r\n            this.item.setAttribute('aria-posinset', \"\" + pos);\r\n            this.item.setAttribute('aria-setsize', \"\" + setSize);\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.updateLabel = function () {\r\n        if (this.options.label) {\r\n            var label = this.getAction().label;\r\n            if (label) {\r\n                var cleanLabel = cleanMnemonic(label);\r\n                if (!this.options.enableMnemonics) {\r\n                    label = cleanLabel;\r\n                }\r\n                if (this.label) {\r\n                    this.label.setAttribute('aria-label', cleanLabel.replace(/&&/g, '&'));\r\n                }\r\n                var matches = MENU_MNEMONIC_REGEX.exec(label);\r\n                if (matches) {\r\n                    label = strings.escape(label);\r\n                    // This is global, reset it\r\n                    MENU_ESCAPED_MNEMONIC_REGEX.lastIndex = 0;\r\n                    var escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\r\n                    // We can't use negative lookbehind so if we match our negative and skip\r\n                    while (escMatch && escMatch[1]) {\r\n                        escMatch = MENU_ESCAPED_MNEMONIC_REGEX.exec(label);\r\n                    }\r\n                    if (escMatch) {\r\n                        label = label.substr(0, escMatch.index) + \"<u aria-hidden=\\\"true\\\">\" + escMatch[3] + \"</u>\" + label.substr(escMatch.index + escMatch[0].length);\r\n                    }\r\n                    label = label.replace(/&amp;&amp;/g, '&amp;');\r\n                    if (this.item) {\r\n                        this.item.setAttribute('aria-keyshortcuts', (!!matches[1] ? matches[1] : matches[3]).toLocaleLowerCase());\r\n                    }\r\n                }\r\n                else {\r\n                    label = label.replace(/&&/g, '&');\r\n                }\r\n            }\r\n            if (this.label) {\r\n                this.label.innerHTML = label.trim();\r\n            }\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.updateTooltip = function () {\r\n        var title = null;\r\n        if (this.getAction().tooltip) {\r\n            title = this.getAction().tooltip;\r\n        }\r\n        else if (!this.options.label && this.getAction().label && this.options.icon) {\r\n            title = this.getAction().label;\r\n            if (this.options.keybinding) {\r\n                title = nls.localize({ key: 'titleLabel', comment: ['action title', 'action keybinding'] }, \"{0} ({1})\", title, this.options.keybinding);\r\n            }\r\n        }\r\n        if (title && this.item) {\r\n            this.item.title = title;\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.updateClass = function () {\r\n        if (this.cssClass && this.item) {\r\n            removeClasses(this.item, this.cssClass);\r\n        }\r\n        if (this.options.icon && this.label) {\r\n            this.cssClass = this.getAction().class || '';\r\n            addClass(this.label, 'icon');\r\n            if (this.cssClass) {\r\n                addClasses(this.label, this.cssClass);\r\n            }\r\n            this.updateEnabled();\r\n        }\r\n        else if (this.label) {\r\n            removeClass(this.label, 'icon');\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.updateEnabled = function () {\r\n        if (this.getAction().enabled) {\r\n            if (this.element) {\r\n                removeClass(this.element, 'disabled');\r\n            }\r\n            if (this.item) {\r\n                removeClass(this.item, 'disabled');\r\n                this.item.tabIndex = 0;\r\n            }\r\n        }\r\n        else {\r\n            if (this.element) {\r\n                addClass(this.element, 'disabled');\r\n            }\r\n            if (this.item) {\r\n                addClass(this.item, 'disabled');\r\n                removeTabIndexAndUpdateFocus(this.item);\r\n            }\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.updateChecked = function () {\r\n        if (!this.item) {\r\n            return;\r\n        }\r\n        if (this.getAction().checked) {\r\n            addClass(this.item, 'checked');\r\n            this.item.setAttribute('role', 'menuitemcheckbox');\r\n            this.item.setAttribute('aria-checked', 'true');\r\n        }\r\n        else {\r\n            removeClass(this.item, 'checked');\r\n            this.item.setAttribute('role', 'menuitem');\r\n            this.item.setAttribute('aria-checked', 'false');\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.getMnemonic = function () {\r\n        return this.mnemonic;\r\n    };\r\n    BaseMenuActionViewItem.prototype.applyStyle = function () {\r\n        if (!this.menuStyle) {\r\n            return;\r\n        }\r\n        var isSelected = this.element && hasClass(this.element, 'focused');\r\n        var fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\r\n        var bgColor = isSelected && this.menuStyle.selectionBackgroundColor ? this.menuStyle.selectionBackgroundColor : undefined;\r\n        var border = isSelected && this.menuStyle.selectionBorderColor ? \"thin solid \" + this.menuStyle.selectionBorderColor : '';\r\n        if (this.item) {\r\n            this.item.style.color = fgColor ? fgColor.toString() : '';\r\n            this.item.style.backgroundColor = bgColor ? bgColor.toString() : '';\r\n        }\r\n        if (this.check) {\r\n            this.check.style.color = fgColor ? fgColor.toString() : '';\r\n        }\r\n        if (this.container) {\r\n            this.container.style.border = border;\r\n        }\r\n    };\r\n    BaseMenuActionViewItem.prototype.style = function (style) {\r\n        this.menuStyle = style;\r\n        this.applyStyle();\r\n    };\r\n    return BaseMenuActionViewItem;\r\n}(BaseActionViewItem));\r\nvar SubmenuMenuActionViewItem = /** @class */ (function (_super) {\r\n    __extends(SubmenuMenuActionViewItem, _super);\r\n    function SubmenuMenuActionViewItem(action, submenuActions, parentData, submenuOptions) {\r\n        var _this = _super.call(this, action, action, submenuOptions) || this;\r\n        _this.submenuActions = submenuActions;\r\n        _this.parentData = parentData;\r\n        _this.submenuOptions = submenuOptions;\r\n        _this.mysubmenu = null;\r\n        _this.submenuDisposables = _this._register(new DisposableStore());\r\n        _this.mouseOver = false;\r\n        _this.expandDirection = submenuOptions && submenuOptions.expandDirection !== undefined ? submenuOptions.expandDirection : Direction.Right;\r\n        _this.showScheduler = new RunOnceScheduler(function () {\r\n            if (_this.mouseOver) {\r\n                _this.cleanupExistingSubmenu(false);\r\n                _this.createSubmenu(false);\r\n            }\r\n        }, 250);\r\n        _this.hideScheduler = new RunOnceScheduler(function () {\r\n            if (_this.element && (!isAncestor(document.activeElement, _this.element) && _this.parentData.submenu === _this.mysubmenu)) {\r\n                _this.parentData.parent.focus(false);\r\n                _this.cleanupExistingSubmenu(true);\r\n            }\r\n        }, 750);\r\n        return _this;\r\n    }\r\n    SubmenuMenuActionViewItem.prototype.render = function (container) {\r\n        var _this = this;\r\n        _super.prototype.render.call(this, container);\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        if (this.item) {\r\n            addClass(this.item, 'monaco-submenu-item');\r\n            this.item.setAttribute('aria-haspopup', 'true');\r\n            this.updateAriaExpanded('false');\r\n            this.submenuIndicator = append(this.item, $('span.submenu-indicator.codicon.codicon-chevron-right'));\r\n            this.submenuIndicator.setAttribute('aria-hidden', 'true');\r\n        }\r\n        this._register(addDisposableListener(this.element, EventType.KEY_UP, function (e) {\r\n            var event = new StandardKeyboardEvent(e);\r\n            if (event.equals(17 /* RightArrow */) || event.equals(3 /* Enter */)) {\r\n                EventHelper.stop(e, true);\r\n                _this.createSubmenu(true);\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.KEY_DOWN, function (e) {\r\n            var event = new StandardKeyboardEvent(e);\r\n            if (document.activeElement === _this.item) {\r\n                if (event.equals(17 /* RightArrow */) || event.equals(3 /* Enter */)) {\r\n                    EventHelper.stop(e, true);\r\n                }\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.MOUSE_OVER, function (e) {\r\n            if (!_this.mouseOver) {\r\n                _this.mouseOver = true;\r\n                _this.showScheduler.schedule();\r\n            }\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.MOUSE_LEAVE, function (e) {\r\n            _this.mouseOver = false;\r\n        }));\r\n        this._register(addDisposableListener(this.element, EventType.FOCUS_OUT, function (e) {\r\n            if (_this.element && !isAncestor(document.activeElement, _this.element)) {\r\n                _this.hideScheduler.schedule();\r\n            }\r\n        }));\r\n        this._register(this.parentData.parent.onScroll(function () {\r\n            _this.parentData.parent.focus(false);\r\n            _this.cleanupExistingSubmenu(false);\r\n        }));\r\n    };\r\n    SubmenuMenuActionViewItem.prototype.onClick = function (e) {\r\n        // stop clicking from trying to run an action\r\n        EventHelper.stop(e, true);\r\n        this.cleanupExistingSubmenu(false);\r\n        this.createSubmenu(true);\r\n    };\r\n    SubmenuMenuActionViewItem.prototype.cleanupExistingSubmenu = function (force) {\r\n        if (this.parentData.submenu && (force || (this.parentData.submenu !== this.mysubmenu))) {\r\n            this.parentData.submenu.dispose();\r\n            this.parentData.submenu = undefined;\r\n            this.updateAriaExpanded('false');\r\n            if (this.submenuContainer) {\r\n                this.submenuDisposables.clear();\r\n                this.submenuContainer = undefined;\r\n            }\r\n        }\r\n    };\r\n    SubmenuMenuActionViewItem.prototype.createSubmenu = function (selectFirstItem) {\r\n        var _this = this;\r\n        if (selectFirstItem === void 0) { selectFirstItem = true; }\r\n        if (!this.element) {\r\n            return;\r\n        }\r\n        if (!this.parentData.submenu) {\r\n            this.updateAriaExpanded('true');\r\n            this.submenuContainer = append(this.element, $('div.monaco-submenu'));\r\n            addClasses(this.submenuContainer, 'menubar-menu-items-holder', 'context-view');\r\n            // Set the top value of the menu container before construction\r\n            // This allows the menu constructor to calculate the proper max height\r\n            var computedStyles = getComputedStyle(this.parentData.parent.domNode);\r\n            var paddingTop = parseFloat(computedStyles.paddingTop || '0') || 0;\r\n            this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop + \"px\";\r\n            this.parentData.submenu = new Menu(this.submenuContainer, this.submenuActions, this.submenuOptions);\r\n            if (this.menuStyle) {\r\n                this.parentData.submenu.style(this.menuStyle);\r\n            }\r\n            var boundingRect = this.element.getBoundingClientRect();\r\n            var childBoundingRect = this.submenuContainer.getBoundingClientRect();\r\n            if (this.expandDirection === Direction.Right) {\r\n                if (window.innerWidth <= boundingRect.right + childBoundingRect.width) {\r\n                    this.submenuContainer.style.left = '10px';\r\n                    this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset + boundingRect.height + \"px\";\r\n                }\r\n                else {\r\n                    this.submenuContainer.style.left = this.element.offsetWidth + \"px\";\r\n                    this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop + \"px\";\r\n                }\r\n            }\r\n            else if (this.expandDirection === Direction.Left) {\r\n                this.submenuContainer.style.right = this.element.offsetWidth + \"px\";\r\n                this.submenuContainer.style.left = 'auto';\r\n                this.submenuContainer.style.top = this.element.offsetTop - this.parentData.parent.scrollOffset - paddingTop + \"px\";\r\n            }\r\n            this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_UP, function (e) {\r\n                var event = new StandardKeyboardEvent(e);\r\n                if (event.equals(15 /* LeftArrow */)) {\r\n                    EventHelper.stop(e, true);\r\n                    _this.parentData.parent.focus();\r\n                    _this.cleanupExistingSubmenu(true);\r\n                }\r\n            }));\r\n            this.submenuDisposables.add(addDisposableListener(this.submenuContainer, EventType.KEY_DOWN, function (e) {\r\n                var event = new StandardKeyboardEvent(e);\r\n                if (event.equals(15 /* LeftArrow */)) {\r\n                    EventHelper.stop(e, true);\r\n                }\r\n            }));\r\n            this.submenuDisposables.add(this.parentData.submenu.onDidCancel(function () {\r\n                _this.parentData.parent.focus();\r\n                _this.cleanupExistingSubmenu(true);\r\n            }));\r\n            this.parentData.submenu.focus(selectFirstItem);\r\n            this.mysubmenu = this.parentData.submenu;\r\n        }\r\n        else {\r\n            this.parentData.submenu.focus(false);\r\n        }\r\n    };\r\n    SubmenuMenuActionViewItem.prototype.updateAriaExpanded = function (value) {\r\n        var _a;\r\n        if (this.item) {\r\n            (_a = this.item) === null || _a === void 0 ? void 0 : _a.setAttribute('aria-expanded', value);\r\n        }\r\n    };\r\n    SubmenuMenuActionViewItem.prototype.applyStyle = function () {\r\n        _super.prototype.applyStyle.call(this);\r\n        if (!this.menuStyle) {\r\n            return;\r\n        }\r\n        var isSelected = this.element && hasClass(this.element, 'focused');\r\n        var fgColor = isSelected && this.menuStyle.selectionForegroundColor ? this.menuStyle.selectionForegroundColor : this.menuStyle.foregroundColor;\r\n        if (this.submenuIndicator) {\r\n            this.submenuIndicator.style.color = fgColor ? \"\" + fgColor : '';\r\n        }\r\n        if (this.parentData.submenu) {\r\n            this.parentData.submenu.style(this.menuStyle);\r\n        }\r\n    };\r\n    SubmenuMenuActionViewItem.prototype.dispose = function () {\r\n        _super.prototype.dispose.call(this);\r\n        this.hideScheduler.dispose();\r\n        if (this.mysubmenu) {\r\n            this.mysubmenu.dispose();\r\n            this.mysubmenu = null;\r\n        }\r\n        if (this.submenuContainer) {\r\n            this.submenuContainer = undefined;\r\n        }\r\n    };\r\n    return SubmenuMenuActionViewItem;\r\n}(BaseMenuActionViewItem));\r\nvar MenuSeparatorActionViewItem = /** @class */ (function (_super) {\r\n    __extends(MenuSeparatorActionViewItem, _super);\r\n    function MenuSeparatorActionViewItem() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    MenuSeparatorActionViewItem.prototype.style = function (style) {\r\n        if (this.label) {\r\n            this.label.style.borderBottomColor = style.separatorColor ? \"\" + style.separatorColor : '';\r\n        }\r\n    };\r\n    return MenuSeparatorActionViewItem;\r\n}(ActionViewItem));\r\nexport function cleanMnemonic(label) {\r\n    var regex = MENU_MNEMONIC_REGEX;\r\n    var matches = regex.exec(label);\r\n    if (!matches) {\r\n        return label;\r\n    }\r\n    var mnemonicInText = !matches[1];\r\n    return label.replace(regex, mnemonicInText ? '$2$3' : '').trim();\r\n}\r\n"]},"metadata":{},"sourceType":"module"}