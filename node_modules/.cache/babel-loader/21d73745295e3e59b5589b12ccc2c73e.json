{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport './hover.css';\nimport * as nls from '../../../nls.js';\nimport { KeyChord } from '../../../base/common/keyCodes.js';\nimport { DisposableStore, MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { IModeService } from '../../common/services/modeService.js';\nimport { ModesContentHoverWidget } from './modesContentHover.js';\nimport { ModesGlyphHoverWidget } from './modesGlyphHover.js';\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\nimport { editorHoverBackground, editorHoverBorder, editorHoverHighlight, textCodeBlockBackground, textLinkForeground, editorHoverStatusBarBackground, editorHoverForeground } from '../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { IMarkerDecorationsService } from '../../common/services/markersDecorationService.js';\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\nimport { GotoDefinitionAtPositionEditorContribution } from '../gotoSymbol/link/goToDefinitionAtPosition.js';\n\nvar ModesHoverController =\n/** @class */\nfunction () {\n  function ModesHoverController(_editor, _openerService, _modeService, _markerDecorationsService, _keybindingService, _themeService) {\n    var _this = this;\n\n    this._editor = _editor;\n    this._openerService = _openerService;\n    this._modeService = _modeService;\n    this._markerDecorationsService = _markerDecorationsService;\n    this._keybindingService = _keybindingService;\n    this._themeService = _themeService;\n    this._toUnhook = new DisposableStore();\n    this._contentWidget = new MutableDisposable();\n    this._glyphWidget = new MutableDisposable();\n    this._isMouseDown = false;\n    this._hoverClicked = false;\n\n    this._hookEvents();\n\n    this._didChangeConfigurationHandler = this._editor.onDidChangeConfiguration(function (e) {\n      if (e.hasChanged(44\n      /* hover */\n      )) {\n        _this._hideWidgets();\n\n        _this._unhookEvents();\n\n        _this._hookEvents();\n      }\n    });\n  }\n\n  Object.defineProperty(ModesHoverController.prototype, \"contentWidget\", {\n    get: function () {\n      if (!this._contentWidget.value) {\n        this._createHoverWidgets();\n      }\n\n      return this._contentWidget.value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ModesHoverController.prototype, \"glyphWidget\", {\n    get: function () {\n      if (!this._glyphWidget.value) {\n        this._createHoverWidgets();\n      }\n\n      return this._glyphWidget.value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ModesHoverController.get = function (editor) {\n    return editor.getContribution(ModesHoverController.ID);\n  };\n\n  ModesHoverController.prototype._hookEvents = function () {\n    var _this = this;\n\n    var hideWidgetsEventHandler = function () {\n      return _this._hideWidgets();\n    };\n\n    var hoverOpts = this._editor.getOption(44\n    /* hover */\n    );\n\n    this._isHoverEnabled = hoverOpts.enabled;\n    this._isHoverSticky = hoverOpts.sticky;\n\n    if (this._isHoverEnabled) {\n      this._toUnhook.add(this._editor.onMouseDown(function (e) {\n        return _this._onEditorMouseDown(e);\n      }));\n\n      this._toUnhook.add(this._editor.onMouseUp(function (e) {\n        return _this._onEditorMouseUp(e);\n      }));\n\n      this._toUnhook.add(this._editor.onMouseMove(function (e) {\n        return _this._onEditorMouseMove(e);\n      }));\n\n      this._toUnhook.add(this._editor.onKeyDown(function (e) {\n        return _this._onKeyDown(e);\n      }));\n\n      this._toUnhook.add(this._editor.onDidChangeModelDecorations(function () {\n        return _this._onModelDecorationsChanged();\n      }));\n    } else {\n      this._toUnhook.add(this._editor.onMouseMove(hideWidgetsEventHandler));\n    }\n\n    this._toUnhook.add(this._editor.onMouseLeave(hideWidgetsEventHandler));\n\n    this._toUnhook.add(this._editor.onDidChangeModel(hideWidgetsEventHandler));\n\n    this._toUnhook.add(this._editor.onDidScrollChange(function (e) {\n      return _this._onEditorScrollChanged(e);\n    }));\n  };\n\n  ModesHoverController.prototype._unhookEvents = function () {\n    this._toUnhook.clear();\n  };\n\n  ModesHoverController.prototype._onModelDecorationsChanged = function () {\n    this.contentWidget.onModelDecorationsChanged();\n    this.glyphWidget.onModelDecorationsChanged();\n  };\n\n  ModesHoverController.prototype._onEditorScrollChanged = function (e) {\n    if (e.scrollTopChanged || e.scrollLeftChanged) {\n      this._hideWidgets();\n    }\n  };\n\n  ModesHoverController.prototype._onEditorMouseDown = function (mouseEvent) {\n    this._isMouseDown = true;\n    var targetType = mouseEvent.target.type;\n\n    if (targetType === 9\n    /* CONTENT_WIDGET */\n    && mouseEvent.target.detail === ModesContentHoverWidget.ID) {\n      this._hoverClicked = true; // mouse down on top of content hover widget\n\n      return;\n    }\n\n    if (targetType === 12\n    /* OVERLAY_WIDGET */\n    && mouseEvent.target.detail === ModesGlyphHoverWidget.ID) {\n      // mouse down on top of overlay hover widget\n      return;\n    }\n\n    if (targetType !== 12\n    /* OVERLAY_WIDGET */\n    && mouseEvent.target.detail !== ModesGlyphHoverWidget.ID) {\n      this._hoverClicked = false;\n    }\n\n    this._hideWidgets();\n  };\n\n  ModesHoverController.prototype._onEditorMouseUp = function (mouseEvent) {\n    this._isMouseDown = false;\n  };\n\n  ModesHoverController.prototype._onEditorMouseMove = function (mouseEvent) {\n    var targetType = mouseEvent.target.type;\n\n    if (this._isMouseDown && this._hoverClicked && this.contentWidget.isColorPickerVisible()) {\n      return;\n    }\n\n    if (this._isHoverSticky && targetType === 9\n    /* CONTENT_WIDGET */\n    && mouseEvent.target.detail === ModesContentHoverWidget.ID) {\n      // mouse moved on top of content hover widget\n      return;\n    }\n\n    if (this._isHoverSticky && targetType === 12\n    /* OVERLAY_WIDGET */\n    && mouseEvent.target.detail === ModesGlyphHoverWidget.ID) {\n      // mouse moved on top of overlay hover widget\n      return;\n    }\n\n    if (targetType === 7\n    /* CONTENT_EMPTY */\n    ) {\n        var epsilon = this._editor.getOption(34\n        /* fontInfo */\n        ).typicalHalfwidthCharacterWidth / 2;\n        var data = mouseEvent.target.detail;\n\n        if (data && !data.isAfterLines && typeof data.horizontalDistanceToText === 'number' && data.horizontalDistanceToText < epsilon) {\n          // Let hover kick in even when the mouse is technically in the empty area after a line, given the distance is small enough\n          targetType = 6\n          /* CONTENT_TEXT */\n          ;\n        }\n      }\n\n    if (targetType === 6\n    /* CONTENT_TEXT */\n    ) {\n        this.glyphWidget.hide();\n\n        if (this._isHoverEnabled && mouseEvent.target.range) {\n          this.contentWidget.startShowingAt(mouseEvent.target.range, 0\n          /* Delayed */\n          , false);\n        }\n      } else if (targetType === 2\n    /* GUTTER_GLYPH_MARGIN */\n    ) {\n        this.contentWidget.hide();\n\n        if (this._isHoverEnabled && mouseEvent.target.position) {\n          this.glyphWidget.startShowingAt(mouseEvent.target.position.lineNumber);\n        }\n      } else {\n      this._hideWidgets();\n    }\n  };\n\n  ModesHoverController.prototype._onKeyDown = function (e) {\n    if (e.keyCode !== 5\n    /* Ctrl */\n    && e.keyCode !== 6\n    /* Alt */\n    && e.keyCode !== 57\n    /* Meta */\n    && e.keyCode !== 4\n    /* Shift */\n    ) {\n        // Do not hide hover when a modifier key is pressed\n        this._hideWidgets();\n      }\n  };\n\n  ModesHoverController.prototype._hideWidgets = function () {\n    if (!this._glyphWidget.value || !this._contentWidget.value || this._isMouseDown && this._hoverClicked && this._contentWidget.value.isColorPickerVisible()) {\n      return;\n    }\n\n    this._glyphWidget.value.hide();\n\n    this._contentWidget.value.hide();\n  };\n\n  ModesHoverController.prototype._createHoverWidgets = function () {\n    this._contentWidget.value = new ModesContentHoverWidget(this._editor, this._markerDecorationsService, this._themeService, this._keybindingService, this._modeService, this._openerService);\n    this._glyphWidget.value = new ModesGlyphHoverWidget(this._editor, this._modeService, this._openerService);\n  };\n\n  ModesHoverController.prototype.showContentHover = function (range, mode, focus) {\n    this.contentWidget.startShowingAt(range, mode, focus);\n  };\n\n  ModesHoverController.prototype.dispose = function () {\n    this._unhookEvents();\n\n    this._toUnhook.dispose();\n\n    this._didChangeConfigurationHandler.dispose();\n\n    this._glyphWidget.dispose();\n\n    this._contentWidget.dispose();\n  };\n\n  ModesHoverController.ID = 'editor.contrib.hover';\n  ModesHoverController = __decorate([__param(1, IOpenerService), __param(2, IModeService), __param(3, IMarkerDecorationsService), __param(4, IKeybindingService), __param(5, IThemeService)], ModesHoverController);\n  return ModesHoverController;\n}();\n\nexport { ModesHoverController };\n\nvar ShowHoverAction =\n/** @class */\nfunction (_super) {\n  __extends(ShowHoverAction, _super);\n\n  function ShowHoverAction() {\n    return _super.call(this, {\n      id: 'editor.action.showHover',\n      label: nls.localize({\n        key: 'showHover',\n        comment: ['Label for action that will trigger the showing of a hover in the editor.', 'This allows for users to show the hover without using the mouse.']\n      }, \"Show Hover\"),\n      alias: 'Show Hover',\n      precondition: undefined,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KEY_K */\n        , 2048\n        /* CtrlCmd */\n        | 39\n        /* KEY_I */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    }) || this;\n  }\n\n  ShowHoverAction.prototype.run = function (accessor, editor) {\n    if (!editor.hasModel()) {\n      return;\n    }\n\n    var controller = ModesHoverController.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    var position = editor.getPosition();\n    var range = new Range(position.lineNumber, position.column, position.lineNumber, position.column);\n    var focus = editor.getOption(2\n    /* accessibilitySupport */\n    ) === 2\n    /* Enabled */\n    ;\n    controller.showContentHover(range, 1\n    /* Immediate */\n    , focus);\n  };\n\n  return ShowHoverAction;\n}(EditorAction);\n\nvar ShowDefinitionPreviewHoverAction =\n/** @class */\nfunction (_super) {\n  __extends(ShowDefinitionPreviewHoverAction, _super);\n\n  function ShowDefinitionPreviewHoverAction() {\n    return _super.call(this, {\n      id: 'editor.action.showDefinitionPreviewHover',\n      label: nls.localize({\n        key: 'showDefinitionPreviewHover',\n        comment: ['Label for action that will trigger the showing of definition preview hover in the editor.', 'This allows for users to show the definition preview hover without using the mouse.']\n      }, \"Show Definition Preview Hover\"),\n      alias: 'Show Definition Preview Hover',\n      precondition: undefined\n    }) || this;\n  }\n\n  ShowDefinitionPreviewHoverAction.prototype.run = function (accessor, editor) {\n    var controller = ModesHoverController.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    var position = editor.getPosition();\n\n    if (!position) {\n      return;\n    }\n\n    var range = new Range(position.lineNumber, position.column, position.lineNumber, position.column);\n    var goto = GotoDefinitionAtPositionEditorContribution.get(editor);\n    var promise = goto.startFindDefinitionFromCursor(position);\n\n    if (promise) {\n      promise.then(function () {\n        controller.showContentHover(range, 1\n        /* Immediate */\n        , true);\n      });\n    } else {\n      controller.showContentHover(range, 1\n      /* Immediate */\n      , true);\n    }\n  };\n\n  return ShowDefinitionPreviewHoverAction;\n}(EditorAction);\n\nregisterEditorContribution(ModesHoverController.ID, ModesHoverController);\nregisterEditorAction(ShowHoverAction);\nregisterEditorAction(ShowDefinitionPreviewHoverAction); // theming\n\nregisterThemingParticipant(function (theme, collector) {\n  var editorHoverHighlightColor = theme.getColor(editorHoverHighlight);\n\n  if (editorHoverHighlightColor) {\n    collector.addRule(\".monaco-editor .hoverHighlight { background-color: \" + editorHoverHighlightColor + \"; }\");\n  }\n\n  var hoverBackground = theme.getColor(editorHoverBackground);\n\n  if (hoverBackground) {\n    collector.addRule(\".monaco-editor .monaco-editor-hover { background-color: \" + hoverBackground + \"; }\");\n  }\n\n  var hoverBorder = theme.getColor(editorHoverBorder);\n\n  if (hoverBorder) {\n    collector.addRule(\".monaco-editor .monaco-editor-hover { border: 1px solid \" + hoverBorder + \"; }\");\n    collector.addRule(\".monaco-editor .monaco-editor-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid \" + hoverBorder.transparent(0.5) + \"; }\");\n    collector.addRule(\".monaco-editor .monaco-editor-hover hr { border-top: 1px solid \" + hoverBorder.transparent(0.5) + \"; }\");\n    collector.addRule(\".monaco-editor .monaco-editor-hover hr { border-bottom: 0px solid \" + hoverBorder.transparent(0.5) + \"; }\");\n  }\n\n  var link = theme.getColor(textLinkForeground);\n\n  if (link) {\n    collector.addRule(\".monaco-editor .monaco-editor-hover a { color: \" + link + \"; }\");\n  }\n\n  var hoverForeground = theme.getColor(editorHoverForeground);\n\n  if (hoverForeground) {\n    collector.addRule(\".monaco-editor .monaco-editor-hover { color: \" + hoverForeground + \"; }\");\n  }\n\n  var actionsBackground = theme.getColor(editorHoverStatusBarBackground);\n\n  if (actionsBackground) {\n    collector.addRule(\".monaco-editor .monaco-editor-hover .hover-row .actions { background-color: \" + actionsBackground + \"; }\");\n  }\n\n  var codeBackground = theme.getColor(textCodeBlockBackground);\n\n  if (codeBackground) {\n    collector.addRule(\".monaco-editor .monaco-editor-hover code { background-color: \" + codeBackground + \"; }\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/hover/hover.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","nls","KeyChord","DisposableStore","MutableDisposable","EditorAction","registerEditorAction","registerEditorContribution","Range","EditorContextKeys","IModeService","ModesContentHoverWidget","ModesGlyphHoverWidget","IOpenerService","editorHoverBackground","editorHoverBorder","editorHoverHighlight","textCodeBlockBackground","textLinkForeground","editorHoverStatusBarBackground","editorHoverForeground","IThemeService","registerThemingParticipant","IMarkerDecorationsService","IKeybindingService","GotoDefinitionAtPositionEditorContribution","ModesHoverController","_editor","_openerService","_modeService","_markerDecorationsService","_keybindingService","_themeService","_this","_toUnhook","_contentWidget","_glyphWidget","_isMouseDown","_hoverClicked","_hookEvents","_didChangeConfigurationHandler","onDidChangeConfiguration","e","hasChanged","_hideWidgets","_unhookEvents","get","value","_createHoverWidgets","enumerable","configurable","editor","getContribution","ID","hideWidgetsEventHandler","hoverOpts","getOption","_isHoverEnabled","enabled","_isHoverSticky","sticky","add","onMouseDown","_onEditorMouseDown","onMouseUp","_onEditorMouseUp","onMouseMove","_onEditorMouseMove","onKeyDown","_onKeyDown","onDidChangeModelDecorations","_onModelDecorationsChanged","onMouseLeave","onDidChangeModel","onDidScrollChange","_onEditorScrollChanged","clear","contentWidget","onModelDecorationsChanged","glyphWidget","scrollTopChanged","scrollLeftChanged","mouseEvent","targetType","type","detail","isColorPickerVisible","epsilon","typicalHalfwidthCharacterWidth","data","isAfterLines","horizontalDistanceToText","hide","range","startShowingAt","position","lineNumber","keyCode","showContentHover","mode","focus","dispose","ShowHoverAction","_super","call","id","label","localize","comment","alias","precondition","undefined","kbOpts","kbExpr","editorTextFocus","primary","weight","run","accessor","hasModel","controller","getPosition","column","ShowDefinitionPreviewHoverAction","goto","promise","startFindDefinitionFromCursor","then","theme","collector","editorHoverHighlightColor","getColor","addRule","hoverBackground","hoverBorder","transparent","link","hoverForeground","actionsBackground","codeBackground"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport './hover.css';\r\nimport * as nls from '../../../nls.js';\r\nimport { KeyChord } from '../../../base/common/keyCodes.js';\r\nimport { DisposableStore, MutableDisposable } from '../../../base/common/lifecycle.js';\r\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../browser/editorExtensions.js';\r\nimport { Range } from '../../common/core/range.js';\r\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\r\nimport { IModeService } from '../../common/services/modeService.js';\r\nimport { ModesContentHoverWidget } from './modesContentHover.js';\r\nimport { ModesGlyphHoverWidget } from './modesGlyphHover.js';\r\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\r\nimport { editorHoverBackground, editorHoverBorder, editorHoverHighlight, textCodeBlockBackground, textLinkForeground, editorHoverStatusBarBackground, editorHoverForeground } from '../../../platform/theme/common/colorRegistry.js';\r\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\r\nimport { IMarkerDecorationsService } from '../../common/services/markersDecorationService.js';\r\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\r\nimport { GotoDefinitionAtPositionEditorContribution } from '../gotoSymbol/link/goToDefinitionAtPosition.js';\r\nvar ModesHoverController = /** @class */ (function () {\r\n    function ModesHoverController(_editor, _openerService, _modeService, _markerDecorationsService, _keybindingService, _themeService) {\r\n        var _this = this;\r\n        this._editor = _editor;\r\n        this._openerService = _openerService;\r\n        this._modeService = _modeService;\r\n        this._markerDecorationsService = _markerDecorationsService;\r\n        this._keybindingService = _keybindingService;\r\n        this._themeService = _themeService;\r\n        this._toUnhook = new DisposableStore();\r\n        this._contentWidget = new MutableDisposable();\r\n        this._glyphWidget = new MutableDisposable();\r\n        this._isMouseDown = false;\r\n        this._hoverClicked = false;\r\n        this._hookEvents();\r\n        this._didChangeConfigurationHandler = this._editor.onDidChangeConfiguration(function (e) {\r\n            if (e.hasChanged(44 /* hover */)) {\r\n                _this._hideWidgets();\r\n                _this._unhookEvents();\r\n                _this._hookEvents();\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(ModesHoverController.prototype, \"contentWidget\", {\r\n        get: function () {\r\n            if (!this._contentWidget.value) {\r\n                this._createHoverWidgets();\r\n            }\r\n            return this._contentWidget.value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ModesHoverController.prototype, \"glyphWidget\", {\r\n        get: function () {\r\n            if (!this._glyphWidget.value) {\r\n                this._createHoverWidgets();\r\n            }\r\n            return this._glyphWidget.value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ModesHoverController.get = function (editor) {\r\n        return editor.getContribution(ModesHoverController.ID);\r\n    };\r\n    ModesHoverController.prototype._hookEvents = function () {\r\n        var _this = this;\r\n        var hideWidgetsEventHandler = function () { return _this._hideWidgets(); };\r\n        var hoverOpts = this._editor.getOption(44 /* hover */);\r\n        this._isHoverEnabled = hoverOpts.enabled;\r\n        this._isHoverSticky = hoverOpts.sticky;\r\n        if (this._isHoverEnabled) {\r\n            this._toUnhook.add(this._editor.onMouseDown(function (e) { return _this._onEditorMouseDown(e); }));\r\n            this._toUnhook.add(this._editor.onMouseUp(function (e) { return _this._onEditorMouseUp(e); }));\r\n            this._toUnhook.add(this._editor.onMouseMove(function (e) { return _this._onEditorMouseMove(e); }));\r\n            this._toUnhook.add(this._editor.onKeyDown(function (e) { return _this._onKeyDown(e); }));\r\n            this._toUnhook.add(this._editor.onDidChangeModelDecorations(function () { return _this._onModelDecorationsChanged(); }));\r\n        }\r\n        else {\r\n            this._toUnhook.add(this._editor.onMouseMove(hideWidgetsEventHandler));\r\n        }\r\n        this._toUnhook.add(this._editor.onMouseLeave(hideWidgetsEventHandler));\r\n        this._toUnhook.add(this._editor.onDidChangeModel(hideWidgetsEventHandler));\r\n        this._toUnhook.add(this._editor.onDidScrollChange(function (e) { return _this._onEditorScrollChanged(e); }));\r\n    };\r\n    ModesHoverController.prototype._unhookEvents = function () {\r\n        this._toUnhook.clear();\r\n    };\r\n    ModesHoverController.prototype._onModelDecorationsChanged = function () {\r\n        this.contentWidget.onModelDecorationsChanged();\r\n        this.glyphWidget.onModelDecorationsChanged();\r\n    };\r\n    ModesHoverController.prototype._onEditorScrollChanged = function (e) {\r\n        if (e.scrollTopChanged || e.scrollLeftChanged) {\r\n            this._hideWidgets();\r\n        }\r\n    };\r\n    ModesHoverController.prototype._onEditorMouseDown = function (mouseEvent) {\r\n        this._isMouseDown = true;\r\n        var targetType = mouseEvent.target.type;\r\n        if (targetType === 9 /* CONTENT_WIDGET */ && mouseEvent.target.detail === ModesContentHoverWidget.ID) {\r\n            this._hoverClicked = true;\r\n            // mouse down on top of content hover widget\r\n            return;\r\n        }\r\n        if (targetType === 12 /* OVERLAY_WIDGET */ && mouseEvent.target.detail === ModesGlyphHoverWidget.ID) {\r\n            // mouse down on top of overlay hover widget\r\n            return;\r\n        }\r\n        if (targetType !== 12 /* OVERLAY_WIDGET */ && mouseEvent.target.detail !== ModesGlyphHoverWidget.ID) {\r\n            this._hoverClicked = false;\r\n        }\r\n        this._hideWidgets();\r\n    };\r\n    ModesHoverController.prototype._onEditorMouseUp = function (mouseEvent) {\r\n        this._isMouseDown = false;\r\n    };\r\n    ModesHoverController.prototype._onEditorMouseMove = function (mouseEvent) {\r\n        var targetType = mouseEvent.target.type;\r\n        if (this._isMouseDown && this._hoverClicked && this.contentWidget.isColorPickerVisible()) {\r\n            return;\r\n        }\r\n        if (this._isHoverSticky && targetType === 9 /* CONTENT_WIDGET */ && mouseEvent.target.detail === ModesContentHoverWidget.ID) {\r\n            // mouse moved on top of content hover widget\r\n            return;\r\n        }\r\n        if (this._isHoverSticky && targetType === 12 /* OVERLAY_WIDGET */ && mouseEvent.target.detail === ModesGlyphHoverWidget.ID) {\r\n            // mouse moved on top of overlay hover widget\r\n            return;\r\n        }\r\n        if (targetType === 7 /* CONTENT_EMPTY */) {\r\n            var epsilon = this._editor.getOption(34 /* fontInfo */).typicalHalfwidthCharacterWidth / 2;\r\n            var data = mouseEvent.target.detail;\r\n            if (data && !data.isAfterLines && typeof data.horizontalDistanceToText === 'number' && data.horizontalDistanceToText < epsilon) {\r\n                // Let hover kick in even when the mouse is technically in the empty area after a line, given the distance is small enough\r\n                targetType = 6 /* CONTENT_TEXT */;\r\n            }\r\n        }\r\n        if (targetType === 6 /* CONTENT_TEXT */) {\r\n            this.glyphWidget.hide();\r\n            if (this._isHoverEnabled && mouseEvent.target.range) {\r\n                this.contentWidget.startShowingAt(mouseEvent.target.range, 0 /* Delayed */, false);\r\n            }\r\n        }\r\n        else if (targetType === 2 /* GUTTER_GLYPH_MARGIN */) {\r\n            this.contentWidget.hide();\r\n            if (this._isHoverEnabled && mouseEvent.target.position) {\r\n                this.glyphWidget.startShowingAt(mouseEvent.target.position.lineNumber);\r\n            }\r\n        }\r\n        else {\r\n            this._hideWidgets();\r\n        }\r\n    };\r\n    ModesHoverController.prototype._onKeyDown = function (e) {\r\n        if (e.keyCode !== 5 /* Ctrl */ && e.keyCode !== 6 /* Alt */ && e.keyCode !== 57 /* Meta */ && e.keyCode !== 4 /* Shift */) {\r\n            // Do not hide hover when a modifier key is pressed\r\n            this._hideWidgets();\r\n        }\r\n    };\r\n    ModesHoverController.prototype._hideWidgets = function () {\r\n        if (!this._glyphWidget.value || !this._contentWidget.value || (this._isMouseDown && this._hoverClicked && this._contentWidget.value.isColorPickerVisible())) {\r\n            return;\r\n        }\r\n        this._glyphWidget.value.hide();\r\n        this._contentWidget.value.hide();\r\n    };\r\n    ModesHoverController.prototype._createHoverWidgets = function () {\r\n        this._contentWidget.value = new ModesContentHoverWidget(this._editor, this._markerDecorationsService, this._themeService, this._keybindingService, this._modeService, this._openerService);\r\n        this._glyphWidget.value = new ModesGlyphHoverWidget(this._editor, this._modeService, this._openerService);\r\n    };\r\n    ModesHoverController.prototype.showContentHover = function (range, mode, focus) {\r\n        this.contentWidget.startShowingAt(range, mode, focus);\r\n    };\r\n    ModesHoverController.prototype.dispose = function () {\r\n        this._unhookEvents();\r\n        this._toUnhook.dispose();\r\n        this._didChangeConfigurationHandler.dispose();\r\n        this._glyphWidget.dispose();\r\n        this._contentWidget.dispose();\r\n    };\r\n    ModesHoverController.ID = 'editor.contrib.hover';\r\n    ModesHoverController = __decorate([\r\n        __param(1, IOpenerService),\r\n        __param(2, IModeService),\r\n        __param(3, IMarkerDecorationsService),\r\n        __param(4, IKeybindingService),\r\n        __param(5, IThemeService)\r\n    ], ModesHoverController);\r\n    return ModesHoverController;\r\n}());\r\nexport { ModesHoverController };\r\nvar ShowHoverAction = /** @class */ (function (_super) {\r\n    __extends(ShowHoverAction, _super);\r\n    function ShowHoverAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.showHover',\r\n            label: nls.localize({\r\n                key: 'showHover',\r\n                comment: [\r\n                    'Label for action that will trigger the showing of a hover in the editor.',\r\n                    'This allows for users to show the hover without using the mouse.'\r\n                ]\r\n            }, \"Show Hover\"),\r\n            alias: 'Show Hover',\r\n            precondition: undefined,\r\n            kbOpts: {\r\n                kbExpr: EditorContextKeys.editorTextFocus,\r\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KEY_K */, 2048 /* CtrlCmd */ | 39 /* KEY_I */),\r\n                weight: 100 /* EditorContrib */\r\n            }\r\n        }) || this;\r\n    }\r\n    ShowHoverAction.prototype.run = function (accessor, editor) {\r\n        if (!editor.hasModel()) {\r\n            return;\r\n        }\r\n        var controller = ModesHoverController.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        var position = editor.getPosition();\r\n        var range = new Range(position.lineNumber, position.column, position.lineNumber, position.column);\r\n        var focus = editor.getOption(2 /* accessibilitySupport */) === 2 /* Enabled */;\r\n        controller.showContentHover(range, 1 /* Immediate */, focus);\r\n    };\r\n    return ShowHoverAction;\r\n}(EditorAction));\r\nvar ShowDefinitionPreviewHoverAction = /** @class */ (function (_super) {\r\n    __extends(ShowDefinitionPreviewHoverAction, _super);\r\n    function ShowDefinitionPreviewHoverAction() {\r\n        return _super.call(this, {\r\n            id: 'editor.action.showDefinitionPreviewHover',\r\n            label: nls.localize({\r\n                key: 'showDefinitionPreviewHover',\r\n                comment: [\r\n                    'Label for action that will trigger the showing of definition preview hover in the editor.',\r\n                    'This allows for users to show the definition preview hover without using the mouse.'\r\n                ]\r\n            }, \"Show Definition Preview Hover\"),\r\n            alias: 'Show Definition Preview Hover',\r\n            precondition: undefined\r\n        }) || this;\r\n    }\r\n    ShowDefinitionPreviewHoverAction.prototype.run = function (accessor, editor) {\r\n        var controller = ModesHoverController.get(editor);\r\n        if (!controller) {\r\n            return;\r\n        }\r\n        var position = editor.getPosition();\r\n        if (!position) {\r\n            return;\r\n        }\r\n        var range = new Range(position.lineNumber, position.column, position.lineNumber, position.column);\r\n        var goto = GotoDefinitionAtPositionEditorContribution.get(editor);\r\n        var promise = goto.startFindDefinitionFromCursor(position);\r\n        if (promise) {\r\n            promise.then(function () {\r\n                controller.showContentHover(range, 1 /* Immediate */, true);\r\n            });\r\n        }\r\n        else {\r\n            controller.showContentHover(range, 1 /* Immediate */, true);\r\n        }\r\n    };\r\n    return ShowDefinitionPreviewHoverAction;\r\n}(EditorAction));\r\nregisterEditorContribution(ModesHoverController.ID, ModesHoverController);\r\nregisterEditorAction(ShowHoverAction);\r\nregisterEditorAction(ShowDefinitionPreviewHoverAction);\r\n// theming\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var editorHoverHighlightColor = theme.getColor(editorHoverHighlight);\r\n    if (editorHoverHighlightColor) {\r\n        collector.addRule(\".monaco-editor .hoverHighlight { background-color: \" + editorHoverHighlightColor + \"; }\");\r\n    }\r\n    var hoverBackground = theme.getColor(editorHoverBackground);\r\n    if (hoverBackground) {\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover { background-color: \" + hoverBackground + \"; }\");\r\n    }\r\n    var hoverBorder = theme.getColor(editorHoverBorder);\r\n    if (hoverBorder) {\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover { border: 1px solid \" + hoverBorder + \"; }\");\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid \" + hoverBorder.transparent(0.5) + \"; }\");\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover hr { border-top: 1px solid \" + hoverBorder.transparent(0.5) + \"; }\");\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover hr { border-bottom: 0px solid \" + hoverBorder.transparent(0.5) + \"; }\");\r\n    }\r\n    var link = theme.getColor(textLinkForeground);\r\n    if (link) {\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover a { color: \" + link + \"; }\");\r\n    }\r\n    var hoverForeground = theme.getColor(editorHoverForeground);\r\n    if (hoverForeground) {\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover { color: \" + hoverForeground + \"; }\");\r\n    }\r\n    var actionsBackground = theme.getColor(editorHoverStatusBarBackground);\r\n    if (actionsBackground) {\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover .hover-row .actions { background-color: \" + actionsBackground + \"; }\");\r\n    }\r\n    var codeBackground = theme.getColor(textCodeBlockBackground);\r\n    if (codeBackground) {\r\n        collector.addRule(\".monaco-editor .monaco-editor-hover code { background-color: \" + codeBackground + \"; }\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}