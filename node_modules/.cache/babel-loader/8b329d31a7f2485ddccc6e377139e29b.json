{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport './referencesWidget.css';\nimport * as dom from '../../../../base/browser/dom.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { dispose, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { basenameOrAuthority, dirname, isEqual } from '../../../../base/common/resources.js';\nimport { EmbeddedCodeEditorWidget } from '../../../browser/widget/embeddedCodeEditorWidget.js';\nimport { Range } from '../../../common/core/range.js';\nimport { ModelDecorationOptions, TextModel } from '../../../common/model/textModel.js';\nimport { ITextModelService } from '../../../common/services/resolverService.js';\nimport { AriaProvider, DataSource, Delegate, FileReferencesRenderer, OneReferenceRenderer, StringRepresentationProvider, IdentityProvider } from './referencesTree.js';\nimport * as nls from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { WorkbenchAsyncDataTree } from '../../../../platform/list/browser/listService.js';\nimport { activeContrastBorder } from '../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService, registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\nimport * as peekView from '../../peekView/peekView.js';\nimport { FileReferences, OneReference } from '../referencesModel.js';\nimport { SplitView, Sizing } from '../../../../base/browser/ui/splitview/splitview.js';\n\nvar DecorationsManager =\n/** @class */\nfunction () {\n  function DecorationsManager(_editor, _model) {\n    var _this = this;\n\n    this._editor = _editor;\n    this._model = _model;\n    this._decorations = new Map();\n    this._decorationIgnoreSet = new Set();\n    this._callOnDispose = new DisposableStore();\n    this._callOnModelChange = new DisposableStore();\n\n    this._callOnDispose.add(this._editor.onDidChangeModel(function () {\n      return _this._onModelChanged();\n    }));\n\n    this._onModelChanged();\n  }\n\n  DecorationsManager.prototype.dispose = function () {\n    this._callOnModelChange.dispose();\n\n    this._callOnDispose.dispose();\n\n    this.removeDecorations();\n  };\n\n  DecorationsManager.prototype._onModelChanged = function () {\n    this._callOnModelChange.clear();\n\n    var model = this._editor.getModel();\n\n    if (model) {\n      for (var _i = 0, _a = this._model.groups; _i < _a.length; _i++) {\n        var ref = _a[_i];\n\n        if (isEqual(ref.uri, model.uri)) {\n          this._addDecorations(ref);\n\n          return;\n        }\n      }\n    }\n  };\n\n  DecorationsManager.prototype._addDecorations = function (reference) {\n    var _this = this;\n\n    if (!this._editor.hasModel()) {\n      return;\n    }\n\n    this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(function (event) {\n      return _this._onDecorationChanged();\n    }));\n\n    var newDecorations = [];\n    var newDecorationsActualIndex = [];\n\n    for (var i = 0, len = reference.children.length; i < len; i++) {\n      var oneReference = reference.children[i];\n\n      if (this._decorationIgnoreSet.has(oneReference.id)) {\n        continue;\n      }\n\n      newDecorations.push({\n        range: oneReference.range,\n        options: DecorationsManager.DecorationOptions\n      });\n      newDecorationsActualIndex.push(i);\n    }\n\n    var decorations = this._editor.deltaDecorations([], newDecorations);\n\n    for (var i = 0; i < decorations.length; i++) {\n      this._decorations.set(decorations[i], reference.children[newDecorationsActualIndex[i]]);\n    }\n  };\n\n  DecorationsManager.prototype._onDecorationChanged = function () {\n    var _this = this;\n\n    var toRemove = [];\n\n    var model = this._editor.getModel();\n\n    if (!model) {\n      return;\n    }\n\n    this._decorations.forEach(function (reference, decorationId) {\n      var newRange = model.getDecorationRange(decorationId);\n\n      if (!newRange) {\n        return;\n      }\n\n      var ignore = false;\n\n      if (Range.equalsRange(newRange, reference.range)) {\n        return;\n      } else if (Range.spansMultipleLines(newRange)) {\n        ignore = true;\n      } else {\n        var lineLength = reference.range.endColumn - reference.range.startColumn;\n        var newLineLength = newRange.endColumn - newRange.startColumn;\n\n        if (lineLength !== newLineLength) {\n          ignore = true;\n        }\n      }\n\n      if (ignore) {\n        _this._decorationIgnoreSet.add(reference.id);\n\n        toRemove.push(decorationId);\n      } else {\n        reference.range = newRange;\n      }\n    });\n\n    for (var i = 0, len = toRemove.length; i < len; i++) {\n      this._decorations.delete(toRemove[i]);\n    }\n\n    this._editor.deltaDecorations(toRemove, []);\n  };\n\n  DecorationsManager.prototype.removeDecorations = function () {\n    var toRemove = [];\n\n    this._decorations.forEach(function (value, key) {\n      toRemove.push(key);\n    });\n\n    this._editor.deltaDecorations(toRemove, []);\n\n    this._decorations.clear();\n  };\n\n  DecorationsManager.DecorationOptions = ModelDecorationOptions.register({\n    stickiness: 1\n    /* NeverGrowsWhenTypingAtEdges */\n    ,\n    className: 'reference-decoration'\n  });\n  return DecorationsManager;\n}();\n\nvar LayoutData =\n/** @class */\nfunction () {\n  function LayoutData() {\n    this.ratio = 0.7;\n    this.heightInLines = 18;\n  }\n\n  LayoutData.fromJSON = function (raw) {\n    var ratio;\n    var heightInLines;\n\n    try {\n      var data = JSON.parse(raw);\n      ratio = data.ratio;\n      heightInLines = data.heightInLines;\n    } catch (_a) {//\n    }\n\n    return {\n      ratio: ratio || 0.7,\n      heightInLines: heightInLines || 18\n    };\n  };\n\n  return LayoutData;\n}();\n\nexport { LayoutData };\n/**\r\n * ZoneWidget that is shown inside the editor\r\n */\n\nvar ReferenceWidget =\n/** @class */\nfunction (_super) {\n  __extends(ReferenceWidget, _super);\n\n  function ReferenceWidget(editor, _defaultTreeKeyboardSupport, layoutData, themeService, _textModelResolverService, _instantiationService, _peekViewService, _uriLabel) {\n    var _this = _super.call(this, editor, {\n      showFrame: false,\n      showArrow: true,\n      isResizeable: true,\n      isAccessible: true\n    }) || this;\n\n    _this._defaultTreeKeyboardSupport = _defaultTreeKeyboardSupport;\n    _this.layoutData = layoutData;\n    _this._textModelResolverService = _textModelResolverService;\n    _this._instantiationService = _instantiationService;\n    _this._peekViewService = _peekViewService;\n    _this._uriLabel = _uriLabel;\n    _this._disposeOnNewModel = new DisposableStore();\n    _this._callOnDispose = new DisposableStore();\n    _this._onDidSelectReference = new Emitter();\n    _this.onDidSelectReference = _this._onDidSelectReference.event;\n    _this._dim = {\n      height: 0,\n      width: 0\n    };\n\n    _this._applyTheme(themeService.getTheme());\n\n    _this._callOnDispose.add(themeService.onThemeChange(_this._applyTheme.bind(_this)));\n\n    _this._peekViewService.addExclusiveWidget(editor, _this);\n\n    _this.create();\n\n    return _this;\n  }\n\n  ReferenceWidget.prototype.dispose = function () {\n    this.setModel(undefined);\n\n    this._callOnDispose.dispose();\n\n    this._disposeOnNewModel.dispose();\n\n    dispose(this._preview);\n    dispose(this._previewNotAvailableMessage);\n    dispose(this._tree);\n    dispose(this._previewModelReference);\n\n    this._splitView.dispose();\n\n    _super.prototype.dispose.call(this);\n  };\n\n  ReferenceWidget.prototype._applyTheme = function (theme) {\n    var borderColor = theme.getColor(peekView.peekViewBorder) || Color.transparent;\n    this.style({\n      arrowColor: borderColor,\n      frameColor: borderColor,\n      headerBackgroundColor: theme.getColor(peekView.peekViewTitleBackground) || Color.transparent,\n      primaryHeadingColor: theme.getColor(peekView.peekViewTitleForeground),\n      secondaryHeadingColor: theme.getColor(peekView.peekViewTitleInfoForeground)\n    });\n  };\n\n  ReferenceWidget.prototype.show = function (where) {\n    this.editor.revealRangeInCenterIfOutsideViewport(where, 0\n    /* Smooth */\n    );\n\n    _super.prototype.show.call(this, where, this.layoutData.heightInLines || 18);\n  };\n\n  ReferenceWidget.prototype.focusOnReferenceTree = function () {\n    this._tree.domFocus();\n  };\n\n  ReferenceWidget.prototype.focusOnPreviewEditor = function () {\n    this._preview.focus();\n  };\n\n  ReferenceWidget.prototype.isPreviewEditorFocused = function () {\n    return this._preview.hasTextFocus();\n  };\n\n  ReferenceWidget.prototype._onTitleClick = function (e) {\n    if (this._preview && this._preview.getModel()) {\n      this._onDidSelectReference.fire({\n        element: this._getFocusedReference(),\n        kind: e.ctrlKey || e.metaKey || e.altKey ? 'side' : 'open',\n        source: 'title'\n      });\n    }\n  };\n\n  ReferenceWidget.prototype._fillBody = function (containerElement) {\n    var _this = this;\n\n    this.setCssClass('reference-zone-widget'); // message pane\n\n    this._messageContainer = dom.append(containerElement, dom.$('div.messages'));\n    dom.hide(this._messageContainer);\n    this._splitView = new SplitView(containerElement, {\n      orientation: 1\n      /* HORIZONTAL */\n\n    }); // editor\n\n    this._previewContainer = dom.append(containerElement, dom.$('div.preview.inline'));\n    var options = {\n      scrollBeyondLastLine: false,\n      scrollbar: {\n        verticalScrollbarSize: 14,\n        horizontal: 'auto',\n        useShadows: true,\n        verticalHasArrows: false,\n        horizontalHasArrows: false,\n        alwaysConsumeMouseWheel: false\n      },\n      overviewRulerLanes: 2,\n      fixedOverflowWidgets: true,\n      minimap: {\n        enabled: false\n      }\n    };\n    this._preview = this._instantiationService.createInstance(EmbeddedCodeEditorWidget, this._previewContainer, options, this.editor);\n    dom.hide(this._previewContainer);\n    this._previewNotAvailableMessage = TextModel.createFromString(nls.localize('missingPreviewMessage', \"no preview available\")); // tree\n\n    this._treeContainer = dom.append(containerElement, dom.$('div.ref-tree.inline'));\n    var treeOptions = {\n      ariaLabel: nls.localize('treeAriaLabel', \"References\"),\n      keyboardSupport: this._defaultTreeKeyboardSupport,\n      accessibilityProvider: new AriaProvider(),\n      keyboardNavigationLabelProvider: this._instantiationService.createInstance(StringRepresentationProvider),\n      identityProvider: new IdentityProvider(),\n      overrideStyles: {\n        listBackground: peekView.peekViewResultsBackground\n      }\n    };\n    this._tree = this._instantiationService.createInstance(WorkbenchAsyncDataTree, 'ReferencesWidget', this._treeContainer, new Delegate(), [this._instantiationService.createInstance(FileReferencesRenderer), this._instantiationService.createInstance(OneReferenceRenderer)], this._instantiationService.createInstance(DataSource), treeOptions); // split stuff\n\n    this._splitView.addView({\n      onDidChange: Event.None,\n      element: this._previewContainer,\n      minimumSize: 200,\n      maximumSize: Number.MAX_VALUE,\n      layout: function (width) {\n        _this._preview.layout({\n          height: _this._dim.height,\n          width: width\n        });\n      }\n    }, Sizing.Distribute);\n\n    this._splitView.addView({\n      onDidChange: Event.None,\n      element: this._treeContainer,\n      minimumSize: 100,\n      maximumSize: Number.MAX_VALUE,\n      layout: function (width) {\n        _this._treeContainer.style.height = _this._dim.height + \"px\";\n        _this._treeContainer.style.width = width + \"px\";\n\n        _this._tree.layout(_this._dim.height, width);\n      }\n    }, Sizing.Distribute);\n\n    this._disposables.add(this._splitView.onDidSashChange(function () {\n      if (_this._dim.width) {\n        _this.layoutData.ratio = _this._splitView.getViewSize(0) / _this._dim.width;\n      }\n    }, undefined)); // listen on selection and focus\n\n\n    var onEvent = function (element, kind) {\n      if (element instanceof OneReference) {\n        if (kind === 'show') {\n          _this._revealReference(element, false);\n        }\n\n        _this._onDidSelectReference.fire({\n          element: element,\n          kind: kind,\n          source: 'tree'\n        });\n      }\n    };\n\n    this._tree.onDidChangeFocus(function (e) {\n      onEvent(e.elements[0], 'show');\n    });\n\n    this._tree.onDidOpen(function (e) {\n      if (e.browserEvent instanceof MouseEvent && (e.browserEvent.ctrlKey || e.browserEvent.metaKey || e.browserEvent.altKey)) {\n        // modifier-click -> open to the side\n        onEvent(e.elements[0], 'side');\n      } else if (e.browserEvent instanceof KeyboardEvent || e.browserEvent instanceof MouseEvent && e.browserEvent.detail === 2 || e.browserEvent.tapCount === 2) {\n        // keybinding (list service command)\n        // OR double click\n        // OR double tap\n        // -> close widget and goto target\n        onEvent(e.elements[0], 'goto');\n      } else {\n        // preview location\n        onEvent(e.elements[0], 'show');\n      }\n    });\n\n    dom.hide(this._treeContainer);\n  };\n\n  ReferenceWidget.prototype._onWidth = function (width) {\n    if (this._dim) {\n      this._doLayoutBody(this._dim.height, width);\n    }\n  };\n\n  ReferenceWidget.prototype._doLayoutBody = function (heightInPixel, widthInPixel) {\n    _super.prototype._doLayoutBody.call(this, heightInPixel, widthInPixel);\n\n    this._dim = {\n      height: heightInPixel,\n      width: widthInPixel\n    };\n    this.layoutData.heightInLines = this._viewZone ? this._viewZone.heightInLines : this.layoutData.heightInLines;\n\n    this._splitView.layout(widthInPixel);\n\n    this._splitView.resizeView(0, widthInPixel * this.layoutData.ratio);\n  };\n\n  ReferenceWidget.prototype.setSelection = function (selection) {\n    var _this = this;\n\n    return this._revealReference(selection, true).then(function () {\n      if (!_this._model) {\n        // disposed\n        return;\n      } // show in tree\n\n\n      _this._tree.setSelection([selection]);\n\n      _this._tree.setFocus([selection]);\n    });\n  };\n\n  ReferenceWidget.prototype.setModel = function (newModel) {\n    // clean up\n    this._disposeOnNewModel.clear();\n\n    this._model = newModel;\n\n    if (this._model) {\n      return this._onNewModel();\n    }\n\n    return Promise.resolve();\n  };\n\n  ReferenceWidget.prototype._onNewModel = function () {\n    var _this = this;\n\n    if (!this._model) {\n      return Promise.resolve(undefined);\n    }\n\n    if (this._model.isEmpty) {\n      this.setTitle('');\n      this._messageContainer.innerHTML = nls.localize('noResults', \"No results\");\n      dom.show(this._messageContainer);\n      return Promise.resolve(undefined);\n    }\n\n    dom.hide(this._messageContainer);\n    this._decorationsManager = new DecorationsManager(this._preview, this._model);\n\n    this._disposeOnNewModel.add(this._decorationsManager); // listen on model changes\n\n\n    this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(function (reference) {\n      return _this._tree.rerender(reference);\n    })); // listen on editor\n\n\n    this._disposeOnNewModel.add(this._preview.onMouseDown(function (e) {\n      var event = e.event,\n          target = e.target;\n\n      if (event.detail !== 2) {\n        return;\n      }\n\n      var element = _this._getFocusedReference();\n\n      if (!element) {\n        return;\n      }\n\n      _this._onDidSelectReference.fire({\n        element: {\n          uri: element.uri,\n          range: target.range\n        },\n        kind: event.ctrlKey || event.metaKey || event.altKey ? 'side' : 'open',\n        source: 'editor'\n      });\n    })); // make sure things are rendered\n\n\n    dom.addClass(this.container, 'results-loaded');\n    dom.show(this._treeContainer);\n    dom.show(this._previewContainer);\n\n    this._splitView.layout(this._dim.width);\n\n    this.focusOnReferenceTree(); // pick input and a reference to begin with\n\n    return this._tree.setInput(this._model.groups.length === 1 ? this._model.groups[0] : this._model);\n  };\n\n  ReferenceWidget.prototype._getFocusedReference = function () {\n    var element = this._tree.getFocus()[0];\n\n    if (element instanceof OneReference) {\n      return element;\n    } else if (element instanceof FileReferences) {\n      if (element.children.length > 0) {\n        return element.children[0];\n      }\n    }\n\n    return undefined;\n  };\n\n  ReferenceWidget.prototype._revealReference = function (reference, revealParent) {\n    return __awaiter(this, void 0, void 0, function () {\n      var promise, ref, model, scrollType, sel;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            // check if there is anything to do...\n            if (this._revealedReference === reference) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            this._revealedReference = reference; // Update widget header\n\n            if (reference.uri.scheme !== Schemas.inMemory) {\n              this.setTitle(basenameOrAuthority(reference.uri), this._uriLabel.getUriLabel(dirname(reference.uri)));\n            } else {\n              this.setTitle(nls.localize('peekView.alternateTitle', \"References\"));\n            }\n\n            promise = this._textModelResolverService.createModelReference(reference.uri);\n            if (!(this._tree.getInput() === reference.parent)) return [3\n            /*break*/\n            , 1];\n\n            this._tree.reveal(reference);\n\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            if (revealParent) {\n              this._tree.reveal(reference.parent);\n            }\n\n            return [4\n            /*yield*/\n            , this._tree.expand(reference.parent)];\n\n          case 2:\n            _a.sent();\n\n            this._tree.reveal(reference);\n\n            _a.label = 3;\n\n          case 3:\n            return [4\n            /*yield*/\n            , promise];\n\n          case 4:\n            ref = _a.sent();\n\n            if (!this._model) {\n              // disposed\n              ref.dispose();\n              return [2\n              /*return*/\n              ];\n            }\n\n            dispose(this._previewModelReference);\n            model = ref.object;\n\n            if (model) {\n              scrollType = this._preview.getModel() === model.textEditorModel ? 0\n              /* Smooth */\n              : 1\n              /* Immediate */\n              ;\n              sel = Range.lift(reference.range).collapseToStart();\n              this._previewModelReference = ref;\n\n              this._preview.setModel(model.textEditorModel);\n\n              this._preview.setSelection(sel);\n\n              this._preview.revealRangeInCenter(sel, scrollType);\n            } else {\n              this._preview.setModel(this._previewNotAvailableMessage);\n\n              ref.dispose();\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  ReferenceWidget = __decorate([__param(3, IThemeService), __param(4, ITextModelService), __param(5, IInstantiationService), __param(6, peekView.IPeekViewService), __param(7, ILabelService)], ReferenceWidget);\n  return ReferenceWidget;\n}(peekView.PeekViewWidget);\n\nexport { ReferenceWidget }; // theming\n\nregisterThemingParticipant(function (theme, collector) {\n  var findMatchHighlightColor = theme.getColor(peekView.peekViewResultsMatchHighlight);\n\n  if (findMatchHighlightColor) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .referenceMatch .highlight { background-color: \" + findMatchHighlightColor + \"; }\");\n  }\n\n  var referenceHighlightColor = theme.getColor(peekView.peekViewEditorMatchHighlight);\n\n  if (referenceHighlightColor) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .preview .reference-decoration { background-color: \" + referenceHighlightColor + \"; }\");\n  }\n\n  var referenceHighlightBorder = theme.getColor(peekView.peekViewEditorMatchHighlightBorder);\n\n  if (referenceHighlightBorder) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .preview .reference-decoration { border: 2px solid \" + referenceHighlightBorder + \"; box-sizing: border-box; }\");\n  }\n\n  var hcOutline = theme.getColor(activeContrastBorder);\n\n  if (hcOutline) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .referenceMatch .highlight { border: 1px dotted \" + hcOutline + \"; box-sizing: border-box; }\");\n  }\n\n  var resultsBackground = theme.getColor(peekView.peekViewResultsBackground);\n\n  if (resultsBackground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree { background-color: \" + resultsBackground + \"; }\");\n  }\n\n  var resultsMatchForeground = theme.getColor(peekView.peekViewResultsMatchForeground);\n\n  if (resultsMatchForeground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree { color: \" + resultsMatchForeground + \"; }\");\n  }\n\n  var resultsFileForeground = theme.getColor(peekView.peekViewResultsFileForeground);\n\n  if (resultsFileForeground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .reference-file { color: \" + resultsFileForeground + \"; }\");\n  }\n\n  var resultsSelectedBackground = theme.getColor(peekView.peekViewResultsSelectionBackground);\n\n  if (resultsSelectedBackground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .monaco-list:focus .monaco-list-rows > .monaco-list-row.selected:not(.highlighted) { background-color: \" + resultsSelectedBackground + \"; }\");\n  }\n\n  var resultsSelectedForeground = theme.getColor(peekView.peekViewResultsSelectionForeground);\n\n  if (resultsSelectedForeground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .monaco-list:focus .monaco-list-rows > .monaco-list-row.selected:not(.highlighted) { color: \" + resultsSelectedForeground + \" !important; }\");\n  }\n\n  var editorBackground = theme.getColor(peekView.peekViewEditorBackground);\n\n  if (editorBackground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .preview .monaco-editor .monaco-editor-background,\" + \".monaco-editor .reference-zone-widget .preview .monaco-editor .inputarea.ime-input {\" + (\"\\tbackground-color: \" + editorBackground + \";\") + \"}\");\n  }\n\n  var editorGutterBackground = theme.getColor(peekView.peekViewEditorGutterBackground);\n\n  if (editorGutterBackground) {\n    collector.addRule(\".monaco-editor .reference-zone-widget .preview .monaco-editor .margin {\" + (\"\\tbackground-color: \" + editorGutterBackground + \";\") + \"}\");\n  }\n});","map":{"version":3,"sources":["/Users/ifudata/eclipse-workspace/screen-web/node_modules/monaco-editor/esm/vs/editor/contrib/gotoSymbol/peek/referencesWidget.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","push","dom","Color","Emitter","Event","dispose","DisposableStore","Schemas","basenameOrAuthority","dirname","isEqual","EmbeddedCodeEditorWidget","Range","ModelDecorationOptions","TextModel","ITextModelService","AriaProvider","DataSource","Delegate","FileReferencesRenderer","OneReferenceRenderer","StringRepresentationProvider","IdentityProvider","nls","IInstantiationService","ILabelService","WorkbenchAsyncDataTree","activeContrastBorder","IThemeService","registerThemingParticipant","peekView","FileReferences","OneReference","SplitView","Sizing","DecorationsManager","_editor","_model","_this","_decorations","Map","_decorationIgnoreSet","Set","_callOnDispose","_callOnModelChange","add","onDidChangeModel","_onModelChanged","removeDecorations","clear","model","getModel","_i","_a","groups","ref","uri","_addDecorations","reference","hasModel","onDidChangeDecorations","event","_onDecorationChanged","newDecorations","newDecorationsActualIndex","len","children","oneReference","has","id","range","options","DecorationOptions","decorations","deltaDecorations","set","toRemove","forEach","decorationId","newRange","getDecorationRange","ignore","equalsRange","spansMultipleLines","lineLength","endColumn","startColumn","newLineLength","delete","register","stickiness","className","LayoutData","ratio","heightInLines","fromJSON","raw","data","JSON","parse","ReferenceWidget","_super","editor","_defaultTreeKeyboardSupport","layoutData","themeService","_textModelResolverService","_instantiationService","_peekViewService","_uriLabel","showFrame","showArrow","isResizeable","isAccessible","_disposeOnNewModel","_onDidSelectReference","onDidSelectReference","_dim","height","width","_applyTheme","getTheme","onThemeChange","bind","addExclusiveWidget","setModel","undefined","_preview","_previewNotAvailableMessage","_tree","_previewModelReference","_splitView","theme","borderColor","getColor","peekViewBorder","transparent","style","arrowColor","frameColor","headerBackgroundColor","peekViewTitleBackground","primaryHeadingColor","peekViewTitleForeground","secondaryHeadingColor","peekViewTitleInfoForeground","show","where","revealRangeInCenterIfOutsideViewport","focusOnReferenceTree","domFocus","focusOnPreviewEditor","focus","isPreviewEditorFocused","hasTextFocus","_onTitleClick","fire","element","_getFocusedReference","kind","ctrlKey","metaKey","altKey","source","_fillBody","containerElement","setCssClass","_messageContainer","append","$","hide","orientation","_previewContainer","scrollBeyondLastLine","scrollbar","verticalScrollbarSize","horizontal","useShadows","verticalHasArrows","horizontalHasArrows","alwaysConsumeMouseWheel","overviewRulerLanes","fixedOverflowWidgets","minimap","enabled","createInstance","createFromString","localize","_treeContainer","treeOptions","ariaLabel","keyboardSupport","accessibilityProvider","keyboardNavigationLabelProvider","identityProvider","overrideStyles","listBackground","peekViewResultsBackground","addView","onDidChange","None","minimumSize","maximumSize","Number","MAX_VALUE","layout","Distribute","_disposables","onDidSashChange","getViewSize","onEvent","_revealReference","onDidChangeFocus","elements","onDidOpen","browserEvent","MouseEvent","KeyboardEvent","detail","tapCount","_onWidth","_doLayoutBody","heightInPixel","widthInPixel","_viewZone","resizeView","setSelection","selection","setFocus","newModel","_onNewModel","isEmpty","setTitle","innerHTML","_decorationsManager","onDidChangeReferenceRange","rerender","onMouseDown","addClass","container","setInput","getFocus","revealParent","promise","scrollType","sel","_revealedReference","scheme","inMemory","getUriLabel","createModelReference","getInput","parent","reveal","expand","object","textEditorModel","lift","collapseToStart","revealRangeInCenter","IPeekViewService","PeekViewWidget","collector","findMatchHighlightColor","peekViewResultsMatchHighlight","addRule","referenceHighlightColor","peekViewEditorMatchHighlight","referenceHighlightBorder","peekViewEditorMatchHighlightBorder","hcOutline","resultsBackground","resultsMatchForeground","peekViewResultsMatchForeground","resultsFileForeground","peekViewResultsFileForeground","resultsSelectedBackground","peekViewResultsSelectionBackground","resultsSelectedForeground","peekViewResultsSelectionForeground","editorBackground","peekViewEditorBackground","editorGutterBackground","peekViewEditorGutterBackground"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport './referencesWidget.css';\r\nimport * as dom from '../../../../base/browser/dom.js';\r\nimport { Color } from '../../../../base/common/color.js';\r\nimport { Emitter, Event } from '../../../../base/common/event.js';\r\nimport { dispose, DisposableStore } from '../../../../base/common/lifecycle.js';\r\nimport { Schemas } from '../../../../base/common/network.js';\r\nimport { basenameOrAuthority, dirname, isEqual } from '../../../../base/common/resources.js';\r\nimport { EmbeddedCodeEditorWidget } from '../../../browser/widget/embeddedCodeEditorWidget.js';\r\nimport { Range } from '../../../common/core/range.js';\r\nimport { ModelDecorationOptions, TextModel } from '../../../common/model/textModel.js';\r\nimport { ITextModelService } from '../../../common/services/resolverService.js';\r\nimport { AriaProvider, DataSource, Delegate, FileReferencesRenderer, OneReferenceRenderer, StringRepresentationProvider, IdentityProvider } from './referencesTree.js';\r\nimport * as nls from '../../../../nls.js';\r\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\r\nimport { ILabelService } from '../../../../platform/label/common/label.js';\r\nimport { WorkbenchAsyncDataTree } from '../../../../platform/list/browser/listService.js';\r\nimport { activeContrastBorder } from '../../../../platform/theme/common/colorRegistry.js';\r\nimport { IThemeService, registerThemingParticipant } from '../../../../platform/theme/common/themeService.js';\r\nimport * as peekView from '../../peekView/peekView.js';\r\nimport { FileReferences, OneReference } from '../referencesModel.js';\r\nimport { SplitView, Sizing } from '../../../../base/browser/ui/splitview/splitview.js';\r\nvar DecorationsManager = /** @class */ (function () {\r\n    function DecorationsManager(_editor, _model) {\r\n        var _this = this;\r\n        this._editor = _editor;\r\n        this._model = _model;\r\n        this._decorations = new Map();\r\n        this._decorationIgnoreSet = new Set();\r\n        this._callOnDispose = new DisposableStore();\r\n        this._callOnModelChange = new DisposableStore();\r\n        this._callOnDispose.add(this._editor.onDidChangeModel(function () { return _this._onModelChanged(); }));\r\n        this._onModelChanged();\r\n    }\r\n    DecorationsManager.prototype.dispose = function () {\r\n        this._callOnModelChange.dispose();\r\n        this._callOnDispose.dispose();\r\n        this.removeDecorations();\r\n    };\r\n    DecorationsManager.prototype._onModelChanged = function () {\r\n        this._callOnModelChange.clear();\r\n        var model = this._editor.getModel();\r\n        if (model) {\r\n            for (var _i = 0, _a = this._model.groups; _i < _a.length; _i++) {\r\n                var ref = _a[_i];\r\n                if (isEqual(ref.uri, model.uri)) {\r\n                    this._addDecorations(ref);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    DecorationsManager.prototype._addDecorations = function (reference) {\r\n        var _this = this;\r\n        if (!this._editor.hasModel()) {\r\n            return;\r\n        }\r\n        this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(function (event) { return _this._onDecorationChanged(); }));\r\n        var newDecorations = [];\r\n        var newDecorationsActualIndex = [];\r\n        for (var i = 0, len = reference.children.length; i < len; i++) {\r\n            var oneReference = reference.children[i];\r\n            if (this._decorationIgnoreSet.has(oneReference.id)) {\r\n                continue;\r\n            }\r\n            newDecorations.push({\r\n                range: oneReference.range,\r\n                options: DecorationsManager.DecorationOptions\r\n            });\r\n            newDecorationsActualIndex.push(i);\r\n        }\r\n        var decorations = this._editor.deltaDecorations([], newDecorations);\r\n        for (var i = 0; i < decorations.length; i++) {\r\n            this._decorations.set(decorations[i], reference.children[newDecorationsActualIndex[i]]);\r\n        }\r\n    };\r\n    DecorationsManager.prototype._onDecorationChanged = function () {\r\n        var _this = this;\r\n        var toRemove = [];\r\n        var model = this._editor.getModel();\r\n        if (!model) {\r\n            return;\r\n        }\r\n        this._decorations.forEach(function (reference, decorationId) {\r\n            var newRange = model.getDecorationRange(decorationId);\r\n            if (!newRange) {\r\n                return;\r\n            }\r\n            var ignore = false;\r\n            if (Range.equalsRange(newRange, reference.range)) {\r\n                return;\r\n            }\r\n            else if (Range.spansMultipleLines(newRange)) {\r\n                ignore = true;\r\n            }\r\n            else {\r\n                var lineLength = reference.range.endColumn - reference.range.startColumn;\r\n                var newLineLength = newRange.endColumn - newRange.startColumn;\r\n                if (lineLength !== newLineLength) {\r\n                    ignore = true;\r\n                }\r\n            }\r\n            if (ignore) {\r\n                _this._decorationIgnoreSet.add(reference.id);\r\n                toRemove.push(decorationId);\r\n            }\r\n            else {\r\n                reference.range = newRange;\r\n            }\r\n        });\r\n        for (var i = 0, len = toRemove.length; i < len; i++) {\r\n            this._decorations.delete(toRemove[i]);\r\n        }\r\n        this._editor.deltaDecorations(toRemove, []);\r\n    };\r\n    DecorationsManager.prototype.removeDecorations = function () {\r\n        var toRemove = [];\r\n        this._decorations.forEach(function (value, key) {\r\n            toRemove.push(key);\r\n        });\r\n        this._editor.deltaDecorations(toRemove, []);\r\n        this._decorations.clear();\r\n    };\r\n    DecorationsManager.DecorationOptions = ModelDecorationOptions.register({\r\n        stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n        className: 'reference-decoration'\r\n    });\r\n    return DecorationsManager;\r\n}());\r\nvar LayoutData = /** @class */ (function () {\r\n    function LayoutData() {\r\n        this.ratio = 0.7;\r\n        this.heightInLines = 18;\r\n    }\r\n    LayoutData.fromJSON = function (raw) {\r\n        var ratio;\r\n        var heightInLines;\r\n        try {\r\n            var data = JSON.parse(raw);\r\n            ratio = data.ratio;\r\n            heightInLines = data.heightInLines;\r\n        }\r\n        catch (_a) {\r\n            //\r\n        }\r\n        return {\r\n            ratio: ratio || 0.7,\r\n            heightInLines: heightInLines || 18\r\n        };\r\n    };\r\n    return LayoutData;\r\n}());\r\nexport { LayoutData };\r\n/**\r\n * ZoneWidget that is shown inside the editor\r\n */\r\nvar ReferenceWidget = /** @class */ (function (_super) {\r\n    __extends(ReferenceWidget, _super);\r\n    function ReferenceWidget(editor, _defaultTreeKeyboardSupport, layoutData, themeService, _textModelResolverService, _instantiationService, _peekViewService, _uriLabel) {\r\n        var _this = _super.call(this, editor, { showFrame: false, showArrow: true, isResizeable: true, isAccessible: true }) || this;\r\n        _this._defaultTreeKeyboardSupport = _defaultTreeKeyboardSupport;\r\n        _this.layoutData = layoutData;\r\n        _this._textModelResolverService = _textModelResolverService;\r\n        _this._instantiationService = _instantiationService;\r\n        _this._peekViewService = _peekViewService;\r\n        _this._uriLabel = _uriLabel;\r\n        _this._disposeOnNewModel = new DisposableStore();\r\n        _this._callOnDispose = new DisposableStore();\r\n        _this._onDidSelectReference = new Emitter();\r\n        _this.onDidSelectReference = _this._onDidSelectReference.event;\r\n        _this._dim = { height: 0, width: 0 };\r\n        _this._applyTheme(themeService.getTheme());\r\n        _this._callOnDispose.add(themeService.onThemeChange(_this._applyTheme.bind(_this)));\r\n        _this._peekViewService.addExclusiveWidget(editor, _this);\r\n        _this.create();\r\n        return _this;\r\n    }\r\n    ReferenceWidget.prototype.dispose = function () {\r\n        this.setModel(undefined);\r\n        this._callOnDispose.dispose();\r\n        this._disposeOnNewModel.dispose();\r\n        dispose(this._preview);\r\n        dispose(this._previewNotAvailableMessage);\r\n        dispose(this._tree);\r\n        dispose(this._previewModelReference);\r\n        this._splitView.dispose();\r\n        _super.prototype.dispose.call(this);\r\n    };\r\n    ReferenceWidget.prototype._applyTheme = function (theme) {\r\n        var borderColor = theme.getColor(peekView.peekViewBorder) || Color.transparent;\r\n        this.style({\r\n            arrowColor: borderColor,\r\n            frameColor: borderColor,\r\n            headerBackgroundColor: theme.getColor(peekView.peekViewTitleBackground) || Color.transparent,\r\n            primaryHeadingColor: theme.getColor(peekView.peekViewTitleForeground),\r\n            secondaryHeadingColor: theme.getColor(peekView.peekViewTitleInfoForeground)\r\n        });\r\n    };\r\n    ReferenceWidget.prototype.show = function (where) {\r\n        this.editor.revealRangeInCenterIfOutsideViewport(where, 0 /* Smooth */);\r\n        _super.prototype.show.call(this, where, this.layoutData.heightInLines || 18);\r\n    };\r\n    ReferenceWidget.prototype.focusOnReferenceTree = function () {\r\n        this._tree.domFocus();\r\n    };\r\n    ReferenceWidget.prototype.focusOnPreviewEditor = function () {\r\n        this._preview.focus();\r\n    };\r\n    ReferenceWidget.prototype.isPreviewEditorFocused = function () {\r\n        return this._preview.hasTextFocus();\r\n    };\r\n    ReferenceWidget.prototype._onTitleClick = function (e) {\r\n        if (this._preview && this._preview.getModel()) {\r\n            this._onDidSelectReference.fire({\r\n                element: this._getFocusedReference(),\r\n                kind: e.ctrlKey || e.metaKey || e.altKey ? 'side' : 'open',\r\n                source: 'title'\r\n            });\r\n        }\r\n    };\r\n    ReferenceWidget.prototype._fillBody = function (containerElement) {\r\n        var _this = this;\r\n        this.setCssClass('reference-zone-widget');\r\n        // message pane\r\n        this._messageContainer = dom.append(containerElement, dom.$('div.messages'));\r\n        dom.hide(this._messageContainer);\r\n        this._splitView = new SplitView(containerElement, { orientation: 1 /* HORIZONTAL */ });\r\n        // editor\r\n        this._previewContainer = dom.append(containerElement, dom.$('div.preview.inline'));\r\n        var options = {\r\n            scrollBeyondLastLine: false,\r\n            scrollbar: {\r\n                verticalScrollbarSize: 14,\r\n                horizontal: 'auto',\r\n                useShadows: true,\r\n                verticalHasArrows: false,\r\n                horizontalHasArrows: false,\r\n                alwaysConsumeMouseWheel: false\r\n            },\r\n            overviewRulerLanes: 2,\r\n            fixedOverflowWidgets: true,\r\n            minimap: {\r\n                enabled: false\r\n            }\r\n        };\r\n        this._preview = this._instantiationService.createInstance(EmbeddedCodeEditorWidget, this._previewContainer, options, this.editor);\r\n        dom.hide(this._previewContainer);\r\n        this._previewNotAvailableMessage = TextModel.createFromString(nls.localize('missingPreviewMessage', \"no preview available\"));\r\n        // tree\r\n        this._treeContainer = dom.append(containerElement, dom.$('div.ref-tree.inline'));\r\n        var treeOptions = {\r\n            ariaLabel: nls.localize('treeAriaLabel', \"References\"),\r\n            keyboardSupport: this._defaultTreeKeyboardSupport,\r\n            accessibilityProvider: new AriaProvider(),\r\n            keyboardNavigationLabelProvider: this._instantiationService.createInstance(StringRepresentationProvider),\r\n            identityProvider: new IdentityProvider(),\r\n            overrideStyles: {\r\n                listBackground: peekView.peekViewResultsBackground\r\n            }\r\n        };\r\n        this._tree = this._instantiationService.createInstance(WorkbenchAsyncDataTree, 'ReferencesWidget', this._treeContainer, new Delegate(), [\r\n            this._instantiationService.createInstance(FileReferencesRenderer),\r\n            this._instantiationService.createInstance(OneReferenceRenderer),\r\n        ], this._instantiationService.createInstance(DataSource), treeOptions);\r\n        // split stuff\r\n        this._splitView.addView({\r\n            onDidChange: Event.None,\r\n            element: this._previewContainer,\r\n            minimumSize: 200,\r\n            maximumSize: Number.MAX_VALUE,\r\n            layout: function (width) {\r\n                _this._preview.layout({ height: _this._dim.height, width: width });\r\n            }\r\n        }, Sizing.Distribute);\r\n        this._splitView.addView({\r\n            onDidChange: Event.None,\r\n            element: this._treeContainer,\r\n            minimumSize: 100,\r\n            maximumSize: Number.MAX_VALUE,\r\n            layout: function (width) {\r\n                _this._treeContainer.style.height = _this._dim.height + \"px\";\r\n                _this._treeContainer.style.width = width + \"px\";\r\n                _this._tree.layout(_this._dim.height, width);\r\n            }\r\n        }, Sizing.Distribute);\r\n        this._disposables.add(this._splitView.onDidSashChange(function () {\r\n            if (_this._dim.width) {\r\n                _this.layoutData.ratio = _this._splitView.getViewSize(0) / _this._dim.width;\r\n            }\r\n        }, undefined));\r\n        // listen on selection and focus\r\n        var onEvent = function (element, kind) {\r\n            if (element instanceof OneReference) {\r\n                if (kind === 'show') {\r\n                    _this._revealReference(element, false);\r\n                }\r\n                _this._onDidSelectReference.fire({ element: element, kind: kind, source: 'tree' });\r\n            }\r\n        };\r\n        this._tree.onDidChangeFocus(function (e) {\r\n            onEvent(e.elements[0], 'show');\r\n        });\r\n        this._tree.onDidOpen(function (e) {\r\n            if (e.browserEvent instanceof MouseEvent && (e.browserEvent.ctrlKey || e.browserEvent.metaKey || e.browserEvent.altKey)) {\r\n                // modifier-click -> open to the side\r\n                onEvent(e.elements[0], 'side');\r\n            }\r\n            else if (e.browserEvent instanceof KeyboardEvent || (e.browserEvent instanceof MouseEvent && e.browserEvent.detail === 2) || e.browserEvent.tapCount === 2) {\r\n                // keybinding (list service command)\r\n                // OR double click\r\n                // OR double tap\r\n                // -> close widget and goto target\r\n                onEvent(e.elements[0], 'goto');\r\n            }\r\n            else {\r\n                // preview location\r\n                onEvent(e.elements[0], 'show');\r\n            }\r\n        });\r\n        dom.hide(this._treeContainer);\r\n    };\r\n    ReferenceWidget.prototype._onWidth = function (width) {\r\n        if (this._dim) {\r\n            this._doLayoutBody(this._dim.height, width);\r\n        }\r\n    };\r\n    ReferenceWidget.prototype._doLayoutBody = function (heightInPixel, widthInPixel) {\r\n        _super.prototype._doLayoutBody.call(this, heightInPixel, widthInPixel);\r\n        this._dim = { height: heightInPixel, width: widthInPixel };\r\n        this.layoutData.heightInLines = this._viewZone ? this._viewZone.heightInLines : this.layoutData.heightInLines;\r\n        this._splitView.layout(widthInPixel);\r\n        this._splitView.resizeView(0, widthInPixel * this.layoutData.ratio);\r\n    };\r\n    ReferenceWidget.prototype.setSelection = function (selection) {\r\n        var _this = this;\r\n        return this._revealReference(selection, true).then(function () {\r\n            if (!_this._model) {\r\n                // disposed\r\n                return;\r\n            }\r\n            // show in tree\r\n            _this._tree.setSelection([selection]);\r\n            _this._tree.setFocus([selection]);\r\n        });\r\n    };\r\n    ReferenceWidget.prototype.setModel = function (newModel) {\r\n        // clean up\r\n        this._disposeOnNewModel.clear();\r\n        this._model = newModel;\r\n        if (this._model) {\r\n            return this._onNewModel();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    ReferenceWidget.prototype._onNewModel = function () {\r\n        var _this = this;\r\n        if (!this._model) {\r\n            return Promise.resolve(undefined);\r\n        }\r\n        if (this._model.isEmpty) {\r\n            this.setTitle('');\r\n            this._messageContainer.innerHTML = nls.localize('noResults', \"No results\");\r\n            dom.show(this._messageContainer);\r\n            return Promise.resolve(undefined);\r\n        }\r\n        dom.hide(this._messageContainer);\r\n        this._decorationsManager = new DecorationsManager(this._preview, this._model);\r\n        this._disposeOnNewModel.add(this._decorationsManager);\r\n        // listen on model changes\r\n        this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(function (reference) { return _this._tree.rerender(reference); }));\r\n        // listen on editor\r\n        this._disposeOnNewModel.add(this._preview.onMouseDown(function (e) {\r\n            var event = e.event, target = e.target;\r\n            if (event.detail !== 2) {\r\n                return;\r\n            }\r\n            var element = _this._getFocusedReference();\r\n            if (!element) {\r\n                return;\r\n            }\r\n            _this._onDidSelectReference.fire({\r\n                element: { uri: element.uri, range: target.range },\r\n                kind: (event.ctrlKey || event.metaKey || event.altKey) ? 'side' : 'open',\r\n                source: 'editor'\r\n            });\r\n        }));\r\n        // make sure things are rendered\r\n        dom.addClass(this.container, 'results-loaded');\r\n        dom.show(this._treeContainer);\r\n        dom.show(this._previewContainer);\r\n        this._splitView.layout(this._dim.width);\r\n        this.focusOnReferenceTree();\r\n        // pick input and a reference to begin with\r\n        return this._tree.setInput(this._model.groups.length === 1 ? this._model.groups[0] : this._model);\r\n    };\r\n    ReferenceWidget.prototype._getFocusedReference = function () {\r\n        var element = this._tree.getFocus()[0];\r\n        if (element instanceof OneReference) {\r\n            return element;\r\n        }\r\n        else if (element instanceof FileReferences) {\r\n            if (element.children.length > 0) {\r\n                return element.children[0];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    ReferenceWidget.prototype._revealReference = function (reference, revealParent) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promise, ref, model, scrollType, sel;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // check if there is anything to do...\r\n                        if (this._revealedReference === reference) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this._revealedReference = reference;\r\n                        // Update widget header\r\n                        if (reference.uri.scheme !== Schemas.inMemory) {\r\n                            this.setTitle(basenameOrAuthority(reference.uri), this._uriLabel.getUriLabel(dirname(reference.uri)));\r\n                        }\r\n                        else {\r\n                            this.setTitle(nls.localize('peekView.alternateTitle', \"References\"));\r\n                        }\r\n                        promise = this._textModelResolverService.createModelReference(reference.uri);\r\n                        if (!(this._tree.getInput() === reference.parent)) return [3 /*break*/, 1];\r\n                        this._tree.reveal(reference);\r\n                        return [3 /*break*/, 3];\r\n                    case 1:\r\n                        if (revealParent) {\r\n                            this._tree.reveal(reference.parent);\r\n                        }\r\n                        return [4 /*yield*/, this._tree.expand(reference.parent)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this._tree.reveal(reference);\r\n                        _a.label = 3;\r\n                    case 3: return [4 /*yield*/, promise];\r\n                    case 4:\r\n                        ref = _a.sent();\r\n                        if (!this._model) {\r\n                            // disposed\r\n                            ref.dispose();\r\n                            return [2 /*return*/];\r\n                        }\r\n                        dispose(this._previewModelReference);\r\n                        model = ref.object;\r\n                        if (model) {\r\n                            scrollType = this._preview.getModel() === model.textEditorModel ? 0 /* Smooth */ : 1 /* Immediate */;\r\n                            sel = Range.lift(reference.range).collapseToStart();\r\n                            this._previewModelReference = ref;\r\n                            this._preview.setModel(model.textEditorModel);\r\n                            this._preview.setSelection(sel);\r\n                            this._preview.revealRangeInCenter(sel, scrollType);\r\n                        }\r\n                        else {\r\n                            this._preview.setModel(this._previewNotAvailableMessage);\r\n                            ref.dispose();\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ReferenceWidget = __decorate([\r\n        __param(3, IThemeService),\r\n        __param(4, ITextModelService),\r\n        __param(5, IInstantiationService),\r\n        __param(6, peekView.IPeekViewService),\r\n        __param(7, ILabelService)\r\n    ], ReferenceWidget);\r\n    return ReferenceWidget;\r\n}(peekView.PeekViewWidget));\r\nexport { ReferenceWidget };\r\n// theming\r\nregisterThemingParticipant(function (theme, collector) {\r\n    var findMatchHighlightColor = theme.getColor(peekView.peekViewResultsMatchHighlight);\r\n    if (findMatchHighlightColor) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .referenceMatch .highlight { background-color: \" + findMatchHighlightColor + \"; }\");\r\n    }\r\n    var referenceHighlightColor = theme.getColor(peekView.peekViewEditorMatchHighlight);\r\n    if (referenceHighlightColor) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .preview .reference-decoration { background-color: \" + referenceHighlightColor + \"; }\");\r\n    }\r\n    var referenceHighlightBorder = theme.getColor(peekView.peekViewEditorMatchHighlightBorder);\r\n    if (referenceHighlightBorder) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .preview .reference-decoration { border: 2px solid \" + referenceHighlightBorder + \"; box-sizing: border-box; }\");\r\n    }\r\n    var hcOutline = theme.getColor(activeContrastBorder);\r\n    if (hcOutline) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .referenceMatch .highlight { border: 1px dotted \" + hcOutline + \"; box-sizing: border-box; }\");\r\n    }\r\n    var resultsBackground = theme.getColor(peekView.peekViewResultsBackground);\r\n    if (resultsBackground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree { background-color: \" + resultsBackground + \"; }\");\r\n    }\r\n    var resultsMatchForeground = theme.getColor(peekView.peekViewResultsMatchForeground);\r\n    if (resultsMatchForeground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree { color: \" + resultsMatchForeground + \"; }\");\r\n    }\r\n    var resultsFileForeground = theme.getColor(peekView.peekViewResultsFileForeground);\r\n    if (resultsFileForeground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .reference-file { color: \" + resultsFileForeground + \"; }\");\r\n    }\r\n    var resultsSelectedBackground = theme.getColor(peekView.peekViewResultsSelectionBackground);\r\n    if (resultsSelectedBackground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .monaco-list:focus .monaco-list-rows > .monaco-list-row.selected:not(.highlighted) { background-color: \" + resultsSelectedBackground + \"; }\");\r\n    }\r\n    var resultsSelectedForeground = theme.getColor(peekView.peekViewResultsSelectionForeground);\r\n    if (resultsSelectedForeground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .ref-tree .monaco-list:focus .monaco-list-rows > .monaco-list-row.selected:not(.highlighted) { color: \" + resultsSelectedForeground + \" !important; }\");\r\n    }\r\n    var editorBackground = theme.getColor(peekView.peekViewEditorBackground);\r\n    if (editorBackground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .preview .monaco-editor .monaco-editor-background,\" +\r\n            \".monaco-editor .reference-zone-widget .preview .monaco-editor .inputarea.ime-input {\" +\r\n            (\"\\tbackground-color: \" + editorBackground + \";\") +\r\n            \"}\");\r\n    }\r\n    var editorGutterBackground = theme.getColor(peekView.peekViewEditorGutterBackground);\r\n    if (editorGutterBackground) {\r\n        collector.addRule(\".monaco-editor .reference-zone-widget .preview .monaco-editor .margin {\" +\r\n            (\"\\tbackground-color: \" + editorGutterBackground + \";\") +\r\n            \"}\");\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}